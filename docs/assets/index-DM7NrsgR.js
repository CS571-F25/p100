(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))p(b);new MutationObserver(b=>{for(const I of b)if(I.type==="childList")for(const P of I.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&p(P)}).observe(document,{childList:!0,subtree:!0});function l(b){const I={};return b.integrity&&(I.integrity=b.integrity),b.referrerPolicy&&(I.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?I.credentials="include":b.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function p(b){if(b.ep)return;b.ep=!0;const I=l(b);fetch(b.href,I)}})();function N0(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Kw={exports:{}},a0={};var R2;function G3(){if(R2)return a0;R2=1;var c=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function l(p,b,I){var P=null;if(I!==void 0&&(P=""+I),b.key!==void 0&&(P=""+b.key),"key"in b){I={};for(var s in b)s!=="key"&&(I[s]=b[s])}else I=b;return b=I.ref,{$$typeof:c,type:p,key:P,ref:b!==void 0?b:null,props:I}}return a0.Fragment=n,a0.jsx=l,a0.jsxs=l,a0}var M2;function q3(){return M2||(M2=1,Kw.exports=G3()),Kw.exports}var xe=q3(),Yw={exports:{}},vr={};var D2;function H3(){if(D2)return vr;D2=1;var c=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),I=Symbol.for("react.consumer"),P=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),q=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),ce=Symbol.for("react.activity"),be=Symbol.iterator;function He(rt){return rt===null||typeof rt!="object"?null:(rt=be&&rt[be]||rt["@@iterator"],typeof rt=="function"?rt:null)}var Je={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},it=Object.assign,Ze={};function Pt(rt,Yt,ai){this.props=rt,this.context=Yt,this.refs=Ze,this.updater=ai||Je}Pt.prototype.isReactComponent={},Pt.prototype.setState=function(rt,Yt){if(typeof rt!="object"&&typeof rt!="function"&&rt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,rt,Yt,"setState")},Pt.prototype.forceUpdate=function(rt){this.updater.enqueueForceUpdate(this,rt,"forceUpdate")};function ct(){}ct.prototype=Pt.prototype;function Gt(rt,Yt,ai){this.props=rt,this.context=Yt,this.refs=Ze,this.updater=ai||Je}var ei=Gt.prototype=new ct;ei.constructor=Gt,it(ei,Pt.prototype),ei.isPureReactComponent=!0;var Fi=Array.isArray;function Si(){}var qe={H:null,A:null,T:null,S:null},Oe=Object.prototype.hasOwnProperty;function je(rt,Yt,ai){var _i=ai.ref;return{$$typeof:c,type:rt,key:Yt,ref:_i!==void 0?_i:null,props:ai}}function tt(rt,Yt){return je(rt.type,Yt,rt.props)}function nt(rt){return typeof rt=="object"&&rt!==null&&rt.$$typeof===c}function yt(rt){var Yt={"=":"=0",":":"=2"};return"$"+rt.replace(/[=:]/g,function(ai){return Yt[ai]})}var ze=/\/+/g;function ur(rt,Yt){return typeof rt=="object"&&rt!==null&&rt.key!=null?yt(""+rt.key):Yt.toString(36)}function qn(rt){switch(rt.status){case"fulfilled":return rt.value;case"rejected":throw rt.reason;default:switch(typeof rt.status=="string"?rt.then(Si,Si):(rt.status="pending",rt.then(function(Yt){rt.status==="pending"&&(rt.status="fulfilled",rt.value=Yt)},function(Yt){rt.status==="pending"&&(rt.status="rejected",rt.reason=Yt)})),rt.status){case"fulfilled":return rt.value;case"rejected":throw rt.reason}}throw rt}function Ct(rt,Yt,ai,_i,ln){var kn=typeof rt;(kn==="undefined"||kn==="boolean")&&(rt=null);var Jn=!1;if(rt===null)Jn=!0;else switch(kn){case"bigint":case"string":case"number":Jn=!0;break;case"object":switch(rt.$$typeof){case c:case n:Jn=!0;break;case ie:return Jn=rt._init,Ct(Jn(rt._payload),Yt,ai,_i,ln)}}if(Jn)return ln=ln(rt),Jn=_i===""?"."+ur(rt,0):_i,Fi(ln)?(ai="",Jn!=null&&(ai=Jn.replace(ze,"$&/")+"/"),Ct(ln,Yt,ai,"",function(hr){return hr})):ln!=null&&(nt(ln)&&(ln=tt(ln,ai+(ln.key==null||rt&&rt.key===ln.key?"":(""+ln.key).replace(ze,"$&/")+"/")+Jn)),Yt.push(ln)),1;Jn=0;var Mr=_i===""?".":_i+":";if(Fi(rt))for(var Ki=0;Ki<rt.length;Ki++)_i=rt[Ki],kn=Mr+ur(_i,Ki),Jn+=Ct(_i,Yt,ai,kn,ln);else if(Ki=He(rt),typeof Ki=="function")for(rt=Ki.call(rt),Ki=0;!(_i=rt.next()).done;)_i=_i.value,kn=Mr+ur(_i,Ki++),Jn+=Ct(_i,Yt,ai,kn,ln);else if(kn==="object"){if(typeof rt.then=="function")return Ct(qn(rt),Yt,ai,_i,ln);throw Yt=String(rt),Error("Objects are not valid as a React child (found: "+(Yt==="[object Object]"?"object with keys {"+Object.keys(rt).join(", ")+"}":Yt)+"). If you meant to render a collection of children, use an array instead.")}return Jn}function oi(rt,Yt,ai){if(rt==null)return rt;var _i=[],ln=0;return Ct(rt,_i,"","",function(kn){return Yt.call(ai,kn,ln++)}),_i}function wi(rt){if(rt._status===-1){var Yt=rt._result;Yt=Yt(),Yt.then(function(ai){(rt._status===0||rt._status===-1)&&(rt._status=1,rt._result=ai)},function(ai){(rt._status===0||rt._status===-1)&&(rt._status=2,rt._result=ai)}),rt._status===-1&&(rt._status=0,rt._result=Yt)}if(rt._status===1)return rt._result.default;throw rt._result}var bn=typeof reportError=="function"?reportError:function(rt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Yt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof rt=="object"&&rt!==null&&typeof rt.message=="string"?String(rt.message):String(rt),error:rt});if(!window.dispatchEvent(Yt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",rt);return}console.error(rt)},Cn={map:oi,forEach:function(rt,Yt,ai){oi(rt,function(){Yt.apply(this,arguments)},ai)},count:function(rt){var Yt=0;return oi(rt,function(){Yt++}),Yt},toArray:function(rt){return oi(rt,function(Yt){return Yt})||[]},only:function(rt){if(!nt(rt))throw Error("React.Children.only expected to receive a single React element child.");return rt}};return vr.Activity=ce,vr.Children=Cn,vr.Component=Pt,vr.Fragment=l,vr.Profiler=b,vr.PureComponent=Gt,vr.StrictMode=p,vr.Suspense=G,vr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=qe,vr.__COMPILER_RUNTIME={__proto__:null,c:function(rt){return qe.H.useMemoCache(rt)}},vr.cache=function(rt){return function(){return rt.apply(null,arguments)}},vr.cacheSignal=function(){return null},vr.cloneElement=function(rt,Yt,ai){if(rt==null)throw Error("The argument must be a React element, but you passed "+rt+".");var _i=it({},rt.props),ln=rt.key;if(Yt!=null)for(kn in Yt.key!==void 0&&(ln=""+Yt.key),Yt)!Oe.call(Yt,kn)||kn==="key"||kn==="__self"||kn==="__source"||kn==="ref"&&Yt.ref===void 0||(_i[kn]=Yt[kn]);var kn=arguments.length-2;if(kn===1)_i.children=ai;else if(1<kn){for(var Jn=Array(kn),Mr=0;Mr<kn;Mr++)Jn[Mr]=arguments[Mr+2];_i.children=Jn}return je(rt.type,ln,_i)},vr.createContext=function(rt){return rt={$$typeof:P,_currentValue:rt,_currentValue2:rt,_threadCount:0,Provider:null,Consumer:null},rt.Provider=rt,rt.Consumer={$$typeof:I,_context:rt},rt},vr.createElement=function(rt,Yt,ai){var _i,ln={},kn=null;if(Yt!=null)for(_i in Yt.key!==void 0&&(kn=""+Yt.key),Yt)Oe.call(Yt,_i)&&_i!=="key"&&_i!=="__self"&&_i!=="__source"&&(ln[_i]=Yt[_i]);var Jn=arguments.length-2;if(Jn===1)ln.children=ai;else if(1<Jn){for(var Mr=Array(Jn),Ki=0;Ki<Jn;Ki++)Mr[Ki]=arguments[Ki+2];ln.children=Mr}if(rt&&rt.defaultProps)for(_i in Jn=rt.defaultProps,Jn)ln[_i]===void 0&&(ln[_i]=Jn[_i]);return je(rt,kn,ln)},vr.createRef=function(){return{current:null}},vr.forwardRef=function(rt){return{$$typeof:s,render:rt}},vr.isValidElement=nt,vr.lazy=function(rt){return{$$typeof:ie,_payload:{_status:-1,_result:rt},_init:wi}},vr.memo=function(rt,Yt){return{$$typeof:q,type:rt,compare:Yt===void 0?null:Yt}},vr.startTransition=function(rt){var Yt=qe.T,ai={};qe.T=ai;try{var _i=rt(),ln=qe.S;ln!==null&&ln(ai,_i),typeof _i=="object"&&_i!==null&&typeof _i.then=="function"&&_i.then(Si,bn)}catch(kn){bn(kn)}finally{Yt!==null&&ai.types!==null&&(Yt.types=ai.types),qe.T=Yt}},vr.unstable_useCacheRefresh=function(){return qe.H.useCacheRefresh()},vr.use=function(rt){return qe.H.use(rt)},vr.useActionState=function(rt,Yt,ai){return qe.H.useActionState(rt,Yt,ai)},vr.useCallback=function(rt,Yt){return qe.H.useCallback(rt,Yt)},vr.useContext=function(rt){return qe.H.useContext(rt)},vr.useDebugValue=function(){},vr.useDeferredValue=function(rt,Yt){return qe.H.useDeferredValue(rt,Yt)},vr.useEffect=function(rt,Yt){return qe.H.useEffect(rt,Yt)},vr.useEffectEvent=function(rt){return qe.H.useEffectEvent(rt)},vr.useId=function(){return qe.H.useId()},vr.useImperativeHandle=function(rt,Yt,ai){return qe.H.useImperativeHandle(rt,Yt,ai)},vr.useInsertionEffect=function(rt,Yt){return qe.H.useInsertionEffect(rt,Yt)},vr.useLayoutEffect=function(rt,Yt){return qe.H.useLayoutEffect(rt,Yt)},vr.useMemo=function(rt,Yt){return qe.H.useMemo(rt,Yt)},vr.useOptimistic=function(rt,Yt){return qe.H.useOptimistic(rt,Yt)},vr.useReducer=function(rt,Yt,ai){return qe.H.useReducer(rt,Yt,ai)},vr.useRef=function(rt){return qe.H.useRef(rt)},vr.useState=function(rt){return qe.H.useState(rt)},vr.useSyncExternalStore=function(rt,Yt,ai){return qe.H.useSyncExternalStore(rt,Yt,ai)},vr.useTransition=function(){return qe.H.useTransition()},vr.version="19.2.0",vr}var P2;function pE(){return P2||(P2=1,Yw.exports=H3()),Yw.exports}var ve=pE();const zl=N0(ve);var Qw={exports:{}},l0={},Jw={exports:{}},eT={};var O2;function $3(){return O2||(O2=1,(function(c){function n(Ct,oi){var wi=Ct.length;Ct.push(oi);e:for(;0<wi;){var bn=wi-1>>>1,Cn=Ct[bn];if(0<b(Cn,oi))Ct[bn]=oi,Ct[wi]=Cn,wi=bn;else break e}}function l(Ct){return Ct.length===0?null:Ct[0]}function p(Ct){if(Ct.length===0)return null;var oi=Ct[0],wi=Ct.pop();if(wi!==oi){Ct[0]=wi;e:for(var bn=0,Cn=Ct.length,rt=Cn>>>1;bn<rt;){var Yt=2*(bn+1)-1,ai=Ct[Yt],_i=Yt+1,ln=Ct[_i];if(0>b(ai,wi))_i<Cn&&0>b(ln,ai)?(Ct[bn]=ln,Ct[_i]=wi,bn=_i):(Ct[bn]=ai,Ct[Yt]=wi,bn=Yt);else if(_i<Cn&&0>b(ln,wi))Ct[bn]=ln,Ct[_i]=wi,bn=_i;else break e}}return oi}function b(Ct,oi){var wi=Ct.sortIndex-oi.sortIndex;return wi!==0?wi:Ct.id-oi.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var I=performance;c.unstable_now=function(){return I.now()}}else{var P=Date,s=P.now();c.unstable_now=function(){return P.now()-s}}var G=[],q=[],ie=1,ce=null,be=3,He=!1,Je=!1,it=!1,Ze=!1,Pt=typeof setTimeout=="function"?setTimeout:null,ct=typeof clearTimeout=="function"?clearTimeout:null,Gt=typeof setImmediate<"u"?setImmediate:null;function ei(Ct){for(var oi=l(q);oi!==null;){if(oi.callback===null)p(q);else if(oi.startTime<=Ct)p(q),oi.sortIndex=oi.expirationTime,n(G,oi);else break;oi=l(q)}}function Fi(Ct){if(it=!1,ei(Ct),!Je)if(l(G)!==null)Je=!0,Si||(Si=!0,yt());else{var oi=l(q);oi!==null&&qn(Fi,oi.startTime-Ct)}}var Si=!1,qe=-1,Oe=5,je=-1;function tt(){return Ze?!0:!(c.unstable_now()-je<Oe)}function nt(){if(Ze=!1,Si){var Ct=c.unstable_now();je=Ct;var oi=!0;try{e:{Je=!1,it&&(it=!1,ct(qe),qe=-1),He=!0;var wi=be;try{t:{for(ei(Ct),ce=l(G);ce!==null&&!(ce.expirationTime>Ct&&tt());){var bn=ce.callback;if(typeof bn=="function"){ce.callback=null,be=ce.priorityLevel;var Cn=bn(ce.expirationTime<=Ct);if(Ct=c.unstable_now(),typeof Cn=="function"){ce.callback=Cn,ei(Ct),oi=!0;break t}ce===l(G)&&p(G),ei(Ct)}else p(G);ce=l(G)}if(ce!==null)oi=!0;else{var rt=l(q);rt!==null&&qn(Fi,rt.startTime-Ct),oi=!1}}break e}finally{ce=null,be=wi,He=!1}oi=void 0}}finally{oi?yt():Si=!1}}}var yt;if(typeof Gt=="function")yt=function(){Gt(nt)};else if(typeof MessageChannel<"u"){var ze=new MessageChannel,ur=ze.port2;ze.port1.onmessage=nt,yt=function(){ur.postMessage(null)}}else yt=function(){Pt(nt,0)};function qn(Ct,oi){qe=Pt(function(){Ct(c.unstable_now())},oi)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(Ct){Ct.callback=null},c.unstable_forceFrameRate=function(Ct){0>Ct||125<Ct?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Oe=0<Ct?Math.floor(1e3/Ct):5},c.unstable_getCurrentPriorityLevel=function(){return be},c.unstable_next=function(Ct){switch(be){case 1:case 2:case 3:var oi=3;break;default:oi=be}var wi=be;be=oi;try{return Ct()}finally{be=wi}},c.unstable_requestPaint=function(){Ze=!0},c.unstable_runWithPriority=function(Ct,oi){switch(Ct){case 1:case 2:case 3:case 4:case 5:break;default:Ct=3}var wi=be;be=Ct;try{return oi()}finally{be=wi}},c.unstable_scheduleCallback=function(Ct,oi,wi){var bn=c.unstable_now();switch(typeof wi=="object"&&wi!==null?(wi=wi.delay,wi=typeof wi=="number"&&0<wi?bn+wi:bn):wi=bn,Ct){case 1:var Cn=-1;break;case 2:Cn=250;break;case 5:Cn=1073741823;break;case 4:Cn=1e4;break;default:Cn=5e3}return Cn=wi+Cn,Ct={id:ie++,callback:oi,priorityLevel:Ct,startTime:wi,expirationTime:Cn,sortIndex:-1},wi>bn?(Ct.sortIndex=wi,n(q,Ct),l(G)===null&&Ct===l(q)&&(it?(ct(qe),qe=-1):it=!0,qn(Fi,wi-bn))):(Ct.sortIndex=Cn,n(G,Ct),Je||He||(Je=!0,Si||(Si=!0,yt()))),Ct},c.unstable_shouldYield=tt,c.unstable_wrapCallback=function(Ct){var oi=be;return function(){var wi=be;be=oi;try{return Ct.apply(this,arguments)}finally{be=wi}}}})(eT)),eT}var L2;function W3(){return L2||(L2=1,Jw.exports=$3()),Jw.exports}var tT={exports:{}},Rl={};var z2;function Z3(){if(z2)return Rl;z2=1;var c=pE();function n(G){var q="https://react.dev/errors/"+G;if(1<arguments.length){q+="?args[]="+encodeURIComponent(arguments[1]);for(var ie=2;ie<arguments.length;ie++)q+="&args[]="+encodeURIComponent(arguments[ie])}return"Minified React error #"+G+"; visit "+q+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(){}var p={d:{f:l,r:function(){throw Error(n(522))},D:l,C:l,L:l,m:l,X:l,S:l,M:l},p:0,findDOMNode:null},b=Symbol.for("react.portal");function I(G,q,ie){var ce=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:b,key:ce==null?null:""+ce,children:G,containerInfo:q,implementation:ie}}var P=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function s(G,q){if(G==="font")return"";if(typeof q=="string")return q==="use-credentials"?q:""}return Rl.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=p,Rl.createPortal=function(G,q){var ie=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!q||q.nodeType!==1&&q.nodeType!==9&&q.nodeType!==11)throw Error(n(299));return I(G,q,null,ie)},Rl.flushSync=function(G){var q=P.T,ie=p.p;try{if(P.T=null,p.p=2,G)return G()}finally{P.T=q,p.p=ie,p.d.f()}},Rl.preconnect=function(G,q){typeof G=="string"&&(q?(q=q.crossOrigin,q=typeof q=="string"?q==="use-credentials"?q:"":void 0):q=null,p.d.C(G,q))},Rl.prefetchDNS=function(G){typeof G=="string"&&p.d.D(G)},Rl.preinit=function(G,q){if(typeof G=="string"&&q&&typeof q.as=="string"){var ie=q.as,ce=s(ie,q.crossOrigin),be=typeof q.integrity=="string"?q.integrity:void 0,He=typeof q.fetchPriority=="string"?q.fetchPriority:void 0;ie==="style"?p.d.S(G,typeof q.precedence=="string"?q.precedence:void 0,{crossOrigin:ce,integrity:be,fetchPriority:He}):ie==="script"&&p.d.X(G,{crossOrigin:ce,integrity:be,fetchPriority:He,nonce:typeof q.nonce=="string"?q.nonce:void 0})}},Rl.preinitModule=function(G,q){if(typeof G=="string")if(typeof q=="object"&&q!==null){if(q.as==null||q.as==="script"){var ie=s(q.as,q.crossOrigin);p.d.M(G,{crossOrigin:ie,integrity:typeof q.integrity=="string"?q.integrity:void 0,nonce:typeof q.nonce=="string"?q.nonce:void 0})}}else q==null&&p.d.M(G)},Rl.preload=function(G,q){if(typeof G=="string"&&typeof q=="object"&&q!==null&&typeof q.as=="string"){var ie=q.as,ce=s(ie,q.crossOrigin);p.d.L(G,ie,{crossOrigin:ce,integrity:typeof q.integrity=="string"?q.integrity:void 0,nonce:typeof q.nonce=="string"?q.nonce:void 0,type:typeof q.type=="string"?q.type:void 0,fetchPriority:typeof q.fetchPriority=="string"?q.fetchPriority:void 0,referrerPolicy:typeof q.referrerPolicy=="string"?q.referrerPolicy:void 0,imageSrcSet:typeof q.imageSrcSet=="string"?q.imageSrcSet:void 0,imageSizes:typeof q.imageSizes=="string"?q.imageSizes:void 0,media:typeof q.media=="string"?q.media:void 0})}},Rl.preloadModule=function(G,q){if(typeof G=="string")if(q){var ie=s(q.as,q.crossOrigin);p.d.m(G,{as:typeof q.as=="string"&&q.as!=="script"?q.as:void 0,crossOrigin:ie,integrity:typeof q.integrity=="string"?q.integrity:void 0})}else p.d.m(G)},Rl.requestFormReset=function(G){p.d.r(G)},Rl.unstable_batchedUpdates=function(G,q){return G(q)},Rl.useFormState=function(G,q,ie){return P.H.useFormState(G,q,ie)},Rl.useFormStatus=function(){return P.H.useHostTransitionStatus()},Rl.version="19.2.0",Rl}var k2;function nM(){if(k2)return tT.exports;k2=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(n){console.error(n)}}return c(),tT.exports=Z3(),tT.exports}var F2;function X3(){if(F2)return l0;F2=1;var c=W3(),n=pE(),l=nM();function p(u){var g="https://react.dev/errors/"+u;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)g+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+u+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function b(u){return!(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)}function I(u){var g=u,w=u;if(u.alternate)for(;g.return;)g=g.return;else{u=g;do g=u,(g.flags&4098)!==0&&(w=g.return),u=g.return;while(u)}return g.tag===3?w:null}function P(u){if(u.tag===13){var g=u.memoizedState;if(g===null&&(u=u.alternate,u!==null&&(g=u.memoizedState)),g!==null)return g.dehydrated}return null}function s(u){if(u.tag===31){var g=u.memoizedState;if(g===null&&(u=u.alternate,u!==null&&(g=u.memoizedState)),g!==null)return g.dehydrated}return null}function G(u){if(I(u)!==u)throw Error(p(188))}function q(u){var g=u.alternate;if(!g){if(g=I(u),g===null)throw Error(p(188));return g!==u?null:u}for(var w=u,C=g;;){var F=w.return;if(F===null)break;var j=F.alternate;if(j===null){if(C=F.return,C!==null){w=C;continue}break}if(F.child===j.child){for(j=F.child;j;){if(j===w)return G(F),u;if(j===C)return G(F),g;j=j.sibling}throw Error(p(188))}if(w.return!==C.return)w=F,C=j;else{for(var se=!1,Ae=F.child;Ae;){if(Ae===w){se=!0,w=F,C=j;break}if(Ae===C){se=!0,C=F,w=j;break}Ae=Ae.sibling}if(!se){for(Ae=j.child;Ae;){if(Ae===w){se=!0,w=j,C=F;break}if(Ae===C){se=!0,C=j,w=F;break}Ae=Ae.sibling}if(!se)throw Error(p(189))}}if(w.alternate!==C)throw Error(p(190))}if(w.tag!==3)throw Error(p(188));return w.stateNode.current===w?u:g}function ie(u){var g=u.tag;if(g===5||g===26||g===27||g===6)return u;for(u=u.child;u!==null;){if(g=ie(u),g!==null)return g;u=u.sibling}return null}var ce=Object.assign,be=Symbol.for("react.element"),He=Symbol.for("react.transitional.element"),Je=Symbol.for("react.portal"),it=Symbol.for("react.fragment"),Ze=Symbol.for("react.strict_mode"),Pt=Symbol.for("react.profiler"),ct=Symbol.for("react.consumer"),Gt=Symbol.for("react.context"),ei=Symbol.for("react.forward_ref"),Fi=Symbol.for("react.suspense"),Si=Symbol.for("react.suspense_list"),qe=Symbol.for("react.memo"),Oe=Symbol.for("react.lazy"),je=Symbol.for("react.activity"),tt=Symbol.for("react.memo_cache_sentinel"),nt=Symbol.iterator;function yt(u){return u===null||typeof u!="object"?null:(u=nt&&u[nt]||u["@@iterator"],typeof u=="function"?u:null)}var ze=Symbol.for("react.client.reference");function ur(u){if(u==null)return null;if(typeof u=="function")return u.$$typeof===ze?null:u.displayName||u.name||null;if(typeof u=="string")return u;switch(u){case it:return"Fragment";case Pt:return"Profiler";case Ze:return"StrictMode";case Fi:return"Suspense";case Si:return"SuspenseList";case je:return"Activity"}if(typeof u=="object")switch(u.$$typeof){case Je:return"Portal";case Gt:return u.displayName||"Context";case ct:return(u._context.displayName||"Context")+".Consumer";case ei:var g=u.render;return u=u.displayName,u||(u=g.displayName||g.name||"",u=u!==""?"ForwardRef("+u+")":"ForwardRef"),u;case qe:return g=u.displayName||null,g!==null?g:ur(u.type)||"Memo";case Oe:g=u._payload,u=u._init;try{return ur(u(g))}catch{}}return null}var qn=Array.isArray,Ct=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oi=l.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,wi={pending:!1,data:null,method:null,action:null},bn=[],Cn=-1;function rt(u){return{current:u}}function Yt(u){0>Cn||(u.current=bn[Cn],bn[Cn]=null,Cn--)}function ai(u,g){Cn++,bn[Cn]=u.current,u.current=g}var _i=rt(null),ln=rt(null),kn=rt(null),Jn=rt(null);function Mr(u,g){switch(ai(kn,g),ai(ln,u),ai(_i,null),g.nodeType){case 9:case 11:u=(u=g.documentElement)&&(u=u.namespaceURI)?_v(u):0;break;default:if(u=g.tagName,g=g.namespaceURI)g=_v(g),u=cm(g,u);else switch(u){case"svg":u=1;break;case"math":u=2;break;default:u=0}}Yt(_i),ai(_i,u)}function Ki(){Yt(_i),Yt(ln),Yt(kn)}function hr(u){u.memoizedState!==null&&ai(Jn,u);var g=_i.current,w=cm(g,u.type);g!==w&&(ai(ln,u),ai(_i,w))}function Wr(u){ln.current===u&&(Yt(_i),Yt(ln)),Jn.current===u&&(Yt(Jn),Vg._currentValue=wi)}var co,nr;function ps(u){if(co===void 0)try{throw Error()}catch(w){var g=w.stack.trim().match(/\n( *(at )?)/);co=g&&g[1]||"",nr=-1<w.stack.indexOf(`
    at`)?" (<anonymous>)":-1<w.stack.indexOf("@")?"@unknown:0:0":""}return`
`+co+u+nr}var rr=!1;function Ds(u,g){if(!u||rr)return"";rr=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var C={DetermineComponentFrameRoot:function(){try{if(g){var hi=function(){throw Error()};if(Object.defineProperty(hi.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(hi,[])}catch(Zt){var Ut=Zt}Reflect.construct(u,[],hi)}else{try{hi.call()}catch(Zt){Ut=Zt}u.call(hi.prototype)}}else{try{throw Error()}catch(Zt){Ut=Zt}(hi=u())&&typeof hi.catch=="function"&&hi.catch(function(){})}}catch(Zt){if(Zt&&Ut&&typeof Zt.stack=="string")return[Zt.stack,Ut.stack]}return[null,null]}};C.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var F=Object.getOwnPropertyDescriptor(C.DetermineComponentFrameRoot,"name");F&&F.configurable&&Object.defineProperty(C.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var j=C.DetermineComponentFrameRoot(),se=j[0],Ae=j[1];if(se&&Ae){var Qe=se.split(`
`),Ft=Ae.split(`
`);for(F=C=0;C<Qe.length&&!Qe[C].includes("DetermineComponentFrameRoot");)C++;for(;F<Ft.length&&!Ft[F].includes("DetermineComponentFrameRoot");)F++;if(C===Qe.length||F===Ft.length)for(C=Qe.length-1,F=Ft.length-1;1<=C&&0<=F&&Qe[C]!==Ft[F];)F--;for(;1<=C&&0<=F;C--,F--)if(Qe[C]!==Ft[F]){if(C!==1||F!==1)do if(C--,F--,0>F||Qe[C]!==Ft[F]){var si=`
`+Qe[C].replace(" at new "," at ");return u.displayName&&si.includes("<anonymous>")&&(si=si.replace("<anonymous>",u.displayName)),si}while(1<=C&&0<=F);break}}}finally{rr=!1,Error.prepareStackTrace=w}return(w=u?u.displayName||u.name:"")?ps(w):""}function Us(u,g){switch(u.tag){case 26:case 27:case 5:return ps(u.type);case 16:return ps("Lazy");case 13:return u.child!==g&&g!==null?ps("Suspense Fallback"):ps("Suspense");case 19:return ps("SuspenseList");case 0:case 15:return Ds(u.type,!1);case 11:return Ds(u.type.render,!1);case 1:return Ds(u.type,!0);case 31:return ps("Activity");default:return""}}function Dr(u){try{var g="",w=null;do g+=Us(u,w),w=u,u=u.return;while(u);return g}catch(C){return`
Error generating stack: `+C.message+`
`+C.stack}}var ms=Object.prototype.hasOwnProperty,hs=c.unstable_scheduleCallback,Di=c.unstable_cancelCallback,rn=c.unstable_shouldYield,vn=c.unstable_requestPaint,$i=c.unstable_now,Ks=c.unstable_getCurrentPriorityLevel,Kn=c.unstable_ImmediatePriority,uo=c.unstable_UserBlockingPriority,Uo=c.unstable_NormalPriority,jo=c.unstable_LowPriority,ac=c.unstable_IdlePriority,$a=c.log,Nc=c.unstable_setDisableYieldValue,Yo=null,pr=null;function Co(u){if(typeof $a=="function"&&Nc(u),pr&&typeof pr.setStrictMode=="function")try{pr.setStrictMode(Yo,u)}catch{}}var Ts=Math.clz32?Math.clz32:ma,cl=Math.log,Qo=Math.LN2;function ma(u){return u>>>=0,u===0?32:31-(cl(u)/Qo|0)|0}var dr=256,Ps=262144,Es=4194304;function Go(u){var g=u&42;if(g!==0)return g;switch(u&-u){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return u&261888;case 262144:case 524288:case 1048576:case 2097152:return u&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return u&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return u}}function js(u,g,w){var C=u.pendingLanes;if(C===0)return 0;var F=0,j=u.suspendedLanes,se=u.pingedLanes;u=u.warmLanes;var Ae=C&134217727;return Ae!==0?(C=Ae&~j,C!==0?F=Go(C):(se&=Ae,se!==0?F=Go(se):w||(w=Ae&~u,w!==0&&(F=Go(w))))):(Ae=C&~j,Ae!==0?F=Go(Ae):se!==0?F=Go(se):w||(w=C&~u,w!==0&&(F=Go(w)))),F===0?0:g!==0&&g!==F&&(g&j)===0&&(j=F&-F,w=g&-g,j>=w||j===32&&(w&4194048)!==0)?g:F}function Ma(u,g){return(u.pendingLanes&~(u.suspendedLanes&~u.pingedLanes)&g)===0}function ih(u,g){switch(u){case 1:case 2:case 4:case 8:case 64:return g+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ad(){var u=Es;return Es<<=1,(Es&62914560)===0&&(Es=4194304),u}function ga(u){for(var g=[],w=0;31>w;w++)g.push(u);return g}function St(u,g){u.pendingLanes|=g,g!==268435456&&(u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0)}function Fl(u,g,w,C,F,j){var se=u.pendingLanes;u.pendingLanes=w,u.suspendedLanes=0,u.pingedLanes=0,u.warmLanes=0,u.expiredLanes&=w,u.entangledLanes&=w,u.errorRecoveryDisabledLanes&=w,u.shellSuspendCounter=0;var Ae=u.entanglements,Qe=u.expirationTimes,Ft=u.hiddenUpdates;for(w=se&~w;0<w;){var si=31-Ts(w),hi=1<<si;Ae[si]=0,Qe[si]=-1;var Ut=Ft[si];if(Ut!==null)for(Ft[si]=null,si=0;si<Ut.length;si++){var Zt=Ut[si];Zt!==null&&(Zt.lane&=-536870913)}w&=~hi}C!==0&&Bl(u,C,0),j!==0&&F===0&&u.tag!==0&&(u.suspendedLanes|=j&~(se&~g))}function Bl(u,g,w){u.pendingLanes|=g,u.suspendedLanes&=~g;var C=31-Ts(g);u.entangledLanes|=g,u.entanglements[C]=u.entanglements[C]|1073741824|w&261930}function Vc(u,g){var w=u.entangledLanes|=g;for(u=u.entanglements;w;){var C=31-Ts(w),F=1<<C;F&g|u[C]&g&&(u[C]|=g),w&=~F}}function gn(u,g){var w=g&-g;return w=(w&42)!==0?1:Ls(w),(w&(u.suspendedLanes|g))!==0?0:w}function Ls(u){switch(u){case 2:u=1;break;case 8:u=4;break;case 32:u=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:u=128;break;case 268435456:u=134217728;break;default:u=0}return u}function Nl(u){return u&=-u,2<u?8<u?(u&134217727)!==0?32:268435456:8:2}function _u(){var u=oi.p;return u!==0?u:(u=window.event,u===void 0?32:Rx(u.type))}function Ne(u,g){var w=oi.p;try{return oi.p=u,g()}finally{oi.p=w}}var Y=Math.random().toString(36).slice(2),J="__reactFiber$"+Y,de="__reactProps$"+Y,Re="__reactContainer$"+Y,Ce="__reactEvents$"+Y,Fe="__reactListeners$"+Y,Ye="__reactHandles$"+Y,Be="__reactResources$"+Y,We="__reactMarker$"+Y;function Ot(u){delete u[J],delete u[de],delete u[Ce],delete u[Fe],delete u[Ye]}function xt(u){var g=u[J];if(g)return g;for(var w=u.parentNode;w;){if(g=w[Re]||w[J]){if(w=g.alternate,g.child!==null||w!==null&&w.child!==null)for(u=bv(u);u!==null;){if(w=u[J])return w;u=bv(u)}return g}u=w,w=u.parentNode}return null}function ui(u){if(u=u[J]||u[Re]){var g=u.tag;if(g===5||g===6||g===13||g===31||g===26||g===27||g===3)return u}return null}function Ii(u){var g=u.tag;if(g===5||g===26||g===27||g===6)return u.stateNode;throw Error(p(33))}function Ci(u){var g=u[Be];return g||(g=u[Be]={hoistableStyles:new Map,hoistableScripts:new Map}),g}function gi(u){u[We]=!0}var en=new Set,sn={};function Rn(u,g){mr(u,g),mr(u+"Capture",g)}function mr(u,g){for(sn[u]=g,u=0;u<g.length;u++)en.add(g[u])}var ds=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Zr={},Gr={};function Hn(u){return ms.call(Gr,u)?!0:ms.call(Zr,u)?!1:ds.test(u)?Gr[u]=!0:(Zr[u]=!0,!1)}function dn(u,g,w){if(Hn(g))if(w===null)u.removeAttribute(g);else{switch(typeof w){case"undefined":case"function":case"symbol":u.removeAttribute(g);return;case"boolean":var C=g.toLowerCase().slice(0,5);if(C!=="data-"&&C!=="aria-"){u.removeAttribute(g);return}}u.setAttribute(g,""+w)}}function jn(u,g,w){if(w===null)u.removeAttribute(g);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(g);return}u.setAttribute(g,""+w)}}function Pn(u,g,w,C){if(C===null)u.removeAttribute(w);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":u.removeAttribute(w);return}u.setAttributeNS(g,w,""+C)}}function fn(u){switch(typeof u){case"bigint":case"boolean":case"number":case"string":case"undefined":return u;case"object":return u;default:return""}}function or(u){var g=u.type;return(u=u.nodeName)&&u.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function bs(u,g,w){var C=Object.getOwnPropertyDescriptor(u.constructor.prototype,g);if(!u.hasOwnProperty(g)&&typeof C<"u"&&typeof C.get=="function"&&typeof C.set=="function"){var F=C.get,j=C.set;return Object.defineProperty(u,g,{configurable:!0,get:function(){return F.call(this)},set:function(se){w=""+se,j.call(this,se)}}),Object.defineProperty(u,g,{enumerable:C.enumerable}),{getValue:function(){return w},setValue:function(se){w=""+se},stopTracking:function(){u._valueTracker=null,delete u[g]}}}}function er(u){if(!u._valueTracker){var g=or(u)?"checked":"value";u._valueTracker=bs(u,g,""+u[g])}}function Ro(u){if(!u)return!1;var g=u._valueTracker;if(!g)return!0;var w=g.getValue(),C="";return u&&(C=or(u)?u.checked?"true":"false":u.value),u=C,u!==w?(g.setValue(u),!0):!1}function Jo(u){if(u=u||(typeof document<"u"?document:void 0),typeof u>"u")return null;try{return u.activeElement||u.body}catch{return u.body}}var gs=/[\n"\\]/g;function Ms(u){return u.replace(gs,function(g){return"\\"+g.charCodeAt(0).toString(16)+" "})}function Ys(u,g,w,C,F,j,se,Ae){u.name="",se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"?u.type=se:u.removeAttribute("type"),g!=null?se==="number"?(g===0&&u.value===""||u.value!=g)&&(u.value=""+fn(g)):u.value!==""+fn(g)&&(u.value=""+fn(g)):se!=="submit"&&se!=="reset"||u.removeAttribute("value"),g!=null?Mo(u,se,fn(g)):w!=null?Mo(u,se,fn(w)):C!=null&&u.removeAttribute("value"),F==null&&j!=null&&(u.defaultChecked=!!j),F!=null&&(u.checked=F&&typeof F!="function"&&typeof F!="symbol"),Ae!=null&&typeof Ae!="function"&&typeof Ae!="symbol"&&typeof Ae!="boolean"?u.name=""+fn(Ae):u.removeAttribute("name")}function Da(u,g,w,C,F,j,se,Ae){if(j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(u.type=j),g!=null||w!=null){if(!(j!=="submit"&&j!=="reset"||g!=null)){er(u);return}w=w!=null?""+fn(w):"",g=g!=null?""+fn(g):w,Ae||g===u.value||(u.value=g),u.defaultValue=g}C=C??F,C=typeof C!="function"&&typeof C!="symbol"&&!!C,u.checked=Ae?u.checked:!!C,u.defaultChecked=!!C,se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"&&(u.name=se),er(u)}function Mo(u,g,w){g==="number"&&Jo(u.ownerDocument)===u||u.defaultValue===""+w||(u.defaultValue=""+w)}function Qs(u,g,w,C){if(u=u.options,g){g={};for(var F=0;F<w.length;F++)g["$"+w[F]]=!0;for(w=0;w<u.length;w++)F=g.hasOwnProperty("$"+u[w].value),u[w].selected!==F&&(u[w].selected=F),F&&C&&(u[w].defaultSelected=!0)}else{for(w=""+fn(w),g=null,F=0;F<u.length;F++){if(u[F].value===w){u[F].selected=!0,C&&(u[F].defaultSelected=!0);return}g!==null||u[F].disabled||(g=u[F])}g!==null&&(g.selected=!0)}}function nh(u,g,w){if(g!=null&&(g=""+fn(g),g!==u.value&&(u.value=g),w==null)){u.defaultValue!==g&&(u.defaultValue=g);return}u.defaultValue=w!=null?""+fn(w):""}function ul(u,g,w,C){if(g==null){if(C!=null){if(w!=null)throw Error(p(92));if(qn(C)){if(1<C.length)throw Error(p(93));C=C[0]}w=C}w==null&&(w=""),g=w}w=fn(g),u.defaultValue=w,C=u.textContent,C===w&&C!==""&&C!==null&&(u.value=C),er(u)}function Do(u,g){if(g){var w=u.firstChild;if(w&&w===u.lastChild&&w.nodeType===3){w.nodeValue=g;return}}u.textContent=g}var yu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function bo(u,g,w){var C=g.indexOf("--")===0;w==null||typeof w=="boolean"||w===""?C?u.setProperty(g,""):g==="float"?u.cssFloat="":u[g]="":C?u.setProperty(g,w):typeof w!="number"||w===0||yu.has(g)?g==="float"?u.cssFloat=w:u[g]=(""+w).trim():u[g]=w+"px"}function _a(u,g,w){if(g!=null&&typeof g!="object")throw Error(p(62));if(u=u.style,w!=null){for(var C in w)!w.hasOwnProperty(C)||g!=null&&g.hasOwnProperty(C)||(C.indexOf("--")===0?u.setProperty(C,""):C==="float"?u.cssFloat="":u[C]="");for(var F in g)C=g[F],g.hasOwnProperty(F)&&w[F]!==C&&bo(u,F,C)}else for(var j in g)g.hasOwnProperty(j)&&bo(u,j,g[j])}function Js(u){if(u.indexOf("-")===-1)return!1;switch(u){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ea=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ta=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function hl(u){return ta.test(""+u)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":u}function Pa(){}var vu=null;function eo(u){return u=u.target||u.srcElement||window,u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===3?u.parentNode:u}var ya=null,dl=null;function xu(u){var g=ui(u);if(g&&(u=g.stateNode)){var w=u[de]||null;e:switch(u=g.stateNode,g.type){case"input":if(Ys(u,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name),g=w.name,w.type==="radio"&&g!=null){for(w=u;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll('input[name="'+Ms(""+g)+'"][type="radio"]'),g=0;g<w.length;g++){var C=w[g];if(C!==u&&C.form===u.form){var F=C[de]||null;if(!F)throw Error(p(90));Ys(C,F.value,F.defaultValue,F.defaultValue,F.checked,F.defaultChecked,F.type,F.name)}}for(g=0;g<w.length;g++)C=w[g],C.form===u.form&&Ro(C)}break e;case"textarea":nh(u,w.value,w.defaultValue);break e;case"select":g=w.value,g!=null&&Qs(u,!!w.multiple,g,!1)}}}var qo=!1;function lc(u,g,w){if(qo)return u(g,w);qo=!0;try{var C=u(g);return C}finally{if(qo=!1,(ya!==null||dl!==null)&&(Jr(),ya&&(g=ya,u=dl,dl=ya=null,xu(g),u)))for(g=0;g<u.length;g++)xu(u[g])}}function Ho(u,g){var w=u.stateNode;if(w===null)return null;var C=w[de]||null;if(C===null)return null;w=C[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(u=u.type,C=!(u==="button"||u==="input"||u==="select"||u==="textarea")),u=!C;break e;default:u=!1}if(u)return null;if(w&&typeof w!="function")throw Error(p(231,g,typeof w));return w}var Po=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uc=!1;if(Po)try{var Xr={};Object.defineProperty(Xr,"passive",{get:function(){Uc=!0}}),window.addEventListener("test",Xr,Xr),window.removeEventListener("test",Xr,Xr)}catch{Uc=!1}var va=null,Mn=null,jc=null;function Gc(){if(jc)return jc;var u,g=Mn,w=g.length,C,F="value"in va?va.value:va.textContent,j=F.length;for(u=0;u<w&&g[u]===F[u];u++);var se=w-u;for(C=1;C<=se&&g[w-C]===F[j-C];C++);return jc=F.slice(u,1<C?1-C:void 0)}function Vl(u){var g=u.keyCode;return"charCode"in u?(u=u.charCode,u===0&&g===13&&(u=13)):u=g,u===10&&(u=13),32<=u||u===13?u:0}function Ul(){return!0}function xa(){return!1}function to(u){function g(w,C,F,j,se){this._reactName=w,this._targetInst=F,this.type=C,this.nativeEvent=j,this.target=se,this.currentTarget=null;for(var Ae in u)u.hasOwnProperty(Ae)&&(w=u[Ae],this[Ae]=w?w(j):j[Ae]);return this.isDefaultPrevented=(j.defaultPrevented!=null?j.defaultPrevented:j.returnValue===!1)?Ul:xa,this.isPropagationStopped=xa,this}return ce(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=Ul)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=Ul)},persist:function(){},isPersistent:Ul}),g}var Wa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(u){return u.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ia=to(Wa),qc=ce({},Wa,{view:0,detail:0}),bu=to(qc),wu,cc,Gs,uc=ce({},qc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:wo,button:0,buttons:0,relatedTarget:function(u){return u.relatedTarget===void 0?u.fromElement===u.srcElement?u.toElement:u.fromElement:u.relatedTarget},movementX:function(u){return"movementX"in u?u.movementX:(u!==Gs&&(Gs&&u.type==="mousemove"?(wu=u.screenX-Gs.screenX,cc=u.screenY-Gs.screenY):cc=wu=0,Gs=u),wu)},movementY:function(u){return"movementY"in u?u.movementY:cc}}),hc=to(uc),jl=ce({},uc,{dataTransfer:0}),fl=to(jl),Ss=ce({},qc,{relatedTarget:0}),Hc=to(Ss),rh=ce({},Wa,{animationName:0,elapsedTime:0,pseudoElement:0}),ld=to(rh),On=ce({},Wa,{clipboardData:function(u){return"clipboardData"in u?u.clipboardData:window.clipboardData}}),cd=to(On),lf=ce({},Wa,{data:0}),Gl=to(lf),Oi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Tu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ba(u){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(u):(u=pl[u])?!!g[u]:!1}function wo(){return ba}var ho=ce({},qc,{key:function(u){if(u.key){var g=Oi[u.key]||u.key;if(g!=="Unidentified")return g}return u.type==="keypress"?(u=Vl(u),u===13?"Enter":String.fromCharCode(u)):u.type==="keydown"||u.type==="keyup"?Tu[u.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:wo,charCode:function(u){return u.type==="keypress"?Vl(u):0},keyCode:function(u){return u.type==="keydown"||u.type==="keyup"?u.keyCode:0},which:function(u){return u.type==="keypress"?Vl(u):u.type==="keydown"||u.type==="keyup"?u.keyCode:0}}),xi=to(ho),An=ce({},uc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xn=to(An),z=ce({},qc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:wo}),Q=to(z),oe=ce({},Wa,{propertyName:0,elapsedTime:0,pseudoElement:0}),De=to(oe),Rt=ce({},uc,{deltaX:function(u){return"deltaX"in u?u.deltaX:"wheelDeltaX"in u?-u.wheelDeltaX:0},deltaY:function(u){return"deltaY"in u?u.deltaY:"wheelDeltaY"in u?-u.wheelDeltaY:"wheelDelta"in u?-u.wheelDelta:0},deltaZ:0,deltaMode:0}),qt=to(Rt),Ti=ce({},Wa,{newState:0,oldState:0}),on=to(Ti),io=[9,13,27,32],Pr=Po&&"CompositionEvent"in window,As=null;Po&&"documentMode"in document&&(As=document.documentMode);var na=Po&&"TextEvent"in window&&!As,Za=Po&&(!Pr||As&&8<As&&11>=As),Xa=" ",wa=!1;function ws(u,g){switch(u){case"keyup":return io.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Oa(u){return u=u.detail,typeof u=="object"&&"data"in u?u.data:null}var fo=!1;function vp(u,g){switch(u){case"compositionend":return Oa(g);case"keypress":return g.which!==32?null:(wa=!0,Xa);case"textInput":return u=g.data,u===Xa&&wa?null:u;default:return null}}function ud(u,g){if(fo)return u==="compositionend"||!Pr&&ws(u,g)?(u=Gc(),jc=Mn=va=null,fo=!1,u):null;switch(u){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Za&&g.locale!=="ko"?null:g.data;default:return null}}var qs={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ql(u){var g=u&&u.nodeName&&u.nodeName.toLowerCase();return g==="input"?!!qs[u.type]:g==="textarea"}function dc(u,g,w,C){ya?dl?dl.push(C):dl=[C]:ya=C,g=$_(g,"onChange"),0<g.length&&(w=new ia("onChange","change",null,w,C),u.push({event:w,listeners:g}))}var Kr=null,Xi=null;function pi(u){fv(u,0)}function fc(u){var g=Ii(u);if(Ro(g))return u}function Ui(u,g){if(u==="change")return g}var sh=!1;if(Po){var hd;if(Po){var Li="oninput"in document;if(!Li){var dd=document.createElement("div");dd.setAttribute("oninput","return;"),Li=typeof dd.oninput=="function"}hd=Li}else hd=!1;sh=hd&&(!document.documentMode||9<document.documentMode)}function cf(){Kr&&(Kr.detachEvent("onpropertychange",eg),Xi=Kr=null)}function eg(u){if(u.propertyName==="value"&&fc(Xi)){var g=[];dc(g,Xi,u,eo(u)),lc(pi,g)}}function pc(u,g,w){u==="focusin"?(cf(),Kr=g,Xi=w,Kr.attachEvent("onpropertychange",eg)):u==="focusout"&&cf()}function xp(u){if(u==="selectionchange"||u==="keyup"||u==="keydown")return fc(Xi)}function po(u,g){if(u==="click")return fc(g)}function $o(u,g){if(u==="input"||u==="change")return fc(g)}function oh(u,g){return u===g&&(u!==0||1/u===1/g)||u!==u&&g!==g}var Oo=typeof Object.is=="function"?Object.is:oh;function Ka(u,g){if(Oo(u,g))return!0;if(typeof u!="object"||u===null||typeof g!="object"||g===null)return!1;var w=Object.keys(u),C=Object.keys(g);if(w.length!==C.length)return!1;for(C=0;C<w.length;C++){var F=w[C];if(!ms.call(g,F)||!Oo(u[F],g[F]))return!1}return!0}function no(u){for(;u&&u.firstChild;)u=u.firstChild;return u}function E_(u,g){var w=no(u);u=0;for(var C;w;){if(w.nodeType===3){if(C=u+w.textContent.length,u<=g&&C>=g)return{node:w,offset:g-u};u=C}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=no(w)}}function S_(u,g){return u&&g?u===g?!0:u&&u.nodeType===3?!1:g&&g.nodeType===3?S_(u,g.parentNode):"contains"in u?u.contains(g):u.compareDocumentPosition?!!(u.compareDocumentPosition(g)&16):!1:!1}function fd(u){u=u!=null&&u.ownerDocument!=null&&u.ownerDocument.defaultView!=null?u.ownerDocument.defaultView:window;for(var g=Jo(u.document);g instanceof u.HTMLIFrameElement;){try{var w=typeof g.contentWindow.location.href=="string"}catch{w=!1}if(w)u=g.contentWindow;else break;g=Jo(u.document)}return g}function mc(u){var g=u&&u.nodeName&&u.nodeName.toLowerCase();return g&&(g==="input"&&(u.type==="text"||u.type==="search"||u.type==="tel"||u.type==="url"||u.type==="password")||g==="textarea"||u.contentEditable==="true")}var A_=Po&&"documentMode"in document&&11>=document.documentMode,Wo=null,bp=null,Eu=null,ah=!1;function $c(u,g,w){var C=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;ah||Wo==null||Wo!==Jo(C)||(C=Wo,"selectionStart"in C&&mc(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),Eu&&Ka(Eu,C)||(Eu=C,C=$_(bp,"onSelect"),0<C.length&&(g=new ia("onSelect","select",null,g,w),u.push({event:g,listeners:C}),g.target=Wo)))}function lh(u,g){var w={};return w[u.toLowerCase()]=g.toLowerCase(),w["Webkit"+u]="webkit"+g,w["Moz"+u]="moz"+g,w}var ch={animationend:lh("Animation","AnimationEnd"),animationiteration:lh("Animation","AnimationIteration"),animationstart:lh("Animation","AnimationStart"),transitionrun:lh("Transition","TransitionRun"),transitionstart:lh("Transition","TransitionStart"),transitioncancel:lh("Transition","TransitionCancel"),transitionend:lh("Transition","TransitionEnd")},tg={},Wc={};Po&&(Wc=document.createElement("div").style,"AnimationEvent"in window||(delete ch.animationend.animation,delete ch.animationiteration.animation,delete ch.animationstart.animation),"TransitionEvent"in window||delete ch.transitionend.transition);function uh(u){if(tg[u])return tg[u];if(!ch[u])return u;var g=ch[u],w;for(w in g)if(g.hasOwnProperty(w)&&w in Wc)return tg[u]=g[w];return u}var wp=uh("animationend"),uf=uh("animationiteration"),Tp=uh("animationstart"),ig=uh("transitionrun"),ml=uh("transitionstart"),hh=uh("transitioncancel"),pd=uh("transitionend"),Ep=new Map,hf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");hf.push("scrollEnd");function ra(u,g){Ep.set(u,g),Rn(g,[u])}var Zc=typeof reportError=="function"?reportError:function(u){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var g=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof u=="object"&&u!==null&&typeof u.message=="string"?String(u.message):String(u),error:u});if(!window.dispatchEvent(g))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",u);return}console.error(u)},La=[],Xc=0,Ta=0;function dh(){for(var u=Xc,g=Ta=Xc=0;g<u;){var w=La[g];La[g++]=null;var C=La[g];La[g++]=null;var F=La[g];La[g++]=null;var j=La[g];if(La[g++]=null,C!==null&&F!==null){var se=C.pending;se===null?F.next=F:(F.next=se.next,se.next=F),C.pending=F}j!==0&&fh(w,F,j)}}function Nt(u,g,w,C){La[Xc++]=u,La[Xc++]=g,La[Xc++]=w,La[Xc++]=C,Ta|=C,u.lanes|=C,u=u.alternate,u!==null&&(u.lanes|=C)}function df(u,g,w,C){return Nt(u,g,w,C),Su(u)}function gl(u,g){return Nt(u,null,null,g),Su(u)}function fh(u,g,w){u.lanes|=w;var C=u.alternate;C!==null&&(C.lanes|=w);for(var F=!1,j=u.return;j!==null;)j.childLanes|=w,C=j.alternate,C!==null&&(C.childLanes|=w),j.tag===22&&(u=j.stateNode,u===null||u._visibility&1||(F=!0)),u=j,j=j.return;return u.tag===3?(j=u.stateNode,F&&g!==null&&(F=31-Ts(w),u=j.hiddenUpdates,C=u[F],C===null?u[F]=[g]:C.push(g),g.lane=w|536870912),j):null}function Su(u){if(50<_o)throw _o=0,so=null,Error(p(185));for(var g=u.return;g!==null;)u=g,g=u.return;return u.tag===3?u.stateNode:null}var gc={};function _c(u,g,w,C){this.tag=u,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sa(u,g,w,C){return new _c(u,g,w,C)}function za(u){return u=u.prototype,!(!u||!u.isReactComponent)}function an(u,g){var w=u.alternate;return w===null?(w=sa(u.tag,g,u.key,u.mode),w.elementType=u.elementType,w.type=u.type,w.stateNode=u.stateNode,w.alternate=u,u.alternate=w):(w.pendingProps=g,w.type=u.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=u.flags&65011712,w.childLanes=u.childLanes,w.lanes=u.lanes,w.child=u.child,w.memoizedProps=u.memoizedProps,w.memoizedState=u.memoizedState,w.updateQueue=u.updateQueue,g=u.dependencies,w.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},w.sibling=u.sibling,w.index=u.index,w.ref=u.ref,w.refCleanup=u.refCleanup,w}function ph(u,g){u.flags&=65011714;var w=u.alternate;return w===null?(u.childLanes=0,u.lanes=g,u.child=null,u.subtreeFlags=0,u.memoizedProps=null,u.memoizedState=null,u.updateQueue=null,u.dependencies=null,u.stateNode=null):(u.childLanes=w.childLanes,u.lanes=w.lanes,u.child=w.child,u.subtreeFlags=0,u.deletions=null,u.memoizedProps=w.memoizedProps,u.memoizedState=w.memoizedState,u.updateQueue=w.updateQueue,u.type=w.type,g=w.dependencies,u.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext}),u}function Sp(u,g,w,C,F,j){var se=0;if(C=u,typeof u=="function")za(u)&&(se=1);else if(typeof u=="string")se=ew(u,w,_i.current)?26:u==="html"||u==="head"||u==="body"?27:5;else e:switch(u){case je:return u=sa(31,w,g,F),u.elementType=je,u.lanes=j,u;case it:return mh(w.children,F,j,g);case Ze:se=8,F|=24;break;case Pt:return u=sa(12,w,g,F|2),u.elementType=Pt,u.lanes=j,u;case Fi:return u=sa(13,w,g,F),u.elementType=Fi,u.lanes=j,u;case Si:return u=sa(19,w,g,F),u.elementType=Si,u.lanes=j,u;default:if(typeof u=="object"&&u!==null)switch(u.$$typeof){case Gt:se=10;break e;case ct:se=9;break e;case ei:se=11;break e;case qe:se=14;break e;case Oe:se=16,C=null;break e}se=29,w=Error(p(130,u===null?"null":typeof u,"")),C=null}return g=sa(se,w,g,F),g.elementType=u,g.type=C,g.lanes=j,g}function mh(u,g,w,C){return u=sa(7,u,C,g),u.lanes=w,u}function md(u,g,w){return u=sa(6,u,null,g),u.lanes=w,u}function I_(u){var g=sa(18,null,null,0);return g.stateNode=u,g}function Or(u,g,w){return g=sa(4,u.children!==null?u.children:[],u.key,g),g.lanes=w,g.stateNode={containerInfo:u.containerInfo,pendingChildren:null,implementation:u.implementation},g}var ng=new WeakMap;function ka(u,g){if(typeof u=="object"&&u!==null){var w=ng.get(u);return w!==void 0?w:(g={value:u,source:g,stack:Dr(g)},ng.set(u,g),g)}return{value:u,source:g,stack:Dr(g)}}var gd=[],_d=0,Ap=null,ff=0,Ya=[],_l=0,Hl=null,yc=1,$l="";function Wl(u,g){gd[_d++]=ff,gd[_d++]=Ap,Ap=u,ff=g}function pf(u,g,w){Ya[_l++]=yc,Ya[_l++]=$l,Ya[_l++]=Hl,Hl=u;var C=yc;u=$l;var F=32-Ts(C)-1;C&=~(1<<F),w+=1;var j=32-Ts(g)+F;if(30<j){var se=F-F%5;j=(C&(1<<se)-1).toString(32),C>>=se,F-=se,yc=1<<32-Ts(g)+F|w<<F|C,$l=j+u}else yc=1<<j|w<<F|C,$l=u}function mf(u){u.return!==null&&(Wl(u,1),pf(u,1,0))}function Kc(u){for(;u===Ap;)Ap=gd[--_d],gd[_d]=null,ff=gd[--_d],gd[_d]=null;for(;u===Hl;)Hl=Ya[--_l],Ya[_l]=null,$l=Ya[--_l],Ya[_l]=null,yc=Ya[--_l],Ya[_l]=null}function gh(u,g){Ya[_l++]=yc,Ya[_l++]=$l,Ya[_l++]=Hl,yc=g.id,$l=g.overflow,Hl=u}var ro=null,os=null,Ir=!1,vc=null,Qa=!1,Au=Error(p(519));function Zl(u){var g=Error(p(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw yd(ka(g,u)),Au}function gf(u){var g=u.stateNode,w=u.type,C=u.memoizedProps;switch(g[J]=u,g[de]=C,w){case"dialog":Rr("cancel",g),Rr("close",g);break;case"iframe":case"object":case"embed":Rr("load",g);break;case"video":case"audio":for(w=0;w<om.length;w++)Rr(om[w],g);break;case"source":Rr("error",g);break;case"img":case"image":case"link":Rr("error",g),Rr("load",g);break;case"details":Rr("toggle",g);break;case"input":Rr("invalid",g),Da(g,C.value,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name,!0);break;case"select":Rr("invalid",g);break;case"textarea":Rr("invalid",g),ul(g,C.value,C.defaultValue,C.children)}w=C.children,typeof w!="string"&&typeof w!="number"&&typeof w!="bigint"||g.textContent===""+w||C.suppressHydrationWarning===!0||lm(g.textContent,w)?(C.popover!=null&&(Rr("beforetoggle",g),Rr("toggle",g)),C.onScroll!=null&&Rr("scroll",g),C.onScrollEnd!=null&&Rr("scrollend",g),C.onClick!=null&&(g.onclick=Pa),g=!0):g=!1,g||Zl(u,!0)}function Ip(u){for(ro=u.return;ro;)switch(ro.tag){case 5:case 31:case 13:Qa=!1;return;case 27:case 3:Qa=!0;return;default:ro=ro.return}}function Yc(u){if(u!==ro)return!1;if(!Ir)return Ip(u),Ir=!0,!1;var g=u.tag,w;if((w=g!==3&&g!==27)&&((w=g===5)&&(w=u.type,w=!(w!=="form"&&w!=="button")||yv(u.type,u.memoizedProps)),w=!w),w&&os&&Zl(u),Ip(u),g===13){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(p(317));os=xv(u)}else if(g===31){if(u=u.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(p(317));os=xv(u)}else g===27?(g=os,Uh(u.type)?(u=Ca,Ca=null,os=u):os=g):os=ro?Lc(u.stateNode.nextSibling):null;return!0}function Xl(){os=ro=null,Ir=!1}function Cp(){var u=vc;return u!==null&&(In===null?In=u:In.push.apply(In,u),vc=null),u}function yd(u){vc===null?vc=[u]:vc.push(u)}var Rp=rt(null),yl=null,vl=null;function Iu(u,g,w){ai(Rp,g._currentValue),g._currentValue=w}function xc(u){u._currentValue=Rp.current,Yt(Rp)}function rg(u,g,w){for(;u!==null;){var C=u.alternate;if((u.childLanes&g)!==g?(u.childLanes|=g,C!==null&&(C.childLanes|=g)):C!==null&&(C.childLanes&g)!==g&&(C.childLanes|=g),u===w)break;u=u.return}}function _f(u,g,w,C){var F=u.child;for(F!==null&&(F.return=u);F!==null;){var j=F.dependencies;if(j!==null){var se=F.child;j=j.firstContext;e:for(;j!==null;){var Ae=j;j=F;for(var Qe=0;Qe<g.length;Qe++)if(Ae.context===g[Qe]){j.lanes|=w,Ae=j.alternate,Ae!==null&&(Ae.lanes|=w),rg(j.return,w,u),C||(se=null);break e}j=Ae.next}}else if(F.tag===18){if(se=F.return,se===null)throw Error(p(341));se.lanes|=w,j=se.alternate,j!==null&&(j.lanes|=w),rg(se,w,u),se=null}else se=F.child;if(se!==null)se.return=F;else for(se=F;se!==null;){if(se===u){se=null;break}if(F=se.sibling,F!==null){F.return=se.return,se=F;break}se=se.return}F=se}}function Cu(u,g,w,C){u=null;for(var F=g,j=!1;F!==null;){if(!j){if((F.flags&524288)!==0)j=!0;else if((F.flags&262144)!==0)break}if(F.tag===10){var se=F.alternate;if(se===null)throw Error(p(387));if(se=se.memoizedProps,se!==null){var Ae=F.type;Oo(F.pendingProps.value,se.value)||(u!==null?u.push(Ae):u=[Ae])}}else if(F===Jn.current){if(se=F.alternate,se===null)throw Error(p(387));se.memoizedState.memoizedState!==F.memoizedState.memoizedState&&(u!==null?u.push(Vg):u=[Vg])}F=F.return}u!==null&&_f(g,u,w,C),g.flags|=262144}function _h(u){for(u=u.firstContext;u!==null;){if(!Oo(u.context._currentValue,u.memoizedValue))return!0;u=u.next}return!1}function bc(u){yl=u,vl=null,u=u.dependencies,u!==null&&(u.firstContext=null)}function zs(u){return sg(yl,u)}function vd(u,g){return yl===null&&bc(u),sg(u,g)}function sg(u,g){var w=g._currentValue;if(g={context:g,memoizedValue:w,next:null},vl===null){if(u===null)throw Error(p(308));vl=g,u.dependencies={lanes:0,firstContext:g},u.flags|=524288}else vl=vl.next=g;return w}var yf=typeof AbortController<"u"?AbortController:function(){var u=[],g=this.signal={aborted:!1,addEventListener:function(w,C){u.push(C)}};this.abort=function(){g.aborted=!0,u.forEach(function(w){return w()})}},yh=c.unstable_scheduleCallback,Mp=c.unstable_NormalPriority,Yr={$$typeof:Gt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vf(){return{controller:new yf,data:new Map,refCount:0}}function Qc(u){u.refCount--,u.refCount===0&&yh(Mp,function(){u.controller.abort()})}var Jc=null,xf=0,Ru=0,Mu=null;function bf(u,g){if(Jc===null){var w=Jc=[];xf=0,Ru=q_(),Mu={status:"pending",value:void 0,then:function(C){w.push(C)}}}return xf++,g.then(wf,wf),g}function wf(){if(--xf===0&&Jc!==null){Mu!==null&&(Mu.status="fulfilled");var u=Jc;Jc=null,Ru=0,Mu=null;for(var g=0;g<u.length;g++)(0,u[g])()}}function xd(u,g){var w=[],C={status:"pending",value:null,reason:null,then:function(F){w.push(F)}};return u.then(function(){C.status="fulfilled",C.value=g;for(var F=0;F<w.length;F++)(0,w[F])(g)},function(F){for(C.status="rejected",C.reason=F,F=0;F<w.length;F++)(0,w[F])(void 0)}),C}var Tf=Ct.S;Ct.S=function(u,g){Un=$i(),typeof g=="object"&&g!==null&&typeof g.then=="function"&&bf(u,g),Tf!==null&&Tf(u,g)};var wc=rt(null);function Dp(){var u=wc.current;return u!==null?u:Ht.pooledCache}function Ef(u,g){g===null?ai(wc,wc.current):ai(wc,g.pool)}function vh(){var u=Dp();return u===null?null:{parent:Yr._currentValue,pool:u}}var xh=Error(p(460)),Pp=Error(p(474)),Op=Error(p(542)),Lp={then:function(){}};function C_(u){return u=u.status,u==="fulfilled"||u==="rejected"}function Sf(u,g,w){switch(w=u[w],w===void 0?u.push(g):w!==g&&(g.then(Pa,Pa),g=w),g.status){case"fulfilled":return g.value;case"rejected":throw u=g.reason,bh(u),u;default:if(typeof g.status=="string")g.then(Pa,Pa);else{if(u=Ht,u!==null&&100<u.shellSuspendCounter)throw Error(p(482));u=g,u.status="pending",u.then(function(C){if(g.status==="pending"){var F=g;F.status="fulfilled",F.value=C}},function(C){if(g.status==="pending"){var F=g;F.status="rejected",F.reason=C}})}switch(g.status){case"fulfilled":return g.value;case"rejected":throw u=g.reason,bh(u),u}throw tu=g,xh}}function eu(u){try{var g=u._init;return g(u._payload)}catch(w){throw w!==null&&typeof w=="object"&&typeof w.then=="function"?(tu=w,xh):w}}var tu=null;function og(){if(tu===null)throw Error(p(459));var u=tu;return tu=null,u}function bh(u){if(u===xh||u===Op)throw Error(p(483))}var Du=null,bd=0;function Af(u){var g=bd;return bd+=1,Du===null&&(Du=[]),Sf(Du,u,g)}function Pu(u,g){g=g.props.ref,u.ref=g!==void 0?g:null}function xl(u,g){throw g.$$typeof===be?Error(p(525)):(u=Object.prototype.toString.call(g),Error(p(31,u==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":u)))}function wd(u){function g(Tt,lt){if(u){var Bt=Tt.deletions;Bt===null?(Tt.deletions=[lt],Tt.flags|=16):Bt.push(lt)}}function w(Tt,lt){if(!u)return null;for(;lt!==null;)g(Tt,lt),lt=lt.sibling;return null}function C(Tt){for(var lt=new Map;Tt!==null;)Tt.key!==null?lt.set(Tt.key,Tt):lt.set(Tt.index,Tt),Tt=Tt.sibling;return lt}function F(Tt,lt){return Tt=an(Tt,lt),Tt.index=0,Tt.sibling=null,Tt}function j(Tt,lt,Bt){return Tt.index=Bt,u?(Bt=Tt.alternate,Bt!==null?(Bt=Bt.index,Bt<lt?(Tt.flags|=67108866,lt):Bt):(Tt.flags|=67108866,lt)):(Tt.flags|=1048576,lt)}function se(Tt){return u&&Tt.alternate===null&&(Tt.flags|=67108866),Tt}function Ae(Tt,lt,Bt,ci){return lt===null||lt.tag!==6?(lt=md(Bt,Tt.mode,ci),lt.return=Tt,lt):(lt=F(lt,Bt),lt.return=Tt,lt)}function Qe(Tt,lt,Bt,ci){var En=Bt.type;return En===it?si(Tt,lt,Bt.props.children,ci,Bt.key):lt!==null&&(lt.elementType===En||typeof En=="object"&&En!==null&&En.$$typeof===Oe&&eu(En)===lt.type)?(lt=F(lt,Bt.props),Pu(lt,Bt),lt.return=Tt,lt):(lt=Sp(Bt.type,Bt.key,Bt.props,null,Tt.mode,ci),Pu(lt,Bt),lt.return=Tt,lt)}function Ft(Tt,lt,Bt,ci){return lt===null||lt.tag!==4||lt.stateNode.containerInfo!==Bt.containerInfo||lt.stateNode.implementation!==Bt.implementation?(lt=Or(Bt,Tt.mode,ci),lt.return=Tt,lt):(lt=F(lt,Bt.children||[]),lt.return=Tt,lt)}function si(Tt,lt,Bt,ci,En){return lt===null||lt.tag!==7?(lt=mh(Bt,Tt.mode,ci,En),lt.return=Tt,lt):(lt=F(lt,Bt),lt.return=Tt,lt)}function hi(Tt,lt,Bt){if(typeof lt=="string"&&lt!==""||typeof lt=="number"||typeof lt=="bigint")return lt=md(""+lt,Tt.mode,Bt),lt.return=Tt,lt;if(typeof lt=="object"&&lt!==null){switch(lt.$$typeof){case He:return Bt=Sp(lt.type,lt.key,lt.props,null,Tt.mode,Bt),Pu(Bt,lt),Bt.return=Tt,Bt;case Je:return lt=Or(lt,Tt.mode,Bt),lt.return=Tt,lt;case Oe:return lt=eu(lt),hi(Tt,lt,Bt)}if(qn(lt)||yt(lt))return lt=mh(lt,Tt.mode,Bt,null),lt.return=Tt,lt;if(typeof lt.then=="function")return hi(Tt,Af(lt),Bt);if(lt.$$typeof===Gt)return hi(Tt,vd(Tt,lt),Bt);xl(Tt,lt)}return null}function Ut(Tt,lt,Bt,ci){var En=lt!==null?lt.key:null;if(typeof Bt=="string"&&Bt!==""||typeof Bt=="number"||typeof Bt=="bigint")return En!==null?null:Ae(Tt,lt,""+Bt,ci);if(typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case He:return Bt.key===En?Qe(Tt,lt,Bt,ci):null;case Je:return Bt.key===En?Ft(Tt,lt,Bt,ci):null;case Oe:return Bt=eu(Bt),Ut(Tt,lt,Bt,ci)}if(qn(Bt)||yt(Bt))return En!==null?null:si(Tt,lt,Bt,ci,null);if(typeof Bt.then=="function")return Ut(Tt,lt,Af(Bt),ci);if(Bt.$$typeof===Gt)return Ut(Tt,lt,vd(Tt,Bt),ci);xl(Tt,Bt)}return null}function Zt(Tt,lt,Bt,ci,En){if(typeof ci=="string"&&ci!==""||typeof ci=="number"||typeof ci=="bigint")return Tt=Tt.get(Bt)||null,Ae(lt,Tt,""+ci,En);if(typeof ci=="object"&&ci!==null){switch(ci.$$typeof){case He:return Tt=Tt.get(ci.key===null?Bt:ci.key)||null,Qe(lt,Tt,ci,En);case Je:return Tt=Tt.get(ci.key===null?Bt:ci.key)||null,Ft(lt,Tt,ci,En);case Oe:return ci=eu(ci),Zt(Tt,lt,Bt,ci,En)}if(qn(ci)||yt(ci))return Tt=Tt.get(Bt)||null,si(lt,Tt,ci,En,null);if(typeof ci.then=="function")return Zt(Tt,lt,Bt,Af(ci),En);if(ci.$$typeof===Gt)return Zt(Tt,lt,Bt,vd(lt,ci),En);xl(lt,ci)}return null}function Hi(Tt,lt,Bt,ci){for(var En=null,ss=null,mn=lt,lr=lt=0,Br=null;mn!==null&&lr<Bt.length;lr++){mn.index>lr?(Br=mn,mn=null):Br=mn.sibling;var Nr=Ut(Tt,mn,Bt[lr],ci);if(Nr===null){mn===null&&(mn=Br);break}u&&mn&&Nr.alternate===null&&g(Tt,mn),lt=j(Nr,lt,lr),ss===null?En=Nr:ss.sibling=Nr,ss=Nr,mn=Br}if(lr===Bt.length)return w(Tt,mn),Ir&&Wl(Tt,lr),En;if(mn===null){for(;lr<Bt.length;lr++)mn=hi(Tt,Bt[lr],ci),mn!==null&&(lt=j(mn,lt,lr),ss===null?En=mn:ss.sibling=mn,ss=mn);return Ir&&Wl(Tt,lr),En}for(mn=C(mn);lr<Bt.length;lr++)Br=Zt(mn,Tt,lr,Bt[lr],ci),Br!==null&&(u&&Br.alternate!==null&&mn.delete(Br.key===null?lr:Br.key),lt=j(Br,lt,lr),ss===null?En=Br:ss.sibling=Br,ss=Br);return u&&mn.forEach(function(Zh){return g(Tt,Zh)}),Ir&&Wl(Tt,lr),En}function Tn(Tt,lt,Bt,ci){if(Bt==null)throw Error(p(151));for(var En=null,ss=null,mn=lt,lr=lt=0,Br=null,Nr=Bt.next();mn!==null&&!Nr.done;lr++,Nr=Bt.next()){mn.index>lr?(Br=mn,mn=null):Br=mn.sibling;var Zh=Ut(Tt,mn,Nr.value,ci);if(Zh===null){mn===null&&(mn=Br);break}u&&mn&&Zh.alternate===null&&g(Tt,mn),lt=j(Zh,lt,lr),ss===null?En=Zh:ss.sibling=Zh,ss=Zh,mn=Br}if(Nr.done)return w(Tt,mn),Ir&&Wl(Tt,lr),En;if(mn===null){for(;!Nr.done;lr++,Nr=Bt.next())Nr=hi(Tt,Nr.value,ci),Nr!==null&&(lt=j(Nr,lt,lr),ss===null?En=Nr:ss.sibling=Nr,ss=Nr);return Ir&&Wl(Tt,lr),En}for(mn=C(mn);!Nr.done;lr++,Nr=Bt.next())Nr=Zt(mn,Tt,lr,Nr.value,ci),Nr!==null&&(u&&Nr.alternate!==null&&mn.delete(Nr.key===null?lr:Nr.key),lt=j(Nr,lt,lr),ss===null?En=Nr:ss.sibling=Nr,ss=Nr);return u&&mn.forEach(function(kv){return g(Tt,kv)}),Ir&&Wl(Tt,lr),En}function vs(Tt,lt,Bt,ci){if(typeof Bt=="object"&&Bt!==null&&Bt.type===it&&Bt.key===null&&(Bt=Bt.props.children),typeof Bt=="object"&&Bt!==null){switch(Bt.$$typeof){case He:e:{for(var En=Bt.key;lt!==null;){if(lt.key===En){if(En=Bt.type,En===it){if(lt.tag===7){w(Tt,lt.sibling),ci=F(lt,Bt.props.children),ci.return=Tt,Tt=ci;break e}}else if(lt.elementType===En||typeof En=="object"&&En!==null&&En.$$typeof===Oe&&eu(En)===lt.type){w(Tt,lt.sibling),ci=F(lt,Bt.props),Pu(ci,Bt),ci.return=Tt,Tt=ci;break e}w(Tt,lt);break}else g(Tt,lt);lt=lt.sibling}Bt.type===it?(ci=mh(Bt.props.children,Tt.mode,ci,Bt.key),ci.return=Tt,Tt=ci):(ci=Sp(Bt.type,Bt.key,Bt.props,null,Tt.mode,ci),Pu(ci,Bt),ci.return=Tt,Tt=ci)}return se(Tt);case Je:e:{for(En=Bt.key;lt!==null;){if(lt.key===En)if(lt.tag===4&&lt.stateNode.containerInfo===Bt.containerInfo&&lt.stateNode.implementation===Bt.implementation){w(Tt,lt.sibling),ci=F(lt,Bt.children||[]),ci.return=Tt,Tt=ci;break e}else{w(Tt,lt);break}else g(Tt,lt);lt=lt.sibling}ci=Or(Bt,Tt.mode,ci),ci.return=Tt,Tt=ci}return se(Tt);case Oe:return Bt=eu(Bt),vs(Tt,lt,Bt,ci)}if(qn(Bt))return Hi(Tt,lt,Bt,ci);if(yt(Bt)){if(En=yt(Bt),typeof En!="function")throw Error(p(150));return Bt=En.call(Bt),Tn(Tt,lt,Bt,ci)}if(typeof Bt.then=="function")return vs(Tt,lt,Af(Bt),ci);if(Bt.$$typeof===Gt)return vs(Tt,lt,vd(Tt,Bt),ci);xl(Tt,Bt)}return typeof Bt=="string"&&Bt!==""||typeof Bt=="number"||typeof Bt=="bigint"?(Bt=""+Bt,lt!==null&&lt.tag===6?(w(Tt,lt.sibling),ci=F(lt,Bt),ci.return=Tt,Tt=ci):(w(Tt,lt),ci=md(Bt,Tt.mode,ci),ci.return=Tt,Tt=ci),se(Tt)):w(Tt,lt)}return function(Tt,lt,Bt,ci){try{bd=0;var En=vs(Tt,lt,Bt,ci);return Du=null,En}catch(mn){if(mn===xh||mn===Op)throw mn;var ss=sa(29,mn,null,Tt.mode);return ss.lanes=ci,ss.return=Tt,ss}finally{}}}var Tc=wd(!0),Ou=wd(!1),Ea=!1;function If(u){u.updateQueue={baseState:u.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Td(u,g){u=u.updateQueue,g.updateQueue===u&&(g.updateQueue={baseState:u.baseState,firstBaseUpdate:u.firstBaseUpdate,lastBaseUpdate:u.lastBaseUpdate,shared:u.shared,callbacks:null})}function Ec(u){return{lane:u,tag:0,payload:null,callback:null,next:null}}function Sc(u,g,w){var C=u.updateQueue;if(C===null)return null;if(C=C.shared,(wt&2)!==0){var F=C.pending;return F===null?g.next=g:(g.next=F.next,F.next=g),C.pending=g,g=Su(u),fh(u,null,w),g}return Nt(u,C,g,w),Su(u)}function Lu(u,g,w){if(g=g.updateQueue,g!==null&&(g=g.shared,(w&4194048)!==0)){var C=g.lanes;C&=u.pendingLanes,w|=C,g.lanes=w,Vc(u,w)}}function Ed(u,g){var w=u.updateQueue,C=u.alternate;if(C!==null&&(C=C.updateQueue,w===C)){var F=null,j=null;if(w=w.firstBaseUpdate,w!==null){do{var se={lane:w.lane,tag:w.tag,payload:w.payload,callback:null,next:null};j===null?F=j=se:j=j.next=se,w=w.next}while(w!==null);j===null?F=j=g:j=j.next=g}else F=j=g;w={baseState:C.baseState,firstBaseUpdate:F,lastBaseUpdate:j,shared:C.shared,callbacks:C.callbacks},u.updateQueue=w;return}u=w.lastBaseUpdate,u===null?w.firstBaseUpdate=g:u.next=g,w.lastBaseUpdate=g}var Cf=!1;function zu(){if(Cf){var u=Mu;if(u!==null)throw u}}function Ac(u,g,w,C){Cf=!1;var F=u.updateQueue;Ea=!1;var j=F.firstBaseUpdate,se=F.lastBaseUpdate,Ae=F.shared.pending;if(Ae!==null){F.shared.pending=null;var Qe=Ae,Ft=Qe.next;Qe.next=null,se===null?j=Ft:se.next=Ft,se=Qe;var si=u.alternate;si!==null&&(si=si.updateQueue,Ae=si.lastBaseUpdate,Ae!==se&&(Ae===null?si.firstBaseUpdate=Ft:Ae.next=Ft,si.lastBaseUpdate=Qe))}if(j!==null){var hi=F.baseState;se=0,si=Ft=Qe=null,Ae=j;do{var Ut=Ae.lane&-536870913,Zt=Ut!==Ae.lane;if(Zt?(_t&Ut)===Ut:(C&Ut)===Ut){Ut!==0&&Ut===Ru&&(Cf=!0),si!==null&&(si=si.next={lane:0,tag:Ae.tag,payload:Ae.payload,callback:null,next:null});e:{var Hi=u,Tn=Ae;Ut=g;var vs=w;switch(Tn.tag){case 1:if(Hi=Tn.payload,typeof Hi=="function"){hi=Hi.call(vs,hi,Ut);break e}hi=Hi;break e;case 3:Hi.flags=Hi.flags&-65537|128;case 0:if(Hi=Tn.payload,Ut=typeof Hi=="function"?Hi.call(vs,hi,Ut):Hi,Ut==null)break e;hi=ce({},hi,Ut);break e;case 2:Ea=!0}}Ut=Ae.callback,Ut!==null&&(u.flags|=64,Zt&&(u.flags|=8192),Zt=F.callbacks,Zt===null?F.callbacks=[Ut]:Zt.push(Ut))}else Zt={lane:Ut,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},si===null?(Ft=si=Zt,Qe=hi):si=si.next=Zt,se|=Ut;if(Ae=Ae.next,Ae===null){if(Ae=F.shared.pending,Ae===null)break;Zt=Ae,Ae=Zt.next,Zt.next=null,F.lastBaseUpdate=Zt,F.shared.pending=null}}while(!0);si===null&&(Qe=hi),F.baseState=Qe,F.firstBaseUpdate=Ft,F.lastBaseUpdate=si,j===null&&(F.shared.lanes=0),Fn|=se,u.lanes=se,u.memoizedState=hi}}function R_(u,g){if(typeof u!="function")throw Error(p(191,u));u.call(g)}function iu(u,g){var w=u.callbacks;if(w!==null)for(u.callbacks=null,u=0;u<w.length;u++)R_(w[u],g)}var wh=rt(null),zp=rt(0);function Rf(u,g){u=tn,ai(zp,u),ai(wh,g),tn=u|g.baseLanes}function Sd(){ai(zp,tn),ai(wh,wh.current)}function bl(){tn=zp.current,Yt(wh),Yt(zp)}var Zo=rt(null),To=null;function Ic(u){var g=u.alternate;ai(Hs,Hs.current&1),ai(Zo,u),To===null&&(g===null||wh.current!==null||g.memoizedState!==null)&&(To=u)}function Ad(u){ai(Hs,Hs.current),ai(Zo,u),To===null&&(To=u)}function Mf(u){u.tag===22?(ai(Hs,Hs.current),ai(Zo,u),To===null&&(To=u)):wl()}function wl(){ai(Hs,Hs.current),ai(Zo,Zo.current)}function oa(u){Yt(Zo),To===u&&(To=null),Yt(Hs)}var Hs=rt(0);function Cc(u){for(var g=u;g!==null;){if(g.tag===13){var w=g.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||zg(w)||Y_(w)))return g}else if(g.tag===19&&(g.memoizedProps.revealOrder==="forwards"||g.memoizedProps.revealOrder==="backwards"||g.memoizedProps.revealOrder==="unstable_legacy-backwards"||g.memoizedProps.revealOrder==="together")){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===u)break;for(;g.sibling===null;){if(g.return===null||g.return===u)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Fa=0,Lt=null,as=null,_s=null,Kl=!1,Ja=!1,Ai=!1,Id=0,Cd=0,nu=null,kp=0;function Os(){throw Error(p(321))}function Df(u,g){if(g===null)return!1;for(var w=0;w<g.length&&w<u.length;w++)if(!Oo(u[w],g[w]))return!1;return!0}function Fp(u,g,w,C,F,j){return Fa=j,Lt=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,Ct.H=u===null||u.memoizedState===null?il:Nf,Ai=!1,j=w(C,F),Ai=!1,Ja&&(j=D_(g,w,C,F)),M_(u),j}function M_(u){Ct.H=Oh;var g=as!==null&&as.next!==null;if(Fa=0,_s=as=Lt=null,Kl=!1,Cd=0,nu=null,g)throw Error(p(300));u===null||$s||(u=u.dependencies,u!==null&&_h(u)&&($s=!0))}function D_(u,g,w,C){Lt=u;var F=0;do{if(Ja&&(nu=null),Cd=0,Ja=!1,25<=F)throw Error(p(301));if(F+=1,_s=as=null,u.updateQueue!=null){var j=u.updateQueue;j.lastEffect=null,j.events=null,j.stores=null,j.memoCache!=null&&(j.memoCache.index=0)}Ct.H=Vf,j=g(w,C)}while(Ja);return j}function Ba(){var u=Ct.H,g=u.useState()[0];return g=typeof g.then=="function"?Th(g):g,u=u.useState()[0],(as!==null?as.memoizedState:null)!==u&&(Lt.flags|=1024),g}function Pf(){var u=Id!==0;return Id=0,u}function Lo(u,g,w){g.updateQueue=u.updateQueue,g.flags&=-2053,u.lanes&=~w}function Rc(u){if(Kl){for(u=u.memoizedState;u!==null;){var g=u.queue;g!==null&&(g.pending=null),u=u.next}Kl=!1}Fa=0,_s=as=Lt=null,Ja=!1,Cd=Id=0,nu=null}function aa(){var u={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _s===null?Lt.memoizedState=_s=u:_s=_s.next=u,_s}function ks(){if(as===null){var u=Lt.alternate;u=u!==null?u.memoizedState:null}else u=as.next;var g=_s===null?Lt.memoizedState:_s.next;if(g!==null)_s=g,as=u;else{if(u===null)throw Lt.alternate===null?Error(p(467)):Error(p(310));as=u,u={memoizedState:as.memoizedState,baseState:as.baseState,baseQueue:as.baseQueue,queue:as.queue,next:null},_s===null?Lt.memoizedState=_s=u:_s=_s.next=u}return _s}function Rd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Th(u){var g=Cd;return Cd+=1,nu===null&&(nu=[]),u=Sf(nu,u,g),g=Lt,(_s===null?g.memoizedState:_s.next)===null&&(g=g.alternate,Ct.H=g===null||g.memoizedState===null?il:Nf),u}function Md(u){if(u!==null&&typeof u=="object"){if(typeof u.then=="function")return Th(u);if(u.$$typeof===Gt)return zs(u)}throw Error(p(438,String(u)))}function la(u){var g=null,w=Lt.updateQueue;if(w!==null&&(g=w.memoCache),g==null){var C=Lt.alternate;C!==null&&(C=C.updateQueue,C!==null&&(C=C.memoCache,C!=null&&(g={data:C.data.map(function(F){return F.slice()}),index:0})))}if(g==null&&(g={data:[],index:0}),w===null&&(w=Rd(),Lt.updateQueue=w),w.memoCache=g,w=g.data[g.index],w===void 0)for(w=g.data[g.index]=Array(u),C=0;C<u;C++)w[C]=tt;return g.index++,w}function Yn(u,g){return typeof g=="function"?g(u):g}function ku(u){var g=ks();return Fu(g,as,u)}function Fu(u,g,w){var C=u.queue;if(C===null)throw Error(p(311));C.lastRenderedReducer=w;var F=u.baseQueue,j=C.pending;if(j!==null){if(F!==null){var se=F.next;F.next=j.next,j.next=se}g.baseQueue=F=j,C.pending=null}if(j=u.baseState,F===null)u.memoizedState=j;else{g=F.next;var Ae=se=null,Qe=null,Ft=g,si=!1;do{var hi=Ft.lane&-536870913;if(hi!==Ft.lane?(_t&hi)===hi:(Fa&hi)===hi){var Ut=Ft.revertLane;if(Ut===0)Qe!==null&&(Qe=Qe.next={lane:0,revertLane:0,gesture:null,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null}),hi===Ru&&(si=!0);else if((Fa&Ut)===Ut){Ft=Ft.next,Ut===Ru&&(si=!0);continue}else hi={lane:0,revertLane:Ft.revertLane,gesture:null,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null},Qe===null?(Ae=Qe=hi,se=j):Qe=Qe.next=hi,Lt.lanes|=Ut,Fn|=Ut;hi=Ft.action,Ai&&w(j,hi),j=Ft.hasEagerState?Ft.eagerState:w(j,hi)}else Ut={lane:hi,revertLane:Ft.revertLane,gesture:Ft.gesture,action:Ft.action,hasEagerState:Ft.hasEagerState,eagerState:Ft.eagerState,next:null},Qe===null?(Ae=Qe=Ut,se=j):Qe=Qe.next=Ut,Lt.lanes|=hi,Fn|=hi;Ft=Ft.next}while(Ft!==null&&Ft!==g);if(Qe===null?se=j:Qe.next=Ae,!Oo(j,u.memoizedState)&&($s=!0,si&&(w=Mu,w!==null)))throw w;u.memoizedState=j,u.baseState=se,u.baseQueue=Qe,C.lastRenderedState=j}return F===null&&(C.lanes=0),[u.memoizedState,C.dispatch]}function Bp(u){var g=ks(),w=g.queue;if(w===null)throw Error(p(311));w.lastRenderedReducer=u;var C=w.dispatch,F=w.pending,j=g.memoizedState;if(F!==null){w.pending=null;var se=F=F.next;do j=u(j,se.action),se=se.next;while(se!==F);Oo(j,g.memoizedState)||($s=!0),g.memoizedState=j,g.baseQueue===null&&(g.baseState=j),w.lastRenderedState=j}return[j,C]}function ag(u,g,w){var C=Lt,F=ks(),j=Ir;if(j){if(w===void 0)throw Error(p(407));w=w()}else w=g();var se=!Oo((as||F).memoizedState,w);if(se&&(F.memoizedState=w,$s=!0),F=F.queue,Ch(el.bind(null,C,F,u),[u]),F.getSnapshot!==g||se||_s!==null&&_s.memoizedState.tag&1){if(C.flags|=2048,zo(9,{destroy:void 0},Np.bind(null,C,F,w,g),null),Ht===null)throw Error(p(349));j||(Fa&127)!==0||Mc(C,g,w)}return w}function Mc(u,g,w){u.flags|=16384,u={getSnapshot:g,value:w},g=Lt.updateQueue,g===null?(g=Rd(),Lt.updateQueue=g,g.stores=[u]):(w=g.stores,w===null?g.stores=[u]:w.push(u))}function Np(u,g,w,C){g.value=w,g.getSnapshot=C,Bu(g)&&kt(u)}function el(u,g,w){return w(function(){Bu(g)&&kt(u)})}function Bu(u){var g=u.getSnapshot;u=u.value;try{var w=g();return!Oo(u,w)}catch{return!0}}function kt(u){var g=gl(u,2);g!==null&&Qr(g,u,2)}function ti(u){var g=aa();if(typeof u=="function"){var w=u;if(u=w(),Ai){Co(!0);try{w()}finally{Co(!1)}}}return g.memoizedState=g.baseState=u,g.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yn,lastRenderedState:u},g}function Eh(u,g,w,C){return u.baseState=w,Fu(u,as,typeof C=="function"?C:Yn)}function rs(u,g,w,C,F){if(Dh(u))throw Error(p(485));if(u=g.action,u!==null){var j={payload:F,action:u,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(se){j.listeners.push(se)}};Ct.T!==null?w(!0):j.isTransition=!1,C(j),w=g.pending,w===null?(j.next=g.pending=j,Ue(g,j)):(j.next=w.next,g.pending=w.next=j)}}function Ue(u,g){var w=g.action,C=g.payload,F=u.state;if(g.isTransition){var j=Ct.T,se={};Ct.T=se;try{var Ae=w(F,C),Qe=Ct.S;Qe!==null&&Qe(se,Ae),Vp(u,g,Ae)}catch(Ft){Nu(u,g,Ft)}finally{j!==null&&se.types!==null&&(j.types=se.types),Ct.T=j}}else try{j=w(F,C),Vp(u,g,j)}catch(Ft){Nu(u,g,Ft)}}function Vp(u,g,w){w!==null&&typeof w=="object"&&typeof w.then=="function"?w.then(function(C){Sh(u,g,C)},function(C){return Nu(u,g,C)}):Sh(u,g,w)}function Sh(u,g,w){g.status="fulfilled",g.value=w,Of(g),u.state=w,g=u.pending,g!==null&&(w=g.next,w===g?u.pending=null:(w=w.next,g.next=w,Ue(u,w)))}function Nu(u,g,w){var C=u.pending;if(u.pending=null,C!==null){C=C.next;do g.status="rejected",g.reason=w,Of(g),g=g.next;while(g!==C)}u.action=null}function Of(u){u=u.listeners;for(var g=0;g<u.length;g++)(0,u[g])()}function Lf(u,g){return g}function Ah(u,g){if(Ir){var w=Ht.formState;if(w!==null){e:{var C=Lt;if(Ir){if(os){t:{for(var F=os,j=Qa;F.nodeType!==8;){if(!j){F=null;break t}if(F=Lc(F.nextSibling),F===null){F=null;break t}}j=F.data,F=j==="F!"||j==="F"?F:null}if(F){os=Lc(F.nextSibling),C=F.data==="F!";break e}}Zl(C)}C=!1}C&&(g=w[0])}}return w=aa(),w.memoizedState=w.baseState=g,C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Lf,lastRenderedState:g},w.queue=C,w=su.bind(null,Lt,C),C.dispatch=w,C=ti(!1),j=Od.bind(null,Lt,!1,C.queue),C=aa(),F={state:g,dispatch:null,action:u,pending:null},C.queue=F,w=rs.bind(null,Lt,F,j,w),F.dispatch=w,C.memoizedState=u,[g,w,!1]}function Ih(u){var g=ks();return P_(g,as,u)}function P_(u,g,w){if(g=Fu(u,g,Lf)[0],u=ku(Yn)[0],typeof g=="object"&&g!==null&&typeof g.then=="function")try{var C=Th(g)}catch(se){throw se===xh?Op:se}else C=g;g=ks();var F=g.queue,j=F.dispatch;return w!==g.memoizedState&&(Lt.flags|=2048,zo(9,{destroy:void 0},O_.bind(null,F,w),null)),[C,j,u]}function O_(u,g){u.action=g}function lg(u){var g=ks(),w=as;if(w!==null)return P_(g,w,u);ks(),g=g.memoizedState,w=ks();var C=w.queue.dispatch;return w.memoizedState=u,[g,C,!1]}function zo(u,g,w,C){return u={tag:u,create:w,deps:C,inst:g,next:null},g=Lt.updateQueue,g===null&&(g=Rd(),Lt.updateQueue=g),w=g.lastEffect,w===null?g.lastEffect=u.next=u:(C=w.next,w.next=u,u.next=C,g.lastEffect=u),u}function Up(){return ks().memoizedState}function Dd(u,g,w,C){var F=aa();Lt.flags|=u,F.memoizedState=zo(1|g,{destroy:void 0},w,C===void 0?null:C)}function zf(u,g,w,C){var F=ks();C=C===void 0?null:C;var j=F.memoizedState.inst;as!==null&&C!==null&&Df(C,as.memoizedState.deps)?F.memoizedState=zo(g,j,w,C):(Lt.flags|=u,F.memoizedState=zo(1|g,j,w,C))}function kf(u,g){Dd(8390656,8,u,g)}function Ch(u,g){zf(2048,8,u,g)}function Rh(u){Lt.flags|=4;var g=Lt.updateQueue;if(g===null)g=Rd(),Lt.updateQueue=g,g.events=[u];else{var w=g.events;w===null?g.events=[u]:w.push(u)}}function cg(u){var g=ks().memoizedState;return Rh({ref:g,nextImpl:u}),function(){if((wt&2)!==0)throw Error(p(440));return g.impl.apply(void 0,arguments)}}function ug(u,g){return zf(4,2,u,g)}function L_(u,g){return zf(4,4,u,g)}function hg(u,g){if(typeof g=="function"){u=u();var w=g(u);return function(){typeof w=="function"?w():g(null)}}if(g!=null)return u=u(),g.current=u,function(){g.current=null}}function z_(u,g,w){w=w!=null?w.concat([u]):null,zf(4,4,hg.bind(null,g,u),w)}function Eo(){}function k_(u,g){var w=ks();g=g===void 0?null:g;var C=w.memoizedState;return g!==null&&Df(g,C[1])?C[0]:(w.memoizedState=[u,g],u)}function Pd(u,g){var w=ks();g=g===void 0?null:g;var C=w.memoizedState;if(g!==null&&Df(g,C[1]))return C[0];if(C=u(),Ai){Co(!0);try{u()}finally{Co(!1)}}return w.memoizedState=[C,g],C}function Tr(u,g,w){return w===void 0||(Fa&1073741824)!==0&&(_t&261930)===0?u.memoizedState=g:(u.memoizedState=w,u=Va(),Lt.lanes|=u,Fn|=u,w)}function hn(u,g,w,C){return Oo(w,g)?w:wh.current!==null?(u=Tr(u,w,C),Oo(u,g)||($s=!0),u):(Fa&42)===0||(Fa&1073741824)!==0&&(_t&261930)===0?($s=!0,u.memoizedState=w):(u=Va(),Lt.lanes|=u,Fn|=u,g)}function jp(u,g,w,C,F){var j=oi.p;oi.p=j!==0&&8>j?j:8;var se=Ct.T,Ae={};Ct.T=Ae,Od(u,!1,g,w);try{var Qe=F(),Ft=Ct.S;if(Ft!==null&&Ft(Ae,Qe),Qe!==null&&typeof Qe=="object"&&typeof Qe.then=="function"){var si=xd(Qe,C);Yl(u,g,si,ls(u))}else Yl(u,g,C,ls(u))}catch(hi){Yl(u,g,{then:function(){},status:"rejected",reason:hi},ls())}finally{oi.p=j,se!==null&&Ae.types!==null&&(se.types=Ae.types),Ct.T=se}}function Sa(){}function ru(u,g,w,C){if(u.tag!==5)throw Error(p(476));var F=Mh(u).queue;jp(u,F,g,wi,w===null?Sa:function(){return Dc(u),w(C)})}function Mh(u){var g=u.memoizedState;if(g!==null)return g;g={memoizedState:wi,baseState:wi,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yn,lastRenderedState:wi},next:null};var w={};return g.next={memoizedState:w,baseState:w,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yn,lastRenderedState:w},next:null},u.memoizedState=g,u=u.alternate,u!==null&&(u.memoizedState=g),g}function Dc(u){var g=Mh(u);g.next===null&&(g=u.alternate.memoizedState),Yl(u,g.next.queue,{},ls())}function Ff(){return zs(Vg)}function Gp(){return ks().memoizedState}function Bf(){return ks().memoizedState}function qp(u){for(var g=u.return;g!==null;){switch(g.tag){case 24:case 3:var w=ls();u=Ec(w);var C=Sc(g,u,w);C!==null&&(Qr(C,g,w),Lu(C,g,w)),g={cache:vf()},u.payload=g;return}g=g.return}}function tl(u,g,w){var C=ls();w={lane:C,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},Dh(u)?Ph(g,w):(w=df(u,g,w,C),w!==null&&(Qr(w,u,C),ou(w,g,C)))}function su(u,g,w){var C=ls();Yl(u,g,w,C)}function Yl(u,g,w,C){var F={lane:C,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null};if(Dh(u))Ph(g,F);else{var j=u.alternate;if(u.lanes===0&&(j===null||j.lanes===0)&&(j=g.lastRenderedReducer,j!==null))try{var se=g.lastRenderedState,Ae=j(se,w);if(F.hasEagerState=!0,F.eagerState=Ae,Oo(Ae,se))return Nt(u,g,F,0),Ht===null&&dh(),!1}catch{}finally{}if(w=df(u,g,F,C),w!==null)return Qr(w,u,C),ou(w,g,C),!0}return!1}function Od(u,g,w,C){if(C={lane:2,revertLane:q_(),gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null},Dh(u)){if(g)throw Error(p(479))}else g=df(u,w,C,2),g!==null&&Qr(g,u,2)}function Dh(u){var g=u.alternate;return u===Lt||g!==null&&g===Lt}function Ph(u,g){Ja=Kl=!0;var w=u.pending;w===null?g.next=g:(g.next=w.next,w.next=g),u.pending=g}function ou(u,g,w){if((w&4194048)!==0){var C=g.lanes;C&=u.pendingLanes,w|=C,g.lanes=w,Vc(u,w)}}var Oh={readContext:zs,use:Md,useCallback:Os,useContext:Os,useEffect:Os,useImperativeHandle:Os,useLayoutEffect:Os,useInsertionEffect:Os,useMemo:Os,useReducer:Os,useRef:Os,useState:Os,useDebugValue:Os,useDeferredValue:Os,useTransition:Os,useSyncExternalStore:Os,useId:Os,useHostTransitionStatus:Os,useFormState:Os,useActionState:Os,useOptimistic:Os,useMemoCache:Os,useCacheRefresh:Os};Oh.useEffectEvent=Os;var il={readContext:zs,use:Md,useCallback:function(u,g){return aa().memoizedState=[u,g===void 0?null:g],u},useContext:zs,useEffect:kf,useImperativeHandle:function(u,g,w){w=w!=null?w.concat([u]):null,Dd(4194308,4,hg.bind(null,g,u),w)},useLayoutEffect:function(u,g){return Dd(4194308,4,u,g)},useInsertionEffect:function(u,g){Dd(4,2,u,g)},useMemo:function(u,g){var w=aa();g=g===void 0?null:g;var C=u();if(Ai){Co(!0);try{u()}finally{Co(!1)}}return w.memoizedState=[C,g],C},useReducer:function(u,g,w){var C=aa();if(w!==void 0){var F=w(g);if(Ai){Co(!0);try{w(g)}finally{Co(!1)}}}else F=g;return C.memoizedState=C.baseState=F,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u,lastRenderedState:F},C.queue=u,u=u.dispatch=tl.bind(null,Lt,u),[C.memoizedState,u]},useRef:function(u){var g=aa();return u={current:u},g.memoizedState=u},useState:function(u){u=ti(u);var g=u.queue,w=su.bind(null,Lt,g);return g.dispatch=w,[u.memoizedState,w]},useDebugValue:Eo,useDeferredValue:function(u,g){var w=aa();return Tr(w,u,g)},useTransition:function(){var u=ti(!1);return u=jp.bind(null,Lt,u.queue,!0,!1),aa().memoizedState=u,[!1,u]},useSyncExternalStore:function(u,g,w){var C=Lt,F=aa();if(Ir){if(w===void 0)throw Error(p(407));w=w()}else{if(w=g(),Ht===null)throw Error(p(349));(_t&127)!==0||Mc(C,g,w)}F.memoizedState=w;var j={value:w,getSnapshot:g};return F.queue=j,kf(el.bind(null,C,j,u),[u]),C.flags|=2048,zo(9,{destroy:void 0},Np.bind(null,C,j,w,g),null),w},useId:function(){var u=aa(),g=Ht.identifierPrefix;if(Ir){var w=$l,C=yc;w=(C&~(1<<32-Ts(C)-1)).toString(32)+w,g="_"+g+"R_"+w,w=Id++,0<w&&(g+="H"+w.toString(32)),g+="_"}else w=kp++,g="_"+g+"r_"+w.toString(32)+"_";return u.memoizedState=g},useHostTransitionStatus:Ff,useFormState:Ah,useActionState:Ah,useOptimistic:function(u){var g=aa();g.memoizedState=g.baseState=u;var w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return g.queue=w,g=Od.bind(null,Lt,!0,w),w.dispatch=g,[u,g]},useMemoCache:la,useCacheRefresh:function(){return aa().memoizedState=qp.bind(null,Lt)},useEffectEvent:function(u){var g=aa(),w={impl:u};return g.memoizedState=w,function(){if((wt&2)!==0)throw Error(p(440));return w.impl.apply(void 0,arguments)}}},Nf={readContext:zs,use:Md,useCallback:k_,useContext:zs,useEffect:Ch,useImperativeHandle:z_,useInsertionEffect:ug,useLayoutEffect:L_,useMemo:Pd,useReducer:ku,useRef:Up,useState:function(){return ku(Yn)},useDebugValue:Eo,useDeferredValue:function(u,g){var w=ks();return hn(w,as.memoizedState,u,g)},useTransition:function(){var u=ku(Yn)[0],g=ks().memoizedState;return[typeof u=="boolean"?u:Th(u),g]},useSyncExternalStore:ag,useId:Gp,useHostTransitionStatus:Ff,useFormState:Ih,useActionState:Ih,useOptimistic:function(u,g){var w=ks();return Eh(w,as,u,g)},useMemoCache:la,useCacheRefresh:Bf};Nf.useEffectEvent=cg;var Vf={readContext:zs,use:Md,useCallback:k_,useContext:zs,useEffect:Ch,useImperativeHandle:z_,useInsertionEffect:ug,useLayoutEffect:L_,useMemo:Pd,useReducer:Bp,useRef:Up,useState:function(){return Bp(Yn)},useDebugValue:Eo,useDeferredValue:function(u,g){var w=ks();return as===null?Tr(w,u,g):hn(w,as.memoizedState,u,g)},useTransition:function(){var u=Bp(Yn)[0],g=ks().memoizedState;return[typeof u=="boolean"?u:Th(u),g]},useSyncExternalStore:ag,useId:Gp,useHostTransitionStatus:Ff,useFormState:lg,useActionState:lg,useOptimistic:function(u,g){var w=ks();return as!==null?Eh(w,as,u,g):(w.baseState=u,[u,w.queue.dispatch])},useMemoCache:la,useCacheRefresh:Bf};Vf.useEffectEvent=cg;function Vu(u,g,w,C){g=u.memoizedState,w=w(C,g),w=w==null?g:ce({},g,w),u.memoizedState=w,u.lanes===0&&(u.updateQueue.baseState=w)}var Uu={enqueueSetState:function(u,g,w){u=u._reactInternals;var C=ls(),F=Ec(C);F.payload=g,w!=null&&(F.callback=w),g=Sc(u,F,C),g!==null&&(Qr(g,u,C),Lu(g,u,C))},enqueueReplaceState:function(u,g,w){u=u._reactInternals;var C=ls(),F=Ec(C);F.tag=1,F.payload=g,w!=null&&(F.callback=w),g=Sc(u,F,C),g!==null&&(Qr(g,u,C),Lu(g,u,C))},enqueueForceUpdate:function(u,g){u=u._reactInternals;var w=ls(),C=Ec(w);C.tag=2,g!=null&&(C.callback=g),g=Sc(u,C,w),g!==null&&(Qr(g,u,w),Lu(g,u,w))}};function Cr(u,g,w,C,F,j,se){return u=u.stateNode,typeof u.shouldComponentUpdate=="function"?u.shouldComponentUpdate(C,j,se):g.prototype&&g.prototype.isPureReactComponent?!Ka(w,C)||!Ka(F,j):!0}function Lh(u,g,w,C){u=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(w,C),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(w,C),g.state!==u&&Uu.enqueueReplaceState(g,g.state,null)}function au(u,g){var w=g;if("ref"in g){w={};for(var C in g)C!=="ref"&&(w[C]=g[C])}if(u=u.defaultProps){w===g&&(w=ce({},w));for(var F in u)w[F]===void 0&&(w[F]=u[F])}return w}function Hp(u){Zc(u)}function ju(u){console.error(u)}function $p(u){Zc(u)}function Gu(u,g){try{var w=u.onUncaughtError;w(g.value,{componentStack:g.stack})}catch(C){setTimeout(function(){throw C})}}function Wp(u,g,w){try{var C=u.onCaughtError;C(w.value,{componentStack:w.stack,errorBoundary:g.tag===1?g.stateNode:null})}catch(F){setTimeout(function(){throw F})}}function Pc(u,g,w){return w=Ec(w),w.tag=3,w.payload={element:null},w.callback=function(){Gu(u,g)},w}function Zp(u){return u=Ec(u),u.tag=3,u}function Uf(u,g,w,C){var F=w.type.getDerivedStateFromError;if(typeof F=="function"){var j=C.value;u.payload=function(){return F(j)},u.callback=function(){Wp(g,w,C)}}var se=w.stateNode;se!==null&&typeof se.componentDidCatch=="function"&&(u.callback=function(){Wp(g,w,C),typeof F!="function"&&(wn===null?wn=new Set([this]):wn.add(this));var Ae=C.stack;this.componentDidCatch(C.value,{componentStack:Ae!==null?Ae:""})})}function Xp(u,g,w,C,F){if(w.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){if(g=w.alternate,g!==null&&Cu(g,w,F,!0),w=Zo.current,w!==null){switch(w.tag){case 31:case 13:return To===null?Sl():w.alternate===null&&Gi===0&&(Gi=3),w.flags&=-257,w.flags|=65536,w.lanes=F,C===Lp?w.flags|=16384:(g=w.updateQueue,g===null?w.updateQueue=new Set([C]):g.add(C),U_(u,C,F)),!1;case 22:return w.flags|=65536,C===Lp?w.flags|=16384:(g=w.updateQueue,g===null?(g={transitions:null,markerInstances:null,retryQueue:new Set([C])},w.updateQueue=g):(w=g.retryQueue,w===null?g.retryQueue=new Set([C]):w.add(C)),U_(u,C,F)),!1}throw Error(p(435,w.tag))}return U_(u,C,F),Sl(),!1}if(Ir)return g=Zo.current,g!==null?((g.flags&65536)===0&&(g.flags|=256),g.flags|=65536,g.lanes=F,C!==Au&&(u=Error(p(422),{cause:C}),yd(ka(u,w)))):(C!==Au&&(g=Error(p(423),{cause:C}),yd(ka(g,w))),u=u.current.alternate,u.flags|=65536,F&=-F,u.lanes|=F,C=ka(C,w),F=Pc(u.stateNode,C,F),Ed(u,F),Gi!==4&&(Gi=2)),!1;var j=Error(p(520),{cause:C});if(j=ka(j,w),_n===null?_n=[j]:_n.push(j),Gi!==4&&(Gi=2),g===null)return!0;C=ka(C,w),w=g;do{switch(w.tag){case 3:return w.flags|=65536,u=F&-F,w.lanes|=u,u=Pc(w.stateNode,C,u),Ed(w,u),!1;case 1:if(g=w.type,j=w.stateNode,(w.flags&128)===0&&(typeof g.getDerivedStateFromError=="function"||j!==null&&typeof j.componentDidCatch=="function"&&(wn===null||!wn.has(j))))return w.flags|=65536,F&=-F,w.lanes|=F,F=Zp(F),Uf(F,u,w,C),Ed(w,F),!1}w=w.return}while(w!==null);return!1}var qu=Error(p(461)),$s=!1;function mo(u,g,w,C){g.child=u===null?Ou(g,null,w,C):Tc(g,u.child,w,C)}function Kp(u,g,w,C,F){w=w.render;var j=g.ref;if("ref"in C){var se={};for(var Ae in C)Ae!=="ref"&&(se[Ae]=C[Ae])}else se=C;return bc(g),C=Fp(u,g,w,se,j,F),Ae=Pf(),u!==null&&!$s?(Lo(u,g,F),Tl(u,g,F)):(Ir&&Ae&&mf(g),g.flags|=1,mo(u,g,C,F),g.child)}function dg(u,g,w,C,F){if(u===null){var j=w.type;return typeof j=="function"&&!za(j)&&j.defaultProps===void 0&&w.compare===null?(g.tag=15,g.type=j,jf(u,g,j,C,F)):(u=Sp(w.type,null,C,g,g.mode,F),u.ref=g.ref,u.return=g,g.child=u)}if(j=u.child,!Na(u,F)){var se=j.memoizedProps;if(w=w.compare,w=w!==null?w:Ka,w(se,C)&&u.ref===g.ref)return Tl(u,g,F)}return g.flags|=1,u=an(j,C),u.ref=g.ref,u.return=g,g.child=u}function jf(u,g,w,C,F){if(u!==null){var j=u.memoizedProps;if(Ka(j,C)&&u.ref===g.ref)if($s=!1,g.pendingProps=C=j,Na(u,F))(u.flags&131072)!==0&&($s=!0);else return g.lanes=u.lanes,Tl(u,g,F)}return Qp(u,g,w,C,F)}function Ld(u,g,w,C){var F=C.children,j=u!==null?u.memoizedState:null;if(u===null&&g.stateNode===null&&(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),C.mode==="hidden"){if((g.flags&128)!==0){if(j=j!==null?j.baseLanes|w:w,u!==null){for(C=g.child=u.child,F=0;C!==null;)F=F|C.lanes|C.childLanes,C=C.sibling;C=F&~j}else C=0,g.child=null;return fg(u,g,j,w,C)}if((w&536870912)!==0)g.memoizedState={baseLanes:0,cachePool:null},u!==null&&Ef(g,j!==null?j.cachePool:null),j!==null?Rf(g,j):Sd(),Mf(g);else return C=g.lanes=536870912,fg(u,g,j!==null?j.baseLanes|w:w,w,C)}else j!==null?(Ef(g,j.cachePool),Rf(g,j),wl(),g.memoizedState=null):(u!==null&&Ef(g,null),Sd(),wl());return mo(u,g,F,w),g.child}function zh(u,g){return u!==null&&u.tag===22||g.stateNode!==null||(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.sibling}function fg(u,g,w,C,F){var j=Dp();return j=j===null?null:{parent:Yr._currentValue,pool:j},g.memoizedState={baseLanes:w,cachePool:j},u!==null&&Ef(g,null),Sd(),Mf(g),u!==null&&Cu(u,g,C,!0),g.childLanes=F,null}function zd(u,g){return g=Jp({mode:g.mode,children:g.children},u.mode),g.ref=u.ref,u.child=g,g.return=u,g}function pg(u,g,w){return Tc(g,u.child,null,w),u=zd(g,g.pendingProps),u.flags|=2,oa(g),g.memoizedState=null,u}function Yp(u,g,w){var C=g.pendingProps,F=(g.flags&128)!==0;if(g.flags&=-129,u===null){if(Ir){if(C.mode==="hidden")return u=zd(g,C),g.lanes=536870912,zh(null,u);if(Ad(g),(u=os)?(u=K_(u,Qa),u=u!==null&&u.data==="&"?u:null,u!==null&&(g.memoizedState={dehydrated:u,treeContext:Hl!==null?{id:yc,overflow:$l}:null,retryLane:536870912,hydrationErrors:null},w=I_(u),w.return=g,g.child=w,ro=g,os=null)):u=null,u===null)throw Zl(g);return g.lanes=536870912,null}return zd(g,C)}var j=u.memoizedState;if(j!==null){var se=j.dehydrated;if(Ad(g),F)if(g.flags&256)g.flags&=-257,g=pg(u,g,w);else if(g.memoizedState!==null)g.child=u.child,g.flags|=128,g=null;else throw Error(p(558));else if($s||Cu(u,g,w,!1),F=(w&u.childLanes)!==0,$s||F){if(C=Ht,C!==null&&(se=gn(C,w),se!==0&&se!==j.retryLane))throw j.retryLane=se,gl(u,se),Qr(C,u,se),qu;Sl(),g=pg(u,g,w)}else u=j.treeContext,os=Lc(se.nextSibling),ro=g,Ir=!0,vc=null,Qa=!1,u!==null&&gh(g,u),g=zd(g,C),g.flags|=4096;return g}return u=an(u.child,{mode:C.mode,children:C.children}),u.ref=g.ref,g.child=u,u.return=g,u}function Gf(u,g){var w=g.ref;if(w===null)u!==null&&u.ref!==null&&(g.flags|=4194816);else{if(typeof w!="function"&&typeof w!="object")throw Error(p(284));(u===null||u.ref!==w)&&(g.flags|=4194816)}}function Qp(u,g,w,C,F){return bc(g),w=Fp(u,g,w,C,void 0,F),C=Pf(),u!==null&&!$s?(Lo(u,g,F),Tl(u,g,F)):(Ir&&C&&mf(g),g.flags|=1,mo(u,g,w,F),g.child)}function mg(u,g,w,C,F,j){return bc(g),g.updateQueue=null,w=D_(g,C,w,F),M_(u),C=Pf(),u!==null&&!$s?(Lo(u,g,j),Tl(u,g,j)):(Ir&&C&&mf(g),g.flags|=1,mo(u,g,w,j),g.child)}function gg(u,g,w,C,F){if(bc(g),g.stateNode===null){var j=gc,se=w.contextType;typeof se=="object"&&se!==null&&(j=zs(se)),j=new w(C,j),g.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,j.updater=Uu,g.stateNode=j,j._reactInternals=g,j=g.stateNode,j.props=C,j.state=g.memoizedState,j.refs={},If(g),se=w.contextType,j.context=typeof se=="object"&&se!==null?zs(se):gc,j.state=g.memoizedState,se=w.getDerivedStateFromProps,typeof se=="function"&&(Vu(g,w,se,C),j.state=g.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(se=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),se!==j.state&&Uu.enqueueReplaceState(j,j.state,null),Ac(g,C,j,F),zu(),j.state=g.memoizedState),typeof j.componentDidMount=="function"&&(g.flags|=4194308),C=!0}else if(u===null){j=g.stateNode;var Ae=g.memoizedProps,Qe=au(w,Ae);j.props=Qe;var Ft=j.context,si=w.contextType;se=gc,typeof si=="object"&&si!==null&&(se=zs(si));var hi=w.getDerivedStateFromProps;si=typeof hi=="function"||typeof j.getSnapshotBeforeUpdate=="function",Ae=g.pendingProps!==Ae,si||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(Ae||Ft!==se)&&Lh(g,j,C,se),Ea=!1;var Ut=g.memoizedState;j.state=Ut,Ac(g,C,j,F),zu(),Ft=g.memoizedState,Ae||Ut!==Ft||Ea?(typeof hi=="function"&&(Vu(g,w,hi,C),Ft=g.memoizedState),(Qe=Ea||Cr(g,w,Qe,C,Ut,Ft,se))?(si||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount()),typeof j.componentDidMount=="function"&&(g.flags|=4194308)):(typeof j.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=C,g.memoizedState=Ft),j.props=C,j.state=Ft,j.context=se,C=Qe):(typeof j.componentDidMount=="function"&&(g.flags|=4194308),C=!1)}else{j=g.stateNode,Td(u,g),se=g.memoizedProps,si=au(w,se),j.props=si,hi=g.pendingProps,Ut=j.context,Ft=w.contextType,Qe=gc,typeof Ft=="object"&&Ft!==null&&(Qe=zs(Ft)),Ae=w.getDerivedStateFromProps,(Ft=typeof Ae=="function"||typeof j.getSnapshotBeforeUpdate=="function")||typeof j.UNSAFE_componentWillReceiveProps!="function"&&typeof j.componentWillReceiveProps!="function"||(se!==hi||Ut!==Qe)&&Lh(g,j,C,Qe),Ea=!1,Ut=g.memoizedState,j.state=Ut,Ac(g,C,j,F),zu();var Zt=g.memoizedState;se!==hi||Ut!==Zt||Ea||u!==null&&u.dependencies!==null&&_h(u.dependencies)?(typeof Ae=="function"&&(Vu(g,w,Ae,C),Zt=g.memoizedState),(si=Ea||Cr(g,w,si,C,Ut,Zt,Qe)||u!==null&&u.dependencies!==null&&_h(u.dependencies))?(Ft||typeof j.UNSAFE_componentWillUpdate!="function"&&typeof j.componentWillUpdate!="function"||(typeof j.componentWillUpdate=="function"&&j.componentWillUpdate(C,Zt,Qe),typeof j.UNSAFE_componentWillUpdate=="function"&&j.UNSAFE_componentWillUpdate(C,Zt,Qe)),typeof j.componentDidUpdate=="function"&&(g.flags|=4),typeof j.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof j.componentDidUpdate!="function"||se===u.memoizedProps&&Ut===u.memoizedState||(g.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||se===u.memoizedProps&&Ut===u.memoizedState||(g.flags|=1024),g.memoizedProps=C,g.memoizedState=Zt),j.props=C,j.state=Zt,j.context=Qe,C=si):(typeof j.componentDidUpdate!="function"||se===u.memoizedProps&&Ut===u.memoizedState||(g.flags|=4),typeof j.getSnapshotBeforeUpdate!="function"||se===u.memoizedProps&&Ut===u.memoizedState||(g.flags|=1024),C=!1)}return j=C,Gf(u,g),C=(g.flags&128)!==0,j||C?(j=g.stateNode,w=C&&typeof w.getDerivedStateFromError!="function"?null:j.render(),g.flags|=1,u!==null&&C?(g.child=Tc(g,u.child,null,F),g.child=Tc(g,null,w,F)):mo(u,g,w,F),g.memoizedState=j.state,u=g.child):u=Tl(u,g,F),u}function _g(u,g,w,C){return Xl(),g.flags|=256,mo(u,g,w,C),g.child}var yg={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vg(u){return{baseLanes:u,cachePool:vh()}}function Lr(u,g,w){return u=u!==null?u.childLanes&~w:0,g&&(u|=Ni),u}function xg(u,g,w){var C=g.pendingProps,F=!1,j=(g.flags&128)!==0,se;if((se=j)||(se=u!==null&&u.memoizedState===null?!1:(Hs.current&2)!==0),se&&(F=!0,g.flags&=-129),se=(g.flags&32)!==0,g.flags&=-33,u===null){if(Ir){if(F?Ic(g):wl(),(u=os)?(u=K_(u,Qa),u=u!==null&&u.data!=="&"?u:null,u!==null&&(g.memoizedState={dehydrated:u,treeContext:Hl!==null?{id:yc,overflow:$l}:null,retryLane:536870912,hydrationErrors:null},w=I_(u),w.return=g,g.child=w,ro=g,os=null)):u=null,u===null)throw Zl(g);return Y_(u)?g.lanes=32:g.lanes=536870912,null}var Ae=C.children;return C=C.fallback,F?(wl(),F=g.mode,Ae=Jp({mode:"hidden",children:Ae},F),C=mh(C,F,w,null),Ae.return=g,C.return=g,Ae.sibling=C,g.child=Ae,C=g.child,C.memoizedState=vg(w),C.childLanes=Lr(u,se,w),g.memoizedState=yg,zh(null,C)):(Ic(g),bg(g,Ae))}var Qe=u.memoizedState;if(Qe!==null&&(Ae=Qe.dehydrated,Ae!==null)){if(j)g.flags&256?(Ic(g),g.flags&=-257,g=wg(u,g,w)):g.memoizedState!==null?(wl(),g.child=u.child,g.flags|=128,g=null):(wl(),Ae=C.fallback,F=g.mode,C=Jp({mode:"visible",children:C.children},F),Ae=mh(Ae,F,w,null),Ae.flags|=2,C.return=g,Ae.return=g,C.sibling=Ae,g.child=C,Tc(g,u.child,null,w),C=g.child,C.memoizedState=vg(w),C.childLanes=Lr(u,se,w),g.memoizedState=yg,g=zh(null,C));else if(Ic(g),Y_(Ae)){if(se=Ae.nextSibling&&Ae.nextSibling.dataset,se)var Ft=se.dgst;se=Ft,C=Error(p(419)),C.stack="",C.digest=se,yd({value:C,source:null,stack:null}),g=wg(u,g,w)}else if($s||Cu(u,g,w,!1),se=(w&u.childLanes)!==0,$s||se){if(se=Ht,se!==null&&(C=gn(se,w),C!==0&&C!==Qe.retryLane))throw Qe.retryLane=C,gl(u,C),Qr(se,u,C),qu;zg(Ae)||Sl(),g=wg(u,g,w)}else zg(Ae)?(g.flags|=192,g.child=u.child,g=null):(u=Qe.treeContext,os=Lc(Ae.nextSibling),ro=g,Ir=!0,vc=null,Qa=!1,u!==null&&gh(g,u),g=bg(g,C.children),g.flags|=4096);return g}return F?(wl(),Ae=C.fallback,F=g.mode,Qe=u.child,Ft=Qe.sibling,C=an(Qe,{mode:"hidden",children:C.children}),C.subtreeFlags=Qe.subtreeFlags&65011712,Ft!==null?Ae=an(Ft,Ae):(Ae=mh(Ae,F,w,null),Ae.flags|=2),Ae.return=g,C.return=g,C.sibling=Ae,g.child=C,zh(null,C),C=g.child,Ae=u.child.memoizedState,Ae===null?Ae=vg(w):(F=Ae.cachePool,F!==null?(Qe=Yr._currentValue,F=F.parent!==Qe?{parent:Qe,pool:Qe}:F):F=vh(),Ae={baseLanes:Ae.baseLanes|w,cachePool:F}),C.memoizedState=Ae,C.childLanes=Lr(u,se,w),g.memoizedState=yg,zh(u.child,C)):(Ic(g),w=u.child,u=w.sibling,w=an(w,{mode:"visible",children:C.children}),w.return=g,w.sibling=null,u!==null&&(se=g.deletions,se===null?(g.deletions=[u],g.flags|=16):se.push(u)),g.child=w,g.memoizedState=null,w)}function bg(u,g){return g=Jp({mode:"visible",children:g},u.mode),g.return=u,u.child=g}function Jp(u,g){return u=sa(22,u,null,g),u.lanes=0,u}function wg(u,g,w){return Tc(g,u.child,null,w),u=bg(g,g.pendingProps.children),u.flags|=2,g.memoizedState=null,u}function kd(u,g,w){u.lanes|=g;var C=u.alternate;C!==null&&(C.lanes|=g),rg(u.return,g,w)}function kh(u,g,w,C,F,j){var se=u.memoizedState;se===null?u.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:C,tail:w,tailMode:F,treeForkCount:j}:(se.isBackwards=g,se.rendering=null,se.renderingStartTime=0,se.last=C,se.tail=w,se.tailMode=F,se.treeForkCount=j)}function em(u,g,w){var C=g.pendingProps,F=C.revealOrder,j=C.tail;C=C.children;var se=Hs.current,Ae=(se&2)!==0;if(Ae?(se=se&1|2,g.flags|=128):se&=1,ai(Hs,se),mo(u,g,C,w),C=Ir?ff:0,!Ae&&u!==null&&(u.flags&128)!==0)e:for(u=g.child;u!==null;){if(u.tag===13)u.memoizedState!==null&&kd(u,w,g);else if(u.tag===19)kd(u,w,g);else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===g)break e;for(;u.sibling===null;){if(u.return===null||u.return===g)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}switch(F){case"forwards":for(w=g.child,F=null;w!==null;)u=w.alternate,u!==null&&Cc(u)===null&&(F=w),w=w.sibling;w=F,w===null?(F=g.child,g.child=null):(F=w.sibling,w.sibling=null),kh(g,!1,F,w,j,C);break;case"backwards":case"unstable_legacy-backwards":for(w=null,F=g.child,g.child=null;F!==null;){if(u=F.alternate,u!==null&&Cc(u)===null){g.child=F;break}u=F.sibling,F.sibling=w,w=F,F=u}kh(g,!0,w,null,j,C);break;case"together":kh(g,!1,null,null,void 0,C);break;default:g.memoizedState=null}return g.child}function Tl(u,g,w){if(u!==null&&(g.dependencies=u.dependencies),Fn|=g.lanes,(w&g.childLanes)===0)if(u!==null){if(Cu(u,g,w,!1),(w&g.childLanes)===0)return null}else return null;if(u!==null&&g.child!==u.child)throw Error(p(153));if(g.child!==null){for(u=g.child,w=an(u,u.pendingProps),g.child=w,w.return=g;u.sibling!==null;)u=u.sibling,w=w.sibling=an(u,u.pendingProps),w.return=g;w.sibling=null}return g.child}function Na(u,g){return(u.lanes&g)!==0?!0:(u=u.dependencies,!!(u!==null&&_h(u)))}function tm(u,g,w){switch(g.tag){case 3:Mr(g,g.stateNode.containerInfo),Iu(g,Yr,u.memoizedState.cache),Xl();break;case 27:case 5:hr(g);break;case 4:Mr(g,g.stateNode.containerInfo);break;case 10:Iu(g,g.type,g.memoizedProps.value);break;case 31:if(g.memoizedState!==null)return g.flags|=128,Ad(g),null;break;case 13:var C=g.memoizedState;if(C!==null)return C.dehydrated!==null?(Ic(g),g.flags|=128,null):(w&g.child.childLanes)!==0?xg(u,g,w):(Ic(g),u=Tl(u,g,w),u!==null?u.sibling:null);Ic(g);break;case 19:var F=(u.flags&128)!==0;if(C=(w&g.childLanes)!==0,C||(Cu(u,g,w,!1),C=(w&g.childLanes)!==0),F){if(C)return em(u,g,w);g.flags|=128}if(F=g.memoizedState,F!==null&&(F.rendering=null,F.tail=null,F.lastEffect=null),ai(Hs,Hs.current),C)break;return null;case 22:return g.lanes=0,Ld(u,g,w,g.pendingProps);case 24:Iu(g,Yr,u.memoizedState.cache)}return Tl(u,g,w)}function ys(u,g,w){if(u!==null)if(u.memoizedProps!==g.pendingProps)$s=!0;else{if(!Na(u,w)&&(g.flags&128)===0)return $s=!1,tm(u,g,w);$s=(u.flags&131072)!==0}else $s=!1,Ir&&(g.flags&1048576)!==0&&pf(g,ff,g.index);switch(g.lanes=0,g.tag){case 16:e:{var C=g.pendingProps;if(u=eu(g.elementType),g.type=u,typeof u=="function")za(u)?(C=au(u,C),g.tag=1,g=gg(null,g,u,C,w)):(g.tag=0,g=Qp(null,g,u,C,w));else{if(u!=null){var F=u.$$typeof;if(F===ei){g.tag=11,g=Kp(null,g,u,C,w);break e}else if(F===qe){g.tag=14,g=dg(null,g,u,C,w);break e}}throw g=ur(u)||u,Error(p(306,g,""))}}return g;case 0:return Qp(u,g,g.type,g.pendingProps,w);case 1:return C=g.type,F=au(C,g.pendingProps),gg(u,g,C,F,w);case 3:e:{if(Mr(g,g.stateNode.containerInfo),u===null)throw Error(p(387));C=g.pendingProps;var j=g.memoizedState;F=j.element,Td(u,g),Ac(g,C,null,w);var se=g.memoizedState;if(C=se.cache,Iu(g,Yr,C),C!==j.cache&&_f(g,[Yr],w,!0),zu(),C=se.element,j.isDehydrated)if(j={element:C,isDehydrated:!1,cache:se.cache},g.updateQueue.baseState=j,g.memoizedState=j,g.flags&256){g=_g(u,g,C,w);break e}else if(C!==F){F=ka(Error(p(424)),g),yd(F),g=_g(u,g,C,w);break e}else{switch(u=g.stateNode.containerInfo,u.nodeType){case 9:u=u.body;break;default:u=u.nodeName==="HTML"?u.ownerDocument.body:u}for(os=Lc(u.firstChild),ro=g,Ir=!0,vc=null,Qa=!0,w=Ou(g,null,C,w),g.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling}else{if(Xl(),C===F){g=Tl(u,g,w);break e}mo(u,g,C,w)}g=g.child}return g;case 26:return Gf(u,g),u===null?(w=Ex(g.type,null,g.pendingProps,null))?g.memoizedState=w:Ir||(w=g.type,u=g.pendingProps,C=W_(kn.current).createElement(w),C[J]=g,C[de]=u,Ia(C,w,u),gi(C),g.stateNode=C):g.memoizedState=Ex(g.type,u.memoizedProps,g.pendingProps,u.memoizedState),null;case 27:return hr(g),u===null&&Ir&&(C=g.stateNode=wv(g.type,g.pendingProps,kn.current),ro=g,Qa=!0,F=os,Uh(g.type)?(Ca=F,os=Lc(C.firstChild)):os=F),mo(u,g,g.pendingProps.children,w),Gf(u,g),u===null&&(g.flags|=4194304),g.child;case 5:return u===null&&Ir&&((F=C=os)&&(C=K1(C,g.type,g.pendingProps,Qa),C!==null?(g.stateNode=C,ro=g,os=Lc(C.firstChild),Qa=!1,F=!0):F=!1),F||Zl(g)),hr(g),F=g.type,j=g.pendingProps,se=u!==null?u.memoizedProps:null,C=j.children,yv(F,j)?C=null:se!==null&&yv(F,se)&&(g.flags|=32),g.memoizedState!==null&&(F=Fp(u,g,Ba,null,null,w),Vg._currentValue=F),Gf(u,g),mo(u,g,C,w),g.child;case 6:return u===null&&Ir&&((u=w=os)&&(w=vx(w,g.pendingProps,Qa),w!==null?(g.stateNode=w,ro=g,os=null,u=!0):u=!1),u||Zl(g)),null;case 13:return xg(u,g,w);case 4:return Mr(g,g.stateNode.containerInfo),C=g.pendingProps,u===null?g.child=Tc(g,null,C,w):mo(u,g,C,w),g.child;case 11:return Kp(u,g,g.type,g.pendingProps,w);case 7:return mo(u,g,g.pendingProps,w),g.child;case 8:return mo(u,g,g.pendingProps.children,w),g.child;case 12:return mo(u,g,g.pendingProps.children,w),g.child;case 10:return C=g.pendingProps,Iu(g,g.type,C.value),mo(u,g,C.children,w),g.child;case 9:return F=g.type._context,C=g.pendingProps.children,bc(g),F=zs(F),C=C(F),g.flags|=1,mo(u,g,C,w),g.child;case 14:return dg(u,g,g.type,g.pendingProps,w);case 15:return jf(u,g,g.type,g.pendingProps,w);case 19:return em(u,g,w);case 31:return Yp(u,g,w);case 22:return Ld(u,g,w,g.pendingProps);case 24:return bc(g),C=zs(Yr),u===null?(F=Dp(),F===null&&(F=Ht,j=vf(),F.pooledCache=j,j.refCount++,j!==null&&(F.pooledCacheLanes|=w),F=j),g.memoizedState={parent:C,cache:F},If(g),Iu(g,Yr,F)):((u.lanes&w)!==0&&(Td(u,g),Ac(g,null,null,w),zu()),F=u.memoizedState,j=g.memoizedState,F.parent!==C?(F={parent:C,cache:C},g.memoizedState=F,g.lanes===0&&(g.memoizedState=g.updateQueue.baseState=F),Iu(g,Yr,C)):(C=j.cache,Iu(g,Yr,C),C!==F.cache&&_f(g,[Yr],w,!0))),mo(u,g,g.pendingProps.children,w),g.child;case 29:throw g.pendingProps}throw Error(p(156,g.tag))}function ko(u){u.flags|=4}function Hu(u,g,w,C,F){if((g=(u.mode&32)!==0)&&(g=!1),g){if(u.flags|=16777216,(F&335544128)===F)if(u.stateNode.complete)u.flags|=8192;else if($r())u.flags|=8192;else throw tu=Lp,Pp}else u.flags&=-16777217}function Fd(u,g){if(g.type!=="stylesheet"||(g.state.loading&4)!==0)u.flags&=-16777217;else if(u.flags|=16777216,!ey(g))if($r())u.flags|=8192;else throw tu=Lp,Pp}function Bd(u,g){g!==null&&(u.flags|=4),u.flags&16384&&(g=u.tag!==22?ad():536870912,u.lanes|=g,Bn|=g)}function Nd(u,g){if(!Ir)switch(u.tailMode){case"hidden":g=u.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?u.tail=null:w.sibling=null;break;case"collapsed":w=u.tail;for(var C=null;w!==null;)w.alternate!==null&&(C=w),w=w.sibling;C===null?g||u.tail===null?u.tail=null:u.tail.sibling=null:C.sibling=null}}function fs(u){var g=u.alternate!==null&&u.alternate.child===u.child,w=0,C=0;if(g)for(var F=u.child;F!==null;)w|=F.lanes|F.childLanes,C|=F.subtreeFlags&65011712,C|=F.flags&65011712,F.return=u,F=F.sibling;else for(F=u.child;F!==null;)w|=F.lanes|F.childLanes,C|=F.subtreeFlags,C|=F.flags,F.return=u,F=F.sibling;return u.subtreeFlags|=C,u.childLanes=w,g}function sv(u,g,w){var C=g.pendingProps;switch(Kc(g),g.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fs(g),null;case 1:return fs(g),null;case 3:return w=g.stateNode,C=null,u!==null&&(C=u.memoizedState.cache),g.memoizedState.cache!==C&&(g.flags|=2048),xc(Yr),Ki(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(u===null||u.child===null)&&(Yc(g)?ko(g):u===null||u.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Cp())),fs(g),null;case 26:var F=g.type,j=g.memoizedState;return u===null?(ko(g),j!==null?(fs(g),Fd(g,j)):(fs(g),Hu(g,F,null,C,w))):j?j!==u.memoizedState?(ko(g),fs(g),Fd(g,j)):(fs(g),g.flags&=-16777217):(u=u.memoizedProps,u!==C&&ko(g),fs(g),Hu(g,F,u,C,w)),null;case 27:if(Wr(g),w=kn.current,F=g.type,u!==null&&g.stateNode!=null)u.memoizedProps!==C&&ko(g);else{if(!C){if(g.stateNode===null)throw Error(p(166));return fs(g),null}u=_i.current,Yc(g)?gf(g):(u=wv(F,C,w),g.stateNode=u,ko(g))}return fs(g),null;case 5:if(Wr(g),F=g.type,u!==null&&g.stateNode!=null)u.memoizedProps!==C&&ko(g);else{if(!C){if(g.stateNode===null)throw Error(p(166));return fs(g),null}if(j=_i.current,Yc(g))gf(g);else{var se=W_(kn.current);switch(j){case 1:j=se.createElementNS("http://www.w3.org/2000/svg",F);break;case 2:j=se.createElementNS("http://www.w3.org/1998/Math/MathML",F);break;default:switch(F){case"svg":j=se.createElementNS("http://www.w3.org/2000/svg",F);break;case"math":j=se.createElementNS("http://www.w3.org/1998/Math/MathML",F);break;case"script":j=se.createElement("div"),j.innerHTML="<script><\/script>",j=j.removeChild(j.firstChild);break;case"select":j=typeof C.is=="string"?se.createElement("select",{is:C.is}):se.createElement("select"),C.multiple?j.multiple=!0:C.size&&(j.size=C.size);break;default:j=typeof C.is=="string"?se.createElement(F,{is:C.is}):se.createElement(F)}}j[J]=g,j[de]=C;e:for(se=g.child;se!==null;){if(se.tag===5||se.tag===6)j.appendChild(se.stateNode);else if(se.tag!==4&&se.tag!==27&&se.child!==null){se.child.return=se,se=se.child;continue}if(se===g)break e;for(;se.sibling===null;){if(se.return===null||se.return===g)break e;se=se.return}se.sibling.return=se.return,se=se.sibling}g.stateNode=j;e:switch(Ia(j,F,C),F){case"button":case"input":case"select":case"textarea":C=!!C.autoFocus;break e;case"img":C=!0;break e;default:C=!1}C&&ko(g)}}return fs(g),Hu(g,g.type,u===null?null:u.memoizedProps,g.pendingProps,w),null;case 6:if(u&&g.stateNode!=null)u.memoizedProps!==C&&ko(g);else{if(typeof C!="string"&&g.stateNode===null)throw Error(p(166));if(u=kn.current,Yc(g)){if(u=g.stateNode,w=g.memoizedProps,C=null,F=ro,F!==null)switch(F.tag){case 27:case 5:C=F.memoizedProps}u[J]=g,u=!!(u.nodeValue===w||C!==null&&C.suppressHydrationWarning===!0||lm(u.nodeValue,w)),u||Zl(g,!0)}else u=W_(u).createTextNode(C),u[J]=g,g.stateNode=u}return fs(g),null;case 31:if(w=g.memoizedState,u===null||u.memoizedState!==null){if(C=Yc(g),w!==null){if(u===null){if(!C)throw Error(p(318));if(u=g.memoizedState,u=u!==null?u.dehydrated:null,!u)throw Error(p(557));u[J]=g}else Xl(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;fs(g),u=!1}else w=Cp(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=w),u=!0;if(!u)return g.flags&256?(oa(g),g):(oa(g),null);if((g.flags&128)!==0)throw Error(p(558))}return fs(g),null;case 13:if(C=g.memoizedState,u===null||u.memoizedState!==null&&u.memoizedState.dehydrated!==null){if(F=Yc(g),C!==null&&C.dehydrated!==null){if(u===null){if(!F)throw Error(p(318));if(F=g.memoizedState,F=F!==null?F.dehydrated:null,!F)throw Error(p(317));F[J]=g}else Xl(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;fs(g),F=!1}else F=Cp(),u!==null&&u.memoizedState!==null&&(u.memoizedState.hydrationErrors=F),F=!0;if(!F)return g.flags&256?(oa(g),g):(oa(g),null)}return oa(g),(g.flags&128)!==0?(g.lanes=w,g):(w=C!==null,u=u!==null&&u.memoizedState!==null,w&&(C=g.child,F=null,C.alternate!==null&&C.alternate.memoizedState!==null&&C.alternate.memoizedState.cachePool!==null&&(F=C.alternate.memoizedState.cachePool.pool),j=null,C.memoizedState!==null&&C.memoizedState.cachePool!==null&&(j=C.memoizedState.cachePool.pool),j!==F&&(C.flags|=2048)),w!==u&&w&&(g.child.flags|=8192),Bd(g,g.updateQueue),fs(g),null);case 4:return Ki(),u===null&&yo(g.stateNode.containerInfo),fs(g),null;case 10:return xc(g.type),fs(g),null;case 19:if(Yt(Hs),C=g.memoizedState,C===null)return fs(g),null;if(F=(g.flags&128)!==0,j=C.rendering,j===null)if(F)Nd(C,!1);else{if(Gi!==0||u!==null&&(u.flags&128)!==0)for(u=g.child;u!==null;){if(j=Cc(u),j!==null){for(g.flags|=128,Nd(C,!1),u=j.updateQueue,g.updateQueue=u,Bd(g,u),g.subtreeFlags=0,u=w,w=g.child;w!==null;)ph(w,u),w=w.sibling;return ai(Hs,Hs.current&1|2),Ir&&Wl(g,C.treeForkCount),g.child}u=u.sibling}C.tail!==null&&$i()>nn&&(g.flags|=128,F=!0,Nd(C,!1),g.lanes=4194304)}else{if(!F)if(u=Cc(j),u!==null){if(g.flags|=128,F=!0,u=u.updateQueue,g.updateQueue=u,Bd(g,u),Nd(C,!0),C.tail===null&&C.tailMode==="hidden"&&!j.alternate&&!Ir)return fs(g),null}else 2*$i()-C.renderingStartTime>nn&&w!==536870912&&(g.flags|=128,F=!0,Nd(C,!1),g.lanes=4194304);C.isBackwards?(j.sibling=g.child,g.child=j):(u=C.last,u!==null?u.sibling=j:g.child=j,C.last=j)}return C.tail!==null?(u=C.tail,C.rendering=u,C.tail=u.sibling,C.renderingStartTime=$i(),u.sibling=null,w=Hs.current,ai(Hs,F?w&1|2:w&1),Ir&&Wl(g,C.treeForkCount),u):(fs(g),null);case 22:case 23:return oa(g),bl(),C=g.memoizedState!==null,u!==null?u.memoizedState!==null!==C&&(g.flags|=8192):C&&(g.flags|=8192),C?(w&536870912)!==0&&(g.flags&128)===0&&(fs(g),g.subtreeFlags&6&&(g.flags|=8192)):fs(g),w=g.updateQueue,w!==null&&Bd(g,w.retryQueue),w=null,u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(w=u.memoizedState.cachePool.pool),C=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(C=g.memoizedState.cachePool.pool),C!==w&&(g.flags|=2048),u!==null&&Yt(wc),null;case 24:return w=null,u!==null&&(w=u.memoizedState.cache),g.memoizedState.cache!==w&&(g.flags|=2048),xc(Yr),fs(g),null;case 25:return null;case 30:return null}throw Error(p(156,g.tag))}function F_(u,g){switch(Kc(g),g.tag){case 1:return u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 3:return xc(Yr),Ki(),u=g.flags,(u&65536)!==0&&(u&128)===0?(g.flags=u&-65537|128,g):null;case 26:case 27:case 5:return Wr(g),null;case 31:if(g.memoizedState!==null){if(oa(g),g.alternate===null)throw Error(p(340));Xl()}return u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 13:if(oa(g),u=g.memoizedState,u!==null&&u.dehydrated!==null){if(g.alternate===null)throw Error(p(340));Xl()}return u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 19:return Yt(Hs),null;case 4:return Ki(),null;case 10:return xc(g.type),null;case 22:case 23:return oa(g),bl(),u!==null&&Yt(wc),u=g.flags,u&65536?(g.flags=u&-65537|128,g):null;case 24:return xc(Yr),null;case 25:return null;default:return null}}function im(u,g){switch(Kc(g),g.tag){case 3:xc(Yr),Ki();break;case 26:case 27:case 5:Wr(g);break;case 4:Ki();break;case 31:g.memoizedState!==null&&oa(g);break;case 13:oa(g);break;case 19:Yt(Hs);break;case 10:xc(g.type);break;case 22:case 23:oa(g),bl(),u!==null&&Yt(wc);break;case 24:xc(Yr)}}function Fh(u,g){try{var w=g.updateQueue,C=w!==null?w.lastEffect:null;if(C!==null){var F=C.next;w=F;do{if((w.tag&u)===u){C=void 0;var j=w.create,se=w.inst;C=j(),se.destroy=C}w=w.next}while(w!==F)}}catch(Ae){kr(g,g.return,Ae)}}function Ql(u,g,w){try{var C=g.updateQueue,F=C!==null?C.lastEffect:null;if(F!==null){var j=F.next;C=j;do{if((C.tag&u)===u){var se=C.inst,Ae=se.destroy;if(Ae!==void 0){se.destroy=void 0,F=g;var Qe=w,Ft=Ae;try{Ft()}catch(si){kr(F,Qe,si)}}}C=C.next}while(C!==j)}}catch(si){kr(g,g.return,si)}}function qf(u){var g=u.updateQueue;if(g!==null){var w=u.stateNode;try{iu(g,w)}catch(C){kr(u,u.return,C)}}}function Vd(u,g,w){w.props=au(u.type,u.memoizedProps),w.state=u.memoizedState;try{w.componentWillUnmount()}catch(C){kr(u,g,C)}}function nl(u,g){try{var w=u.ref;if(w!==null){switch(u.tag){case 26:case 27:case 5:var C=u.stateNode;break;case 30:C=u.stateNode;break;default:C=u.stateNode}typeof w=="function"?u.refCleanup=w(C):w.current=C}}catch(F){kr(u,g,F)}}function go(u,g){var w=u.ref,C=u.refCleanup;if(w!==null)if(typeof C=="function")try{C()}catch(F){kr(u,g,F)}finally{u.refCleanup=null,u=u.alternate,u!=null&&(u.refCleanup=null)}else if(typeof w=="function")try{w(null)}catch(F){kr(u,g,F)}else w.current=null}function So(u){var g=u.type,w=u.memoizedProps,C=u.stateNode;try{e:switch(g){case"button":case"input":case"select":case"textarea":w.autoFocus&&C.focus();break e;case"img":w.src?C.src=w.src:w.srcSet&&(C.srcset=w.srcSet)}}catch(F){kr(u,u.return,F)}}function Jl(u,g,w){try{var C=u.stateNode;Z1(C,u.type,w,g),C[de]=g}catch(F){kr(u,u.return,F)}}function El(u){return u.tag===5||u.tag===3||u.tag===26||u.tag===27&&Uh(u.type)||u.tag===4}function Tg(u){e:for(;;){for(;u.sibling===null;){if(u.return===null||El(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==5&&u.tag!==6&&u.tag!==18;){if(u.tag===27&&Uh(u.type)||u.flags&2||u.child===null||u.tag===4)continue e;u.child.return=u,u=u.child}if(!(u.flags&2))return u.stateNode}}function Eg(u,g,w){var C=u.tag;if(C===5||C===6)u=u.stateNode,g?(w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w).insertBefore(u,g):(g=w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w,g.appendChild(u),w=w._reactRootContainer,w!=null||g.onclick!==null||(g.onclick=Pa));else if(C!==4&&(C===27&&Uh(u.type)&&(w=u.stateNode,g=null),u=u.child,u!==null))for(Eg(u,g,w),u=u.sibling;u!==null;)Eg(u,g,w),u=u.sibling}function nm(u,g,w){var C=u.tag;if(C===5||C===6)u=u.stateNode,g?w.insertBefore(u,g):w.appendChild(u);else if(C!==4&&(C===27&&Uh(u.type)&&(w=u.stateNode),u=u.child,u!==null))for(nm(u,g,w),u=u.sibling;u!==null;)nm(u,g,w),u=u.sibling}function B_(u){var g=u.stateNode,w=u.memoizedProps;try{for(var C=u.type,F=g.attributes;F.length;)g.removeAttributeNode(F[0]);Ia(g,C,w),g[J]=u,g[de]=w}catch(j){kr(u,u.return,j)}}var ec=!1,Fr=!1,d=!1,t=typeof WeakSet=="function"?WeakSet:Set,o=null;function f(u,g){if(u=u.containerInfo,gv=Kf,u=fd(u),mc(u)){if("selectionStart"in u)var w={start:u.selectionStart,end:u.selectionEnd};else e:{w=(w=u.ownerDocument)&&w.defaultView||window;var C=w.getSelection&&w.getSelection();if(C&&C.rangeCount!==0){w=C.anchorNode;var F=C.anchorOffset,j=C.focusNode;C=C.focusOffset;try{w.nodeType,j.nodeType}catch{w=null;break e}var se=0,Ae=-1,Qe=-1,Ft=0,si=0,hi=u,Ut=null;t:for(;;){for(var Zt;hi!==w||F!==0&&hi.nodeType!==3||(Ae=se+F),hi!==j||C!==0&&hi.nodeType!==3||(Qe=se+C),hi.nodeType===3&&(se+=hi.nodeValue.length),(Zt=hi.firstChild)!==null;)Ut=hi,hi=Zt;for(;;){if(hi===u)break t;if(Ut===w&&++Ft===F&&(Ae=se),Ut===j&&++si===C&&(Qe=se),(Zt=hi.nextSibling)!==null)break;hi=Ut,Ut=hi.parentNode}hi=Zt}w=Ae===-1||Qe===-1?null:{start:Ae,end:Qe}}else w=null}w=w||{start:0,end:0}}else w=null;for(Pg={focusedElem:u,selectionRange:w},Kf=!1,o=g;o!==null;)if(g=o,u=g.child,(g.subtreeFlags&1028)!==0&&u!==null)u.return=g,o=u;else for(;o!==null;){switch(g=o,j=g.alternate,u=g.flags,g.tag){case 0:if((u&4)!==0&&(u=g.updateQueue,u=u!==null?u.events:null,u!==null))for(w=0;w<u.length;w++)F=u[w],F.ref.impl=F.nextImpl;break;case 11:case 15:break;case 1:if((u&1024)!==0&&j!==null){u=void 0,w=g,F=j.memoizedProps,j=j.memoizedState,C=w.stateNode;try{var Hi=au(w.type,F);u=C.getSnapshotBeforeUpdate(Hi,j),C.__reactInternalSnapshotBeforeUpdate=u}catch(Tn){kr(w,w.return,Tn)}}break;case 3:if((u&1024)!==0){if(u=g.stateNode.containerInfo,w=u.nodeType,w===9)Zf(u);else if(w===1)switch(u.nodeName){case"HEAD":case"HTML":case"BODY":Zf(u);break;default:u.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((u&1024)!==0)throw Error(p(163))}if(u=g.sibling,u!==null){u.return=g.return,o=u;break}o=g.return}}function y(u,g,w){var C=w.flags;switch(w.tag){case 0:case 11:case 15:he(u,w),C&4&&Fh(5,w);break;case 1:if(he(u,w),C&4)if(u=w.stateNode,g===null)try{u.componentDidMount()}catch(se){kr(w,w.return,se)}else{var F=au(w.type,g.memoizedProps);g=g.memoizedState;try{u.componentDidUpdate(F,g,u.__reactInternalSnapshotBeforeUpdate)}catch(se){kr(w,w.return,se)}}C&64&&qf(w),C&512&&nl(w,w.return);break;case 3:if(he(u,w),C&64&&(u=w.updateQueue,u!==null)){if(g=null,w.child!==null)switch(w.child.tag){case 27:case 5:g=w.child.stateNode;break;case 1:g=w.child.stateNode}try{iu(u,g)}catch(se){kr(w,w.return,se)}}break;case 27:g===null&&C&4&&B_(w);case 26:case 5:he(u,w),g===null&&C&4&&So(w),C&512&&nl(w,w.return);break;case 12:he(u,w);break;case 31:he(u,w),C&4&&k(u,w);break;case 13:he(u,w),C&4&&U(u,w),C&64&&(u=w.memoizedState,u!==null&&(u=u.dehydrated,u!==null&&(w=lv.bind(null,w),jh(u,w))));break;case 22:if(C=w.memoizedState!==null||ec,!C){g=g!==null&&g.memoizedState!==null||Fr,F=ec;var j=Fr;ec=C,(Fr=g)&&!j?we(u,w,(w.subtreeFlags&8772)!==0):he(u,w),ec=F,Fr=j}break;case 30:break;default:he(u,w)}}function x(u){var g=u.alternate;g!==null&&(u.alternate=null,x(g)),u.child=null,u.deletions=null,u.sibling=null,u.tag===5&&(g=u.stateNode,g!==null&&Ot(g)),u.stateNode=null,u.return=null,u.dependencies=null,u.memoizedProps=null,u.memoizedState=null,u.pendingProps=null,u.stateNode=null,u.updateQueue=null}var T=null,A=!1;function R(u,g,w){for(w=w.child;w!==null;)L(u,g,w),w=w.sibling}function L(u,g,w){if(pr&&typeof pr.onCommitFiberUnmount=="function")try{pr.onCommitFiberUnmount(Yo,w)}catch{}switch(w.tag){case 26:Fr||go(w,g),R(u,g,w),w.memoizedState?w.memoizedState.count--:w.stateNode&&(w=w.stateNode,w.parentNode.removeChild(w));break;case 27:Fr||go(w,g);var C=T,F=A;Uh(w.type)&&(T=w.stateNode,A=!1),R(u,g,w),Gd(w.stateNode),T=C,A=F;break;case 5:Fr||go(w,g);case 6:if(C=T,F=A,T=null,R(u,g,w),T=C,A=F,T!==null)if(A)try{(T.nodeType===9?T.body:T.nodeName==="HTML"?T.ownerDocument.body:T).removeChild(w.stateNode)}catch(j){kr(w,g,j)}else try{T.removeChild(w.stateNode)}catch(j){kr(w,g,j)}break;case 18:T!==null&&(A?(u=T,hm(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,w.stateNode),Wh(u)):hm(T,w.stateNode));break;case 4:C=T,F=A,T=w.stateNode.containerInfo,A=!0,R(u,g,w),T=C,A=F;break;case 0:case 11:case 14:case 15:Ql(2,w,g),Fr||Ql(4,w,g),R(u,g,w);break;case 1:Fr||(go(w,g),C=w.stateNode,typeof C.componentWillUnmount=="function"&&Vd(w,g,C)),R(u,g,w);break;case 21:R(u,g,w);break;case 22:Fr=(C=Fr)||w.memoizedState!==null,R(u,g,w),Fr=C;break;default:R(u,g,w)}}function k(u,g){if(g.memoizedState===null&&(u=g.alternate,u!==null&&(u=u.memoizedState,u!==null))){u=u.dehydrated;try{Wh(u)}catch(w){kr(g,g.return,w)}}}function U(u,g){if(g.memoizedState===null&&(u=g.alternate,u!==null&&(u=u.memoizedState,u!==null&&(u=u.dehydrated,u!==null))))try{Wh(u)}catch(w){kr(g,g.return,w)}}function B(u){switch(u.tag){case 31:case 13:case 19:var g=u.stateNode;return g===null&&(g=u.stateNode=new t),g;case 22:return u=u.stateNode,g=u._retryCache,g===null&&(g=u._retryCache=new t),g;default:throw Error(p(435,u.tag))}}function H(u,g){var w=B(u);g.forEach(function(C){if(!w.has(C)){w.add(C);var F=Ig.bind(null,u,C);C.then(F,F)}})}function W(u,g){var w=g.deletions;if(w!==null)for(var C=0;C<w.length;C++){var F=w[C],j=u,se=g,Ae=se;e:for(;Ae!==null;){switch(Ae.tag){case 27:if(Uh(Ae.type)){T=Ae.stateNode,A=!1;break e}break;case 5:T=Ae.stateNode,A=!1;break e;case 3:case 4:T=Ae.stateNode.containerInfo,A=!0;break e}Ae=Ae.return}if(T===null)throw Error(p(160));L(j,se,F),T=null,A=!1,j=F.alternate,j!==null&&(j.return=null),F.return=null}if(g.subtreeFlags&13886)for(g=g.child;g!==null;)te(g,u),g=g.sibling}var X=null;function te(u,g){var w=u.alternate,C=u.flags;switch(u.tag){case 0:case 11:case 14:case 15:W(g,u),ee(u),C&4&&(Ql(3,u,u.return),Fh(3,u),Ql(5,u,u.return));break;case 1:W(g,u),ee(u),C&512&&(Fr||w===null||go(w,w.return)),C&64&&ec&&(u=u.updateQueue,u!==null&&(C=u.callbacks,C!==null&&(w=u.shared.hiddenCallbacks,u.shared.hiddenCallbacks=w===null?C:w.concat(C))));break;case 26:var F=X;if(W(g,u),ee(u),C&512&&(Fr||w===null||go(w,w.return)),C&4){var j=w!==null?w.memoizedState:null;if(C=u.memoizedState,w===null)if(C===null)if(u.stateNode===null){e:{C=u.type,w=u.memoizedProps,F=F.ownerDocument||F;t:switch(C){case"title":j=F.getElementsByTagName("title")[0],(!j||j[We]||j[J]||j.namespaceURI==="http://www.w3.org/2000/svg"||j.hasAttribute("itemprop"))&&(j=F.createElement(C),F.head.insertBefore(j,F.querySelector("head > title"))),Ia(j,C,w),j[J]=u,gi(j),C=j;break e;case"link":var se=Bg("link","href",F).get(C+(w.href||""));if(se){for(var Ae=0;Ae<se.length;Ae++)if(j=se[Ae],j.getAttribute("href")===(w.href==null||w.href===""?null:w.href)&&j.getAttribute("rel")===(w.rel==null?null:w.rel)&&j.getAttribute("title")===(w.title==null?null:w.title)&&j.getAttribute("crossorigin")===(w.crossOrigin==null?null:w.crossOrigin)){se.splice(Ae,1);break t}}j=F.createElement(C),Ia(j,C,w),F.head.appendChild(j);break;case"meta":if(se=Bg("meta","content",F).get(C+(w.content||""))){for(Ae=0;Ae<se.length;Ae++)if(j=se[Ae],j.getAttribute("content")===(w.content==null?null:""+w.content)&&j.getAttribute("name")===(w.name==null?null:w.name)&&j.getAttribute("property")===(w.property==null?null:w.property)&&j.getAttribute("http-equiv")===(w.httpEquiv==null?null:w.httpEquiv)&&j.getAttribute("charset")===(w.charSet==null?null:w.charSet)){se.splice(Ae,1);break t}}j=F.createElement(C),Ia(j,C,w),F.head.appendChild(j);break;default:throw Error(p(468,C))}j[J]=u,gi(j),C=j}u.stateNode=C}else Iv(F,u.type,u.stateNode);else u.stateNode=Av(F,C,u.memoizedProps);else j!==C?(j===null?w.stateNode!==null&&(w=w.stateNode,w.parentNode.removeChild(w)):j.count--,C===null?Iv(F,u.type,u.stateNode):Av(F,C,u.memoizedProps)):C===null&&u.stateNode!==null&&Jl(u,u.memoizedProps,w.memoizedProps)}break;case 27:W(g,u),ee(u),C&512&&(Fr||w===null||go(w,w.return)),w!==null&&C&4&&Jl(u,u.memoizedProps,w.memoizedProps);break;case 5:if(W(g,u),ee(u),C&512&&(Fr||w===null||go(w,w.return)),u.flags&32){F=u.stateNode;try{Do(F,"")}catch(Hi){kr(u,u.return,Hi)}}C&4&&u.stateNode!=null&&(F=u.memoizedProps,Jl(u,F,w!==null?w.memoizedProps:F)),C&1024&&(d=!0);break;case 6:if(W(g,u),ee(u),C&4){if(u.stateNode===null)throw Error(p(162));C=u.memoizedProps,w=u.stateNode;try{w.nodeValue=C}catch(Hi){kr(u,u.return,Hi)}}break;case 3:if(gm=null,F=X,X=dm(g.containerInfo),W(g,u),X=F,ee(u),C&4&&w!==null&&w.memoizedState.isDehydrated)try{Wh(g.containerInfo)}catch(Hi){kr(u,u.return,Hi)}d&&(d=!1,re(u));break;case 4:C=X,X=dm(u.stateNode.containerInfo),W(g,u),ee(u),X=C;break;case 12:W(g,u),ee(u);break;case 31:W(g,u),ee(u),C&4&&(C=u.updateQueue,C!==null&&(u.updateQueue=null,H(u,C)));break;case 13:W(g,u),ee(u),u.child.flags&8192&&u.memoizedState!==null!=(w!==null&&w.memoizedState!==null)&&(Wi=$i()),C&4&&(C=u.updateQueue,C!==null&&(u.updateQueue=null,H(u,C)));break;case 22:F=u.memoizedState!==null;var Qe=w!==null&&w.memoizedState!==null,Ft=ec,si=Fr;if(ec=Ft||F,Fr=si||Qe,W(g,u),Fr=si,ec=Ft,ee(u),C&8192)e:for(g=u.stateNode,g._visibility=F?g._visibility&-2:g._visibility|1,F&&(w===null||Qe||ec||Fr||le(u)),w=null,g=u;;){if(g.tag===5||g.tag===26){if(w===null){Qe=w=g;try{if(j=Qe.stateNode,F)se=j.style,typeof se.setProperty=="function"?se.setProperty("display","none","important"):se.display="none";else{Ae=Qe.stateNode;var hi=Qe.memoizedProps.style,Ut=hi!=null&&hi.hasOwnProperty("display")?hi.display:null;Ae.style.display=Ut==null||typeof Ut=="boolean"?"":(""+Ut).trim()}}catch(Hi){kr(Qe,Qe.return,Hi)}}}else if(g.tag===6){if(w===null){Qe=g;try{Qe.stateNode.nodeValue=F?"":Qe.memoizedProps}catch(Hi){kr(Qe,Qe.return,Hi)}}}else if(g.tag===18){if(w===null){Qe=g;try{var Zt=Qe.stateNode;F?X_(Zt,!0):X_(Qe.stateNode,!1)}catch(Hi){kr(Qe,Qe.return,Hi)}}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===u)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===u)break e;for(;g.sibling===null;){if(g.return===null||g.return===u)break e;w===g&&(w=null),g=g.return}w===g&&(w=null),g.sibling.return=g.return,g=g.sibling}C&4&&(C=u.updateQueue,C!==null&&(w=C.retryQueue,w!==null&&(C.retryQueue=null,H(u,w))));break;case 19:W(g,u),ee(u),C&4&&(C=u.updateQueue,C!==null&&(u.updateQueue=null,H(u,C)));break;case 30:break;case 21:break;default:W(g,u),ee(u)}}function ee(u){var g=u.flags;if(g&2){try{for(var w,C=u.return;C!==null;){if(El(C)){w=C;break}C=C.return}if(w==null)throw Error(p(160));switch(w.tag){case 27:var F=w.stateNode,j=Tg(u);nm(u,j,F);break;case 5:var se=w.stateNode;w.flags&32&&(Do(se,""),w.flags&=-33);var Ae=Tg(u);nm(u,Ae,se);break;case 3:case 4:var Qe=w.stateNode.containerInfo,Ft=Tg(u);Eg(u,Ft,Qe);break;default:throw Error(p(161))}}catch(si){kr(u,u.return,si)}u.flags&=-3}g&4096&&(u.flags&=-4097)}function re(u){if(u.subtreeFlags&1024)for(u=u.child;u!==null;){var g=u;re(g),g.tag===5&&g.flags&1024&&g.stateNode.reset(),u=u.sibling}}function he(u,g){if(g.subtreeFlags&8772)for(g=g.child;g!==null;)y(u,g.alternate,g),g=g.sibling}function le(u){for(u=u.child;u!==null;){var g=u;switch(g.tag){case 0:case 11:case 14:case 15:Ql(4,g,g.return),le(g);break;case 1:go(g,g.return);var w=g.stateNode;typeof w.componentWillUnmount=="function"&&Vd(g,g.return,w),le(g);break;case 27:Gd(g.stateNode);case 26:case 5:go(g,g.return),le(g);break;case 22:g.memoizedState===null&&le(g);break;case 30:le(g);break;default:le(g)}u=u.sibling}}function we(u,g,w){for(w=w&&(g.subtreeFlags&8772)!==0,g=g.child;g!==null;){var C=g.alternate,F=u,j=g,se=j.flags;switch(j.tag){case 0:case 11:case 15:we(F,j,w),Fh(4,j);break;case 1:if(we(F,j,w),C=j,F=C.stateNode,typeof F.componentDidMount=="function")try{F.componentDidMount()}catch(Ft){kr(C,C.return,Ft)}if(C=j,F=C.updateQueue,F!==null){var Ae=C.stateNode;try{var Qe=F.shared.hiddenCallbacks;if(Qe!==null)for(F.shared.hiddenCallbacks=null,F=0;F<Qe.length;F++)R_(Qe[F],Ae)}catch(Ft){kr(C,C.return,Ft)}}w&&se&64&&qf(j),nl(j,j.return);break;case 27:B_(j);case 26:case 5:we(F,j,w),w&&C===null&&se&4&&So(j),nl(j,j.return);break;case 12:we(F,j,w);break;case 31:we(F,j,w),w&&se&4&&k(F,j);break;case 13:we(F,j,w),w&&se&4&&U(F,j);break;case 22:j.memoizedState===null&&we(F,j,w),nl(j,j.return);break;case 30:break;default:we(F,j,w)}g=g.sibling}}function fe(u,g){var w=null;u!==null&&u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(w=u.memoizedState.cachePool.pool),u=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(u=g.memoizedState.cachePool.pool),u!==w&&(u!=null&&u.refCount++,w!=null&&Qc(w))}function Ee(u,g){u=null,g.alternate!==null&&(u=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==u&&(g.refCount++,u!=null&&Qc(u))}function ge(u,g,w,C){if(g.subtreeFlags&10256)for(g=g.child;g!==null;)me(u,g,w,C),g=g.sibling}function me(u,g,w,C){var F=g.flags;switch(g.tag){case 0:case 11:case 15:ge(u,g,w,C),F&2048&&Fh(9,g);break;case 1:ge(u,g,w,C);break;case 3:ge(u,g,w,C),F&2048&&(u=null,g.alternate!==null&&(u=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==u&&(g.refCount++,u!=null&&Qc(u)));break;case 12:if(F&2048){ge(u,g,w,C),u=g.stateNode;try{var j=g.memoizedProps,se=j.id,Ae=j.onPostCommit;typeof Ae=="function"&&Ae(se,g.alternate===null?"mount":"update",u.passiveEffectDuration,-0)}catch(Qe){kr(g,g.return,Qe)}}else ge(u,g,w,C);break;case 31:ge(u,g,w,C);break;case 13:ge(u,g,w,C);break;case 23:break;case 22:j=g.stateNode,se=g.alternate,g.memoizedState!==null?j._visibility&2?ge(u,g,w,C):Ve(u,g):j._visibility&2?ge(u,g,w,C):(j._visibility|=2,Se(u,g,w,C,(g.subtreeFlags&10256)!==0||!1)),F&2048&&fe(se,g);break;case 24:ge(u,g,w,C),F&2048&&Ee(g.alternate,g);break;default:ge(u,g,w,C)}}function Se(u,g,w,C,F){for(F=F&&((g.subtreeFlags&10256)!==0||!1),g=g.child;g!==null;){var j=u,se=g,Ae=w,Qe=C,Ft=se.flags;switch(se.tag){case 0:case 11:case 15:Se(j,se,Ae,Qe,F),Fh(8,se);break;case 23:break;case 22:var si=se.stateNode;se.memoizedState!==null?si._visibility&2?Se(j,se,Ae,Qe,F):Ve(j,se):(si._visibility|=2,Se(j,se,Ae,Qe,F)),F&&Ft&2048&&fe(se.alternate,se);break;case 24:Se(j,se,Ae,Qe,F),F&&Ft&2048&&Ee(se.alternate,se);break;default:Se(j,se,Ae,Qe,F)}g=g.sibling}}function Ve(u,g){if(g.subtreeFlags&10256)for(g=g.child;g!==null;){var w=u,C=g,F=C.flags;switch(C.tag){case 22:Ve(w,C),F&2048&&fe(C.alternate,C);break;case 24:Ve(w,C),F&2048&&Ee(C.alternate,C);break;default:Ve(w,C)}g=g.sibling}}var ke=8192;function st(u,g,w){if(u.subtreeFlags&ke)for(u=u.child;u!==null;)Xe(u,g,w),u=u.sibling}function Xe(u,g,w){switch(u.tag){case 26:st(u,g,w),u.flags&ke&&u.memoizedState!==null&&Ax(w,X,u.memoizedState,u.memoizedProps);break;case 5:st(u,g,w);break;case 3:case 4:var C=X;X=dm(u.stateNode.containerInfo),st(u,g,w),X=C;break;case 22:u.memoizedState===null&&(C=u.alternate,C!==null&&C.memoizedState!==null?(C=ke,ke=16777216,st(u,g,w),ke=C):st(u,g,w));break;default:st(u,g,w)}}function ht(u){var g=u.alternate;if(g!==null&&(u=g.child,u!==null)){g.child=null;do g=u.sibling,u.sibling=null,u=g;while(u!==null)}}function zt(u){var g=u.deletions;if((u.flags&16)!==0){if(g!==null)for(var w=0;w<g.length;w++){var C=g[w];o=C,dt(C,u)}ht(u)}if(u.subtreeFlags&10256)for(u=u.child;u!==null;)$e(u),u=u.sibling}function $e(u){switch(u.tag){case 0:case 11:case 15:zt(u),u.flags&2048&&Ql(9,u,u.return);break;case 3:zt(u);break;case 12:zt(u);break;case 22:var g=u.stateNode;u.memoizedState!==null&&g._visibility&2&&(u.return===null||u.return.tag!==13)?(g._visibility&=-3,Pe(u)):zt(u);break;default:zt(u)}}function Pe(u){var g=u.deletions;if((u.flags&16)!==0){if(g!==null)for(var w=0;w<g.length;w++){var C=g[w];o=C,dt(C,u)}ht(u)}for(u=u.child;u!==null;){switch(g=u,g.tag){case 0:case 11:case 15:Ql(8,g,g.return),Pe(g);break;case 22:w=g.stateNode,w._visibility&2&&(w._visibility&=-3,Pe(g));break;default:Pe(g)}u=u.sibling}}function dt(u,g){for(;o!==null;){var w=o;switch(w.tag){case 0:case 11:case 15:Ql(8,w,g);break;case 23:case 22:if(w.memoizedState!==null&&w.memoizedState.cachePool!==null){var C=w.memoizedState.cachePool.pool;C!=null&&C.refCount++}break;case 24:Qc(w.memoizedState.cache)}if(C=w.child,C!==null)C.return=w,o=C;else e:for(w=u;o!==null;){C=o;var F=C.sibling,j=C.return;if(x(C),C===w){o=null;break e}if(F!==null){F.return=j,o=F;break e}o=j}}}var Ke={getCacheForType:function(u){var g=zs(Yr),w=g.data.get(u);return w===void 0&&(w=u(),g.data.set(u,w)),w},cacheSignal:function(){return zs(Yr).controller.signal}},At=typeof WeakMap=="function"?WeakMap:Map,wt=0,Ht=null,mt=null,_t=0,$t=0,Jt=null,Xt=!1,ri=!1,Mi=!1,tn=0,Gi=0,Fn=0,Pi=0,yn=0,Ni=0,Bn=0,_n=null,In=null,Dn=!1,Wi=0,Un=0,nn=1/0,gr=null,wn=null,Ei=0,pn=null,br=null,Er=0,zr=0,qr=null,ca=null,_o=0,so=null;function ls(){return(wt&2)!==0&&_t!==0?_t&-_t:Ct.T!==null?q_():_u()}function Va(){if(Ni===0)if((_t&536870912)===0||Ir){var u=Ps;Ps<<=1,(Ps&3932160)===0&&(Ps=262144),Ni=u}else Ni=536870912;return u=Zo.current,u!==null&&(u.flags|=32),Ni}function Qr(u,g,w){(u===Ht&&($t===2||$t===9)||u.cancelPendingCommit!==null)&&(Hr(u,0),wr(u,_t,Ni,!1)),St(u,w),((wt&2)===0||u!==Ht)&&(u===Ht&&((wt&2)===0&&(Pi|=w),Gi===4&&wr(u,_t,Ni,!1)),Aa(u))}function Ua(u,g,w){if((wt&6)!==0)throw Error(p(327));var C=!w&&(g&127)===0&&(g&u.expiredLanes)===0||Ma(u,g),F=C?sl(u,g):$u(u,g,!0),j=C;do{if(F===0){ri&&!C&&wr(u,g,0,!1);break}else{if(w=u.current.alternate,j&&!oo(w)){F=$u(u,g,!1),j=!1;continue}if(F===2){if(j=g,u.errorRecoveryDisabledLanes&j)var se=0;else se=u.pendingLanes&-536870913,se=se!==0?se:se&536870912?536870912:0;if(se!==0){g=se;e:{var Ae=u;F=_n;var Qe=Ae.current.memoizedState.isDehydrated;if(Qe&&(Hr(Ae,se).flags|=256),se=$u(Ae,se,!1),se!==2){if(Mi&&!Qe){Ae.errorRecoveryDisabledLanes|=j,Pi|=j,F=4;break e}j=In,In=F,j!==null&&(In===null?In=j:In.push.apply(In,j))}F=se}if(j=!1,F!==2)continue}}if(F===1){Hr(u,0),wr(u,g,0,!0);break}e:{switch(C=u,j=F,j){case 0:case 1:throw Error(p(345));case 4:if((g&4194048)!==g)break;case 6:wr(C,g,Ni,!Xt);break e;case 2:In=null;break;case 3:case 5:break;default:throw Error(p(329))}if((g&62914560)===g&&(F=Wi+300-$i(),10<F)){if(wr(C,g,Ni,!Xt),js(C,0,!0)!==0)break e;Er=g,C.timeoutHandle=vv(rl.bind(null,C,w,In,gr,Dn,g,Ni,Pi,Bn,Xt,j,"Throttled",-0,0),F);break e}rl(C,w,In,gr,Dn,g,Ni,Pi,Bn,Xt,j,null,-0,0)}}break}while(!0);Aa(u)}function rl(u,g,w,C,F,j,se,Ae,Qe,Ft,si,hi,Ut,Zt){if(u.timeoutHandle=-1,hi=g.subtreeFlags,hi&8192||(hi&16785408)===16785408){hi={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pa},Xe(g,j,hi);var Hi=(j&62914560)===j?Wi-$i():(j&4194048)===j?Un-$i():0;if(Hi=Cv(hi,Hi),Hi!==null){Er=j,u.cancelPendingCommit=Hi(rx.bind(null,u,g,j,w,C,F,se,Ae,Qe,si,hi,null,Ut,Zt)),wr(u,j,se,!Ft);return}}rx(u,g,j,w,C,F,se,Ae,Qe)}function oo(u){for(var g=u;;){var w=g.tag;if((w===0||w===11||w===15)&&g.flags&16384&&(w=g.updateQueue,w!==null&&(w=w.stores,w!==null)))for(var C=0;C<w.length;C++){var F=w[C],j=F.getSnapshot;F=F.value;try{if(!Oo(j(),F))return!1}catch{return!1}}if(w=g.child,g.subtreeFlags&16384&&w!==null)w.return=g,g=w;else{if(g===u)break;for(;g.sibling===null;){if(g.return===null||g.return===u)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function wr(u,g,w,C){g&=~yn,g&=~Pi,u.suspendedLanes|=g,u.pingedLanes&=~g,C&&(u.warmLanes|=g),C=u.expirationTimes;for(var F=g;0<F;){var j=31-Ts(F),se=1<<j;C[j]=-1,F&=~se}w!==0&&Bl(u,w,g)}function Jr(){return(wt&6)===0?(sm(0),!1):!0}function ar(){if(mt!==null){if($t===0)var u=mt.return;else u=mt,vl=yl=null,Rc(u),Du=null,bd=0,u=mt;for(;u!==null;)im(u.alternate,u),u=u.return;mt=null}}function Hr(u,g){var w=u.timeoutHandle;w!==-1&&(u.timeoutHandle=-1,Z_(w)),w=u.cancelPendingCommit,w!==null&&(u.cancelPendingCommit=null,w()),Er=0,ar(),Ht=u,mt=w=an(u.current,null),_t=g,$t=0,Jt=null,Xt=!1,ri=Ma(u,g),Mi=!1,Bn=Ni=yn=Pi=Fn=Gi=0,In=_n=null,Dn=!1,(g&8)!==0&&(g|=g&32);var C=u.entangledLanes;if(C!==0)for(u=u.entanglements,C&=g;0<C;){var F=31-Ts(C),j=1<<F;g|=u[F],C&=~j}return tn=g,dh(),w}function Ws(u,g){Lt=null,Ct.H=Oh,g===xh||g===Op?(g=og(),$t=3):g===Pp?(g=og(),$t=4):$t=g===qu?8:g!==null&&typeof g=="object"&&typeof g.then=="function"?6:1,Jt=g,mt===null&&(Gi=1,Gu(u,ka(g,u.current)))}function $r(){var u=Zo.current;return u===null?!0:(_t&4194048)===_t?To===null:(_t&62914560)===_t||(_t&536870912)!==0?u===To:!1}function ja(){var u=Ct.H;return Ct.H=Oh,u===null?Oh:u}function Bh(){var u=Ct.A;return Ct.A=Ke,u}function Sl(){Gi=4,Xt||(_t&4194048)!==_t&&Zo.current!==null||(ri=!0),(Fn&134217727)===0&&(Pi&134217727)===0||Ht===null||wr(Ht,_t,Ni,!1)}function $u(u,g,w){var C=wt;wt|=2;var F=ja(),j=Bh();(Ht!==u||_t!==g)&&(gr=null,Hr(u,g)),g=!1;var se=Gi;e:do try{if($t!==0&&mt!==null){var Ae=mt,Qe=Jt;switch($t){case 8:ar(),se=6;break e;case 3:case 2:case 9:case 6:Zo.current===null&&(g=!0);var Ft=$t;if($t=0,Jt=null,Al(u,Ae,Qe,Ft),w&&ri){se=0;break e}break;default:Ft=$t,$t=0,Jt=null,Al(u,Ae,Qe,Ft)}}Ud(),se=Gi;break}catch(si){Ws(u,si)}while(!0);return g&&u.shellSuspendCounter++,vl=yl=null,wt=C,Ct.H=F,Ct.A=j,mt===null&&(Ht=null,_t=0,dh()),se}function Ud(){for(;mt!==null;)Fs(mt)}function sl(u,g){var w=wt;wt|=2;var C=ja(),F=Bh();Ht!==u||_t!==g?(gr=null,nn=$i()+500,Hr(u,g)):ri=Ma(u,g);e:do try{if($t!==0&&mt!==null){g=mt;var j=Jt;t:switch($t){case 1:$t=0,Jt=null,Al(u,g,j,1);break;case 2:case 9:if(C_(j)){$t=0,Jt=null,Ga(g);break}g=function(){$t!==2&&$t!==9||Ht!==u||($t=7),Aa(u)},j.then(g,g);break e;case 3:$t=7;break e;case 4:$t=5;break e;case 7:C_(j)?($t=0,Jt=null,Ga(g)):($t=0,Jt=null,Al(u,g,j,7));break;case 5:var se=null;switch(mt.tag){case 26:se=mt.memoizedState;case 5:case 27:var Ae=mt;if(se?ey(se):Ae.stateNode.complete){$t=0,Jt=null;var Qe=Ae.sibling;if(Qe!==null)mt=Qe;else{var Ft=Ae.return;Ft!==null?(mt=Ft,Hf(Ft)):mt=null}break t}}$t=0,Jt=null,Al(u,g,j,5);break;case 6:$t=0,Jt=null,Al(u,g,j,6);break;case 8:ar(),Gi=6;break e;default:throw Error(p(462))}}Oc();break}catch(si){Ws(u,si)}while(!0);return vl=yl=null,Ct.H=C,Ct.A=F,wt=w,mt!==null?0:(Ht=null,_t=0,dh(),Gi)}function Oc(){for(;mt!==null&&!rn();)Fs(mt)}function Fs(u){var g=ys(u.alternate,u,tn);u.memoizedProps=u.pendingProps,g===null?Hf(u):mt=g}function Ga(u){var g=u,w=g.alternate;switch(g.tag){case 15:case 0:g=mg(w,g,g.pendingProps,g.type,void 0,_t);break;case 11:g=mg(w,g,g.pendingProps,g.type.render,g.ref,_t);break;case 5:Rc(g);default:im(w,g),g=mt=ph(g,tn),g=ys(w,g,tn)}u.memoizedProps=u.pendingProps,g===null?Hf(u):mt=g}function Al(u,g,w,C){vl=yl=null,Rc(g),Du=null,bd=0;var F=g.return;try{if(Xp(u,F,g,w,_t)){Gi=1,Gu(u,ka(w,u.current)),mt=null;return}}catch(j){if(F!==null)throw mt=F,j;Gi=1,Gu(u,ka(w,u.current)),mt=null;return}g.flags&32768?(Ir||C===1?u=!0:ri||(_t&536870912)!==0?u=!1:(Xt=u=!0,(C===2||C===9||C===3||C===6)&&(C=Zo.current,C!==null&&C.tag===13&&(C.flags|=16384))),$f(g,u)):Hf(g)}function Hf(u){var g=u;do{if((g.flags&32768)!==0){$f(g,Xt);return}u=g.return;var w=sv(g.alternate,g,tn);if(w!==null){mt=w;return}if(g=g.sibling,g!==null){mt=g;return}mt=g=u}while(g!==null);Gi===0&&(Gi=5)}function $f(u,g){do{var w=F_(u.alternate,u);if(w!==null){w.flags&=32767,mt=w;return}if(w=u.return,w!==null&&(w.flags|=32768,w.subtreeFlags=0,w.deletions=null),!g&&(u=u.sibling,u!==null)){mt=u;return}mt=u=w}while(u!==null);Gi=6,mt=null}function rx(u,g,w,C,F,j,se,Ae,Qe){u.cancelPendingCommit=null;do N_();while(Ei!==0);if((wt&6)!==0)throw Error(p(327));if(g!==null){if(g===u.current)throw Error(p(177));if(j=g.lanes|g.childLanes,j|=Ta,Fl(u,w,j,se,Ae,Qe),u===Ht&&(mt=Ht=null,_t=0),br=g,pn=u,Er=w,zr=j,qr=F,ca=C,(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?(u.callbackNode=null,u.callbackPriority=0,j_(Uo,function(){return V_(),null})):(u.callbackNode=null,u.callbackPriority=0),C=(g.flags&13878)!==0,(g.subtreeFlags&13878)!==0||C){C=Ct.T,Ct.T=null,F=oi.p,oi.p=2,se=wt,wt|=4;try{f(u,g,w)}finally{wt=se,oi.p=F,Ct.T=C}}Ei=1,ov(),Sg(),sx()}}function ov(){if(Ei===1){Ei=0;var u=pn,g=br,w=(g.flags&13878)!==0;if((g.subtreeFlags&13878)!==0||w){w=Ct.T,Ct.T=null;var C=oi.p;oi.p=2;var F=wt;wt|=4;try{te(g,u);var j=Pg,se=fd(u.containerInfo),Ae=j.focusedElem,Qe=j.selectionRange;if(se!==Ae&&Ae&&Ae.ownerDocument&&S_(Ae.ownerDocument.documentElement,Ae)){if(Qe!==null&&mc(Ae)){var Ft=Qe.start,si=Qe.end;if(si===void 0&&(si=Ft),"selectionStart"in Ae)Ae.selectionStart=Ft,Ae.selectionEnd=Math.min(si,Ae.value.length);else{var hi=Ae.ownerDocument||document,Ut=hi&&hi.defaultView||window;if(Ut.getSelection){var Zt=Ut.getSelection(),Hi=Ae.textContent.length,Tn=Math.min(Qe.start,Hi),vs=Qe.end===void 0?Tn:Math.min(Qe.end,Hi);!Zt.extend&&Tn>vs&&(se=vs,vs=Tn,Tn=se);var Tt=E_(Ae,Tn),lt=E_(Ae,vs);if(Tt&&lt&&(Zt.rangeCount!==1||Zt.anchorNode!==Tt.node||Zt.anchorOffset!==Tt.offset||Zt.focusNode!==lt.node||Zt.focusOffset!==lt.offset)){var Bt=hi.createRange();Bt.setStart(Tt.node,Tt.offset),Zt.removeAllRanges(),Tn>vs?(Zt.addRange(Bt),Zt.extend(lt.node,lt.offset)):(Bt.setEnd(lt.node,lt.offset),Zt.addRange(Bt))}}}}for(hi=[],Zt=Ae;Zt=Zt.parentNode;)Zt.nodeType===1&&hi.push({element:Zt,left:Zt.scrollLeft,top:Zt.scrollTop});for(typeof Ae.focus=="function"&&Ae.focus(),Ae=0;Ae<hi.length;Ae++){var ci=hi[Ae];ci.element.scrollLeft=ci.left,ci.element.scrollTop=ci.top}}Kf=!!gv,Pg=gv=null}finally{wt=F,oi.p=C,Ct.T=w}}u.current=g,Ei=2}}function Sg(){if(Ei===2){Ei=0;var u=pn,g=br,w=(g.flags&8772)!==0;if((g.subtreeFlags&8772)!==0||w){w=Ct.T,Ct.T=null;var C=oi.p;oi.p=2;var F=wt;wt|=4;try{y(u,g.alternate,g)}finally{wt=F,oi.p=C,Ct.T=w}}Ei=3}}function sx(){if(Ei===4||Ei===3){Ei=0,vn();var u=pn,g=br,w=Er,C=ca;(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?Ei=5:(Ei=0,br=pn=null,av(u,u.pendingLanes));var F=u.pendingLanes;if(F===0&&(wn=null),Nl(w),g=g.stateNode,pr&&typeof pr.onCommitFiberRoot=="function")try{pr.onCommitFiberRoot(Yo,g,void 0,(g.current.flags&128)===128)}catch{}if(C!==null){g=Ct.T,F=oi.p,oi.p=2,Ct.T=null;try{for(var j=u.onRecoverableError,se=0;se<C.length;se++){var Ae=C[se];j(Ae.value,{componentStack:Ae.stack})}}finally{Ct.T=g,oi.p=F}}(Er&3)!==0&&N_(),Aa(u),F=u.pendingLanes,(w&261930)!==0&&(F&42)!==0?u===so?_o++:(_o=0,so=u):_o=0,sm(0)}}function av(u,g){(u.pooledCacheLanes&=g)===0&&(g=u.pooledCache,g!=null&&(u.pooledCache=null,Qc(g)))}function N_(){return ov(),Sg(),sx(),V_()}function V_(){if(Ei!==5)return!1;var u=pn,g=zr;zr=0;var w=Nl(Er),C=Ct.T,F=oi.p;try{oi.p=32>w?32:w,Ct.T=null,w=qr,qr=null;var j=pn,se=Er;if(Ei=0,br=pn=null,Er=0,(wt&6)!==0)throw Error(p(331));var Ae=wt;if(wt|=4,$e(j.current),me(j,j.current,se,w),wt=Ae,sm(0,!1),pr&&typeof pr.onPostCommitFiberRoot=="function")try{pr.onPostCommitFiberRoot(Yo,j)}catch{}return!0}finally{oi.p=F,Ct.T=C,av(u,g)}}function lu(u,g,w){g=ka(w,g),g=Pc(u.stateNode,g,2),u=Sc(u,g,2),u!==null&&(St(u,2),Aa(u))}function kr(u,g,w){if(u.tag===3)lu(u,u,w);else for(;g!==null;){if(g.tag===3){lu(g,u,w);break}else if(g.tag===1){var C=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(wn===null||!wn.has(C))){u=ka(w,u),w=Zp(2),C=Sc(g,w,2),C!==null&&(Uf(w,C,g,u),St(C,2),Aa(C));break}}g=g.return}}function U_(u,g,w){var C=u.pingCache;if(C===null){C=u.pingCache=new At;var F=new Set;C.set(g,F)}else F=C.get(g),F===void 0&&(F=new Set,C.set(g,F));F.has(w)||(Mi=!0,F.add(w),u=ox.bind(null,u,g,w),g.then(u,u))}function ox(u,g,w){var C=u.pingCache;C!==null&&C.delete(g),u.pingedLanes|=u.suspendedLanes&w,u.warmLanes&=~w,Ht===u&&(_t&w)===w&&(Gi===4||Gi===3&&(_t&62914560)===_t&&300>$i()-Wi?(wt&2)===0&&Hr(u,0):yn|=w,Bn===_t&&(Bn=0)),Aa(u)}function Ag(u,g){g===0&&(g=ad()),u=gl(u,g),u!==null&&(St(u,g),Aa(u))}function lv(u){var g=u.memoizedState,w=0;g!==null&&(w=g.retryLane),Ag(u,w)}function Ig(u,g){var w=0;switch(u.tag){case 31:case 13:var C=u.stateNode,F=u.memoizedState;F!==null&&(w=F.retryLane);break;case 19:C=u.stateNode;break;case 22:C=u.stateNode._retryCache;break;default:throw Error(p(314))}C!==null&&C.delete(g),Ag(u,w)}function j_(u,g){return hs(u,g)}var Cg=null,Nh=null,Rg=!1,rm=!1,G_=!1,Vh=0;function Aa(u){u!==Nh&&u.next===null&&(Nh===null?Cg=Nh=u:Nh=Nh.next=u),rm=!0,Rg||(Rg=!0,ux())}function sm(u,g){if(!G_&&rm){G_=!0;do for(var w=!1,C=Cg;C!==null;){if(u!==0){var F=C.pendingLanes;if(F===0)var j=0;else{var se=C.suspendedLanes,Ae=C.pingedLanes;j=(1<<31-Ts(42|u)+1)-1,j&=F&~(se&~Ae),j=j&201326741?j&201326741|1:j?j|2:0}j!==0&&(w=!0,cx(C,j))}else j=_t,j=js(C,C===Ht?j:0,C.cancelPendingCommit!==null||C.timeoutHandle!==-1),(j&3)===0||Ma(C,j)||(w=!0,cx(C,j));C=C.next}while(w);G_=!1}}function cv(){uv()}function uv(){rm=Rg=!1;var u=0;Vh!==0&&um()&&(u=Vh);for(var g=$i(),w=null,C=Cg;C!==null;){var F=C.next,j=ax(C,g);j===0?(C.next=null,w===null?Cg=F:w.next=F,F===null&&(Nh=w)):(w=C,(u!==0||(j&3)!==0)&&(rm=!0)),C=F}Ei!==0&&Ei!==5||sm(u),Vh!==0&&(Vh=0)}function ax(u,g){for(var w=u.suspendedLanes,C=u.pingedLanes,F=u.expirationTimes,j=u.pendingLanes&-62914561;0<j;){var se=31-Ts(j),Ae=1<<se,Qe=F[se];Qe===-1?((Ae&w)===0||(Ae&C)!==0)&&(F[se]=ih(Ae,g)):Qe<=g&&(u.expiredLanes|=Ae),j&=~Ae}if(g=Ht,w=_t,w=js(u,u===g?w:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),C=u.callbackNode,w===0||u===g&&($t===2||$t===9)||u.cancelPendingCommit!==null)return C!==null&&C!==null&&Di(C),u.callbackNode=null,u.callbackPriority=0;if((w&3)===0||Ma(u,w)){if(g=w&-w,g===u.callbackPriority)return g;switch(C!==null&&Di(C),Nl(w)){case 2:case 8:w=uo;break;case 32:w=Uo;break;case 268435456:w=ac;break;default:w=Uo}return C=lx.bind(null,u),w=hs(w,C),u.callbackPriority=g,u.callbackNode=w,g}return C!==null&&C!==null&&Di(C),u.callbackPriority=2,u.callbackNode=null,2}function lx(u,g){if(Ei!==0&&Ei!==5)return u.callbackNode=null,u.callbackPriority=0,null;var w=u.callbackNode;if(N_()&&u.callbackNode!==w)return null;var C=_t;return C=js(u,u===Ht?C:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),C===0?null:(Ua(u,C,g),ax(u,$i()),u.callbackNode!=null&&u.callbackNode===w?lx.bind(null,u):null)}function cx(u,g){if(N_())return null;Ua(u,g,!0)}function ux(){Lg(function(){(wt&6)!==0?hs(Kn,cv):uv()})}function q_(){if(Vh===0){var u=Ru;u===0&&(u=dr,dr<<=1,(dr&261888)===0&&(dr=256)),Vh=u}return Vh}function hx(u){return u==null||typeof u=="symbol"||typeof u=="boolean"?null:typeof u=="function"?u:hl(""+u)}function hv(u,g){var w=g.ownerDocument.createElement("input");return w.name=g.name,w.value=g.value,u.id&&w.setAttribute("form",u.id),g.parentNode.insertBefore(w,g),u=new FormData(u),w.parentNode.removeChild(w),u}function $1(u,g,w,C,F){if(g==="submit"&&w&&w.stateNode===F){var j=hx((F[de]||null).action),se=C.submitter;se&&(g=(g=se[de]||null)?hx(g.formAction):se.getAttribute("formAction"),g!==null&&(j=g,se=null));var Ae=new ia("action","action",null,C,F);u.push({event:Ae,listeners:[{instance:null,listener:function(){if(C.defaultPrevented){if(Vh!==0){var Qe=se?hv(F,se):new FormData(F);ru(w,{pending:!0,data:Qe,method:F.method,action:j},null,Qe)}}else typeof j=="function"&&(Ae.preventDefault(),Qe=se?hv(F,se):new FormData(F),ru(w,{pending:!0,data:Qe,method:F.method,action:j},j,Qe))},currentTarget:F}]})}}for(var dv=0;dv<hf.length;dv++){var H_=hf[dv],dx=H_.toLowerCase(),fx=H_[0].toUpperCase()+H_.slice(1);ra(dx,"on"+fx)}ra(wp,"onAnimationEnd"),ra(uf,"onAnimationIteration"),ra(Tp,"onAnimationStart"),ra("dblclick","onDoubleClick"),ra("focusin","onFocus"),ra("focusout","onBlur"),ra(ig,"onTransitionRun"),ra(ml,"onTransitionStart"),ra(hh,"onTransitionCancel"),ra(pd,"onTransitionEnd"),mr("onMouseEnter",["mouseout","mouseover"]),mr("onMouseLeave",["mouseout","mouseover"]),mr("onPointerEnter",["pointerout","pointerover"]),mr("onPointerLeave",["pointerout","pointerover"]),Rn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Rn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Rn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Rn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Rn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Rn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var om="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),px=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(om));function fv(u,g){g=(g&4)!==0;for(var w=0;w<u.length;w++){var C=u[w],F=C.event;C=C.listeners;e:{var j=void 0;if(g)for(var se=C.length-1;0<=se;se--){var Ae=C[se],Qe=Ae.instance,Ft=Ae.currentTarget;if(Ae=Ae.listener,Qe!==j&&F.isPropagationStopped())break e;j=Ae,F.currentTarget=Ft;try{j(F)}catch(si){Zc(si)}F.currentTarget=null,j=Qe}else for(se=0;se<C.length;se++){if(Ae=C[se],Qe=Ae.instance,Ft=Ae.currentTarget,Ae=Ae.listener,Qe!==j&&F.isPropagationStopped())break e;j=Ae,F.currentTarget=Ft;try{j(F)}catch(si){Zc(si)}F.currentTarget=null,j=Qe}}}}function Rr(u,g){var w=g[Ce];w===void 0&&(w=g[Ce]=new Set);var C=u+"__bubble";w.has(C)||(pv(g,u,2,!1),w.add(C))}function Mg(u,g,w){var C=0;g&&(C|=4),pv(w,u,C,g)}var cu="_reactListening"+Math.random().toString(36).slice(2);function yo(u){if(!u[cu]){u[cu]=!0,en.forEach(function(w){w!=="selectionchange"&&(px.has(w)||Mg(w,!1,u),Mg(w,!0,u))});var g=u.nodeType===9?u:u.ownerDocument;g===null||g[cu]||(g[cu]=!0,Mg("selectionchange",!1,g))}}function pv(u,g,w,C){switch(Rx(g)){case 2:var F=Ug;break;case 8:F=Cx;break;default:F=ny}w=F.bind(null,g,w,u),F=void 0,!Uc||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(F=!0),C?F!==void 0?u.addEventListener(g,w,{capture:!0,passive:F}):u.addEventListener(g,w,!0):F!==void 0?u.addEventListener(g,w,{passive:F}):u.addEventListener(g,w,!1)}function Wf(u,g,w,C,F){var j=C;if((g&1)===0&&(g&2)===0&&C!==null)e:for(;;){if(C===null)return;var se=C.tag;if(se===3||se===4){var Ae=C.stateNode.containerInfo;if(Ae===F)break;if(se===4)for(se=C.return;se!==null;){var Qe=se.tag;if((Qe===3||Qe===4)&&se.stateNode.containerInfo===F)return;se=se.return}for(;Ae!==null;){if(se=xt(Ae),se===null)return;if(Qe=se.tag,Qe===5||Qe===6||Qe===26||Qe===27){C=j=se;continue e}Ae=Ae.parentNode}}C=C.return}lc(function(){var Ft=j,si=eo(w),hi=[];e:{var Ut=Ep.get(u);if(Ut!==void 0){var Zt=ia,Hi=u;switch(u){case"keypress":if(Vl(w)===0)break e;case"keydown":case"keyup":Zt=xi;break;case"focusin":Hi="focus",Zt=Hc;break;case"focusout":Hi="blur",Zt=Hc;break;case"beforeblur":case"afterblur":Zt=Hc;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Zt=hc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Zt=fl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Zt=Q;break;case wp:case uf:case Tp:Zt=ld;break;case pd:Zt=De;break;case"scroll":case"scrollend":Zt=bu;break;case"wheel":Zt=qt;break;case"copy":case"cut":case"paste":Zt=cd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Zt=xn;break;case"toggle":case"beforetoggle":Zt=on}var Tn=(g&4)!==0,vs=!Tn&&(u==="scroll"||u==="scrollend"),Tt=Tn?Ut!==null?Ut+"Capture":null:Ut;Tn=[];for(var lt=Ft,Bt;lt!==null;){var ci=lt;if(Bt=ci.stateNode,ci=ci.tag,ci!==5&&ci!==26&&ci!==27||Bt===null||Tt===null||(ci=Ho(lt,Tt),ci!=null&&Tn.push(Dg(lt,ci,Bt))),vs)break;lt=lt.return}0<Tn.length&&(Ut=new Zt(Ut,Hi,null,w,si),hi.push({event:Ut,listeners:Tn}))}}if((g&7)===0){e:{if(Ut=u==="mouseover"||u==="pointerover",Zt=u==="mouseout"||u==="pointerout",Ut&&w!==vu&&(Hi=w.relatedTarget||w.fromElement)&&(xt(Hi)||Hi[Re]))break e;if((Zt||Ut)&&(Ut=si.window===si?si:(Ut=si.ownerDocument)?Ut.defaultView||Ut.parentWindow:window,Zt?(Hi=w.relatedTarget||w.toElement,Zt=Ft,Hi=Hi?xt(Hi):null,Hi!==null&&(vs=I(Hi),Tn=Hi.tag,Hi!==vs||Tn!==5&&Tn!==27&&Tn!==6)&&(Hi=null)):(Zt=null,Hi=Ft),Zt!==Hi)){if(Tn=hc,ci="onMouseLeave",Tt="onMouseEnter",lt="mouse",(u==="pointerout"||u==="pointerover")&&(Tn=xn,ci="onPointerLeave",Tt="onPointerEnter",lt="pointer"),vs=Zt==null?Ut:Ii(Zt),Bt=Hi==null?Ut:Ii(Hi),Ut=new Tn(ci,lt+"leave",Zt,w,si),Ut.target=vs,Ut.relatedTarget=Bt,ci=null,xt(si)===Ft&&(Tn=new Tn(Tt,lt+"enter",Hi,w,si),Tn.target=Bt,Tn.relatedTarget=vs,ci=Tn),vs=ci,Zt&&Hi)t:{for(Tn=W1,Tt=Zt,lt=Hi,Bt=0,ci=Tt;ci;ci=Tn(ci))Bt++;ci=0;for(var En=lt;En;En=Tn(En))ci++;for(;0<Bt-ci;)Tt=Tn(Tt),Bt--;for(;0<ci-Bt;)lt=Tn(lt),ci--;for(;Bt--;){if(Tt===lt||lt!==null&&Tt===lt.alternate){Tn=Tt;break t}Tt=Tn(Tt),lt=Tn(lt)}Tn=null}else Tn=null;Zt!==null&&mx(hi,Ut,Zt,Tn,!1),Hi!==null&&vs!==null&&mx(hi,vs,Hi,Tn,!0)}}e:{if(Ut=Ft?Ii(Ft):window,Zt=Ut.nodeName&&Ut.nodeName.toLowerCase(),Zt==="select"||Zt==="input"&&Ut.type==="file")var ss=Ui;else if(ql(Ut))if(sh)ss=$o;else{ss=xp;var mn=pc}else Zt=Ut.nodeName,!Zt||Zt.toLowerCase()!=="input"||Ut.type!=="checkbox"&&Ut.type!=="radio"?Ft&&Js(Ft.elementType)&&(ss=Ui):ss=po;if(ss&&(ss=ss(u,Ft))){dc(hi,ss,w,si);break e}mn&&mn(u,Ut,Ft),u==="focusout"&&Ft&&Ut.type==="number"&&Ft.memoizedProps.value!=null&&Mo(Ut,"number",Ut.value)}switch(mn=Ft?Ii(Ft):window,u){case"focusin":(ql(mn)||mn.contentEditable==="true")&&(Wo=mn,bp=Ft,Eu=null);break;case"focusout":Eu=bp=Wo=null;break;case"mousedown":ah=!0;break;case"contextmenu":case"mouseup":case"dragend":ah=!1,$c(hi,w,si);break;case"selectionchange":if(A_)break;case"keydown":case"keyup":$c(hi,w,si)}var lr;if(Pr)e:{switch(u){case"compositionstart":var Br="onCompositionStart";break e;case"compositionend":Br="onCompositionEnd";break e;case"compositionupdate":Br="onCompositionUpdate";break e}Br=void 0}else fo?ws(u,w)&&(Br="onCompositionEnd"):u==="keydown"&&w.keyCode===229&&(Br="onCompositionStart");Br&&(Za&&w.locale!=="ko"&&(fo||Br!=="onCompositionStart"?Br==="onCompositionEnd"&&fo&&(lr=Gc()):(va=si,Mn="value"in va?va.value:va.textContent,fo=!0)),mn=$_(Ft,Br),0<mn.length&&(Br=new Gl(Br,u,null,w,si),hi.push({event:Br,listeners:mn}),lr?Br.data=lr:(lr=Oa(w),lr!==null&&(Br.data=lr)))),(lr=na?vp(u,w):ud(u,w))&&(Br=$_(Ft,"onBeforeInput"),0<Br.length&&(mn=new Gl("onBeforeInput","beforeinput",null,w,si),hi.push({event:mn,listeners:Br}),mn.data=lr)),$1(hi,u,Ft,w,si)}fv(hi,g)})}function Dg(u,g,w){return{instance:u,listener:g,currentTarget:w}}function $_(u,g){for(var w=g+"Capture",C=[];u!==null;){var F=u,j=F.stateNode;if(F=F.tag,F!==5&&F!==26&&F!==27||j===null||(F=Ho(u,w),F!=null&&C.unshift(Dg(u,F,j)),F=Ho(u,g),F!=null&&C.push(Dg(u,F,j))),u.tag===3)return C;u=u.return}return[]}function W1(u){if(u===null)return null;do u=u.return;while(u&&u.tag!==5&&u.tag!==27);return u||null}function mx(u,g,w,C,F){for(var j=g._reactName,se=[];w!==null&&w!==C;){var Ae=w,Qe=Ae.alternate,Ft=Ae.stateNode;if(Ae=Ae.tag,Qe!==null&&Qe===C)break;Ae!==5&&Ae!==26&&Ae!==27||Ft===null||(Qe=Ft,F?(Ft=Ho(w,j),Ft!=null&&se.unshift(Dg(w,Ft,Qe))):F||(Ft=Ho(w,j),Ft!=null&&se.push(Dg(w,Ft,Qe)))),w=w.return}se.length!==0&&u.push({event:g,listeners:se})}var am=/\r\n?/g,gx=/\u0000|\uFFFD/g;function jd(u){return(typeof u=="string"?u:""+u).replace(am,`
`).replace(gx,"")}function lm(u,g){return g=jd(g),jd(u)===g}function Is(u,g,w,C,F,j){switch(w){case"children":typeof C=="string"?g==="body"||g==="textarea"&&C===""||Do(u,C):(typeof C=="number"||typeof C=="bigint")&&g!=="body"&&Do(u,""+C);break;case"className":jn(u,"class",C);break;case"tabIndex":jn(u,"tabindex",C);break;case"dir":case"role":case"viewBox":case"width":case"height":jn(u,w,C);break;case"style":_a(u,C,j);break;case"data":if(g!=="object"){jn(u,"data",C);break}case"src":case"href":if(C===""&&(g!=="a"||w!=="href")){u.removeAttribute(w);break}if(C==null||typeof C=="function"||typeof C=="symbol"||typeof C=="boolean"){u.removeAttribute(w);break}C=hl(""+C),u.setAttribute(w,C);break;case"action":case"formAction":if(typeof C=="function"){u.setAttribute(w,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof j=="function"&&(w==="formAction"?(g!=="input"&&Is(u,g,"name",F.name,F,null),Is(u,g,"formEncType",F.formEncType,F,null),Is(u,g,"formMethod",F.formMethod,F,null),Is(u,g,"formTarget",F.formTarget,F,null)):(Is(u,g,"encType",F.encType,F,null),Is(u,g,"method",F.method,F,null),Is(u,g,"target",F.target,F,null)));if(C==null||typeof C=="symbol"||typeof C=="boolean"){u.removeAttribute(w);break}C=hl(""+C),u.setAttribute(w,C);break;case"onClick":C!=null&&(u.onclick=Pa);break;case"onScroll":C!=null&&Rr("scroll",u);break;case"onScrollEnd":C!=null&&Rr("scrollend",u);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(p(61));if(w=C.__html,w!=null){if(F.children!=null)throw Error(p(60));u.innerHTML=w}}break;case"multiple":u.multiple=C&&typeof C!="function"&&typeof C!="symbol";break;case"muted":u.muted=C&&typeof C!="function"&&typeof C!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(C==null||typeof C=="function"||typeof C=="boolean"||typeof C=="symbol"){u.removeAttribute("xlink:href");break}w=hl(""+C),u.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",w);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":C!=null&&typeof C!="function"&&typeof C!="symbol"?u.setAttribute(w,""+C):u.removeAttribute(w);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":C&&typeof C!="function"&&typeof C!="symbol"?u.setAttribute(w,""):u.removeAttribute(w);break;case"capture":case"download":C===!0?u.setAttribute(w,""):C!==!1&&C!=null&&typeof C!="function"&&typeof C!="symbol"?u.setAttribute(w,C):u.removeAttribute(w);break;case"cols":case"rows":case"size":case"span":C!=null&&typeof C!="function"&&typeof C!="symbol"&&!isNaN(C)&&1<=C?u.setAttribute(w,C):u.removeAttribute(w);break;case"rowSpan":case"start":C==null||typeof C=="function"||typeof C=="symbol"||isNaN(C)?u.removeAttribute(w):u.setAttribute(w,C);break;case"popover":Rr("beforetoggle",u),Rr("toggle",u),dn(u,"popover",C);break;case"xlinkActuate":Pn(u,"http://www.w3.org/1999/xlink","xlink:actuate",C);break;case"xlinkArcrole":Pn(u,"http://www.w3.org/1999/xlink","xlink:arcrole",C);break;case"xlinkRole":Pn(u,"http://www.w3.org/1999/xlink","xlink:role",C);break;case"xlinkShow":Pn(u,"http://www.w3.org/1999/xlink","xlink:show",C);break;case"xlinkTitle":Pn(u,"http://www.w3.org/1999/xlink","xlink:title",C);break;case"xlinkType":Pn(u,"http://www.w3.org/1999/xlink","xlink:type",C);break;case"xmlBase":Pn(u,"http://www.w3.org/XML/1998/namespace","xml:base",C);break;case"xmlLang":Pn(u,"http://www.w3.org/XML/1998/namespace","xml:lang",C);break;case"xmlSpace":Pn(u,"http://www.w3.org/XML/1998/namespace","xml:space",C);break;case"is":dn(u,"is",C);break;case"innerText":case"textContent":break;default:(!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(w=ea.get(w)||w,dn(u,w,C))}}function mv(u,g,w,C,F,j){switch(w){case"style":_a(u,C,j);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(p(61));if(w=C.__html,w!=null){if(F.children!=null)throw Error(p(60));u.innerHTML=w}}break;case"children":typeof C=="string"?Do(u,C):(typeof C=="number"||typeof C=="bigint")&&Do(u,""+C);break;case"onScroll":C!=null&&Rr("scroll",u);break;case"onScrollEnd":C!=null&&Rr("scrollend",u);break;case"onClick":C!=null&&(u.onclick=Pa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!sn.hasOwnProperty(w))e:{if(w[0]==="o"&&w[1]==="n"&&(F=w.endsWith("Capture"),g=w.slice(2,F?w.length-7:void 0),j=u[de]||null,j=j!=null?j[w]:null,typeof j=="function"&&u.removeEventListener(g,j,F),typeof C=="function")){typeof j!="function"&&j!==null&&(w in u?u[w]=null:u.hasAttribute(w)&&u.removeAttribute(w)),u.addEventListener(g,C,F);break e}w in u?u[w]=C:C===!0?u.setAttribute(w,""):dn(u,w,C)}}}function Ia(u,g,w){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Rr("error",u),Rr("load",u);var C=!1,F=!1,j;for(j in w)if(w.hasOwnProperty(j)){var se=w[j];if(se!=null)switch(j){case"src":C=!0;break;case"srcSet":F=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(p(137,g));default:Is(u,g,j,se,w,null)}}F&&Is(u,g,"srcSet",w.srcSet,w,null),C&&Is(u,g,"src",w.src,w,null);return;case"input":Rr("invalid",u);var Ae=j=se=F=null,Qe=null,Ft=null;for(C in w)if(w.hasOwnProperty(C)){var si=w[C];if(si!=null)switch(C){case"name":F=si;break;case"type":se=si;break;case"checked":Qe=si;break;case"defaultChecked":Ft=si;break;case"value":j=si;break;case"defaultValue":Ae=si;break;case"children":case"dangerouslySetInnerHTML":if(si!=null)throw Error(p(137,g));break;default:Is(u,g,C,si,w,null)}}Da(u,j,Ae,Qe,Ft,se,F,!1);return;case"select":Rr("invalid",u),C=se=j=null;for(F in w)if(w.hasOwnProperty(F)&&(Ae=w[F],Ae!=null))switch(F){case"value":j=Ae;break;case"defaultValue":se=Ae;break;case"multiple":C=Ae;default:Is(u,g,F,Ae,w,null)}g=j,w=se,u.multiple=!!C,g!=null?Qs(u,!!C,g,!1):w!=null&&Qs(u,!!C,w,!0);return;case"textarea":Rr("invalid",u),j=F=C=null;for(se in w)if(w.hasOwnProperty(se)&&(Ae=w[se],Ae!=null))switch(se){case"value":C=Ae;break;case"defaultValue":F=Ae;break;case"children":j=Ae;break;case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(p(91));break;default:Is(u,g,se,Ae,w,null)}ul(u,C,F,j);return;case"option":for(Qe in w)if(w.hasOwnProperty(Qe)&&(C=w[Qe],C!=null))switch(Qe){case"selected":u.selected=C&&typeof C!="function"&&typeof C!="symbol";break;default:Is(u,g,Qe,C,w,null)}return;case"dialog":Rr("beforetoggle",u),Rr("toggle",u),Rr("cancel",u),Rr("close",u);break;case"iframe":case"object":Rr("load",u);break;case"video":case"audio":for(C=0;C<om.length;C++)Rr(om[C],u);break;case"image":Rr("error",u),Rr("load",u);break;case"details":Rr("toggle",u);break;case"embed":case"source":case"link":Rr("error",u),Rr("load",u);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ft in w)if(w.hasOwnProperty(Ft)&&(C=w[Ft],C!=null))switch(Ft){case"children":case"dangerouslySetInnerHTML":throw Error(p(137,g));default:Is(u,g,Ft,C,w,null)}return;default:if(Js(g)){for(si in w)w.hasOwnProperty(si)&&(C=w[si],C!==void 0&&mv(u,g,si,C,w,void 0));return}}for(Ae in w)w.hasOwnProperty(Ae)&&(C=w[Ae],C!=null&&Is(u,g,Ae,C,w,null))}function Z1(u,g,w,C){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var F=null,j=null,se=null,Ae=null,Qe=null,Ft=null,si=null;for(Zt in w){var hi=w[Zt];if(w.hasOwnProperty(Zt)&&hi!=null)switch(Zt){case"checked":break;case"value":break;case"defaultValue":Qe=hi;default:C.hasOwnProperty(Zt)||Is(u,g,Zt,null,C,hi)}}for(var Ut in C){var Zt=C[Ut];if(hi=w[Ut],C.hasOwnProperty(Ut)&&(Zt!=null||hi!=null))switch(Ut){case"type":j=Zt;break;case"name":F=Zt;break;case"checked":Ft=Zt;break;case"defaultChecked":si=Zt;break;case"value":se=Zt;break;case"defaultValue":Ae=Zt;break;case"children":case"dangerouslySetInnerHTML":if(Zt!=null)throw Error(p(137,g));break;default:Zt!==hi&&Is(u,g,Ut,Zt,C,hi)}}Ys(u,se,Ae,Qe,Ft,si,j,F);return;case"select":Zt=se=Ae=Ut=null;for(j in w)if(Qe=w[j],w.hasOwnProperty(j)&&Qe!=null)switch(j){case"value":break;case"multiple":Zt=Qe;default:C.hasOwnProperty(j)||Is(u,g,j,null,C,Qe)}for(F in C)if(j=C[F],Qe=w[F],C.hasOwnProperty(F)&&(j!=null||Qe!=null))switch(F){case"value":Ut=j;break;case"defaultValue":Ae=j;break;case"multiple":se=j;default:j!==Qe&&Is(u,g,F,j,C,Qe)}g=Ae,w=se,C=Zt,Ut!=null?Qs(u,!!w,Ut,!1):!!C!=!!w&&(g!=null?Qs(u,!!w,g,!0):Qs(u,!!w,w?[]:"",!1));return;case"textarea":Zt=Ut=null;for(Ae in w)if(F=w[Ae],w.hasOwnProperty(Ae)&&F!=null&&!C.hasOwnProperty(Ae))switch(Ae){case"value":break;case"children":break;default:Is(u,g,Ae,null,C,F)}for(se in C)if(F=C[se],j=w[se],C.hasOwnProperty(se)&&(F!=null||j!=null))switch(se){case"value":Ut=F;break;case"defaultValue":Zt=F;break;case"children":break;case"dangerouslySetInnerHTML":if(F!=null)throw Error(p(91));break;default:F!==j&&Is(u,g,se,F,C,j)}nh(u,Ut,Zt);return;case"option":for(var Hi in w)if(Ut=w[Hi],w.hasOwnProperty(Hi)&&Ut!=null&&!C.hasOwnProperty(Hi))switch(Hi){case"selected":u.selected=!1;break;default:Is(u,g,Hi,null,C,Ut)}for(Qe in C)if(Ut=C[Qe],Zt=w[Qe],C.hasOwnProperty(Qe)&&Ut!==Zt&&(Ut!=null||Zt!=null))switch(Qe){case"selected":u.selected=Ut&&typeof Ut!="function"&&typeof Ut!="symbol";break;default:Is(u,g,Qe,Ut,C,Zt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Tn in w)Ut=w[Tn],w.hasOwnProperty(Tn)&&Ut!=null&&!C.hasOwnProperty(Tn)&&Is(u,g,Tn,null,C,Ut);for(Ft in C)if(Ut=C[Ft],Zt=w[Ft],C.hasOwnProperty(Ft)&&Ut!==Zt&&(Ut!=null||Zt!=null))switch(Ft){case"children":case"dangerouslySetInnerHTML":if(Ut!=null)throw Error(p(137,g));break;default:Is(u,g,Ft,Ut,C,Zt)}return;default:if(Js(g)){for(var vs in w)Ut=w[vs],w.hasOwnProperty(vs)&&Ut!==void 0&&!C.hasOwnProperty(vs)&&mv(u,g,vs,void 0,C,Ut);for(si in C)Ut=C[si],Zt=w[si],!C.hasOwnProperty(si)||Ut===Zt||Ut===void 0&&Zt===void 0||mv(u,g,si,Ut,C,Zt);return}}for(var Tt in w)Ut=w[Tt],w.hasOwnProperty(Tt)&&Ut!=null&&!C.hasOwnProperty(Tt)&&Is(u,g,Tt,null,C,Ut);for(hi in C)Ut=C[hi],Zt=w[hi],!C.hasOwnProperty(hi)||Ut===Zt||Ut==null&&Zt==null||Is(u,g,hi,Ut,C,Zt)}function _x(u){switch(u){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function X1(){if(typeof performance.getEntriesByType=="function"){for(var u=0,g=0,w=performance.getEntriesByType("resource"),C=0;C<w.length;C++){var F=w[C],j=F.transferSize,se=F.initiatorType,Ae=F.duration;if(j&&Ae&&_x(se)){for(se=0,Ae=F.responseEnd,C+=1;C<w.length;C++){var Qe=w[C],Ft=Qe.startTime;if(Ft>Ae)break;var si=Qe.transferSize,hi=Qe.initiatorType;si&&_x(hi)&&(Qe=Qe.responseEnd,se+=si*(Qe<Ae?1:(Ae-Ft)/(Qe-Ft)))}if(--C,g+=8*(j+se)/(F.duration/1e3),u++,10<u)break}}if(0<u)return g/u/1e6}return navigator.connection&&(u=navigator.connection.downlink,typeof u=="number")?u:5}var gv=null,Pg=null;function W_(u){return u.nodeType===9?u:u.ownerDocument}function _v(u){switch(u){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function cm(u,g){if(u===0)switch(g){case"svg":return 1;case"math":return 2;default:return 0}return u===1&&g==="foreignObject"?0:u}function yv(u,g){return u==="textarea"||u==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.children=="bigint"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Bs=null;function um(){var u=window.event;return u&&u.type==="popstate"?u===Bs?!1:(Bs=u,!0):(Bs=null,!1)}var vv=typeof setTimeout=="function"?setTimeout:void 0,Z_=typeof clearTimeout=="function"?clearTimeout:void 0,Og=typeof Promise=="function"?Promise:void 0,Lg=typeof queueMicrotask=="function"?queueMicrotask:typeof Og<"u"?function(u){return Og.resolve(null).then(u).catch(yx)}:vv;function yx(u){setTimeout(function(){throw u})}function Uh(u){return u==="head"}function hm(u,g){var w=g,C=0;do{var F=w.nextSibling;if(u.removeChild(w),F&&F.nodeType===8)if(w=F.data,w==="/$"||w==="/&"){if(C===0){u.removeChild(F),Wh(g);return}C--}else if(w==="$"||w==="$?"||w==="$~"||w==="$!"||w==="&")C++;else if(w==="html")Gd(u.ownerDocument.documentElement);else if(w==="head"){w=u.ownerDocument.head,Gd(w);for(var j=w.firstChild;j;){var se=j.nextSibling,Ae=j.nodeName;j[We]||Ae==="SCRIPT"||Ae==="STYLE"||Ae==="LINK"&&j.rel.toLowerCase()==="stylesheet"||w.removeChild(j),j=se}}else w==="body"&&Gd(u.ownerDocument.body);w=F}while(w);Wh(g)}function X_(u,g){var w=u;u=0;do{var C=w.nextSibling;if(w.nodeType===1?g?(w._stashedDisplay=w.style.display,w.style.display="none"):(w.style.display=w._stashedDisplay||"",w.getAttribute("style")===""&&w.removeAttribute("style")):w.nodeType===3&&(g?(w._stashedText=w.nodeValue,w.nodeValue=""):w.nodeValue=w._stashedText||""),C&&C.nodeType===8)if(w=C.data,w==="/$"){if(u===0)break;u--}else w!=="$"&&w!=="$?"&&w!=="$~"&&w!=="$!"||u++;w=C}while(w)}function Zf(u){var g=u.firstChild;for(g&&g.nodeType===10&&(g=g.nextSibling);g;){var w=g;switch(g=g.nextSibling,w.nodeName){case"HTML":case"HEAD":case"BODY":Zf(w),Ot(w);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(w.rel.toLowerCase()==="stylesheet")continue}u.removeChild(w)}}function K1(u,g,w,C){for(;u.nodeType===1;){var F=w;if(u.nodeName.toLowerCase()!==g.toLowerCase()){if(!C&&(u.nodeName!=="INPUT"||u.type!=="hidden"))break}else if(C){if(!u[We])switch(g){case"meta":if(!u.hasAttribute("itemprop"))break;return u;case"link":if(j=u.getAttribute("rel"),j==="stylesheet"&&u.hasAttribute("data-precedence"))break;if(j!==F.rel||u.getAttribute("href")!==(F.href==null||F.href===""?null:F.href)||u.getAttribute("crossorigin")!==(F.crossOrigin==null?null:F.crossOrigin)||u.getAttribute("title")!==(F.title==null?null:F.title))break;return u;case"style":if(u.hasAttribute("data-precedence"))break;return u;case"script":if(j=u.getAttribute("src"),(j!==(F.src==null?null:F.src)||u.getAttribute("type")!==(F.type==null?null:F.type)||u.getAttribute("crossorigin")!==(F.crossOrigin==null?null:F.crossOrigin))&&j&&u.hasAttribute("async")&&!u.hasAttribute("itemprop"))break;return u;default:return u}}else if(g==="input"&&u.type==="hidden"){var j=F.name==null?null:""+F.name;if(F.type==="hidden"&&u.getAttribute("name")===j)return u}else return u;if(u=Lc(u.nextSibling),u===null)break}return null}function vx(u,g,w){if(g==="")return null;for(;u.nodeType!==3;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!w||(u=Lc(u.nextSibling),u===null))return null;return u}function K_(u,g){for(;u.nodeType!==8;)if((u.nodeType!==1||u.nodeName!=="INPUT"||u.type!=="hidden")&&!g||(u=Lc(u.nextSibling),u===null))return null;return u}function zg(u){return u.data==="$?"||u.data==="$~"}function Y_(u){return u.data==="$!"||u.data==="$?"&&u.ownerDocument.readyState!=="loading"}function jh(u,g){var w=u.ownerDocument;if(u.data==="$~")u._reactRetry=g;else if(u.data!=="$?"||w.readyState!=="loading")g();else{var C=function(){g(),w.removeEventListener("DOMContentLoaded",C)};w.addEventListener("DOMContentLoaded",C),u._reactRetry=C}}function Lc(u){for(;u!=null;u=u.nextSibling){var g=u.nodeType;if(g===1||g===3)break;if(g===8){if(g=u.data,g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"||g==="F!"||g==="F")break;if(g==="/$"||g==="/&")return null}}return u}var Ca=null;function xv(u){u=u.nextSibling;for(var g=0;u;){if(u.nodeType===8){var w=u.data;if(w==="/$"||w==="/&"){if(g===0)return Lc(u.nextSibling);g--}else w!=="$"&&w!=="$!"&&w!=="$?"&&w!=="$~"&&w!=="&"||g++}u=u.nextSibling}return null}function bv(u){u=u.previousSibling;for(var g=0;u;){if(u.nodeType===8){var w=u.data;if(w==="$"||w==="$!"||w==="$?"||w==="$~"||w==="&"){if(g===0)return u;g--}else w!=="/$"&&w!=="/&"||g++}u=u.previousSibling}return null}function wv(u,g,w){switch(g=W_(w),u){case"html":if(u=g.documentElement,!u)throw Error(p(452));return u;case"head":if(u=g.head,!u)throw Error(p(453));return u;case"body":if(u=g.body,!u)throw Error(p(454));return u;default:throw Error(p(451))}}function Gd(u){for(var g=u.attributes;g.length;)u.removeAttributeNode(g[0]);Ot(u)}var zc=new Map,xx=new Set;function dm(u){return typeof u.getRootNode=="function"?u.getRootNode():u.nodeType===9?u:u.ownerDocument}var Wu=oi.d;oi.d={f:Tv,r:Ev,D:bx,C:wx,L:Q_,m:Zu,X:Y1,S:Tx,M:Q1};function Tv(){var u=Wu.f(),g=Jr();return u||g}function Ev(u){var g=ui(u);g!==null&&g.tag===5&&g.type==="form"?Dc(g):Wu.r(u)}var Xf=typeof document>"u"?null:document;function Sv(u,g,w){var C=Xf;if(C&&typeof g=="string"&&g){var F=Ms(g);F='link[rel="'+u+'"][href="'+F+'"]',typeof w=="string"&&(F+='[crossorigin="'+w+'"]'),xx.has(F)||(xx.add(F),u={rel:u,crossOrigin:w,href:g},C.querySelector(F)===null&&(g=C.createElement("link"),Ia(g,"link",u),gi(g),C.head.appendChild(g)))}}function bx(u){Wu.D(u),Sv("dns-prefetch",u,null)}function wx(u,g){Wu.C(u,g),Sv("preconnect",u,g)}function Q_(u,g,w){Wu.L(u,g,w);var C=Xf;if(C&&u&&g){var F='link[rel="preload"][as="'+Ms(g)+'"]';g==="image"&&w&&w.imageSrcSet?(F+='[imagesrcset="'+Ms(w.imageSrcSet)+'"]',typeof w.imageSizes=="string"&&(F+='[imagesizes="'+Ms(w.imageSizes)+'"]')):F+='[href="'+Ms(u)+'"]';var j=F;switch(g){case"style":j=fm(u);break;case"script":j=pm(u)}zc.has(j)||(u=ce({rel:"preload",href:g==="image"&&w&&w.imageSrcSet?void 0:u,as:g},w),zc.set(j,u),C.querySelector(F)!==null||g==="style"&&C.querySelector(kg(j))||g==="script"&&C.querySelector(Gh(j))||(g=C.createElement("link"),Ia(g,"link",u),gi(g),C.head.appendChild(g)))}}function Zu(u,g){Wu.m(u,g);var w=Xf;if(w&&u){var C=g&&typeof g.as=="string"?g.as:"script",F='link[rel="modulepreload"][as="'+Ms(C)+'"][href="'+Ms(u)+'"]',j=F;switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":j=pm(u)}if(!zc.has(j)&&(u=ce({rel:"modulepreload",href:u},g),zc.set(j,u),w.querySelector(F)===null)){switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(w.querySelector(Gh(j)))return}C=w.createElement("link"),Ia(C,"link",u),gi(C),w.head.appendChild(C)}}}function Tx(u,g,w){Wu.S(u,g,w);var C=Xf;if(C&&u){var F=Ci(C).hoistableStyles,j=fm(u);g=g||"default";var se=F.get(j);if(!se){var Ae={loading:0,preload:null};if(se=C.querySelector(kg(j)))Ae.loading=5;else{u=ce({rel:"stylesheet",href:u,"data-precedence":g},w),(w=zc.get(j))&&mm(u,w);var Qe=se=C.createElement("link");gi(Qe),Ia(Qe,"link",u),Qe._p=new Promise(function(Ft,si){Qe.onload=Ft,Qe.onerror=si}),Qe.addEventListener("load",function(){Ae.loading|=1}),Qe.addEventListener("error",function(){Ae.loading|=2}),Ae.loading|=4,Fg(se,g,C)}se={type:"stylesheet",instance:se,count:1,state:Ae},F.set(j,se)}}}function Y1(u,g){Wu.X(u,g);var w=Xf;if(w&&u){var C=Ci(w).hoistableScripts,F=pm(u),j=C.get(F);j||(j=w.querySelector(Gh(F)),j||(u=ce({src:u,async:!0},g),(g=zc.get(F))&&J_(u,g),j=w.createElement("script"),gi(j),Ia(j,"link",u),w.head.appendChild(j)),j={type:"script",instance:j,count:1,state:null},C.set(F,j))}}function Q1(u,g){Wu.M(u,g);var w=Xf;if(w&&u){var C=Ci(w).hoistableScripts,F=pm(u),j=C.get(F);j||(j=w.querySelector(Gh(F)),j||(u=ce({src:u,async:!0,type:"module"},g),(g=zc.get(F))&&J_(u,g),j=w.createElement("script"),gi(j),Ia(j,"link",u),w.head.appendChild(j)),j={type:"script",instance:j,count:1,state:null},C.set(F,j))}}function Ex(u,g,w,C){var F=(F=kn.current)?dm(F):null;if(!F)throw Error(p(446));switch(u){case"meta":case"title":return null;case"style":return typeof w.precedence=="string"&&typeof w.href=="string"?(g=fm(w.href),w=Ci(F).hoistableStyles,C=w.get(g),C||(C={type:"style",instance:null,count:0,state:null},w.set(g,C)),C):{type:"void",instance:null,count:0,state:null};case"link":if(w.rel==="stylesheet"&&typeof w.href=="string"&&typeof w.precedence=="string"){u=fm(w.href);var j=Ci(F).hoistableStyles,se=j.get(u);if(se||(F=F.ownerDocument||F,se={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},j.set(u,se),(j=F.querySelector(kg(u)))&&!j._p&&(se.instance=j,se.state.loading=5),zc.has(u)||(w={rel:"preload",as:"style",href:w.href,crossOrigin:w.crossOrigin,integrity:w.integrity,media:w.media,hrefLang:w.hrefLang,referrerPolicy:w.referrerPolicy},zc.set(u,w),j||J1(F,u,w,se.state))),g&&C===null)throw Error(p(528,""));return se}if(g&&C!==null)throw Error(p(529,""));return null;case"script":return g=w.async,w=w.src,typeof w=="string"&&g&&typeof g!="function"&&typeof g!="symbol"?(g=pm(w),w=Ci(F).hoistableScripts,C=w.get(g),C||(C={type:"script",instance:null,count:0,state:null},w.set(g,C)),C):{type:"void",instance:null,count:0,state:null};default:throw Error(p(444,u))}}function fm(u){return'href="'+Ms(u)+'"'}function kg(u){return'link[rel="stylesheet"]['+u+"]"}function Sx(u){return ce({},u,{"data-precedence":u.precedence,precedence:null})}function J1(u,g,w,C){u.querySelector('link[rel="preload"][as="style"]['+g+"]")?C.loading=1:(g=u.createElement("link"),C.preload=g,g.addEventListener("load",function(){return C.loading|=1}),g.addEventListener("error",function(){return C.loading|=2}),Ia(g,"link",w),gi(g),u.head.appendChild(g))}function pm(u){return'[src="'+Ms(u)+'"]'}function Gh(u){return"script[async]"+u}function Av(u,g,w){if(g.count++,g.instance===null)switch(g.type){case"style":var C=u.querySelector('style[data-href~="'+Ms(w.href)+'"]');if(C)return g.instance=C,gi(C),C;var F=ce({},w,{"data-href":w.href,"data-precedence":w.precedence,href:null,precedence:null});return C=(u.ownerDocument||u).createElement("style"),gi(C),Ia(C,"style",F),Fg(C,w.precedence,u),g.instance=C;case"stylesheet":F=fm(w.href);var j=u.querySelector(kg(F));if(j)return g.state.loading|=4,g.instance=j,gi(j),j;C=Sx(w),(F=zc.get(F))&&mm(C,F),j=(u.ownerDocument||u).createElement("link"),gi(j);var se=j;return se._p=new Promise(function(Ae,Qe){se.onload=Ae,se.onerror=Qe}),Ia(j,"link",C),g.state.loading|=4,Fg(j,w.precedence,u),g.instance=j;case"script":return j=pm(w.src),(F=u.querySelector(Gh(j)))?(g.instance=F,gi(F),F):(C=w,(F=zc.get(j))&&(C=ce({},w),J_(C,F)),u=u.ownerDocument||u,F=u.createElement("script"),gi(F),Ia(F,"link",C),u.head.appendChild(F),g.instance=F);case"void":return null;default:throw Error(p(443,g.type))}else g.type==="stylesheet"&&(g.state.loading&4)===0&&(C=g.instance,g.state.loading|=4,Fg(C,w.precedence,u));return g.instance}function Fg(u,g,w){for(var C=w.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),F=C.length?C[C.length-1]:null,j=F,se=0;se<C.length;se++){var Ae=C[se];if(Ae.dataset.precedence===g)j=Ae;else if(j!==F)break}j?j.parentNode.insertBefore(u,j.nextSibling):(g=w.nodeType===9?w.head:w,g.insertBefore(u,g.firstChild))}function mm(u,g){u.crossOrigin==null&&(u.crossOrigin=g.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=g.referrerPolicy),u.title==null&&(u.title=g.title)}function J_(u,g){u.crossOrigin==null&&(u.crossOrigin=g.crossOrigin),u.referrerPolicy==null&&(u.referrerPolicy=g.referrerPolicy),u.integrity==null&&(u.integrity=g.integrity)}var gm=null;function Bg(u,g,w){if(gm===null){var C=new Map,F=gm=new Map;F.set(w,C)}else F=gm,C=F.get(w),C||(C=new Map,F.set(w,C));if(C.has(u))return C;for(C.set(u,null),w=w.getElementsByTagName(u),F=0;F<w.length;F++){var j=w[F];if(!(j[We]||j[J]||u==="link"&&j.getAttribute("rel")==="stylesheet")&&j.namespaceURI!=="http://www.w3.org/2000/svg"){var se=j.getAttribute(g)||"";se=u+se;var Ae=C.get(se);Ae?Ae.push(j):C.set(se,[j])}}return C}function Iv(u,g,w){u=u.ownerDocument||u,u.head.insertBefore(w,g==="title"?u.querySelector("head > title"):null)}function ew(u,g,w){if(w===1||g.itemProp!=null)return!1;switch(u){case"meta":case"title":return!0;case"style":if(typeof g.precedence!="string"||typeof g.href!="string"||g.href==="")break;return!0;case"link":if(typeof g.rel!="string"||typeof g.href!="string"||g.href===""||g.onLoad||g.onError)break;switch(g.rel){case"stylesheet":return u=g.disabled,typeof g.precedence=="string"&&u==null;default:return!0}case"script":if(g.async&&typeof g.async!="function"&&typeof g.async!="symbol"&&!g.onLoad&&!g.onError&&g.src&&typeof g.src=="string")return!0}return!1}function ey(u){return!(u.type==="stylesheet"&&(u.state.loading&3)===0)}function Ax(u,g,w,C){if(w.type==="stylesheet"&&(typeof C.media!="string"||matchMedia(C.media).matches!==!1)&&(w.state.loading&4)===0){if(w.instance===null){var F=fm(C.href),j=g.querySelector(kg(F));if(j){g=j._p,g!==null&&typeof g=="object"&&typeof g.then=="function"&&(u.count++,u=_m.bind(u),g.then(u,u)),w.state.loading|=4,w.instance=j,gi(j);return}j=g.ownerDocument||g,C=Sx(C),(F=zc.get(F))&&mm(C,F),j=j.createElement("link"),gi(j);var se=j;se._p=new Promise(function(Ae,Qe){se.onload=Ae,se.onerror=Qe}),Ia(j,"link",C),w.instance=j}u.stylesheets===null&&(u.stylesheets=new Map),u.stylesheets.set(w,g),(g=w.state.preload)&&(w.state.loading&3)===0&&(u.count++,w=_m.bind(u),g.addEventListener("load",w),g.addEventListener("error",w))}}var ty=0;function Cv(u,g){return u.stylesheets&&u.count===0&&ym(u,u.stylesheets),0<u.count||0<u.imgCount?function(w){var C=setTimeout(function(){if(u.stylesheets&&ym(u,u.stylesheets),u.unsuspend){var j=u.unsuspend;u.unsuspend=null,j()}},6e4+g);0<u.imgBytes&&ty===0&&(ty=62500*X1());var F=setTimeout(function(){if(u.waitingForImages=!1,u.count===0&&(u.stylesheets&&ym(u,u.stylesheets),u.unsuspend)){var j=u.unsuspend;u.unsuspend=null,j()}},(u.imgBytes>ty?50:800)+g);return u.unsuspend=w,function(){u.unsuspend=null,clearTimeout(C),clearTimeout(F)}}:null}function _m(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)ym(this,this.stylesheets);else if(this.unsuspend){var u=this.unsuspend;this.unsuspend=null,u()}}}var Ng=null;function ym(u,g){u.stylesheets=null,u.unsuspend!==null&&(u.count++,Ng=new Map,g.forEach(tw,u),Ng=null,_m.call(u))}function tw(u,g){if(!(g.state.loading&4)){var w=Ng.get(u);if(w)var C=w.get(null);else{w=new Map,Ng.set(u,w);for(var F=u.querySelectorAll("link[data-precedence],style[data-precedence]"),j=0;j<F.length;j++){var se=F[j];(se.nodeName==="LINK"||se.getAttribute("media")!=="not all")&&(w.set(se.dataset.precedence,se),C=se)}C&&w.set(null,C)}F=g.instance,se=F.getAttribute("data-precedence"),j=w.get(se)||C,j===C&&w.set(null,F),w.set(se,F),this.count++,C=_m.bind(this),F.addEventListener("load",C),F.addEventListener("error",C),j?j.parentNode.insertBefore(F,j.nextSibling):(u=u.nodeType===9?u.head:u,u.insertBefore(F,u.firstChild)),g.state.loading|=4}}var Vg={$$typeof:Gt,Provider:null,Consumer:null,_currentValue:wi,_currentValue2:wi,_threadCount:0};function iw(u,g,w,C,F,j,se,Ae,Qe){this.tag=1,this.containerInfo=u,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ga(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ga(0),this.hiddenUpdates=ga(null),this.identifierPrefix=C,this.onUncaughtError=F,this.onCaughtError=j,this.onRecoverableError=se,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Qe,this.incompleteTransitions=new Map}function Ix(u,g,w,C,F,j,se,Ae,Qe,Ft,si,hi){return u=new iw(u,g,w,se,Qe,Ft,si,hi,Ae),g=1,j===!0&&(g|=24),j=sa(3,null,null,g),u.current=j,j.stateNode=u,g=vf(),g.refCount++,u.pooledCache=g,g.refCount++,j.memoizedState={element:C,isDehydrated:w,cache:g},If(j),u}function Rv(u){return u?(u=gc,u):gc}function qh(u,g,w,C,F,j){F=Rv(F),C.context===null?C.context=F:C.pendingContext=F,C=Ec(g),C.payload={element:w},j=j===void 0?null:j,j!==null&&(C.callback=j),w=Sc(u,C,g),w!==null&&(Qr(w,u,g),Lu(w,u,g))}function Mv(u,g){if(u=u.memoizedState,u!==null&&u.dehydrated!==null){var w=u.retryLane;u.retryLane=w!==0&&w<g?w:g}}function iy(u,g){Mv(u,g),(u=u.alternate)&&Mv(u,g)}function vm(u){if(u.tag===13||u.tag===31){var g=gl(u,67108864);g!==null&&Qr(g,u,67108864),iy(u,67108864)}}function xm(u){if(u.tag===13||u.tag===31){var g=ls();g=Ls(g);var w=gl(u,g);w!==null&&Qr(w,u,g),iy(u,g)}}var Kf=!0;function Ug(u,g,w,C){var F=Ct.T;Ct.T=null;var j=oi.p;try{oi.p=2,ny(u,g,w,C)}finally{oi.p=j,Ct.T=F}}function Cx(u,g,w,C){var F=Ct.T;Ct.T=null;var j=oi.p;try{oi.p=8,ny(u,g,w,C)}finally{oi.p=j,Ct.T=F}}function ny(u,g,w,C){if(Kf){var F=ry(C);if(F===null)Wf(u,g,C,jg,w),Pv(u,C);else if(Dx(F,u,g,w,C))C.stopPropagation();else if(Pv(u,C),g&4&&-1<Mx.indexOf(u)){for(;F!==null;){var j=ui(F);if(j!==null)switch(j.tag){case 3:if(j=j.stateNode,j.current.memoizedState.isDehydrated){var se=Go(j.pendingLanes);if(se!==0){var Ae=j;for(Ae.pendingLanes|=2,Ae.entangledLanes|=2;se;){var Qe=1<<31-Ts(se);Ae.entanglements[1]|=Qe,se&=~Qe}Aa(j),(wt&6)===0&&(nn=$i()+500,sm(0))}}break;case 31:case 13:Ae=gl(j,2),Ae!==null&&Qr(Ae,j,2),Jr(),iy(j,2)}if(j=ry(C),j===null&&Wf(u,g,C,jg,w),j===F)break;F=j}F!==null&&C.stopPropagation()}else Wf(u,g,C,null,w)}}function ry(u){return u=eo(u),Dv(u)}var jg=null;function Dv(u){if(jg=null,u=xt(u),u!==null){var g=I(u);if(g===null)u=null;else{var w=g.tag;if(w===13){if(u=P(g),u!==null)return u;u=null}else if(w===31){if(u=s(g),u!==null)return u;u=null}else if(w===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;u=null}else g!==u&&(u=null)}}return jg=u,null}function Rx(u){switch(u){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ks()){case Kn:return 2;case uo:return 8;case Uo:case jo:return 32;case ac:return 268435456;default:return 32}default:return 32}}var Gg=!1,uu=null,Hh=null,qd=null,bm=new Map,Yf=new Map,$h=[],Mx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Pv(u,g){switch(u){case"focusin":case"focusout":uu=null;break;case"dragenter":case"dragleave":Hh=null;break;case"mouseover":case"mouseout":qd=null;break;case"pointerover":case"pointerout":bm.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yf.delete(g.pointerId)}}function wm(u,g,w,C,F,j){return u===null||u.nativeEvent!==j?(u={blockedOn:g,domEventName:w,eventSystemFlags:C,nativeEvent:j,targetContainers:[F]},g!==null&&(g=ui(g),g!==null&&vm(g)),u):(u.eventSystemFlags|=C,g=u.targetContainers,F!==null&&g.indexOf(F)===-1&&g.push(F),u)}function Dx(u,g,w,C,F){switch(g){case"focusin":return uu=wm(uu,u,g,w,C,F),!0;case"dragenter":return Hh=wm(Hh,u,g,w,C,F),!0;case"mouseover":return qd=wm(qd,u,g,w,C,F),!0;case"pointerover":var j=F.pointerId;return bm.set(j,wm(bm.get(j)||null,u,g,w,C,F)),!0;case"gotpointercapture":return j=F.pointerId,Yf.set(j,wm(Yf.get(j)||null,u,g,w,C,F)),!0}return!1}function Px(u){var g=xt(u.target);if(g!==null){var w=I(g);if(w!==null){if(g=w.tag,g===13){if(g=P(w),g!==null){u.blockedOn=g,Ne(u.priority,function(){xm(w)});return}}else if(g===31){if(g=s(w),g!==null){u.blockedOn=g,Ne(u.priority,function(){xm(w)});return}}else if(g===3&&w.stateNode.current.memoizedState.isDehydrated){u.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}u.blockedOn=null}function qg(u){if(u.blockedOn!==null)return!1;for(var g=u.targetContainers;0<g.length;){var w=ry(u.nativeEvent);if(w===null){w=u.nativeEvent;var C=new w.constructor(w.type,w);vu=C,w.target.dispatchEvent(C),vu=null}else return g=ui(w),g!==null&&vm(g),u.blockedOn=w,!1;g.shift()}return!0}function Ov(u,g,w){qg(u)&&w.delete(g)}function Qf(){Gg=!1,uu!==null&&qg(uu)&&(uu=null),Hh!==null&&qg(Hh)&&(Hh=null),qd!==null&&qg(qd)&&(qd=null),bm.forEach(Ov),Yf.forEach(Ov)}function Hg(u,g){u.blockedOn===g&&(u.blockedOn=null,Gg||(Gg=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,Qf)))}var $g=null;function Lv(u){$g!==u&&($g=u,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){$g===u&&($g=null);for(var g=0;g<u.length;g+=3){var w=u[g],C=u[g+1],F=u[g+2];if(typeof C!="function"){if(Dv(C||w)===null)continue;break}var j=ui(w);j!==null&&(u.splice(g,3),g-=3,ru(j,{pending:!0,data:F,method:w.method,action:C},C,F))}}))}function Wh(u){function g(Qe){return Hg(Qe,u)}uu!==null&&Hg(uu,u),Hh!==null&&Hg(Hh,u),qd!==null&&Hg(qd,u),bm.forEach(g),Yf.forEach(g);for(var w=0;w<$h.length;w++){var C=$h[w];C.blockedOn===u&&(C.blockedOn=null)}for(;0<$h.length&&(w=$h[0],w.blockedOn===null);)Px(w),w.blockedOn===null&&$h.shift();if(w=(u.ownerDocument||u).$$reactFormReplay,w!=null)for(C=0;C<w.length;C+=3){var F=w[C],j=w[C+1],se=F[de]||null;if(typeof j=="function")se||Lv(w);else if(se){var Ae=null;if(j&&j.hasAttribute("formAction")){if(F=j,se=j[de]||null)Ae=se.formAction;else if(Dv(F)!==null)continue}else Ae=se.action;typeof Ae=="function"?w[C+1]=Ae:(w.splice(C,3),C-=3),Lv(w)}}}function Ox(){function u(j){j.canIntercept&&j.info==="react-transition"&&j.intercept({handler:function(){return new Promise(function(se){return F=se})},focusReset:"manual",scroll:"manual"})}function g(){F!==null&&(F(),F=null),C||setTimeout(w,20)}function w(){if(!C&&!navigation.transition){var j=navigation.currentEntry;j&&j.url!=null&&navigation.navigate(j.url,{state:j.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var C=!1,F=null;return navigation.addEventListener("navigate",u),navigation.addEventListener("navigatesuccess",g),navigation.addEventListener("navigateerror",g),setTimeout(w,100),function(){C=!0,navigation.removeEventListener("navigate",u),navigation.removeEventListener("navigatesuccess",g),navigation.removeEventListener("navigateerror",g),F!==null&&(F(),F=null)}}}function sy(u){this._internalRoot=u}Hd.prototype.render=sy.prototype.render=function(u){var g=this._internalRoot;if(g===null)throw Error(p(409));var w=g.current,C=ls();qh(w,C,u,g,null,null)},Hd.prototype.unmount=sy.prototype.unmount=function(){var u=this._internalRoot;if(u!==null){this._internalRoot=null;var g=u.containerInfo;qh(u.current,2,null,u,null,null),Jr(),g[Re]=null}};function Hd(u){this._internalRoot=u}Hd.prototype.unstable_scheduleHydration=function(u){if(u){var g=_u();u={blockedOn:null,target:u,priority:g};for(var w=0;w<$h.length&&g!==0&&g<$h[w].priority;w++);$h.splice(w,0,u),w===0&&Px(u)}};var zv=n.version;if(zv!=="19.2.0")throw Error(p(527,zv,"19.2.0"));oi.findDOMNode=function(u){var g=u._reactInternals;if(g===void 0)throw typeof u.render=="function"?Error(p(188)):(u=Object.keys(u).join(","),Error(p(268,u)));return u=q(g),u=u!==null?ie(u):null,u=u===null?null:u.stateNode,u};var Lx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Ct,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wg.isDisabled&&Wg.supportsFiber)try{Yo=Wg.inject(Lx),pr=Wg}catch{}}return l0.createRoot=function(u,g){if(!b(u))throw Error(p(299));var w=!1,C="",F=Hp,j=ju,se=$p;return g!=null&&(g.unstable_strictMode===!0&&(w=!0),g.identifierPrefix!==void 0&&(C=g.identifierPrefix),g.onUncaughtError!==void 0&&(F=g.onUncaughtError),g.onCaughtError!==void 0&&(j=g.onCaughtError),g.onRecoverableError!==void 0&&(se=g.onRecoverableError)),g=Ix(u,1,!1,null,null,w,C,null,F,j,se,Ox),u[Re]=g.current,yo(u),new sy(g)},l0.hydrateRoot=function(u,g,w){if(!b(u))throw Error(p(299));var C=!1,F="",j=Hp,se=ju,Ae=$p,Qe=null;return w!=null&&(w.unstable_strictMode===!0&&(C=!0),w.identifierPrefix!==void 0&&(F=w.identifierPrefix),w.onUncaughtError!==void 0&&(j=w.onUncaughtError),w.onCaughtError!==void 0&&(se=w.onCaughtError),w.onRecoverableError!==void 0&&(Ae=w.onRecoverableError),w.formState!==void 0&&(Qe=w.formState)),g=Ix(u,1,!0,g,w??null,C,F,Qe,j,se,Ae,Ox),g.context=Rv(null),w=g.current,C=ls(),C=Ls(C),F=Ec(C),F.callback=null,Sc(w,F,C),w=C,g.current.lanes=w,St(g,w),Aa(g),u[Re]=g.current,yo(u),new Hd(g)},l0.version="19.2.0",l0}var B2;function K3(){if(B2)return Qw.exports;B2=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(n){console.error(n)}}return c(),Qw.exports=X3(),Qw.exports}var Y3=K3();var N2="popstate";function Q3(c={}){function n(b,I){let{pathname:P="/",search:s="",hash:G=""}=m_(b.location.hash.substring(1));return!P.startsWith("/")&&!P.startsWith(".")&&(P="/"+P),DT("",{pathname:P,search:s,hash:G},I.state&&I.state.usr||null,I.state&&I.state.key||"default")}function l(b,I){let P=b.document.querySelector("base"),s="";if(P&&P.getAttribute("href")){let G=b.location.href,q=G.indexOf("#");s=q===-1?G:G.slice(0,q)}return s+"#"+(typeof I=="string"?I:C0(I))}function p(b,I){id(b.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(I)})`)}return eF(n,l,p,c)}function Ao(c,n){if(c===!1||c===null||typeof c>"u")throw new Error(n)}function id(c,n){if(!c){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function J3(){return Math.random().toString(36).substring(2,10)}function V2(c,n){return{usr:c.state,key:c.key,idx:n}}function DT(c,n,l=null,p){return{pathname:typeof c=="string"?c:c.pathname,search:"",hash:"",...typeof n=="string"?m_(n):n,state:l,key:n&&n.key||p||J3()}}function C0({pathname:c="/",search:n="",hash:l=""}){return n&&n!=="?"&&(c+=n.charAt(0)==="?"?n:"?"+n),l&&l!=="#"&&(c+=l.charAt(0)==="#"?l:"#"+l),c}function m_(c){let n={};if(c){let l=c.indexOf("#");l>=0&&(n.hash=c.substring(l),c=c.substring(0,l));let p=c.indexOf("?");p>=0&&(n.search=c.substring(p),c=c.substring(0,p)),c&&(n.pathname=c)}return n}function eF(c,n,l,p={}){let{window:b=document.defaultView,v5Compat:I=!1}=p,P=b.history,s="POP",G=null,q=ie();q==null&&(q=0,P.replaceState({...P.state,idx:q},""));function ie(){return(P.state||{idx:null}).idx}function ce(){s="POP";let Ze=ie(),Pt=Ze==null?null:Ze-q;q=Ze,G&&G({action:s,location:it.location,delta:Pt})}function be(Ze,Pt){s="PUSH";let ct=DT(it.location,Ze,Pt);l&&l(ct,Ze),q=ie()+1;let Gt=V2(ct,q),ei=it.createHref(ct);try{P.pushState(Gt,"",ei)}catch(Fi){if(Fi instanceof DOMException&&Fi.name==="DataCloneError")throw Fi;b.location.assign(ei)}I&&G&&G({action:s,location:it.location,delta:1})}function He(Ze,Pt){s="REPLACE";let ct=DT(it.location,Ze,Pt);l&&l(ct,Ze),q=ie();let Gt=V2(ct,q),ei=it.createHref(ct);P.replaceState(Gt,"",ei),I&&G&&G({action:s,location:it.location,delta:0})}function Je(Ze){return tF(Ze)}let it={get action(){return s},get location(){return c(b,P)},listen(Ze){if(G)throw new Error("A history only accepts one active listener");return b.addEventListener(N2,ce),G=Ze,()=>{b.removeEventListener(N2,ce),G=null}},createHref(Ze){return n(b,Ze)},createURL:Je,encodeLocation(Ze){let Pt=Je(Ze);return{pathname:Pt.pathname,search:Pt.search,hash:Pt.hash}},push:be,replace:He,go(Ze){return P.go(Ze)}};return it}function tF(c,n=!1){let l="http://localhost";typeof window<"u"&&(l=window.location.origin!=="null"?window.location.origin:window.location.href),Ao(l,"No window.location.(origin|href) available to create URL");let p=typeof c=="string"?c:C0(c);return p=p.replace(/ $/,"%20"),!n&&p.startsWith("//")&&(p=l+p),new URL(p,l)}function rM(c,n,l="/"){return iF(c,n,l,!1)}function iF(c,n,l,p){let b=typeof n=="string"?m_(n):n,I=cp(b.pathname||"/",l);if(I==null)return null;let P=sM(c);nF(P);let s=null;for(let G=0;s==null&&G<P.length;++G){let q=pF(I);s=dF(P[G],q,p)}return s}function sM(c,n=[],l=[],p="",b=!1){let I=(P,s,G=b,q)=>{let ie={relativePath:q===void 0?P.path||"":q,caseSensitive:P.caseSensitive===!0,childrenIndex:s,route:P};if(ie.relativePath.startsWith("/")){if(!ie.relativePath.startsWith(p)&&G)return;Ao(ie.relativePath.startsWith(p),`Absolute route path "${ie.relativePath}" nested under path "${p}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),ie.relativePath=ie.relativePath.slice(p.length)}let ce=sp([p,ie.relativePath]),be=l.concat(ie);P.children&&P.children.length>0&&(Ao(P.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${ce}".`),sM(P.children,n,be,ce,G)),!(P.path==null&&!P.index)&&n.push({path:ce,score:uF(ce,P.index),routesMeta:be})};return c.forEach((P,s)=>{if(P.path===""||!P.path?.includes("?"))I(P,s);else for(let G of oM(P.path))I(P,s,!0,G)}),n}function oM(c){let n=c.split("/");if(n.length===0)return[];let[l,...p]=n,b=l.endsWith("?"),I=l.replace(/\?$/,"");if(p.length===0)return b?[I,""]:[I];let P=oM(p.join("/")),s=[];return s.push(...P.map(G=>G===""?I:[I,G].join("/"))),b&&s.push(...P),s.map(G=>c.startsWith("/")&&G===""?"/":G)}function nF(c){c.sort((n,l)=>n.score!==l.score?l.score-n.score:hF(n.routesMeta.map(p=>p.childrenIndex),l.routesMeta.map(p=>p.childrenIndex)))}var rF=/^:[\w-]+$/,sF=3,oF=2,aF=1,lF=10,cF=-2,U2=c=>c==="*";function uF(c,n){let l=c.split("/"),p=l.length;return l.some(U2)&&(p+=cF),n&&(p+=oF),l.filter(b=>!U2(b)).reduce((b,I)=>b+(rF.test(I)?sF:I===""?aF:lF),p)}function hF(c,n){return c.length===n.length&&c.slice(0,-1).every((p,b)=>p===n[b])?c[c.length-1]-n[n.length-1]:0}function dF(c,n,l=!1){let{routesMeta:p}=c,b={},I="/",P=[];for(let s=0;s<p.length;++s){let G=p[s],q=s===p.length-1,ie=I==="/"?n:n.slice(I.length)||"/",ce=Nb({path:G.relativePath,caseSensitive:G.caseSensitive,end:q},ie),be=G.route;if(!ce&&q&&l&&!p[p.length-1].route.index&&(ce=Nb({path:G.relativePath,caseSensitive:G.caseSensitive,end:!1},ie)),!ce)return null;Object.assign(b,ce.params),P.push({params:b,pathname:sp([I,ce.pathname]),pathnameBase:yF(sp([I,ce.pathnameBase])),route:be}),ce.pathnameBase!=="/"&&(I=sp([I,ce.pathnameBase]))}return P}function Nb(c,n){typeof c=="string"&&(c={path:c,caseSensitive:!1,end:!0});let[l,p]=fF(c.path,c.caseSensitive,c.end),b=n.match(l);if(!b)return null;let I=b[0],P=I.replace(/(.)\/+$/,"$1"),s=b.slice(1);return{params:p.reduce((q,{paramName:ie,isOptional:ce},be)=>{if(ie==="*"){let Je=s[be]||"";P=I.slice(0,I.length-Je.length).replace(/(.)\/+$/,"$1")}const He=s[be];return ce&&!He?q[ie]=void 0:q[ie]=(He||"").replace(/%2F/g,"/"),q},{}),pathname:I,pathnameBase:P,pattern:c}}function fF(c,n=!1,l=!0){id(c==="*"||!c.endsWith("*")||c.endsWith("/*"),`Route path "${c}" will be treated as if it were "${c.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${c.replace(/\*$/,"/*")}".`);let p=[],b="^"+c.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(P,s,G)=>(p.push({paramName:s,isOptional:G!=null}),G?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return c.endsWith("*")?(p.push({paramName:"*"}),b+=c==="*"||c==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?b+="\\/*$":c!==""&&c!=="/"&&(b+="(?:(?=\\/|$))"),[new RegExp(b,n?void 0:"i"),p]}function pF(c){try{return c.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return id(!1,`The URL path "${c}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),c}}function cp(c,n){if(n==="/")return c;if(!c.toLowerCase().startsWith(n.toLowerCase()))return null;let l=n.endsWith("/")?n.length-1:n.length,p=c.charAt(l);return p&&p!=="/"?null:c.slice(l)||"/"}function mF(c,n="/"){let{pathname:l,search:p="",hash:b=""}=typeof c=="string"?m_(c):c;return{pathname:l?l.startsWith("/")?l:gF(l,n):n,search:vF(p),hash:xF(b)}}function gF(c,n){let l=n.replace(/\/+$/,"").split("/");return c.split("/").forEach(b=>{b===".."?l.length>1&&l.pop():b!=="."&&l.push(b)}),l.length>1?l.join("/"):"/"}function iT(c,n,l,p){return`Cannot include a '${c}' character in a manually specified \`to.${n}\` field [${JSON.stringify(p)}].  Please separate it out to the \`to.${l}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _F(c){return c.filter((n,l)=>l===0||n.route.path&&n.route.path.length>0)}function aM(c){let n=_F(c);return n.map((l,p)=>p===n.length-1?l.pathname:l.pathnameBase)}function lM(c,n,l,p=!1){let b;typeof c=="string"?b=m_(c):(b={...c},Ao(!b.pathname||!b.pathname.includes("?"),iT("?","pathname","search",b)),Ao(!b.pathname||!b.pathname.includes("#"),iT("#","pathname","hash",b)),Ao(!b.search||!b.search.includes("#"),iT("#","search","hash",b)));let I=c===""||b.pathname==="",P=I?"/":b.pathname,s;if(P==null)s=l;else{let ce=n.length-1;if(!p&&P.startsWith("..")){let be=P.split("/");for(;be[0]==="..";)be.shift(),ce-=1;b.pathname=be.join("/")}s=ce>=0?n[ce]:"/"}let G=mF(b,s),q=P&&P!=="/"&&P.endsWith("/"),ie=(I||P===".")&&l.endsWith("/");return!G.pathname.endsWith("/")&&(q||ie)&&(G.pathname+="/"),G}var sp=c=>c.join("/").replace(/\/\/+/g,"/"),yF=c=>c.replace(/\/+$/,"").replace(/^\/*/,"/"),vF=c=>!c||c==="?"?"":c.startsWith("?")?c:"?"+c,xF=c=>!c||c==="#"?"":c.startsWith("#")?c:"#"+c;function bF(c){return c!=null&&typeof c.status=="number"&&typeof c.statusText=="string"&&typeof c.internal=="boolean"&&"data"in c}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var cM=["POST","PUT","PATCH","DELETE"];new Set(cM);var wF=["GET",...cM];new Set(wF);var Wy=ve.createContext(null);Wy.displayName="DataRouter";var u1=ve.createContext(null);u1.displayName="DataRouterState";ve.createContext(!1);var uM=ve.createContext({isTransitioning:!1});uM.displayName="ViewTransition";var TF=ve.createContext(new Map);TF.displayName="Fetchers";var EF=ve.createContext(null);EF.displayName="Await";var of=ve.createContext(null);of.displayName="Navigation";var V0=ve.createContext(null);V0.displayName="Location";var af=ve.createContext({outlet:null,matches:[],isDataRoute:!1});af.displayName="Route";var mE=ve.createContext(null);mE.displayName="RouteError";function SF(c,{relative:n}={}){Ao(U0(),"useHref() may be used only in the context of a <Router> component.");let{basename:l,navigator:p}=ve.useContext(of),{hash:b,pathname:I,search:P}=j0(c,{relative:n}),s=I;return l!=="/"&&(s=I==="/"?l:sp([l,I])),p.createHref({pathname:s,search:P,hash:b})}function U0(){return ve.useContext(V0)!=null}function g_(){return Ao(U0(),"useLocation() may be used only in the context of a <Router> component."),ve.useContext(V0).location}var hM="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function dM(c){ve.useContext(of).static||ve.useLayoutEffect(c)}function h1(){let{isDataRoute:c}=ve.useContext(af);return c?NF():AF()}function AF(){Ao(U0(),"useNavigate() may be used only in the context of a <Router> component.");let c=ve.useContext(Wy),{basename:n,navigator:l}=ve.useContext(of),{matches:p}=ve.useContext(af),{pathname:b}=g_(),I=JSON.stringify(aM(p)),P=ve.useRef(!1);return dM(()=>{P.current=!0}),ve.useCallback((G,q={})=>{if(id(P.current,hM),!P.current)return;if(typeof G=="number"){l.go(G);return}let ie=lM(G,JSON.parse(I),b,q.relative==="path");c==null&&n!=="/"&&(ie.pathname=ie.pathname==="/"?n:sp([n,ie.pathname])),(q.replace?l.replace:l.push)(ie,q.state,q)},[n,l,I,b,c])}ve.createContext(null);function IF(){let{matches:c}=ve.useContext(af),n=c[c.length-1];return n?n.params:{}}function j0(c,{relative:n}={}){let{matches:l}=ve.useContext(af),{pathname:p}=g_(),b=JSON.stringify(aM(l));return ve.useMemo(()=>lM(c,JSON.parse(b),p,n==="path"),[c,b,p,n])}function CF(c,n){return fM(c,n)}function fM(c,n,l,p,b){Ao(U0(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:I}=ve.useContext(of),{matches:P}=ve.useContext(af),s=P[P.length-1],G=s?s.params:{},q=s?s.pathname:"/",ie=s?s.pathnameBase:"/",ce=s&&s.route;{let ct=ce&&ce.path||"";pM(q,!ce||ct.endsWith("*")||ct.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${q}" (under <Route path="${ct}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${ct}"> to <Route path="${ct==="/"?"*":`${ct}/*`}">.`)}let be=g_(),He;if(n){let ct=typeof n=="string"?m_(n):n;Ao(ie==="/"||ct.pathname?.startsWith(ie),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${ie}" but pathname "${ct.pathname}" was given in the \`location\` prop.`),He=ct}else He=be;let Je=He.pathname||"/",it=Je;if(ie!=="/"){let ct=ie.replace(/^\//,"").split("/");it="/"+Je.replace(/^\//,"").split("/").slice(ct.length).join("/")}let Ze=rM(c,{pathname:it});id(ce||Ze!=null,`No routes matched location "${He.pathname}${He.search}${He.hash}" `),id(Ze==null||Ze[Ze.length-1].route.element!==void 0||Ze[Ze.length-1].route.Component!==void 0||Ze[Ze.length-1].route.lazy!==void 0,`Matched leaf route at location "${He.pathname}${He.search}${He.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Pt=OF(Ze&&Ze.map(ct=>Object.assign({},ct,{params:Object.assign({},G,ct.params),pathname:sp([ie,I.encodeLocation?I.encodeLocation(ct.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ct.pathname]),pathnameBase:ct.pathnameBase==="/"?ie:sp([ie,I.encodeLocation?I.encodeLocation(ct.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:ct.pathnameBase])})),P,l,p,b);return n&&Pt?ve.createElement(V0.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...He},navigationType:"POP"}},Pt):Pt}function RF(){let c=BF(),n=bF(c)?`${c.status} ${c.statusText}`:c instanceof Error?c.message:JSON.stringify(c),l=c instanceof Error?c.stack:null,p="rgba(200,200,200, 0.5)",b={padding:"0.5rem",backgroundColor:p},I={padding:"2px 4px",backgroundColor:p},P=null;return console.error("Error handled by React Router default ErrorBoundary:",c),P=ve.createElement(ve.Fragment,null,ve.createElement("p",null," Hey developer "),ve.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ve.createElement("code",{style:I},"ErrorBoundary")," or"," ",ve.createElement("code",{style:I},"errorElement")," prop on your route.")),ve.createElement(ve.Fragment,null,ve.createElement("h2",null,"Unexpected Application Error!"),ve.createElement("h3",{style:{fontStyle:"italic"}},n),l?ve.createElement("pre",{style:b},l):null,P)}var MF=ve.createElement(RF,null),DF=class extends ve.Component{constructor(c){super(c),this.state={location:c.location,revalidation:c.revalidation,error:c.error}}static getDerivedStateFromError(c){return{error:c}}static getDerivedStateFromProps(c,n){return n.location!==c.location||n.revalidation!=="idle"&&c.revalidation==="idle"?{error:c.error,location:c.location,revalidation:c.revalidation}:{error:c.error!==void 0?c.error:n.error,location:n.location,revalidation:c.revalidation||n.revalidation}}componentDidCatch(c,n){this.props.unstable_onError?this.props.unstable_onError(c,n):console.error("React Router caught the following error during render",c)}render(){return this.state.error!==void 0?ve.createElement(af.Provider,{value:this.props.routeContext},ve.createElement(mE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function PF({routeContext:c,match:n,children:l}){let p=ve.useContext(Wy);return p&&p.static&&p.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(p.staticContext._deepestRenderedBoundaryId=n.route.id),ve.createElement(af.Provider,{value:c},l)}function OF(c,n=[],l=null,p=null,b=null){if(c==null){if(!l)return null;if(l.errors)c=l.matches;else if(n.length===0&&!l.initialized&&l.matches.length>0)c=l.matches;else return null}let I=c,P=l?.errors;if(P!=null){let q=I.findIndex(ie=>ie.route.id&&P?.[ie.route.id]!==void 0);Ao(q>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(P).join(",")}`),I=I.slice(0,Math.min(I.length,q+1))}let s=!1,G=-1;if(l)for(let q=0;q<I.length;q++){let ie=I[q];if((ie.route.HydrateFallback||ie.route.hydrateFallbackElement)&&(G=q),ie.route.id){let{loaderData:ce,errors:be}=l,He=ie.route.loader&&!ce.hasOwnProperty(ie.route.id)&&(!be||be[ie.route.id]===void 0);if(ie.route.lazy||He){s=!0,G>=0?I=I.slice(0,G+1):I=[I[0]];break}}}return I.reduceRight((q,ie,ce)=>{let be,He=!1,Je=null,it=null;l&&(be=P&&ie.route.id?P[ie.route.id]:void 0,Je=ie.route.errorElement||MF,s&&(G<0&&ce===0?(pM("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),He=!0,it=null):G===ce&&(He=!0,it=ie.route.hydrateFallbackElement||null)));let Ze=n.concat(I.slice(0,ce+1)),Pt=()=>{let ct;return be?ct=Je:He?ct=it:ie.route.Component?ct=ve.createElement(ie.route.Component,null):ie.route.element?ct=ie.route.element:ct=q,ve.createElement(PF,{match:ie,routeContext:{outlet:q,matches:Ze,isDataRoute:l!=null},children:ct})};return l&&(ie.route.ErrorBoundary||ie.route.errorElement||ce===0)?ve.createElement(DF,{location:l.location,revalidation:l.revalidation,component:Je,error:be,children:Pt(),routeContext:{outlet:null,matches:Ze,isDataRoute:!0},unstable_onError:p}):Pt()},null)}function gE(c){return`${c} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function LF(c){let n=ve.useContext(Wy);return Ao(n,gE(c)),n}function zF(c){let n=ve.useContext(u1);return Ao(n,gE(c)),n}function kF(c){let n=ve.useContext(af);return Ao(n,gE(c)),n}function _E(c){let n=kF(c),l=n.matches[n.matches.length-1];return Ao(l.route.id,`${c} can only be used on routes that contain a unique "id"`),l.route.id}function FF(){return _E("useRouteId")}function BF(){let c=ve.useContext(mE),n=zF("useRouteError"),l=_E("useRouteError");return c!==void 0?c:n.errors?.[l]}function NF(){let{router:c}=LF("useNavigate"),n=_E("useNavigate"),l=ve.useRef(!1);return dM(()=>{l.current=!0}),ve.useCallback(async(b,I={})=>{id(l.current,hM),l.current&&(typeof b=="number"?c.navigate(b):await c.navigate(b,{fromRouteId:n,...I}))},[c,n])}var j2={};function pM(c,n,l){!n&&!j2[c]&&(j2[c]=!0,id(!1,l))}ve.memo(VF);function VF({routes:c,future:n,state:l,unstable_onError:p}){return fM(c,void 0,l,p,n)}function Ey(c){Ao(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function UF({basename:c="/",children:n=null,location:l,navigationType:p="POP",navigator:b,static:I=!1}){Ao(!U0(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let P=c.replace(/^\/*/,"/"),s=ve.useMemo(()=>({basename:P,navigator:b,static:I,future:{}}),[P,b,I]);typeof l=="string"&&(l=m_(l));let{pathname:G="/",search:q="",hash:ie="",state:ce=null,key:be="default"}=l,He=ve.useMemo(()=>{let Je=cp(G,P);return Je==null?null:{location:{pathname:Je,search:q,hash:ie,state:ce,key:be},navigationType:p}},[P,G,q,ie,ce,be,p]);return id(He!=null,`<Router basename="${P}"> is not able to match the URL "${G}${q}${ie}" because it does not start with the basename, so the <Router> won't render anything.`),He==null?null:ve.createElement(of.Provider,{value:s},ve.createElement(V0.Provider,{children:n,value:He}))}function jF({children:c,location:n}){return CF(PT(c),n)}function PT(c,n=[]){let l=[];return ve.Children.forEach(c,(p,b)=>{if(!ve.isValidElement(p))return;let I=[...n,b];if(p.type===ve.Fragment){l.push.apply(l,PT(p.props.children,I));return}Ao(p.type===Ey,`[${typeof p.type=="string"?p.type:p.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ao(!p.props.index||!p.props.children,"An index route cannot have child routes.");let P={id:p.props.id||I.join("-"),caseSensitive:p.props.caseSensitive,element:p.props.element,Component:p.props.Component,index:p.props.index,path:p.props.path,middleware:p.props.middleware,loader:p.props.loader,action:p.props.action,hydrateFallbackElement:p.props.hydrateFallbackElement,HydrateFallback:p.props.HydrateFallback,errorElement:p.props.errorElement,ErrorBoundary:p.props.ErrorBoundary,hasErrorBoundary:p.props.hasErrorBoundary===!0||p.props.ErrorBoundary!=null||p.props.errorElement!=null,shouldRevalidate:p.props.shouldRevalidate,handle:p.props.handle,lazy:p.props.lazy};p.props.children&&(P.children=PT(p.props.children,I)),l.push(P)}),l}var Ab="get",Ib="application/x-www-form-urlencoded";function d1(c){return c!=null&&typeof c.tagName=="string"}function GF(c){return d1(c)&&c.tagName.toLowerCase()==="button"}function qF(c){return d1(c)&&c.tagName.toLowerCase()==="form"}function HF(c){return d1(c)&&c.tagName.toLowerCase()==="input"}function $F(c){return!!(c.metaKey||c.altKey||c.ctrlKey||c.shiftKey)}function WF(c,n){return c.button===0&&(!n||n==="_self")&&!$F(c)}var pb=null;function ZF(){if(pb===null)try{new FormData(document.createElement("form"),0),pb=!1}catch{pb=!0}return pb}var XF=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function nT(c){return c!=null&&!XF.has(c)?(id(!1,`"${c}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ib}"`),null):c}function KF(c,n){let l,p,b,I,P;if(qF(c)){let s=c.getAttribute("action");p=s?cp(s,n):null,l=c.getAttribute("method")||Ab,b=nT(c.getAttribute("enctype"))||Ib,I=new FormData(c)}else if(GF(c)||HF(c)&&(c.type==="submit"||c.type==="image")){let s=c.form;if(s==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let G=c.getAttribute("formaction")||s.getAttribute("action");if(p=G?cp(G,n):null,l=c.getAttribute("formmethod")||s.getAttribute("method")||Ab,b=nT(c.getAttribute("formenctype"))||nT(s.getAttribute("enctype"))||Ib,I=new FormData(s,c),!ZF()){let{name:q,type:ie,value:ce}=c;if(ie==="image"){let be=q?`${q}.`:"";I.append(`${be}x`,"0"),I.append(`${be}y`,"0")}else q&&I.append(q,ce)}}else{if(d1(c))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');l=Ab,p=null,b=Ib,P=c}return I&&b==="text/plain"&&(P=I,I=void 0),{action:p,method:l.toLowerCase(),encType:b,formData:I,body:P}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function yE(c,n){if(c===!1||c===null||typeof c>"u")throw new Error(n)}function YF(c,n,l){let p=typeof c=="string"?new URL(c,typeof window>"u"?"server://singlefetch/":window.location.origin):c;return p.pathname==="/"?p.pathname=`_root.${l}`:n&&cp(p.pathname,n)==="/"?p.pathname=`${n.replace(/\/$/,"")}/_root.${l}`:p.pathname=`${p.pathname.replace(/\/$/,"")}.${l}`,p}async function QF(c,n){if(c.id in n)return n[c.id];try{let l=await import(c.module);return n[c.id]=l,l}catch(l){return console.error(`Error loading route module \`${c.module}\`, reloading page...`),console.error(l),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function JF(c){return c==null?!1:c.href==null?c.rel==="preload"&&typeof c.imageSrcSet=="string"&&typeof c.imageSizes=="string":typeof c.rel=="string"&&typeof c.href=="string"}async function eB(c,n,l){let p=await Promise.all(c.map(async b=>{let I=n.routes[b.route.id];if(I){let P=await QF(I,l);return P.links?P.links():[]}return[]}));return rB(p.flat(1).filter(JF).filter(b=>b.rel==="stylesheet"||b.rel==="preload").map(b=>b.rel==="stylesheet"?{...b,rel:"prefetch",as:"style"}:{...b,rel:"prefetch"}))}function G2(c,n,l,p,b,I){let P=(G,q)=>l[q]?G.route.id!==l[q].route.id:!0,s=(G,q)=>l[q].pathname!==G.pathname||l[q].route.path?.endsWith("*")&&l[q].params["*"]!==G.params["*"];return I==="assets"?n.filter((G,q)=>P(G,q)||s(G,q)):I==="data"?n.filter((G,q)=>{let ie=p.routes[G.route.id];if(!ie||!ie.hasLoader)return!1;if(P(G,q)||s(G,q))return!0;if(G.route.shouldRevalidate){let ce=G.route.shouldRevalidate({currentUrl:new URL(b.pathname+b.search+b.hash,window.origin),currentParams:l[0]?.params||{},nextUrl:new URL(c,window.origin),nextParams:G.params,defaultShouldRevalidate:!0});if(typeof ce=="boolean")return ce}return!0}):[]}function tB(c,n,{includeHydrateFallback:l}={}){return iB(c.map(p=>{let b=n.routes[p.route.id];if(!b)return[];let I=[b.module];return b.clientActionModule&&(I=I.concat(b.clientActionModule)),b.clientLoaderModule&&(I=I.concat(b.clientLoaderModule)),l&&b.hydrateFallbackModule&&(I=I.concat(b.hydrateFallbackModule)),b.imports&&(I=I.concat(b.imports)),I}).flat(1))}function iB(c){return[...new Set(c)]}function nB(c){let n={},l=Object.keys(c).sort();for(let p of l)n[p]=c[p];return n}function rB(c,n){let l=new Set;return new Set(n),c.reduce((p,b)=>{let I=JSON.stringify(nB(b));return l.has(I)||(l.add(I),p.push({key:I,link:b})),p},[])}function mM(){let c=ve.useContext(Wy);return yE(c,"You must render this element inside a <DataRouterContext.Provider> element"),c}function sB(){let c=ve.useContext(u1);return yE(c,"You must render this element inside a <DataRouterStateContext.Provider> element"),c}var vE=ve.createContext(void 0);vE.displayName="FrameworkContext";function gM(){let c=ve.useContext(vE);return yE(c,"You must render this element inside a <HydratedRouter> element"),c}function oB(c,n){let l=ve.useContext(vE),[p,b]=ve.useState(!1),[I,P]=ve.useState(!1),{onFocus:s,onBlur:G,onMouseEnter:q,onMouseLeave:ie,onTouchStart:ce}=n,be=ve.useRef(null);ve.useEffect(()=>{if(c==="render"&&P(!0),c==="viewport"){let it=Pt=>{Pt.forEach(ct=>{P(ct.isIntersecting)})},Ze=new IntersectionObserver(it,{threshold:.5});return be.current&&Ze.observe(be.current),()=>{Ze.disconnect()}}},[c]),ve.useEffect(()=>{if(p){let it=setTimeout(()=>{P(!0)},100);return()=>{clearTimeout(it)}}},[p]);let He=()=>{b(!0)},Je=()=>{b(!1),P(!1)};return l?c!=="intent"?[I,be,{}]:[I,be,{onFocus:c0(s,He),onBlur:c0(G,Je),onMouseEnter:c0(q,He),onMouseLeave:c0(ie,Je),onTouchStart:c0(ce,He)}]:[!1,be,{}]}function c0(c,n){return l=>{c&&c(l),l.defaultPrevented||n(l)}}function aB({page:c,...n}){let{router:l}=mM(),p=ve.useMemo(()=>rM(l.routes,c,l.basename),[l.routes,c,l.basename]);return p?ve.createElement(cB,{page:c,matches:p,...n}):null}function lB(c){let{manifest:n,routeModules:l}=gM(),[p,b]=ve.useState([]);return ve.useEffect(()=>{let I=!1;return eB(c,n,l).then(P=>{I||b(P)}),()=>{I=!0}},[c,n,l]),p}function cB({page:c,matches:n,...l}){let p=g_(),{manifest:b,routeModules:I}=gM(),{basename:P}=mM(),{loaderData:s,matches:G}=sB(),q=ve.useMemo(()=>G2(c,n,G,b,p,"data"),[c,n,G,b,p]),ie=ve.useMemo(()=>G2(c,n,G,b,p,"assets"),[c,n,G,b,p]),ce=ve.useMemo(()=>{if(c===p.pathname+p.search+p.hash)return[];let Je=new Set,it=!1;if(n.forEach(Pt=>{let ct=b.routes[Pt.route.id];!ct||!ct.hasLoader||(!q.some(Gt=>Gt.route.id===Pt.route.id)&&Pt.route.id in s&&I[Pt.route.id]?.shouldRevalidate||ct.hasClientLoader?it=!0:Je.add(Pt.route.id))}),Je.size===0)return[];let Ze=YF(c,P,"data");return it&&Je.size>0&&Ze.searchParams.set("_routes",n.filter(Pt=>Je.has(Pt.route.id)).map(Pt=>Pt.route.id).join(",")),[Ze.pathname+Ze.search]},[P,s,p,b,q,n,c,I]),be=ve.useMemo(()=>tB(ie,b),[ie,b]),He=lB(ie);return ve.createElement(ve.Fragment,null,ce.map(Je=>ve.createElement("link",{key:Je,rel:"prefetch",as:"fetch",href:Je,...l})),be.map(Je=>ve.createElement("link",{key:Je,rel:"modulepreload",href:Je,...l})),He.map(({key:Je,link:it})=>ve.createElement("link",{key:Je,nonce:l.nonce,...it})))}function uB(...c){return n=>{c.forEach(l=>{typeof l=="function"?l(n):l!=null&&(l.current=n)})}}var _M=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{_M&&(window.__reactRouterVersion="7.9.5")}catch{}function hB({basename:c,children:n,window:l}){let p=ve.useRef();p.current==null&&(p.current=Q3({window:l,v5Compat:!0}));let b=p.current,[I,P]=ve.useState({action:b.action,location:b.location}),s=ve.useCallback(G=>{ve.startTransition(()=>P(G))},[P]);return ve.useLayoutEffect(()=>b.listen(s),[b,s]),ve.createElement(UF,{basename:c,children:n,location:I.location,navigationType:I.action,navigator:b})}var yM=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,i_=ve.forwardRef(function({onClick:n,discover:l="render",prefetch:p="none",relative:b,reloadDocument:I,replace:P,state:s,target:G,to:q,preventScrollReset:ie,viewTransition:ce,...be},He){let{basename:Je}=ve.useContext(of),it=typeof q=="string"&&yM.test(q),Ze,Pt=!1;if(typeof q=="string"&&it&&(Ze=q,_M))try{let je=new URL(window.location.href),tt=q.startsWith("//")?new URL(je.protocol+q):new URL(q),nt=cp(tt.pathname,Je);tt.origin===je.origin&&nt!=null?q=nt+tt.search+tt.hash:Pt=!0}catch{id(!1,`<Link to="${q}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let ct=SF(q,{relative:b}),[Gt,ei,Fi]=oB(p,be),Si=mB(q,{replace:P,state:s,target:G,preventScrollReset:ie,relative:b,viewTransition:ce});function qe(je){n&&n(je),je.defaultPrevented||Si(je)}let Oe=ve.createElement("a",{...be,...Fi,href:Ze||ct,onClick:Pt||I?n:qe,ref:uB(He,ei),target:G,"data-discover":!it&&l==="render"?"true":void 0});return Gt&&!it?ve.createElement(ve.Fragment,null,Oe,ve.createElement(aB,{page:ct})):Oe});i_.displayName="Link";var dB=ve.forwardRef(function({"aria-current":n="page",caseSensitive:l=!1,className:p="",end:b=!1,style:I,to:P,viewTransition:s,children:G,...q},ie){let ce=j0(P,{relative:q.relative}),be=g_(),He=ve.useContext(u1),{navigator:Je,basename:it}=ve.useContext(of),Ze=He!=null&&xB(ce)&&s===!0,Pt=Je.encodeLocation?Je.encodeLocation(ce).pathname:ce.pathname,ct=be.pathname,Gt=He&&He.navigation&&He.navigation.location?He.navigation.location.pathname:null;l||(ct=ct.toLowerCase(),Gt=Gt?Gt.toLowerCase():null,Pt=Pt.toLowerCase()),Gt&&it&&(Gt=cp(Gt,it)||Gt);const ei=Pt!=="/"&&Pt.endsWith("/")?Pt.length-1:Pt.length;let Fi=ct===Pt||!b&&ct.startsWith(Pt)&&ct.charAt(ei)==="/",Si=Gt!=null&&(Gt===Pt||!b&&Gt.startsWith(Pt)&&Gt.charAt(Pt.length)==="/"),qe={isActive:Fi,isPending:Si,isTransitioning:Ze},Oe=Fi?n:void 0,je;typeof p=="function"?je=p(qe):je=[p,Fi?"active":null,Si?"pending":null,Ze?"transitioning":null].filter(Boolean).join(" ");let tt=typeof I=="function"?I(qe):I;return ve.createElement(i_,{...q,"aria-current":Oe,className:je,ref:ie,style:tt,to:P,viewTransition:s},typeof G=="function"?G(qe):G)});dB.displayName="NavLink";var fB=ve.forwardRef(({discover:c="render",fetcherKey:n,navigate:l,reloadDocument:p,replace:b,state:I,method:P=Ab,action:s,onSubmit:G,relative:q,preventScrollReset:ie,viewTransition:ce,...be},He)=>{let Je=yB(),it=vB(s,{relative:q}),Ze=P.toLowerCase()==="get"?"get":"post",Pt=typeof s=="string"&&yM.test(s),ct=Gt=>{if(G&&G(Gt),Gt.defaultPrevented)return;Gt.preventDefault();let ei=Gt.nativeEvent.submitter,Fi=ei?.getAttribute("formmethod")||P;Je(ei||Gt.currentTarget,{fetcherKey:n,method:Fi,navigate:l,replace:b,state:I,relative:q,preventScrollReset:ie,viewTransition:ce})};return ve.createElement("form",{ref:He,method:Ze,action:it,onSubmit:p?G:ct,...be,"data-discover":!Pt&&c==="render"?"true":void 0})});fB.displayName="Form";function pB(c){return`${c} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function vM(c){let n=ve.useContext(Wy);return Ao(n,pB(c)),n}function mB(c,{target:n,replace:l,state:p,preventScrollReset:b,relative:I,viewTransition:P}={}){let s=h1(),G=g_(),q=j0(c,{relative:I});return ve.useCallback(ie=>{if(WF(ie,n)){ie.preventDefault();let ce=l!==void 0?l:C0(G)===C0(q);s(c,{replace:ce,state:p,preventScrollReset:b,relative:I,viewTransition:P})}},[G,s,q,l,p,n,c,b,I,P])}var gB=0,_B=()=>`__${String(++gB)}__`;function yB(){let{router:c}=vM("useSubmit"),{basename:n}=ve.useContext(of),l=FF();return ve.useCallback(async(p,b={})=>{let{action:I,method:P,encType:s,formData:G,body:q}=KF(p,n);if(b.navigate===!1){let ie=b.fetcherKey||_B();await c.fetch(ie,l,b.action||I,{preventScrollReset:b.preventScrollReset,formData:G,body:q,formMethod:b.method||P,formEncType:b.encType||s,flushSync:b.flushSync})}else await c.navigate(b.action||I,{preventScrollReset:b.preventScrollReset,formData:G,body:q,formMethod:b.method||P,formEncType:b.encType||s,replace:b.replace,state:b.state,fromRouteId:l,flushSync:b.flushSync,viewTransition:b.viewTransition})},[c,n,l])}function vB(c,{relative:n}={}){let{basename:l}=ve.useContext(of),p=ve.useContext(af);Ao(p,"useFormAction must be used inside a RouteContext");let[b]=p.matches.slice(-1),I={...j0(c||".",{relative:n})},P=g_();if(c==null){I.search=P.search;let s=new URLSearchParams(I.search),G=s.getAll("index");if(G.some(ie=>ie==="")){s.delete("index"),G.filter(ce=>ce).forEach(ce=>s.append("index",ce));let ie=s.toString();I.search=ie?`?${ie}`:""}}return(!c||c===".")&&b.route.index&&(I.search=I.search?I.search.replace(/^\?/,"?index&"):"?index"),l!=="/"&&(I.pathname=I.pathname==="/"?l:sp([l,I.pathname])),C0(I)}function xB(c,{relative:n}={}){let l=ve.useContext(uM);Ao(l!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:p}=vM("useViewTransitionState"),b=j0(c,{relative:n});if(!l.isTransitioning)return!1;let I=cp(l.currentLocation.pathname,p)||l.currentLocation.pathname,P=cp(l.nextLocation.pathname,p)||l.nextLocation.pathname;return Nb(b.pathname,P)!=null||Nb(b.pathname,I)!=null}var bB=nM();const Ry=N0(bB);var rT={exports:{}};var q2;function wB(){return q2||(q2=1,(function(c){(function(){var n={}.hasOwnProperty;function l(){for(var I="",P=0;P<arguments.length;P++){var s=arguments[P];s&&(I=b(I,p(s)))}return I}function p(I){if(typeof I=="string"||typeof I=="number")return I;if(typeof I!="object")return"";if(Array.isArray(I))return l.apply(null,I);if(I.toString!==Object.prototype.toString&&!I.toString.toString().includes("[native code]"))return I.toString();var P="";for(var s in I)n.call(I,s)&&I[s]&&(P=b(P,s));return P}function b(I,P){return P?I?I+" "+P:I+P:I}c.exports?(l.default=l,c.exports=l):window.classNames=l})()})(rT)),rT.exports}var TB=wB();const Sn=N0(TB);function OT(){return OT=Object.assign?Object.assign.bind():function(c){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var p in l)({}).hasOwnProperty.call(l,p)&&(c[p]=l[p])}return c},OT.apply(null,arguments)}function xM(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)!==-1)continue;l[p]=c[p]}return l}function H2(c){return"default"+c.charAt(0).toUpperCase()+c.substr(1)}function EB(c){var n=SB(c,"string");return typeof n=="symbol"?n:String(n)}function SB(c,n){if(typeof c!="object"||c===null)return c;var l=c[Symbol.toPrimitive];if(l!==void 0){var p=l.call(c,n);if(typeof p!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(c)}function AB(c,n,l){var p=ve.useRef(c!==void 0),b=ve.useState(n),I=b[0],P=b[1],s=c!==void 0,G=p.current;return p.current=s,!s&&G&&I!==n&&P(n),[s?c:I,ve.useCallback(function(q){for(var ie=arguments.length,ce=new Array(ie>1?ie-1:0),be=1;be<ie;be++)ce[be-1]=arguments[be];l&&l.apply(void 0,[q].concat(ce)),P(q)},[l])]}function G0(c,n){return Object.keys(n).reduce(function(l,p){var b,I=l,P=I[H2(p)],s=I[p],G=xM(I,[H2(p),p].map(EB)),q=n[p],ie=AB(s,P,c[q]),ce=ie[0],be=ie[1];return OT({},G,(b={},b[p]=ce,b[q]=be,b))},c)}function LT(c,n){return LT=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,p){return l.__proto__=p,l},LT(c,n)}function IB(c,n){c.prototype=Object.create(n.prototype),c.prototype.constructor=c,LT(c,n)}const CB=["xxl","xl","lg","md","sm","xs"],RB="xs",q0=ve.createContext({prefixes:{},breakpoints:CB,minBreakpoint:RB}),{Consumer:qH,Provider:HH}=q0;function Qn(c,n){const{prefixes:l}=ve.useContext(q0);return c||l[n]||n}function MB(){const{breakpoints:c}=ve.useContext(q0);return c}function DB(){const{minBreakpoint:c}=ve.useContext(q0);return c}function PB(){const{dir:c}=ve.useContext(q0);return c==="rtl"}function f1(c){return c&&c.ownerDocument||document}function OB(c){var n=f1(c);return n&&n.defaultView||window}function LB(c,n){return OB(c).getComputedStyle(c,n)}var zB=/([A-Z])/g;function kB(c){return c.replace(zB,"-$1").toLowerCase()}var FB=/^ms-/;function mb(c){return kB(c).replace(FB,"-ms-")}var BB=/^((translate|rotate|scale)(X|Y|Z|3d)?|matrix(3d)?|perspective|skew(X|Y)?)$/i;function NB(c){return!!(c&&BB.test(c))}function op(c,n){var l="",p="";if(typeof n=="string")return c.style.getPropertyValue(mb(n))||LB(c).getPropertyValue(mb(n));Object.keys(n).forEach(function(b){var I=n[b];!I&&I!==0?c.style.removeProperty(mb(b)):NB(b)?p+=b+"("+I+") ":l+=mb(b)+": "+I+";"}),p&&(l+="transform: "+p+";"),c.style.cssText+=";"+l}var sT={exports:{}},oT,$2;function VB(){if($2)return oT;$2=1;var c="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return oT=c,oT}var aT,W2;function UB(){if(W2)return aT;W2=1;var c=VB();function n(){}function l(){}return l.resetWarningCache=n,aT=function(){function p(P,s,G,q,ie,ce){if(ce!==c){var be=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw be.name="Invariant Violation",be}}p.isRequired=p;function b(){return p}var I={array:p,bigint:p,bool:p,func:p,number:p,object:p,string:p,symbol:p,any:p,arrayOf:b,element:p,elementType:p,instanceOf:b,node:p,objectOf:b,oneOf:b,oneOfType:b,shape:b,exact:b,checkPropTypes:l,resetWarningCache:n};return I.PropTypes=I,I},aT}var Z2;function jB(){return Z2||(Z2=1,sT.exports=UB()()),sT.exports}var GB=jB();const Pl=N0(GB),X2={disabled:!1},bM=zl.createContext(null);var qB=function(n){return n.scrollTop},f0="unmounted",Rm="exited",Jh="entering",tp="entered",R0="exiting",gp=(function(c){IB(n,c);function n(p,b){var I;I=c.call(this,p,b)||this;var P=b,s=P&&!P.isMounting?p.enter:p.appear,G;return I.appearStatus=null,p.in?s?(G=Rm,I.appearStatus=Jh):G=tp:p.unmountOnExit||p.mountOnEnter?G=f0:G=Rm,I.state={status:G},I.nextCallback=null,I}n.getDerivedStateFromProps=function(b,I){var P=b.in;return P&&I.status===f0?{status:Rm}:null};var l=n.prototype;return l.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},l.componentDidUpdate=function(b){var I=null;if(b!==this.props){var P=this.state.status;this.props.in?P!==Jh&&P!==tp&&(I=Jh):(P===Jh||P===tp)&&(I=R0)}this.updateStatus(!1,I)},l.componentWillUnmount=function(){this.cancelNextCallback()},l.getTimeouts=function(){var b=this.props.timeout,I,P,s;return I=P=s=b,b!=null&&typeof b!="number"&&(I=b.exit,P=b.enter,s=b.appear!==void 0?b.appear:P),{exit:I,enter:P,appear:s}},l.updateStatus=function(b,I){if(b===void 0&&(b=!1),I!==null)if(this.cancelNextCallback(),I===Jh){if(this.props.unmountOnExit||this.props.mountOnEnter){var P=this.props.nodeRef?this.props.nodeRef.current:Ry.findDOMNode(this);P&&qB(P)}this.performEnter(b)}else this.performExit();else this.props.unmountOnExit&&this.state.status===Rm&&this.setState({status:f0})},l.performEnter=function(b){var I=this,P=this.props.enter,s=this.context?this.context.isMounting:b,G=this.props.nodeRef?[s]:[Ry.findDOMNode(this),s],q=G[0],ie=G[1],ce=this.getTimeouts(),be=s?ce.appear:ce.enter;if(!b&&!P||X2.disabled){this.safeSetState({status:tp},function(){I.props.onEntered(q)});return}this.props.onEnter(q,ie),this.safeSetState({status:Jh},function(){I.props.onEntering(q,ie),I.onTransitionEnd(be,function(){I.safeSetState({status:tp},function(){I.props.onEntered(q,ie)})})})},l.performExit=function(){var b=this,I=this.props.exit,P=this.getTimeouts(),s=this.props.nodeRef?void 0:Ry.findDOMNode(this);if(!I||X2.disabled){this.safeSetState({status:Rm},function(){b.props.onExited(s)});return}this.props.onExit(s),this.safeSetState({status:R0},function(){b.props.onExiting(s),b.onTransitionEnd(P.exit,function(){b.safeSetState({status:Rm},function(){b.props.onExited(s)})})})},l.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},l.safeSetState=function(b,I){I=this.setNextCallback(I),this.setState(b,I)},l.setNextCallback=function(b){var I=this,P=!0;return this.nextCallback=function(s){P&&(P=!1,I.nextCallback=null,b(s))},this.nextCallback.cancel=function(){P=!1},this.nextCallback},l.onTransitionEnd=function(b,I){this.setNextCallback(I);var P=this.props.nodeRef?this.props.nodeRef.current:Ry.findDOMNode(this),s=b==null&&!this.props.addEndListener;if(!P||s){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var G=this.props.nodeRef?[this.nextCallback]:[P,this.nextCallback],q=G[0],ie=G[1];this.props.addEndListener(q,ie)}b!=null&&setTimeout(this.nextCallback,b)},l.render=function(){var b=this.state.status;if(b===f0)return null;var I=this.props,P=I.children;I.in,I.mountOnEnter,I.unmountOnExit,I.appear,I.enter,I.exit,I.timeout,I.addEndListener,I.onEnter,I.onEntering,I.onEntered,I.onExit,I.onExiting,I.onExited,I.nodeRef;var s=xM(I,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return zl.createElement(bM.Provider,{value:null},typeof P=="function"?P(b,s):zl.cloneElement(zl.Children.only(P),s))},n})(zl.Component);gp.contextType=bM;gp.propTypes={};function wy(){}gp.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:wy,onEntering:wy,onEntered:wy,onExit:wy,onExiting:wy,onExited:wy};gp.UNMOUNTED=f0;gp.EXITED=Rm;gp.ENTERING=Jh;gp.ENTERED=tp;gp.EXITING=R0;function HB(c){return c.code==="Escape"||c.keyCode===27}function $B(){const c=ve.version.split(".");return{major:+c[0],minor:+c[1],patch:+c[2]}}function Zy(c){if(!c||typeof c=="function")return null;const{major:n}=$B();return n>=19?c.props.ref:c.ref}const Xy=!!(typeof window<"u"&&window.document&&window.document.createElement);var zT=!1,kT=!1;try{var lT={get passive(){return zT=!0},get once(){return kT=zT=!0}};Xy&&(window.addEventListener("test",lT,lT),window.removeEventListener("test",lT,!0))}catch{}function wM(c,n,l,p){if(p&&typeof p!="boolean"&&!kT){var b=p.once,I=p.capture,P=l;!kT&&b&&(P=l.__once||function s(G){this.removeEventListener(n,s,I),l.call(this,G)},l.__once=P),c.addEventListener(n,P,zT?p:I)}c.addEventListener(n,l,p)}function FT(c,n,l,p){var b=p&&typeof p!="boolean"?p.capture:p;c.removeEventListener(n,l,b),l.__once&&c.removeEventListener(n,l.__once,b)}function Vb(c,n,l,p){return wM(c,n,l,p),function(){FT(c,n,l,p)}}function WB(c,n,l,p){if(p===void 0&&(p=!0),c){var b=document.createEvent("HTMLEvents");b.initEvent(n,l,p),c.dispatchEvent(b)}}function ZB(c){var n=op(c,"transitionDuration")||"",l=n.indexOf("ms")===-1?1e3:1;return parseFloat(n)*l}function XB(c,n,l){l===void 0&&(l=5);var p=!1,b=setTimeout(function(){p||WB(c,"transitionend",!0)},n+l),I=Vb(c,"transitionend",function(){p=!0},{once:!0});return function(){clearTimeout(b),I()}}function TM(c,n,l,p){l==null&&(l=ZB(c)||0);var b=XB(c,l,p),I=Vb(c,"transitionend",n);return function(){b(),I()}}function K2(c,n){const l=op(c,n)||"",p=l.indexOf("ms")===-1?1e3:1;return parseFloat(l)*p}function xE(c,n){const l=K2(c,"transitionDuration"),p=K2(c,"transitionDelay"),b=TM(c,I=>{I.target===c&&(b(),n(I))},l+p)}function u0(...c){return c.filter(n=>n!=null).reduce((n,l)=>{if(typeof l!="function")throw new Error("Invalid Argument Type, must only provide functions, undefined, or null.");return n===null?l:function(...b){n.apply(this,b),l.apply(this,b)}},null)}function EM(c){c.offsetHeight}const Y2=c=>!c||typeof c=="function"?c:n=>{c.current=n};function KB(c,n){const l=Y2(c),p=Y2(n);return b=>{l&&l(b),p&&p(b)}}function SM(c,n){return ve.useMemo(()=>KB(c,n),[c,n])}function YB(c){return c&&"setState"in c?Ry.findDOMNode(c):c??null}const p1=zl.forwardRef(({onEnter:c,onEntering:n,onEntered:l,onExit:p,onExiting:b,onExited:I,addEndListener:P,children:s,childRef:G,...q},ie)=>{const ce=ve.useRef(null),be=SM(ce,G),He=Si=>{be(YB(Si))},Je=Si=>qe=>{Si&&ce.current&&Si(ce.current,qe)},it=ve.useCallback(Je(c),[c]),Ze=ve.useCallback(Je(n),[n]),Pt=ve.useCallback(Je(l),[l]),ct=ve.useCallback(Je(p),[p]),Gt=ve.useCallback(Je(b),[b]),ei=ve.useCallback(Je(I),[I]),Fi=ve.useCallback(Je(P),[P]);return xe.jsx(gp,{ref:ie,...q,onEnter:it,onEntered:Pt,onEntering:Ze,onExit:ct,onExited:ei,onExiting:Gt,addEndListener:Fi,nodeRef:ce,children:typeof s=="function"?(Si,qe)=>s(Si,{...qe,ref:He}):zl.cloneElement(s,{ref:He})})});p1.displayName="TransitionWrapper";const QB={height:["marginTop","marginBottom"],width:["marginLeft","marginRight"]};function JB(c,n){const l=`offset${c[0].toUpperCase()}${c.slice(1)}`,p=n[l],b=QB[c];return p+parseInt(op(n,b[0]),10)+parseInt(op(n,b[1]),10)}const eN={[Rm]:"collapse",[R0]:"collapsing",[Jh]:"collapsing",[tp]:"collapse show"},AM=zl.forwardRef(({onEnter:c,onEntering:n,onEntered:l,onExit:p,onExiting:b,className:I,children:P,dimension:s="height",in:G=!1,timeout:q=300,mountOnEnter:ie=!1,unmountOnExit:ce=!1,appear:be=!1,getDimensionValue:He=JB,...Je},it)=>{const Ze=typeof s=="function"?s():s,Pt=ve.useMemo(()=>u0(Si=>{Si.style[Ze]="0"},c),[Ze,c]),ct=ve.useMemo(()=>u0(Si=>{const qe=`scroll${Ze[0].toUpperCase()}${Ze.slice(1)}`;Si.style[Ze]=`${Si[qe]}px`},n),[Ze,n]),Gt=ve.useMemo(()=>u0(Si=>{Si.style[Ze]=null},l),[Ze,l]),ei=ve.useMemo(()=>u0(Si=>{Si.style[Ze]=`${He(Ze,Si)}px`,EM(Si)},p),[p,He,Ze]),Fi=ve.useMemo(()=>u0(Si=>{Si.style[Ze]=null},b),[Ze,b]);return xe.jsx(p1,{ref:it,addEndListener:xE,...Je,"aria-expanded":Je.role?G:null,onEnter:Pt,onEntering:ct,onEntered:Gt,onExit:ei,onExiting:Fi,childRef:Zy(P),in:G,timeout:q,mountOnEnter:ie,unmountOnExit:ce,appear:be,children:(Si,qe)=>zl.cloneElement(P,{...qe,className:Sn(I,P.props.className,eN[Si],Ze==="width"&&"collapse-horizontal")})})});AM.displayName="Collapse";function tN(c){const n=ve.useRef(c);return ve.useEffect(()=>{n.current=c},[c]),n}function Vm(c){const n=tN(c);return ve.useCallback(function(...l){return n.current&&n.current(...l)},[n])}const H0=(c=>ve.forwardRef((n,l)=>xe.jsx("div",{...n,ref:l,className:Sn(n.className,c)}))),IM=H0("h4");IM.displayName="DivStyledAsH4";const CM=ve.forwardRef(({className:c,bsPrefix:n,as:l=IM,...p},b)=>(n=Qn(n,"alert-heading"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));CM.displayName="AlertHeading";function iN(c){const n=ve.useRef(c);return ve.useEffect(()=>{n.current=c},[c]),n}function ip(c){const n=iN(c);return ve.useCallback(function(...l){return n.current&&n.current(...l)},[n])}function nN(){const c=ve.useRef(!0),n=ve.useRef(()=>c.current);return ve.useEffect(()=>(c.current=!0,()=>{c.current=!1}),[]),n.current}function rN(c){const n=ve.useRef(null);return ve.useEffect(()=>{n.current=c}),n.current}const sN=typeof global<"u"&&global.navigator&&global.navigator.product==="ReactNative",oN=typeof document<"u",Q2=oN||sN?ve.useLayoutEffect:ve.useEffect,aN=["as","disabled"];function lN(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}function cN(c){return!c||c.trim()==="#"}function bE({tagName:c,disabled:n,href:l,target:p,rel:b,role:I,onClick:P,tabIndex:s=0,type:G}){c||(l!=null||p!=null||b!=null?c="a":c="button");const q={tagName:c};if(c==="button")return[{type:G||"button",disabled:n},q];const ie=be=>{if((n||c==="a"&&cN(l))&&be.preventDefault(),n){be.stopPropagation();return}P?.(be)},ce=be=>{be.key===" "&&(be.preventDefault(),ie(be))};return c==="a"&&(l||(l="#"),n&&(l=void 0)),[{role:I??"button",disabled:void 0,tabIndex:n?void 0:s,href:l,target:c==="a"?p:void 0,"aria-disabled":n||void 0,rel:c==="a"?b:void 0,onClick:ie,onKeyDown:ce},q]}const RM=ve.forwardRef((c,n)=>{let{as:l,disabled:p}=c,b=lN(c,aN);const[I,{tagName:P}]=bE(Object.assign({tagName:l,disabled:p},b));return xe.jsx(P,Object.assign({},b,I,{ref:n}))});RM.displayName="Button";const uN=["onKeyDown"];function hN(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}function dN(c){return!c||c.trim()==="#"}const wE=ve.forwardRef((c,n)=>{let{onKeyDown:l}=c,p=hN(c,uN);const[b]=bE(Object.assign({tagName:"a"},p)),I=ip(P=>{b.onKeyDown(P),l?.(P)});return dN(p.href)||p.role==="button"?xe.jsx("a",Object.assign({ref:n},p,b,{onKeyDown:I})):xe.jsx("a",Object.assign({ref:n},p,{onKeyDown:l}))});wE.displayName="Anchor";const MM=ve.forwardRef(({className:c,bsPrefix:n,as:l=wE,...p},b)=>(n=Qn(n,"alert-link"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));MM.displayName="AlertLink";const fN={[Jh]:"show",[tp]:"show"},Um=ve.forwardRef(({className:c,children:n,transitionClasses:l={},onEnter:p,...b},I)=>{const P={in:!1,timeout:300,mountOnEnter:!1,unmountOnExit:!1,appear:!1,...b},s=ve.useCallback((G,q)=>{EM(G),p?.(G,q)},[p]);return xe.jsx(p1,{ref:I,addEndListener:xE,...P,onEnter:s,childRef:Zy(n),children:(G,q)=>ve.cloneElement(n,{...q,className:Sn("fade",c,n.props.className,fN[G],l[G])})})});Um.displayName="Fade";const pN={"aria-label":Pl.string,onClick:Pl.func,variant:Pl.oneOf(["white"])},m1=ve.forwardRef(({className:c,variant:n,"aria-label":l="Close",...p},b)=>xe.jsx("button",{ref:b,type:"button",className:Sn("btn-close",n&&`btn-close-${n}`,c),"aria-label":l,...p}));m1.displayName="CloseButton";m1.propTypes=pN;const DM=ve.forwardRef((c,n)=>{const{bsPrefix:l,show:p=!0,closeLabel:b="Close alert",closeVariant:I,className:P,children:s,variant:G="primary",onClose:q,dismissible:ie,transition:ce=Um,...be}=G0(c,{show:"onClose"}),He=Qn(l,"alert"),Je=Vm(Pt=>{q&&q(!1,Pt)}),it=ce===!0?Um:ce,Ze=xe.jsxs("div",{role:"alert",...it?void 0:be,ref:n,className:Sn(P,He,G&&`${He}-${G}`,ie&&`${He}-dismissible`),children:[ie&&xe.jsx(m1,{onClick:Je,"aria-label":b,variant:I}),s]});return it?xe.jsx(it,{unmountOnExit:!0,...be,ref:void 0,in:p,children:Ze}):p?Ze:null});DM.displayName="Alert";const TE=Object.assign(DM,{Link:MM,Heading:CM}),vo=ve.forwardRef(({as:c,bsPrefix:n,variant:l="primary",size:p,active:b=!1,disabled:I=!1,className:P,...s},G)=>{const q=Qn(n,"btn"),[ie,{tagName:ce}]=bE({tagName:c,disabled:I,...s}),be=ce;return xe.jsx(be,{...ie,...s,ref:G,disabled:I,className:Sn(P,q,b&&"active",l&&`${q}-${l}`,p&&`${q}-${p}`,s.href&&I&&"disabled")})});vo.displayName="Button";const EE=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"card-body"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));EE.displayName="CardBody";const PM=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"card-footer"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));PM.displayName="CardFooter";const SE=ve.createContext(null);SE.displayName="CardHeaderContext";const OM=ve.forwardRef(({bsPrefix:c,className:n,as:l="div",...p},b)=>{const I=Qn(c,"card-header"),P=ve.useMemo(()=>({cardHeaderBsPrefix:I}),[I]);return xe.jsx(SE.Provider,{value:P,children:xe.jsx(l,{ref:b,...p,className:Sn(n,I)})})});OM.displayName="CardHeader";const LM=ve.forwardRef(({bsPrefix:c,className:n,variant:l,as:p="img",...b},I)=>{const P=Qn(c,"card-img");return xe.jsx(p,{ref:I,className:Sn(l?`${P}-${l}`:P,n),...b})});LM.displayName="CardImg";const zM=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"card-img-overlay"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));zM.displayName="CardImgOverlay";const kM=ve.forwardRef(({className:c,bsPrefix:n,as:l="a",...p},b)=>(n=Qn(n,"card-link"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));kM.displayName="CardLink";const mN=H0("h6"),FM=ve.forwardRef(({className:c,bsPrefix:n,as:l=mN,...p},b)=>(n=Qn(n,"card-subtitle"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));FM.displayName="CardSubtitle";const BM=ve.forwardRef(({className:c,bsPrefix:n,as:l="p",...p},b)=>(n=Qn(n,"card-text"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));BM.displayName="CardText";const gN=H0("h5"),NM=ve.forwardRef(({className:c,bsPrefix:n,as:l=gN,...p},b)=>(n=Qn(n,"card-title"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));NM.displayName="CardTitle";const VM=ve.forwardRef(({bsPrefix:c,className:n,bg:l,text:p,border:b,body:I=!1,children:P,as:s="div",...G},q)=>{const ie=Qn(c,"card");return xe.jsx(s,{ref:q,...G,className:Sn(n,ie,l&&`bg-${l}`,p&&`text-${p}`,b&&`border-${b}`),children:I?xe.jsx(EE,{children:P}):P})});VM.displayName="Card";const Kd=Object.assign(VM,{Img:LM,Title:NM,Subtitle:FM,Body:EE,Link:kM,Text:BM,Header:OM,Footer:PM,ImgOverlay:zM});function _N(c){const n=ve.useRef(c);return n.current=c,n}function yN(c){const n=_N(c);ve.useEffect(()=>()=>n.current(),[])}function J2(c,n){let l=0;return ve.Children.map(c,p=>ve.isValidElement(p)?n(p,l++):p)}function vN(c,n){let l=0;ve.Children.forEach(c,p=>{ve.isValidElement(p)&&n(p,l++)})}function xN(c,n){return ve.Children.toArray(c).some(l=>ve.isValidElement(l)&&l.type===n)}function bN({as:c,bsPrefix:n,className:l,...p}){n=Qn(n,"col");const b=MB(),I=DB(),P=[],s=[];return b.forEach(G=>{const q=p[G];delete p[G];let ie,ce,be;typeof q=="object"&&q!=null?{span:ie,offset:ce,order:be}=q:ie=q;const He=G!==I?`-${G}`:"";ie&&P.push(ie===!0?`${n}${He}`:`${n}${He}-${ie}`),be!=null&&s.push(`order${He}-${be}`),ce!=null&&s.push(`offset${He}-${ce}`)}),[{...p,className:Sn(l,...P,...s)},{as:c,bsPrefix:n,spans:P}]}const UM=ve.forwardRef((c,n)=>{const[{className:l,...p},{as:b="div",bsPrefix:I,spans:P}]=bN(c);return xe.jsx(b,{...p,ref:n,className:Sn(l,!P.length&&I)})});UM.displayName="Col";const jm=ve.forwardRef(({bsPrefix:c,fluid:n=!1,as:l="div",className:p,...b},I)=>{const P=Qn(c,"container"),s=typeof n=="string"?`-${n}`:"-fluid";return xe.jsx(l,{ref:I,...b,className:Sn(p,n?`${P}${s}`:P)})});jm.displayName="Container";var wN=Function.prototype.bind.call(Function.prototype.call,[].slice);function e_(c,n){return wN(c.querySelectorAll(n))}function TN(c,n,l){const p=ve.useRef(c!==void 0),[b,I]=ve.useState(n),P=c!==void 0,s=p.current;return p.current=P,!P&&s&&b!==n&&I(n),[P?c:b,ve.useCallback((...G)=>{const[q,...ie]=G;let ce=l?.(q,...ie);return I(q),ce},[l])]}function EN(){const[,c]=ve.useReducer(n=>n+1,0);return c}function eC(c,n){if(c.contains)return c.contains(n);if(c.compareDocumentPosition)return c===n||!!(c.compareDocumentPosition(n)&16)}const jM={prefix:String(Math.round(Math.random()*1e10)),current:0},GM=zl.createContext(jM),SN=zl.createContext(!1);let cT=new WeakMap;function AN(c=!1){let n=ve.useContext(GM),l=ve.useRef(null);if(l.current===null&&!c){var p,b;let I=(b=zl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)===null||b===void 0||(p=b.ReactCurrentOwner)===null||p===void 0?void 0:p.current;if(I){let P=cT.get(I);P==null?cT.set(I,{id:n.current,state:I.memoizedState}):I.memoizedState!==P.state&&(n.current=P.id,cT.delete(I))}l.current=++n.current}return l.current}function IN(c){let n=ve.useContext(GM),l=AN(!!c),p=`react-aria${n.prefix}`;return c||`${p}-${l}`}function CN(c){let n=zl.useId(),[l]=ve.useState(ON()),p=l?"react-aria":`react-aria${jM.prefix}`;return c||`${p}-${n}`}const RN=typeof zl.useId=="function"?CN:IN;function MN(){return!1}function DN(){return!0}function PN(c){return()=>{}}function ON(){return typeof zl.useSyncExternalStore=="function"?zl.useSyncExternalStore(PN,MN,DN):ve.useContext(SN)}const a_=ve.createContext(null),By=(c,n=null)=>c!=null?String(c):n||null,AE=ve.createContext(null);AE.displayName="NavContext";const LN="data-rr-ui-",zN="rrUi";function g1(c){return`${LN}${c}`}function kN(c){return`${zN}${c}`}const qM=ve.createContext(Xy?window:void 0);qM.Provider;function IE(){return ve.useContext(qM)}const FN=typeof global<"u"&&global.navigator&&global.navigator.product==="ReactNative",BN=typeof document<"u",NN=BN||FN?ve.useLayoutEffect:ve.useEffect,Ky=ve.createContext(null);Ky.displayName="NavbarContext";const VN={type:Pl.string,tooltip:Pl.bool,as:Pl.elementType},_1=ve.forwardRef(({as:c="div",className:n,type:l="valid",tooltip:p=!1,...b},I)=>xe.jsx(c,{...b,ref:I,className:Sn(n,`${l}-${p?"tooltip":"feedback"}`)}));_1.displayName="Feedback";_1.propTypes=VN;const up=ve.createContext({}),CE=ve.forwardRef(({id:c,bsPrefix:n,className:l,type:p="checkbox",isValid:b=!1,isInvalid:I=!1,as:P="input",...s},G)=>{const{controlId:q}=ve.useContext(up);return n=Qn(n,"form-check-input"),xe.jsx(P,{...s,ref:G,type:p,id:c||q,className:Sn(l,n,b&&"is-valid",I&&"is-invalid")})});CE.displayName="FormCheckInput";const Ub=ve.forwardRef(({bsPrefix:c,className:n,htmlFor:l,...p},b)=>{const{controlId:I}=ve.useContext(up);return c=Qn(c,"form-check-label"),xe.jsx("label",{...p,ref:b,htmlFor:l||I,className:Sn(n,c)})});Ub.displayName="FormCheckLabel";const HM=ve.forwardRef(({id:c,bsPrefix:n,bsSwitchPrefix:l,inline:p=!1,reverse:b=!1,disabled:I=!1,isValid:P=!1,isInvalid:s=!1,feedbackTooltip:G=!1,feedback:q,feedbackType:ie,className:ce,style:be,title:He="",type:Je="checkbox",label:it,children:Ze,as:Pt="input",...ct},Gt)=>{n=Qn(n,"form-check"),l=Qn(l,"form-switch");const{controlId:ei}=ve.useContext(up),Fi=ve.useMemo(()=>({controlId:c||ei}),[ei,c]),Si=!Ze&&it!=null&&it!==!1||xN(Ze,Ub),qe=xe.jsx(CE,{...ct,type:Je==="switch"?"checkbox":Je,ref:Gt,isValid:P,isInvalid:s,disabled:I,as:Pt});return xe.jsx(up.Provider,{value:Fi,children:xe.jsx("div",{style:be,className:Sn(ce,Si&&n,p&&`${n}-inline`,b&&`${n}-reverse`,Je==="switch"&&l),children:Ze||xe.jsxs(xe.Fragment,{children:[qe,Si&&xe.jsx(Ub,{title:He,children:it}),q&&xe.jsx(_1,{type:ie,tooltip:G,children:q})]})})})});HM.displayName="FormCheck";const jb=Object.assign(HM,{Input:CE,Label:Ub}),$M=ve.forwardRef(({bsPrefix:c,type:n,size:l,htmlSize:p,id:b,className:I,isValid:P=!1,isInvalid:s=!1,plaintext:G,readOnly:q,as:ie="input",...ce},be)=>{const{controlId:He}=ve.useContext(up);return c=Qn(c,"form-control"),xe.jsx(ie,{...ce,type:n,size:p,ref:be,readOnly:q,id:b||He,className:Sn(I,G?`${c}-plaintext`:c,l&&`${c}-${l}`,n==="color"&&`${c}-color`,P&&"is-valid",s&&"is-invalid")})});$M.displayName="FormControl";const UN=Object.assign($M,{Feedback:_1}),WM=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"form-floating"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));WM.displayName="FormFloating";const RE=ve.forwardRef(({controlId:c,as:n="div",...l},p)=>{const b=ve.useMemo(()=>({controlId:c}),[c]);return xe.jsx(up.Provider,{value:b,children:xe.jsx(n,{...l,ref:p})})});RE.displayName="FormGroup";const ZM=ve.forwardRef(({as:c="label",bsPrefix:n,column:l=!1,visuallyHidden:p=!1,className:b,htmlFor:I,...P},s)=>{const{controlId:G}=ve.useContext(up);n=Qn(n,"form-label");let q="col-form-label";typeof l=="string"&&(q=`${q} ${q}-${l}`);const ie=Sn(b,n,p&&"visually-hidden",l&&q);return I=I||G,l?xe.jsx(UM,{ref:s,as:"label",className:ie,htmlFor:I,...P}):xe.jsx(c,{ref:s,className:ie,htmlFor:I,...P})});ZM.displayName="FormLabel";const XM=ve.forwardRef(({bsPrefix:c,className:n,id:l,...p},b)=>{const{controlId:I}=ve.useContext(up);return c=Qn(c,"form-range"),xe.jsx("input",{...p,type:"range",ref:b,className:Sn(n,c),id:l||I})});XM.displayName="FormRange";const KM=ve.forwardRef(({bsPrefix:c,size:n,htmlSize:l,className:p,isValid:b=!1,isInvalid:I=!1,id:P,...s},G)=>{const{controlId:q}=ve.useContext(up);return c=Qn(c,"form-select"),xe.jsx("select",{...s,size:l,ref:G,className:Sn(p,c,n&&`${c}-${n}`,b&&"is-valid",I&&"is-invalid"),id:P||q})});KM.displayName="FormSelect";const YM=ve.forwardRef(({bsPrefix:c,className:n,as:l="small",muted:p,...b},I)=>(c=Qn(c,"form-text"),xe.jsx(l,{...b,ref:I,className:Sn(n,c,p&&"text-muted")})));YM.displayName="FormText";const QM=ve.forwardRef((c,n)=>xe.jsx(jb,{...c,ref:n,type:"switch"}));QM.displayName="Switch";const jN=Object.assign(QM,{Input:jb.Input,Label:jb.Label}),JM=ve.forwardRef(({bsPrefix:c,className:n,children:l,controlId:p,label:b,...I},P)=>(c=Qn(c,"form-floating"),xe.jsxs(RE,{ref:P,className:Sn(n,c),controlId:p,...I,children:[l,xe.jsx("label",{htmlFor:p,children:b})]})));JM.displayName="FloatingLabel";const GN={_ref:Pl.any,validated:Pl.bool,as:Pl.elementType},ME=ve.forwardRef(({className:c,validated:n,as:l="form",...p},b)=>xe.jsx(l,{...p,ref:b,className:Sn(c,n&&"was-validated")}));ME.displayName="Form";ME.propTypes=GN;const Vi=Object.assign(ME,{Group:RE,Control:UN,Floating:WM,Check:jb,Switch:jN,Label:ZM,Text:YM,Range:XM,Select:KM,FloatingLabel:JM}),tC=c=>!c||typeof c=="function"?c:n=>{c.current=n};function qN(c,n){const l=tC(c),p=tC(n);return b=>{l&&l(b),p&&p(b)}}function y1(c,n){return ve.useMemo(()=>qN(c,n),[c,n])}const Yy=ve.createContext(null),HN=["as","active","eventKey"];function $N(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}function DE({key:c,onClick:n,active:l,id:p,role:b,disabled:I}){const P=ve.useContext(a_),s=ve.useContext(AE),G=ve.useContext(Yy);let q=l;const ie={role:b};if(s){!b&&s.role==="tablist"&&(ie.role="tab");const ce=s.getControllerId(c??null),be=s.getControlledId(c??null);ie[g1("event-key")]=c,ie.id=ce||p,q=l==null&&c!=null?s.activeKey===c:l,(q||!(G!=null&&G.unmountOnExit)&&!(G!=null&&G.mountOnEnter))&&(ie["aria-controls"]=be)}return ie.role==="tab"&&(ie["aria-selected"]=q,q||(ie.tabIndex=-1),I&&(ie.tabIndex=-1,ie["aria-disabled"]=!0)),ie.onClick=ip(ce=>{I||(n?.(ce),c!=null&&P&&!ce.isPropagationStopped()&&P(c,ce))}),[ie,{isActive:q}]}const eD=ve.forwardRef((c,n)=>{let{as:l=RM,active:p,eventKey:b}=c,I=$N(c,HN);const[P,s]=DE(Object.assign({key:By(b,I.href),active:p},I));return P[g1("active")]=s.isActive,xe.jsx(l,Object.assign({},I,P,{ref:n}))});eD.displayName="NavItem";const WN=["as","onSelect","activeKey","role","onKeyDown"];function ZN(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}const iC=()=>{},nC=g1("event-key"),tD=ve.forwardRef((c,n)=>{let{as:l="div",onSelect:p,activeKey:b,role:I,onKeyDown:P}=c,s=ZN(c,WN);const G=EN(),q=ve.useRef(!1),ie=ve.useContext(a_),ce=ve.useContext(Yy);let be,He;ce&&(I=I||"tablist",b=ce.activeKey,be=ce.getControlledId,He=ce.getControllerId);const Je=ve.useRef(null),it=Gt=>{const ei=Je.current;if(!ei)return null;const Fi=e_(ei,`[${nC}]:not([aria-disabled=true])`),Si=ei.querySelector("[aria-selected=true]");if(!Si||Si!==document.activeElement)return null;const qe=Fi.indexOf(Si);if(qe===-1)return null;let Oe=qe+Gt;return Oe>=Fi.length&&(Oe=0),Oe<0&&(Oe=Fi.length-1),Fi[Oe]},Ze=(Gt,ei)=>{Gt!=null&&(p?.(Gt,ei),ie?.(Gt,ei))},Pt=Gt=>{if(P?.(Gt),!ce)return;let ei;switch(Gt.key){case"ArrowLeft":case"ArrowUp":ei=it(-1);break;case"ArrowRight":case"ArrowDown":ei=it(1);break;default:return}ei&&(Gt.preventDefault(),Ze(ei.dataset[kN("EventKey")]||null,Gt),q.current=!0,G())};ve.useEffect(()=>{if(Je.current&&q.current){const Gt=Je.current.querySelector(`[${nC}][aria-selected=true]`);Gt?.focus()}q.current=!1});const ct=y1(n,Je);return xe.jsx(a_.Provider,{value:Ze,children:xe.jsx(AE.Provider,{value:{role:I,activeKey:By(b),getControlledId:be||iC,getControllerId:He||iC},children:xe.jsx(l,Object.assign({},s,{onKeyDown:Pt,ref:ct,role:I}))})})});tD.displayName="Nav";const iD=Object.assign(tD,{Item:eD}),nD=ve.forwardRef(({bsPrefix:c,active:n,disabled:l,eventKey:p,className:b,variant:I,action:P,as:s,...G},q)=>{c=Qn(c,"list-group-item");const[ie,ce]=DE({key:By(p,G.href),active:n,...G}),be=Vm(Je=>{if(l){Je.preventDefault(),Je.stopPropagation();return}ie.onClick(Je)});l&&G.tabIndex===void 0&&(G.tabIndex=-1,G["aria-disabled"]=!0);const He=s||(P?G.href?"a":"button":"div");return xe.jsx(He,{ref:q,...G,...ie,onClick:be,className:Sn(b,c,ce.isActive&&"active",l&&"disabled",I&&`${c}-${I}`,P&&`${c}-action`)})});nD.displayName="ListGroupItem";const rD=ve.forwardRef((c,n)=>{const{className:l,bsPrefix:p,variant:b,horizontal:I,numbered:P,as:s="div",...G}=G0(c,{activeKey:"onSelect"}),q=Qn(p,"list-group");let ie;return I&&(ie=I===!0?"horizontal":`horizontal-${I}`),xe.jsx(iD,{ref:n,...G,as:s,className:Sn(l,q,b&&`${q}-${b}`,ie&&`${q}-${ie}`,P&&`${q}-numbered`)})});rD.displayName="ListGroup";const rC=Object.assign(rD,{Item:nD});var gb;function sC(c){if((!gb&&gb!==0||c)&&Xy){var n=document.createElement("div");n.style.position="absolute",n.style.top="-9999px",n.style.width="50px",n.style.height="50px",n.style.overflow="scroll",document.body.appendChild(n),gb=n.offsetWidth-n.clientWidth,document.body.removeChild(n)}return gb}function XN(){return ve.useState(null)}function uT(c){c===void 0&&(c=f1());try{var n=c.activeElement;return!n||!n.nodeName?null:n}catch{return c.body}}function KN(c){const n=ve.useRef(c);return n.current=c,n}function YN(c){const n=KN(c);ve.useEffect(()=>()=>n.current(),[])}function QN(c=document){const n=c.defaultView;return Math.abs(n.innerWidth-c.documentElement.clientWidth)}const oC=g1("modal-open");class PE{constructor({ownerDocument:n,handleContainerOverflow:l=!0,isRTL:p=!1}={}){this.handleContainerOverflow=l,this.isRTL=p,this.modals=[],this.ownerDocument=n}getScrollbarWidth(){return QN(this.ownerDocument)}getElement(){return(this.ownerDocument||document).body}setModalAttributes(n){}removeModalAttributes(n){}setContainerStyle(n){const l={overflow:"hidden"},p=this.isRTL?"paddingLeft":"paddingRight",b=this.getElement();n.style={overflow:b.style.overflow,[p]:b.style[p]},n.scrollBarWidth&&(l[p]=`${parseInt(op(b,p)||"0",10)+n.scrollBarWidth}px`),b.setAttribute(oC,""),op(b,l)}reset(){[...this.modals].forEach(n=>this.remove(n))}removeContainerStyle(n){const l=this.getElement();l.removeAttribute(oC),Object.assign(l.style,n.style)}add(n){let l=this.modals.indexOf(n);return l!==-1||(l=this.modals.length,this.modals.push(n),this.setModalAttributes(n),l!==0)||(this.state={scrollBarWidth:this.getScrollbarWidth(),style:{}},this.handleContainerOverflow&&this.setContainerStyle(this.state)),l}remove(n){const l=this.modals.indexOf(n);l!==-1&&(this.modals.splice(l,1),!this.modals.length&&this.handleContainerOverflow&&this.removeContainerStyle(this.state),this.removeModalAttributes(n))}isTopModal(n){return!!this.modals.length&&this.modals[this.modals.length-1]===n}}const hT=(c,n)=>Xy?c==null?(n||f1()).body:(typeof c=="function"&&(c=c()),c&&"current"in c&&(c=c.current),c&&("nodeType"in c||c.getBoundingClientRect)?c:null):null;function JN(c,n){const l=IE(),[p,b]=ve.useState(()=>hT(c,l?.document));if(!p){const I=hT(c);I&&b(I)}return ve.useEffect(()=>{},[n,p]),ve.useEffect(()=>{const I=hT(c);I!==p&&b(I)},[c,p]),p}function OE({children:c,in:n,onExited:l,mountOnEnter:p,unmountOnExit:b}){const I=ve.useRef(null),P=ve.useRef(n),s=ip(l);ve.useEffect(()=>{n?P.current=!0:s(I.current)},[n,s]);const G=y1(I,Zy(c)),q=ve.cloneElement(c,{ref:G});return n?q:b||!P.current&&p?null:q}const e4=["onEnter","onEntering","onEntered","onExit","onExiting","onExited","addEndListener","children"];function t4(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}function i4(c){let{onEnter:n,onEntering:l,onEntered:p,onExit:b,onExiting:I,onExited:P,addEndListener:s,children:G}=c,q=t4(c,e4);const ie=ve.useRef(null),ce=y1(ie,Zy(G)),be=ei=>Fi=>{ei&&ie.current&&ei(ie.current,Fi)},He=ve.useCallback(be(n),[n]),Je=ve.useCallback(be(l),[l]),it=ve.useCallback(be(p),[p]),Ze=ve.useCallback(be(b),[b]),Pt=ve.useCallback(be(I),[I]),ct=ve.useCallback(be(P),[P]),Gt=ve.useCallback(be(s),[s]);return Object.assign({},q,{nodeRef:ie},n&&{onEnter:He},l&&{onEntering:Je},p&&{onEntered:it},b&&{onExit:Ze},I&&{onExiting:Pt},P&&{onExited:ct},s&&{addEndListener:Gt},{children:typeof G=="function"?(ei,Fi)=>G(ei,Object.assign({},Fi,{ref:ce})):ve.cloneElement(G,{ref:ce})})}const n4=["component"];function r4(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}const s4=ve.forwardRef((c,n)=>{let{component:l}=c,p=r4(c,n4);const b=i4(p);return xe.jsx(l,Object.assign({ref:n},b))});function o4({in:c,onTransition:n}){const l=ve.useRef(null),p=ve.useRef(!0),b=ip(n);return Q2(()=>{if(!l.current)return;let I=!1;return b({in:c,element:l.current,initial:p.current,isStale:()=>I}),()=>{I=!0}},[c,b]),Q2(()=>(p.current=!1,()=>{p.current=!0}),[]),l}function a4({children:c,in:n,onExited:l,onEntered:p,transition:b}){const[I,P]=ve.useState(!n);n&&I&&P(!1);const s=o4({in:!!n,onTransition:q=>{const ie=()=>{q.isStale()||(q.in?p?.(q.element,q.initial):(P(!0),l?.(q.element)))};Promise.resolve(b(q)).then(ie,ce=>{throw q.in||P(!0),ce})}}),G=y1(s,Zy(c));return I&&!n?null:ve.cloneElement(c,{ref:G})}function aC(c,n,l){return c?xe.jsx(s4,Object.assign({},l,{component:c})):n?xe.jsx(a4,Object.assign({},l,{transition:n})):xe.jsx(OE,Object.assign({},l))}const l4=["show","role","className","style","children","backdrop","keyboard","onBackdropClick","onEscapeKeyDown","transition","runTransition","backdropTransition","runBackdropTransition","autoFocus","enforceFocus","restoreFocus","restoreFocusOptions","renderDialog","renderBackdrop","manager","container","onShow","onHide","onExit","onExited","onExiting","onEnter","onEntering","onEntered"];function c4(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}let dT;function u4(c){return dT||(dT=new PE({ownerDocument:c?.document})),dT}function h4(c){const n=IE(),l=c||u4(n),p=ve.useRef({dialog:null,backdrop:null});return Object.assign(p.current,{add:()=>l.add(p.current),remove:()=>l.remove(p.current),isTopModal:()=>l.isTopModal(p.current),setDialogRef:ve.useCallback(b=>{p.current.dialog=b},[]),setBackdropRef:ve.useCallback(b=>{p.current.backdrop=b},[])})}const sD=ve.forwardRef((c,n)=>{let{show:l=!1,role:p="dialog",className:b,style:I,children:P,backdrop:s=!0,keyboard:G=!0,onBackdropClick:q,onEscapeKeyDown:ie,transition:ce,runTransition:be,backdropTransition:He,runBackdropTransition:Je,autoFocus:it=!0,enforceFocus:Ze=!0,restoreFocus:Pt=!0,restoreFocusOptions:ct,renderDialog:Gt,renderBackdrop:ei=rr=>xe.jsx("div",Object.assign({},rr)),manager:Fi,container:Si,onShow:qe,onHide:Oe=()=>{},onExit:je,onExited:tt,onExiting:nt,onEnter:yt,onEntering:ze,onEntered:ur}=c,qn=c4(c,l4);const Ct=IE(),oi=JN(Si),wi=h4(Fi),bn=nN(),Cn=rN(l),[rt,Yt]=ve.useState(!l),ai=ve.useRef(null);ve.useImperativeHandle(n,()=>wi,[wi]),Xy&&!Cn&&l&&(ai.current=uT(Ct?.document)),l&&rt&&Yt(!1);const _i=ip(()=>{if(wi.add(),hr.current=Vb(document,"keydown",Mr),Ki.current=Vb(document,"focus",()=>setTimeout(kn),!0),qe&&qe(),it){var rr,Ds;const Us=uT((rr=(Ds=wi.dialog)==null?void 0:Ds.ownerDocument)!=null?rr:Ct?.document);wi.dialog&&Us&&!eC(wi.dialog,Us)&&(ai.current=Us,wi.dialog.focus())}}),ln=ip(()=>{if(wi.remove(),hr.current==null||hr.current(),Ki.current==null||Ki.current(),Pt){var rr;(rr=ai.current)==null||rr.focus==null||rr.focus(ct),ai.current=null}});ve.useEffect(()=>{!l||!oi||_i()},[l,oi,_i]),ve.useEffect(()=>{rt&&ln()},[rt,ln]),YN(()=>{ln()});const kn=ip(()=>{if(!Ze||!bn()||!wi.isTopModal())return;const rr=uT(Ct?.document);wi.dialog&&rr&&!eC(wi.dialog,rr)&&wi.dialog.focus()}),Jn=ip(rr=>{rr.target===rr.currentTarget&&(q?.(rr),s===!0&&Oe())}),Mr=ip(rr=>{G&&HB(rr)&&wi.isTopModal()&&(ie?.(rr),rr.defaultPrevented||Oe())}),Ki=ve.useRef(),hr=ve.useRef(),Wr=(...rr)=>{Yt(!0),tt?.(...rr)};if(!oi)return null;const co=Object.assign({role:p,ref:wi.setDialogRef,"aria-modal":p==="dialog"?!0:void 0},qn,{style:I,className:b,tabIndex:-1});let nr=Gt?Gt(co):xe.jsx("div",Object.assign({},co,{children:ve.cloneElement(P,{role:"document"})}));nr=aC(ce,be,{unmountOnExit:!0,mountOnEnter:!0,appear:!0,in:!!l,onExit:je,onExiting:nt,onExited:Wr,onEnter:yt,onEntering:ze,onEntered:ur,children:nr});let ps=null;return s&&(ps=ei({ref:wi.setBackdropRef,onClick:Jn}),ps=aC(He,Je,{in:!!l,appear:!0,mountOnEnter:!0,unmountOnExit:!0,children:ps})),xe.jsx(xe.Fragment,{children:Ry.createPortal(xe.jsxs(xe.Fragment,{children:[ps,nr]}),oi)})});sD.displayName="Modal";const oD=Object.assign(sD,{Manager:PE});function d4(c,n){return c.classList?c.classList.contains(n):(" "+(c.className.baseVal||c.className)+" ").indexOf(" "+n+" ")!==-1}function f4(c,n){c.classList?c.classList.add(n):d4(c,n)||(typeof c.className=="string"?c.className=c.className+" "+n:c.setAttribute("class",(c.className&&c.className.baseVal||"")+" "+n))}function lC(c,n){return c.replace(new RegExp("(^|\\s)"+n+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function p4(c,n){c.classList?c.classList.remove(n):typeof c.className=="string"?c.className=lC(c.className,n):c.setAttribute("class",lC(c.className&&c.className.baseVal||"",n))}const Ty={FIXED_CONTENT:".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",STICKY_CONTENT:".sticky-top",NAVBAR_TOGGLER:".navbar-toggler"};class aD extends PE{adjustAndStore(n,l,p){const b=l.style[n];l.dataset[n]=b,op(l,{[n]:`${parseFloat(op(l,n))+p}px`})}restore(n,l){const p=l.dataset[n];p!==void 0&&(delete l.dataset[n],op(l,{[n]:p}))}setContainerStyle(n){super.setContainerStyle(n);const l=this.getElement();if(f4(l,"modal-open"),!n.scrollBarWidth)return;const p=this.isRTL?"paddingLeft":"paddingRight",b=this.isRTL?"marginLeft":"marginRight";e_(l,Ty.FIXED_CONTENT).forEach(I=>this.adjustAndStore(p,I,n.scrollBarWidth)),e_(l,Ty.STICKY_CONTENT).forEach(I=>this.adjustAndStore(b,I,-n.scrollBarWidth)),e_(l,Ty.NAVBAR_TOGGLER).forEach(I=>this.adjustAndStore(b,I,n.scrollBarWidth))}removeContainerStyle(n){super.removeContainerStyle(n);const l=this.getElement();p4(l,"modal-open");const p=this.isRTL?"paddingLeft":"paddingRight",b=this.isRTL?"marginLeft":"marginRight";e_(l,Ty.FIXED_CONTENT).forEach(I=>this.restore(p,I)),e_(l,Ty.STICKY_CONTENT).forEach(I=>this.restore(b,I)),e_(l,Ty.NAVBAR_TOGGLER).forEach(I=>this.restore(b,I))}}let fT;function lD(c){return fT||(fT=new aD(c)),fT}const cD=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"modal-body"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));cD.displayName="ModalBody";const LE=ve.createContext({onHide(){}}),zE=ve.forwardRef(({bsPrefix:c,className:n,contentClassName:l,centered:p,size:b,fullscreen:I,children:P,scrollable:s,...G},q)=>{c=Qn(c,"modal");const ie=`${c}-dialog`,ce=typeof I=="string"?`${c}-fullscreen-${I}`:`${c}-fullscreen`;return xe.jsx("div",{...G,ref:q,className:Sn(ie,n,b&&`${c}-${b}`,p&&`${ie}-centered`,s&&`${ie}-scrollable`,I&&ce),children:xe.jsx("div",{className:Sn(`${c}-content`,l),children:P})})});zE.displayName="ModalDialog";const uD=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"modal-footer"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));uD.displayName="ModalFooter";const kE=ve.forwardRef(({closeLabel:c="Close",closeVariant:n,closeButton:l=!1,onHide:p,children:b,...I},P)=>{const s=ve.useContext(LE),G=Vm(()=>{s?.onHide(),p?.()});return xe.jsxs("div",{ref:P,...I,children:[b,l&&xe.jsx(m1,{"aria-label":c,variant:n,onClick:G})]})});kE.displayName="AbstractModalHeader";const hD=ve.forwardRef(({bsPrefix:c,className:n,closeLabel:l="Close",closeButton:p=!1,...b},I)=>(c=Qn(c,"modal-header"),xe.jsx(kE,{ref:I,...b,className:Sn(n,c),closeLabel:l,closeButton:p})));hD.displayName="ModalHeader";const m4=H0("h4"),dD=ve.forwardRef(({className:c,bsPrefix:n,as:l=m4,...p},b)=>(n=Qn(n,"modal-title"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));dD.displayName="ModalTitle";function g4(c){return xe.jsx(Um,{...c,timeout:null})}function _4(c){return xe.jsx(Um,{...c,timeout:null})}const fD=ve.forwardRef(({bsPrefix:c,className:n,style:l,dialogClassName:p,contentClassName:b,children:I,dialogAs:P=zE,"data-bs-theme":s,"aria-labelledby":G,"aria-describedby":q,"aria-label":ie,show:ce=!1,animation:be=!0,backdrop:He=!0,keyboard:Je=!0,onEscapeKeyDown:it,onShow:Ze,onHide:Pt,container:ct,autoFocus:Gt=!0,enforceFocus:ei=!0,restoreFocus:Fi=!0,restoreFocusOptions:Si,onEntered:qe,onExit:Oe,onExiting:je,onEnter:tt,onEntering:nt,onExited:yt,backdropClassName:ze,manager:ur,...qn},Ct)=>{const[oi,wi]=ve.useState({}),[bn,Cn]=ve.useState(!1),rt=ve.useRef(!1),Yt=ve.useRef(!1),ai=ve.useRef(null),[_i,ln]=XN(),kn=SM(Ct,ln),Jn=Vm(Pt),Mr=PB();c=Qn(c,"modal");const Ki=ve.useMemo(()=>({onHide:Jn}),[Jn]);function hr(){return ur||lD({isRTL:Mr})}function Wr(Kn){if(!Xy)return;const uo=hr().getScrollbarWidth()>0,Uo=Kn.scrollHeight>f1(Kn).documentElement.clientHeight;wi({paddingRight:uo&&!Uo?sC():void 0,paddingLeft:!uo&&Uo?sC():void 0})}const co=Vm(()=>{_i&&Wr(_i.dialog)});yN(()=>{FT(window,"resize",co),ai.current==null||ai.current()});const nr=()=>{rt.current=!0},ps=Kn=>{rt.current&&_i&&Kn.target===_i.dialog&&(Yt.current=!0),rt.current=!1},rr=()=>{Cn(!0),ai.current=TM(_i.dialog,()=>{Cn(!1)})},Ds=Kn=>{Kn.target===Kn.currentTarget&&rr()},Us=Kn=>{if(He==="static"){Ds(Kn);return}if(Yt.current||Kn.target!==Kn.currentTarget){Yt.current=!1;return}Pt?.()},Dr=Kn=>{Je?it?.(Kn):(Kn.preventDefault(),He==="static"&&rr())},ms=(Kn,uo)=>{Kn&&Wr(Kn),tt?.(Kn,uo)},hs=Kn=>{ai.current==null||ai.current(),Oe?.(Kn)},Di=(Kn,uo)=>{nt?.(Kn,uo),wM(window,"resize",co)},rn=Kn=>{Kn&&(Kn.style.display=""),yt?.(Kn),FT(window,"resize",co)},vn=ve.useCallback(Kn=>xe.jsx("div",{...Kn,className:Sn(`${c}-backdrop`,ze,!be&&"show")}),[be,ze,c]),$i={...l,...oi};$i.display="block";const Ks=Kn=>xe.jsx("div",{role:"dialog",...Kn,style:$i,className:Sn(n,c,bn&&`${c}-static`,!be&&"show"),onClick:He?Us:void 0,onMouseUp:ps,"data-bs-theme":s,"aria-label":ie,"aria-labelledby":G,"aria-describedby":q,children:xe.jsx(P,{...qn,onMouseDown:nr,className:p,contentClassName:b,children:I})});return xe.jsx(LE.Provider,{value:Ki,children:xe.jsx(oD,{show:ce,ref:kn,backdrop:He,container:ct,keyboard:!0,autoFocus:Gt,enforceFocus:ei,restoreFocus:Fi,restoreFocusOptions:Si,onEscapeKeyDown:Dr,onShow:Ze,onHide:Pt,onEnter:ms,onEntering:Di,onEntered:qe,onExit:hs,onExiting:je,onExited:rn,manager:hr(),transition:be?g4:void 0,backdropTransition:be?_4:void 0,renderBackdrop:vn,renderDialog:Ks})})});fD.displayName="Modal";const h0=Object.assign(fD,{Body:cD,Header:hD,Title:dD,Footer:uD,Dialog:zE,TRANSITION_DURATION:300,BACKDROP_TRANSITION_DURATION:150}),FE=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"nav-item"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));FE.displayName="NavItem";const BE=ve.forwardRef(({bsPrefix:c,className:n,as:l=wE,active:p,eventKey:b,disabled:I=!1,...P},s)=>{c=Qn(c,"nav-link");const[G,q]=DE({key:By(b,P.href),active:p,disabled:I,...P});return xe.jsx(l,{...P,...G,ref:s,disabled:I,className:Sn(n,c,I&&"disabled",q.isActive&&"active")})});BE.displayName="NavLink";const pD=ve.forwardRef((c,n)=>{const{as:l="div",bsPrefix:p,variant:b,fill:I=!1,justify:P=!1,navbar:s,navbarScroll:G,className:q,activeKey:ie,...ce}=G0(c,{activeKey:"onSelect"}),be=Qn(p,"nav");let He,Je,it=!1;const Ze=ve.useContext(Ky),Pt=ve.useContext(SE);return Ze?(He=Ze.bsPrefix,it=s??!0):Pt&&({cardHeaderBsPrefix:Je}=Pt),xe.jsx(iD,{as:l,ref:n,activeKey:ie,className:Sn(q,{[be]:!it,[`${He}-nav`]:it,[`${He}-nav-scroll`]:it&&G,[`${Je}-${b}`]:!!Je,[`${be}-${b}`]:!!b,[`${be}-fill`]:I,[`${be}-justified`]:P}),...ce})});pD.displayName="Nav";const p0=Object.assign(pD,{Item:FE,Link:BE}),mD=ve.forwardRef(({bsPrefix:c,className:n,as:l,...p},b)=>{c=Qn(c,"navbar-brand");const I=l||(p.href?"a":"span");return xe.jsx(I,{...p,ref:b,className:Sn(n,c)})});mD.displayName="NavbarBrand";const gD=ve.forwardRef(({children:c,bsPrefix:n,...l},p)=>{n=Qn(n,"navbar-collapse");const b=ve.useContext(Ky);return xe.jsx(AM,{in:!!(b&&b.expanded),...l,children:xe.jsx("div",{ref:p,className:n,children:c})})});gD.displayName="NavbarCollapse";const _D=ve.forwardRef(({bsPrefix:c,className:n,children:l,label:p="Toggle navigation",as:b="button",onClick:I,...P},s)=>{c=Qn(c,"navbar-toggler");const{onToggle:G,expanded:q}=ve.useContext(Ky)||{},ie=Vm(ce=>{I&&I(ce),G&&G()});return b==="button"&&(P.type="button"),xe.jsx(b,{...P,ref:s,onClick:ie,"aria-label":p,className:Sn(n,c,!q&&"collapsed"),children:l||xe.jsx("span",{className:`${c}-icon`})})});_D.displayName="NavbarToggle";const BT=new WeakMap,cC=(c,n)=>{if(!c||!n)return;const l=BT.get(n)||new Map;BT.set(n,l);let p=l.get(c);return p||(p=n.matchMedia(c),p.refCount=0,l.set(p.media,p)),p};function y4(c,n=typeof window>"u"?void 0:window){const l=cC(c,n),[p,b]=ve.useState(()=>l?l.matches:!1);return NN(()=>{let I=cC(c,n);if(!I)return b(!1);let P=BT.get(n);const s=()=>{b(I.matches)};return I.refCount++,I.addListener(s),s(),()=>{I.removeListener(s),I.refCount--,I.refCount<=0&&P?.delete(I.media),I=void 0}},[c]),p}function v4(c){const n=Object.keys(c);function l(s,G){return s===G?G:s?`${s} and ${G}`:G}function p(s){return n[Math.min(n.indexOf(s)+1,n.length-1)]}function b(s){const G=p(s);let q=c[G];return typeof q=="number"?q=`${q-.2}px`:q=`calc(${q} - 0.2px)`,`(max-width: ${q})`}function I(s){let G=c[s];return typeof G=="number"&&(G=`${G}px`),`(min-width: ${G})`}function P(s,G,q){let ie;typeof s=="object"?(ie=s,q=G,G=!0):(G=G||!0,ie={[s]:G});let ce=ve.useMemo(()=>Object.entries(ie).reduce((be,[He,Je])=>((Je==="up"||Je===!0)&&(be=l(be,I(He))),(Je==="down"||Je===!0)&&(be=l(be,b(He))),be),""),[JSON.stringify(ie)]);return y4(ce,q)}return P}const x4=v4({xs:0,sm:576,md:768,lg:992,xl:1200,xxl:1400}),yD=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"offcanvas-body"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));yD.displayName="OffcanvasBody";const b4={[Jh]:"show",[tp]:"show"},vD=ve.forwardRef(({bsPrefix:c,className:n,children:l,in:p=!1,mountOnEnter:b=!1,unmountOnExit:I=!1,appear:P=!1,...s},G)=>(c=Qn(c,"offcanvas"),xe.jsx(p1,{ref:G,addEndListener:xE,in:p,mountOnEnter:b,unmountOnExit:I,appear:P,...s,childRef:Zy(l),children:(q,ie)=>ve.cloneElement(l,{...ie,className:Sn(n,l.props.className,(q===Jh||q===R0)&&`${c}-toggling`,b4[q])})})));vD.displayName="OffcanvasToggling";const xD=ve.forwardRef(({bsPrefix:c,className:n,closeLabel:l="Close",closeButton:p=!1,...b},I)=>(c=Qn(c,"offcanvas-header"),xe.jsx(kE,{ref:I,...b,className:Sn(n,c),closeLabel:l,closeButton:p})));xD.displayName="OffcanvasHeader";const w4=H0("h5"),bD=ve.forwardRef(({className:c,bsPrefix:n,as:l=w4,...p},b)=>(n=Qn(n,"offcanvas-title"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));bD.displayName="OffcanvasTitle";function T4(c){return xe.jsx(vD,{...c})}function E4(c){return xe.jsx(Um,{...c})}const wD=ve.forwardRef(({bsPrefix:c,className:n,children:l,"aria-labelledby":p,placement:b="start",responsive:I,show:P=!1,backdrop:s=!0,keyboard:G=!0,scroll:q=!1,onEscapeKeyDown:ie,onShow:ce,onHide:be,container:He,autoFocus:Je=!0,enforceFocus:it=!0,restoreFocus:Ze=!0,restoreFocusOptions:Pt,onEntered:ct,onExit:Gt,onExiting:ei,onEnter:Fi,onEntering:Si,onExited:qe,backdropClassName:Oe,manager:je,renderStaticNode:tt=!1,...nt},yt)=>{const ze=ve.useRef();c=Qn(c,"offcanvas");const[ur,qn]=ve.useState(!1),Ct=Vm(be),oi=x4(I||"xs","up");ve.useEffect(()=>{qn(I?P&&!oi:P)},[P,I,oi]);const wi=ve.useMemo(()=>({onHide:Ct}),[Ct]);function bn(){return je||(q?(ze.current||(ze.current=new aD({handleContainerOverflow:!1})),ze.current):lD())}const Cn=(_i,...ln)=>{_i&&(_i.style.visibility="visible"),Fi?.(_i,...ln)},rt=(_i,...ln)=>{_i&&(_i.style.visibility=""),qe?.(...ln)},Yt=ve.useCallback(_i=>xe.jsx("div",{..._i,className:Sn(`${c}-backdrop`,Oe)}),[Oe,c]),ai=_i=>xe.jsx("div",{..._i,...nt,className:Sn(n,I?`${c}-${I}`:c,`${c}-${b}`),"aria-labelledby":p,children:l});return xe.jsxs(xe.Fragment,{children:[!ur&&(I||tt)&&ai({}),xe.jsx(LE.Provider,{value:wi,children:xe.jsx(oD,{show:ur,ref:yt,backdrop:s,container:He,keyboard:G,autoFocus:Je,enforceFocus:it&&!q,restoreFocus:Ze,restoreFocusOptions:Pt,onEscapeKeyDown:ie,onShow:ce,onHide:Ct,onEnter:Cn,onEntering:Si,onEntered:ct,onExit:Gt,onExiting:ei,onExited:rt,manager:bn(),transition:T4,backdropTransition:E4,renderBackdrop:Yt,renderDialog:ai})})]})});wD.displayName="Offcanvas";const S4=Object.assign(wD,{Body:yD,Header:xD,Title:bD}),TD=ve.forwardRef(({onHide:c,...n},l)=>{const p=ve.useContext(Ky),b=Vm(()=>{p==null||p.onToggle==null||p.onToggle(),c?.()});return xe.jsx(S4,{ref:l,show:!!(p!=null&&p.expanded),...n,renderStaticNode:!0,onHide:b})});TD.displayName="NavbarOffcanvas";const ED=ve.forwardRef(({className:c,bsPrefix:n,as:l="span",...p},b)=>(n=Qn(n,"navbar-text"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));ED.displayName="NavbarText";const SD=ve.forwardRef((c,n)=>{const{bsPrefix:l,expand:p=!0,variant:b="light",bg:I,fixed:P,sticky:s,className:G,as:q="nav",expanded:ie,onToggle:ce,onSelect:be,collapseOnSelect:He=!1,...Je}=G0(c,{expanded:"onToggle"}),it=Qn(l,"navbar"),Ze=ve.useCallback((...Gt)=>{be?.(...Gt),He&&ie&&ce?.(!1)},[be,He,ie,ce]);Je.role===void 0&&q!=="nav"&&(Je.role="navigation");let Pt=`${it}-expand`;typeof p=="string"&&(Pt=`${Pt}-${p}`);const ct=ve.useMemo(()=>({onToggle:()=>ce?.(!ie),bsPrefix:it,expanded:!!ie,expand:p}),[it,ie,p,ce]);return xe.jsx(Ky.Provider,{value:ct,children:xe.jsx(a_.Provider,{value:Ze,children:xe.jsx(q,{ref:n,...Je,className:Sn(G,it,p&&Pt,b&&`${it}-${b}`,I&&`bg-${I}`,s&&`sticky-${s}`,P&&`fixed-${P}`)})})})});SD.displayName="Navbar";const _b=Object.assign(SD,{Brand:mD,Collapse:gD,Offcanvas:TD,Text:ED,Toggle:_D}),A4=["active","eventKey","mountOnEnter","transition","unmountOnExit","role","onEnter","onEntering","onEntered","onExit","onExiting","onExited"],I4=["activeKey","getControlledId","getControllerId"],C4=["as"];function NT(c,n){if(c==null)return{};var l={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(n.indexOf(p)>=0)continue;l[p]=c[p]}return l}function AD(c){let{active:n,eventKey:l,mountOnEnter:p,transition:b,unmountOnExit:I,role:P="tabpanel",onEnter:s,onEntering:G,onEntered:q,onExit:ie,onExiting:ce,onExited:be}=c,He=NT(c,A4);const Je=ve.useContext(Yy);if(!Je)return[Object.assign({},He,{role:P}),{eventKey:l,isActive:n,mountOnEnter:p,transition:b,unmountOnExit:I,onEnter:s,onEntering:G,onEntered:q,onExit:ie,onExiting:ce,onExited:be}];const{activeKey:it,getControlledId:Ze,getControllerId:Pt}=Je,ct=NT(Je,I4),Gt=By(l);return[Object.assign({},He,{role:P,id:Ze(l),"aria-labelledby":Pt(l)}),{eventKey:l,isActive:n==null&&Gt!=null?By(it)===Gt:n,transition:b||ct.transition,mountOnEnter:p??ct.mountOnEnter,unmountOnExit:I??ct.unmountOnExit,onEnter:s,onEntering:G,onEntered:q,onExit:ie,onExiting:ce,onExited:be}]}const ID=ve.forwardRef((c,n)=>{let{as:l="div"}=c,p=NT(c,C4);const[b,{isActive:I,onEnter:P,onEntering:s,onEntered:G,onExit:q,onExiting:ie,onExited:ce,mountOnEnter:be,unmountOnExit:He,transition:Je=OE}]=AD(p);return xe.jsx(Yy.Provider,{value:null,children:xe.jsx(a_.Provider,{value:null,children:xe.jsx(Je,{in:I,onEnter:P,onEntering:s,onEntered:G,onExit:q,onExiting:ie,onExited:ce,mountOnEnter:be,unmountOnExit:He,children:xe.jsx(l,Object.assign({},b,{ref:n,hidden:!I,"aria-hidden":!I}))})})})});ID.displayName="TabPanel";const NE=c=>{const{id:n,generateChildId:l,onSelect:p,activeKey:b,defaultActiveKey:I,transition:P,mountOnEnter:s,unmountOnExit:G,children:q}=c,[ie,ce]=TN(b,I,p),be=RN(n),He=ve.useMemo(()=>l||((it,Ze)=>be?`${be}-${Ze}-${it}`:null),[be,l]),Je=ve.useMemo(()=>({onSelect:ce,activeKey:ie,transition:P,mountOnEnter:s||!1,unmountOnExit:G||!1,getControlledId:it=>He(it,"tabpane"),getControllerId:it=>He(it,"tab")}),[ce,ie,P,s,G,He]);return xe.jsx(Yy.Provider,{value:Je,children:xe.jsx(a_.Provider,{value:ce||null,children:q})})};NE.Panel=ID;function VE(c){return typeof c=="boolean"?c?Um:OE:c}const CD=({transition:c,...n})=>xe.jsx(NE,{...n,transition:VE(c)});CD.displayName="TabContainer";const UE=ve.forwardRef(({className:c,bsPrefix:n,as:l="div",...p},b)=>(n=Qn(n,"tab-content"),xe.jsx(l,{ref:b,className:Sn(c,n),...p})));UE.displayName="TabContent";const jE=ve.forwardRef(({bsPrefix:c,transition:n,...l},p)=>{const[{className:b,as:I="div",...P},{isActive:s,onEnter:G,onEntering:q,onEntered:ie,onExit:ce,onExiting:be,onExited:He,mountOnEnter:Je,unmountOnExit:it,transition:Ze=Um}]=AD({...l,transition:VE(n)}),Pt=Qn(c,"tab-pane");return xe.jsx(Yy.Provider,{value:null,children:xe.jsx(a_.Provider,{value:null,children:xe.jsx(Ze,{in:s,onEnter:G,onEntering:q,onEntered:ie,onExit:ce,onExiting:be,onExited:He,mountOnEnter:Je,unmountOnExit:it,children:xe.jsx(I,{...P,ref:p,className:Sn(b,Pt,s&&"active")})})})})});jE.displayName="TabPane";const R4={eventKey:Pl.oneOfType([Pl.string,Pl.number]),title:Pl.node.isRequired,disabled:Pl.bool,tabClassName:Pl.string,tabAttrs:Pl.object},RD=()=>{throw new Error("ReactBootstrap: The `Tab` component is not meant to be rendered! It's an abstract component that is only valid as a direct Child of the `Tabs` Component. For custom tabs components use TabPane and TabsContainer directly")};RD.propTypes=R4;const uC=Object.assign(RD,{Container:CD,Content:UE,Pane:jE});function M4(c){let n;return vN(c,l=>{n==null&&(n=l.props.eventKey)}),n}function D4(c){const{title:n,eventKey:l,disabled:p,tabClassName:b,tabAttrs:I,id:P}=c.props;return n==null?null:xe.jsx(FE,{as:"li",role:"presentation",children:xe.jsx(BE,{as:"button",type:"button",eventKey:l,disabled:p,id:P,className:b,...I,children:n})})}const MD=c=>{const{id:n,onSelect:l,transition:p,mountOnEnter:b=!1,unmountOnExit:I=!1,variant:P="tabs",children:s,activeKey:G=M4(s),...q}=G0(c,{activeKey:"onSelect"});return xe.jsxs(NE,{id:n,activeKey:G,onSelect:l,transition:VE(p),mountOnEnter:b,unmountOnExit:I,children:[xe.jsx(p0,{id:n,...q,role:"tablist",as:"ul",variant:P,children:J2(s,D4)}),xe.jsx(UE,{children:J2(s,ie=>{const ce={...ie.props};return delete ce.title,delete ce.disabled,delete ce.tabClassName,delete ce.tabAttrs,xe.jsx(jE,{...ce})})})]})};MD.displayName="Tabs";const P4=()=>{};var hC={};const DD=function(c){const n=[];let l=0;for(let p=0;p<c.length;p++){let b=c.charCodeAt(p);b<128?n[l++]=b:b<2048?(n[l++]=b>>6|192,n[l++]=b&63|128):(b&64512)===55296&&p+1<c.length&&(c.charCodeAt(p+1)&64512)===56320?(b=65536+((b&1023)<<10)+(c.charCodeAt(++p)&1023),n[l++]=b>>18|240,n[l++]=b>>12&63|128,n[l++]=b>>6&63|128,n[l++]=b&63|128):(n[l++]=b>>12|224,n[l++]=b>>6&63|128,n[l++]=b&63|128)}return n},O4=function(c){const n=[];let l=0,p=0;for(;l<c.length;){const b=c[l++];if(b<128)n[p++]=String.fromCharCode(b);else if(b>191&&b<224){const I=c[l++];n[p++]=String.fromCharCode((b&31)<<6|I&63)}else if(b>239&&b<365){const I=c[l++],P=c[l++],s=c[l++],G=((b&7)<<18|(I&63)<<12|(P&63)<<6|s&63)-65536;n[p++]=String.fromCharCode(55296+(G>>10)),n[p++]=String.fromCharCode(56320+(G&1023))}else{const I=c[l++],P=c[l++];n[p++]=String.fromCharCode((b&15)<<12|(I&63)<<6|P&63)}}return n.join("")},PD={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(c,n){if(!Array.isArray(c))throw Error("encodeByteArray takes an array as a parameter");this.init_();const l=n?this.byteToCharMapWebSafe_:this.byteToCharMap_,p=[];for(let b=0;b<c.length;b+=3){const I=c[b],P=b+1<c.length,s=P?c[b+1]:0,G=b+2<c.length,q=G?c[b+2]:0,ie=I>>2,ce=(I&3)<<4|s>>4;let be=(s&15)<<2|q>>6,He=q&63;G||(He=64,P||(be=64)),p.push(l[ie],l[ce],l[be],l[He])}return p.join("")},encodeString(c,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(c):this.encodeByteArray(DD(c),n)},decodeString(c,n){return this.HAS_NATIVE_SUPPORT&&!n?atob(c):O4(this.decodeStringToByteArray(c,n))},decodeStringToByteArray(c,n){this.init_();const l=n?this.charToByteMapWebSafe_:this.charToByteMap_,p=[];for(let b=0;b<c.length;){const I=l[c.charAt(b++)],s=b<c.length?l[c.charAt(b)]:0;++b;const q=b<c.length?l[c.charAt(b)]:64;++b;const ce=b<c.length?l[c.charAt(b)]:64;if(++b,I==null||s==null||q==null||ce==null)throw new L4;const be=I<<2|s>>4;if(p.push(be),q!==64){const He=s<<4&240|q>>2;if(p.push(He),ce!==64){const Je=q<<6&192|ce;p.push(Je)}}}return p},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let c=0;c<this.ENCODED_VALS.length;c++)this.byteToCharMap_[c]=this.ENCODED_VALS.charAt(c),this.charToByteMap_[this.byteToCharMap_[c]]=c,this.byteToCharMapWebSafe_[c]=this.ENCODED_VALS_WEBSAFE.charAt(c),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[c]]=c,c>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(c)]=c,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(c)]=c)}}};class L4 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const z4=function(c){const n=DD(c);return PD.encodeByteArray(n,!0)},Gb=function(c){return z4(c).replace(/\./g,"")},OD=function(c){try{return PD.decodeString(c,!0)}catch(n){console.error("base64Decode failed: ",n)}return null};function k4(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const F4=()=>k4().__FIREBASE_DEFAULTS__,B4=()=>{if(typeof process>"u"||typeof hC>"u")return;const c=hC.__FIREBASE_DEFAULTS__;if(c)return JSON.parse(c)},N4=()=>{if(typeof document>"u")return;let c;try{c=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const n=c&&OD(c[1]);return n&&JSON.parse(n)},v1=()=>{try{return P4()||F4()||B4()||N4()}catch(c){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${c}`);return}},LD=c=>v1()?.emulatorHosts?.[c],zD=c=>{const n=LD(c);if(!n)return;const l=n.lastIndexOf(":");if(l<=0||l+1===n.length)throw new Error(`Invalid host ${n} with no separate hostname and port!`);const p=parseInt(n.substring(l+1),10);return n[0]==="["?[n.substring(1,l-1),p]:[n.substring(0,l),p]},kD=()=>v1()?.config,FD=c=>v1()?.[`_${c}`];class V4{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((n,l)=>{this.resolve=n,this.reject=l})}wrapCallback(n){return(l,p)=>{l?this.reject(l):this.resolve(p),typeof n=="function"&&(this.promise.catch(()=>{}),n.length===1?n(l):n(l,p))}}}function Km(c){try{return(c.startsWith("http://")||c.startsWith("https://")?new URL(c).hostname:c).endsWith(".cloudworkstations.dev")}catch{return!1}}async function GE(c){return(await fetch(c,{credentials:"include"})).ok}function BD(c,n){if(c.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const l={alg:"none",type:"JWT"},p=n||"demo-project",b=c.iat||0,I=c.sub||c.user_id;if(!I)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const P={iss:`https://securetoken.google.com/${p}`,aud:p,iat:b,exp:b+3600,auth_time:b,sub:I,user_id:I,firebase:{sign_in_provider:"custom",identities:{}},...c};return[Gb(JSON.stringify(l)),Gb(JSON.stringify(P)),""].join(".")}const b0={};function U4(){const c={prod:[],emulator:[]};for(const n of Object.keys(b0))b0[n]?c.emulator.push(n):c.prod.push(n);return c}function j4(c){let n=document.getElementById(c),l=!1;return n||(n=document.createElement("div"),n.setAttribute("id",c),l=!0),{created:l,element:n}}let dC=!1;function qE(c,n){if(typeof window>"u"||typeof document>"u"||!Km(window.location.host)||b0[c]===n||b0[c]||dC)return;b0[c]=n;function l(be){return`__firebase__banner__${be}`}const p="__firebase__banner",I=U4().prod.length>0;function P(){const be=document.getElementById(p);be&&be.remove()}function s(be){be.style.display="flex",be.style.background="#7faaf0",be.style.position="fixed",be.style.bottom="5px",be.style.left="5px",be.style.padding=".5em",be.style.borderRadius="5px",be.style.alignItems="center"}function G(be,He){be.setAttribute("width","24"),be.setAttribute("id",He),be.setAttribute("height","24"),be.setAttribute("viewBox","0 0 24 24"),be.setAttribute("fill","none"),be.style.marginLeft="-6px"}function q(){const be=document.createElement("span");return be.style.cursor="pointer",be.style.marginLeft="16px",be.style.fontSize="24px",be.innerHTML=" &times;",be.onclick=()=>{dC=!0,P()},be}function ie(be,He){be.setAttribute("id",He),be.innerText="Learn more",be.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",be.setAttribute("target","__blank"),be.style.paddingLeft="5px",be.style.textDecoration="underline"}function ce(){const be=j4(p),He=l("text"),Je=document.getElementById(He)||document.createElement("span"),it=l("learnmore"),Ze=document.getElementById(it)||document.createElement("a"),Pt=l("preprendIcon"),ct=document.getElementById(Pt)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(be.created){const Gt=be.element;s(Gt),ie(Ze,it);const ei=q();G(ct,Pt),Gt.append(ct,Je,Ze,ei),document.body.appendChild(Gt)}I?(Je.innerText="Preview backend disconnected.",ct.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(ct.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Je.innerText="Preview backend running in this workspace."),Je.setAttribute("id",He)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",ce):ce()}function kl(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function G4(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(kl())}function q4(){const c=v1()?.forceEnvironment;if(c==="node")return!0;if(c==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function H4(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function ND(){const c=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof c=="object"&&c.id!==void 0}function $4(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function W4(){const c=kl();return c.indexOf("MSIE ")>=0||c.indexOf("Trident/")>=0}function Z4(){return!q4()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function VD(){try{return typeof indexedDB=="object"}catch{return!1}}function UD(){return new Promise((c,n)=>{try{let l=!0;const p="validate-browser-context-for-indexeddb-analytics-module",b=self.indexedDB.open(p);b.onsuccess=()=>{b.result.close(),l||self.indexedDB.deleteDatabase(p),c(!0)},b.onupgradeneeded=()=>{l=!1},b.onerror=()=>{n(b.error?.message||"")}}catch(l){n(l)}})}function X4(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}const K4="FirebaseError";class th extends Error{constructor(n,l,p){super(l),this.code=n,this.customData=p,this.name=K4,Object.setPrototypeOf(this,th.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,__.prototype.create)}}class __{constructor(n,l,p){this.service=n,this.serviceName=l,this.errors=p}create(n,...l){const p=l[0]||{},b=`${this.service}/${n}`,I=this.errors[n],P=I?Y4(I,p):"Error",s=`${this.serviceName}: ${P} (${b}).`;return new th(b,s,p)}}function Y4(c,n){return c.replace(Q4,(l,p)=>{const b=n[p];return b!=null?String(b):`<${p}?>`})}const Q4=/\{\$([^}]+)}/g;function J4(c){for(const n in c)if(Object.prototype.hasOwnProperty.call(c,n))return!1;return!0}function hp(c,n){if(c===n)return!0;const l=Object.keys(c),p=Object.keys(n);for(const b of l){if(!p.includes(b))return!1;const I=c[b],P=n[b];if(fC(I)&&fC(P)){if(!hp(I,P))return!1}else if(I!==P)return!1}for(const b of p)if(!l.includes(b))return!1;return!0}function fC(c){return c!==null&&typeof c=="object"}function $0(c){const n=[];for(const[l,p]of Object.entries(c))Array.isArray(p)?p.forEach(b=>{n.push(encodeURIComponent(l)+"="+encodeURIComponent(b))}):n.push(encodeURIComponent(l)+"="+encodeURIComponent(p));return n.length?"&"+n.join("&"):""}function m0(c){const n={};return c.replace(/^\?/,"").split("&").forEach(p=>{if(p){const[b,I]=p.split("=");n[decodeURIComponent(b)]=decodeURIComponent(I)}}),n}function g0(c){const n=c.indexOf("?");if(!n)return"";const l=c.indexOf("#",n);return c.substring(n,l>0?l:void 0)}function eV(c,n){const l=new tV(c,n);return l.subscribe.bind(l)}class tV{constructor(n,l){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=l,this.task.then(()=>{n(this)}).catch(p=>{this.error(p)})}next(n){this.forEachObserver(l=>{l.next(n)})}error(n){this.forEachObserver(l=>{l.error(n)}),this.close(n)}complete(){this.forEachObserver(n=>{n.complete()}),this.close()}subscribe(n,l,p){let b;if(n===void 0&&l===void 0&&p===void 0)throw new Error("Missing Observer.");iV(n,["next","error","complete"])?b=n:b={next:n,error:l,complete:p},b.next===void 0&&(b.next=pT),b.error===void 0&&(b.error=pT),b.complete===void 0&&(b.complete=pT);const I=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?b.error(this.finalError):b.complete()}catch{}}),this.observers.push(b),I}unsubscribeOne(n){this.observers===void 0||this.observers[n]===void 0||(delete this.observers[n],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(n){if(!this.finalized)for(let l=0;l<this.observers.length;l++)this.sendOne(l,n)}sendOne(n,l){this.task.then(()=>{if(this.observers!==void 0&&this.observers[n]!==void 0)try{l(this.observers[n])}catch(p){typeof console<"u"&&console.error&&console.error(p)}})}close(n){this.finalized||(this.finalized=!0,n!==void 0&&(this.finalError=n),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function iV(c,n){if(typeof c!="object"||c===null)return!1;for(const l of n)if(l in c&&typeof c[l]=="function")return!0;return!1}function pT(){}const nV=1e3,rV=2,sV=14400*1e3,oV=.5;function pC(c,n=nV,l=rV){const p=n*Math.pow(l,c),b=Math.round(oV*p*(Math.random()-.5)*2);return Math.min(sV,p+b)}function xo(c){return c&&c._delegate?c._delegate:c}class eh{constructor(n,l,p){this.name=n,this.instanceFactory=l,this.type=p,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(n){return this.instantiationMode=n,this}setMultipleInstances(n){return this.multipleInstances=n,this}setServiceProps(n){return this.serviceProps=n,this}setInstanceCreatedCallback(n){return this.onInstanceCreated=n,this}}const t_="[DEFAULT]";class aV{constructor(n,l){this.name=n,this.container=l,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(n){const l=this.normalizeInstanceIdentifier(n);if(!this.instancesDeferred.has(l)){const p=new V4;if(this.instancesDeferred.set(l,p),this.isInitialized(l)||this.shouldAutoInitialize())try{const b=this.getOrInitializeService({instanceIdentifier:l});b&&p.resolve(b)}catch{}}return this.instancesDeferred.get(l).promise}getImmediate(n){const l=this.normalizeInstanceIdentifier(n?.identifier),p=n?.optional??!1;if(this.isInitialized(l)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:l})}catch(b){if(p)return null;throw b}else{if(p)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(n){if(n.name!==this.name)throw Error(`Mismatching Component ${n.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=n,!!this.shouldAutoInitialize()){if(cV(n))try{this.getOrInitializeService({instanceIdentifier:t_})}catch{}for(const[l,p]of this.instancesDeferred.entries()){const b=this.normalizeInstanceIdentifier(l);try{const I=this.getOrInitializeService({instanceIdentifier:b});p.resolve(I)}catch{}}}}clearInstance(n=t_){this.instancesDeferred.delete(n),this.instancesOptions.delete(n),this.instances.delete(n)}async delete(){const n=Array.from(this.instances.values());await Promise.all([...n.filter(l=>"INTERNAL"in l).map(l=>l.INTERNAL.delete()),...n.filter(l=>"_delete"in l).map(l=>l._delete())])}isComponentSet(){return this.component!=null}isInitialized(n=t_){return this.instances.has(n)}getOptions(n=t_){return this.instancesOptions.get(n)||{}}initialize(n={}){const{options:l={}}=n,p=this.normalizeInstanceIdentifier(n.instanceIdentifier);if(this.isInitialized(p))throw Error(`${this.name}(${p}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const b=this.getOrInitializeService({instanceIdentifier:p,options:l});for(const[I,P]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(I);p===s&&P.resolve(b)}return b}onInit(n,l){const p=this.normalizeInstanceIdentifier(l),b=this.onInitCallbacks.get(p)??new Set;b.add(n),this.onInitCallbacks.set(p,b);const I=this.instances.get(p);return I&&n(I,p),()=>{b.delete(n)}}invokeOnInitCallbacks(n,l){const p=this.onInitCallbacks.get(l);if(p)for(const b of p)try{b(n,l)}catch{}}getOrInitializeService({instanceIdentifier:n,options:l={}}){let p=this.instances.get(n);if(!p&&this.component&&(p=this.component.instanceFactory(this.container,{instanceIdentifier:lV(n),options:l}),this.instances.set(n,p),this.instancesOptions.set(n,l),this.invokeOnInitCallbacks(p,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,p)}catch{}return p||null}normalizeInstanceIdentifier(n=t_){return this.component?this.component.multipleInstances?n:t_:n}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lV(c){return c===t_?void 0:c}function cV(c){return c.instantiationMode==="EAGER"}class uV{constructor(n){this.name=n,this.providers=new Map}addComponent(n){const l=this.getProvider(n.name);if(l.isComponentSet())throw new Error(`Component ${n.name} has already been registered with ${this.name}`);l.setComponent(n)}addOrOverwriteComponent(n){this.getProvider(n.name).isComponentSet()&&this.providers.delete(n.name),this.addComponent(n)}getProvider(n){if(this.providers.has(n))return this.providers.get(n);const l=new aV(n,this);return this.providers.set(n,l),l}getProviders(){return Array.from(this.providers.values())}}var ts;(function(c){c[c.DEBUG=0]="DEBUG",c[c.VERBOSE=1]="VERBOSE",c[c.INFO=2]="INFO",c[c.WARN=3]="WARN",c[c.ERROR=4]="ERROR",c[c.SILENT=5]="SILENT"})(ts||(ts={}));const hV={debug:ts.DEBUG,verbose:ts.VERBOSE,info:ts.INFO,warn:ts.WARN,error:ts.ERROR,silent:ts.SILENT},dV=ts.INFO,fV={[ts.DEBUG]:"log",[ts.VERBOSE]:"log",[ts.INFO]:"info",[ts.WARN]:"warn",[ts.ERROR]:"error"},pV=(c,n,...l)=>{if(n<c.logLevel)return;const p=new Date().toISOString(),b=fV[n];if(b)console[b](`[${p}]  ${c.name}:`,...l);else throw new Error(`Attempted to log a message with an invalid logType (value: ${n})`)};class x1{constructor(n){this.name=n,this._logLevel=dV,this._logHandler=pV,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(n){if(!(n in ts))throw new TypeError(`Invalid value "${n}" assigned to \`logLevel\``);this._logLevel=n}setLogLevel(n){this._logLevel=typeof n=="string"?hV[n]:n}get logHandler(){return this._logHandler}set logHandler(n){if(typeof n!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=n}get userLogHandler(){return this._userLogHandler}set userLogHandler(n){this._userLogHandler=n}debug(...n){this._userLogHandler&&this._userLogHandler(this,ts.DEBUG,...n),this._logHandler(this,ts.DEBUG,...n)}log(...n){this._userLogHandler&&this._userLogHandler(this,ts.VERBOSE,...n),this._logHandler(this,ts.VERBOSE,...n)}info(...n){this._userLogHandler&&this._userLogHandler(this,ts.INFO,...n),this._logHandler(this,ts.INFO,...n)}warn(...n){this._userLogHandler&&this._userLogHandler(this,ts.WARN,...n),this._logHandler(this,ts.WARN,...n)}error(...n){this._userLogHandler&&this._userLogHandler(this,ts.ERROR,...n),this._logHandler(this,ts.ERROR,...n)}}const mV=(c,n)=>n.some(l=>c instanceof l);let mC,gC;function gV(){return mC||(mC=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _V(){return gC||(gC=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jD=new WeakMap,VT=new WeakMap,GD=new WeakMap,mT=new WeakMap,HE=new WeakMap;function yV(c){const n=new Promise((l,p)=>{const b=()=>{c.removeEventListener("success",I),c.removeEventListener("error",P)},I=()=>{l(km(c.result)),b()},P=()=>{p(c.error),b()};c.addEventListener("success",I),c.addEventListener("error",P)});return n.then(l=>{l instanceof IDBCursor&&jD.set(l,c)}).catch(()=>{}),HE.set(n,c),n}function vV(c){if(VT.has(c))return;const n=new Promise((l,p)=>{const b=()=>{c.removeEventListener("complete",I),c.removeEventListener("error",P),c.removeEventListener("abort",P)},I=()=>{l(),b()},P=()=>{p(c.error||new DOMException("AbortError","AbortError")),b()};c.addEventListener("complete",I),c.addEventListener("error",P),c.addEventListener("abort",P)});VT.set(c,n)}let UT={get(c,n,l){if(c instanceof IDBTransaction){if(n==="done")return VT.get(c);if(n==="objectStoreNames")return c.objectStoreNames||GD.get(c);if(n==="store")return l.objectStoreNames[1]?void 0:l.objectStore(l.objectStoreNames[0])}return km(c[n])},set(c,n,l){return c[n]=l,!0},has(c,n){return c instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in c}};function xV(c){UT=c(UT)}function bV(c){return c===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(n,...l){const p=c.call(gT(this),n,...l);return GD.set(p,n.sort?n.sort():[n]),km(p)}:_V().includes(c)?function(...n){return c.apply(gT(this),n),km(jD.get(this))}:function(...n){return km(c.apply(gT(this),n))}}function wV(c){return typeof c=="function"?bV(c):(c instanceof IDBTransaction&&vV(c),mV(c,gV())?new Proxy(c,UT):c)}function km(c){if(c instanceof IDBRequest)return yV(c);if(mT.has(c))return mT.get(c);const n=wV(c);return n!==c&&(mT.set(c,n),HE.set(n,c)),n}const gT=c=>HE.get(c);function qD(c,n,{blocked:l,upgrade:p,blocking:b,terminated:I}={}){const P=indexedDB.open(c,n),s=km(P);return p&&P.addEventListener("upgradeneeded",G=>{p(km(P.result),G.oldVersion,G.newVersion,km(P.transaction),G)}),l&&P.addEventListener("blocked",G=>l(G.oldVersion,G.newVersion,G)),s.then(G=>{I&&G.addEventListener("close",()=>I()),b&&G.addEventListener("versionchange",q=>b(q.oldVersion,q.newVersion,q))}).catch(()=>{}),s}const TV=["get","getKey","getAll","getAllKeys","count"],EV=["put","add","delete","clear"],_T=new Map;function _C(c,n){if(!(c instanceof IDBDatabase&&!(n in c)&&typeof n=="string"))return;if(_T.get(n))return _T.get(n);const l=n.replace(/FromIndex$/,""),p=n!==l,b=EV.includes(l);if(!(l in(p?IDBIndex:IDBObjectStore).prototype)||!(b||TV.includes(l)))return;const I=async function(P,...s){const G=this.transaction(P,b?"readwrite":"readonly");let q=G.store;return p&&(q=q.index(s.shift())),(await Promise.all([q[l](...s),b&&G.done]))[0]};return _T.set(n,I),I}xV(c=>({...c,get:(n,l,p)=>_C(n,l)||c.get(n,l,p),has:(n,l)=>!!_C(n,l)||c.has(n,l)}));class SV{constructor(n){this.container=n}getPlatformInfoString(){return this.container.getProviders().map(l=>{if(AV(l)){const p=l.getImmediate();return`${p.library}/${p.version}`}else return null}).filter(l=>l).join(" ")}}function AV(c){return c.getComponent()?.type==="VERSION"}const jT="@firebase/app",yC="0.14.6";const dp=new x1("@firebase/app"),IV="@firebase/app-compat",CV="@firebase/analytics-compat",RV="@firebase/analytics",MV="@firebase/app-check-compat",DV="@firebase/app-check",PV="@firebase/auth",OV="@firebase/auth-compat",LV="@firebase/database",zV="@firebase/data-connect",kV="@firebase/database-compat",FV="@firebase/functions",BV="@firebase/functions-compat",NV="@firebase/installations",VV="@firebase/installations-compat",UV="@firebase/messaging",jV="@firebase/messaging-compat",GV="@firebase/performance",qV="@firebase/performance-compat",HV="@firebase/remote-config",$V="@firebase/remote-config-compat",WV="@firebase/storage",ZV="@firebase/storage-compat",XV="@firebase/firestore",KV="@firebase/ai",YV="@firebase/firestore-compat",QV="firebase",JV="12.6.0";const GT="[DEFAULT]",e5={[jT]:"fire-core",[IV]:"fire-core-compat",[RV]:"fire-analytics",[CV]:"fire-analytics-compat",[DV]:"fire-app-check",[MV]:"fire-app-check-compat",[PV]:"fire-auth",[OV]:"fire-auth-compat",[LV]:"fire-rtdb",[zV]:"fire-data-connect",[kV]:"fire-rtdb-compat",[FV]:"fire-fn",[BV]:"fire-fn-compat",[NV]:"fire-iid",[VV]:"fire-iid-compat",[UV]:"fire-fcm",[jV]:"fire-fcm-compat",[GV]:"fire-perf",[qV]:"fire-perf-compat",[HV]:"fire-rc",[$V]:"fire-rc-compat",[WV]:"fire-gcs",[ZV]:"fire-gcs-compat",[XV]:"fire-fst",[YV]:"fire-fst-compat",[KV]:"fire-vertex","fire-js":"fire-js",[QV]:"fire-js-all"};const qb=new Map,t5=new Map,qT=new Map;function vC(c,n){try{c.container.addComponent(n)}catch(l){dp.debug(`Component ${n.name} failed to register with FirebaseApp ${c.name}`,l)}}function nd(c){const n=c.name;if(qT.has(n))return dp.debug(`There were multiple attempts to register component ${n}.`),!1;qT.set(n,c);for(const l of qb.values())vC(l,c);for(const l of t5.values())vC(l,c);return!0}function Qy(c,n){const l=c.container.getProvider("heartbeat").getImmediate({optional:!0});return l&&l.triggerHeartbeat(),c.container.getProvider(n)}function pu(c){return c==null?!1:c.settings!==void 0}const i5={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Fm=new __("app","Firebase",i5);class n5{constructor(n,l,p){this._isDeleted=!1,this._options={...n},this._config={...l},this._name=l.name,this._automaticDataCollectionEnabled=l.automaticDataCollectionEnabled,this._container=p,this.container.addComponent(new eh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(n){this.checkDestroyed(),this._automaticDataCollectionEnabled=n}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(n){this._isDeleted=n}checkDestroyed(){if(this.isDeleted)throw Fm.create("app-deleted",{appName:this._name})}}const y_=JV;function HD(c,n={}){let l=c;typeof n!="object"&&(n={name:n});const p={name:GT,automaticDataCollectionEnabled:!0,...n},b=p.name;if(typeof b!="string"||!b)throw Fm.create("bad-app-name",{appName:String(b)});if(l||(l=kD()),!l)throw Fm.create("no-options");const I=qb.get(b);if(I){if(hp(l,I.options)&&hp(p,I.config))return I;throw Fm.create("duplicate-app",{appName:b})}const P=new uV(b);for(const G of qT.values())P.addComponent(G);const s=new n5(l,p,P);return qb.set(b,s),s}function $E(c=GT){const n=qb.get(c);if(!n&&c===GT&&kD())return HD();if(!n)throw Fm.create("no-app",{appName:c});return n}function Bc(c,n,l){let p=e5[c]??c;l&&(p+=`-${l}`);const b=p.match(/\s|\//),I=n.match(/\s|\//);if(b||I){const P=[`Unable to register library "${p}" with version "${n}":`];b&&P.push(`library name "${p}" contains illegal characters (whitespace or "/")`),b&&I&&P.push("and"),I&&P.push(`version name "${n}" contains illegal characters (whitespace or "/")`),dp.warn(P.join(" "));return}nd(new eh(`${p}-version`,()=>({library:p,version:n}),"VERSION"))}const r5="firebase-heartbeat-database",s5=1,M0="firebase-heartbeat-store";let yT=null;function $D(){return yT||(yT=qD(r5,s5,{upgrade:(c,n)=>{switch(n){case 0:try{c.createObjectStore(M0)}catch(l){console.warn(l)}}}}).catch(c=>{throw Fm.create("idb-open",{originalErrorMessage:c.message})})),yT}async function o5(c){try{const l=(await $D()).transaction(M0),p=await l.objectStore(M0).get(WD(c));return await l.done,p}catch(n){if(n instanceof th)dp.warn(n.message);else{const l=Fm.create("idb-get",{originalErrorMessage:n?.message});dp.warn(l.message)}}}async function xC(c,n){try{const p=(await $D()).transaction(M0,"readwrite");await p.objectStore(M0).put(n,WD(c)),await p.done}catch(l){if(l instanceof th)dp.warn(l.message);else{const p=Fm.create("idb-set",{originalErrorMessage:l?.message});dp.warn(p.message)}}}function WD(c){return`${c.name}!${c.options.appId}`}const a5=1024,l5=30;class c5{constructor(n){this.container=n,this._heartbeatsCache=null;const l=this.container.getProvider("app").getImmediate();this._storage=new h5(l),this._heartbeatsCachePromise=this._storage.read().then(p=>(this._heartbeatsCache=p,p))}async triggerHeartbeat(){try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),p=bC();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===p||this._heartbeatsCache.heartbeats.some(b=>b.date===p))return;if(this._heartbeatsCache.heartbeats.push({date:p,agent:l}),this._heartbeatsCache.heartbeats.length>l5){const b=d5(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(b,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){dp.warn(n)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=bC(),{heartbeatsToSend:l,unsentEntries:p}=u5(this._heartbeatsCache.heartbeats),b=Gb(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=n,p.length>0?(this._heartbeatsCache.heartbeats=p,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),b}catch(n){return dp.warn(n),""}}}function bC(){return new Date().toISOString().substring(0,10)}function u5(c,n=a5){const l=[];let p=c.slice();for(const b of c){const I=l.find(P=>P.agent===b.agent);if(I){if(I.dates.push(b.date),wC(l)>n){I.dates.pop();break}}else if(l.push({agent:b.agent,dates:[b.date]}),wC(l)>n){l.pop();break}p=p.slice(1)}return{heartbeatsToSend:l,unsentEntries:p}}class h5{constructor(n){this.app=n,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return VD()?UD().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const l=await o5(this.app);return l?.heartbeats?l:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(n){if(await this._canUseIndexedDBPromise){const p=await this.read();return xC(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??p.lastSentHeartbeatDate,heartbeats:n.heartbeats})}else return}async add(n){if(await this._canUseIndexedDBPromise){const p=await this.read();return xC(this.app,{lastSentHeartbeatDate:n.lastSentHeartbeatDate??p.lastSentHeartbeatDate,heartbeats:[...p.heartbeats,...n.heartbeats]})}else return}}function wC(c){return Gb(JSON.stringify({version:2,heartbeats:c})).length}function d5(c){if(c.length===0)return-1;let n=0,l=c[0].date;for(let p=1;p<c.length;p++)c[p].date<l&&(l=c[p].date,n=p);return n}function f5(c){nd(new eh("platform-logger",n=>new SV(n),"PRIVATE")),nd(new eh("heartbeat",n=>new c5(n),"PRIVATE")),Bc(jT,yC,c),Bc(jT,yC,"esm2020"),Bc("fire-js","")}f5("");var p5="firebase",m5="12.6.0";Bc(p5,m5,"app");const ZD="@firebase/installations",WE="0.6.19";const XD=1e4,KD=`w:${WE}`,YD="FIS_v2",g5="https://firebaseinstallations.googleapis.com/v1",_5=3600*1e3,y5="installations",v5="Installations";const x5={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},l_=new __(y5,v5,x5);function QD(c){return c instanceof th&&c.code.includes("request-failed")}function JD({projectId:c}){return`${g5}/projects/${c}/installations`}function eP(c){return{token:c.token,requestStatus:2,expiresIn:w5(c.expiresIn),creationTime:Date.now()}}async function tP(c,n){const p=(await n.json()).error;return l_.create("request-failed",{requestName:c,serverCode:p.code,serverMessage:p.message,serverStatus:p.status})}function iP({apiKey:c}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":c})}function b5(c,{refreshToken:n}){const l=iP(c);return l.append("Authorization",T5(n)),l}async function nP(c){const n=await c();return n.status>=500&&n.status<600?c():n}function w5(c){return Number(c.replace("s","000"))}function T5(c){return`${YD} ${c}`}async function E5({appConfig:c,heartbeatServiceProvider:n},{fid:l}){const p=JD(c),b=iP(c),I=n.getImmediate({optional:!0});if(I){const q=await I.getHeartbeatsHeader();q&&b.append("x-firebase-client",q)}const P={fid:l,authVersion:YD,appId:c.appId,sdkVersion:KD},s={method:"POST",headers:b,body:JSON.stringify(P)},G=await nP(()=>fetch(p,s));if(G.ok){const q=await G.json();return{fid:q.fid||l,registrationStatus:2,refreshToken:q.refreshToken,authToken:eP(q.authToken)}}else throw await tP("Create Installation",G)}function rP(c){return new Promise(n=>{setTimeout(n,c)})}function S5(c){return btoa(String.fromCharCode(...c)).replace(/\+/g,"-").replace(/\//g,"_")}const A5=/^[cdef][\w-]{21}$/,HT="";function I5(){try{const c=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(c),c[0]=112+c[0]%16;const l=C5(c);return A5.test(l)?l:HT}catch{return HT}}function C5(c){return S5(c).substr(0,22)}function b1(c){return`${c.appName}!${c.appId}`}const sP=new Map;function oP(c,n){const l=b1(c);aP(l,n),R5(l,n)}function aP(c,n){const l=sP.get(c);if(l)for(const p of l)p(n)}function R5(c,n){const l=M5();l&&l.postMessage({key:c,fid:n}),D5()}let n_=null;function M5(){return!n_&&"BroadcastChannel"in self&&(n_=new BroadcastChannel("[Firebase] FID Change"),n_.onmessage=c=>{aP(c.data.key,c.data.fid)}),n_}function D5(){sP.size===0&&n_&&(n_.close(),n_=null)}const P5="firebase-installations-database",O5=1,c_="firebase-installations-store";let vT=null;function ZE(){return vT||(vT=qD(P5,O5,{upgrade:(c,n)=>{switch(n){case 0:c.createObjectStore(c_)}}})),vT}async function Hb(c,n){const l=b1(c),b=(await ZE()).transaction(c_,"readwrite"),I=b.objectStore(c_),P=await I.get(l);return await I.put(n,l),await b.done,(!P||P.fid!==n.fid)&&oP(c,n.fid),n}async function lP(c){const n=b1(c),p=(await ZE()).transaction(c_,"readwrite");await p.objectStore(c_).delete(n),await p.done}async function w1(c,n){const l=b1(c),b=(await ZE()).transaction(c_,"readwrite"),I=b.objectStore(c_),P=await I.get(l),s=n(P);return s===void 0?await I.delete(l):await I.put(s,l),await b.done,s&&(!P||P.fid!==s.fid)&&oP(c,s.fid),s}async function XE(c){let n;const l=await w1(c.appConfig,p=>{const b=L5(p),I=z5(c,b);return n=I.registrationPromise,I.installationEntry});return l.fid===HT?{installationEntry:await n}:{installationEntry:l,registrationPromise:n}}function L5(c){const n=c||{fid:I5(),registrationStatus:0};return cP(n)}function z5(c,n){if(n.registrationStatus===0){if(!navigator.onLine){const b=Promise.reject(l_.create("app-offline"));return{installationEntry:n,registrationPromise:b}}const l={fid:n.fid,registrationStatus:1,registrationTime:Date.now()},p=k5(c,l);return{installationEntry:l,registrationPromise:p}}else return n.registrationStatus===1?{installationEntry:n,registrationPromise:F5(c)}:{installationEntry:n}}async function k5(c,n){try{const l=await E5(c,n);return Hb(c.appConfig,l)}catch(l){throw QD(l)&&l.customData.serverCode===409?await lP(c.appConfig):await Hb(c.appConfig,{fid:n.fid,registrationStatus:0}),l}}async function F5(c){let n=await TC(c.appConfig);for(;n.registrationStatus===1;)await rP(100),n=await TC(c.appConfig);if(n.registrationStatus===0){const{installationEntry:l,registrationPromise:p}=await XE(c);return p||l}return n}function TC(c){return w1(c,n=>{if(!n)throw l_.create("installation-not-found");return cP(n)})}function cP(c){return B5(c)?{fid:c.fid,registrationStatus:0}:c}function B5(c){return c.registrationStatus===1&&c.registrationTime+XD<Date.now()}async function N5({appConfig:c,heartbeatServiceProvider:n},l){const p=V5(c,l),b=b5(c,l),I=n.getImmediate({optional:!0});if(I){const q=await I.getHeartbeatsHeader();q&&b.append("x-firebase-client",q)}const P={installation:{sdkVersion:KD,appId:c.appId}},s={method:"POST",headers:b,body:JSON.stringify(P)},G=await nP(()=>fetch(p,s));if(G.ok){const q=await G.json();return eP(q)}else throw await tP("Generate Auth Token",G)}function V5(c,{fid:n}){return`${JD(c)}/${n}/authTokens:generate`}async function KE(c,n=!1){let l;const p=await w1(c.appConfig,I=>{if(!uP(I))throw l_.create("not-registered");const P=I.authToken;if(!n&&G5(P))return I;if(P.requestStatus===1)return l=U5(c,n),I;{if(!navigator.onLine)throw l_.create("app-offline");const s=H5(I);return l=j5(c,s),s}});return l?await l:p.authToken}async function U5(c,n){let l=await EC(c.appConfig);for(;l.authToken.requestStatus===1;)await rP(100),l=await EC(c.appConfig);const p=l.authToken;return p.requestStatus===0?KE(c,n):p}function EC(c){return w1(c,n=>{if(!uP(n))throw l_.create("not-registered");const l=n.authToken;return $5(l)?{...n,authToken:{requestStatus:0}}:n})}async function j5(c,n){try{const l=await N5(c,n),p={...n,authToken:l};return await Hb(c.appConfig,p),l}catch(l){if(QD(l)&&(l.customData.serverCode===401||l.customData.serverCode===404))await lP(c.appConfig);else{const p={...n,authToken:{requestStatus:0}};await Hb(c.appConfig,p)}throw l}}function uP(c){return c!==void 0&&c.registrationStatus===2}function G5(c){return c.requestStatus===2&&!q5(c)}function q5(c){const n=Date.now();return n<c.creationTime||c.creationTime+c.expiresIn<n+_5}function H5(c){const n={requestStatus:1,requestTime:Date.now()};return{...c,authToken:n}}function $5(c){return c.requestStatus===1&&c.requestTime+XD<Date.now()}async function W5(c){const n=c,{installationEntry:l,registrationPromise:p}=await XE(n);return p?p.catch(console.error):KE(n).catch(console.error),l.fid}async function Z5(c,n=!1){const l=c;return await X5(l),(await KE(l,n)).token}async function X5(c){const{registrationPromise:n}=await XE(c);n&&await n}function K5(c){if(!c||!c.options)throw xT("App Configuration");if(!c.name)throw xT("App Name");const n=["projectId","apiKey","appId"];for(const l of n)if(!c.options[l])throw xT(l);return{appName:c.name,projectId:c.options.projectId,apiKey:c.options.apiKey,appId:c.options.appId}}function xT(c){return l_.create("missing-app-config-values",{valueName:c})}const hP="installations",Y5="installations-internal",Q5=c=>{const n=c.getProvider("app").getImmediate(),l=K5(n),p=Qy(n,"heartbeat");return{app:n,appConfig:l,heartbeatServiceProvider:p,_delete:()=>Promise.resolve()}},J5=c=>{const n=c.getProvider("app").getImmediate(),l=Qy(n,hP).getImmediate();return{getId:()=>W5(l),getToken:b=>Z5(l,b)}};function eU(){nd(new eh(hP,Q5,"PUBLIC")),nd(new eh(Y5,J5,"PRIVATE"))}eU();Bc(ZD,WE);Bc(ZD,WE,"esm2020");const SC="analytics",tU="firebase_id",iU="origin",nU=60*1e3,rU="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",YE="https://www.googletagmanager.com/gtag/js";const oc=new x1("@firebase/analytics");const sU={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Qu=new __("analytics","Analytics",sU);function oU(c){if(!c.startsWith(YE)){const n=Qu.create("invalid-gtag-resource",{gtagURL:c});return oc.warn(n.message),""}return c}function dP(c){return Promise.all(c.map(n=>n.catch(l=>l)))}function aU(c,n){let l;return window.trustedTypes&&(l=window.trustedTypes.createPolicy(c,n)),l}function lU(c,n){const l=aU("firebase-js-sdk-policy",{createScriptURL:oU}),p=document.createElement("script"),b=`${YE}?l=${c}&id=${n}`;p.src=l?l?.createScriptURL(b):b,p.async=!0,document.head.appendChild(p)}function cU(c){let n=[];return Array.isArray(window[c])?n=window[c]:window[c]=n,n}async function uU(c,n,l,p,b,I){const P=p[b];try{if(P)await n[P];else{const G=(await dP(l)).find(q=>q.measurementId===b);G&&await n[G.appId]}}catch(s){oc.error(s)}c("config",b,I)}async function hU(c,n,l,p,b){try{let I=[];if(b&&b.send_to){let P=b.send_to;Array.isArray(P)||(P=[P]);const s=await dP(l);for(const G of P){const q=s.find(ce=>ce.measurementId===G),ie=q&&n[q.appId];if(ie)I.push(ie);else{I=[];break}}}I.length===0&&(I=Object.values(n)),await Promise.all(I),c("event",p,b||{})}catch(I){oc.error(I)}}function dU(c,n,l,p){async function b(I,...P){try{if(I==="event"){const[s,G]=P;await hU(c,n,l,s,G)}else if(I==="config"){const[s,G]=P;await uU(c,n,l,p,s,G)}else if(I==="consent"){const[s,G]=P;c("consent",s,G)}else if(I==="get"){const[s,G,q]=P;c("get",s,G,q)}else if(I==="set"){const[s]=P;c("set",s)}else c(I,...P)}catch(s){oc.error(s)}}return b}function fU(c,n,l,p,b){let I=function(...P){window[p].push(arguments)};return window[b]&&typeof window[b]=="function"&&(I=window[b]),window[b]=dU(I,c,n,l),{gtagCore:I,wrappedGtag:window[b]}}function pU(c){const n=window.document.getElementsByTagName("script");for(const l of Object.values(n))if(l.src&&l.src.includes(YE)&&l.src.includes(c))return l;return null}const mU=30,gU=1e3;class _U{constructor(n={},l=gU){this.throttleMetadata=n,this.intervalMillis=l}getThrottleMetadata(n){return this.throttleMetadata[n]}setThrottleMetadata(n,l){this.throttleMetadata[n]=l}deleteThrottleMetadata(n){delete this.throttleMetadata[n]}}const fP=new _U;function yU(c){return new Headers({Accept:"application/json","x-goog-api-key":c})}async function vU(c){const{appId:n,apiKey:l}=c,p={method:"GET",headers:yU(l)},b=rU.replace("{app-id}",n),I=await fetch(b,p);if(I.status!==200&&I.status!==304){let P="";try{const s=await I.json();s.error?.message&&(P=s.error.message)}catch{}throw Qu.create("config-fetch-failed",{httpStatus:I.status,responseMessage:P})}return I.json()}async function xU(c,n=fP,l){const{appId:p,apiKey:b,measurementId:I}=c.options;if(!p)throw Qu.create("no-app-id");if(!b){if(I)return{measurementId:I,appId:p};throw Qu.create("no-api-key")}const P=n.getThrottleMetadata(p)||{backoffCount:0,throttleEndTimeMillis:Date.now()},s=new TU;return setTimeout(async()=>{s.abort()},nU),pP({appId:p,apiKey:b,measurementId:I},P,s,n)}async function pP(c,{throttleEndTimeMillis:n,backoffCount:l},p,b=fP){const{appId:I,measurementId:P}=c;try{await bU(p,n)}catch(s){if(P)return oc.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${P} provided in the "measurementId" field in the local Firebase config. [${s?.message}]`),{appId:I,measurementId:P};throw s}try{const s=await vU(c);return b.deleteThrottleMetadata(I),s}catch(s){const G=s;if(!wU(G)){if(b.deleteThrottleMetadata(I),P)return oc.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${P} provided in the "measurementId" field in the local Firebase config. [${G?.message}]`),{appId:I,measurementId:P};throw s}const q=Number(G?.customData?.httpStatus)===503?pC(l,b.intervalMillis,mU):pC(l,b.intervalMillis),ie={throttleEndTimeMillis:Date.now()+q,backoffCount:l+1};return b.setThrottleMetadata(I,ie),oc.debug(`Calling attemptFetch again in ${q} millis`),pP(c,ie,p,b)}}function bU(c,n){return new Promise((l,p)=>{const b=Math.max(n-Date.now(),0),I=setTimeout(l,b);c.addEventListener(()=>{clearTimeout(I),p(Qu.create("fetch-throttle",{throttleEndTimeMillis:n}))})})}function wU(c){if(!(c instanceof th)||!c.customData)return!1;const n=Number(c.customData.httpStatus);return n===429||n===500||n===503||n===504}class TU{constructor(){this.listeners=[]}addEventListener(n){this.listeners.push(n)}abort(){this.listeners.forEach(n=>n())}}async function EU(c,n,l,p,b){if(b&&b.global){c("event",l,p);return}else{const I=await n,P={...p,send_to:I};c("event",l,P)}}async function SU(c,n,l,p){if(p&&p.global){const b={};for(const I of Object.keys(l))b[`user_properties.${I}`]=l[I];return c("set",b),Promise.resolve()}else{const b=await n;c("config",b,{update:!0,user_properties:l})}}async function AU(){if(VD())try{await UD()}catch(c){return oc.warn(Qu.create("indexeddb-unavailable",{errorInfo:c?.toString()}).message),!1}else return oc.warn(Qu.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function IU(c,n,l,p,b,I,P){const s=xU(c);s.then(be=>{l[be.measurementId]=be.appId,c.options.measurementId&&be.measurementId!==c.options.measurementId&&oc.warn(`The measurement ID in the local Firebase config (${c.options.measurementId}) does not match the measurement ID fetched from the server (${be.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(be=>oc.error(be)),n.push(s);const G=AU().then(be=>{if(be)return p.getId()}),[q,ie]=await Promise.all([s,G]);pU(I)||lU(I,q.measurementId),b("js",new Date);const ce=P?.config??{};return ce[iU]="firebase",ce.update=!0,ie!=null&&(ce[tU]=ie),b("config",q.measurementId,ce),q.measurementId}class CU{constructor(n){this.app=n}_delete(){return delete Dy[this.app.options.appId],Promise.resolve()}}let Dy={},AC=[];const IC={};let bT="dataLayer",RU="gtag",CC,QE,RC=!1;function MU(){const c=[];if(ND()&&c.push("This is a browser extension environment."),X4()||c.push("Cookies are not available."),c.length>0){const n=c.map((p,b)=>`(${b+1}) ${p}`).join(" "),l=Qu.create("invalid-analytics-context",{errorInfo:n});oc.warn(l.message)}}function DU(c,n,l){MU();const p=c.options.appId;if(!p)throw Qu.create("no-app-id");if(!c.options.apiKey)if(c.options.measurementId)oc.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${c.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Qu.create("no-api-key");if(Dy[p]!=null)throw Qu.create("already-exists",{id:p});if(!RC){cU(bT);const{wrappedGtag:I,gtagCore:P}=fU(Dy,AC,IC,bT,RU);QE=I,CC=P,RC=!0}return Dy[p]=IU(c,AC,IC,n,CC,bT,l),new CU(c)}function PU(c,n,l){c=xo(c),SU(QE,Dy[c.app.options.appId],n,l).catch(p=>oc.error(p))}function OU(c,n,l,p){c=xo(c),EU(QE,Dy[c.app.options.appId],n,l,p).catch(b=>oc.error(b))}const MC="@firebase/analytics",DC="0.10.19";function LU(){nd(new eh(SC,(n,{options:l})=>{const p=n.getProvider("app").getImmediate(),b=n.getProvider("installations-internal").getImmediate();return DU(p,b,l)},"PUBLIC")),nd(new eh("analytics-internal",c,"PRIVATE")),Bc(MC,DC),Bc(MC,DC,"esm2020");function c(n){try{const l=n.getProvider(SC).getImmediate();return{logEvent:(p,b,I)=>OU(l,p,b,I),setUserProperties:(p,b)=>PU(l,p,b)}}catch(l){throw Qu.create("interop-component-reg-failed",{reason:l})}}}LU();function mP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const zU=mP,gP=new __("auth","Firebase",mP());const $b=new x1("@firebase/auth");function kU(c,...n){$b.logLevel<=ts.WARN&&$b.warn(`Auth (${y_}): ${c}`,...n)}function Cb(c,...n){$b.logLevel<=ts.ERROR&&$b.error(`Auth (${y_}): ${c}`,...n)}function rd(c,...n){throw JE(c,...n)}function Qd(c,...n){return JE(c,...n)}function _P(c,n,l){const p={...zU(),[n]:l};return new __("auth","Firebase",p).create(n,{appName:c.name})}function ap(c){return _P(c,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function JE(c,...n){if(typeof c!="string"){const l=n[0],p=[...n.slice(1)];return p[0]&&(p[0].appName=c.name),c._errorFactory.create(l,...p)}return gP.create(c,...n)}function tr(c,n,...l){if(!c)throw JE(n,...l)}function np(c){const n="INTERNAL ASSERTION FAILED: "+c;throw Cb(n),new Error(n)}function fp(c,n){c||np(n)}function $T(){return typeof self<"u"&&self.location?.href||""}function FU(){return PC()==="http:"||PC()==="https:"}function PC(){return typeof self<"u"&&self.location?.protocol||null}function BU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(FU()||ND()||"connection"in navigator)?navigator.onLine:!0}function NU(){if(typeof navigator>"u")return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}class W0{constructor(n,l){this.shortDelay=n,this.longDelay=l,fp(l>n,"Short delay should be less than long delay!"),this.isMobile=G4()||$4()}get(){return BU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function eS(c,n){fp(c.emulator,"Emulator should always be set here");const{url:l}=c.emulator;return n?`${l}${n.startsWith("/")?n.slice(1):n}`:l}class yP{static initialize(n,l,p){this.fetchImpl=n,l&&(this.headersImpl=l),p&&(this.responseImpl=p)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;np("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;np("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;np("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const VU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const UU=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],jU=new W0(3e4,6e4);function _p(c,n){return c.tenantId&&!n.tenantId?{...n,tenantId:c.tenantId}:n}async function yp(c,n,l,p,b={}){return vP(c,b,async()=>{let I={},P={};p&&(n==="GET"?P=p:I={body:JSON.stringify(p)});const s=$0({key:c.config.apiKey,...P}).slice(1),G=await c._getAdditionalHeaders();G["Content-Type"]="application/json",c.languageCode&&(G["X-Firebase-Locale"]=c.languageCode);const q={method:n,headers:G,...I};return H4()||(q.referrerPolicy="no-referrer"),c.emulatorConfig&&Km(c.emulatorConfig.host)&&(q.credentials="include"),yP.fetch()(await xP(c,c.config.apiHost,l,s),q)})}async function vP(c,n,l){c._canInitEmulator=!1;const p={...VU,...n};try{const b=new qU(c),I=await Promise.race([l(),b.promise]);b.clearNetworkTimeout();const P=await I.json();if("needConfirmation"in P)throw yb(c,"account-exists-with-different-credential",P);if(I.ok&&!("errorMessage"in P))return P;{const s=I.ok?P.errorMessage:P.error.message,[G,q]=s.split(" : ");if(G==="FEDERATED_USER_ID_ALREADY_LINKED")throw yb(c,"credential-already-in-use",P);if(G==="EMAIL_EXISTS")throw yb(c,"email-already-in-use",P);if(G==="USER_DISABLED")throw yb(c,"user-disabled",P);const ie=p[G]||G.toLowerCase().replace(/[_\s]+/g,"-");if(q)throw _P(c,ie,q);rd(c,ie)}}catch(b){if(b instanceof th)throw b;rd(c,"network-request-failed",{message:String(b)})}}async function Z0(c,n,l,p,b={}){const I=await yp(c,n,l,p,b);return"mfaPendingCredential"in I&&rd(c,"multi-factor-auth-required",{_serverResponse:I}),I}async function xP(c,n,l,p){const b=`${n}${l}?${p}`,I=c,P=I.config.emulator?eS(c.config,b):`${c.config.apiScheme}://${b}`;return UU.includes(l)&&(await I._persistenceManagerAvailable,I._getPersistenceType()==="COOKIE")?I._getPersistence()._getFinalTarget(P).toString():P}function GU(c){switch(c){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class qU{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(n){this.auth=n,this.timer=null,this.promise=new Promise((l,p)=>{this.timer=setTimeout(()=>p(Qd(this.auth,"network-request-failed")),jU.get())})}}function yb(c,n,l){const p={appName:c.name};l.email&&(p.email=l.email),l.phoneNumber&&(p.phoneNumber=l.phoneNumber);const b=Qd(c,n,p);return b.customData._tokenResponse=l,b}function OC(c){return c!==void 0&&c.enterprise!==void 0}class HU{constructor(n){if(this.siteKey="",this.recaptchaEnforcementState=[],n.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=n.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=n.recaptchaEnforcementState}getProviderEnforcementState(n){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const l of this.recaptchaEnforcementState)if(l.provider&&l.provider===n)return GU(l.enforcementState);return null}isProviderEnabled(n){return this.getProviderEnforcementState(n)==="ENFORCE"||this.getProviderEnforcementState(n)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function $U(c,n){return yp(c,"GET","/v2/recaptchaConfig",_p(c,n))}async function WU(c,n){return yp(c,"POST","/v1/accounts:delete",n)}async function Wb(c,n){return yp(c,"POST","/v1/accounts:lookup",n)}function w0(c){if(c)try{const n=new Date(Number(c));if(!isNaN(n.getTime()))return n.toUTCString()}catch{}}async function ZU(c,n=!1){const l=xo(c),p=await l.getIdToken(n),b=tS(p);tr(b&&b.exp&&b.auth_time&&b.iat,l.auth,"internal-error");const I=typeof b.firebase=="object"?b.firebase:void 0,P=I?.sign_in_provider;return{claims:b,token:p,authTime:w0(wT(b.auth_time)),issuedAtTime:w0(wT(b.iat)),expirationTime:w0(wT(b.exp)),signInProvider:P||null,signInSecondFactor:I?.sign_in_second_factor||null}}function wT(c){return Number(c)*1e3}function tS(c){const[n,l,p]=c.split(".");if(n===void 0||l===void 0||p===void 0)return Cb("JWT malformed, contained fewer than 3 sections"),null;try{const b=OD(l);return b?JSON.parse(b):(Cb("Failed to decode base64 JWT payload"),null)}catch(b){return Cb("Caught error parsing JWT payload as JSON",b?.toString()),null}}function LC(c){const n=tS(c);return tr(n,"internal-error"),tr(typeof n.exp<"u","internal-error"),tr(typeof n.iat<"u","internal-error"),Number(n.exp)-Number(n.iat)}async function D0(c,n,l=!1){if(l)return n;try{return await n}catch(p){throw p instanceof th&&XU(p)&&c.auth.currentUser===c&&await c.auth.signOut(),p}}function XU({code:c}){return c==="auth/user-disabled"||c==="auth/user-token-expired"}class KU{constructor(n){this.user=n,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(n){if(n){const l=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),l}else{this.errorBackoff=3e4;const p=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,p)}}schedule(n=!1){if(!this.isRunning)return;const l=this.getInterval(n);this.timerId=setTimeout(async()=>{await this.iteration()},l)}async iteration(){try{await this.user.getIdToken(!0)}catch(n){n?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class WT{constructor(n,l){this.createdAt=n,this.lastLoginAt=l,this._initializeTime()}_initializeTime(){this.lastSignInTime=w0(this.lastLoginAt),this.creationTime=w0(this.createdAt)}_copy(n){this.createdAt=n.createdAt,this.lastLoginAt=n.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Zb(c){const n=c.auth,l=await c.getIdToken(),p=await D0(c,Wb(n,{idToken:l}));tr(p?.users.length,n,"internal-error");const b=p.users[0];c._notifyReloadListener(b);const I=b.providerUserInfo?.length?bP(b.providerUserInfo):[],P=QU(c.providerData,I),s=c.isAnonymous,G=!(c.email&&b.passwordHash)&&!P?.length,q=s?G:!1,ie={uid:b.localId,displayName:b.displayName||null,photoURL:b.photoUrl||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,tenantId:b.tenantId||null,providerData:P,metadata:new WT(b.createdAt,b.lastLoginAt),isAnonymous:q};Object.assign(c,ie)}async function YU(c){const n=xo(c);await Zb(n),await n.auth._persistUserIfCurrent(n),n.auth._notifyListenersIfCurrent(n)}function QU(c,n){return[...c.filter(p=>!n.some(b=>b.providerId===p.providerId)),...n]}function bP(c){return c.map(({providerId:n,...l})=>({providerId:n,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}))}async function JU(c,n){const l=await vP(c,{},async()=>{const p=$0({grant_type:"refresh_token",refresh_token:n}).slice(1),{tokenApiHost:b,apiKey:I}=c.config,P=await xP(c,b,"/v1/token",`key=${I}`),s=await c._getAdditionalHeaders();s["Content-Type"]="application/x-www-form-urlencoded";const G={method:"POST",headers:s,body:p};return c.emulatorConfig&&Km(c.emulatorConfig.host)&&(G.credentials="include"),yP.fetch()(P,G)});return{accessToken:l.access_token,expiresIn:l.expires_in,refreshToken:l.refresh_token}}async function e6(c,n){return yp(c,"POST","/v2/accounts:revokeToken",_p(c,n))}class Py{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(n){tr(n.idToken,"internal-error"),tr(typeof n.idToken<"u","internal-error"),tr(typeof n.refreshToken<"u","internal-error");const l="expiresIn"in n&&typeof n.expiresIn<"u"?Number(n.expiresIn):LC(n.idToken);this.updateTokensAndExpiration(n.idToken,n.refreshToken,l)}updateFromIdToken(n){tr(n.length!==0,"internal-error");const l=LC(n);this.updateTokensAndExpiration(n,null,l)}async getToken(n,l=!1){return!l&&this.accessToken&&!this.isExpired?this.accessToken:(tr(this.refreshToken,n,"user-token-expired"),this.refreshToken?(await this.refresh(n,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(n,l){const{accessToken:p,refreshToken:b,expiresIn:I}=await JU(n,l);this.updateTokensAndExpiration(p,b,Number(I))}updateTokensAndExpiration(n,l,p){this.refreshToken=l||null,this.accessToken=n||null,this.expirationTime=Date.now()+p*1e3}static fromJSON(n,l){const{refreshToken:p,accessToken:b,expirationTime:I}=l,P=new Py;return p&&(tr(typeof p=="string","internal-error",{appName:n}),P.refreshToken=p),b&&(tr(typeof b=="string","internal-error",{appName:n}),P.accessToken=b),I&&(tr(typeof I=="number","internal-error",{appName:n}),P.expirationTime=I),P}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(n){this.accessToken=n.accessToken,this.refreshToken=n.refreshToken,this.expirationTime=n.expirationTime}_clone(){return Object.assign(new Py,this.toJSON())}_performRefresh(){return np("not implemented")}}function Cm(c,n){tr(typeof c=="string"||typeof c>"u","internal-error",{appName:n})}class ed{constructor({uid:n,auth:l,stsTokenManager:p,...b}){this.providerId="firebase",this.proactiveRefresh=new KU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=l,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=b.displayName||null,this.email=b.email||null,this.emailVerified=b.emailVerified||!1,this.phoneNumber=b.phoneNumber||null,this.photoURL=b.photoURL||null,this.isAnonymous=b.isAnonymous||!1,this.tenantId=b.tenantId||null,this.providerData=b.providerData?[...b.providerData]:[],this.metadata=new WT(b.createdAt||void 0,b.lastLoginAt||void 0)}async getIdToken(n){const l=await D0(this,this.stsTokenManager.getToken(this.auth,n));return tr(l,this.auth,"internal-error"),this.accessToken!==l&&(this.accessToken=l,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),l}getIdTokenResult(n){return ZU(this,n)}reload(){return YU(this)}_assign(n){this!==n&&(tr(this.uid===n.uid,this.auth,"internal-error"),this.displayName=n.displayName,this.photoURL=n.photoURL,this.email=n.email,this.emailVerified=n.emailVerified,this.phoneNumber=n.phoneNumber,this.isAnonymous=n.isAnonymous,this.tenantId=n.tenantId,this.providerData=n.providerData.map(l=>({...l})),this.metadata._copy(n.metadata),this.stsTokenManager._assign(n.stsTokenManager))}_clone(n){const l=new ed({...this,auth:n,stsTokenManager:this.stsTokenManager._clone()});return l.metadata._copy(this.metadata),l}_onReload(n){tr(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=n,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(n){this.reloadListener?this.reloadListener(n):this.reloadUserInfo=n}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(n,l=!1){let p=!1;n.idToken&&n.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(n),p=!0),l&&await Zb(this),await this.auth._persistUserIfCurrent(this),p&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(pu(this.auth.app))return Promise.reject(ap(this.auth));const n=await this.getIdToken();return await D0(this,WU(this.auth,{idToken:n})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(n=>({...n})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(n,l){const p=l.displayName??void 0,b=l.email??void 0,I=l.phoneNumber??void 0,P=l.photoURL??void 0,s=l.tenantId??void 0,G=l._redirectEventId??void 0,q=l.createdAt??void 0,ie=l.lastLoginAt??void 0,{uid:ce,emailVerified:be,isAnonymous:He,providerData:Je,stsTokenManager:it}=l;tr(ce&&it,n,"internal-error");const Ze=Py.fromJSON(this.name,it);tr(typeof ce=="string",n,"internal-error"),Cm(p,n.name),Cm(b,n.name),tr(typeof be=="boolean",n,"internal-error"),tr(typeof He=="boolean",n,"internal-error"),Cm(I,n.name),Cm(P,n.name),Cm(s,n.name),Cm(G,n.name),Cm(q,n.name),Cm(ie,n.name);const Pt=new ed({uid:ce,auth:n,email:b,emailVerified:be,displayName:p,isAnonymous:He,photoURL:P,phoneNumber:I,tenantId:s,stsTokenManager:Ze,createdAt:q,lastLoginAt:ie});return Je&&Array.isArray(Je)&&(Pt.providerData=Je.map(ct=>({...ct}))),G&&(Pt._redirectEventId=G),Pt}static async _fromIdTokenResponse(n,l,p=!1){const b=new Py;b.updateFromServerResponse(l);const I=new ed({uid:l.localId,auth:n,stsTokenManager:b,isAnonymous:p});return await Zb(I),I}static async _fromGetAccountInfoResponse(n,l,p){const b=l.users[0];tr(b.localId!==void 0,"internal-error");const I=b.providerUserInfo!==void 0?bP(b.providerUserInfo):[],P=!(b.email&&b.passwordHash)&&!I?.length,s=new Py;s.updateFromIdToken(p);const G=new ed({uid:b.localId,auth:n,stsTokenManager:s,isAnonymous:P}),q={uid:b.localId,displayName:b.displayName||null,photoURL:b.photoUrl||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,tenantId:b.tenantId||null,providerData:I,metadata:new WT(b.createdAt,b.lastLoginAt),isAnonymous:!(b.email&&b.passwordHash)&&!I?.length};return Object.assign(G,q),G}}const zC=new Map;function rp(c){fp(c instanceof Function,"Expected a class definition");let n=zC.get(c);return n?(fp(n instanceof c,"Instance stored in cache mismatched with class"),n):(n=new c,zC.set(c,n),n)}class wP{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(n,l){this.storage[n]=l}async _get(n){const l=this.storage[n];return l===void 0?null:l}async _remove(n){delete this.storage[n]}_addListener(n,l){}_removeListener(n,l){}}wP.type="NONE";const kC=wP;function Rb(c,n,l){return`firebase:${c}:${n}:${l}`}class Oy{constructor(n,l,p){this.persistence=n,this.auth=l,this.userKey=p;const{config:b,name:I}=this.auth;this.fullUserKey=Rb(this.userKey,b.apiKey,I),this.fullPersistenceKey=Rb("persistence",b.apiKey,I),this.boundEventHandler=l._onStorageEvent.bind(l),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(n){return this.persistence._set(this.fullUserKey,n.toJSON())}async getCurrentUser(){const n=await this.persistence._get(this.fullUserKey);if(!n)return null;if(typeof n=="string"){const l=await Wb(this.auth,{idToken:n}).catch(()=>{});return l?ed._fromGetAccountInfoResponse(this.auth,l,n):null}return ed._fromJSON(this.auth,n)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(n){if(this.persistence===n)return;const l=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=n,l)return this.setCurrentUser(l)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(n,l,p="authUser"){if(!l.length)return new Oy(rp(kC),n,p);const b=(await Promise.all(l.map(async q=>{if(await q._isAvailable())return q}))).filter(q=>q);let I=b[0]||rp(kC);const P=Rb(p,n.config.apiKey,n.name);let s=null;for(const q of l)try{const ie=await q._get(P);if(ie){let ce;if(typeof ie=="string"){const be=await Wb(n,{idToken:ie}).catch(()=>{});if(!be)break;ce=await ed._fromGetAccountInfoResponse(n,be,ie)}else ce=ed._fromJSON(n,ie);q!==I&&(s=ce),I=q;break}}catch{}const G=b.filter(q=>q._shouldAllowMigration);return!I._shouldAllowMigration||!G.length?new Oy(I,n,p):(I=G[0],s&&await I._set(P,s.toJSON()),await Promise.all(l.map(async q=>{if(q!==I)try{await q._remove(P)}catch{}})),new Oy(I,n,p))}}function FC(c){const n=c.toLowerCase();if(n.includes("opera/")||n.includes("opr/")||n.includes("opios/"))return"Opera";if(AP(n))return"IEMobile";if(n.includes("msie")||n.includes("trident/"))return"IE";if(n.includes("edge/"))return"Edge";if(TP(n))return"Firefox";if(n.includes("silk/"))return"Silk";if(CP(n))return"Blackberry";if(RP(n))return"Webos";if(EP(n))return"Safari";if((n.includes("chrome/")||SP(n))&&!n.includes("edge/"))return"Chrome";if(IP(n))return"Android";{const l=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,p=c.match(l);if(p?.length===2)return p[1]}return"Other"}function TP(c=kl()){return/firefox\//i.test(c)}function EP(c=kl()){const n=c.toLowerCase();return n.includes("safari/")&&!n.includes("chrome/")&&!n.includes("crios/")&&!n.includes("android")}function SP(c=kl()){return/crios\//i.test(c)}function AP(c=kl()){return/iemobile/i.test(c)}function IP(c=kl()){return/android/i.test(c)}function CP(c=kl()){return/blackberry/i.test(c)}function RP(c=kl()){return/webos/i.test(c)}function iS(c=kl()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function t6(c=kl()){return iS(c)&&!!window.navigator?.standalone}function i6(){return W4()&&document.documentMode===10}function MP(c=kl()){return iS(c)||IP(c)||RP(c)||CP(c)||/windows phone/i.test(c)||AP(c)}function DP(c,n=[]){let l;switch(c){case"Browser":l=FC(kl());break;case"Worker":l=`${FC(kl())}-${c}`;break;default:l=c}const p=n.length?n.join(","):"FirebaseCore-web";return`${l}/JsCore/${y_}/${p}`}class n6{constructor(n){this.auth=n,this.queue=[]}pushCallback(n,l){const p=I=>new Promise((P,s)=>{try{const G=n(I);P(G)}catch(G){s(G)}});p.onAbort=l,this.queue.push(p);const b=this.queue.length-1;return()=>{this.queue[b]=()=>Promise.resolve()}}async runMiddleware(n){if(this.auth.currentUser===n)return;const l=[];try{for(const p of this.queue)await p(n),p.onAbort&&l.push(p.onAbort)}catch(p){l.reverse();for(const b of l)try{b()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:p?.message})}}}async function r6(c,n={}){return yp(c,"GET","/v2/passwordPolicy",_p(c,n))}const s6=6;class o6{constructor(n){const l=n.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=l.minPasswordLength??s6,l.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=l.maxPasswordLength),l.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=l.containsLowercaseCharacter),l.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=l.containsUppercaseCharacter),l.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=l.containsNumericCharacter),l.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=l.containsNonAlphanumericCharacter),this.enforcementState=n.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=n.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=n.forceUpgradeOnSignin??!1,this.schemaVersion=n.schemaVersion}validatePassword(n){const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(n,l),this.validatePasswordCharacterOptions(n,l),l.isValid&&(l.isValid=l.meetsMinPasswordLength??!0),l.isValid&&(l.isValid=l.meetsMaxPasswordLength??!0),l.isValid&&(l.isValid=l.containsLowercaseLetter??!0),l.isValid&&(l.isValid=l.containsUppercaseLetter??!0),l.isValid&&(l.isValid=l.containsNumericCharacter??!0),l.isValid&&(l.isValid=l.containsNonAlphanumericCharacter??!0),l}validatePasswordLengthOptions(n,l){const p=this.customStrengthOptions.minPasswordLength,b=this.customStrengthOptions.maxPasswordLength;p&&(l.meetsMinPasswordLength=n.length>=p),b&&(l.meetsMaxPasswordLength=n.length<=b)}validatePasswordCharacterOptions(n,l){this.updatePasswordCharacterOptionsStatuses(l,!1,!1,!1,!1);let p;for(let b=0;b<n.length;b++)p=n.charAt(b),this.updatePasswordCharacterOptionsStatuses(l,p>="a"&&p<="z",p>="A"&&p<="Z",p>="0"&&p<="9",this.allowedNonAlphanumericCharacters.includes(p))}updatePasswordCharacterOptionsStatuses(n,l,p,b,I){this.customStrengthOptions.containsLowercaseLetter&&(n.containsLowercaseLetter||(n.containsLowercaseLetter=l)),this.customStrengthOptions.containsUppercaseLetter&&(n.containsUppercaseLetter||(n.containsUppercaseLetter=p)),this.customStrengthOptions.containsNumericCharacter&&(n.containsNumericCharacter||(n.containsNumericCharacter=b)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(n.containsNonAlphanumericCharacter||(n.containsNonAlphanumericCharacter=I))}}class a6{constructor(n,l,p,b){this.app=n,this.heartbeatServiceProvider=l,this.appCheckServiceProvider=p,this.config=b,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new BC(this),this.idTokenSubscription=new BC(this),this.beforeStateQueue=new n6(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=gP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=n.name,this.clientVersion=b.sdkClientVersion,this._persistenceManagerAvailable=new Promise(I=>this._resolvePersistenceManagerAvailable=I)}_initializeWithPersistence(n,l){return l&&(this._popupRedirectResolver=rp(l)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Oy.create(this,n),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(l),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const n=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!n)){if(this.currentUser&&n&&this.currentUser.uid===n.uid){this._currentUser._assign(n),await this.currentUser.getIdToken();return}await this._updateCurrentUser(n,!0)}}async initializeCurrentUserFromIdToken(n){try{const l=await Wb(this,{idToken:n}),p=await ed._fromGetAccountInfoResponse(this,l,n);await this.directlySetCurrentUser(p)}catch(l){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",l),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(n){if(pu(this.app)){const I=this.app.settings.authIdToken;return I?new Promise(P=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(I).then(P,P))}):this.directlySetCurrentUser(null)}const l=await this.assertedPersistence.getCurrentUser();let p=l,b=!1;if(n&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const I=this.redirectUser?._redirectEventId,P=p?._redirectEventId,s=await this.tryRedirectSignIn(n);(!I||I===P)&&s?.user&&(p=s.user,b=!0)}if(!p)return this.directlySetCurrentUser(null);if(!p._redirectEventId){if(b)try{await this.beforeStateQueue.runMiddleware(p)}catch(I){p=l,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(I))}return p?this.reloadAndSetCurrentUserOrClear(p):this.directlySetCurrentUser(null)}return tr(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===p._redirectEventId?this.directlySetCurrentUser(p):this.reloadAndSetCurrentUserOrClear(p)}async tryRedirectSignIn(n){let l=null;try{l=await this._popupRedirectResolver._completeRedirectFn(this,n,!0)}catch{await this._setRedirectUser(null)}return l}async reloadAndSetCurrentUserOrClear(n){try{await Zb(n)}catch(l){if(l?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(n)}useDeviceLanguage(){this.languageCode=NU()}async _delete(){this._deleted=!0}async updateCurrentUser(n){if(pu(this.app))return Promise.reject(ap(this));const l=n?xo(n):null;return l&&tr(l.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(l&&l._clone(this))}async _updateCurrentUser(n,l=!1){if(!this._deleted)return n&&tr(this.tenantId===n.tenantId,this,"tenant-id-mismatch"),l||await this.beforeStateQueue.runMiddleware(n),this.queue(async()=>{await this.directlySetCurrentUser(n),this.notifyAuthListeners()})}async signOut(){return pu(this.app)?Promise.reject(ap(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(n){return pu(this.app)?Promise.reject(ap(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(rp(n))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(n){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const l=this._getPasswordPolicyInternal();return l.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):l.validatePassword(n)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const n=await r6(this),l=new o6(n);this.tenantId===null?this._projectPasswordPolicy=l:this._tenantPasswordPolicies[this.tenantId]=l}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(n){this._errorFactory=new __("auth","Firebase",n())}onAuthStateChanged(n,l,p){return this.registerStateListener(this.authStateSubscription,n,l,p)}beforeAuthStateChanged(n,l){return this.beforeStateQueue.pushCallback(n,l)}onIdTokenChanged(n,l,p){return this.registerStateListener(this.idTokenSubscription,n,l,p)}authStateReady(){return new Promise((n,l)=>{if(this.currentUser)n();else{const p=this.onAuthStateChanged(()=>{p(),n()},l)}})}async revokeAccessToken(n){if(this.currentUser){const l=await this.currentUser.getIdToken(),p={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:n,idToken:l};this.tenantId!=null&&(p.tenantId=this.tenantId),await e6(this,p)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(n,l){const p=await this.getOrInitRedirectPersistenceManager(l);return n===null?p.removeCurrentUser():p.setCurrentUser(n)}async getOrInitRedirectPersistenceManager(n){if(!this.redirectPersistenceManager){const l=n&&rp(n)||this._popupRedirectResolver;tr(l,this,"argument-error"),this.redirectPersistenceManager=await Oy.create(this,[rp(l._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(n){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===n?this._currentUser:this.redirectUser?._redirectEventId===n?this.redirectUser:null}async _persistUserIfCurrent(n){if(n===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(n))}_notifyListenersIfCurrent(n){n===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=this.currentUser?.uid??null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(n,l,p,b){if(this._deleted)return()=>{};const I=typeof l=="function"?l:l.next.bind(l);let P=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if(tr(s,this,"internal-error"),s.then(()=>{P||I(this.currentUser)}),typeof l=="function"){const G=n.addObserver(l,p,b);return()=>{P=!0,G()}}else{const G=n.addObserver(l);return()=>{P=!0,G()}}}async directlySetCurrentUser(n){this.currentUser&&this.currentUser!==n&&this._currentUser._stopProactiveRefresh(),n&&this.isProactiveRefreshEnabled&&n._startProactiveRefresh(),this.currentUser=n,n?await this.assertedPersistence.setCurrentUser(n):await this.assertedPersistence.removeCurrentUser()}queue(n){return this.operations=this.operations.then(n,n),this.operations}get assertedPersistence(){return tr(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(n){!n||this.frameworks.includes(n)||(this.frameworks.push(n),this.frameworks.sort(),this.clientVersion=DP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const l=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();l&&(n["X-Firebase-Client"]=l);const p=await this._getAppCheckToken();return p&&(n["X-Firebase-AppCheck"]=p),n}async _getAppCheckToken(){if(pu(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return n?.error&&kU(`Error while retrieving App Check token: ${n.error}`),n?.token}}function Ym(c){return xo(c)}class BC{constructor(n){this.auth=n,this.observer=null,this.addObserver=eV(l=>this.observer=l)}get next(){return tr(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let T1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function l6(c){T1=c}function PP(c){return T1.loadJS(c)}function c6(){return T1.recaptchaEnterpriseScript}function u6(){return T1.gapiScript}function h6(c){return`__${c}${Math.floor(Math.random()*1e6)}`}class d6{constructor(){this.enterprise=new f6}ready(n){n()}execute(n,l){return Promise.resolve("token")}render(n,l){return""}}class f6{ready(n){n()}execute(n,l){return Promise.resolve("token")}render(n,l){return""}}const p6="recaptcha-enterprise",OP="NO_RECAPTCHA";class m6{constructor(n){this.type=p6,this.auth=Ym(n)}async verify(n="verify",l=!1){async function p(I){if(!l){if(I.tenantId==null&&I._agentRecaptchaConfig!=null)return I._agentRecaptchaConfig.siteKey;if(I.tenantId!=null&&I._tenantRecaptchaConfigs[I.tenantId]!==void 0)return I._tenantRecaptchaConfigs[I.tenantId].siteKey}return new Promise(async(P,s)=>{$U(I,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(G=>{if(G.recaptchaKey===void 0)s(new Error("recaptcha Enterprise site key undefined"));else{const q=new HU(G);return I.tenantId==null?I._agentRecaptchaConfig=q:I._tenantRecaptchaConfigs[I.tenantId]=q,P(q.siteKey)}}).catch(G=>{s(G)})})}function b(I,P,s){const G=window.grecaptcha;OC(G)?G.enterprise.ready(()=>{G.enterprise.execute(I,{action:n}).then(q=>{P(q)}).catch(()=>{P(OP)})}):s(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new d6().execute("siteKey",{action:"verify"}):new Promise((I,P)=>{p(this.auth).then(s=>{if(!l&&OC(window.grecaptcha))b(s,I,P);else{if(typeof window>"u"){P(new Error("RecaptchaVerifier is only supported in browser"));return}let G=c6();G.length!==0&&(G+=s),PP(G).then(()=>{b(s,I,P)}).catch(q=>{P(q)})}}).catch(s=>{P(s)})})}}async function NC(c,n,l,p=!1,b=!1){const I=new m6(c);let P;if(b)P=OP;else try{P=await I.verify(l)}catch{P=await I.verify(l,!0)}const s={...n};if(l==="mfaSmsEnrollment"||l==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in s){const G=s.phoneEnrollmentInfo.phoneNumber,q=s.phoneEnrollmentInfo.recaptchaToken;Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:G,recaptchaToken:q,captchaResponse:P,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in s){const G=s.phoneSignInInfo.recaptchaToken;Object.assign(s,{phoneSignInInfo:{recaptchaToken:G,captchaResponse:P,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return s}return p?Object.assign(s,{captchaResp:P}):Object.assign(s,{captchaResponse:P}),Object.assign(s,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(s,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),s}async function Xb(c,n,l,p,b){if(c._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const I=await NC(c,n,l,l==="getOobCode");return p(c,I)}else return p(c,n).catch(async I=>{if(I.code==="auth/missing-recaptcha-token"){console.log(`${l} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const P=await NC(c,n,l,l==="getOobCode");return p(c,P)}else return Promise.reject(I)})}function g6(c,n){const l=Qy(c,"auth");if(l.isInitialized()){const b=l.getImmediate(),I=l.getOptions();if(hp(I,n??{}))return b;rd(b,"already-initialized")}return l.initialize({options:n})}function _6(c,n){const l=n?.persistence||[],p=(Array.isArray(l)?l:[l]).map(rp);n?.errorMap&&c._updateErrorMap(n.errorMap),c._initializeWithPersistence(p,n?.popupRedirectResolver)}function y6(c,n,l){const p=Ym(c);tr(/^https?:\/\//.test(n),p,"invalid-emulator-scheme");const b=!1,I=LP(n),{host:P,port:s}=v6(n),G=s===null?"":`:${s}`,q={url:`${I}//${P}${G}/`},ie=Object.freeze({host:P,port:s,protocol:I.replace(":",""),options:Object.freeze({disableWarnings:b})});if(!p._canInitEmulator){tr(p.config.emulator&&p.emulatorConfig,p,"emulator-config-failed"),tr(hp(q,p.config.emulator)&&hp(ie,p.emulatorConfig),p,"emulator-config-failed");return}p.config.emulator=q,p.emulatorConfig=ie,p.settings.appVerificationDisabledForTesting=!0,Km(P)?(GE(`${I}//${P}${G}`),qE("Auth",!0)):x6()}function LP(c){const n=c.indexOf(":");return n<0?"":c.substr(0,n+1)}function v6(c){const n=LP(c),l=/(\/\/)?([^?#/]+)/.exec(c.substr(n.length));if(!l)return{host:"",port:null};const p=l[2].split("@").pop()||"",b=/^(\[[^\]]+\])(:|$)/.exec(p);if(b){const I=b[1];return{host:I,port:VC(p.substr(I.length+1))}}else{const[I,P]=p.split(":");return{host:I,port:VC(P)}}}function VC(c){if(!c)return null;const n=Number(c);return isNaN(n)?null:n}function x6(){function c(){const n=document.createElement("p"),l=n.style;n.innerText="Running in emulator mode. Do not use with production credentials.",l.position="fixed",l.width="100%",l.backgroundColor="#ffffff",l.border=".1em solid #000000",l.color="#b50000",l.bottom="0px",l.left="0px",l.margin="0px",l.zIndex="10000",l.textAlign="center",n.classList.add("firebase-emulator-warning"),document.body.appendChild(n)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",c):c())}class nS{constructor(n,l){this.providerId=n,this.signInMethod=l}toJSON(){return np("not implemented")}_getIdTokenResponse(n){return np("not implemented")}_linkToIdToken(n,l){return np("not implemented")}_getReauthenticationResolver(n){return np("not implemented")}}async function b6(c,n){return yp(c,"POST","/v1/accounts:signUp",n)}async function w6(c,n){return Z0(c,"POST","/v1/accounts:signInWithPassword",_p(c,n))}async function T6(c,n){return yp(c,"POST","/v1/accounts:sendOobCode",_p(c,n))}async function E6(c,n){return T6(c,n)}async function S6(c,n){return Z0(c,"POST","/v1/accounts:signInWithEmailLink",_p(c,n))}async function A6(c,n){return Z0(c,"POST","/v1/accounts:signInWithEmailLink",_p(c,n))}class P0 extends nS{constructor(n,l,p,b=null){super("password",p),this._email=n,this._password=l,this._tenantId=b}static _fromEmailAndPassword(n,l){return new P0(n,l,"password")}static _fromEmailAndCode(n,l,p=null){return new P0(n,l,"emailLink",p)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(n){const l=typeof n=="string"?JSON.parse(n):n;if(l?.email&&l?.password){if(l.signInMethod==="password")return this._fromEmailAndPassword(l.email,l.password);if(l.signInMethod==="emailLink")return this._fromEmailAndCode(l.email,l.password,l.tenantId)}return null}async _getIdTokenResponse(n){switch(this.signInMethod){case"password":const l={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xb(n,l,"signInWithPassword",w6);case"emailLink":return S6(n,{email:this._email,oobCode:this._password});default:rd(n,"internal-error")}}async _linkToIdToken(n,l){switch(this.signInMethod){case"password":const p={idToken:l,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xb(n,p,"signUpPassword",b6);case"emailLink":return A6(n,{idToken:l,email:this._email,oobCode:this._password});default:rd(n,"internal-error")}}_getReauthenticationResolver(n){return this._getIdTokenResponse(n)}}async function Ly(c,n){return Z0(c,"POST","/v1/accounts:signInWithIdp",_p(c,n))}const I6="http://localhost";class u_ extends nS{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(n){const l=new u_(n.providerId,n.signInMethod);return n.idToken||n.accessToken?(n.idToken&&(l.idToken=n.idToken),n.accessToken&&(l.accessToken=n.accessToken),n.nonce&&!n.pendingToken&&(l.nonce=n.nonce),n.pendingToken&&(l.pendingToken=n.pendingToken)):n.oauthToken&&n.oauthTokenSecret?(l.accessToken=n.oauthToken,l.secret=n.oauthTokenSecret):rd("argument-error"),l}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(n){const l=typeof n=="string"?JSON.parse(n):n,{providerId:p,signInMethod:b,...I}=l;if(!p||!b)return null;const P=new u_(p,b);return P.idToken=I.idToken||void 0,P.accessToken=I.accessToken||void 0,P.secret=I.secret,P.nonce=I.nonce,P.pendingToken=I.pendingToken||null,P}_getIdTokenResponse(n){const l=this.buildRequest();return Ly(n,l)}_linkToIdToken(n,l){const p=this.buildRequest();return p.idToken=l,Ly(n,p)}_getReauthenticationResolver(n){const l=this.buildRequest();return l.autoCreate=!1,Ly(n,l)}buildRequest(){const n={requestUri:I6,returnSecureToken:!0};if(this.pendingToken)n.pendingToken=this.pendingToken;else{const l={};this.idToken&&(l.id_token=this.idToken),this.accessToken&&(l.access_token=this.accessToken),this.secret&&(l.oauth_token_secret=this.secret),l.providerId=this.providerId,this.nonce&&!this.pendingToken&&(l.nonce=this.nonce),n.postBody=$0(l)}return n}}function C6(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function R6(c){const n=m0(g0(c)).link,l=n?m0(g0(n)).deep_link_id:null,p=m0(g0(c)).deep_link_id;return(p?m0(g0(p)).link:null)||p||l||n||c}class rS{constructor(n){const l=m0(g0(n)),p=l.apiKey??null,b=l.oobCode??null,I=C6(l.mode??null);tr(p&&b&&I,"argument-error"),this.apiKey=p,this.operation=I,this.code=b,this.continueUrl=l.continueUrl??null,this.languageCode=l.lang??null,this.tenantId=l.tenantId??null}static parseLink(n){const l=R6(n);try{return new rS(l)}catch{return null}}}class Jy{constructor(){this.providerId=Jy.PROVIDER_ID}static credential(n,l){return P0._fromEmailAndPassword(n,l)}static credentialWithLink(n,l){const p=rS.parseLink(l);return tr(p,"argument-error"),P0._fromEmailAndCode(n,p.code,p.tenantId)}}Jy.PROVIDER_ID="password";Jy.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Jy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class zP{constructor(n){this.providerId=n,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(n){this.defaultLanguageCode=n}setCustomParameters(n){return this.customParameters=n,this}getCustomParameters(){return this.customParameters}}class X0 extends zP{constructor(){super(...arguments),this.scopes=[]}addScope(n){return this.scopes.includes(n)||this.scopes.push(n),this}getScopes(){return[...this.scopes]}}class Mm extends X0{constructor(){super("facebook.com")}static credential(n){return u_._fromParams({providerId:Mm.PROVIDER_ID,signInMethod:Mm.FACEBOOK_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return Mm.credentialFromTaggedObject(n)}static credentialFromError(n){return Mm.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return Mm.credential(n.oauthAccessToken)}catch{return null}}}Mm.FACEBOOK_SIGN_IN_METHOD="facebook.com";Mm.PROVIDER_ID="facebook.com";class Dm extends X0{constructor(){super("google.com"),this.addScope("profile")}static credential(n,l){return u_._fromParams({providerId:Dm.PROVIDER_ID,signInMethod:Dm.GOOGLE_SIGN_IN_METHOD,idToken:n,accessToken:l})}static credentialFromResult(n){return Dm.credentialFromTaggedObject(n)}static credentialFromError(n){return Dm.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthIdToken:l,oauthAccessToken:p}=n;if(!l&&!p)return null;try{return Dm.credential(l,p)}catch{return null}}}Dm.GOOGLE_SIGN_IN_METHOD="google.com";Dm.PROVIDER_ID="google.com";class Pm extends X0{constructor(){super("github.com")}static credential(n){return u_._fromParams({providerId:Pm.PROVIDER_ID,signInMethod:Pm.GITHUB_SIGN_IN_METHOD,accessToken:n})}static credentialFromResult(n){return Pm.credentialFromTaggedObject(n)}static credentialFromError(n){return Pm.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n||!("oauthAccessToken"in n)||!n.oauthAccessToken)return null;try{return Pm.credential(n.oauthAccessToken)}catch{return null}}}Pm.GITHUB_SIGN_IN_METHOD="github.com";Pm.PROVIDER_ID="github.com";class Om extends X0{constructor(){super("twitter.com")}static credential(n,l){return u_._fromParams({providerId:Om.PROVIDER_ID,signInMethod:Om.TWITTER_SIGN_IN_METHOD,oauthToken:n,oauthTokenSecret:l})}static credentialFromResult(n){return Om.credentialFromTaggedObject(n)}static credentialFromError(n){return Om.credentialFromTaggedObject(n.customData||{})}static credentialFromTaggedObject({_tokenResponse:n}){if(!n)return null;const{oauthAccessToken:l,oauthTokenSecret:p}=n;if(!l||!p)return null;try{return Om.credential(l,p)}catch{return null}}}Om.TWITTER_SIGN_IN_METHOD="twitter.com";Om.PROVIDER_ID="twitter.com";async function M6(c,n){return Z0(c,"POST","/v1/accounts:signUp",_p(c,n))}class h_{constructor(n){this.user=n.user,this.providerId=n.providerId,this._tokenResponse=n._tokenResponse,this.operationType=n.operationType}static async _fromIdTokenResponse(n,l,p,b=!1){const I=await ed._fromIdTokenResponse(n,p,b),P=UC(p);return new h_({user:I,providerId:P,_tokenResponse:p,operationType:l})}static async _forOperation(n,l,p){await n._updateTokensIfNecessary(p,!0);const b=UC(p);return new h_({user:n,providerId:b,_tokenResponse:p,operationType:l})}}function UC(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}class Kb extends th{constructor(n,l,p,b){super(l.code,l.message),this.operationType=p,this.user=b,Object.setPrototypeOf(this,Kb.prototype),this.customData={appName:n.name,tenantId:n.tenantId??void 0,_serverResponse:l.customData._serverResponse,operationType:p}}static _fromErrorAndOperation(n,l,p,b){return new Kb(n,l,p,b)}}function kP(c,n,l,p){return(n==="reauthenticate"?l._getReauthenticationResolver(c):l._getIdTokenResponse(c)).catch(I=>{throw I.code==="auth/multi-factor-auth-required"?Kb._fromErrorAndOperation(c,I,n,p):I})}async function D6(c,n,l=!1){const p=await D0(c,n._linkToIdToken(c.auth,await c.getIdToken()),l);return h_._forOperation(c,"link",p)}async function P6(c,n,l=!1){const{auth:p}=c;if(pu(p.app))return Promise.reject(ap(p));const b="reauthenticate";try{const I=await D0(c,kP(p,b,n,c),l);tr(I.idToken,p,"internal-error");const P=tS(I.idToken);tr(P,p,"internal-error");const{sub:s}=P;return tr(c.uid===s,p,"user-mismatch"),h_._forOperation(c,b,I)}catch(I){throw I?.code==="auth/user-not-found"&&rd(p,"user-mismatch"),I}}async function FP(c,n,l=!1){if(pu(c.app))return Promise.reject(ap(c));const p="signIn",b=await kP(c,p,n),I=await h_._fromIdTokenResponse(c,p,b);return l||await c._updateCurrentUser(I.user),I}async function O6(c,n){return FP(Ym(c),n)}async function BP(c){const n=Ym(c);n._getPasswordPolicyInternal()&&await n._updatePasswordPolicy()}async function L6(c,n,l){const p=Ym(c);await Xb(p,{requestType:"PASSWORD_RESET",email:n,clientType:"CLIENT_TYPE_WEB"},"getOobCode",E6)}async function z6(c,n,l){if(pu(c.app))return Promise.reject(ap(c));const p=Ym(c),P=await Xb(p,{returnSecureToken:!0,email:n,password:l,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",M6).catch(G=>{throw G.code==="auth/password-does-not-meet-requirements"&&BP(c),G}),s=await h_._fromIdTokenResponse(p,"signIn",P);return await p._updateCurrentUser(s.user),s}function k6(c,n,l){return pu(c.app)?Promise.reject(ap(c)):O6(xo(c),Jy.credential(n,l)).catch(async p=>{throw p.code==="auth/password-does-not-meet-requirements"&&BP(c),p})}function F6(c,n,l,p){return xo(c).onIdTokenChanged(n,l,p)}function B6(c,n,l){return xo(c).beforeAuthStateChanged(n,l)}function K0(c,n,l,p){return xo(c).onAuthStateChanged(n,l,p)}function N6(c){return xo(c).signOut()}const Yb="__sak";class NP{constructor(n,l){this.storageRetriever=n,this.type=l}_isAvailable(){try{return this.storage?(this.storage.setItem(Yb,"1"),this.storage.removeItem(Yb),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(n,l){return this.storage.setItem(n,JSON.stringify(l)),Promise.resolve()}_get(n){const l=this.storage.getItem(n);return Promise.resolve(l?JSON.parse(l):null)}_remove(n){return this.storage.removeItem(n),Promise.resolve()}get storage(){return this.storageRetriever()}}const V6=1e3,U6=10;class VP extends NP{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(n,l)=>this.onStorageEvent(n,l),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=MP(),this._shouldAllowMigration=!0}forAllChangedKeys(n){for(const l of Object.keys(this.listeners)){const p=this.storage.getItem(l),b=this.localCache[l];p!==b&&n(l,b,p)}}onStorageEvent(n,l=!1){if(!n.key){this.forAllChangedKeys((P,s,G)=>{this.notifyListeners(P,G)});return}const p=n.key;l?this.detachListener():this.stopPolling();const b=()=>{const P=this.storage.getItem(p);!l&&this.localCache[p]===P||this.notifyListeners(p,P)},I=this.storage.getItem(p);i6()&&I!==n.newValue&&n.newValue!==n.oldValue?setTimeout(b,U6):b()}notifyListeners(n,l){this.localCache[n]=l;const p=this.listeners[n];if(p)for(const b of Array.from(p))b(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((n,l,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:n,oldValue:l,newValue:p}),!0)})},V6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(n,l){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[n]||(this.listeners[n]=new Set,this.localCache[n]=this.storage.getItem(n)),this.listeners[n].add(l)}_removeListener(n,l){this.listeners[n]&&(this.listeners[n].delete(l),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(n,l){await super._set(n,l),this.localCache[n]=JSON.stringify(l)}async _get(n){const l=await super._get(n);return this.localCache[n]=JSON.stringify(l),l}async _remove(n){await super._remove(n),delete this.localCache[n]}}VP.type="LOCAL";const j6=VP;class UP extends NP{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(n,l){}_removeListener(n,l){}}UP.type="SESSION";const jP=UP;function G6(c){return Promise.all(c.map(async n=>{try{return{fulfilled:!0,value:await n}}catch(l){return{fulfilled:!1,reason:l}}}))}class E1{constructor(n){this.eventTarget=n,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(n){const l=this.receivers.find(b=>b.isListeningto(n));if(l)return l;const p=new E1(n);return this.receivers.push(p),p}isListeningto(n){return this.eventTarget===n}async handleEvent(n){const l=n,{eventId:p,eventType:b,data:I}=l.data,P=this.handlersMap[b];if(!P?.size)return;l.ports[0].postMessage({status:"ack",eventId:p,eventType:b});const s=Array.from(P).map(async q=>q(l.origin,I)),G=await G6(s);l.ports[0].postMessage({status:"done",eventId:p,eventType:b,response:G})}_subscribe(n,l){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[n]||(this.handlersMap[n]=new Set),this.handlersMap[n].add(l)}_unsubscribe(n,l){this.handlersMap[n]&&l&&this.handlersMap[n].delete(l),(!l||this.handlersMap[n].size===0)&&delete this.handlersMap[n],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}E1.receivers=[];function sS(c="",n=10){let l="";for(let p=0;p<n;p++)l+=Math.floor(Math.random()*10);return c+l}class q6{constructor(n){this.target=n,this.handlers=new Set}removeMessageHandler(n){n.messageChannel&&(n.messageChannel.port1.removeEventListener("message",n.onMessage),n.messageChannel.port1.close()),this.handlers.delete(n)}async _send(n,l,p=50){const b=typeof MessageChannel<"u"?new MessageChannel:null;if(!b)throw new Error("connection_unavailable");let I,P;return new Promise((s,G)=>{const q=sS("",20);b.port1.start();const ie=setTimeout(()=>{G(new Error("unsupported_event"))},p);P={messageChannel:b,onMessage(ce){const be=ce;if(be.data.eventId===q)switch(be.data.status){case"ack":clearTimeout(ie),I=setTimeout(()=>{G(new Error("timeout"))},3e3);break;case"done":clearTimeout(I),s(be.data.response);break;default:clearTimeout(ie),clearTimeout(I),G(new Error("invalid_response"));break}}},this.handlers.add(P),b.port1.addEventListener("message",P.onMessage),this.target.postMessage({eventType:n,eventId:q,data:l},[b.port2])}).finally(()=>{P&&this.removeMessageHandler(P)})}}function Jd(){return window}function H6(c){Jd().location.href=c}function GP(){return typeof Jd().WorkerGlobalScope<"u"&&typeof Jd().importScripts=="function"}async function $6(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function W6(){return navigator?.serviceWorker?.controller||null}function Z6(){return GP()?self:null}const qP="firebaseLocalStorageDb",X6=1,Qb="firebaseLocalStorage",HP="fbase_key";class Y0{constructor(n){this.request=n}toPromise(){return new Promise((n,l)=>{this.request.addEventListener("success",()=>{n(this.request.result)}),this.request.addEventListener("error",()=>{l(this.request.error)})})}}function S1(c,n){return c.transaction([Qb],n?"readwrite":"readonly").objectStore(Qb)}function K6(){const c=indexedDB.deleteDatabase(qP);return new Y0(c).toPromise()}function ZT(){const c=indexedDB.open(qP,X6);return new Promise((n,l)=>{c.addEventListener("error",()=>{l(c.error)}),c.addEventListener("upgradeneeded",()=>{const p=c.result;try{p.createObjectStore(Qb,{keyPath:HP})}catch(b){l(b)}}),c.addEventListener("success",async()=>{const p=c.result;p.objectStoreNames.contains(Qb)?n(p):(p.close(),await K6(),n(await ZT()))})})}async function jC(c,n,l){const p=S1(c,!0).put({[HP]:n,value:l});return new Y0(p).toPromise()}async function Y6(c,n){const l=S1(c,!1).get(n),p=await new Y0(l).toPromise();return p===void 0?null:p.value}function GC(c,n){const l=S1(c,!0).delete(n);return new Y0(l).toPromise()}const Q6=800,J6=3;class $P{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await ZT(),this.db)}async _withRetries(n){let l=0;for(;;)try{const p=await this._openDb();return await n(p)}catch(p){if(l++>J6)throw p;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return GP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=E1._getInstance(Z6()),this.receiver._subscribe("keyChanged",async(n,l)=>({keyProcessed:(await this._poll()).includes(l.key)})),this.receiver._subscribe("ping",async(n,l)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await $6(),!this.activeServiceWorker)return;this.sender=new q6(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&n[0]?.fulfilled&&n[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(n){if(!(!this.sender||!this.activeServiceWorker||W6()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:n},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const n=await ZT();return await jC(n,Yb,"1"),await GC(n,Yb),!0}catch{}return!1}async _withPendingWrite(n){this.pendingWrites++;try{await n()}finally{this.pendingWrites--}}async _set(n,l){return this._withPendingWrite(async()=>(await this._withRetries(p=>jC(p,n,l)),this.localCache[n]=l,this.notifyServiceWorker(n)))}async _get(n){const l=await this._withRetries(p=>Y6(p,n));return this.localCache[n]=l,l}async _remove(n){return this._withPendingWrite(async()=>(await this._withRetries(l=>GC(l,n)),delete this.localCache[n],this.notifyServiceWorker(n)))}async _poll(){const n=await this._withRetries(b=>{const I=S1(b,!1).getAll();return new Y0(I).toPromise()});if(!n)return[];if(this.pendingWrites!==0)return[];const l=[],p=new Set;if(n.length!==0)for(const{fbase_key:b,value:I}of n)p.add(b),JSON.stringify(this.localCache[b])!==JSON.stringify(I)&&(this.notifyListeners(b,I),l.push(b));for(const b of Object.keys(this.localCache))this.localCache[b]&&!p.has(b)&&(this.notifyListeners(b,null),l.push(b));return l}notifyListeners(n,l){this.localCache[n]=l;const p=this.listeners[n];if(p)for(const b of Array.from(p))b(l)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Q6)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(n,l){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[n]||(this.listeners[n]=new Set,this._get(n)),this.listeners[n].add(l)}_removeListener(n,l){this.listeners[n]&&(this.listeners[n].delete(l),this.listeners[n].size===0&&delete this.listeners[n]),Object.keys(this.listeners).length===0&&this.stopPolling()}}$P.type="LOCAL";const ej=$P;new W0(3e4,6e4);function tj(c,n){return n?rp(n):(tr(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class oS extends nS{constructor(n){super("custom","custom"),this.params=n}_getIdTokenResponse(n){return Ly(n,this._buildIdpRequest())}_linkToIdToken(n,l){return Ly(n,this._buildIdpRequest(l))}_getReauthenticationResolver(n){return Ly(n,this._buildIdpRequest())}_buildIdpRequest(n){const l={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return n&&(l.idToken=n),l}}function ij(c){return FP(c.auth,new oS(c),c.bypassAuthState)}function nj(c){const{auth:n,user:l}=c;return tr(l,n,"internal-error"),P6(l,new oS(c),c.bypassAuthState)}async function rj(c){const{auth:n,user:l}=c;return tr(l,n,"internal-error"),D6(l,new oS(c),c.bypassAuthState)}class WP{constructor(n,l,p,b,I=!1){this.auth=n,this.resolver=p,this.user=b,this.bypassAuthState=I,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(l)?l:[l]}execute(){return new Promise(async(n,l)=>{this.pendingPromise={resolve:n,reject:l};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(p){this.reject(p)}})}async onAuthEvent(n){const{urlResponse:l,sessionId:p,postBody:b,tenantId:I,error:P,type:s}=n;if(P){this.reject(P);return}const G={auth:this.auth,requestUri:l,sessionId:p,tenantId:I||void 0,postBody:b||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(G))}catch(q){this.reject(q)}}onError(n){this.reject(n)}getIdpTask(n){switch(n){case"signInViaPopup":case"signInViaRedirect":return ij;case"linkViaPopup":case"linkViaRedirect":return rj;case"reauthViaPopup":case"reauthViaRedirect":return nj;default:rd(this.auth,"internal-error")}}resolve(n){fp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(n),this.unregisterAndCleanUp()}reject(n){fp(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(n),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const sj=new W0(2e3,1e4);class My extends WP{constructor(n,l,p,b,I){super(n,l,b,I),this.provider=p,this.authWindow=null,this.pollId=null,My.currentPopupAction&&My.currentPopupAction.cancel(),My.currentPopupAction=this}async executeNotNull(){const n=await this.execute();return tr(n,this.auth,"internal-error"),n}async onExecution(){fp(this.filter.length===1,"Popup operations only handle one event");const n=sS();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(l=>{this.reject(l)}),this.resolver._isIframeWebStorageSupported(this.auth,l=>{l||this.reject(Qd(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(Qd(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,My.currentPopupAction=null}pollUserCancellation(){const n=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Qd(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(n,sj.get())};n()}}My.currentPopupAction=null;const oj="pendingRedirect",Mb=new Map;class aj extends WP{constructor(n,l,p=!1){super(n,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],l,void 0,p),this.eventId=null}async execute(){let n=Mb.get(this.auth._key());if(!n){try{const p=await lj(this.resolver,this.auth)?await super.execute():null;n=()=>Promise.resolve(p)}catch(l){n=()=>Promise.reject(l)}Mb.set(this.auth._key(),n)}return this.bypassAuthState||Mb.set(this.auth._key(),()=>Promise.resolve(null)),n()}async onAuthEvent(n){if(n.type==="signInViaRedirect")return super.onAuthEvent(n);if(n.type==="unknown"){this.resolve(null);return}if(n.eventId){const l=await this.auth._redirectUserForId(n.eventId);if(l)return this.user=l,super.onAuthEvent(n);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function lj(c,n){const l=hj(n),p=uj(c);if(!await p._isAvailable())return!1;const b=await p._get(l)==="true";return await p._remove(l),b}function cj(c,n){Mb.set(c._key(),n)}function uj(c){return rp(c._redirectPersistence)}function hj(c){return Rb(oj,c.config.apiKey,c.name)}async function dj(c,n,l=!1){if(pu(c.app))return Promise.reject(ap(c));const p=Ym(c),b=tj(p,n),P=await new aj(p,b,l).execute();return P&&!l&&(delete P.user._redirectEventId,await p._persistUserIfCurrent(P.user),await p._setRedirectUser(null,n)),P}const fj=600*1e3;class pj{constructor(n){this.auth=n,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(n){this.consumers.add(n),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,n)&&(this.sendToConsumer(this.queuedRedirectEvent,n),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(n){this.consumers.delete(n)}onEvent(n){if(this.hasEventBeenHandled(n))return!1;let l=!1;return this.consumers.forEach(p=>{this.isEventForConsumer(n,p)&&(l=!0,this.sendToConsumer(n,p),this.saveEventToCache(n))}),this.hasHandledPotentialRedirect||!mj(n)||(this.hasHandledPotentialRedirect=!0,l||(this.queuedRedirectEvent=n,l=!0)),l}sendToConsumer(n,l){if(n.error&&!ZP(n)){const p=n.error.code?.split("auth/")[1]||"internal-error";l.onError(Qd(this.auth,p))}else l.onAuthEvent(n)}isEventForConsumer(n,l){const p=l.eventId===null||!!n.eventId&&n.eventId===l.eventId;return l.filter.includes(n.type)&&p}hasEventBeenHandled(n){return Date.now()-this.lastProcessedEventTime>=fj&&this.cachedEventUids.clear(),this.cachedEventUids.has(qC(n))}saveEventToCache(n){this.cachedEventUids.add(qC(n)),this.lastProcessedEventTime=Date.now()}}function qC(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(n=>n).join("-")}function ZP({type:c,error:n}){return c==="unknown"&&n?.code==="auth/no-auth-event"}function mj(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ZP(c);default:return!1}}async function gj(c,n={}){return yp(c,"GET","/v1/projects",n)}const _j=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,yj=/^https?/;async function vj(c){if(c.config.emulator)return;const{authorizedDomains:n}=await gj(c);for(const l of n)try{if(xj(l))return}catch{}rd(c,"unauthorized-domain")}function xj(c){const n=$T(),{protocol:l,hostname:p}=new URL(n);if(c.startsWith("chrome-extension://")){const P=new URL(c);return P.hostname===""&&p===""?l==="chrome-extension:"&&c.replace("chrome-extension://","")===n.replace("chrome-extension://",""):l==="chrome-extension:"&&P.hostname===p}if(!yj.test(l))return!1;if(_j.test(c))return p===c;const b=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+b+"|"+b+")$","i").test(p)}const bj=new W0(3e4,6e4);function HC(){const c=Jd().___jsl;if(c?.H){for(const n of Object.keys(c.H))if(c.H[n].r=c.H[n].r||[],c.H[n].L=c.H[n].L||[],c.H[n].r=[...c.H[n].L],c.CP)for(let l=0;l<c.CP.length;l++)c.CP[l]=null}}function wj(c){return new Promise((n,l)=>{function p(){HC(),gapi.load("gapi.iframes",{callback:()=>{n(gapi.iframes.getContext())},ontimeout:()=>{HC(),l(Qd(c,"network-request-failed"))},timeout:bj.get()})}if(Jd().gapi?.iframes?.Iframe)n(gapi.iframes.getContext());else if(Jd().gapi?.load)p();else{const b=h6("iframefcb");return Jd()[b]=()=>{gapi.load?p():l(Qd(c,"network-request-failed"))},PP(`${u6()}?onload=${b}`).catch(I=>l(I))}}).catch(n=>{throw Db=null,n})}let Db=null;function Tj(c){return Db=Db||wj(c),Db}const Ej=new W0(5e3,15e3),Sj="__/auth/iframe",Aj="emulator/auth/iframe",Ij={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Cj=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Rj(c){const n=c.config;tr(n.authDomain,c,"auth-domain-config-required");const l=n.emulator?eS(n,Aj):`https://${c.config.authDomain}/${Sj}`,p={apiKey:n.apiKey,appName:c.name,v:y_},b=Cj.get(c.config.apiHost);b&&(p.eid=b);const I=c._getFrameworks();return I.length&&(p.fw=I.join(",")),`${l}?${$0(p).slice(1)}`}async function Mj(c){const n=await Tj(c),l=Jd().gapi;return tr(l,c,"internal-error"),n.open({where:document.body,url:Rj(c),messageHandlersFilter:l.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ij,dontclear:!0},p=>new Promise(async(b,I)=>{await p.restyle({setHideOnLeave:!1});const P=Qd(c,"network-request-failed"),s=Jd().setTimeout(()=>{I(P)},Ej.get());function G(){Jd().clearTimeout(s),b(p)}p.ping(G).then(G,()=>{I(P)})}))}const Dj={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Pj=500,Oj=600,Lj="_blank",zj="http://localhost";class $C{constructor(n){this.window=n,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function kj(c,n,l,p=Pj,b=Oj){const I=Math.max((window.screen.availHeight-b)/2,0).toString(),P=Math.max((window.screen.availWidth-p)/2,0).toString();let s="";const G={...Dj,width:p.toString(),height:b.toString(),top:I,left:P},q=kl().toLowerCase();l&&(s=SP(q)?Lj:l),TP(q)&&(n=n||zj,G.scrollbars="yes");const ie=Object.entries(G).reduce((be,[He,Je])=>`${be}${He}=${Je},`,"");if(t6(q)&&s!=="_self")return Fj(n||"",s),new $C(null);const ce=window.open(n||"",s,ie);tr(ce,c,"popup-blocked");try{ce.focus()}catch{}return new $C(ce)}function Fj(c,n){const l=document.createElement("a");l.href=c,l.target=n;const p=document.createEvent("MouseEvent");p.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),l.dispatchEvent(p)}const Bj="__/auth/handler",Nj="emulator/auth/handler",Vj=encodeURIComponent("fac");async function WC(c,n,l,p,b,I){tr(c.config.authDomain,c,"auth-domain-config-required"),tr(c.config.apiKey,c,"invalid-api-key");const P={apiKey:c.config.apiKey,appName:c.name,authType:l,redirectUrl:p,v:y_,eventId:b};if(n instanceof zP){n.setDefaultLanguage(c.languageCode),P.providerId=n.providerId||"",J4(n.getCustomParameters())||(P.customParameters=JSON.stringify(n.getCustomParameters()));for(const[ie,ce]of Object.entries({}))P[ie]=ce}if(n instanceof X0){const ie=n.getScopes().filter(ce=>ce!=="");ie.length>0&&(P.scopes=ie.join(","))}c.tenantId&&(P.tid=c.tenantId);const s=P;for(const ie of Object.keys(s))s[ie]===void 0&&delete s[ie];const G=await c._getAppCheckToken(),q=G?`#${Vj}=${encodeURIComponent(G)}`:"";return`${Uj(c)}?${$0(s).slice(1)}${q}`}function Uj({config:c}){return c.emulator?eS(c,Nj):`https://${c.authDomain}/${Bj}`}const TT="webStorageSupport";class jj{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=jP,this._completeRedirectFn=dj,this._overrideRedirectResult=cj}async _openPopup(n,l,p,b){fp(this.eventManagers[n._key()]?.manager,"_initialize() not called before _openPopup()");const I=await WC(n,l,p,$T(),b);return kj(n,I,sS())}async _openRedirect(n,l,p,b){await this._originValidation(n);const I=await WC(n,l,p,$T(),b);return H6(I),new Promise(()=>{})}_initialize(n){const l=n._key();if(this.eventManagers[l]){const{manager:b,promise:I}=this.eventManagers[l];return b?Promise.resolve(b):(fp(I,"If manager is not set, promise should be"),I)}const p=this.initAndGetManager(n);return this.eventManagers[l]={promise:p},p.catch(()=>{delete this.eventManagers[l]}),p}async initAndGetManager(n){const l=await Mj(n),p=new pj(n);return l.register("authEvent",b=>(tr(b?.authEvent,n,"invalid-auth-event"),{status:p.onEvent(b.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[n._key()]={manager:p},this.iframes[n._key()]=l,p}_isIframeWebStorageSupported(n,l){this.iframes[n._key()].send(TT,{type:TT},b=>{const I=b?.[0]?.[TT];I!==void 0&&l(!!I),rd(n,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(n){const l=n._key();return this.originValidationPromises[l]||(this.originValidationPromises[l]=vj(n)),this.originValidationPromises[l]}get _shouldInitProactively(){return MP()||EP()||iS()}}const Gj=jj;var ZC="@firebase/auth",XC="1.11.1";class qj{constructor(n){this.auth=n,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(n){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(n)}:null}addAuthTokenListener(n){if(this.assertAuthConfigured(),this.internalListeners.has(n))return;const l=this.auth.onIdTokenChanged(p=>{n(p?.stsTokenManager.accessToken||null)});this.internalListeners.set(n,l),this.updateProactiveRefresh()}removeAuthTokenListener(n){this.assertAuthConfigured();const l=this.internalListeners.get(n);l&&(this.internalListeners.delete(n),l(),this.updateProactiveRefresh())}assertAuthConfigured(){tr(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Hj(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function $j(c){nd(new eh("auth",(n,{options:l})=>{const p=n.getProvider("app").getImmediate(),b=n.getProvider("heartbeat"),I=n.getProvider("app-check-internal"),{apiKey:P,authDomain:s}=p.options;tr(P&&!P.includes(":"),"invalid-api-key",{appName:p.name});const G={apiKey:P,authDomain:s,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:DP(c)},q=new a6(p,b,I,G);return _6(q,l),q},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,l,p)=>{n.getProvider("auth-internal").initialize()})),nd(new eh("auth-internal",n=>{const l=Ym(n.getProvider("auth").getImmediate());return(p=>new qj(p))(l)},"PRIVATE").setInstantiationMode("EXPLICIT")),Bc(ZC,XC,Hj(c)),Bc(ZC,XC,"esm2020")}const Wj=300,Zj=FD("authIdTokenMaxAge")||Wj;let KC=null;const Xj=c=>async n=>{const l=n&&await n.getIdTokenResult(),p=l&&(new Date().getTime()-Date.parse(l.issuedAtTime))/1e3;if(p&&p>Zj)return;const b=l?.token;KC!==b&&(KC=b,await fetch(c,{method:b?"POST":"DELETE",headers:b?{Authorization:`Bearer ${b}`}:{}}))};function Kj(c=$E()){const n=Qy(c,"auth");if(n.isInitialized())return n.getImmediate();const l=g6(c,{popupRedirectResolver:Gj,persistence:[ej,j6,jP]}),p=FD("authTokenSyncURL");if(p&&typeof isSecureContext=="boolean"&&isSecureContext){const I=new URL(p,location.origin);if(location.origin===I.origin){const P=Xj(I.toString());B6(l,P,()=>P(l.currentUser)),F6(l,s=>P(s))}}const b=LD("auth");return b&&y6(l,`http://${b}`),l}function Yj(){return document.getElementsByTagName("head")?.[0]??document}l6({loadJS(c){return new Promise((n,l)=>{const p=document.createElement("script");p.setAttribute("src",c),p.onload=n,p.onerror=b=>{const I=Qd("internal-error");I.customData=b,l(I)},p.type="text/javascript",p.charset="UTF-8",Yj().appendChild(p)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});$j("Browser");const XP="firebasestorage.googleapis.com",KP="storageBucket",Qj=120*1e3,Jj=600*1e3;class Vo extends th{constructor(n,l,p=0){super(ET(n),`Firebase Storage: ${l} (${ET(n)})`),this.status_=p,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Vo.prototype)}get status(){return this.status_}set status(n){this.status_=n}_codeEquals(n){return ET(n)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(n){this.customData.serverResponse=n,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var No;(function(c){c.UNKNOWN="unknown",c.OBJECT_NOT_FOUND="object-not-found",c.BUCKET_NOT_FOUND="bucket-not-found",c.PROJECT_NOT_FOUND="project-not-found",c.QUOTA_EXCEEDED="quota-exceeded",c.UNAUTHENTICATED="unauthenticated",c.UNAUTHORIZED="unauthorized",c.UNAUTHORIZED_APP="unauthorized-app",c.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",c.INVALID_CHECKSUM="invalid-checksum",c.CANCELED="canceled",c.INVALID_EVENT_NAME="invalid-event-name",c.INVALID_URL="invalid-url",c.INVALID_DEFAULT_BUCKET="invalid-default-bucket",c.NO_DEFAULT_BUCKET="no-default-bucket",c.CANNOT_SLICE_BLOB="cannot-slice-blob",c.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",c.NO_DOWNLOAD_URL="no-download-url",c.INVALID_ARGUMENT="invalid-argument",c.INVALID_ARGUMENT_COUNT="invalid-argument-count",c.APP_DELETED="app-deleted",c.INVALID_ROOT_OPERATION="invalid-root-operation",c.INVALID_FORMAT="invalid-format",c.INTERNAL_ERROR="internal-error",c.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(No||(No={}));function ET(c){return"storage/"+c}function aS(){const c="An unknown error occurred, please check the error payload for server response.";return new Vo(No.UNKNOWN,c)}function e8(c){return new Vo(No.OBJECT_NOT_FOUND,"Object '"+c+"' does not exist.")}function t8(c){return new Vo(No.QUOTA_EXCEEDED,"Quota for bucket '"+c+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function i8(){const c="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Vo(No.UNAUTHENTICATED,c)}function n8(){return new Vo(No.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function r8(c){return new Vo(No.UNAUTHORIZED,"User does not have permission to access '"+c+"'.")}function s8(){return new Vo(No.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function o8(){return new Vo(No.CANCELED,"User canceled the upload/download.")}function a8(c){return new Vo(No.INVALID_URL,"Invalid URL '"+c+"'.")}function l8(c){return new Vo(No.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+c+"'.")}function c8(){return new Vo(No.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+KP+"' property when initializing the app?")}function u8(){return new Vo(No.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function h8(){return new Vo(No.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function d8(c){return new Vo(No.UNSUPPORTED_ENVIRONMENT,`${c} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function XT(c){return new Vo(No.INVALID_ARGUMENT,c)}function YP(){return new Vo(No.APP_DELETED,"The Firebase app was deleted.")}function f8(c){return new Vo(No.INVALID_ROOT_OPERATION,"The operation '"+c+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function T0(c,n){return new Vo(No.INVALID_FORMAT,"String does not match format '"+c+"': "+n)}function d0(c){throw new Vo(No.INTERNAL_ERROR,"Internal error: "+c)}class mu{constructor(n,l){this.bucket=n,this.path_=l}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const n=encodeURIComponent;return"/b/"+n(this.bucket)+"/o/"+n(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(n,l){let p;try{p=mu.makeFromUrl(n,l)}catch{return new mu(n,"")}if(p.path==="")return p;throw l8(n)}static makeFromUrl(n,l){let p=null;const b="([A-Za-z0-9.\\-_]+)";function I(ei){ei.path.charAt(ei.path.length-1)==="/"&&(ei.path_=ei.path_.slice(0,-1))}const P="(/(.*))?$",s=new RegExp("^gs://"+b+P,"i"),G={bucket:1,path:3};function q(ei){ei.path_=decodeURIComponent(ei.path)}const ie="v[A-Za-z0-9_]+",ce=l.replace(/[.]/g,"\\."),be="(/([^?#]*).*)?$",He=new RegExp(`^https?://${ce}/${ie}/b/${b}/o${be}`,"i"),Je={bucket:1,path:3},it=l===XP?"(?:storage.googleapis.com|storage.cloud.google.com)":l,Ze="([^?#]*)",Pt=new RegExp(`^https?://${it}/${b}/${Ze}`,"i"),Gt=[{regex:s,indices:G,postModify:I},{regex:He,indices:Je,postModify:q},{regex:Pt,indices:{bucket:1,path:2},postModify:q}];for(let ei=0;ei<Gt.length;ei++){const Fi=Gt[ei],Si=Fi.regex.exec(n);if(Si){const qe=Si[Fi.indices.bucket];let Oe=Si[Fi.indices.path];Oe||(Oe=""),p=new mu(qe,Oe),Fi.postModify(p);break}}if(p==null)throw a8(n);return p}}class p8{constructor(n){this.promise_=Promise.reject(n)}getPromise(){return this.promise_}cancel(n=!1){}}function m8(c,n,l){let p=1,b=null,I=null,P=!1,s=0;function G(){return s===2}let q=!1;function ie(...Ze){q||(q=!0,n.apply(null,Ze))}function ce(Ze){b=setTimeout(()=>{b=null,c(He,G())},Ze)}function be(){I&&clearTimeout(I)}function He(Ze,...Pt){if(q){be();return}if(Ze){be(),ie.call(null,Ze,...Pt);return}if(G()||P){be(),ie.call(null,Ze,...Pt);return}p<64&&(p*=2);let Gt;s===1?(s=2,Gt=0):Gt=(p+Math.random())*1e3,ce(Gt)}let Je=!1;function it(Ze){Je||(Je=!0,be(),!q&&(b!==null?(Ze||(s=2),clearTimeout(b),ce(0)):Ze||(s=1)))}return ce(0),I=setTimeout(()=>{P=!0,it(!0)},l),it}function g8(c){c(!1)}function _8(c){return c!==void 0}function y8(c){return typeof c=="object"&&!Array.isArray(c)}function lS(c){return typeof c=="string"||c instanceof String}function YC(c){return cS()&&c instanceof Blob}function cS(){return typeof Blob<"u"}function QC(c,n,l,p){if(p<n)throw XT(`Invalid value for '${c}'. Expected ${n} or greater.`);if(p>l)throw XT(`Invalid value for '${c}'. Expected ${l} or less.`)}function uS(c,n,l){let p=n;return l==null&&(p=`https://${n}`),`${l}://${p}/v0${c}`}function QP(c){const n=encodeURIComponent;let l="?";for(const p in c)if(c.hasOwnProperty(p)){const b=n(p)+"="+n(c[p]);l=l+b+"&"}return l=l.slice(0,-1),l}var s_;(function(c){c[c.NO_ERROR=0]="NO_ERROR",c[c.NETWORK_ERROR=1]="NETWORK_ERROR",c[c.ABORT=2]="ABORT"})(s_||(s_={}));function v8(c,n){const l=c>=500&&c<600,b=[408,429].indexOf(c)!==-1,I=n.indexOf(c)!==-1;return l||b||I}class x8{constructor(n,l,p,b,I,P,s,G,q,ie,ce,be=!0,He=!1){this.url_=n,this.method_=l,this.headers_=p,this.body_=b,this.successCodes_=I,this.additionalRetryCodes_=P,this.callback_=s,this.errorCallback_=G,this.timeout_=q,this.progressCallback_=ie,this.connectionFactory_=ce,this.retry=be,this.isUsingEmulator=He,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Je,it)=>{this.resolve_=Je,this.reject_=it,this.start_()})}start_(){const n=(p,b)=>{if(b){p(!1,new vb(!1,null,!0));return}const I=this.connectionFactory_();this.pendingConnection_=I;const P=s=>{const G=s.loaded,q=s.lengthComputable?s.total:-1;this.progressCallback_!==null&&this.progressCallback_(G,q)};this.progressCallback_!==null&&I.addUploadProgressListener(P),I.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&I.removeUploadProgressListener(P),this.pendingConnection_=null;const s=I.getErrorCode()===s_.NO_ERROR,G=I.getStatus();if(!s||v8(G,this.additionalRetryCodes_)&&this.retry){const ie=I.getErrorCode()===s_.ABORT;p(!1,new vb(!1,null,ie));return}const q=this.successCodes_.indexOf(G)!==-1;p(!0,new vb(q,I))})},l=(p,b)=>{const I=this.resolve_,P=this.reject_,s=b.connection;if(b.wasSuccessCode)try{const G=this.callback_(s,s.getResponse());_8(G)?I(G):I()}catch(G){P(G)}else if(s!==null){const G=aS();G.serverResponse=s.getErrorText(),this.errorCallback_?P(this.errorCallback_(s,G)):P(G)}else if(b.canceled){const G=this.appDelete_?YP():o8();P(G)}else{const G=s8();P(G)}};this.canceled_?l(!1,new vb(!1,null,!0)):this.backoffId_=m8(n,l,this.timeout_)}getPromise(){return this.promise_}cancel(n){this.canceled_=!0,this.appDelete_=n||!1,this.backoffId_!==null&&g8(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class vb{constructor(n,l,p){this.wasSuccessCode=n,this.connection=l,this.canceled=!!p}}function b8(c,n){n!==null&&n.length>0&&(c.Authorization="Firebase "+n)}function w8(c,n){c["X-Firebase-Storage-Version"]="webjs/"+(n??"AppManager")}function T8(c,n){n&&(c["X-Firebase-GMPID"]=n)}function E8(c,n){n!==null&&(c["X-Firebase-AppCheck"]=n)}function S8(c,n,l,p,b,I,P=!0,s=!1){const G=QP(c.urlParams),q=c.url+G,ie=Object.assign({},c.headers);return T8(ie,n),b8(ie,l),w8(ie,I),E8(ie,p),new x8(q,c.method,ie,c.body,c.successCodes,c.additionalRetryCodes,c.handler,c.errorHandler,c.timeout,c.progressCallback,b,P,s)}function A8(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function I8(...c){const n=A8();if(n!==void 0){const l=new n;for(let p=0;p<c.length;p++)l.append(c[p]);return l.getBlob()}else{if(cS())return new Blob(c);throw new Vo(No.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function C8(c,n,l){return c.webkitSlice?c.webkitSlice(n,l):c.mozSlice?c.mozSlice(n,l):c.slice?c.slice(n,l):null}function R8(c){if(typeof atob>"u")throw d8("base-64");return atob(c)}const Yd={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class ST{constructor(n,l){this.data=n,this.contentType=l||null}}function M8(c,n){switch(c){case Yd.RAW:return new ST(JP(n));case Yd.BASE64:case Yd.BASE64URL:return new ST(eO(c,n));case Yd.DATA_URL:return new ST(P8(n),O8(n))}throw aS()}function JP(c){const n=[];for(let l=0;l<c.length;l++){let p=c.charCodeAt(l);if(p<=127)n.push(p);else if(p<=2047)n.push(192|p>>6,128|p&63);else if((p&64512)===55296)if(!(l<c.length-1&&(c.charCodeAt(l+1)&64512)===56320))n.push(239,191,189);else{const I=p,P=c.charCodeAt(++l);p=65536|(I&1023)<<10|P&1023,n.push(240|p>>18,128|p>>12&63,128|p>>6&63,128|p&63)}else(p&64512)===56320?n.push(239,191,189):n.push(224|p>>12,128|p>>6&63,128|p&63)}return new Uint8Array(n)}function D8(c){let n;try{n=decodeURIComponent(c)}catch{throw T0(Yd.DATA_URL,"Malformed data URL.")}return JP(n)}function eO(c,n){switch(c){case Yd.BASE64:{const b=n.indexOf("-")!==-1,I=n.indexOf("_")!==-1;if(b||I)throw T0(c,"Invalid character '"+(b?"-":"_")+"' found: is it base64url encoded?");break}case Yd.BASE64URL:{const b=n.indexOf("+")!==-1,I=n.indexOf("/")!==-1;if(b||I)throw T0(c,"Invalid character '"+(b?"+":"/")+"' found: is it base64 encoded?");n=n.replace(/-/g,"+").replace(/_/g,"/");break}}let l;try{l=R8(n)}catch(b){throw b.message.includes("polyfill")?b:T0(c,"Invalid character found")}const p=new Uint8Array(l.length);for(let b=0;b<l.length;b++)p[b]=l.charCodeAt(b);return p}class tO{constructor(n){this.base64=!1,this.contentType=null;const l=n.match(/^data:([^,]+)?,/);if(l===null)throw T0(Yd.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const p=l[1]||null;p!=null&&(this.base64=L8(p,";base64"),this.contentType=this.base64?p.substring(0,p.length-7):p),this.rest=n.substring(n.indexOf(",")+1)}}function P8(c){const n=new tO(c);return n.base64?eO(Yd.BASE64,n.rest):D8(n.rest)}function O8(c){return new tO(c).contentType}function L8(c,n){return c.length>=n.length?c.substring(c.length-n.length)===n:!1}class Lm{constructor(n,l){let p=0,b="";YC(n)?(this.data_=n,p=n.size,b=n.type):n instanceof ArrayBuffer?(l?this.data_=new Uint8Array(n):(this.data_=new Uint8Array(n.byteLength),this.data_.set(new Uint8Array(n))),p=this.data_.length):n instanceof Uint8Array&&(l?this.data_=n:(this.data_=new Uint8Array(n.length),this.data_.set(n)),p=n.length),this.size_=p,this.type_=b}size(){return this.size_}type(){return this.type_}slice(n,l){if(YC(this.data_)){const p=this.data_,b=C8(p,n,l);return b===null?null:new Lm(b)}else{const p=new Uint8Array(this.data_.buffer,n,l-n);return new Lm(p,!0)}}static getBlob(...n){if(cS()){const l=n.map(p=>p instanceof Lm?p.data_:p);return new Lm(I8.apply(null,l))}else{const l=n.map(P=>lS(P)?M8(Yd.RAW,P).data:P.data_);let p=0;l.forEach(P=>{p+=P.byteLength});const b=new Uint8Array(p);let I=0;return l.forEach(P=>{for(let s=0;s<P.length;s++)b[I++]=P[s]}),new Lm(b,!0)}}uploadData(){return this.data_}}function iO(c){let n;try{n=JSON.parse(c)}catch{return null}return y8(n)?n:null}function z8(c){if(c.length===0)return null;const n=c.lastIndexOf("/");return n===-1?"":c.slice(0,n)}function k8(c,n){const l=n.split("/").filter(p=>p.length>0).join("/");return c.length===0?l:c+"/"+l}function nO(c){const n=c.lastIndexOf("/",c.length-2);return n===-1?c:c.slice(n+1)}function F8(c,n){return n}class sc{constructor(n,l,p,b){this.server=n,this.local=l||n,this.writable=!!p,this.xform=b||F8}}let xb=null;function B8(c){return!lS(c)||c.length<2?c:nO(c)}function rO(){if(xb)return xb;const c=[];c.push(new sc("bucket")),c.push(new sc("generation")),c.push(new sc("metageneration")),c.push(new sc("name","fullPath",!0));function n(I,P){return B8(P)}const l=new sc("name");l.xform=n,c.push(l);function p(I,P){return P!==void 0?Number(P):P}const b=new sc("size");return b.xform=p,c.push(b),c.push(new sc("timeCreated")),c.push(new sc("updated")),c.push(new sc("md5Hash",null,!0)),c.push(new sc("cacheControl",null,!0)),c.push(new sc("contentDisposition",null,!0)),c.push(new sc("contentEncoding",null,!0)),c.push(new sc("contentLanguage",null,!0)),c.push(new sc("contentType",null,!0)),c.push(new sc("metadata","customMetadata",!0)),xb=c,xb}function N8(c,n){function l(){const p=c.bucket,b=c.fullPath,I=new mu(p,b);return n._makeStorageReference(I)}Object.defineProperty(c,"ref",{get:l})}function V8(c,n,l){const p={};p.type="file";const b=l.length;for(let I=0;I<b;I++){const P=l[I];p[P.local]=P.xform(p,n[P.server])}return N8(p,c),p}function sO(c,n,l){const p=iO(n);return p===null?null:V8(c,p,l)}function U8(c,n,l,p){const b=iO(n);if(b===null||!lS(b.downloadTokens))return null;const I=b.downloadTokens;if(I.length===0)return null;const P=encodeURIComponent;return I.split(",").map(q=>{const ie=c.bucket,ce=c.fullPath,be="/b/"+P(ie)+"/o/"+P(ce),He=uS(be,l,p),Je=QP({alt:"media",token:q});return He+Je})[0]}function j8(c,n){const l={},p=n.length;for(let b=0;b<p;b++){const I=n[b];I.writable&&(l[I.server]=c[I.local])}return JSON.stringify(l)}class oO{constructor(n,l,p,b){this.url=n,this.method=l,this.handler=p,this.timeout=b,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function aO(c){if(!c)throw aS()}function G8(c,n){function l(p,b){const I=sO(c,b,n);return aO(I!==null),I}return l}function q8(c,n){function l(p,b){const I=sO(c,b,n);return aO(I!==null),U8(I,b,c.host,c._protocol)}return l}function lO(c){function n(l,p){let b;return l.getStatus()===401?l.getErrorText().includes("Firebase App Check token is invalid")?b=n8():b=i8():l.getStatus()===402?b=t8(c.bucket):l.getStatus()===403?b=r8(c.path):b=p,b.status=l.getStatus(),b.serverResponse=p.serverResponse,b}return n}function H8(c){const n=lO(c);function l(p,b){let I=n(p,b);return p.getStatus()===404&&(I=e8(c.path)),I.serverResponse=b.serverResponse,I}return l}function $8(c,n,l){const p=n.fullServerUrl(),b=uS(p,c.host,c._protocol),I="GET",P=c.maxOperationRetryTime,s=new oO(b,I,q8(c,l),P);return s.errorHandler=H8(n),s}function W8(c,n){return c&&c.contentType||n&&n.type()||"application/octet-stream"}function Z8(c,n,l){const p=Object.assign({},l);return p.fullPath=c.path,p.size=n.size(),p.contentType||(p.contentType=W8(null,n)),p}function X8(c,n,l,p,b){const I=n.bucketOnlyServerUrl(),P={"X-Goog-Upload-Protocol":"multipart"};function s(){let Gt="";for(let ei=0;ei<2;ei++)Gt=Gt+Math.random().toString().slice(2);return Gt}const G=s();P["Content-Type"]="multipart/related; boundary="+G;const q=Z8(n,p,b),ie=j8(q,l),ce="--"+G+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+ie+`\r
--`+G+`\r
Content-Type: `+q.contentType+`\r
\r
`,be=`\r
--`+G+"--",He=Lm.getBlob(ce,p,be);if(He===null)throw u8();const Je={name:q.fullPath},it=uS(I,c.host,c._protocol),Ze="POST",Pt=c.maxUploadRetryTime,ct=new oO(it,Ze,G8(c,l),Pt);return ct.urlParams=Je,ct.headers=P,ct.body=He.uploadData(),ct.errorHandler=lO(n),ct}class K8{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=s_.NO_ERROR,this.sendPromise_=new Promise(n=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=s_.ABORT,n()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=s_.NETWORK_ERROR,n()}),this.xhr_.addEventListener("load",()=>{n()})})}send(n,l,p,b,I){if(this.sent_)throw d0("cannot .send() more than once");if(Km(n)&&p&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(l,n,!0),I!==void 0)for(const P in I)I.hasOwnProperty(P)&&this.xhr_.setRequestHeader(P,I[P].toString());return b!==void 0?this.xhr_.send(b):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw d0("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw d0("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw d0("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw d0("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(n){return this.xhr_.getResponseHeader(n)}addUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",n)}removeUploadProgressListener(n){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",n)}}class Y8 extends K8{initXhr(){this.xhr_.responseType="text"}}function cO(){return new Y8}class d_{constructor(n,l){this._service=n,l instanceof mu?this._location=l:this._location=mu.makeFromUrl(l,n.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(n,l){return new d_(n,l)}get root(){const n=new mu(this._location.bucket,"");return this._newRef(this._service,n)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return nO(this._location.path)}get storage(){return this._service}get parent(){const n=z8(this._location.path);if(n===null)return null;const l=new mu(this._location.bucket,n);return new d_(this._service,l)}_throwIfRoot(n){if(this._location.path==="")throw f8(n)}}function Q8(c,n,l){c._throwIfRoot("uploadBytes");const p=X8(c.storage,c._location,rO(),new Lm(n,!0),l);return c.storage.makeRequestWithTokens(p,cO).then(b=>({metadata:b,ref:c}))}function J8(c){c._throwIfRoot("getDownloadURL");const n=$8(c.storage,c._location,rO());return c.storage.makeRequestWithTokens(n,cO).then(l=>{if(l===null)throw h8();return l})}function eG(c,n){const l=k8(c._location.path,n),p=new mu(c._location.bucket,l);return new d_(c.storage,p)}function tG(c){return/^[A-Za-z]+:\/\//.test(c)}function iG(c,n){return new d_(c,n)}function uO(c,n){if(c instanceof hS){const l=c;if(l._bucket==null)throw c8();const p=new d_(l,l._bucket);return n!=null?uO(p,n):p}else return n!==void 0?eG(c,n):c}function nG(c,n){if(n&&tG(n)){if(c instanceof hS)return iG(c,n);throw XT("To use ref(service, url), the first argument must be a Storage instance.")}else return uO(c,n)}function JC(c,n){const l=n?.[KP];return l==null?null:mu.makeFromBucketSpec(l,c)}function rG(c,n,l,p={}){c.host=`${n}:${l}`;const b=Km(n);b&&(GE(`https://${c.host}/b`),qE("Storage",!0)),c._isUsingEmulator=!0,c._protocol=b?"https":"http";const{mockUserToken:I}=p;I&&(c._overrideAuthToken=typeof I=="string"?I:BD(I,c.app.options.projectId))}class hS{constructor(n,l,p,b,I,P=!1){this.app=n,this._authProvider=l,this._appCheckProvider=p,this._url=b,this._firebaseVersion=I,this._isUsingEmulator=P,this._bucket=null,this._host=XP,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Qj,this._maxUploadRetryTime=Jj,this._requests=new Set,b!=null?this._bucket=mu.makeFromBucketSpec(b,this._host):this._bucket=JC(this._host,this.app.options)}get host(){return this._host}set host(n){this._host=n,this._url!=null?this._bucket=mu.makeFromBucketSpec(this._url,n):this._bucket=JC(n,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(n){QC("time",0,Number.POSITIVE_INFINITY,n),this._maxUploadRetryTime=n}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(n){QC("time",0,Number.POSITIVE_INFINITY,n),this._maxOperationRetryTime=n}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const n=this._authProvider.getImmediate({optional:!0});if(n){const l=await n.getToken();if(l!==null)return l.accessToken}return null}async _getAppCheckToken(){if(pu(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const n=this._appCheckProvider.getImmediate({optional:!0});return n?(await n.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(n=>n.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(n){return new d_(this,n)}_makeRequest(n,l,p,b,I=!0){if(this._deleted)return new p8(YP());{const P=S8(n,this._appId,p,b,l,this._firebaseVersion,I,this._isUsingEmulator);return this._requests.add(P),P.getPromise().then(()=>this._requests.delete(P),()=>this._requests.delete(P)),P}}async makeRequestWithTokens(n,l){const[p,b]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(n,l,p,b).getPromise()}}const eR="@firebase/storage",tR="0.14.0";const hO="storage";function dO(c,n,l){return c=xo(c),Q8(c,n,l)}function fO(c){return c=xo(c),J8(c)}function pO(c,n){return c=xo(c),nG(c,n)}function sG(c=$E(),n){c=xo(c);const p=Qy(c,hO).getImmediate({identifier:n}),b=zD("storage");return b&&oG(p,...b),p}function oG(c,n,l,p={}){rG(c,n,l,p)}function aG(c,{instanceIdentifier:n}){const l=c.getProvider("app").getImmediate(),p=c.getProvider("auth-internal"),b=c.getProvider("app-check-internal");return new hS(l,p,b,n,y_)}function lG(){nd(new eh(hO,aG,"PUBLIC").setMultipleInstances(!0)),Bc(eR,tR,""),Bc(eR,tR,"esm2020")}lG();var iR=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Bm,mO;(function(){var c;function n(qe,Oe){function je(){}je.prototype=Oe.prototype,qe.F=Oe.prototype,qe.prototype=new je,qe.prototype.constructor=qe,qe.D=function(tt,nt,yt){for(var ze=Array(arguments.length-2),ur=2;ur<arguments.length;ur++)ze[ur-2]=arguments[ur];return Oe.prototype[nt].apply(tt,ze)}}function l(){this.blockSize=-1}function p(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}n(p,l),p.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function b(qe,Oe,je){je||(je=0);const tt=Array(16);if(typeof Oe=="string")for(var nt=0;nt<16;++nt)tt[nt]=Oe.charCodeAt(je++)|Oe.charCodeAt(je++)<<8|Oe.charCodeAt(je++)<<16|Oe.charCodeAt(je++)<<24;else for(nt=0;nt<16;++nt)tt[nt]=Oe[je++]|Oe[je++]<<8|Oe[je++]<<16|Oe[je++]<<24;Oe=qe.g[0],je=qe.g[1],nt=qe.g[2];let yt=qe.g[3],ze;ze=Oe+(yt^je&(nt^yt))+tt[0]+3614090360&4294967295,Oe=je+(ze<<7&4294967295|ze>>>25),ze=yt+(nt^Oe&(je^nt))+tt[1]+3905402710&4294967295,yt=Oe+(ze<<12&4294967295|ze>>>20),ze=nt+(je^yt&(Oe^je))+tt[2]+606105819&4294967295,nt=yt+(ze<<17&4294967295|ze>>>15),ze=je+(Oe^nt&(yt^Oe))+tt[3]+3250441966&4294967295,je=nt+(ze<<22&4294967295|ze>>>10),ze=Oe+(yt^je&(nt^yt))+tt[4]+4118548399&4294967295,Oe=je+(ze<<7&4294967295|ze>>>25),ze=yt+(nt^Oe&(je^nt))+tt[5]+1200080426&4294967295,yt=Oe+(ze<<12&4294967295|ze>>>20),ze=nt+(je^yt&(Oe^je))+tt[6]+2821735955&4294967295,nt=yt+(ze<<17&4294967295|ze>>>15),ze=je+(Oe^nt&(yt^Oe))+tt[7]+4249261313&4294967295,je=nt+(ze<<22&4294967295|ze>>>10),ze=Oe+(yt^je&(nt^yt))+tt[8]+1770035416&4294967295,Oe=je+(ze<<7&4294967295|ze>>>25),ze=yt+(nt^Oe&(je^nt))+tt[9]+2336552879&4294967295,yt=Oe+(ze<<12&4294967295|ze>>>20),ze=nt+(je^yt&(Oe^je))+tt[10]+4294925233&4294967295,nt=yt+(ze<<17&4294967295|ze>>>15),ze=je+(Oe^nt&(yt^Oe))+tt[11]+2304563134&4294967295,je=nt+(ze<<22&4294967295|ze>>>10),ze=Oe+(yt^je&(nt^yt))+tt[12]+1804603682&4294967295,Oe=je+(ze<<7&4294967295|ze>>>25),ze=yt+(nt^Oe&(je^nt))+tt[13]+4254626195&4294967295,yt=Oe+(ze<<12&4294967295|ze>>>20),ze=nt+(je^yt&(Oe^je))+tt[14]+2792965006&4294967295,nt=yt+(ze<<17&4294967295|ze>>>15),ze=je+(Oe^nt&(yt^Oe))+tt[15]+1236535329&4294967295,je=nt+(ze<<22&4294967295|ze>>>10),ze=Oe+(nt^yt&(je^nt))+tt[1]+4129170786&4294967295,Oe=je+(ze<<5&4294967295|ze>>>27),ze=yt+(je^nt&(Oe^je))+tt[6]+3225465664&4294967295,yt=Oe+(ze<<9&4294967295|ze>>>23),ze=nt+(Oe^je&(yt^Oe))+tt[11]+643717713&4294967295,nt=yt+(ze<<14&4294967295|ze>>>18),ze=je+(yt^Oe&(nt^yt))+tt[0]+3921069994&4294967295,je=nt+(ze<<20&4294967295|ze>>>12),ze=Oe+(nt^yt&(je^nt))+tt[5]+3593408605&4294967295,Oe=je+(ze<<5&4294967295|ze>>>27),ze=yt+(je^nt&(Oe^je))+tt[10]+38016083&4294967295,yt=Oe+(ze<<9&4294967295|ze>>>23),ze=nt+(Oe^je&(yt^Oe))+tt[15]+3634488961&4294967295,nt=yt+(ze<<14&4294967295|ze>>>18),ze=je+(yt^Oe&(nt^yt))+tt[4]+3889429448&4294967295,je=nt+(ze<<20&4294967295|ze>>>12),ze=Oe+(nt^yt&(je^nt))+tt[9]+568446438&4294967295,Oe=je+(ze<<5&4294967295|ze>>>27),ze=yt+(je^nt&(Oe^je))+tt[14]+3275163606&4294967295,yt=Oe+(ze<<9&4294967295|ze>>>23),ze=nt+(Oe^je&(yt^Oe))+tt[3]+4107603335&4294967295,nt=yt+(ze<<14&4294967295|ze>>>18),ze=je+(yt^Oe&(nt^yt))+tt[8]+1163531501&4294967295,je=nt+(ze<<20&4294967295|ze>>>12),ze=Oe+(nt^yt&(je^nt))+tt[13]+2850285829&4294967295,Oe=je+(ze<<5&4294967295|ze>>>27),ze=yt+(je^nt&(Oe^je))+tt[2]+4243563512&4294967295,yt=Oe+(ze<<9&4294967295|ze>>>23),ze=nt+(Oe^je&(yt^Oe))+tt[7]+1735328473&4294967295,nt=yt+(ze<<14&4294967295|ze>>>18),ze=je+(yt^Oe&(nt^yt))+tt[12]+2368359562&4294967295,je=nt+(ze<<20&4294967295|ze>>>12),ze=Oe+(je^nt^yt)+tt[5]+4294588738&4294967295,Oe=je+(ze<<4&4294967295|ze>>>28),ze=yt+(Oe^je^nt)+tt[8]+2272392833&4294967295,yt=Oe+(ze<<11&4294967295|ze>>>21),ze=nt+(yt^Oe^je)+tt[11]+1839030562&4294967295,nt=yt+(ze<<16&4294967295|ze>>>16),ze=je+(nt^yt^Oe)+tt[14]+4259657740&4294967295,je=nt+(ze<<23&4294967295|ze>>>9),ze=Oe+(je^nt^yt)+tt[1]+2763975236&4294967295,Oe=je+(ze<<4&4294967295|ze>>>28),ze=yt+(Oe^je^nt)+tt[4]+1272893353&4294967295,yt=Oe+(ze<<11&4294967295|ze>>>21),ze=nt+(yt^Oe^je)+tt[7]+4139469664&4294967295,nt=yt+(ze<<16&4294967295|ze>>>16),ze=je+(nt^yt^Oe)+tt[10]+3200236656&4294967295,je=nt+(ze<<23&4294967295|ze>>>9),ze=Oe+(je^nt^yt)+tt[13]+681279174&4294967295,Oe=je+(ze<<4&4294967295|ze>>>28),ze=yt+(Oe^je^nt)+tt[0]+3936430074&4294967295,yt=Oe+(ze<<11&4294967295|ze>>>21),ze=nt+(yt^Oe^je)+tt[3]+3572445317&4294967295,nt=yt+(ze<<16&4294967295|ze>>>16),ze=je+(nt^yt^Oe)+tt[6]+76029189&4294967295,je=nt+(ze<<23&4294967295|ze>>>9),ze=Oe+(je^nt^yt)+tt[9]+3654602809&4294967295,Oe=je+(ze<<4&4294967295|ze>>>28),ze=yt+(Oe^je^nt)+tt[12]+3873151461&4294967295,yt=Oe+(ze<<11&4294967295|ze>>>21),ze=nt+(yt^Oe^je)+tt[15]+530742520&4294967295,nt=yt+(ze<<16&4294967295|ze>>>16),ze=je+(nt^yt^Oe)+tt[2]+3299628645&4294967295,je=nt+(ze<<23&4294967295|ze>>>9),ze=Oe+(nt^(je|~yt))+tt[0]+4096336452&4294967295,Oe=je+(ze<<6&4294967295|ze>>>26),ze=yt+(je^(Oe|~nt))+tt[7]+1126891415&4294967295,yt=Oe+(ze<<10&4294967295|ze>>>22),ze=nt+(Oe^(yt|~je))+tt[14]+2878612391&4294967295,nt=yt+(ze<<15&4294967295|ze>>>17),ze=je+(yt^(nt|~Oe))+tt[5]+4237533241&4294967295,je=nt+(ze<<21&4294967295|ze>>>11),ze=Oe+(nt^(je|~yt))+tt[12]+1700485571&4294967295,Oe=je+(ze<<6&4294967295|ze>>>26),ze=yt+(je^(Oe|~nt))+tt[3]+2399980690&4294967295,yt=Oe+(ze<<10&4294967295|ze>>>22),ze=nt+(Oe^(yt|~je))+tt[10]+4293915773&4294967295,nt=yt+(ze<<15&4294967295|ze>>>17),ze=je+(yt^(nt|~Oe))+tt[1]+2240044497&4294967295,je=nt+(ze<<21&4294967295|ze>>>11),ze=Oe+(nt^(je|~yt))+tt[8]+1873313359&4294967295,Oe=je+(ze<<6&4294967295|ze>>>26),ze=yt+(je^(Oe|~nt))+tt[15]+4264355552&4294967295,yt=Oe+(ze<<10&4294967295|ze>>>22),ze=nt+(Oe^(yt|~je))+tt[6]+2734768916&4294967295,nt=yt+(ze<<15&4294967295|ze>>>17),ze=je+(yt^(nt|~Oe))+tt[13]+1309151649&4294967295,je=nt+(ze<<21&4294967295|ze>>>11),ze=Oe+(nt^(je|~yt))+tt[4]+4149444226&4294967295,Oe=je+(ze<<6&4294967295|ze>>>26),ze=yt+(je^(Oe|~nt))+tt[11]+3174756917&4294967295,yt=Oe+(ze<<10&4294967295|ze>>>22),ze=nt+(Oe^(yt|~je))+tt[2]+718787259&4294967295,nt=yt+(ze<<15&4294967295|ze>>>17),ze=je+(yt^(nt|~Oe))+tt[9]+3951481745&4294967295,qe.g[0]=qe.g[0]+Oe&4294967295,qe.g[1]=qe.g[1]+(nt+(ze<<21&4294967295|ze>>>11))&4294967295,qe.g[2]=qe.g[2]+nt&4294967295,qe.g[3]=qe.g[3]+yt&4294967295}p.prototype.v=function(qe,Oe){Oe===void 0&&(Oe=qe.length);const je=Oe-this.blockSize,tt=this.C;let nt=this.h,yt=0;for(;yt<Oe;){if(nt==0)for(;yt<=je;)b(this,qe,yt),yt+=this.blockSize;if(typeof qe=="string"){for(;yt<Oe;)if(tt[nt++]=qe.charCodeAt(yt++),nt==this.blockSize){b(this,tt),nt=0;break}}else for(;yt<Oe;)if(tt[nt++]=qe[yt++],nt==this.blockSize){b(this,tt),nt=0;break}}this.h=nt,this.o+=Oe},p.prototype.A=function(){var qe=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);qe[0]=128;for(var Oe=1;Oe<qe.length-8;++Oe)qe[Oe]=0;Oe=this.o*8;for(var je=qe.length-8;je<qe.length;++je)qe[je]=Oe&255,Oe/=256;for(this.v(qe),qe=Array(16),Oe=0,je=0;je<4;++je)for(let tt=0;tt<32;tt+=8)qe[Oe++]=this.g[je]>>>tt&255;return qe};function I(qe,Oe){var je=s;return Object.prototype.hasOwnProperty.call(je,qe)?je[qe]:je[qe]=Oe(qe)}function P(qe,Oe){this.h=Oe;const je=[];let tt=!0;for(let nt=qe.length-1;nt>=0;nt--){const yt=qe[nt]|0;tt&&yt==Oe||(je[nt]=yt,tt=!1)}this.g=je}var s={};function G(qe){return-128<=qe&&qe<128?I(qe,function(Oe){return new P([Oe|0],Oe<0?-1:0)}):new P([qe|0],qe<0?-1:0)}function q(qe){if(isNaN(qe)||!isFinite(qe))return ce;if(qe<0)return Ze(q(-qe));const Oe=[];let je=1;for(let tt=0;qe>=je;tt++)Oe[tt]=qe/je|0,je*=4294967296;return new P(Oe,0)}function ie(qe,Oe){if(qe.length==0)throw Error("number format error: empty string");if(Oe=Oe||10,Oe<2||36<Oe)throw Error("radix out of range: "+Oe);if(qe.charAt(0)=="-")return Ze(ie(qe.substring(1),Oe));if(qe.indexOf("-")>=0)throw Error('number format error: interior "-" character');const je=q(Math.pow(Oe,8));let tt=ce;for(let yt=0;yt<qe.length;yt+=8){var nt=Math.min(8,qe.length-yt);const ze=parseInt(qe.substring(yt,yt+nt),Oe);nt<8?(nt=q(Math.pow(Oe,nt)),tt=tt.j(nt).add(q(ze))):(tt=tt.j(je),tt=tt.add(q(ze)))}return tt}var ce=G(0),be=G(1),He=G(16777216);c=P.prototype,c.m=function(){if(it(this))return-Ze(this).m();let qe=0,Oe=1;for(let je=0;je<this.g.length;je++){const tt=this.i(je);qe+=(tt>=0?tt:4294967296+tt)*Oe,Oe*=4294967296}return qe},c.toString=function(qe){if(qe=qe||10,qe<2||36<qe)throw Error("radix out of range: "+qe);if(Je(this))return"0";if(it(this))return"-"+Ze(this).toString(qe);const Oe=q(Math.pow(qe,6));var je=this;let tt="";for(;;){const nt=ei(je,Oe).g;je=Pt(je,nt.j(Oe));let yt=((je.g.length>0?je.g[0]:je.h)>>>0).toString(qe);if(je=nt,Je(je))return yt+tt;for(;yt.length<6;)yt="0"+yt;tt=yt+tt}},c.i=function(qe){return qe<0?0:qe<this.g.length?this.g[qe]:this.h};function Je(qe){if(qe.h!=0)return!1;for(let Oe=0;Oe<qe.g.length;Oe++)if(qe.g[Oe]!=0)return!1;return!0}function it(qe){return qe.h==-1}c.l=function(qe){return qe=Pt(this,qe),it(qe)?-1:Je(qe)?0:1};function Ze(qe){const Oe=qe.g.length,je=[];for(let tt=0;tt<Oe;tt++)je[tt]=~qe.g[tt];return new P(je,~qe.h).add(be)}c.abs=function(){return it(this)?Ze(this):this},c.add=function(qe){const Oe=Math.max(this.g.length,qe.g.length),je=[];let tt=0;for(let nt=0;nt<=Oe;nt++){let yt=tt+(this.i(nt)&65535)+(qe.i(nt)&65535),ze=(yt>>>16)+(this.i(nt)>>>16)+(qe.i(nt)>>>16);tt=ze>>>16,yt&=65535,ze&=65535,je[nt]=ze<<16|yt}return new P(je,je[je.length-1]&-2147483648?-1:0)};function Pt(qe,Oe){return qe.add(Ze(Oe))}c.j=function(qe){if(Je(this)||Je(qe))return ce;if(it(this))return it(qe)?Ze(this).j(Ze(qe)):Ze(Ze(this).j(qe));if(it(qe))return Ze(this.j(Ze(qe)));if(this.l(He)<0&&qe.l(He)<0)return q(this.m()*qe.m());const Oe=this.g.length+qe.g.length,je=[];for(var tt=0;tt<2*Oe;tt++)je[tt]=0;for(tt=0;tt<this.g.length;tt++)for(let nt=0;nt<qe.g.length;nt++){const yt=this.i(tt)>>>16,ze=this.i(tt)&65535,ur=qe.i(nt)>>>16,qn=qe.i(nt)&65535;je[2*tt+2*nt]+=ze*qn,ct(je,2*tt+2*nt),je[2*tt+2*nt+1]+=yt*qn,ct(je,2*tt+2*nt+1),je[2*tt+2*nt+1]+=ze*ur,ct(je,2*tt+2*nt+1),je[2*tt+2*nt+2]+=yt*ur,ct(je,2*tt+2*nt+2)}for(qe=0;qe<Oe;qe++)je[qe]=je[2*qe+1]<<16|je[2*qe];for(qe=Oe;qe<2*Oe;qe++)je[qe]=0;return new P(je,0)};function ct(qe,Oe){for(;(qe[Oe]&65535)!=qe[Oe];)qe[Oe+1]+=qe[Oe]>>>16,qe[Oe]&=65535,Oe++}function Gt(qe,Oe){this.g=qe,this.h=Oe}function ei(qe,Oe){if(Je(Oe))throw Error("division by zero");if(Je(qe))return new Gt(ce,ce);if(it(qe))return Oe=ei(Ze(qe),Oe),new Gt(Ze(Oe.g),Ze(Oe.h));if(it(Oe))return Oe=ei(qe,Ze(Oe)),new Gt(Ze(Oe.g),Oe.h);if(qe.g.length>30){if(it(qe)||it(Oe))throw Error("slowDivide_ only works with positive integers.");for(var je=be,tt=Oe;tt.l(qe)<=0;)je=Fi(je),tt=Fi(tt);var nt=Si(je,1),yt=Si(tt,1);for(tt=Si(tt,2),je=Si(je,2);!Je(tt);){var ze=yt.add(tt);ze.l(qe)<=0&&(nt=nt.add(je),yt=ze),tt=Si(tt,1),je=Si(je,1)}return Oe=Pt(qe,nt.j(Oe)),new Gt(nt,Oe)}for(nt=ce;qe.l(Oe)>=0;){for(je=Math.max(1,Math.floor(qe.m()/Oe.m())),tt=Math.ceil(Math.log(je)/Math.LN2),tt=tt<=48?1:Math.pow(2,tt-48),yt=q(je),ze=yt.j(Oe);it(ze)||ze.l(qe)>0;)je-=tt,yt=q(je),ze=yt.j(Oe);Je(yt)&&(yt=be),nt=nt.add(yt),qe=Pt(qe,ze)}return new Gt(nt,qe)}c.B=function(qe){return ei(this,qe).h},c.and=function(qe){const Oe=Math.max(this.g.length,qe.g.length),je=[];for(let tt=0;tt<Oe;tt++)je[tt]=this.i(tt)&qe.i(tt);return new P(je,this.h&qe.h)},c.or=function(qe){const Oe=Math.max(this.g.length,qe.g.length),je=[];for(let tt=0;tt<Oe;tt++)je[tt]=this.i(tt)|qe.i(tt);return new P(je,this.h|qe.h)},c.xor=function(qe){const Oe=Math.max(this.g.length,qe.g.length),je=[];for(let tt=0;tt<Oe;tt++)je[tt]=this.i(tt)^qe.i(tt);return new P(je,this.h^qe.h)};function Fi(qe){const Oe=qe.g.length+1,je=[];for(let tt=0;tt<Oe;tt++)je[tt]=qe.i(tt)<<1|qe.i(tt-1)>>>31;return new P(je,qe.h)}function Si(qe,Oe){const je=Oe>>5;Oe%=32;const tt=qe.g.length-je,nt=[];for(let yt=0;yt<tt;yt++)nt[yt]=Oe>0?qe.i(yt+je)>>>Oe|qe.i(yt+je+1)<<32-Oe:qe.i(yt+je);return new P(nt,qe.h)}p.prototype.digest=p.prototype.A,p.prototype.reset=p.prototype.u,p.prototype.update=p.prototype.v,mO=p,P.prototype.add=P.prototype.add,P.prototype.multiply=P.prototype.j,P.prototype.modulo=P.prototype.B,P.prototype.compare=P.prototype.l,P.prototype.toNumber=P.prototype.m,P.prototype.toString=P.prototype.toString,P.prototype.getBits=P.prototype.i,P.fromNumber=q,P.fromString=ie,Bm=P}).apply(typeof iR<"u"?iR:typeof self<"u"?self:typeof window<"u"?window:{});var bb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var gO,_0,_O,Pb,KT,yO,vO,xO;(function(){var c,n=Object.defineProperty;function l(z){z=[typeof globalThis=="object"&&globalThis,z,typeof window=="object"&&window,typeof self=="object"&&self,typeof bb=="object"&&bb];for(var Q=0;Q<z.length;++Q){var oe=z[Q];if(oe&&oe.Math==Math)return oe}throw Error("Cannot find global object")}var p=l(this);function b(z,Q){if(Q)e:{var oe=p;z=z.split(".");for(var De=0;De<z.length-1;De++){var Rt=z[De];if(!(Rt in oe))break e;oe=oe[Rt]}z=z[z.length-1],De=oe[z],Q=Q(De),Q!=De&&Q!=null&&n(oe,z,{configurable:!0,writable:!0,value:Q})}}b("Symbol.dispose",function(z){return z||Symbol("Symbol.dispose")}),b("Array.prototype.values",function(z){return z||function(){return this[Symbol.iterator]()}}),b("Object.entries",function(z){return z||function(Q){var oe=[],De;for(De in Q)Object.prototype.hasOwnProperty.call(Q,De)&&oe.push([De,Q[De]]);return oe}});var I=I||{},P=this||self;function s(z){var Q=typeof z;return Q=="object"&&z!=null||Q=="function"}function G(z,Q,oe){return z.call.apply(z.bind,arguments)}function q(z,Q,oe){return q=G,q.apply(null,arguments)}function ie(z,Q){var oe=Array.prototype.slice.call(arguments,1);return function(){var De=oe.slice();return De.push.apply(De,arguments),z.apply(this,De)}}function ce(z,Q){function oe(){}oe.prototype=Q.prototype,z.Z=Q.prototype,z.prototype=new oe,z.prototype.constructor=z,z.Ob=function(De,Rt,qt){for(var Ti=Array(arguments.length-2),on=2;on<arguments.length;on++)Ti[on-2]=arguments[on];return Q.prototype[Rt].apply(De,Ti)}}var be=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?z=>z&&AsyncContext.Snapshot.wrap(z):z=>z;function He(z){const Q=z.length;if(Q>0){const oe=Array(Q);for(let De=0;De<Q;De++)oe[De]=z[De];return oe}return[]}function Je(z,Q){for(let De=1;De<arguments.length;De++){const Rt=arguments[De];var oe=typeof Rt;if(oe=oe!="object"?oe:Rt?Array.isArray(Rt)?"array":oe:"null",oe=="array"||oe=="object"&&typeof Rt.length=="number"){oe=z.length||0;const qt=Rt.length||0;z.length=oe+qt;for(let Ti=0;Ti<qt;Ti++)z[oe+Ti]=Rt[Ti]}else z.push(Rt)}}class it{constructor(Q,oe){this.i=Q,this.j=oe,this.h=0,this.g=null}get(){let Q;return this.h>0?(this.h--,Q=this.g,this.g=Q.next,Q.next=null):Q=this.i(),Q}}function Ze(z){P.setTimeout(()=>{throw z},0)}function Pt(){var z=qe;let Q=null;return z.g&&(Q=z.g,z.g=z.g.next,z.g||(z.h=null),Q.next=null),Q}class ct{constructor(){this.h=this.g=null}add(Q,oe){const De=Gt.get();De.set(Q,oe),this.h?this.h.next=De:this.g=De,this.h=De}}var Gt=new it(()=>new ei,z=>z.reset());class ei{constructor(){this.next=this.g=this.h=null}set(Q,oe){this.h=Q,this.g=oe,this.next=null}reset(){this.next=this.g=this.h=null}}let Fi,Si=!1,qe=new ct,Oe=()=>{const z=Promise.resolve(void 0);Fi=()=>{z.then(je)}};function je(){for(var z;z=Pt();){try{z.h.call(z.g)}catch(oe){Ze(oe)}var Q=Gt;Q.j(z),Q.h<100&&(Q.h++,z.next=Q.g,Q.g=z)}Si=!1}function tt(){this.u=this.u,this.C=this.C}tt.prototype.u=!1,tt.prototype.dispose=function(){this.u||(this.u=!0,this.N())},tt.prototype[Symbol.dispose]=function(){this.dispose()},tt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function nt(z,Q){this.type=z,this.g=this.target=Q,this.defaultPrevented=!1}nt.prototype.h=function(){this.defaultPrevented=!0};var yt=(function(){if(!P.addEventListener||!Object.defineProperty)return!1;var z=!1,Q=Object.defineProperty({},"passive",{get:function(){z=!0}});try{const oe=()=>{};P.addEventListener("test",oe,Q),P.removeEventListener("test",oe,Q)}catch{}return z})();function ze(z){return/^[\s\xa0]*$/.test(z)}function ur(z,Q){nt.call(this,z?z.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,z&&this.init(z,Q)}ce(ur,nt),ur.prototype.init=function(z,Q){const oe=this.type=z.type,De=z.changedTouches&&z.changedTouches.length?z.changedTouches[0]:null;this.target=z.target||z.srcElement,this.g=Q,Q=z.relatedTarget,Q||(oe=="mouseover"?Q=z.fromElement:oe=="mouseout"&&(Q=z.toElement)),this.relatedTarget=Q,De?(this.clientX=De.clientX!==void 0?De.clientX:De.pageX,this.clientY=De.clientY!==void 0?De.clientY:De.pageY,this.screenX=De.screenX||0,this.screenY=De.screenY||0):(this.clientX=z.clientX!==void 0?z.clientX:z.pageX,this.clientY=z.clientY!==void 0?z.clientY:z.pageY,this.screenX=z.screenX||0,this.screenY=z.screenY||0),this.button=z.button,this.key=z.key||"",this.ctrlKey=z.ctrlKey,this.altKey=z.altKey,this.shiftKey=z.shiftKey,this.metaKey=z.metaKey,this.pointerId=z.pointerId||0,this.pointerType=z.pointerType,this.state=z.state,this.i=z,z.defaultPrevented&&ur.Z.h.call(this)},ur.prototype.h=function(){ur.Z.h.call(this);const z=this.i;z.preventDefault?z.preventDefault():z.returnValue=!1};var qn="closure_listenable_"+(Math.random()*1e6|0),Ct=0;function oi(z,Q,oe,De,Rt){this.listener=z,this.proxy=null,this.src=Q,this.type=oe,this.capture=!!De,this.ha=Rt,this.key=++Ct,this.da=this.fa=!1}function wi(z){z.da=!0,z.listener=null,z.proxy=null,z.src=null,z.ha=null}function bn(z,Q,oe){for(const De in z)Q.call(oe,z[De],De,z)}function Cn(z,Q){for(const oe in z)Q.call(void 0,z[oe],oe,z)}function rt(z){const Q={};for(const oe in z)Q[oe]=z[oe];return Q}const Yt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ai(z,Q){let oe,De;for(let Rt=1;Rt<arguments.length;Rt++){De=arguments[Rt];for(oe in De)z[oe]=De[oe];for(let qt=0;qt<Yt.length;qt++)oe=Yt[qt],Object.prototype.hasOwnProperty.call(De,oe)&&(z[oe]=De[oe])}}function _i(z){this.src=z,this.g={},this.h=0}_i.prototype.add=function(z,Q,oe,De,Rt){const qt=z.toString();z=this.g[qt],z||(z=this.g[qt]=[],this.h++);const Ti=kn(z,Q,De,Rt);return Ti>-1?(Q=z[Ti],oe||(Q.fa=!1)):(Q=new oi(Q,this.src,qt,!!De,Rt),Q.fa=oe,z.push(Q)),Q};function ln(z,Q){const oe=Q.type;if(oe in z.g){var De=z.g[oe],Rt=Array.prototype.indexOf.call(De,Q,void 0),qt;(qt=Rt>=0)&&Array.prototype.splice.call(De,Rt,1),qt&&(wi(Q),z.g[oe].length==0&&(delete z.g[oe],z.h--))}}function kn(z,Q,oe,De){for(let Rt=0;Rt<z.length;++Rt){const qt=z[Rt];if(!qt.da&&qt.listener==Q&&qt.capture==!!oe&&qt.ha==De)return Rt}return-1}var Jn="closure_lm_"+(Math.random()*1e6|0),Mr={};function Ki(z,Q,oe,De,Rt){if(Array.isArray(Q)){for(let qt=0;qt<Q.length;qt++)Ki(z,Q[qt],oe,De,Rt);return null}return oe=Dr(oe),z&&z[qn]?z.J(Q,oe,s(De)?!!De.capture:!1,Rt):hr(z,Q,oe,!1,De,Rt)}function hr(z,Q,oe,De,Rt,qt){if(!Q)throw Error("Invalid event type");const Ti=s(Rt)?!!Rt.capture:!!Rt;let on=Ds(z);if(on||(z[Jn]=on=new _i(z)),oe=on.add(Q,oe,De,Ti,qt),oe.proxy)return oe;if(De=Wr(),oe.proxy=De,De.src=z,De.listener=oe,z.addEventListener)yt||(Rt=Ti),Rt===void 0&&(Rt=!1),z.addEventListener(Q.toString(),De,Rt);else if(z.attachEvent)z.attachEvent(ps(Q.toString()),De);else if(z.addListener&&z.removeListener)z.addListener(De);else throw Error("addEventListener and attachEvent are unavailable.");return oe}function Wr(){function z(oe){return Q.call(z.src,z.listener,oe)}const Q=rr;return z}function co(z,Q,oe,De,Rt){if(Array.isArray(Q))for(var qt=0;qt<Q.length;qt++)co(z,Q[qt],oe,De,Rt);else De=s(De)?!!De.capture:!!De,oe=Dr(oe),z&&z[qn]?(z=z.i,qt=String(Q).toString(),qt in z.g&&(Q=z.g[qt],oe=kn(Q,oe,De,Rt),oe>-1&&(wi(Q[oe]),Array.prototype.splice.call(Q,oe,1),Q.length==0&&(delete z.g[qt],z.h--)))):z&&(z=Ds(z))&&(Q=z.g[Q.toString()],z=-1,Q&&(z=kn(Q,oe,De,Rt)),(oe=z>-1?Q[z]:null)&&nr(oe))}function nr(z){if(typeof z!="number"&&z&&!z.da){var Q=z.src;if(Q&&Q[qn])ln(Q.i,z);else{var oe=z.type,De=z.proxy;Q.removeEventListener?Q.removeEventListener(oe,De,z.capture):Q.detachEvent?Q.detachEvent(ps(oe),De):Q.addListener&&Q.removeListener&&Q.removeListener(De),(oe=Ds(Q))?(ln(oe,z),oe.h==0&&(oe.src=null,Q[Jn]=null)):wi(z)}}}function ps(z){return z in Mr?Mr[z]:Mr[z]="on"+z}function rr(z,Q){if(z.da)z=!0;else{Q=new ur(Q,this);const oe=z.listener,De=z.ha||z.src;z.fa&&nr(z),z=oe.call(De,Q)}return z}function Ds(z){return z=z[Jn],z instanceof _i?z:null}var Us="__closure_events_fn_"+(Math.random()*1e9>>>0);function Dr(z){return typeof z=="function"?z:(z[Us]||(z[Us]=function(Q){return z.handleEvent(Q)}),z[Us])}function ms(){tt.call(this),this.i=new _i(this),this.M=this,this.G=null}ce(ms,tt),ms.prototype[qn]=!0,ms.prototype.removeEventListener=function(z,Q,oe,De){co(this,z,Q,oe,De)};function hs(z,Q){var oe,De=z.G;if(De)for(oe=[];De;De=De.G)oe.push(De);if(z=z.M,De=Q.type||Q,typeof Q=="string")Q=new nt(Q,z);else if(Q instanceof nt)Q.target=Q.target||z;else{var Rt=Q;Q=new nt(De,z),ai(Q,Rt)}Rt=!0;let qt,Ti;if(oe)for(Ti=oe.length-1;Ti>=0;Ti--)qt=Q.g=oe[Ti],Rt=Di(qt,De,!0,Q)&&Rt;if(qt=Q.g=z,Rt=Di(qt,De,!0,Q)&&Rt,Rt=Di(qt,De,!1,Q)&&Rt,oe)for(Ti=0;Ti<oe.length;Ti++)qt=Q.g=oe[Ti],Rt=Di(qt,De,!1,Q)&&Rt}ms.prototype.N=function(){if(ms.Z.N.call(this),this.i){var z=this.i;for(const Q in z.g){const oe=z.g[Q];for(let De=0;De<oe.length;De++)wi(oe[De]);delete z.g[Q],z.h--}}this.G=null},ms.prototype.J=function(z,Q,oe,De){return this.i.add(String(z),Q,!1,oe,De)},ms.prototype.K=function(z,Q,oe,De){return this.i.add(String(z),Q,!0,oe,De)};function Di(z,Q,oe,De){if(Q=z.i.g[String(Q)],!Q)return!0;Q=Q.concat();let Rt=!0;for(let qt=0;qt<Q.length;++qt){const Ti=Q[qt];if(Ti&&!Ti.da&&Ti.capture==oe){const on=Ti.listener,io=Ti.ha||Ti.src;Ti.fa&&ln(z.i,Ti),Rt=on.call(io,De)!==!1&&Rt}}return Rt&&!De.defaultPrevented}function rn(z,Q){if(typeof z!="function")if(z&&typeof z.handleEvent=="function")z=q(z.handleEvent,z);else throw Error("Invalid listener argument");return Number(Q)>2147483647?-1:P.setTimeout(z,Q||0)}function vn(z){z.g=rn(()=>{z.g=null,z.i&&(z.i=!1,vn(z))},z.l);const Q=z.h;z.h=null,z.m.apply(null,Q)}class $i extends tt{constructor(Q,oe){super(),this.m=Q,this.l=oe,this.h=null,this.i=!1,this.g=null}j(Q){this.h=arguments,this.g?this.i=!0:vn(this)}N(){super.N(),this.g&&(P.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ks(z){tt.call(this),this.h=z,this.g={}}ce(Ks,tt);var Kn=[];function uo(z){bn(z.g,function(Q,oe){this.g.hasOwnProperty(oe)&&nr(Q)},z),z.g={}}Ks.prototype.N=function(){Ks.Z.N.call(this),uo(this)},Ks.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Uo=P.JSON.stringify,jo=P.JSON.parse,ac=class{stringify(z){return P.JSON.stringify(z,void 0)}parse(z){return P.JSON.parse(z,void 0)}};function $a(){}function Nc(){}var Yo={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function pr(){nt.call(this,"d")}ce(pr,nt);function Co(){nt.call(this,"c")}ce(Co,nt);var Ts={},cl=null;function Qo(){return cl=cl||new ms}Ts.Ia="serverreachability";function ma(z){nt.call(this,Ts.Ia,z)}ce(ma,nt);function dr(z){const Q=Qo();hs(Q,new ma(Q))}Ts.STAT_EVENT="statevent";function Ps(z,Q){nt.call(this,Ts.STAT_EVENT,z),this.stat=Q}ce(Ps,nt);function Es(z){const Q=Qo();hs(Q,new Ps(Q,z))}Ts.Ja="timingevent";function Go(z,Q){nt.call(this,Ts.Ja,z),this.size=Q}ce(Go,nt);function js(z,Q){if(typeof z!="function")throw Error("Fn must not be null and must be a function");return P.setTimeout(function(){z()},Q)}function Ma(){this.g=!0}Ma.prototype.ua=function(){this.g=!1};function ih(z,Q,oe,De,Rt,qt){z.info(function(){if(z.g)if(qt){var Ti="",on=qt.split("&");for(let Pr=0;Pr<on.length;Pr++){var io=on[Pr].split("=");if(io.length>1){const As=io[0];io=io[1];const na=As.split("_");Ti=na.length>=2&&na[1]=="type"?Ti+(As+"="+io+"&"):Ti+(As+"=redacted&")}}}else Ti=null;else Ti=qt;return"XMLHTTP REQ ("+De+") [attempt "+Rt+"]: "+Q+`
`+oe+`
`+Ti})}function ad(z,Q,oe,De,Rt,qt,Ti){z.info(function(){return"XMLHTTP RESP ("+De+") [ attempt "+Rt+"]: "+Q+`
`+oe+`
`+qt+" "+Ti})}function ga(z,Q,oe,De){z.info(function(){return"XMLHTTP TEXT ("+Q+"): "+Fl(z,oe)+(De?" "+De:"")})}function St(z,Q){z.info(function(){return"TIMEOUT: "+Q})}Ma.prototype.info=function(){};function Fl(z,Q){if(!z.g)return Q;if(!Q)return null;try{const qt=JSON.parse(Q);if(qt){for(z=0;z<qt.length;z++)if(Array.isArray(qt[z])){var oe=qt[z];if(!(oe.length<2)){var De=oe[1];if(Array.isArray(De)&&!(De.length<1)){var Rt=De[0];if(Rt!="noop"&&Rt!="stop"&&Rt!="close")for(let Ti=1;Ti<De.length;Ti++)De[Ti]=""}}}}return Uo(qt)}catch{return Q}}var Bl={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Vc={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},gn;function Ls(){}ce(Ls,$a),Ls.prototype.g=function(){return new XMLHttpRequest},gn=new Ls;function Nl(z){return encodeURIComponent(String(z))}function _u(z){var Q=1;z=z.split(":");const oe=[];for(;Q>0&&z.length;)oe.push(z.shift()),Q--;return z.length&&oe.push(z.join(":")),oe}function Ne(z,Q,oe,De){this.j=z,this.i=Q,this.l=oe,this.S=De||1,this.V=new Ks(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Y}function Y(){this.i=null,this.g="",this.h=!1}var J={},de={};function Re(z,Q,oe){z.M=1,z.A=Ro(Pn(Q)),z.u=oe,z.R=!0,Ce(z,null)}function Ce(z,Q){z.F=Date.now(),We(z),z.B=Pn(z.A);var oe=z.B,De=z.S;Array.isArray(De)||(De=[String(De)]),Js(oe.i,"t",De),z.C=0,oe=z.j.L,z.h=new Y,z.g=pl(z.j,oe?Q:null,!z.u),z.P>0&&(z.O=new $i(q(z.Y,z,z.g),z.P)),Q=z.V,oe=z.g,De=z.ba;var Rt="readystatechange";Array.isArray(Rt)||(Rt&&(Kn[0]=Rt.toString()),Rt=Kn);for(let qt=0;qt<Rt.length;qt++){const Ti=Ki(oe,Rt[qt],De||Q.handleEvent,!1,Q.h||Q);if(!Ti)break;Q.g[Ti.key]=Ti}Q=z.J?rt(z.J):{},z.u?(z.v||(z.v="POST"),Q["Content-Type"]="application/x-www-form-urlencoded",z.g.ea(z.B,z.v,z.u,Q)):(z.v="GET",z.g.ea(z.B,z.v,null,Q)),dr(),ih(z.i,z.v,z.B,z.l,z.S,z.u)}Ne.prototype.ba=function(z){z=z.target;const Q=this.O;Q&&xa(z)==3?Q.j():this.Y(z)},Ne.prototype.Y=function(z){try{if(z==this.g)e:{const on=xa(this.g),io=this.g.ya(),Pr=this.g.ca();if(!(on<3)&&(on!=3||this.g&&(this.h.h||this.g.la()||to(this.g)))){this.K||on!=4||io==7||(io==8||Pr<=0?dr(3):dr(2)),xt(this);var Q=this.g.ca();this.X=Q;var oe=Fe(this);if(this.o=Q==200,ad(this.i,this.v,this.B,this.l,this.S,on,Q),this.o){if(this.U&&!this.L){t:{if(this.g){var De,Rt=this.g;if((De=Rt.g?Rt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ze(De)){var qt=De;break t}}qt=null}if(z=qt)ga(this.i,this.l,z,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ci(this,z);else{this.o=!1,this.m=3,Es(12),Ii(this),ui(this);break e}}if(this.R){z=!0;let As;for(;!this.K&&this.C<oe.length;)if(As=Be(this,oe),As==de){on==4&&(this.m=4,Es(14),z=!1),ga(this.i,this.l,null,"[Incomplete Response]");break}else if(As==J){this.m=4,Es(15),ga(this.i,this.l,oe,"[Invalid Chunk]"),z=!1;break}else ga(this.i,this.l,As,null),Ci(this,As);if(Ye(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),on!=4||oe.length!=0||this.h.h||(this.m=1,Es(16),z=!1),this.o=this.o&&z,!z)ga(this.i,this.l,oe,"[Invalid Chunked Response]"),Ii(this),ui(this);else if(oe.length>0&&!this.W){this.W=!0;var Ti=this.j;Ti.g==this&&Ti.aa&&!Ti.P&&(Ti.j.info("Great, no buffering proxy detected. Bytes received: "+oe.length),rh(Ti),Ti.P=!0,Es(11))}}else ga(this.i,this.l,oe,null),Ci(this,oe);on==4&&Ii(this),this.o&&!this.K&&(on==4?cd(this.j,this):(this.o=!1,We(this)))}else Wa(this.g),Q==400&&oe.indexOf("Unknown SID")>0?(this.m=3,Es(12)):(this.m=0,Es(13)),Ii(this),ui(this)}}}catch{}finally{}};function Fe(z){if(!Ye(z))return z.g.la();const Q=to(z.g);if(Q==="")return"";let oe="";const De=Q.length,Rt=xa(z.g)==4;if(!z.h.i){if(typeof TextDecoder>"u")return Ii(z),ui(z),"";z.h.i=new P.TextDecoder}for(let qt=0;qt<De;qt++)z.h.h=!0,oe+=z.h.i.decode(Q[qt],{stream:!(Rt&&qt==De-1)});return Q.length=0,z.h.g+=oe,z.C=0,z.h.g}function Ye(z){return z.g?z.v=="GET"&&z.M!=2&&z.j.Aa:!1}function Be(z,Q){var oe=z.C,De=Q.indexOf(`
`,oe);return De==-1?de:(oe=Number(Q.substring(oe,De)),isNaN(oe)?J:(De+=1,De+oe>Q.length?de:(Q=Q.slice(De,De+oe),z.C=De+oe,Q)))}Ne.prototype.cancel=function(){this.K=!0,Ii(this)};function We(z){z.T=Date.now()+z.H,Ot(z,z.H)}function Ot(z,Q){if(z.D!=null)throw Error("WatchDog timer not null");z.D=js(q(z.aa,z),Q)}function xt(z){z.D&&(P.clearTimeout(z.D),z.D=null)}Ne.prototype.aa=function(){this.D=null;const z=Date.now();z-this.T>=0?(St(this.i,this.B),this.M!=2&&(dr(),Es(17)),Ii(this),this.m=2,ui(this)):Ot(this,this.T-z)};function ui(z){z.j.I==0||z.K||cd(z.j,z)}function Ii(z){xt(z);var Q=z.O;Q&&typeof Q.dispose=="function"&&Q.dispose(),z.O=null,uo(z.V),z.g&&(Q=z.g,z.g=null,Q.abort(),Q.dispose())}function Ci(z,Q){try{var oe=z.j;if(oe.I!=0&&(oe.g==z||mr(oe.h,z))){if(!z.L&&mr(oe.h,z)&&oe.I==3){try{var De=oe.Ba.g.parse(Q)}catch{De=null}if(Array.isArray(De)&&De.length==3){var Rt=De;if(Rt[0]==0){e:if(!oe.v){if(oe.g)if(oe.g.F+3e3<z.F)On(oe),wu(oe);else break e;Hc(oe),Es(18)}}else oe.xa=Rt[1],0<oe.xa-oe.K&&Rt[2]<37500&&oe.F&&oe.A==0&&!oe.C&&(oe.C=js(q(oe.Va,oe),6e3));Rn(oe.h)<=1&&oe.ta&&(oe.ta=void 0)}else Gl(oe,11)}else if((z.L||oe.g==z)&&On(oe),!ze(Q))for(Rt=oe.Ba.g.parse(Q),Q=0;Q<Rt.length;Q++){let Pr=Rt[Q];const As=Pr[0];if(!(As<=oe.K))if(oe.K=As,Pr=Pr[1],oe.I==2)if(Pr[0]=="c"){oe.M=Pr[1],oe.ba=Pr[2];const na=Pr[3];na!=null&&(oe.ka=na,oe.j.info("VER="+oe.ka));const Za=Pr[4];Za!=null&&(oe.za=Za,oe.j.info("SVER="+oe.za));const Xa=Pr[5];Xa!=null&&typeof Xa=="number"&&Xa>0&&(De=1.5*Xa,oe.O=De,oe.j.info("backChannelRequestTimeoutMs_="+De)),De=oe;const wa=z.g;if(wa){const ws=wa.g?wa.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ws){var qt=De.h;qt.g||ws.indexOf("spdy")==-1&&ws.indexOf("quic")==-1&&ws.indexOf("h2")==-1||(qt.j=qt.l,qt.g=new Set,qt.h&&(ds(qt,qt.h),qt.h=null))}if(De.G){const Oa=wa.g?wa.g.getResponseHeader("X-HTTP-Session-Id"):null;Oa&&(De.wa=Oa,er(De.J,De.G,Oa))}}oe.I=3,oe.l&&oe.l.ra(),oe.aa&&(oe.T=Date.now()-z.F,oe.j.info("Handshake RTT: "+oe.T+"ms")),De=oe;var Ti=z;if(De.na=Tu(De,De.L?De.ba:null,De.W),Ti.L){Zr(De.h,Ti);var on=Ti,io=De.O;io&&(on.H=io),on.D&&(xt(on),We(on)),De.g=Ti}else Ss(De);oe.i.length>0&&Gs(oe)}else Pr[0]!="stop"&&Pr[0]!="close"||Gl(oe,7);else oe.I==3&&(Pr[0]=="stop"||Pr[0]=="close"?Pr[0]=="stop"?Gl(oe,7):bu(oe):Pr[0]!="noop"&&oe.l&&oe.l.qa(Pr),oe.A=0)}}dr(4)}catch{}}var gi=class{constructor(z,Q){this.g=z,this.map=Q}};function en(z){this.l=z||10,P.PerformanceNavigationTiming?(z=P.performance.getEntriesByType("navigation"),z=z.length>0&&(z[0].nextHopProtocol=="hq"||z[0].nextHopProtocol=="h2")):z=!!(P.chrome&&P.chrome.loadTimes&&P.chrome.loadTimes()&&P.chrome.loadTimes().wasFetchedViaSpdy),this.j=z?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function sn(z){return z.h?!0:z.g?z.g.size>=z.j:!1}function Rn(z){return z.h?1:z.g?z.g.size:0}function mr(z,Q){return z.h?z.h==Q:z.g?z.g.has(Q):!1}function ds(z,Q){z.g?z.g.add(Q):z.h=Q}function Zr(z,Q){z.h&&z.h==Q?z.h=null:z.g&&z.g.has(Q)&&z.g.delete(Q)}en.prototype.cancel=function(){if(this.i=Gr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const z of this.g.values())z.cancel();this.g.clear()}};function Gr(z){if(z.h!=null)return z.i.concat(z.h.G);if(z.g!=null&&z.g.size!==0){let Q=z.i;for(const oe of z.g.values())Q=Q.concat(oe.G);return Q}return He(z.i)}var Hn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dn(z,Q){if(z){z=z.split("&");for(let oe=0;oe<z.length;oe++){const De=z[oe].indexOf("=");let Rt,qt=null;De>=0?(Rt=z[oe].substring(0,De),qt=z[oe].substring(De+1)):Rt=z[oe],Q(Rt,qt?decodeURIComponent(qt.replace(/\+/g," ")):"")}}}function jn(z){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let Q;z instanceof jn?(this.l=z.l,fn(this,z.j),this.o=z.o,this.g=z.g,or(this,z.u),this.h=z.h,bs(this,ea(z.i)),this.m=z.m):z&&(Q=String(z).match(Hn))?(this.l=!1,fn(this,Q[1]||"",!0),this.o=Jo(Q[2]||""),this.g=Jo(Q[3]||"",!0),or(this,Q[4]),this.h=Jo(Q[5]||"",!0),bs(this,Q[6]||"",!0),this.m=Jo(Q[7]||"")):(this.l=!1,this.i=new ul(null,this.l))}jn.prototype.toString=function(){const z=[];var Q=this.j;Q&&z.push(gs(Q,Ys,!0),":");var oe=this.g;return(oe||Q=="file")&&(z.push("//"),(Q=this.o)&&z.push(gs(Q,Ys,!0),"@"),z.push(Nl(oe).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),oe=this.u,oe!=null&&z.push(":",String(oe))),(oe=this.h)&&(this.g&&oe.charAt(0)!="/"&&z.push("/"),z.push(gs(oe,oe.charAt(0)=="/"?Mo:Da,!0))),(oe=this.i.toString())&&z.push("?",oe),(oe=this.m)&&z.push("#",gs(oe,nh)),z.join("")},jn.prototype.resolve=function(z){const Q=Pn(this);let oe=!!z.j;oe?fn(Q,z.j):oe=!!z.o,oe?Q.o=z.o:oe=!!z.g,oe?Q.g=z.g:oe=z.u!=null;var De=z.h;if(oe)or(Q,z.u);else if(oe=!!z.h){if(De.charAt(0)!="/")if(this.g&&!this.h)De="/"+De;else{var Rt=Q.h.lastIndexOf("/");Rt!=-1&&(De=Q.h.slice(0,Rt+1)+De)}if(Rt=De,Rt==".."||Rt==".")De="";else if(Rt.indexOf("./")!=-1||Rt.indexOf("/.")!=-1){De=Rt.lastIndexOf("/",0)==0,Rt=Rt.split("/");const qt=[];for(let Ti=0;Ti<Rt.length;){const on=Rt[Ti++];on=="."?De&&Ti==Rt.length&&qt.push(""):on==".."?((qt.length>1||qt.length==1&&qt[0]!="")&&qt.pop(),De&&Ti==Rt.length&&qt.push("")):(qt.push(on),De=!0)}De=qt.join("/")}else De=Rt}return oe?Q.h=De:oe=z.i.toString()!=="",oe?bs(Q,ea(z.i)):oe=!!z.m,oe&&(Q.m=z.m),Q};function Pn(z){return new jn(z)}function fn(z,Q,oe){z.j=oe?Jo(Q,!0):Q,z.j&&(z.j=z.j.replace(/:$/,""))}function or(z,Q){if(Q){if(Q=Number(Q),isNaN(Q)||Q<0)throw Error("Bad port number "+Q);z.u=Q}else z.u=null}function bs(z,Q,oe){Q instanceof ul?(z.i=Q,hl(z.i,z.l)):(oe||(Q=gs(Q,Qs)),z.i=new ul(Q,z.l))}function er(z,Q,oe){z.i.set(Q,oe)}function Ro(z){return er(z,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),z}function Jo(z,Q){return z?Q?decodeURI(z.replace(/%25/g,"%2525")):decodeURIComponent(z):""}function gs(z,Q,oe){return typeof z=="string"?(z=encodeURI(z).replace(Q,Ms),oe&&(z=z.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),z):null}function Ms(z){return z=z.charCodeAt(0),"%"+(z>>4&15).toString(16)+(z&15).toString(16)}var Ys=/[#\/\?@]/g,Da=/[#\?:]/g,Mo=/[#\?]/g,Qs=/[#\?@]/g,nh=/#/g;function ul(z,Q){this.h=this.g=null,this.i=z||null,this.j=!!Q}function Do(z){z.g||(z.g=new Map,z.h=0,z.i&&dn(z.i,function(Q,oe){z.add(decodeURIComponent(Q.replace(/\+/g," ")),oe)}))}c=ul.prototype,c.add=function(z,Q){Do(this),this.i=null,z=ta(this,z);let oe=this.g.get(z);return oe||this.g.set(z,oe=[]),oe.push(Q),this.h+=1,this};function yu(z,Q){Do(z),Q=ta(z,Q),z.g.has(Q)&&(z.i=null,z.h-=z.g.get(Q).length,z.g.delete(Q))}function bo(z,Q){return Do(z),Q=ta(z,Q),z.g.has(Q)}c.forEach=function(z,Q){Do(this),this.g.forEach(function(oe,De){oe.forEach(function(Rt){z.call(Q,Rt,De,this)},this)},this)};function _a(z,Q){Do(z);let oe=[];if(typeof Q=="string")bo(z,Q)&&(oe=oe.concat(z.g.get(ta(z,Q))));else for(z=Array.from(z.g.values()),Q=0;Q<z.length;Q++)oe=oe.concat(z[Q]);return oe}c.set=function(z,Q){return Do(this),this.i=null,z=ta(this,z),bo(this,z)&&(this.h-=this.g.get(z).length),this.g.set(z,[Q]),this.h+=1,this},c.get=function(z,Q){return z?(z=_a(this,z),z.length>0?String(z[0]):Q):Q};function Js(z,Q,oe){yu(z,Q),oe.length>0&&(z.i=null,z.g.set(ta(z,Q),He(oe)),z.h+=oe.length)}c.toString=function(){if(this.i)return this.i;if(!this.g)return"";const z=[],Q=Array.from(this.g.keys());for(let De=0;De<Q.length;De++){var oe=Q[De];const Rt=Nl(oe);oe=_a(this,oe);for(let qt=0;qt<oe.length;qt++){let Ti=Rt;oe[qt]!==""&&(Ti+="="+Nl(oe[qt])),z.push(Ti)}}return this.i=z.join("&")};function ea(z){const Q=new ul;return Q.i=z.i,z.g&&(Q.g=new Map(z.g),Q.h=z.h),Q}function ta(z,Q){return Q=String(Q),z.j&&(Q=Q.toLowerCase()),Q}function hl(z,Q){Q&&!z.j&&(Do(z),z.i=null,z.g.forEach(function(oe,De){const Rt=De.toLowerCase();De!=Rt&&(yu(this,De),Js(this,Rt,oe))},z)),z.j=Q}function Pa(z,Q){const oe=new Ma;if(P.Image){const De=new Image;De.onload=ie(eo,oe,"TestLoadImage: loaded",!0,Q,De),De.onerror=ie(eo,oe,"TestLoadImage: error",!1,Q,De),De.onabort=ie(eo,oe,"TestLoadImage: abort",!1,Q,De),De.ontimeout=ie(eo,oe,"TestLoadImage: timeout",!1,Q,De),P.setTimeout(function(){De.ontimeout&&De.ontimeout()},1e4),De.src=z}else Q(!1)}function vu(z,Q){const oe=new Ma,De=new AbortController,Rt=setTimeout(()=>{De.abort(),eo(oe,"TestPingServer: timeout",!1,Q)},1e4);fetch(z,{signal:De.signal}).then(qt=>{clearTimeout(Rt),qt.ok?eo(oe,"TestPingServer: ok",!0,Q):eo(oe,"TestPingServer: server error",!1,Q)}).catch(()=>{clearTimeout(Rt),eo(oe,"TestPingServer: error",!1,Q)})}function eo(z,Q,oe,De,Rt){try{Rt&&(Rt.onload=null,Rt.onerror=null,Rt.onabort=null,Rt.ontimeout=null),De(oe)}catch{}}function ya(){this.g=new ac}function dl(z){this.i=z.Sb||null,this.h=z.ab||!1}ce(dl,$a),dl.prototype.g=function(){return new xu(this.i,this.h)};function xu(z,Q){ms.call(this),this.H=z,this.o=Q,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}ce(xu,ms),c=xu.prototype,c.open=function(z,Q){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=z,this.D=Q,this.readyState=1,Ho(this)},c.send=function(z){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const Q={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};z&&(Q.body=z),(this.H||P).fetch(new Request(this.D,Q)).then(this.Pa.bind(this),this.ga.bind(this))},c.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,lc(this)),this.readyState=0},c.Pa=function(z){if(this.g&&(this.l=z,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=z.headers,this.readyState=2,Ho(this)),this.g&&(this.readyState=3,Ho(this),this.g)))if(this.responseType==="arraybuffer")z.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof P.ReadableStream<"u"&&"body"in z){if(this.j=z.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;qo(this)}else z.text().then(this.Oa.bind(this),this.ga.bind(this))};function qo(z){z.j.read().then(z.Ma.bind(z)).catch(z.ga.bind(z))}c.Ma=function(z){if(this.g){if(this.o&&z.value)this.response.push(z.value);else if(!this.o){var Q=z.value?z.value:new Uint8Array(0);(Q=this.B.decode(Q,{stream:!z.done}))&&(this.response=this.responseText+=Q)}z.done?lc(this):Ho(this),this.readyState==3&&qo(this)}},c.Oa=function(z){this.g&&(this.response=this.responseText=z,lc(this))},c.Na=function(z){this.g&&(this.response=z,lc(this))},c.ga=function(){this.g&&lc(this)};function lc(z){z.readyState=4,z.l=null,z.j=null,z.B=null,Ho(z)}c.setRequestHeader=function(z,Q){this.A.append(z,Q)},c.getResponseHeader=function(z){return this.h&&this.h.get(z.toLowerCase())||""},c.getAllResponseHeaders=function(){if(!this.h)return"";const z=[],Q=this.h.entries();for(var oe=Q.next();!oe.done;)oe=oe.value,z.push(oe[0]+": "+oe[1]),oe=Q.next();return z.join(`\r
`)};function Ho(z){z.onreadystatechange&&z.onreadystatechange.call(z)}Object.defineProperty(xu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(z){this.m=z?"include":"same-origin"}});function Po(z){let Q="";return bn(z,function(oe,De){Q+=De,Q+=":",Q+=oe,Q+=`\r
`}),Q}function Uc(z,Q,oe){e:{for(De in oe){var De=!1;break e}De=!0}De||(oe=Po(oe),typeof z=="string"?oe!=null&&Nl(oe):er(z,Q,oe))}function Xr(z){ms.call(this),this.headers=new Map,this.L=z||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}ce(Xr,ms);var va=/^https?$/i,Mn=["POST","PUT"];c=Xr.prototype,c.Fa=function(z){this.H=z},c.ea=function(z,Q,oe,De){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+z);Q=Q?Q.toUpperCase():"GET",this.D=z,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():gn.g(),this.g.onreadystatechange=be(q(this.Ca,this));try{this.B=!0,this.g.open(Q,String(z),!0),this.B=!1}catch(qt){jc(this,qt);return}if(z=oe||"",oe=new Map(this.headers),De)if(Object.getPrototypeOf(De)===Object.prototype)for(var Rt in De)oe.set(Rt,De[Rt]);else if(typeof De.keys=="function"&&typeof De.get=="function")for(const qt of De.keys())oe.set(qt,De.get(qt));else throw Error("Unknown input type for opt_headers: "+String(De));De=Array.from(oe.keys()).find(qt=>qt.toLowerCase()=="content-type"),Rt=P.FormData&&z instanceof P.FormData,!(Array.prototype.indexOf.call(Mn,Q,void 0)>=0)||De||Rt||oe.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[qt,Ti]of oe)this.g.setRequestHeader(qt,Ti);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(z),this.v=!1}catch(qt){jc(this,qt)}};function jc(z,Q){z.h=!1,z.g&&(z.j=!0,z.g.abort(),z.j=!1),z.l=Q,z.o=5,Gc(z),Ul(z)}function Gc(z){z.A||(z.A=!0,hs(z,"complete"),hs(z,"error"))}c.abort=function(z){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=z||7,hs(this,"complete"),hs(this,"abort"),Ul(this))},c.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ul(this,!0)),Xr.Z.N.call(this)},c.Ca=function(){this.u||(this.B||this.v||this.j?Vl(this):this.Xa())},c.Xa=function(){Vl(this)};function Vl(z){if(z.h&&typeof I<"u"){if(z.v&&xa(z)==4)setTimeout(z.Ca.bind(z),0);else if(hs(z,"readystatechange"),xa(z)==4){z.h=!1;try{const qt=z.ca();e:switch(qt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var Q=!0;break e;default:Q=!1}var oe;if(!(oe=Q)){var De;if(De=qt===0){let Ti=String(z.D).match(Hn)[1]||null;!Ti&&P.self&&P.self.location&&(Ti=P.self.location.protocol.slice(0,-1)),De=!va.test(Ti?Ti.toLowerCase():"")}oe=De}if(oe)hs(z,"complete"),hs(z,"success");else{z.o=6;try{var Rt=xa(z)>2?z.g.statusText:""}catch{Rt=""}z.l=Rt+" ["+z.ca()+"]",Gc(z)}}finally{Ul(z)}}}}function Ul(z,Q){if(z.g){z.m&&(clearTimeout(z.m),z.m=null);const oe=z.g;z.g=null,Q||hs(z,"ready");try{oe.onreadystatechange=null}catch{}}}c.isActive=function(){return!!this.g};function xa(z){return z.g?z.g.readyState:0}c.ca=function(){try{return xa(this)>2?this.g.status:-1}catch{return-1}},c.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},c.La=function(z){if(this.g){var Q=this.g.responseText;return z&&Q.indexOf(z)==0&&(Q=Q.substring(z.length)),jo(Q)}};function to(z){try{if(!z.g)return null;if("response"in z.g)return z.g.response;switch(z.F){case"":case"text":return z.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in z.g)return z.g.mozResponseArrayBuffer}return null}catch{return null}}function Wa(z){const Q={};z=(z.g&&xa(z)>=2&&z.g.getAllResponseHeaders()||"").split(`\r
`);for(let De=0;De<z.length;De++){if(ze(z[De]))continue;var oe=_u(z[De]);const Rt=oe[0];if(oe=oe[1],typeof oe!="string")continue;oe=oe.trim();const qt=Q[Rt]||[];Q[Rt]=qt,qt.push(oe)}Cn(Q,function(De){return De.join(", ")})}c.ya=function(){return this.o},c.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ia(z,Q,oe){return oe&&oe.internalChannelParams&&oe.internalChannelParams[z]||Q}function qc(z){this.za=0,this.i=[],this.j=new Ma,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ia("failFast",!1,z),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ia("baseRetryDelayMs",5e3,z),this.Za=ia("retryDelaySeedMs",1e4,z),this.Ta=ia("forwardChannelMaxRetries",2,z),this.va=ia("forwardChannelRequestTimeoutMs",2e4,z),this.ma=z&&z.xmlHttpFactory||void 0,this.Ua=z&&z.Rb||void 0,this.Aa=z&&z.useFetchStreams||!1,this.O=void 0,this.L=z&&z.supportsCrossDomainXhr||!1,this.M="",this.h=new en(z&&z.concurrentRequestLimit),this.Ba=new ya,this.S=z&&z.fastHandshake||!1,this.R=z&&z.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=z&&z.Pb||!1,z&&z.ua&&this.j.ua(),z&&z.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&z&&z.detectBufferingProxy||!1,this.ia=void 0,z&&z.longPollingTimeout&&z.longPollingTimeout>0&&(this.ia=z.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}c=qc.prototype,c.ka=8,c.I=1,c.connect=function(z,Q,oe,De){Es(0),this.W=z,this.H=Q||{},oe&&De!==void 0&&(this.H.OSID=oe,this.H.OAID=De),this.F=this.X,this.J=Tu(this,null,this.W),Gs(this)};function bu(z){if(cc(z),z.I==3){var Q=z.V++,oe=Pn(z.J);if(er(oe,"SID",z.M),er(oe,"RID",Q),er(oe,"TYPE","terminate"),jl(z,oe),Q=new Ne(z,z.j,Q),Q.M=2,Q.A=Ro(Pn(oe)),oe=!1,P.navigator&&P.navigator.sendBeacon)try{oe=P.navigator.sendBeacon(Q.A.toString(),"")}catch{}!oe&&P.Image&&(new Image().src=Q.A,oe=!0),oe||(Q.g=pl(Q.j,null),Q.g.ea(Q.A)),Q.F=Date.now(),We(Q)}Oi(z)}function wu(z){z.g&&(rh(z),z.g.cancel(),z.g=null)}function cc(z){wu(z),z.v&&(P.clearTimeout(z.v),z.v=null),On(z),z.h.cancel(),z.m&&(typeof z.m=="number"&&P.clearTimeout(z.m),z.m=null)}function Gs(z){if(!sn(z.h)&&!z.m){z.m=!0;var Q=z.Ea;Fi||Oe(),Si||(Fi(),Si=!0),qe.add(Q,z),z.D=0}}function uc(z,Q){return Rn(z.h)>=z.h.j-(z.m?1:0)?!1:z.m?(z.i=Q.G.concat(z.i),!0):z.I==1||z.I==2||z.D>=(z.Sa?0:z.Ta)?!1:(z.m=js(q(z.Ea,z,Q),lf(z,z.D)),z.D++,!0)}c.Ea=function(z){if(this.m)if(this.m=null,this.I==1){if(!z){this.V=Math.floor(Math.random()*1e5),z=this.V++;const Rt=new Ne(this,this.j,z);let qt=this.o;if(this.U&&(qt?(qt=rt(qt),ai(qt,this.U)):qt=this.U),this.u!==null||this.R||(Rt.J=qt,qt=null),this.S)e:{for(var Q=0,oe=0;oe<this.i.length;oe++){t:{var De=this.i[oe];if("__data__"in De.map&&(De=De.map.__data__,typeof De=="string")){De=De.length;break t}De=void 0}if(De===void 0)break;if(Q+=De,Q>4096){Q=oe;break e}if(Q===4096||oe===this.i.length-1){Q=oe+1;break e}}Q=1e3}else Q=1e3;Q=fl(this,Rt,Q),oe=Pn(this.J),er(oe,"RID",z),er(oe,"CVER",22),this.G&&er(oe,"X-HTTP-Session-Id",this.G),jl(this,oe),qt&&(this.R?Q="headers="+Nl(Po(qt))+"&"+Q:this.u&&Uc(oe,this.u,qt)),ds(this.h,Rt),this.Ra&&er(oe,"TYPE","init"),this.S?(er(oe,"$req",Q),er(oe,"SID","null"),Rt.U=!0,Re(Rt,oe,null)):Re(Rt,oe,Q),this.I=2}}else this.I==3&&(z?hc(this,z):this.i.length==0||sn(this.h)||hc(this))};function hc(z,Q){var oe;Q?oe=Q.l:oe=z.V++;const De=Pn(z.J);er(De,"SID",z.M),er(De,"RID",oe),er(De,"AID",z.K),jl(z,De),z.u&&z.o&&Uc(De,z.u,z.o),oe=new Ne(z,z.j,oe,z.D+1),z.u===null&&(oe.J=z.o),Q&&(z.i=Q.G.concat(z.i)),Q=fl(z,oe,1e3),oe.H=Math.round(z.va*.5)+Math.round(z.va*.5*Math.random()),ds(z.h,oe),Re(oe,De,Q)}function jl(z,Q){z.H&&bn(z.H,function(oe,De){er(Q,De,oe)}),z.l&&bn({},function(oe,De){er(Q,De,oe)})}function fl(z,Q,oe){oe=Math.min(z.i.length,oe);const De=z.l?q(z.l.Ka,z.l,z):null;e:{var Rt=z.i;let on=-1;for(;;){const io=["count="+oe];on==-1?oe>0?(on=Rt[0].g,io.push("ofs="+on)):on=0:io.push("ofs="+on);let Pr=!0;for(let As=0;As<oe;As++){var qt=Rt[As].g;const na=Rt[As].map;if(qt-=on,qt<0)on=Math.max(0,Rt[As].g-100),Pr=!1;else try{qt="req"+qt+"_"||"";try{var Ti=na instanceof Map?na:Object.entries(na);for(const[Za,Xa]of Ti){let wa=Xa;s(Xa)&&(wa=Uo(Xa)),io.push(qt+Za+"="+encodeURIComponent(wa))}}catch(Za){throw io.push(qt+"type="+encodeURIComponent("_badmap")),Za}}catch{De&&De(na)}}if(Pr){Ti=io.join("&");break e}}Ti=void 0}return z=z.i.splice(0,oe),Q.G=z,Ti}function Ss(z){if(!z.g&&!z.v){z.Y=1;var Q=z.Da;Fi||Oe(),Si||(Fi(),Si=!0),qe.add(Q,z),z.A=0}}function Hc(z){return z.g||z.v||z.A>=3?!1:(z.Y++,z.v=js(q(z.Da,z),lf(z,z.A)),z.A++,!0)}c.Da=function(){if(this.v=null,ld(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var z=4*this.T;this.j.info("BP detection timer enabled: "+z),this.B=js(q(this.Wa,this),z)}},c.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Es(10),wu(this),ld(this))};function rh(z){z.B!=null&&(P.clearTimeout(z.B),z.B=null)}function ld(z){z.g=new Ne(z,z.j,"rpc",z.Y),z.u===null&&(z.g.J=z.o),z.g.P=0;var Q=Pn(z.na);er(Q,"RID","rpc"),er(Q,"SID",z.M),er(Q,"AID",z.K),er(Q,"CI",z.F?"0":"1"),!z.F&&z.ia&&er(Q,"TO",z.ia),er(Q,"TYPE","xmlhttp"),jl(z,Q),z.u&&z.o&&Uc(Q,z.u,z.o),z.O&&(z.g.H=z.O);var oe=z.g;z=z.ba,oe.M=1,oe.A=Ro(Pn(Q)),oe.u=null,oe.R=!0,Ce(oe,z)}c.Va=function(){this.C!=null&&(this.C=null,wu(this),Hc(this),Es(19))};function On(z){z.C!=null&&(P.clearTimeout(z.C),z.C=null)}function cd(z,Q){var oe=null;if(z.g==Q){On(z),rh(z),z.g=null;var De=2}else if(mr(z.h,Q))oe=Q.G,Zr(z.h,Q),De=1;else return;if(z.I!=0){if(Q.o)if(De==1){oe=Q.u?Q.u.length:0,Q=Date.now()-Q.F;var Rt=z.D;De=Qo(),hs(De,new Go(De,oe)),Gs(z)}else Ss(z);else if(Rt=Q.m,Rt==3||Rt==0&&Q.X>0||!(De==1&&uc(z,Q)||De==2&&Hc(z)))switch(oe&&oe.length>0&&(Q=z.h,Q.i=Q.i.concat(oe)),Rt){case 1:Gl(z,5);break;case 4:Gl(z,10);break;case 3:Gl(z,6);break;default:Gl(z,2)}}}function lf(z,Q){let oe=z.Qa+Math.floor(Math.random()*z.Za);return z.isActive()||(oe*=2),oe*Q}function Gl(z,Q){if(z.j.info("Error code "+Q),Q==2){var oe=q(z.bb,z),De=z.Ua;const Rt=!De;De=new jn(De||"//www.google.com/images/cleardot.gif"),P.location&&P.location.protocol=="http"||fn(De,"https"),Ro(De),Rt?Pa(De.toString(),oe):vu(De.toString(),oe)}else Es(2);z.I=0,z.l&&z.l.pa(Q),Oi(z),cc(z)}c.bb=function(z){z?(this.j.info("Successfully pinged google.com"),Es(2)):(this.j.info("Failed to ping google.com"),Es(1))};function Oi(z){if(z.I=0,z.ja=[],z.l){const Q=Gr(z.h);(Q.length!=0||z.i.length!=0)&&(Je(z.ja,Q),Je(z.ja,z.i),z.h.i.length=0,He(z.i),z.i.length=0),z.l.oa()}}function Tu(z,Q,oe){var De=oe instanceof jn?Pn(oe):new jn(oe);if(De.g!="")Q&&(De.g=Q+"."+De.g),or(De,De.u);else{var Rt=P.location;De=Rt.protocol,Q=Q?Q+"."+Rt.hostname:Rt.hostname,Rt=+Rt.port;const qt=new jn(null);De&&fn(qt,De),Q&&(qt.g=Q),Rt&&or(qt,Rt),oe&&(qt.h=oe),De=qt}return oe=z.G,Q=z.wa,oe&&Q&&er(De,oe,Q),er(De,"VER",z.ka),jl(z,De),De}function pl(z,Q,oe){if(Q&&!z.L)throw Error("Can't create secondary domain capable XhrIo object.");return Q=z.Aa&&!z.ma?new Xr(new dl({ab:oe})):new Xr(z.ma),Q.Fa(z.L),Q}c.isActive=function(){return!!this.l&&this.l.isActive(this)};function ba(){}c=ba.prototype,c.ra=function(){},c.qa=function(){},c.pa=function(){},c.oa=function(){},c.isActive=function(){return!0},c.Ka=function(){};function wo(){}wo.prototype.g=function(z,Q){return new ho(z,Q)};function ho(z,Q){ms.call(this),this.g=new qc(Q),this.l=z,this.h=Q&&Q.messageUrlParams||null,z=Q&&Q.messageHeaders||null,Q&&Q.clientProtocolHeaderRequired&&(z?z["X-Client-Protocol"]="webchannel":z={"X-Client-Protocol":"webchannel"}),this.g.o=z,z=Q&&Q.initMessageHeaders||null,Q&&Q.messageContentType&&(z?z["X-WebChannel-Content-Type"]=Q.messageContentType:z={"X-WebChannel-Content-Type":Q.messageContentType}),Q&&Q.sa&&(z?z["X-WebChannel-Client-Profile"]=Q.sa:z={"X-WebChannel-Client-Profile":Q.sa}),this.g.U=z,(z=Q&&Q.Qb)&&!ze(z)&&(this.g.u=z),this.A=Q&&Q.supportsCrossDomainXhr||!1,this.v=Q&&Q.sendRawJson||!1,(Q=Q&&Q.httpSessionIdParam)&&!ze(Q)&&(this.g.G=Q,z=this.h,z!==null&&Q in z&&(z=this.h,Q in z&&delete z[Q])),this.j=new xn(this)}ce(ho,ms),ho.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ho.prototype.close=function(){bu(this.g)},ho.prototype.o=function(z){var Q=this.g;if(typeof z=="string"){var oe={};oe.__data__=z,z=oe}else this.v&&(oe={},oe.__data__=Uo(z),z=oe);Q.i.push(new gi(Q.Ya++,z)),Q.I==3&&Gs(Q)},ho.prototype.N=function(){this.g.l=null,delete this.j,bu(this.g),delete this.g,ho.Z.N.call(this)};function xi(z){pr.call(this),z.__headers__&&(this.headers=z.__headers__,this.statusCode=z.__status__,delete z.__headers__,delete z.__status__);var Q=z.__sm__;if(Q){e:{for(const oe in Q){z=oe;break e}z=void 0}(this.i=z)&&(z=this.i,Q=Q!==null&&z in Q?Q[z]:void 0),this.data=Q}else this.data=z}ce(xi,pr);function An(){Co.call(this),this.status=1}ce(An,Co);function xn(z){this.g=z}ce(xn,ba),xn.prototype.ra=function(){hs(this.g,"a")},xn.prototype.qa=function(z){hs(this.g,new xi(z))},xn.prototype.pa=function(z){hs(this.g,new An)},xn.prototype.oa=function(){hs(this.g,"b")},wo.prototype.createWebChannel=wo.prototype.g,ho.prototype.send=ho.prototype.o,ho.prototype.open=ho.prototype.m,ho.prototype.close=ho.prototype.close,xO=function(){return new wo},vO=function(){return Qo()},yO=Ts,KT={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Bl.NO_ERROR=0,Bl.TIMEOUT=8,Bl.HTTP_ERROR=6,Pb=Bl,Vc.COMPLETE="complete",_O=Vc,Nc.EventType=Yo,Yo.OPEN="a",Yo.CLOSE="b",Yo.ERROR="c",Yo.MESSAGE="d",ms.prototype.listen=ms.prototype.J,_0=Nc,Xr.prototype.listenOnce=Xr.prototype.K,Xr.prototype.getLastError=Xr.prototype.Ha,Xr.prototype.getLastErrorCode=Xr.prototype.ya,Xr.prototype.getStatus=Xr.prototype.ca,Xr.prototype.getResponseJson=Xr.prototype.La,Xr.prototype.getResponseText=Xr.prototype.la,Xr.prototype.send=Xr.prototype.ea,Xr.prototype.setWithCredentials=Xr.prototype.Fa,gO=Xr}).apply(typeof bb<"u"?bb:typeof self<"u"?self:typeof window<"u"?window:{});const nR="@firebase/firestore",rR="4.9.2";class Dl{constructor(n){this.uid=n}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(n){return n.uid===this.uid}}Dl.UNAUTHENTICATED=new Dl(null),Dl.GOOGLE_CREDENTIALS=new Dl("google-credentials-uid"),Dl.FIRST_PARTY=new Dl("first-party-uid"),Dl.MOCK_USER=new Dl("mock-user");let ev="12.3.0";const f_=new x1("@firebase/firestore");function Sy(){return f_.logLevel}function cn(c,...n){if(f_.logLevel<=ts.DEBUG){const l=n.map(dS);f_.debug(`Firestore (${ev}): ${c}`,...l)}}function pp(c,...n){if(f_.logLevel<=ts.ERROR){const l=n.map(dS);f_.error(`Firestore (${ev}): ${c}`,...l)}}function Ny(c,...n){if(f_.logLevel<=ts.WARN){const l=n.map(dS);f_.warn(`Firestore (${ev}): ${c}`,...l)}}function dS(c){if(typeof c=="string")return c;try{return(function(l){return JSON.stringify(l)})(c)}catch{return c}}function ir(c,n,l){let p="Unexpected state";typeof n=="string"?p=n:l=n,bO(c,p,l)}function bO(c,n,l){let p=`FIRESTORE (${ev}) INTERNAL ASSERTION FAILED: ${n} (ID: ${c.toString(16)})`;if(l!==void 0)try{p+=" CONTEXT: "+JSON.stringify(l)}catch{p+=" CONTEXT: "+l}throw pp(p),new Error(p)}function Rs(c,n,l,p){let b="Unexpected state";typeof l=="string"?b=l:p=l,c||bO(n,b,p)}function xr(c,n){return c}const di={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ji extends th{constructor(n,l){super(n,l),this.code=n,this.message=l,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class lp{constructor(){this.promise=new Promise(((n,l)=>{this.resolve=n,this.reject=l}))}}class wO{constructor(n,l){this.user=l,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${n}`)}}class cG{getToken(){return Promise.resolve(null)}invalidateToken(){}start(n,l){n.enqueueRetryable((()=>l(Dl.UNAUTHENTICATED)))}shutdown(){}}class uG{constructor(n){this.token=n,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(n,l){this.changeListener=l,n.enqueueRetryable((()=>l(this.token.user)))}shutdown(){this.changeListener=null}}class hG{constructor(n){this.t=n,this.currentUser=Dl.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(n,l){Rs(this.o===void 0,42304);let p=this.i;const b=G=>this.i!==p?(p=this.i,l(G)):Promise.resolve();let I=new lp;this.o=()=>{this.i++,this.currentUser=this.u(),I.resolve(),I=new lp,n.enqueueRetryable((()=>b(this.currentUser)))};const P=()=>{const G=I;n.enqueueRetryable((async()=>{await G.promise,await b(this.currentUser)}))},s=G=>{cn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=G,this.o&&(this.auth.addAuthTokenListener(this.o),P())};this.t.onInit((G=>s(G))),setTimeout((()=>{if(!this.auth){const G=this.t.getImmediate({optional:!0});G?s(G):(cn("FirebaseAuthCredentialsProvider","Auth not yet detected"),I.resolve(),I=new lp)}}),0),P()}getToken(){const n=this.i,l=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(l).then((p=>this.i!==n?(cn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):p?(Rs(typeof p.accessToken=="string",31837,{l:p}),new wO(p.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const n=this.auth&&this.auth.getUid();return Rs(n===null||typeof n=="string",2055,{h:n}),new Dl(n)}}class dG{constructor(n,l,p){this.P=n,this.T=l,this.I=p,this.type="FirstParty",this.user=Dl.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const n=this.R();return n&&this.A.set("Authorization",n),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class fG{constructor(n,l,p){this.P=n,this.T=l,this.I=p}getToken(){return Promise.resolve(new dG(this.P,this.T,this.I))}start(n,l){n.enqueueRetryable((()=>l(Dl.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class sR{constructor(n){this.value=n,this.type="AppCheck",this.headers=new Map,n&&n.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class pG{constructor(n,l){this.V=l,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,pu(n)&&n.settings.appCheckToken&&(this.p=n.settings.appCheckToken)}start(n,l){Rs(this.o===void 0,3512);const p=I=>{I.error!=null&&cn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${I.error.message}`);const P=I.token!==this.m;return this.m=I.token,cn("FirebaseAppCheckTokenProvider",`Received ${P?"new":"existing"} token.`),P?l(I.token):Promise.resolve()};this.o=I=>{n.enqueueRetryable((()=>p(I)))};const b=I=>{cn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=I,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((I=>b(I))),setTimeout((()=>{if(!this.appCheck){const I=this.V.getImmediate({optional:!0});I?b(I):cn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new sR(this.p));const n=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(n).then((l=>l?(Rs(typeof l.token=="string",44558,{tokenResult:l}),this.m=l.token,new sR(l.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function mG(c){const n=typeof self<"u"&&(self.crypto||self.msCrypto),l=new Uint8Array(c);if(n&&typeof n.getRandomValues=="function")n.getRandomValues(l);else for(let p=0;p<c;p++)l[p]=Math.floor(256*Math.random());return l}class fS{static newId(){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",l=62*Math.floor(4.129032258064516);let p="";for(;p.length<20;){const b=mG(40);for(let I=0;I<b.length;++I)p.length<20&&b[I]<l&&(p+=n.charAt(b[I]%62))}return p}}function is(c,n){return c<n?-1:c>n?1:0}function YT(c,n){const l=Math.min(c.length,n.length);for(let p=0;p<l;p++){const b=c.charAt(p),I=n.charAt(p);if(b!==I)return AT(b)===AT(I)?is(b,I):AT(b)?1:-1}return is(c.length,n.length)}const gG=55296,_G=57343;function AT(c){const n=c.charCodeAt(0);return n>=gG&&n<=_G}function Vy(c,n,l){return c.length===n.length&&c.every(((p,b)=>l(p,n[b])))}const oR="__name__";class Xd{constructor(n,l,p){l===void 0?l=0:l>n.length&&ir(637,{offset:l,range:n.length}),p===void 0?p=n.length-l:p>n.length-l&&ir(1746,{length:p,range:n.length-l}),this.segments=n,this.offset=l,this.len=p}get length(){return this.len}isEqual(n){return Xd.comparator(this,n)===0}child(n){const l=this.segments.slice(this.offset,this.limit());return n instanceof Xd?n.forEach((p=>{l.push(p)})):l.push(n),this.construct(l)}limit(){return this.offset+this.length}popFirst(n){return n=n===void 0?1:n,this.construct(this.segments,this.offset+n,this.length-n)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(n){return this.segments[this.offset+n]}isEmpty(){return this.length===0}isPrefixOf(n){if(n.length<this.length)return!1;for(let l=0;l<this.length;l++)if(this.get(l)!==n.get(l))return!1;return!0}isImmediateParentOf(n){if(this.length+1!==n.length)return!1;for(let l=0;l<this.length;l++)if(this.get(l)!==n.get(l))return!1;return!0}forEach(n){for(let l=this.offset,p=this.limit();l<p;l++)n(this.segments[l])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(n,l){const p=Math.min(n.length,l.length);for(let b=0;b<p;b++){const I=Xd.compareSegments(n.get(b),l.get(b));if(I!==0)return I}return is(n.length,l.length)}static compareSegments(n,l){const p=Xd.isNumericId(n),b=Xd.isNumericId(l);return p&&!b?-1:!p&&b?1:p&&b?Xd.extractNumericId(n).compare(Xd.extractNumericId(l)):YT(n,l)}static isNumericId(n){return n.startsWith("__id")&&n.endsWith("__")}static extractNumericId(n){return Bm.fromString(n.substring(4,n.length-2))}}class Xs extends Xd{construct(n,l,p){return new Xs(n,l,p)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...n){const l=[];for(const p of n){if(p.indexOf("//")>=0)throw new Ji(di.INVALID_ARGUMENT,`Invalid segment (${p}). Paths must not contain // in them.`);l.push(...p.split("/").filter((b=>b.length>0)))}return new Xs(l)}static emptyPath(){return new Xs([])}}const yG=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class al extends Xd{construct(n,l,p){return new al(n,l,p)}static isValidIdentifier(n){return yG.test(n)}canonicalString(){return this.toArray().map((n=>(n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),al.isValidIdentifier(n)||(n="`"+n+"`"),n))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===oR}static keyField(){return new al([oR])}static fromServerFormat(n){const l=[];let p="",b=0;const I=()=>{if(p.length===0)throw new Ji(di.INVALID_ARGUMENT,`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);l.push(p),p=""};let P=!1;for(;b<n.length;){const s=n[b];if(s==="\\"){if(b+1===n.length)throw new Ji(di.INVALID_ARGUMENT,"Path has trailing escape character: "+n);const G=n[b+1];if(G!=="\\"&&G!=="."&&G!=="`")throw new Ji(di.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);p+=G,b+=2}else s==="`"?(P=!P,b++):s!=="."||P?(p+=s,b++):(I(),b++)}if(I(),P)throw new Ji(di.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new al(l)}static emptyPath(){return new al([])}}class zn{constructor(n){this.path=n}static fromPath(n){return new zn(Xs.fromString(n))}static fromName(n){return new zn(Xs.fromString(n).popFirst(5))}static empty(){return new zn(Xs.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(n){return this.path.length>=2&&this.path.get(this.path.length-2)===n}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(n){return n!==null&&Xs.comparator(this.path,n.path)===0}toString(){return this.path.toString()}static comparator(n,l){return Xs.comparator(n.path,l.path)}static isDocumentKey(n){return n.length%2==0}static fromSegments(n){return new zn(new Xs(n.slice()))}}function TO(c,n,l){if(!l)throw new Ji(di.INVALID_ARGUMENT,`Function ${c}() cannot be called with an empty ${n}.`)}function vG(c,n,l,p){if(n===!0&&p===!0)throw new Ji(di.INVALID_ARGUMENT,`${c} and ${l} cannot be used together.`)}function aR(c){if(!zn.isDocumentKey(c))throw new Ji(di.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${c} has ${c.length}.`)}function lR(c){if(zn.isDocumentKey(c))throw new Ji(di.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${c} has ${c.length}.`)}function EO(c){return typeof c=="object"&&c!==null&&(Object.getPrototypeOf(c)===Object.prototype||Object.getPrototypeOf(c)===null)}function A1(c){if(c===void 0)return"undefined";if(c===null)return"null";if(typeof c=="string")return c.length>20&&(c=`${c.substring(0,20)}...`),JSON.stringify(c);if(typeof c=="number"||typeof c=="boolean")return""+c;if(typeof c=="object"){if(c instanceof Array)return"an array";{const n=(function(p){return p.constructor?p.constructor.name:null})(c);return n?`a custom ${n} object`:"an object"}}return typeof c=="function"?"a function":ir(12329,{type:typeof c})}function sd(c,n){if("_delegate"in c&&(c=c._delegate),!(c instanceof n)){if(n.name===c.constructor.name)throw new Ji(di.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const l=A1(c);throw new Ji(di.INVALID_ARGUMENT,`Expected type '${n.name}', but it was: ${l}`)}}return c}function pa(c,n){const l={typeString:c};return n&&(l.value=n),l}function Q0(c,n){if(!EO(c))throw new Ji(di.INVALID_ARGUMENT,"JSON must be an object");let l;for(const p in n)if(n[p]){const b=n[p].typeString,I="value"in n[p]?{value:n[p].value}:void 0;if(!(p in c)){l=`JSON missing required field: '${p}'`;break}const P=c[p];if(b&&typeof P!==b){l=`JSON field '${p}' must be a ${b}.`;break}if(I!==void 0&&P!==I.value){l=`Expected '${p}' field to equal '${I.value}'`;break}}if(l)throw new Ji(di.INVALID_ARGUMENT,l);return!0}const cR=-62135596800,uR=1e6;class lo{static now(){return lo.fromMillis(Date.now())}static fromDate(n){return lo.fromMillis(n.getTime())}static fromMillis(n){const l=Math.floor(n/1e3),p=Math.floor((n-1e3*l)*uR);return new lo(l,p)}constructor(n,l){if(this.seconds=n,this.nanoseconds=l,l<0)throw new Ji(di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+l);if(l>=1e9)throw new Ji(di.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+l);if(n<cR)throw new Ji(di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n);if(n>=253402300800)throw new Ji(di.INVALID_ARGUMENT,"Timestamp seconds out of range: "+n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/uR}_compareTo(n){return this.seconds===n.seconds?is(this.nanoseconds,n.nanoseconds):is(this.seconds,n.seconds)}isEqual(n){return n.seconds===this.seconds&&n.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:lo._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(n){if(Q0(n,lo._jsonSchema))return new lo(n.seconds,n.nanoseconds)}valueOf(){const n=this.seconds-cR;return String(n).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}lo._jsonSchemaVersion="firestore/timestamp/1.0",lo._jsonSchema={type:pa("string",lo._jsonSchemaVersion),seconds:pa("number"),nanoseconds:pa("number")};class fr{static fromTimestamp(n){return new fr(n)}static min(){return new fr(new lo(0,0))}static max(){return new fr(new lo(253402300799,999999999))}constructor(n){this.timestamp=n}compareTo(n){return this.timestamp._compareTo(n.timestamp)}isEqual(n){return this.timestamp.isEqual(n.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const O0=-1;function xG(c,n){const l=c.toTimestamp().seconds,p=c.toTimestamp().nanoseconds+1,b=fr.fromTimestamp(p===1e9?new lo(l+1,0):new lo(l,p));return new Gm(b,zn.empty(),n)}function bG(c){return new Gm(c.readTime,c.key,O0)}class Gm{constructor(n,l,p){this.readTime=n,this.documentKey=l,this.largestBatchId=p}static min(){return new Gm(fr.min(),zn.empty(),O0)}static max(){return new Gm(fr.max(),zn.empty(),O0)}}function wG(c,n){let l=c.readTime.compareTo(n.readTime);return l!==0?l:(l=zn.comparator(c.documentKey,n.documentKey),l!==0?l:is(c.largestBatchId,n.largestBatchId))}const TG="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class EG{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(n){this.onCommittedListeners.push(n)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((n=>n()))}}async function tv(c){if(c.code!==di.FAILED_PRECONDITION||c.message!==TG)throw c;cn("LocalStore","Unexpectedly lost primary lease")}class yi{constructor(n){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,n((l=>{this.isDone=!0,this.result=l,this.nextCallback&&this.nextCallback(l)}),(l=>{this.isDone=!0,this.error=l,this.catchCallback&&this.catchCallback(l)}))}catch(n){return this.next(void 0,n)}next(n,l){return this.callbackAttached&&ir(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(l,this.error):this.wrapSuccess(n,this.result):new yi(((p,b)=>{this.nextCallback=I=>{this.wrapSuccess(n,I).next(p,b)},this.catchCallback=I=>{this.wrapFailure(l,I).next(p,b)}}))}toPromise(){return new Promise(((n,l)=>{this.next(n,l)}))}wrapUserFunction(n){try{const l=n();return l instanceof yi?l:yi.resolve(l)}catch(l){return yi.reject(l)}}wrapSuccess(n,l){return n?this.wrapUserFunction((()=>n(l))):yi.resolve(l)}wrapFailure(n,l){return n?this.wrapUserFunction((()=>n(l))):yi.reject(l)}static resolve(n){return new yi(((l,p)=>{l(n)}))}static reject(n){return new yi(((l,p)=>{p(n)}))}static waitFor(n){return new yi(((l,p)=>{let b=0,I=0,P=!1;n.forEach((s=>{++b,s.next((()=>{++I,P&&I===b&&l()}),(G=>p(G)))})),P=!0,I===b&&l()}))}static or(n){let l=yi.resolve(!1);for(const p of n)l=l.next((b=>b?yi.resolve(b):p()));return l}static forEach(n,l){const p=[];return n.forEach(((b,I)=>{p.push(l.call(this,b,I))})),this.waitFor(p)}static mapArray(n,l){return new yi(((p,b)=>{const I=n.length,P=new Array(I);let s=0;for(let G=0;G<I;G++){const q=G;l(n[q]).next((ie=>{P[q]=ie,++s,s===I&&p(P)}),(ie=>b(ie)))}}))}static doWhile(n,l){return new yi(((p,b)=>{const I=()=>{n()===!0?l().next((()=>{I()}),b):p()};I()}))}}function SG(c){const n=c.match(/Android ([\d.]+)/i),l=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(l)}function iv(c){return c.name==="IndexedDbTransactionError"}class I1{constructor(n,l){this.previousValue=n,l&&(l.sequenceNumberHandler=p=>this.ae(p),this.ue=p=>l.writeSequenceNumber(p))}ae(n){return this.previousValue=Math.max(n,this.previousValue),this.previousValue}next(){const n=++this.previousValue;return this.ue&&this.ue(n),n}}I1.ce=-1;const pS=-1;function C1(c){return c==null}function Jb(c){return c===0&&1/c==-1/0}function AG(c){return typeof c=="number"&&Number.isInteger(c)&&!Jb(c)&&c<=Number.MAX_SAFE_INTEGER&&c>=Number.MIN_SAFE_INTEGER}const SO="";function IG(c){let n="";for(let l=0;l<c.length;l++)n.length>0&&(n=hR(n)),n=CG(c.get(l),n);return hR(n)}function CG(c,n){let l=n;const p=c.length;for(let b=0;b<p;b++){const I=c.charAt(b);switch(I){case"\0":l+="";break;case SO:l+="";break;default:l+=I}}return l}function hR(c){return c+SO+""}function dR(c){let n=0;for(const l in c)Object.prototype.hasOwnProperty.call(c,l)&&n++;return n}function Qm(c,n){for(const l in c)Object.prototype.hasOwnProperty.call(c,l)&&n(l,c[l])}function AO(c){for(const n in c)if(Object.prototype.hasOwnProperty.call(c,n))return!1;return!0}class Io{constructor(n,l){this.comparator=n,this.root=l||ol.EMPTY}insert(n,l){return new Io(this.comparator,this.root.insert(n,l,this.comparator).copy(null,null,ol.BLACK,null,null))}remove(n){return new Io(this.comparator,this.root.remove(n,this.comparator).copy(null,null,ol.BLACK,null,null))}get(n){let l=this.root;for(;!l.isEmpty();){const p=this.comparator(n,l.key);if(p===0)return l.value;p<0?l=l.left:p>0&&(l=l.right)}return null}indexOf(n){let l=0,p=this.root;for(;!p.isEmpty();){const b=this.comparator(n,p.key);if(b===0)return l+p.left.size;b<0?p=p.left:(l+=p.left.size+1,p=p.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(n){return this.root.inorderTraversal(n)}forEach(n){this.inorderTraversal(((l,p)=>(n(l,p),!1)))}toString(){const n=[];return this.inorderTraversal(((l,p)=>(n.push(`${l}:${p}`),!1))),`{${n.join(", ")}}`}reverseTraversal(n){return this.root.reverseTraversal(n)}getIterator(){return new wb(this.root,null,this.comparator,!1)}getIteratorFrom(n){return new wb(this.root,n,this.comparator,!1)}getReverseIterator(){return new wb(this.root,null,this.comparator,!0)}getReverseIteratorFrom(n){return new wb(this.root,n,this.comparator,!0)}}class wb{constructor(n,l,p,b){this.isReverse=b,this.nodeStack=[];let I=1;for(;!n.isEmpty();)if(I=l?p(n.key,l):1,l&&b&&(I*=-1),I<0)n=this.isReverse?n.left:n.right;else{if(I===0){this.nodeStack.push(n);break}this.nodeStack.push(n),n=this.isReverse?n.right:n.left}}getNext(){let n=this.nodeStack.pop();const l={key:n.key,value:n.value};if(this.isReverse)for(n=n.left;!n.isEmpty();)this.nodeStack.push(n),n=n.right;else for(n=n.right;!n.isEmpty();)this.nodeStack.push(n),n=n.left;return l}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const n=this.nodeStack[this.nodeStack.length-1];return{key:n.key,value:n.value}}}class ol{constructor(n,l,p,b,I){this.key=n,this.value=l,this.color=p??ol.RED,this.left=b??ol.EMPTY,this.right=I??ol.EMPTY,this.size=this.left.size+1+this.right.size}copy(n,l,p,b,I){return new ol(n??this.key,l??this.value,p??this.color,b??this.left,I??this.right)}isEmpty(){return!1}inorderTraversal(n){return this.left.inorderTraversal(n)||n(this.key,this.value)||this.right.inorderTraversal(n)}reverseTraversal(n){return this.right.reverseTraversal(n)||n(this.key,this.value)||this.left.reverseTraversal(n)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(n,l,p){let b=this;const I=p(n,b.key);return b=I<0?b.copy(null,null,null,b.left.insert(n,l,p),null):I===0?b.copy(null,l,null,null,null):b.copy(null,null,null,null,b.right.insert(n,l,p)),b.fixUp()}removeMin(){if(this.left.isEmpty())return ol.EMPTY;let n=this;return n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.removeMin(),null),n.fixUp()}remove(n,l){let p,b=this;if(l(n,b.key)<0)b.left.isEmpty()||b.left.isRed()||b.left.left.isRed()||(b=b.moveRedLeft()),b=b.copy(null,null,null,b.left.remove(n,l),null);else{if(b.left.isRed()&&(b=b.rotateRight()),b.right.isEmpty()||b.right.isRed()||b.right.left.isRed()||(b=b.moveRedRight()),l(n,b.key)===0){if(b.right.isEmpty())return ol.EMPTY;p=b.right.min(),b=b.copy(p.key,p.value,null,null,b.right.removeMin())}b=b.copy(null,null,null,null,b.right.remove(n,l))}return b.fixUp()}isRed(){return this.color}fixUp(){let n=this;return n.right.isRed()&&!n.left.isRed()&&(n=n.rotateLeft()),n.left.isRed()&&n.left.left.isRed()&&(n=n.rotateRight()),n.left.isRed()&&n.right.isRed()&&(n=n.colorFlip()),n}moveRedLeft(){let n=this.colorFlip();return n.right.left.isRed()&&(n=n.copy(null,null,null,null,n.right.rotateRight()),n=n.rotateLeft(),n=n.colorFlip()),n}moveRedRight(){let n=this.colorFlip();return n.left.left.isRed()&&(n=n.rotateRight(),n=n.colorFlip()),n}rotateLeft(){const n=this.copy(null,null,ol.RED,null,this.right.left);return this.right.copy(null,null,this.color,n,null)}rotateRight(){const n=this.copy(null,null,ol.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,n)}colorFlip(){const n=this.left.copy(null,null,!this.left.color,null,null),l=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,n,l)}checkMaxDepth(){const n=this.check();return Math.pow(2,n)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ir(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ir(14113,{key:this.key,value:this.value});const n=this.left.check();if(n!==this.right.check())throw ir(27949);return n+(this.isRed()?0:1)}}ol.EMPTY=null,ol.RED=!0,ol.BLACK=!1;ol.EMPTY=new class{constructor(){this.size=0}get key(){throw ir(57766)}get value(){throw ir(16141)}get color(){throw ir(16727)}get left(){throw ir(29726)}get right(){throw ir(36894)}copy(n,l,p,b,I){return this}insert(n,l,p){return new ol(n,l)}remove(n,l){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ra{constructor(n){this.comparator=n,this.data=new Io(this.comparator)}has(n){return this.data.get(n)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(n){return this.data.indexOf(n)}forEach(n){this.data.inorderTraversal(((l,p)=>(n(l),!1)))}forEachInRange(n,l){const p=this.data.getIteratorFrom(n[0]);for(;p.hasNext();){const b=p.getNext();if(this.comparator(b.key,n[1])>=0)return;l(b.key)}}forEachWhile(n,l){let p;for(p=l!==void 0?this.data.getIteratorFrom(l):this.data.getIterator();p.hasNext();)if(!n(p.getNext().key))return}firstAfterOrEqual(n){const l=this.data.getIteratorFrom(n);return l.hasNext()?l.getNext().key:null}getIterator(){return new fR(this.data.getIterator())}getIteratorFrom(n){return new fR(this.data.getIteratorFrom(n))}add(n){return this.copy(this.data.remove(n).insert(n,!0))}delete(n){return this.has(n)?this.copy(this.data.remove(n)):this}isEmpty(){return this.data.isEmpty()}unionWith(n){let l=this;return l.size<n.size&&(l=n,n=this),n.forEach((p=>{l=l.add(p)})),l}isEqual(n){if(!(n instanceof Ra)||this.size!==n.size)return!1;const l=this.data.getIterator(),p=n.data.getIterator();for(;l.hasNext();){const b=l.getNext().key,I=p.getNext().key;if(this.comparator(b,I)!==0)return!1}return!0}toArray(){const n=[];return this.forEach((l=>{n.push(l)})),n}toString(){const n=[];return this.forEach((l=>n.push(l))),"SortedSet("+n.toString()+")"}copy(n){const l=new Ra(this.comparator);return l.data=n,l}}class fR{constructor(n){this.iter=n}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class gu{constructor(n){this.fields=n,n.sort(al.comparator)}static empty(){return new gu([])}unionWith(n){let l=new Ra(al.comparator);for(const p of this.fields)l=l.add(p);for(const p of n)l=l.add(p);return new gu(l.toArray())}covers(n){for(const l of this.fields)if(l.isPrefixOf(n))return!0;return!1}isEqual(n){return Vy(this.fields,n.fields,((l,p)=>l.isEqual(p)))}}class IO extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ll{constructor(n){this.binaryString=n}static fromBase64String(n){const l=(function(b){try{return atob(b)}catch(I){throw typeof DOMException<"u"&&I instanceof DOMException?new IO("Invalid base64 string: "+I):I}})(n);return new ll(l)}static fromUint8Array(n){const l=(function(b){let I="";for(let P=0;P<b.length;++P)I+=String.fromCharCode(b[P]);return I})(n);return new ll(l)}[Symbol.iterator](){let n=0;return{next:()=>n<this.binaryString.length?{value:this.binaryString.charCodeAt(n++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(l){return btoa(l)})(this.binaryString)}toUint8Array(){return(function(l){const p=new Uint8Array(l.length);for(let b=0;b<l.length;b++)p[b]=l.charCodeAt(b);return p})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(n){return is(this.binaryString,n.binaryString)}isEqual(n){return this.binaryString===n.binaryString}}ll.EMPTY_BYTE_STRING=new ll("");const RG=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qm(c){if(Rs(!!c,39018),typeof c=="string"){let n=0;const l=RG.exec(c);if(Rs(!!l,46558,{timestamp:c}),l[1]){let b=l[1];b=(b+"000000000").substr(0,9),n=Number(b)}const p=new Date(c);return{seconds:Math.floor(p.getTime()/1e3),nanos:n}}return{seconds:Xo(c.seconds),nanos:Xo(c.nanos)}}function Xo(c){return typeof c=="number"?c:typeof c=="string"?Number(c):0}function Hm(c){return typeof c=="string"?ll.fromBase64String(c):ll.fromUint8Array(c)}const CO="server_timestamp",RO="__type__",MO="__previous_value__",DO="__local_write_time__";function mS(c){return(c?.mapValue?.fields||{})[RO]?.stringValue===CO}function R1(c){const n=c.mapValue.fields[MO];return mS(n)?R1(n):n}function L0(c){const n=qm(c.mapValue.fields[DO].timestampValue);return new lo(n.seconds,n.nanos)}class MG{constructor(n,l,p,b,I,P,s,G,q,ie){this.databaseId=n,this.appId=l,this.persistenceKey=p,this.host=b,this.ssl=I,this.forceLongPolling=P,this.autoDetectLongPolling=s,this.longPollingOptions=G,this.useFetchStreams=q,this.isUsingEmulator=ie}}const e1="(default)";class z0{constructor(n,l){this.projectId=n,this.database=l||e1}static empty(){return new z0("","")}get isDefaultDatabase(){return this.database===e1}isEqual(n){return n instanceof z0&&n.projectId===this.projectId&&n.database===this.database}}const PO="__type__",DG="__max__",Tb={mapValue:{}},OO="__vector__",t1="value";function $m(c){return"nullValue"in c?0:"booleanValue"in c?1:"integerValue"in c||"doubleValue"in c?2:"timestampValue"in c?3:"stringValue"in c?5:"bytesValue"in c?6:"referenceValue"in c?7:"geoPointValue"in c?8:"arrayValue"in c?9:"mapValue"in c?mS(c)?4:OG(c)?9007199254740991:PG(c)?10:11:ir(28295,{value:c})}function sf(c,n){if(c===n)return!0;const l=$m(c);if(l!==$m(n))return!1;switch(l){case 0:case 9007199254740991:return!0;case 1:return c.booleanValue===n.booleanValue;case 4:return L0(c).isEqual(L0(n));case 3:return(function(b,I){if(typeof b.timestampValue=="string"&&typeof I.timestampValue=="string"&&b.timestampValue.length===I.timestampValue.length)return b.timestampValue===I.timestampValue;const P=qm(b.timestampValue),s=qm(I.timestampValue);return P.seconds===s.seconds&&P.nanos===s.nanos})(c,n);case 5:return c.stringValue===n.stringValue;case 6:return(function(b,I){return Hm(b.bytesValue).isEqual(Hm(I.bytesValue))})(c,n);case 7:return c.referenceValue===n.referenceValue;case 8:return(function(b,I){return Xo(b.geoPointValue.latitude)===Xo(I.geoPointValue.latitude)&&Xo(b.geoPointValue.longitude)===Xo(I.geoPointValue.longitude)})(c,n);case 2:return(function(b,I){if("integerValue"in b&&"integerValue"in I)return Xo(b.integerValue)===Xo(I.integerValue);if("doubleValue"in b&&"doubleValue"in I){const P=Xo(b.doubleValue),s=Xo(I.doubleValue);return P===s?Jb(P)===Jb(s):isNaN(P)&&isNaN(s)}return!1})(c,n);case 9:return Vy(c.arrayValue.values||[],n.arrayValue.values||[],sf);case 10:case 11:return(function(b,I){const P=b.mapValue.fields||{},s=I.mapValue.fields||{};if(dR(P)!==dR(s))return!1;for(const G in P)if(P.hasOwnProperty(G)&&(s[G]===void 0||!sf(P[G],s[G])))return!1;return!0})(c,n);default:return ir(52216,{left:c})}}function k0(c,n){return(c.values||[]).find((l=>sf(l,n)))!==void 0}function Uy(c,n){if(c===n)return 0;const l=$m(c),p=$m(n);if(l!==p)return is(l,p);switch(l){case 0:case 9007199254740991:return 0;case 1:return is(c.booleanValue,n.booleanValue);case 2:return(function(I,P){const s=Xo(I.integerValue||I.doubleValue),G=Xo(P.integerValue||P.doubleValue);return s<G?-1:s>G?1:s===G?0:isNaN(s)?isNaN(G)?0:-1:1})(c,n);case 3:return pR(c.timestampValue,n.timestampValue);case 4:return pR(L0(c),L0(n));case 5:return YT(c.stringValue,n.stringValue);case 6:return(function(I,P){const s=Hm(I),G=Hm(P);return s.compareTo(G)})(c.bytesValue,n.bytesValue);case 7:return(function(I,P){const s=I.split("/"),G=P.split("/");for(let q=0;q<s.length&&q<G.length;q++){const ie=is(s[q],G[q]);if(ie!==0)return ie}return is(s.length,G.length)})(c.referenceValue,n.referenceValue);case 8:return(function(I,P){const s=is(Xo(I.latitude),Xo(P.latitude));return s!==0?s:is(Xo(I.longitude),Xo(P.longitude))})(c.geoPointValue,n.geoPointValue);case 9:return mR(c.arrayValue,n.arrayValue);case 10:return(function(I,P){const s=I.fields||{},G=P.fields||{},q=s[t1]?.arrayValue,ie=G[t1]?.arrayValue,ce=is(q?.values?.length||0,ie?.values?.length||0);return ce!==0?ce:mR(q,ie)})(c.mapValue,n.mapValue);case 11:return(function(I,P){if(I===Tb.mapValue&&P===Tb.mapValue)return 0;if(I===Tb.mapValue)return 1;if(P===Tb.mapValue)return-1;const s=I.fields||{},G=Object.keys(s),q=P.fields||{},ie=Object.keys(q);G.sort(),ie.sort();for(let ce=0;ce<G.length&&ce<ie.length;++ce){const be=YT(G[ce],ie[ce]);if(be!==0)return be;const He=Uy(s[G[ce]],q[ie[ce]]);if(He!==0)return He}return is(G.length,ie.length)})(c.mapValue,n.mapValue);default:throw ir(23264,{he:l})}}function pR(c,n){if(typeof c=="string"&&typeof n=="string"&&c.length===n.length)return is(c,n);const l=qm(c),p=qm(n),b=is(l.seconds,p.seconds);return b!==0?b:is(l.nanos,p.nanos)}function mR(c,n){const l=c.values||[],p=n.values||[];for(let b=0;b<l.length&&b<p.length;++b){const I=Uy(l[b],p[b]);if(I)return I}return is(l.length,p.length)}function jy(c){return QT(c)}function QT(c){return"nullValue"in c?"null":"booleanValue"in c?""+c.booleanValue:"integerValue"in c?""+c.integerValue:"doubleValue"in c?""+c.doubleValue:"timestampValue"in c?(function(l){const p=qm(l);return`time(${p.seconds},${p.nanos})`})(c.timestampValue):"stringValue"in c?c.stringValue:"bytesValue"in c?(function(l){return Hm(l).toBase64()})(c.bytesValue):"referenceValue"in c?(function(l){return zn.fromName(l).toString()})(c.referenceValue):"geoPointValue"in c?(function(l){return`geo(${l.latitude},${l.longitude})`})(c.geoPointValue):"arrayValue"in c?(function(l){let p="[",b=!0;for(const I of l.values||[])b?b=!1:p+=",",p+=QT(I);return p+"]"})(c.arrayValue):"mapValue"in c?(function(l){const p=Object.keys(l.fields||{}).sort();let b="{",I=!0;for(const P of p)I?I=!1:b+=",",b+=`${P}:${QT(l.fields[P])}`;return b+"}"})(c.mapValue):ir(61005,{value:c})}function Ob(c){switch($m(c)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const n=R1(c);return n?16+Ob(n):16;case 5:return 2*c.stringValue.length;case 6:return Hm(c.bytesValue).approximateByteSize();case 7:return c.referenceValue.length;case 9:return(function(p){return(p.values||[]).reduce(((b,I)=>b+Ob(I)),0)})(c.arrayValue);case 10:case 11:return(function(p){let b=0;return Qm(p.fields,((I,P)=>{b+=I.length+Ob(P)})),b})(c.mapValue);default:throw ir(13486,{value:c})}}function gR(c,n){return{referenceValue:`projects/${c.projectId}/databases/${c.database}/documents/${n.path.canonicalString()}`}}function JT(c){return!!c&&"integerValue"in c}function gS(c){return!!c&&"arrayValue"in c}function _R(c){return!!c&&"nullValue"in c}function yR(c){return!!c&&"doubleValue"in c&&isNaN(Number(c.doubleValue))}function Lb(c){return!!c&&"mapValue"in c}function PG(c){return(c?.mapValue?.fields||{})[PO]?.stringValue===OO}function E0(c){if(c.geoPointValue)return{geoPointValue:{...c.geoPointValue}};if(c.timestampValue&&typeof c.timestampValue=="object")return{timestampValue:{...c.timestampValue}};if(c.mapValue){const n={mapValue:{fields:{}}};return Qm(c.mapValue.fields,((l,p)=>n.mapValue.fields[l]=E0(p))),n}if(c.arrayValue){const n={arrayValue:{values:[]}};for(let l=0;l<(c.arrayValue.values||[]).length;++l)n.arrayValue.values[l]=E0(c.arrayValue.values[l]);return n}return{...c}}function OG(c){return(((c.mapValue||{}).fields||{}).__type__||{}).stringValue===DG}class Fc{constructor(n){this.value=n}static empty(){return new Fc({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let l=this.value;for(let p=0;p<n.length-1;++p)if(l=(l.mapValue.fields||{})[n.get(p)],!Lb(l))return null;return l=(l.mapValue.fields||{})[n.lastSegment()],l||null}}set(n,l){this.getFieldsMap(n.popLast())[n.lastSegment()]=E0(l)}setAll(n){let l=al.emptyPath(),p={},b=[];n.forEach(((P,s)=>{if(!l.isImmediateParentOf(s)){const G=this.getFieldsMap(l);this.applyChanges(G,p,b),p={},b=[],l=s.popLast()}P?p[s.lastSegment()]=E0(P):b.push(s.lastSegment())}));const I=this.getFieldsMap(l);this.applyChanges(I,p,b)}delete(n){const l=this.field(n.popLast());Lb(l)&&l.mapValue.fields&&delete l.mapValue.fields[n.lastSegment()]}isEqual(n){return sf(this.value,n.value)}getFieldsMap(n){let l=this.value;l.mapValue.fields||(l.mapValue={fields:{}});for(let p=0;p<n.length;++p){let b=l.mapValue.fields[n.get(p)];Lb(b)&&b.mapValue.fields||(b={mapValue:{fields:{}}},l.mapValue.fields[n.get(p)]=b),l=b}return l.mapValue.fields}applyChanges(n,l,p){Qm(l,((b,I)=>n[b]=I));for(const b of p)delete n[b]}clone(){return new Fc(E0(this.value))}}function LO(c){const n=[];return Qm(c.fields,((l,p)=>{const b=new al([l]);if(Lb(p)){const I=LO(p.mapValue).fields;if(I.length===0)n.push(b);else for(const P of I)n.push(b.child(P))}else n.push(b)})),new gu(n)}class Ol{constructor(n,l,p,b,I,P,s){this.key=n,this.documentType=l,this.version=p,this.readTime=b,this.createTime=I,this.data=P,this.documentState=s}static newInvalidDocument(n){return new Ol(n,0,fr.min(),fr.min(),fr.min(),Fc.empty(),0)}static newFoundDocument(n,l,p,b){return new Ol(n,1,l,fr.min(),p,b,0)}static newNoDocument(n,l){return new Ol(n,2,l,fr.min(),fr.min(),Fc.empty(),0)}static newUnknownDocument(n,l){return new Ol(n,3,l,fr.min(),fr.min(),Fc.empty(),2)}convertToFoundDocument(n,l){return!this.createTime.isEqual(fr.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=n),this.version=n,this.documentType=1,this.data=l,this.documentState=0,this}convertToNoDocument(n){return this.version=n,this.documentType=2,this.data=Fc.empty(),this.documentState=0,this}convertToUnknownDocument(n){return this.version=n,this.documentType=3,this.data=Fc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=fr.min(),this}setReadTime(n){return this.readTime=n,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(n){return n instanceof Ol&&this.key.isEqual(n.key)&&this.version.isEqual(n.version)&&this.documentType===n.documentType&&this.documentState===n.documentState&&this.data.isEqual(n.data)}mutableCopy(){return new Ol(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class i1{constructor(n,l){this.position=n,this.inclusive=l}}function vR(c,n,l){let p=0;for(let b=0;b<c.position.length;b++){const I=n[b],P=c.position[b];if(I.field.isKeyField()?p=zn.comparator(zn.fromName(P.referenceValue),l.key):p=Uy(P,l.data.field(I.field)),I.dir==="desc"&&(p*=-1),p!==0)break}return p}function xR(c,n){if(c===null)return n===null;if(n===null||c.inclusive!==n.inclusive||c.position.length!==n.position.length)return!1;for(let l=0;l<c.position.length;l++)if(!sf(c.position[l],n.position[l]))return!1;return!0}class F0{constructor(n,l="asc"){this.field=n,this.dir=l}}function LG(c,n){return c.dir===n.dir&&c.field.isEqual(n.field)}class zO{}class fa extends zO{constructor(n,l,p){super(),this.field=n,this.op=l,this.value=p}static create(n,l,p){return n.isKeyField()?l==="in"||l==="not-in"?this.createKeyFieldInFilter(n,l,p):new kG(n,l,p):l==="array-contains"?new NG(n,p):l==="in"?new VG(n,p):l==="not-in"?new UG(n,p):l==="array-contains-any"?new jG(n,p):new fa(n,l,p)}static createKeyFieldInFilter(n,l,p){return l==="in"?new FG(n,p):new BG(n,p)}matches(n){const l=n.data.field(this.field);return this.op==="!="?l!==null&&l.nullValue===void 0&&this.matchesComparison(Uy(l,this.value)):l!==null&&$m(this.value)===$m(l)&&this.matchesComparison(Uy(l,this.value))}matchesComparison(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return ir(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class od extends zO{constructor(n,l){super(),this.filters=n,this.op=l,this.Pe=null}static create(n,l){return new od(n,l)}matches(n){return kO(this)?this.filters.find((l=>!l.matches(n)))===void 0:this.filters.find((l=>l.matches(n)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((n,l)=>n.concat(l.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function kO(c){return c.op==="and"}function FO(c){return zG(c)&&kO(c)}function zG(c){for(const n of c.filters)if(n instanceof od)return!1;return!0}function eE(c){if(c instanceof fa)return c.field.canonicalString()+c.op.toString()+jy(c.value);if(FO(c))return c.filters.map((n=>eE(n))).join(",");{const n=c.filters.map((l=>eE(l))).join(",");return`${c.op}(${n})`}}function BO(c,n){return c instanceof fa?(function(p,b){return b instanceof fa&&p.op===b.op&&p.field.isEqual(b.field)&&sf(p.value,b.value)})(c,n):c instanceof od?(function(p,b){return b instanceof od&&p.op===b.op&&p.filters.length===b.filters.length?p.filters.reduce(((I,P,s)=>I&&BO(P,b.filters[s])),!0):!1})(c,n):void ir(19439)}function NO(c){return c instanceof fa?(function(l){return`${l.field.canonicalString()} ${l.op} ${jy(l.value)}`})(c):c instanceof od?(function(l){return l.op.toString()+" {"+l.getFilters().map(NO).join(" ,")+"}"})(c):"Filter"}class kG extends fa{constructor(n,l,p){super(n,l,p),this.key=zn.fromName(p.referenceValue)}matches(n){const l=zn.comparator(n.key,this.key);return this.matchesComparison(l)}}class FG extends fa{constructor(n,l){super(n,"in",l),this.keys=VO("in",l)}matches(n){return this.keys.some((l=>l.isEqual(n.key)))}}class BG extends fa{constructor(n,l){super(n,"not-in",l),this.keys=VO("not-in",l)}matches(n){return!this.keys.some((l=>l.isEqual(n.key)))}}function VO(c,n){return(n.arrayValue?.values||[]).map((l=>zn.fromName(l.referenceValue)))}class NG extends fa{constructor(n,l){super(n,"array-contains",l)}matches(n){const l=n.data.field(this.field);return gS(l)&&k0(l.arrayValue,this.value)}}class VG extends fa{constructor(n,l){super(n,"in",l)}matches(n){const l=n.data.field(this.field);return l!==null&&k0(this.value.arrayValue,l)}}class UG extends fa{constructor(n,l){super(n,"not-in",l)}matches(n){if(k0(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const l=n.data.field(this.field);return l!==null&&l.nullValue===void 0&&!k0(this.value.arrayValue,l)}}class jG extends fa{constructor(n,l){super(n,"array-contains-any",l)}matches(n){const l=n.data.field(this.field);return!(!gS(l)||!l.arrayValue.values)&&l.arrayValue.values.some((p=>k0(this.value.arrayValue,p)))}}class GG{constructor(n,l=null,p=[],b=[],I=null,P=null,s=null){this.path=n,this.collectionGroup=l,this.orderBy=p,this.filters=b,this.limit=I,this.startAt=P,this.endAt=s,this.Te=null}}function bR(c,n=null,l=[],p=[],b=null,I=null,P=null){return new GG(c,n,l,p,b,I,P)}function _S(c){const n=xr(c);if(n.Te===null){let l=n.path.canonicalString();n.collectionGroup!==null&&(l+="|cg:"+n.collectionGroup),l+="|f:",l+=n.filters.map((p=>eE(p))).join(","),l+="|ob:",l+=n.orderBy.map((p=>(function(I){return I.field.canonicalString()+I.dir})(p))).join(","),C1(n.limit)||(l+="|l:",l+=n.limit),n.startAt&&(l+="|lb:",l+=n.startAt.inclusive?"b:":"a:",l+=n.startAt.position.map((p=>jy(p))).join(",")),n.endAt&&(l+="|ub:",l+=n.endAt.inclusive?"a:":"b:",l+=n.endAt.position.map((p=>jy(p))).join(",")),n.Te=l}return n.Te}function yS(c,n){if(c.limit!==n.limit||c.orderBy.length!==n.orderBy.length)return!1;for(let l=0;l<c.orderBy.length;l++)if(!LG(c.orderBy[l],n.orderBy[l]))return!1;if(c.filters.length!==n.filters.length)return!1;for(let l=0;l<c.filters.length;l++)if(!BO(c.filters[l],n.filters[l]))return!1;return c.collectionGroup===n.collectionGroup&&!!c.path.isEqual(n.path)&&!!xR(c.startAt,n.startAt)&&xR(c.endAt,n.endAt)}function tE(c){return zn.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0}class nv{constructor(n,l=null,p=[],b=[],I=null,P="F",s=null,G=null){this.path=n,this.collectionGroup=l,this.explicitOrderBy=p,this.filters=b,this.limit=I,this.limitType=P,this.startAt=s,this.endAt=G,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function qG(c,n,l,p,b,I,P,s){return new nv(c,n,l,p,b,I,P,s)}function vS(c){return new nv(c)}function wR(c){return c.filters.length===0&&c.limit===null&&c.startAt==null&&c.endAt==null&&(c.explicitOrderBy.length===0||c.explicitOrderBy.length===1&&c.explicitOrderBy[0].field.isKeyField())}function UO(c){return c.collectionGroup!==null}function S0(c){const n=xr(c);if(n.Ie===null){n.Ie=[];const l=new Set;for(const I of n.explicitOrderBy)n.Ie.push(I),l.add(I.field.canonicalString());const p=n.explicitOrderBy.length>0?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";(function(P){let s=new Ra(al.comparator);return P.filters.forEach((G=>{G.getFlattenedFilters().forEach((q=>{q.isInequality()&&(s=s.add(q.field))}))})),s})(n).forEach((I=>{l.has(I.canonicalString())||I.isKeyField()||n.Ie.push(new F0(I,p))})),l.has(al.keyField().canonicalString())||n.Ie.push(new F0(al.keyField(),p))}return n.Ie}function ef(c){const n=xr(c);return n.Ee||(n.Ee=HG(n,S0(c))),n.Ee}function HG(c,n){if(c.limitType==="F")return bR(c.path,c.collectionGroup,n,c.filters,c.limit,c.startAt,c.endAt);{n=n.map((b=>{const I=b.dir==="desc"?"asc":"desc";return new F0(b.field,I)}));const l=c.endAt?new i1(c.endAt.position,c.endAt.inclusive):null,p=c.startAt?new i1(c.startAt.position,c.startAt.inclusive):null;return bR(c.path,c.collectionGroup,n,c.filters,c.limit,l,p)}}function iE(c,n){const l=c.filters.concat([n]);return new nv(c.path,c.collectionGroup,c.explicitOrderBy.slice(),l,c.limit,c.limitType,c.startAt,c.endAt)}function nE(c,n,l){return new nv(c.path,c.collectionGroup,c.explicitOrderBy.slice(),c.filters.slice(),n,l,c.startAt,c.endAt)}function M1(c,n){return yS(ef(c),ef(n))&&c.limitType===n.limitType}function jO(c){return`${_S(ef(c))}|lt:${c.limitType}`}function Ay(c){return`Query(target=${(function(l){let p=l.path.canonicalString();return l.collectionGroup!==null&&(p+=" collectionGroup="+l.collectionGroup),l.filters.length>0&&(p+=`, filters: [${l.filters.map((b=>NO(b))).join(", ")}]`),C1(l.limit)||(p+=", limit: "+l.limit),l.orderBy.length>0&&(p+=`, orderBy: [${l.orderBy.map((b=>(function(P){return`${P.field.canonicalString()} (${P.dir})`})(b))).join(", ")}]`),l.startAt&&(p+=", startAt: ",p+=l.startAt.inclusive?"b:":"a:",p+=l.startAt.position.map((b=>jy(b))).join(",")),l.endAt&&(p+=", endAt: ",p+=l.endAt.inclusive?"a:":"b:",p+=l.endAt.position.map((b=>jy(b))).join(",")),`Target(${p})`})(ef(c))}; limitType=${c.limitType})`}function D1(c,n){return n.isFoundDocument()&&(function(p,b){const I=b.key.path;return p.collectionGroup!==null?b.key.hasCollectionId(p.collectionGroup)&&p.path.isPrefixOf(I):zn.isDocumentKey(p.path)?p.path.isEqual(I):p.path.isImmediateParentOf(I)})(c,n)&&(function(p,b){for(const I of S0(p))if(!I.field.isKeyField()&&b.data.field(I.field)===null)return!1;return!0})(c,n)&&(function(p,b){for(const I of p.filters)if(!I.matches(b))return!1;return!0})(c,n)&&(function(p,b){return!(p.startAt&&!(function(P,s,G){const q=vR(P,s,G);return P.inclusive?q<=0:q<0})(p.startAt,S0(p),b)||p.endAt&&!(function(P,s,G){const q=vR(P,s,G);return P.inclusive?q>=0:q>0})(p.endAt,S0(p),b))})(c,n)}function $G(c){return c.collectionGroup||(c.path.length%2==1?c.path.lastSegment():c.path.get(c.path.length-2))}function GO(c){return(n,l)=>{let p=!1;for(const b of S0(c)){const I=WG(b,n,l);if(I!==0)return I;p=p||b.field.isKeyField()}return 0}}function WG(c,n,l){const p=c.field.isKeyField()?zn.comparator(n.key,l.key):(function(I,P,s){const G=P.data.field(I),q=s.data.field(I);return G!==null&&q!==null?Uy(G,q):ir(42886)})(c.field,n,l);switch(c.dir){case"asc":return p;case"desc":return-1*p;default:return ir(19790,{direction:c.dir})}}class v_{constructor(n,l){this.mapKeyFn=n,this.equalsFn=l,this.inner={},this.innerSize=0}get(n){const l=this.mapKeyFn(n),p=this.inner[l];if(p!==void 0){for(const[b,I]of p)if(this.equalsFn(b,n))return I}}has(n){return this.get(n)!==void 0}set(n,l){const p=this.mapKeyFn(n),b=this.inner[p];if(b===void 0)return this.inner[p]=[[n,l]],void this.innerSize++;for(let I=0;I<b.length;I++)if(this.equalsFn(b[I][0],n))return void(b[I]=[n,l]);b.push([n,l]),this.innerSize++}delete(n){const l=this.mapKeyFn(n),p=this.inner[l];if(p===void 0)return!1;for(let b=0;b<p.length;b++)if(this.equalsFn(p[b][0],n))return p.length===1?delete this.inner[l]:p.splice(b,1),this.innerSize--,!0;return!1}forEach(n){Qm(this.inner,((l,p)=>{for(const[b,I]of p)n(b,I)}))}isEmpty(){return AO(this.inner)}size(){return this.innerSize}}const ZG=new Io(zn.comparator);function mp(){return ZG}const qO=new Io(zn.comparator);function y0(...c){let n=qO;for(const l of c)n=n.insert(l.key,l);return n}function HO(c){let n=qO;return c.forEach(((l,p)=>n=n.insert(l,p.overlayedDocument))),n}function r_(){return A0()}function $O(){return A0()}function A0(){return new v_((c=>c.toString()),((c,n)=>c.isEqual(n)))}const XG=new Io(zn.comparator),KG=new Ra(zn.comparator);function ns(...c){let n=KG;for(const l of c)n=n.add(l);return n}const YG=new Ra(is);function QG(){return YG}function xS(c,n){if(c.useProto3Json){if(isNaN(n))return{doubleValue:"NaN"};if(n===1/0)return{doubleValue:"Infinity"};if(n===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Jb(n)?"-0":n}}function WO(c){return{integerValue:""+c}}function JG(c,n){return AG(n)?WO(n):xS(c,n)}class P1{constructor(){this._=void 0}}function e9(c,n,l){return c instanceof n1?(function(b,I){const P={fields:{[RO]:{stringValue:CO},[DO]:{timestampValue:{seconds:b.seconds,nanos:b.nanoseconds}}}};return I&&mS(I)&&(I=R1(I)),I&&(P.fields[MO]=I),{mapValue:P}})(l,n):c instanceof Gy?XO(c,n):c instanceof qy?KO(c,n):(function(b,I){const P=ZO(b,I),s=TR(P)+TR(b.Ae);return JT(P)&&JT(b.Ae)?WO(s):xS(b.serializer,s)})(c,n)}function t9(c,n,l){return c instanceof Gy?XO(c,n):c instanceof qy?KO(c,n):l}function ZO(c,n){return c instanceof r1?(function(p){return JT(p)||(function(I){return!!I&&"doubleValue"in I})(p)})(n)?n:{integerValue:0}:null}class n1 extends P1{}class Gy extends P1{constructor(n){super(),this.elements=n}}function XO(c,n){const l=YO(n);for(const p of c.elements)l.some((b=>sf(b,p)))||l.push(p);return{arrayValue:{values:l}}}class qy extends P1{constructor(n){super(),this.elements=n}}function KO(c,n){let l=YO(n);for(const p of c.elements)l=l.filter((b=>!sf(b,p)));return{arrayValue:{values:l}}}class r1 extends P1{constructor(n,l){super(),this.serializer=n,this.Ae=l}}function TR(c){return Xo(c.integerValue||c.doubleValue)}function YO(c){return gS(c)&&c.arrayValue.values?c.arrayValue.values.slice():[]}class QO{constructor(n,l){this.field=n,this.transform=l}}function i9(c,n){return c.field.isEqual(n.field)&&(function(p,b){return p instanceof Gy&&b instanceof Gy||p instanceof qy&&b instanceof qy?Vy(p.elements,b.elements,sf):p instanceof r1&&b instanceof r1?sf(p.Ae,b.Ae):p instanceof n1&&b instanceof n1})(c.transform,n.transform)}class n9{constructor(n,l){this.version=n,this.transformResults=l}}class Ju{constructor(n,l){this.updateTime=n,this.exists=l}static none(){return new Ju}static exists(n){return new Ju(void 0,n)}static updateTime(n){return new Ju(n)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(n){return this.exists===n.exists&&(this.updateTime?!!n.updateTime&&this.updateTime.isEqual(n.updateTime):!n.updateTime)}}function zb(c,n){return c.updateTime!==void 0?n.isFoundDocument()&&n.version.isEqual(c.updateTime):c.exists===void 0||c.exists===n.isFoundDocument()}class O1{}function JO(c,n){if(!c.hasLocalMutations||n&&n.fields.length===0)return null;if(n===null)return c.isNoDocument()?new bS(c.key,Ju.none()):new J0(c.key,c.data,Ju.none());{const l=c.data,p=Fc.empty();let b=new Ra(al.comparator);for(let I of n.fields)if(!b.has(I)){let P=l.field(I);P===null&&I.length>1&&(I=I.popLast(),P=l.field(I)),P===null?p.delete(I):p.set(I,P),b=b.add(I)}return new Jm(c.key,p,new gu(b.toArray()),Ju.none())}}function r9(c,n,l){c instanceof J0?(function(b,I,P){const s=b.value.clone(),G=SR(b.fieldTransforms,I,P.transformResults);s.setAll(G),I.convertToFoundDocument(P.version,s).setHasCommittedMutations()})(c,n,l):c instanceof Jm?(function(b,I,P){if(!zb(b.precondition,I))return void I.convertToUnknownDocument(P.version);const s=SR(b.fieldTransforms,I,P.transformResults),G=I.data;G.setAll(eL(b)),G.setAll(s),I.convertToFoundDocument(P.version,G).setHasCommittedMutations()})(c,n,l):(function(b,I,P){I.convertToNoDocument(P.version).setHasCommittedMutations()})(0,n,l)}function I0(c,n,l,p){return c instanceof J0?(function(I,P,s,G){if(!zb(I.precondition,P))return s;const q=I.value.clone(),ie=AR(I.fieldTransforms,G,P);return q.setAll(ie),P.convertToFoundDocument(P.version,q).setHasLocalMutations(),null})(c,n,l,p):c instanceof Jm?(function(I,P,s,G){if(!zb(I.precondition,P))return s;const q=AR(I.fieldTransforms,G,P),ie=P.data;return ie.setAll(eL(I)),ie.setAll(q),P.convertToFoundDocument(P.version,ie).setHasLocalMutations(),s===null?null:s.unionWith(I.fieldMask.fields).unionWith(I.fieldTransforms.map((ce=>ce.field)))})(c,n,l,p):(function(I,P,s){return zb(I.precondition,P)?(P.convertToNoDocument(P.version).setHasLocalMutations(),null):s})(c,n,l)}function s9(c,n){let l=null;for(const p of c.fieldTransforms){const b=n.data.field(p.field),I=ZO(p.transform,b||null);I!=null&&(l===null&&(l=Fc.empty()),l.set(p.field,I))}return l||null}function ER(c,n){return c.type===n.type&&!!c.key.isEqual(n.key)&&!!c.precondition.isEqual(n.precondition)&&!!(function(p,b){return p===void 0&&b===void 0||!(!p||!b)&&Vy(p,b,((I,P)=>i9(I,P)))})(c.fieldTransforms,n.fieldTransforms)&&(c.type===0?c.value.isEqual(n.value):c.type!==1||c.data.isEqual(n.data)&&c.fieldMask.isEqual(n.fieldMask))}class J0 extends O1{constructor(n,l,p,b=[]){super(),this.key=n,this.value=l,this.precondition=p,this.fieldTransforms=b,this.type=0}getFieldMask(){return null}}class Jm extends O1{constructor(n,l,p,b,I=[]){super(),this.key=n,this.data=l,this.fieldMask=p,this.precondition=b,this.fieldTransforms=I,this.type=1}getFieldMask(){return this.fieldMask}}function eL(c){const n=new Map;return c.fieldMask.fields.forEach((l=>{if(!l.isEmpty()){const p=c.data.field(l);n.set(l,p)}})),n}function SR(c,n,l){const p=new Map;Rs(c.length===l.length,32656,{Re:l.length,Ve:c.length});for(let b=0;b<l.length;b++){const I=c[b],P=I.transform,s=n.data.field(I.field);p.set(I.field,t9(P,s,l[b]))}return p}function AR(c,n,l){const p=new Map;for(const b of c){const I=b.transform,P=l.data.field(b.field);p.set(b.field,e9(I,P,n))}return p}class bS extends O1{constructor(n,l){super(),this.key=n,this.precondition=l,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class o9 extends O1{constructor(n,l){super(),this.key=n,this.precondition=l,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class a9{constructor(n,l,p,b){this.batchId=n,this.localWriteTime=l,this.baseMutations=p,this.mutations=b}applyToRemoteDocument(n,l){const p=l.mutationResults;for(let b=0;b<this.mutations.length;b++){const I=this.mutations[b];I.key.isEqual(n.key)&&r9(I,n,p[b])}}applyToLocalView(n,l){for(const p of this.baseMutations)p.key.isEqual(n.key)&&(l=I0(p,n,l,this.localWriteTime));for(const p of this.mutations)p.key.isEqual(n.key)&&(l=I0(p,n,l,this.localWriteTime));return l}applyToLocalDocumentSet(n,l){const p=$O();return this.mutations.forEach((b=>{const I=n.get(b.key),P=I.overlayedDocument;let s=this.applyToLocalView(P,I.mutatedFields);s=l.has(b.key)?null:s;const G=JO(P,s);G!==null&&p.set(b.key,G),P.isValidDocument()||P.convertToNoDocument(fr.min())})),p}keys(){return this.mutations.reduce(((n,l)=>n.add(l.key)),ns())}isEqual(n){return this.batchId===n.batchId&&Vy(this.mutations,n.mutations,((l,p)=>ER(l,p)))&&Vy(this.baseMutations,n.baseMutations,((l,p)=>ER(l,p)))}}class wS{constructor(n,l,p,b){this.batch=n,this.commitVersion=l,this.mutationResults=p,this.docVersions=b}static from(n,l,p){Rs(n.mutations.length===p.length,58842,{me:n.mutations.length,fe:p.length});let b=(function(){return XG})();const I=n.mutations;for(let P=0;P<I.length;P++)b=b.insert(I[P].key,p[P].version);return new wS(n,l,p,b)}}class l9{constructor(n,l){this.largestBatchId=n,this.mutation=l}getKey(){return this.mutation.key}isEqual(n){return n!==null&&this.mutation===n.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class c9{constructor(n,l){this.count=n,this.unchangedNames=l}}var da,us;function u9(c){switch(c){case di.OK:return ir(64938);case di.CANCELLED:case di.UNKNOWN:case di.DEADLINE_EXCEEDED:case di.RESOURCE_EXHAUSTED:case di.INTERNAL:case di.UNAVAILABLE:case di.UNAUTHENTICATED:return!1;case di.INVALID_ARGUMENT:case di.NOT_FOUND:case di.ALREADY_EXISTS:case di.PERMISSION_DENIED:case di.FAILED_PRECONDITION:case di.ABORTED:case di.OUT_OF_RANGE:case di.UNIMPLEMENTED:case di.DATA_LOSS:return!0;default:return ir(15467,{code:c})}}function tL(c){if(c===void 0)return pp("GRPC error has no .code"),di.UNKNOWN;switch(c){case da.OK:return di.OK;case da.CANCELLED:return di.CANCELLED;case da.UNKNOWN:return di.UNKNOWN;case da.DEADLINE_EXCEEDED:return di.DEADLINE_EXCEEDED;case da.RESOURCE_EXHAUSTED:return di.RESOURCE_EXHAUSTED;case da.INTERNAL:return di.INTERNAL;case da.UNAVAILABLE:return di.UNAVAILABLE;case da.UNAUTHENTICATED:return di.UNAUTHENTICATED;case da.INVALID_ARGUMENT:return di.INVALID_ARGUMENT;case da.NOT_FOUND:return di.NOT_FOUND;case da.ALREADY_EXISTS:return di.ALREADY_EXISTS;case da.PERMISSION_DENIED:return di.PERMISSION_DENIED;case da.FAILED_PRECONDITION:return di.FAILED_PRECONDITION;case da.ABORTED:return di.ABORTED;case da.OUT_OF_RANGE:return di.OUT_OF_RANGE;case da.UNIMPLEMENTED:return di.UNIMPLEMENTED;case da.DATA_LOSS:return di.DATA_LOSS;default:return ir(39323,{code:c})}}(us=da||(da={}))[us.OK=0]="OK",us[us.CANCELLED=1]="CANCELLED",us[us.UNKNOWN=2]="UNKNOWN",us[us.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",us[us.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",us[us.NOT_FOUND=5]="NOT_FOUND",us[us.ALREADY_EXISTS=6]="ALREADY_EXISTS",us[us.PERMISSION_DENIED=7]="PERMISSION_DENIED",us[us.UNAUTHENTICATED=16]="UNAUTHENTICATED",us[us.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",us[us.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",us[us.ABORTED=10]="ABORTED",us[us.OUT_OF_RANGE=11]="OUT_OF_RANGE",us[us.UNIMPLEMENTED=12]="UNIMPLEMENTED",us[us.INTERNAL=13]="INTERNAL",us[us.UNAVAILABLE=14]="UNAVAILABLE",us[us.DATA_LOSS=15]="DATA_LOSS";function h9(){return new TextEncoder}const d9=new Bm([4294967295,4294967295],0);function IR(c){const n=h9().encode(c),l=new mO;return l.update(n),new Uint8Array(l.digest())}function CR(c){const n=new DataView(c.buffer),l=n.getUint32(0,!0),p=n.getUint32(4,!0),b=n.getUint32(8,!0),I=n.getUint32(12,!0);return[new Bm([l,p],0),new Bm([b,I],0)]}class TS{constructor(n,l,p){if(this.bitmap=n,this.padding=l,this.hashCount=p,l<0||l>=8)throw new v0(`Invalid padding: ${l}`);if(p<0)throw new v0(`Invalid hash count: ${p}`);if(n.length>0&&this.hashCount===0)throw new v0(`Invalid hash count: ${p}`);if(n.length===0&&l!==0)throw new v0(`Invalid padding when bitmap length is 0: ${l}`);this.ge=8*n.length-l,this.pe=Bm.fromNumber(this.ge)}ye(n,l,p){let b=n.add(l.multiply(Bm.fromNumber(p)));return b.compare(d9)===1&&(b=new Bm([b.getBits(0),b.getBits(1)],0)),b.modulo(this.pe).toNumber()}we(n){return!!(this.bitmap[Math.floor(n/8)]&1<<n%8)}mightContain(n){if(this.ge===0)return!1;const l=IR(n),[p,b]=CR(l);for(let I=0;I<this.hashCount;I++){const P=this.ye(p,b,I);if(!this.we(P))return!1}return!0}static create(n,l,p){const b=n%8==0?0:8-n%8,I=new Uint8Array(Math.ceil(n/8)),P=new TS(I,b,l);return p.forEach((s=>P.insert(s))),P}insert(n){if(this.ge===0)return;const l=IR(n),[p,b]=CR(l);for(let I=0;I<this.hashCount;I++){const P=this.ye(p,b,I);this.Se(P)}}Se(n){const l=Math.floor(n/8),p=n%8;this.bitmap[l]|=1<<p}}class v0 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class L1{constructor(n,l,p,b,I){this.snapshotVersion=n,this.targetChanges=l,this.targetMismatches=p,this.documentUpdates=b,this.resolvedLimboDocuments=I}static createSynthesizedRemoteEventForCurrentChange(n,l,p){const b=new Map;return b.set(n,ex.createSynthesizedTargetChangeForCurrentChange(n,l,p)),new L1(fr.min(),b,new Io(is),mp(),ns())}}class ex{constructor(n,l,p,b,I){this.resumeToken=n,this.current=l,this.addedDocuments=p,this.modifiedDocuments=b,this.removedDocuments=I}static createSynthesizedTargetChangeForCurrentChange(n,l,p){return new ex(p,l,ns(),ns(),ns())}}class kb{constructor(n,l,p,b){this.be=n,this.removedTargetIds=l,this.key=p,this.De=b}}class iL{constructor(n,l){this.targetId=n,this.Ce=l}}class nL{constructor(n,l,p=ll.EMPTY_BYTE_STRING,b=null){this.state=n,this.targetIds=l,this.resumeToken=p,this.cause=b}}class RR{constructor(){this.ve=0,this.Fe=MR(),this.Me=ll.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(n){n.approximateByteSize()>0&&(this.Oe=!0,this.Me=n)}ke(){let n=ns(),l=ns(),p=ns();return this.Fe.forEach(((b,I)=>{switch(I){case 0:n=n.add(b);break;case 2:l=l.add(b);break;case 1:p=p.add(b);break;default:ir(38017,{changeType:I})}})),new ex(this.Me,this.xe,n,l,p)}qe(){this.Oe=!1,this.Fe=MR()}Qe(n,l){this.Oe=!0,this.Fe=this.Fe.insert(n,l)}$e(n){this.Oe=!0,this.Fe=this.Fe.remove(n)}Ue(){this.ve+=1}Ke(){this.ve-=1,Rs(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class f9{constructor(n){this.Ge=n,this.ze=new Map,this.je=mp(),this.Je=Eb(),this.He=Eb(),this.Ye=new Io(is)}Ze(n){for(const l of n.be)n.De&&n.De.isFoundDocument()?this.Xe(l,n.De):this.et(l,n.key,n.De);for(const l of n.removedTargetIds)this.et(l,n.key,n.De)}tt(n){this.forEachTarget(n,(l=>{const p=this.nt(l);switch(n.state){case 0:this.rt(l)&&p.Le(n.resumeToken);break;case 1:p.Ke(),p.Ne||p.qe(),p.Le(n.resumeToken);break;case 2:p.Ke(),p.Ne||this.removeTarget(l);break;case 3:this.rt(l)&&(p.We(),p.Le(n.resumeToken));break;case 4:this.rt(l)&&(this.it(l),p.Le(n.resumeToken));break;default:ir(56790,{state:n.state})}}))}forEachTarget(n,l){n.targetIds.length>0?n.targetIds.forEach(l):this.ze.forEach(((p,b)=>{this.rt(b)&&l(b)}))}st(n){const l=n.targetId,p=n.Ce.count,b=this.ot(l);if(b){const I=b.target;if(tE(I))if(p===0){const P=new zn(I.path);this.et(l,P,Ol.newNoDocument(P,fr.min()))}else Rs(p===1,20013,{expectedCount:p});else{const P=this._t(l);if(P!==p){const s=this.ut(n),G=s?this.ct(s,n,P):1;if(G!==0){this.it(l);const q=G===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(l,q)}}}}}ut(n){const l=n.Ce.unchangedNames;if(!l||!l.bits)return null;const{bits:{bitmap:p="",padding:b=0},hashCount:I=0}=l;let P,s;try{P=Hm(p).toUint8Array()}catch(G){if(G instanceof IO)return Ny("Decoding the base64 bloom filter in existence filter failed ("+G.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw G}try{s=new TS(P,b,I)}catch(G){return Ny(G instanceof v0?"BloomFilter error: ":"Applying bloom filter failed: ",G),null}return s.ge===0?null:s}ct(n,l,p){return l.Ce.count===p-this.Pt(n,l.targetId)?0:2}Pt(n,l){const p=this.Ge.getRemoteKeysForTarget(l);let b=0;return p.forEach((I=>{const P=this.Ge.ht(),s=`projects/${P.projectId}/databases/${P.database}/documents/${I.path.canonicalString()}`;n.mightContain(s)||(this.et(l,I,null),b++)})),b}Tt(n){const l=new Map;this.ze.forEach(((I,P)=>{const s=this.ot(P);if(s){if(I.current&&tE(s.target)){const G=new zn(s.target.path);this.It(G).has(P)||this.Et(P,G)||this.et(P,G,Ol.newNoDocument(G,n))}I.Be&&(l.set(P,I.ke()),I.qe())}}));let p=ns();this.He.forEach(((I,P)=>{let s=!0;P.forEachWhile((G=>{const q=this.ot(G);return!q||q.purpose==="TargetPurposeLimboResolution"||(s=!1,!1)})),s&&(p=p.add(I))})),this.je.forEach(((I,P)=>P.setReadTime(n)));const b=new L1(n,l,this.Ye,this.je,p);return this.je=mp(),this.Je=Eb(),this.He=Eb(),this.Ye=new Io(is),b}Xe(n,l){if(!this.rt(n))return;const p=this.Et(n,l.key)?2:0;this.nt(n).Qe(l.key,p),this.je=this.je.insert(l.key,l),this.Je=this.Je.insert(l.key,this.It(l.key).add(n)),this.He=this.He.insert(l.key,this.dt(l.key).add(n))}et(n,l,p){if(!this.rt(n))return;const b=this.nt(n);this.Et(n,l)?b.Qe(l,1):b.$e(l),this.He=this.He.insert(l,this.dt(l).delete(n)),this.He=this.He.insert(l,this.dt(l).add(n)),p&&(this.je=this.je.insert(l,p))}removeTarget(n){this.ze.delete(n)}_t(n){const l=this.nt(n).ke();return this.Ge.getRemoteKeysForTarget(n).size+l.addedDocuments.size-l.removedDocuments.size}Ue(n){this.nt(n).Ue()}nt(n){let l=this.ze.get(n);return l||(l=new RR,this.ze.set(n,l)),l}dt(n){let l=this.He.get(n);return l||(l=new Ra(is),this.He=this.He.insert(n,l)),l}It(n){let l=this.Je.get(n);return l||(l=new Ra(is),this.Je=this.Je.insert(n,l)),l}rt(n){const l=this.ot(n)!==null;return l||cn("WatchChangeAggregator","Detected inactive target",n),l}ot(n){const l=this.ze.get(n);return l&&l.Ne?null:this.Ge.At(n)}it(n){this.ze.set(n,new RR),this.Ge.getRemoteKeysForTarget(n).forEach((l=>{this.et(n,l,null)}))}Et(n,l){return this.Ge.getRemoteKeysForTarget(n).has(l)}}function Eb(){return new Io(zn.comparator)}function MR(){return new Io(zn.comparator)}const p9={asc:"ASCENDING",desc:"DESCENDING"},m9={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},g9={and:"AND",or:"OR"};class _9{constructor(n,l){this.databaseId=n,this.useProto3Json=l}}function rE(c,n){return c.useProto3Json||C1(n)?n:{value:n}}function s1(c,n){return c.useProto3Json?`${new Date(1e3*n.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+n.nanoseconds).slice(-9)}Z`:{seconds:""+n.seconds,nanos:n.nanoseconds}}function rL(c,n){return c.useProto3Json?n.toBase64():n.toUint8Array()}function y9(c,n){return s1(c,n.toTimestamp())}function tf(c){return Rs(!!c,49232),fr.fromTimestamp((function(l){const p=qm(l);return new lo(p.seconds,p.nanos)})(c))}function ES(c,n){return sE(c,n).canonicalString()}function sE(c,n){const l=(function(b){return new Xs(["projects",b.projectId,"databases",b.database])})(c).child("documents");return n===void 0?l:l.child(n)}function sL(c){const n=Xs.fromString(c);return Rs(uL(n),10190,{key:n.toString()}),n}function oE(c,n){return ES(c.databaseId,n.path)}function IT(c,n){const l=sL(n);if(l.get(1)!==c.databaseId.projectId)throw new Ji(di.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+l.get(1)+" vs "+c.databaseId.projectId);if(l.get(3)!==c.databaseId.database)throw new Ji(di.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+l.get(3)+" vs "+c.databaseId.database);return new zn(aL(l))}function oL(c,n){return ES(c.databaseId,n)}function v9(c){const n=sL(c);return n.length===4?Xs.emptyPath():aL(n)}function aE(c){return new Xs(["projects",c.databaseId.projectId,"databases",c.databaseId.database]).canonicalString()}function aL(c){return Rs(c.length>4&&c.get(4)==="documents",29091,{key:c.toString()}),c.popFirst(5)}function DR(c,n,l){return{name:oE(c,n),fields:l.value.mapValue.fields}}function x9(c,n){let l;if("targetChange"in n){n.targetChange;const p=(function(q){return q==="NO_CHANGE"?0:q==="ADD"?1:q==="REMOVE"?2:q==="CURRENT"?3:q==="RESET"?4:ir(39313,{state:q})})(n.targetChange.targetChangeType||"NO_CHANGE"),b=n.targetChange.targetIds||[],I=(function(q,ie){return q.useProto3Json?(Rs(ie===void 0||typeof ie=="string",58123),ll.fromBase64String(ie||"")):(Rs(ie===void 0||ie instanceof Buffer||ie instanceof Uint8Array,16193),ll.fromUint8Array(ie||new Uint8Array))})(c,n.targetChange.resumeToken),P=n.targetChange.cause,s=P&&(function(q){const ie=q.code===void 0?di.UNKNOWN:tL(q.code);return new Ji(ie,q.message||"")})(P);l=new nL(p,b,I,s||null)}else if("documentChange"in n){n.documentChange;const p=n.documentChange;p.document,p.document.name,p.document.updateTime;const b=IT(c,p.document.name),I=tf(p.document.updateTime),P=p.document.createTime?tf(p.document.createTime):fr.min(),s=new Fc({mapValue:{fields:p.document.fields}}),G=Ol.newFoundDocument(b,I,P,s),q=p.targetIds||[],ie=p.removedTargetIds||[];l=new kb(q,ie,G.key,G)}else if("documentDelete"in n){n.documentDelete;const p=n.documentDelete;p.document;const b=IT(c,p.document),I=p.readTime?tf(p.readTime):fr.min(),P=Ol.newNoDocument(b,I),s=p.removedTargetIds||[];l=new kb([],s,P.key,P)}else if("documentRemove"in n){n.documentRemove;const p=n.documentRemove;p.document;const b=IT(c,p.document),I=p.removedTargetIds||[];l=new kb([],I,b,null)}else{if(!("filter"in n))return ir(11601,{Rt:n});{n.filter;const p=n.filter;p.targetId;const{count:b=0,unchangedNames:I}=p,P=new c9(b,I),s=p.targetId;l=new iL(s,P)}}return l}function b9(c,n){let l;if(n instanceof J0)l={update:DR(c,n.key,n.value)};else if(n instanceof bS)l={delete:oE(c,n.key)};else if(n instanceof Jm)l={update:DR(c,n.key,n.data),updateMask:M9(n.fieldMask)};else{if(!(n instanceof o9))return ir(16599,{Vt:n.type});l={verify:oE(c,n.key)}}return n.fieldTransforms.length>0&&(l.updateTransforms=n.fieldTransforms.map((p=>(function(I,P){const s=P.transform;if(s instanceof n1)return{fieldPath:P.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Gy)return{fieldPath:P.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof qy)return{fieldPath:P.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof r1)return{fieldPath:P.field.canonicalString(),increment:s.Ae};throw ir(20930,{transform:P.transform})})(0,p)))),n.precondition.isNone||(l.currentDocument=(function(b,I){return I.updateTime!==void 0?{updateTime:y9(b,I.updateTime)}:I.exists!==void 0?{exists:I.exists}:ir(27497)})(c,n.precondition)),l}function w9(c,n){return c&&c.length>0?(Rs(n!==void 0,14353),c.map((l=>(function(b,I){let P=b.updateTime?tf(b.updateTime):tf(I);return P.isEqual(fr.min())&&(P=tf(I)),new n9(P,b.transformResults||[])})(l,n)))):[]}function T9(c,n){return{documents:[oL(c,n.path)]}}function E9(c,n){const l={structuredQuery:{}},p=n.path;let b;n.collectionGroup!==null?(b=p,l.structuredQuery.from=[{collectionId:n.collectionGroup,allDescendants:!0}]):(b=p.popLast(),l.structuredQuery.from=[{collectionId:p.lastSegment()}]),l.parent=oL(c,b);const I=(function(q){if(q.length!==0)return cL(od.create(q,"and"))})(n.filters);I&&(l.structuredQuery.where=I);const P=(function(q){if(q.length!==0)return q.map((ie=>(function(be){return{field:Iy(be.field),direction:I9(be.dir)}})(ie)))})(n.orderBy);P&&(l.structuredQuery.orderBy=P);const s=rE(c,n.limit);return s!==null&&(l.structuredQuery.limit=s),n.startAt&&(l.structuredQuery.startAt=(function(q){return{before:q.inclusive,values:q.position}})(n.startAt)),n.endAt&&(l.structuredQuery.endAt=(function(q){return{before:!q.inclusive,values:q.position}})(n.endAt)),{ft:l,parent:b}}function S9(c){let n=v9(c.parent);const l=c.structuredQuery,p=l.from?l.from.length:0;let b=null;if(p>0){Rs(p===1,65062);const ie=l.from[0];ie.allDescendants?b=ie.collectionId:n=n.child(ie.collectionId)}let I=[];l.where&&(I=(function(ce){const be=lL(ce);return be instanceof od&&FO(be)?be.getFilters():[be]})(l.where));let P=[];l.orderBy&&(P=(function(ce){return ce.map((be=>(function(Je){return new F0(Cy(Je.field),(function(Ze){switch(Ze){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(Je.direction))})(be)))})(l.orderBy));let s=null;l.limit&&(s=(function(ce){let be;return be=typeof ce=="object"?ce.value:ce,C1(be)?null:be})(l.limit));let G=null;l.startAt&&(G=(function(ce){const be=!!ce.before,He=ce.values||[];return new i1(He,be)})(l.startAt));let q=null;return l.endAt&&(q=(function(ce){const be=!ce.before,He=ce.values||[];return new i1(He,be)})(l.endAt)),qG(n,b,P,I,s,"F",G,q)}function A9(c,n){const l=(function(b){switch(b){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ir(28987,{purpose:b})}})(n.purpose);return l==null?null:{"goog-listen-tags":l}}function lL(c){return c.unaryFilter!==void 0?(function(l){switch(l.unaryFilter.op){case"IS_NAN":const p=Cy(l.unaryFilter.field);return fa.create(p,"==",{doubleValue:NaN});case"IS_NULL":const b=Cy(l.unaryFilter.field);return fa.create(b,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const I=Cy(l.unaryFilter.field);return fa.create(I,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const P=Cy(l.unaryFilter.field);return fa.create(P,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ir(61313);default:return ir(60726)}})(c):c.fieldFilter!==void 0?(function(l){return fa.create(Cy(l.fieldFilter.field),(function(b){switch(b){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ir(58110);default:return ir(50506)}})(l.fieldFilter.op),l.fieldFilter.value)})(c):c.compositeFilter!==void 0?(function(l){return od.create(l.compositeFilter.filters.map((p=>lL(p))),(function(b){switch(b){case"AND":return"and";case"OR":return"or";default:return ir(1026)}})(l.compositeFilter.op))})(c):ir(30097,{filter:c})}function I9(c){return p9[c]}function C9(c){return m9[c]}function R9(c){return g9[c]}function Iy(c){return{fieldPath:c.canonicalString()}}function Cy(c){return al.fromServerFormat(c.fieldPath)}function cL(c){return c instanceof fa?(function(l){if(l.op==="=="){if(yR(l.value))return{unaryFilter:{field:Iy(l.field),op:"IS_NAN"}};if(_R(l.value))return{unaryFilter:{field:Iy(l.field),op:"IS_NULL"}}}else if(l.op==="!="){if(yR(l.value))return{unaryFilter:{field:Iy(l.field),op:"IS_NOT_NAN"}};if(_R(l.value))return{unaryFilter:{field:Iy(l.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Iy(l.field),op:C9(l.op),value:l.value}}})(c):c instanceof od?(function(l){const p=l.getFilters().map((b=>cL(b)));return p.length===1?p[0]:{compositeFilter:{op:R9(l.op),filters:p}}})(c):ir(54877,{filter:c})}function M9(c){const n=[];return c.fields.forEach((l=>n.push(l.canonicalString()))),{fieldPaths:n}}function uL(c){return c.length>=4&&c.get(0)==="projects"&&c.get(2)==="databases"}class zm{constructor(n,l,p,b,I=fr.min(),P=fr.min(),s=ll.EMPTY_BYTE_STRING,G=null){this.target=n,this.targetId=l,this.purpose=p,this.sequenceNumber=b,this.snapshotVersion=I,this.lastLimboFreeSnapshotVersion=P,this.resumeToken=s,this.expectedCount=G}withSequenceNumber(n){return new zm(this.target,this.targetId,this.purpose,n,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(n,l){return new zm(this.target,this.targetId,this.purpose,this.sequenceNumber,l,this.lastLimboFreeSnapshotVersion,n,null)}withExpectedCount(n){return new zm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,n)}withLastLimboFreeSnapshotVersion(n){return new zm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,n,this.resumeToken,this.expectedCount)}}class D9{constructor(n){this.yt=n}}function P9(c){const n=S9({parent:c.parent,structuredQuery:c.structuredQuery});return c.limitType==="LAST"?nE(n,n.limit,"L"):n}class O9{constructor(){this.Cn=new L9}addToCollectionParentIndex(n,l){return this.Cn.add(l),yi.resolve()}getCollectionParents(n,l){return yi.resolve(this.Cn.getEntries(l))}addFieldIndex(n,l){return yi.resolve()}deleteFieldIndex(n,l){return yi.resolve()}deleteAllFieldIndexes(n){return yi.resolve()}createTargetIndexes(n,l){return yi.resolve()}getDocumentsMatchingTarget(n,l){return yi.resolve(null)}getIndexType(n,l){return yi.resolve(0)}getFieldIndexes(n,l){return yi.resolve([])}getNextCollectionGroupToUpdate(n){return yi.resolve(null)}getMinOffset(n,l){return yi.resolve(Gm.min())}getMinOffsetFromCollectionGroup(n,l){return yi.resolve(Gm.min())}updateCollectionGroup(n,l,p){return yi.resolve()}updateIndexEntries(n,l){return yi.resolve()}}class L9{constructor(){this.index={}}add(n){const l=n.lastSegment(),p=n.popLast(),b=this.index[l]||new Ra(Xs.comparator),I=!b.has(p);return this.index[l]=b.add(p),I}has(n){const l=n.lastSegment(),p=n.popLast(),b=this.index[l];return b&&b.has(p)}getEntries(n){return(this.index[n]||new Ra(Xs.comparator)).toArray()}}const PR={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hL=41943040;class kc{static withCacheSize(n){return new kc(n,kc.DEFAULT_COLLECTION_PERCENTILE,kc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(n,l,p){this.cacheSizeCollectionThreshold=n,this.percentileToCollect=l,this.maximumSequenceNumbersToCollect=p}}kc.DEFAULT_COLLECTION_PERCENTILE=10,kc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,kc.DEFAULT=new kc(hL,kc.DEFAULT_COLLECTION_PERCENTILE,kc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),kc.DISABLED=new kc(-1,0,0);class Hy{constructor(n){this.ar=n}next(){return this.ar+=2,this.ar}static ur(){return new Hy(0)}static cr(){return new Hy(-1)}}const OR="LruGarbageCollector",z9=1048576;function LR([c,n],[l,p]){const b=is(c,l);return b===0?is(n,p):b}class k9{constructor(n){this.Ir=n,this.buffer=new Ra(LR),this.Er=0}dr(){return++this.Er}Ar(n){const l=[n,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(l);else{const p=this.buffer.last();LR(l,p)<0&&(this.buffer=this.buffer.delete(p).add(l))}}get maxValue(){return this.buffer.last()[0]}}class F9{constructor(n,l,p){this.garbageCollector=n,this.asyncQueue=l,this.localStore=p,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(n){cn(OR,`Garbage collection scheduled in ${n}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(l){iv(l)?cn(OR,"Ignoring IndexedDB error during garbage collection: ",l):await tv(l)}await this.Vr(3e5)}))}}class B9{constructor(n,l){this.mr=n,this.params=l}calculateTargetCount(n,l){return this.mr.gr(n).next((p=>Math.floor(l/100*p)))}nthSequenceNumber(n,l){if(l===0)return yi.resolve(I1.ce);const p=new k9(l);return this.mr.forEachTarget(n,(b=>p.Ar(b.sequenceNumber))).next((()=>this.mr.pr(n,(b=>p.Ar(b))))).next((()=>p.maxValue))}removeTargets(n,l,p){return this.mr.removeTargets(n,l,p)}removeOrphanedDocuments(n,l){return this.mr.removeOrphanedDocuments(n,l)}collect(n,l){return this.params.cacheSizeCollectionThreshold===-1?(cn("LruGarbageCollector","Garbage collection skipped; disabled"),yi.resolve(PR)):this.getCacheSize(n).next((p=>p<this.params.cacheSizeCollectionThreshold?(cn("LruGarbageCollector",`Garbage collection skipped; Cache size ${p} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),PR):this.yr(n,l)))}getCacheSize(n){return this.mr.getCacheSize(n)}yr(n,l){let p,b,I,P,s,G,q;const ie=Date.now();return this.calculateTargetCount(n,this.params.percentileToCollect).next((ce=>(ce>this.params.maximumSequenceNumbersToCollect?(cn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${ce}`),b=this.params.maximumSequenceNumbersToCollect):b=ce,P=Date.now(),this.nthSequenceNumber(n,b)))).next((ce=>(p=ce,s=Date.now(),this.removeTargets(n,p,l)))).next((ce=>(I=ce,G=Date.now(),this.removeOrphanedDocuments(n,p)))).next((ce=>(q=Date.now(),Sy()<=ts.DEBUG&&cn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${P-ie}ms
	Determined least recently used ${b} in `+(s-P)+`ms
	Removed ${I} targets in `+(G-s)+`ms
	Removed ${ce} documents in `+(q-G)+`ms
Total Duration: ${q-ie}ms`),yi.resolve({didRun:!0,sequenceNumbersCollected:b,targetsRemoved:I,documentsRemoved:ce}))))}}function N9(c,n){return new B9(c,n)}class V9{constructor(){this.changes=new v_((n=>n.toString()),((n,l)=>n.isEqual(l))),this.changesApplied=!1}addEntry(n){this.assertNotApplied(),this.changes.set(n.key,n)}removeEntry(n,l){this.assertNotApplied(),this.changes.set(n,Ol.newInvalidDocument(n).setReadTime(l))}getEntry(n,l){this.assertNotApplied();const p=this.changes.get(l);return p!==void 0?yi.resolve(p):this.getFromCache(n,l)}getEntries(n,l){return this.getAllFromCache(n,l)}apply(n){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(n)}assertNotApplied(){}}class U9{constructor(n,l){this.overlayedDocument=n,this.mutatedFields=l}}class j9{constructor(n,l,p,b){this.remoteDocumentCache=n,this.mutationQueue=l,this.documentOverlayCache=p,this.indexManager=b}getDocument(n,l){let p=null;return this.documentOverlayCache.getOverlay(n,l).next((b=>(p=b,this.remoteDocumentCache.getEntry(n,l)))).next((b=>(p!==null&&I0(p.mutation,b,gu.empty(),lo.now()),b)))}getDocuments(n,l){return this.remoteDocumentCache.getEntries(n,l).next((p=>this.getLocalViewOfDocuments(n,p,ns()).next((()=>p))))}getLocalViewOfDocuments(n,l,p=ns()){const b=r_();return this.populateOverlays(n,b,l).next((()=>this.computeViews(n,l,b,p).next((I=>{let P=y0();return I.forEach(((s,G)=>{P=P.insert(s,G.overlayedDocument)})),P}))))}getOverlayedDocuments(n,l){const p=r_();return this.populateOverlays(n,p,l).next((()=>this.computeViews(n,l,p,ns())))}populateOverlays(n,l,p){const b=[];return p.forEach((I=>{l.has(I)||b.push(I)})),this.documentOverlayCache.getOverlays(n,b).next((I=>{I.forEach(((P,s)=>{l.set(P,s)}))}))}computeViews(n,l,p,b){let I=mp();const P=A0(),s=(function(){return A0()})();return l.forEach(((G,q)=>{const ie=p.get(q.key);b.has(q.key)&&(ie===void 0||ie.mutation instanceof Jm)?I=I.insert(q.key,q):ie!==void 0?(P.set(q.key,ie.mutation.getFieldMask()),I0(ie.mutation,q,ie.mutation.getFieldMask(),lo.now())):P.set(q.key,gu.empty())})),this.recalculateAndSaveOverlays(n,I).next((G=>(G.forEach(((q,ie)=>P.set(q,ie))),l.forEach(((q,ie)=>s.set(q,new U9(ie,P.get(q)??null)))),s)))}recalculateAndSaveOverlays(n,l){const p=A0();let b=new Io(((P,s)=>P-s)),I=ns();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(n,l).next((P=>{for(const s of P)s.keys().forEach((G=>{const q=l.get(G);if(q===null)return;let ie=p.get(G)||gu.empty();ie=s.applyToLocalView(q,ie),p.set(G,ie);const ce=(b.get(s.batchId)||ns()).add(G);b=b.insert(s.batchId,ce)}))})).next((()=>{const P=[],s=b.getReverseIterator();for(;s.hasNext();){const G=s.getNext(),q=G.key,ie=G.value,ce=$O();ie.forEach((be=>{if(!I.has(be)){const He=JO(l.get(be),p.get(be));He!==null&&ce.set(be,He),I=I.add(be)}})),P.push(this.documentOverlayCache.saveOverlays(n,q,ce))}return yi.waitFor(P)})).next((()=>p))}recalculateAndSaveOverlaysForDocumentKeys(n,l){return this.remoteDocumentCache.getEntries(n,l).next((p=>this.recalculateAndSaveOverlays(n,p)))}getDocumentsMatchingQuery(n,l,p,b){return(function(P){return zn.isDocumentKey(P.path)&&P.collectionGroup===null&&P.filters.length===0})(l)?this.getDocumentsMatchingDocumentQuery(n,l.path):UO(l)?this.getDocumentsMatchingCollectionGroupQuery(n,l,p,b):this.getDocumentsMatchingCollectionQuery(n,l,p,b)}getNextDocuments(n,l,p,b){return this.remoteDocumentCache.getAllFromCollectionGroup(n,l,p,b).next((I=>{const P=b-I.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(n,l,p.largestBatchId,b-I.size):yi.resolve(r_());let s=O0,G=I;return P.next((q=>yi.forEach(q,((ie,ce)=>(s<ce.largestBatchId&&(s=ce.largestBatchId),I.get(ie)?yi.resolve():this.remoteDocumentCache.getEntry(n,ie).next((be=>{G=G.insert(ie,be)}))))).next((()=>this.populateOverlays(n,q,I))).next((()=>this.computeViews(n,G,q,ns()))).next((ie=>({batchId:s,changes:HO(ie)})))))}))}getDocumentsMatchingDocumentQuery(n,l){return this.getDocument(n,new zn(l)).next((p=>{let b=y0();return p.isFoundDocument()&&(b=b.insert(p.key,p)),b}))}getDocumentsMatchingCollectionGroupQuery(n,l,p,b){const I=l.collectionGroup;let P=y0();return this.indexManager.getCollectionParents(n,I).next((s=>yi.forEach(s,(G=>{const q=(function(ce,be){return new nv(be,null,ce.explicitOrderBy.slice(),ce.filters.slice(),ce.limit,ce.limitType,ce.startAt,ce.endAt)})(l,G.child(I));return this.getDocumentsMatchingCollectionQuery(n,q,p,b).next((ie=>{ie.forEach(((ce,be)=>{P=P.insert(ce,be)}))}))})).next((()=>P))))}getDocumentsMatchingCollectionQuery(n,l,p,b){let I;return this.documentOverlayCache.getOverlaysForCollection(n,l.path,p.largestBatchId).next((P=>(I=P,this.remoteDocumentCache.getDocumentsMatchingQuery(n,l,p,I,b)))).next((P=>{I.forEach(((G,q)=>{const ie=q.getKey();P.get(ie)===null&&(P=P.insert(ie,Ol.newInvalidDocument(ie)))}));let s=y0();return P.forEach(((G,q)=>{const ie=I.get(G);ie!==void 0&&I0(ie.mutation,q,gu.empty(),lo.now()),D1(l,q)&&(s=s.insert(G,q))})),s}))}}class G9{constructor(n){this.serializer=n,this.Lr=new Map,this.kr=new Map}getBundleMetadata(n,l){return yi.resolve(this.Lr.get(l))}saveBundleMetadata(n,l){return this.Lr.set(l.id,(function(b){return{id:b.id,version:b.version,createTime:tf(b.createTime)}})(l)),yi.resolve()}getNamedQuery(n,l){return yi.resolve(this.kr.get(l))}saveNamedQuery(n,l){return this.kr.set(l.name,(function(b){return{name:b.name,query:P9(b.bundledQuery),readTime:tf(b.readTime)}})(l)),yi.resolve()}}class q9{constructor(){this.overlays=new Io(zn.comparator),this.qr=new Map}getOverlay(n,l){return yi.resolve(this.overlays.get(l))}getOverlays(n,l){const p=r_();return yi.forEach(l,(b=>this.getOverlay(n,b).next((I=>{I!==null&&p.set(b,I)})))).next((()=>p))}saveOverlays(n,l,p){return p.forEach(((b,I)=>{this.St(n,l,I)})),yi.resolve()}removeOverlaysForBatchId(n,l,p){const b=this.qr.get(p);return b!==void 0&&(b.forEach((I=>this.overlays=this.overlays.remove(I))),this.qr.delete(p)),yi.resolve()}getOverlaysForCollection(n,l,p){const b=r_(),I=l.length+1,P=new zn(l.child("")),s=this.overlays.getIteratorFrom(P);for(;s.hasNext();){const G=s.getNext().value,q=G.getKey();if(!l.isPrefixOf(q.path))break;q.path.length===I&&G.largestBatchId>p&&b.set(G.getKey(),G)}return yi.resolve(b)}getOverlaysForCollectionGroup(n,l,p,b){let I=new Io(((q,ie)=>q-ie));const P=this.overlays.getIterator();for(;P.hasNext();){const q=P.getNext().value;if(q.getKey().getCollectionGroup()===l&&q.largestBatchId>p){let ie=I.get(q.largestBatchId);ie===null&&(ie=r_(),I=I.insert(q.largestBatchId,ie)),ie.set(q.getKey(),q)}}const s=r_(),G=I.getIterator();for(;G.hasNext()&&(G.getNext().value.forEach(((q,ie)=>s.set(q,ie))),!(s.size()>=b)););return yi.resolve(s)}St(n,l,p){const b=this.overlays.get(p.key);if(b!==null){const P=this.qr.get(b.largestBatchId).delete(p.key);this.qr.set(b.largestBatchId,P)}this.overlays=this.overlays.insert(p.key,new l9(l,p));let I=this.qr.get(l);I===void 0&&(I=ns(),this.qr.set(l,I)),this.qr.set(l,I.add(p.key))}}class H9{constructor(){this.sessionToken=ll.EMPTY_BYTE_STRING}getSessionToken(n){return yi.resolve(this.sessionToken)}setSessionToken(n,l){return this.sessionToken=l,yi.resolve()}}class SS{constructor(){this.Qr=new Ra(Ha.$r),this.Ur=new Ra(Ha.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(n,l){const p=new Ha(n,l);this.Qr=this.Qr.add(p),this.Ur=this.Ur.add(p)}Wr(n,l){n.forEach((p=>this.addReference(p,l)))}removeReference(n,l){this.Gr(new Ha(n,l))}zr(n,l){n.forEach((p=>this.removeReference(p,l)))}jr(n){const l=new zn(new Xs([])),p=new Ha(l,n),b=new Ha(l,n+1),I=[];return this.Ur.forEachInRange([p,b],(P=>{this.Gr(P),I.push(P.key)})),I}Jr(){this.Qr.forEach((n=>this.Gr(n)))}Gr(n){this.Qr=this.Qr.delete(n),this.Ur=this.Ur.delete(n)}Hr(n){const l=new zn(new Xs([])),p=new Ha(l,n),b=new Ha(l,n+1);let I=ns();return this.Ur.forEachInRange([p,b],(P=>{I=I.add(P.key)})),I}containsKey(n){const l=new Ha(n,0),p=this.Qr.firstAfterOrEqual(l);return p!==null&&n.isEqual(p.key)}}class Ha{constructor(n,l){this.key=n,this.Yr=l}static $r(n,l){return zn.comparator(n.key,l.key)||is(n.Yr,l.Yr)}static Kr(n,l){return is(n.Yr,l.Yr)||zn.comparator(n.key,l.key)}}class $9{constructor(n,l){this.indexManager=n,this.referenceDelegate=l,this.mutationQueue=[],this.tr=1,this.Zr=new Ra(Ha.$r)}checkEmpty(n){return yi.resolve(this.mutationQueue.length===0)}addMutationBatch(n,l,p,b){const I=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const P=new a9(I,l,p,b);this.mutationQueue.push(P);for(const s of b)this.Zr=this.Zr.add(new Ha(s.key,I)),this.indexManager.addToCollectionParentIndex(n,s.key.path.popLast());return yi.resolve(P)}lookupMutationBatch(n,l){return yi.resolve(this.Xr(l))}getNextMutationBatchAfterBatchId(n,l){const p=l+1,b=this.ei(p),I=b<0?0:b;return yi.resolve(this.mutationQueue.length>I?this.mutationQueue[I]:null)}getHighestUnacknowledgedBatchId(){return yi.resolve(this.mutationQueue.length===0?pS:this.tr-1)}getAllMutationBatches(n){return yi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(n,l){const p=new Ha(l,0),b=new Ha(l,Number.POSITIVE_INFINITY),I=[];return this.Zr.forEachInRange([p,b],(P=>{const s=this.Xr(P.Yr);I.push(s)})),yi.resolve(I)}getAllMutationBatchesAffectingDocumentKeys(n,l){let p=new Ra(is);return l.forEach((b=>{const I=new Ha(b,0),P=new Ha(b,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([I,P],(s=>{p=p.add(s.Yr)}))})),yi.resolve(this.ti(p))}getAllMutationBatchesAffectingQuery(n,l){const p=l.path,b=p.length+1;let I=p;zn.isDocumentKey(I)||(I=I.child(""));const P=new Ha(new zn(I),0);let s=new Ra(is);return this.Zr.forEachWhile((G=>{const q=G.key.path;return!!p.isPrefixOf(q)&&(q.length===b&&(s=s.add(G.Yr)),!0)}),P),yi.resolve(this.ti(s))}ti(n){const l=[];return n.forEach((p=>{const b=this.Xr(p);b!==null&&l.push(b)})),l}removeMutationBatch(n,l){Rs(this.ni(l.batchId,"removed")===0,55003),this.mutationQueue.shift();let p=this.Zr;return yi.forEach(l.mutations,(b=>{const I=new Ha(b.key,l.batchId);return p=p.delete(I),this.referenceDelegate.markPotentiallyOrphaned(n,b.key)})).next((()=>{this.Zr=p}))}ir(n){}containsKey(n,l){const p=new Ha(l,0),b=this.Zr.firstAfterOrEqual(p);return yi.resolve(l.isEqual(b&&b.key))}performConsistencyCheck(n){return this.mutationQueue.length,yi.resolve()}ni(n,l){return this.ei(n)}ei(n){return this.mutationQueue.length===0?0:n-this.mutationQueue[0].batchId}Xr(n){const l=this.ei(n);return l<0||l>=this.mutationQueue.length?null:this.mutationQueue[l]}}class W9{constructor(n){this.ri=n,this.docs=(function(){return new Io(zn.comparator)})(),this.size=0}setIndexManager(n){this.indexManager=n}addEntry(n,l){const p=l.key,b=this.docs.get(p),I=b?b.size:0,P=this.ri(l);return this.docs=this.docs.insert(p,{document:l.mutableCopy(),size:P}),this.size+=P-I,this.indexManager.addToCollectionParentIndex(n,p.path.popLast())}removeEntry(n){const l=this.docs.get(n);l&&(this.docs=this.docs.remove(n),this.size-=l.size)}getEntry(n,l){const p=this.docs.get(l);return yi.resolve(p?p.document.mutableCopy():Ol.newInvalidDocument(l))}getEntries(n,l){let p=mp();return l.forEach((b=>{const I=this.docs.get(b);p=p.insert(b,I?I.document.mutableCopy():Ol.newInvalidDocument(b))})),yi.resolve(p)}getDocumentsMatchingQuery(n,l,p,b){let I=mp();const P=l.path,s=new zn(P.child("__id-9223372036854775808__")),G=this.docs.getIteratorFrom(s);for(;G.hasNext();){const{key:q,value:{document:ie}}=G.getNext();if(!P.isPrefixOf(q.path))break;q.path.length>P.length+1||wG(bG(ie),p)<=0||(b.has(ie.key)||D1(l,ie))&&(I=I.insert(ie.key,ie.mutableCopy()))}return yi.resolve(I)}getAllFromCollectionGroup(n,l,p,b){ir(9500)}ii(n,l){return yi.forEach(this.docs,(p=>l(p)))}newChangeBuffer(n){return new Z9(this)}getSize(n){return yi.resolve(this.size)}}class Z9 extends V9{constructor(n){super(),this.Nr=n}applyChanges(n){const l=[];return this.changes.forEach(((p,b)=>{b.isValidDocument()?l.push(this.Nr.addEntry(n,b)):this.Nr.removeEntry(p)})),yi.waitFor(l)}getFromCache(n,l){return this.Nr.getEntry(n,l)}getAllFromCache(n,l){return this.Nr.getEntries(n,l)}}class X9{constructor(n){this.persistence=n,this.si=new v_((l=>_S(l)),yS),this.lastRemoteSnapshotVersion=fr.min(),this.highestTargetId=0,this.oi=0,this._i=new SS,this.targetCount=0,this.ai=Hy.ur()}forEachTarget(n,l){return this.si.forEach(((p,b)=>l(b))),yi.resolve()}getLastRemoteSnapshotVersion(n){return yi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(n){return yi.resolve(this.oi)}allocateTargetId(n){return this.highestTargetId=this.ai.next(),yi.resolve(this.highestTargetId)}setTargetsMetadata(n,l,p){return p&&(this.lastRemoteSnapshotVersion=p),l>this.oi&&(this.oi=l),yi.resolve()}Pr(n){this.si.set(n.target,n);const l=n.targetId;l>this.highestTargetId&&(this.ai=new Hy(l),this.highestTargetId=l),n.sequenceNumber>this.oi&&(this.oi=n.sequenceNumber)}addTargetData(n,l){return this.Pr(l),this.targetCount+=1,yi.resolve()}updateTargetData(n,l){return this.Pr(l),yi.resolve()}removeTargetData(n,l){return this.si.delete(l.target),this._i.jr(l.targetId),this.targetCount-=1,yi.resolve()}removeTargets(n,l,p){let b=0;const I=[];return this.si.forEach(((P,s)=>{s.sequenceNumber<=l&&p.get(s.targetId)===null&&(this.si.delete(P),I.push(this.removeMatchingKeysForTargetId(n,s.targetId)),b++)})),yi.waitFor(I).next((()=>b))}getTargetCount(n){return yi.resolve(this.targetCount)}getTargetData(n,l){const p=this.si.get(l)||null;return yi.resolve(p)}addMatchingKeys(n,l,p){return this._i.Wr(l,p),yi.resolve()}removeMatchingKeys(n,l,p){this._i.zr(l,p);const b=this.persistence.referenceDelegate,I=[];return b&&l.forEach((P=>{I.push(b.markPotentiallyOrphaned(n,P))})),yi.waitFor(I)}removeMatchingKeysForTargetId(n,l){return this._i.jr(l),yi.resolve()}getMatchingKeysForTargetId(n,l){const p=this._i.Hr(l);return yi.resolve(p)}containsKey(n,l){return yi.resolve(this._i.containsKey(l))}}class dL{constructor(n,l){this.ui={},this.overlays={},this.ci=new I1(0),this.li=!1,this.li=!0,this.hi=new H9,this.referenceDelegate=n(this),this.Pi=new X9(this),this.indexManager=new O9,this.remoteDocumentCache=(function(b){return new W9(b)})((p=>this.referenceDelegate.Ti(p))),this.serializer=new D9(l),this.Ii=new G9(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(n){return this.indexManager}getDocumentOverlayCache(n){let l=this.overlays[n.toKey()];return l||(l=new q9,this.overlays[n.toKey()]=l),l}getMutationQueue(n,l){let p=this.ui[n.toKey()];return p||(p=new $9(l,this.referenceDelegate),this.ui[n.toKey()]=p),p}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(n,l,p){cn("MemoryPersistence","Starting transaction:",n);const b=new K9(this.ci.next());return this.referenceDelegate.Ei(),p(b).next((I=>this.referenceDelegate.di(b).next((()=>I)))).toPromise().then((I=>(b.raiseOnCommittedEvent(),I)))}Ai(n,l){return yi.or(Object.values(this.ui).map((p=>()=>p.containsKey(n,l))))}}class K9 extends EG{constructor(n){super(),this.currentSequenceNumber=n}}class AS{constructor(n){this.persistence=n,this.Ri=new SS,this.Vi=null}static mi(n){return new AS(n)}get fi(){if(this.Vi)return this.Vi;throw ir(60996)}addReference(n,l,p){return this.Ri.addReference(p,l),this.fi.delete(p.toString()),yi.resolve()}removeReference(n,l,p){return this.Ri.removeReference(p,l),this.fi.add(p.toString()),yi.resolve()}markPotentiallyOrphaned(n,l){return this.fi.add(l.toString()),yi.resolve()}removeTarget(n,l){this.Ri.jr(l.targetId).forEach((b=>this.fi.add(b.toString())));const p=this.persistence.getTargetCache();return p.getMatchingKeysForTargetId(n,l.targetId).next((b=>{b.forEach((I=>this.fi.add(I.toString())))})).next((()=>p.removeTargetData(n,l)))}Ei(){this.Vi=new Set}di(n){const l=this.persistence.getRemoteDocumentCache().newChangeBuffer();return yi.forEach(this.fi,(p=>{const b=zn.fromPath(p);return this.gi(n,b).next((I=>{I||l.removeEntry(b,fr.min())}))})).next((()=>(this.Vi=null,l.apply(n))))}updateLimboDocument(n,l){return this.gi(n,l).next((p=>{p?this.fi.delete(l.toString()):this.fi.add(l.toString())}))}Ti(n){return 0}gi(n,l){return yi.or([()=>yi.resolve(this.Ri.containsKey(l)),()=>this.persistence.getTargetCache().containsKey(n,l),()=>this.persistence.Ai(n,l)])}}class o1{constructor(n,l){this.persistence=n,this.pi=new v_((p=>IG(p.path)),((p,b)=>p.isEqual(b))),this.garbageCollector=N9(this,l)}static mi(n,l){return new o1(n,l)}Ei(){}di(n){return yi.resolve()}forEachTarget(n,l){return this.persistence.getTargetCache().forEachTarget(n,l)}gr(n){const l=this.wr(n);return this.persistence.getTargetCache().getTargetCount(n).next((p=>l.next((b=>p+b))))}wr(n){let l=0;return this.pr(n,(p=>{l++})).next((()=>l))}pr(n,l){return yi.forEach(this.pi,((p,b)=>this.br(n,p,b).next((I=>I?yi.resolve():l(b)))))}removeTargets(n,l,p){return this.persistence.getTargetCache().removeTargets(n,l,p)}removeOrphanedDocuments(n,l){let p=0;const b=this.persistence.getRemoteDocumentCache(),I=b.newChangeBuffer();return b.ii(n,(P=>this.br(n,P,l).next((s=>{s||(p++,I.removeEntry(P,fr.min()))})))).next((()=>I.apply(n))).next((()=>p))}markPotentiallyOrphaned(n,l){return this.pi.set(l,n.currentSequenceNumber),yi.resolve()}removeTarget(n,l){const p=l.withSequenceNumber(n.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(n,p)}addReference(n,l,p){return this.pi.set(p,n.currentSequenceNumber),yi.resolve()}removeReference(n,l,p){return this.pi.set(p,n.currentSequenceNumber),yi.resolve()}updateLimboDocument(n,l){return this.pi.set(l,n.currentSequenceNumber),yi.resolve()}Ti(n){let l=n.key.toString().length;return n.isFoundDocument()&&(l+=Ob(n.data.value)),l}br(n,l,p){return yi.or([()=>this.persistence.Ai(n,l),()=>this.persistence.getTargetCache().containsKey(n,l),()=>{const b=this.pi.get(l);return yi.resolve(b!==void 0&&b>p)}])}getCacheSize(n){return this.persistence.getRemoteDocumentCache().getSize(n)}}class IS{constructor(n,l,p,b){this.targetId=n,this.fromCache=l,this.Es=p,this.ds=b}static As(n,l){let p=ns(),b=ns();for(const I of l.docChanges)switch(I.type){case 0:p=p.add(I.doc.key);break;case 1:b=b.add(I.doc.key)}return new IS(n,l.fromCache,p,b)}}class Y9{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(n){this._documentReadCount+=n}}class Q9{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Z4()?8:SG(kl())>0?6:4})()}initialize(n,l){this.ps=n,this.indexManager=l,this.Rs=!0}getDocumentsMatchingQuery(n,l,p,b){const I={result:null};return this.ys(n,l).next((P=>{I.result=P})).next((()=>{if(!I.result)return this.ws(n,l,b,p).next((P=>{I.result=P}))})).next((()=>{if(I.result)return;const P=new Y9;return this.Ss(n,l,P).next((s=>{if(I.result=s,this.Vs)return this.bs(n,l,P,s.size)}))})).next((()=>I.result))}bs(n,l,p,b){return p.documentReadCount<this.fs?(Sy()<=ts.DEBUG&&cn("QueryEngine","SDK will not create cache indexes for query:",Ay(l),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),yi.resolve()):(Sy()<=ts.DEBUG&&cn("QueryEngine","Query:",Ay(l),"scans",p.documentReadCount,"local documents and returns",b,"documents as results."),p.documentReadCount>this.gs*b?(Sy()<=ts.DEBUG&&cn("QueryEngine","The SDK decides to create cache indexes for query:",Ay(l),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(n,ef(l))):yi.resolve())}ys(n,l){if(wR(l))return yi.resolve(null);let p=ef(l);return this.indexManager.getIndexType(n,p).next((b=>b===0?null:(l.limit!==null&&b===1&&(l=nE(l,null,"F"),p=ef(l)),this.indexManager.getDocumentsMatchingTarget(n,p).next((I=>{const P=ns(...I);return this.ps.getDocuments(n,P).next((s=>this.indexManager.getMinOffset(n,p).next((G=>{const q=this.Ds(l,s);return this.Cs(l,q,P,G.readTime)?this.ys(n,nE(l,null,"F")):this.vs(n,q,l,G)}))))})))))}ws(n,l,p,b){return wR(l)||b.isEqual(fr.min())?yi.resolve(null):this.ps.getDocuments(n,p).next((I=>{const P=this.Ds(l,I);return this.Cs(l,P,p,b)?yi.resolve(null):(Sy()<=ts.DEBUG&&cn("QueryEngine","Re-using previous result from %s to execute query: %s",b.toString(),Ay(l)),this.vs(n,P,l,xG(b,O0)).next((s=>s)))}))}Ds(n,l){let p=new Ra(GO(n));return l.forEach(((b,I)=>{D1(n,I)&&(p=p.add(I))})),p}Cs(n,l,p,b){if(n.limit===null)return!1;if(p.size!==l.size)return!0;const I=n.limitType==="F"?l.last():l.first();return!!I&&(I.hasPendingWrites||I.version.compareTo(b)>0)}Ss(n,l,p){return Sy()<=ts.DEBUG&&cn("QueryEngine","Using full collection scan to execute query:",Ay(l)),this.ps.getDocumentsMatchingQuery(n,l,Gm.min(),p)}vs(n,l,p,b){return this.ps.getDocumentsMatchingQuery(n,p,b).next((I=>(l.forEach((P=>{I=I.insert(P.key,P)})),I)))}}const CS="LocalStore",J9=3e8;class eq{constructor(n,l,p,b){this.persistence=n,this.Fs=l,this.serializer=b,this.Ms=new Io(is),this.xs=new v_((I=>_S(I)),yS),this.Os=new Map,this.Ns=n.getRemoteDocumentCache(),this.Pi=n.getTargetCache(),this.Ii=n.getBundleCache(),this.Bs(p)}Bs(n){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(n),this.indexManager=this.persistence.getIndexManager(n),this.mutationQueue=this.persistence.getMutationQueue(n,this.indexManager),this.localDocuments=new j9(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(n){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(l=>n.collect(l,this.Ms)))}}function tq(c,n,l,p){return new eq(c,n,l,p)}async function fL(c,n){const l=xr(c);return await l.persistence.runTransaction("Handle user change","readonly",(p=>{let b;return l.mutationQueue.getAllMutationBatches(p).next((I=>(b=I,l.Bs(n),l.mutationQueue.getAllMutationBatches(p)))).next((I=>{const P=[],s=[];let G=ns();for(const q of b){P.push(q.batchId);for(const ie of q.mutations)G=G.add(ie.key)}for(const q of I){s.push(q.batchId);for(const ie of q.mutations)G=G.add(ie.key)}return l.localDocuments.getDocuments(p,G).next((q=>({Ls:q,removedBatchIds:P,addedBatchIds:s})))}))}))}function iq(c,n){const l=xr(c);return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",(p=>{const b=n.batch.keys(),I=l.Ns.newChangeBuffer({trackRemovals:!0});return(function(s,G,q,ie){const ce=q.batch,be=ce.keys();let He=yi.resolve();return be.forEach((Je=>{He=He.next((()=>ie.getEntry(G,Je))).next((it=>{const Ze=q.docVersions.get(Je);Rs(Ze!==null,48541),it.version.compareTo(Ze)<0&&(ce.applyToRemoteDocument(it,q),it.isValidDocument()&&(it.setReadTime(q.commitVersion),ie.addEntry(it)))}))})),He.next((()=>s.mutationQueue.removeMutationBatch(G,ce)))})(l,p,n,I).next((()=>I.apply(p))).next((()=>l.mutationQueue.performConsistencyCheck(p))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(p,b,n.batch.batchId))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,(function(s){let G=ns();for(let q=0;q<s.mutationResults.length;++q)s.mutationResults[q].transformResults.length>0&&(G=G.add(s.batch.mutations[q].key));return G})(n)))).next((()=>l.localDocuments.getDocuments(p,b)))}))}function pL(c){const n=xr(c);return n.persistence.runTransaction("Get last remote snapshot version","readonly",(l=>n.Pi.getLastRemoteSnapshotVersion(l)))}function nq(c,n){const l=xr(c),p=n.snapshotVersion;let b=l.Ms;return l.persistence.runTransaction("Apply remote event","readwrite-primary",(I=>{const P=l.Ns.newChangeBuffer({trackRemovals:!0});b=l.Ms;const s=[];n.targetChanges.forEach(((ie,ce)=>{const be=b.get(ce);if(!be)return;s.push(l.Pi.removeMatchingKeys(I,ie.removedDocuments,ce).next((()=>l.Pi.addMatchingKeys(I,ie.addedDocuments,ce))));let He=be.withSequenceNumber(I.currentSequenceNumber);n.targetMismatches.get(ce)!==null?He=He.withResumeToken(ll.EMPTY_BYTE_STRING,fr.min()).withLastLimboFreeSnapshotVersion(fr.min()):ie.resumeToken.approximateByteSize()>0&&(He=He.withResumeToken(ie.resumeToken,p)),b=b.insert(ce,He),(function(it,Ze,Pt){return it.resumeToken.approximateByteSize()===0||Ze.snapshotVersion.toMicroseconds()-it.snapshotVersion.toMicroseconds()>=J9?!0:Pt.addedDocuments.size+Pt.modifiedDocuments.size+Pt.removedDocuments.size>0})(be,He,ie)&&s.push(l.Pi.updateTargetData(I,He))}));let G=mp(),q=ns();if(n.documentUpdates.forEach((ie=>{n.resolvedLimboDocuments.has(ie)&&s.push(l.persistence.referenceDelegate.updateLimboDocument(I,ie))})),s.push(rq(I,P,n.documentUpdates).next((ie=>{G=ie.ks,q=ie.qs}))),!p.isEqual(fr.min())){const ie=l.Pi.getLastRemoteSnapshotVersion(I).next((ce=>l.Pi.setTargetsMetadata(I,I.currentSequenceNumber,p)));s.push(ie)}return yi.waitFor(s).next((()=>P.apply(I))).next((()=>l.localDocuments.getLocalViewOfDocuments(I,G,q))).next((()=>G))})).then((I=>(l.Ms=b,I)))}function rq(c,n,l){let p=ns(),b=ns();return l.forEach((I=>p=p.add(I))),n.getEntries(c,p).next((I=>{let P=mp();return l.forEach(((s,G)=>{const q=I.get(s);G.isFoundDocument()!==q.isFoundDocument()&&(b=b.add(s)),G.isNoDocument()&&G.version.isEqual(fr.min())?(n.removeEntry(s,G.readTime),P=P.insert(s,G)):!q.isValidDocument()||G.version.compareTo(q.version)>0||G.version.compareTo(q.version)===0&&q.hasPendingWrites?(n.addEntry(G),P=P.insert(s,G)):cn(CS,"Ignoring outdated watch update for ",s,". Current version:",q.version," Watch version:",G.version)})),{ks:P,qs:b}}))}function sq(c,n){const l=xr(c);return l.persistence.runTransaction("Get next mutation batch","readonly",(p=>(n===void 0&&(n=pS),l.mutationQueue.getNextMutationBatchAfterBatchId(p,n))))}function oq(c,n){const l=xr(c);return l.persistence.runTransaction("Allocate target","readwrite",(p=>{let b;return l.Pi.getTargetData(p,n).next((I=>I?(b=I,yi.resolve(b)):l.Pi.allocateTargetId(p).next((P=>(b=new zm(n,P,"TargetPurposeListen",p.currentSequenceNumber),l.Pi.addTargetData(p,b).next((()=>b)))))))})).then((p=>{const b=l.Ms.get(p.targetId);return(b===null||p.snapshotVersion.compareTo(b.snapshotVersion)>0)&&(l.Ms=l.Ms.insert(p.targetId,p),l.xs.set(n,p.targetId)),p}))}async function lE(c,n,l){const p=xr(c),b=p.Ms.get(n),I=l?"readwrite":"readwrite-primary";try{l||await p.persistence.runTransaction("Release target",I,(P=>p.persistence.referenceDelegate.removeTarget(P,b)))}catch(P){if(!iv(P))throw P;cn(CS,`Failed to update sequence numbers for target ${n}: ${P}`)}p.Ms=p.Ms.remove(n),p.xs.delete(b.target)}function zR(c,n,l){const p=xr(c);let b=fr.min(),I=ns();return p.persistence.runTransaction("Execute query","readwrite",(P=>(function(G,q,ie){const ce=xr(G),be=ce.xs.get(ie);return be!==void 0?yi.resolve(ce.Ms.get(be)):ce.Pi.getTargetData(q,ie)})(p,P,ef(n)).next((s=>{if(s)return b=s.lastLimboFreeSnapshotVersion,p.Pi.getMatchingKeysForTargetId(P,s.targetId).next((G=>{I=G}))})).next((()=>p.Fs.getDocumentsMatchingQuery(P,n,l?b:fr.min(),l?I:ns()))).next((s=>(aq(p,$G(n),s),{documents:s,Qs:I})))))}function aq(c,n,l){let p=c.Os.get(n)||fr.min();l.forEach(((b,I)=>{I.readTime.compareTo(p)>0&&(p=I.readTime)})),c.Os.set(n,p)}class kR{constructor(){this.activeTargetIds=QG()}zs(n){this.activeTargetIds=this.activeTargetIds.add(n)}js(n){this.activeTargetIds=this.activeTargetIds.delete(n)}Gs(){const n={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(n)}}class lq{constructor(){this.Mo=new kR,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(n){}updateMutationState(n,l,p){}addLocalQueryTarget(n,l=!0){return l&&this.Mo.zs(n),this.xo[n]||"not-current"}updateQueryState(n,l,p){this.xo[n]=l}removeLocalQueryTarget(n){this.Mo.js(n)}isLocalQueryTarget(n){return this.Mo.activeTargetIds.has(n)}clearQueryState(n){delete this.xo[n]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(n){return this.Mo.activeTargetIds.has(n)}start(){return this.Mo=new kR,Promise.resolve()}handleUserChange(n,l,p){}setOnlineState(n){}shutdown(){}writeSequenceNumber(n){}notifyBundleLoaded(n){}}class cq{Oo(n){}shutdown(){}}const FR="ConnectivityMonitor";class BR{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(n){this.qo.push(n)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){cn(FR,"Network connectivity changed: AVAILABLE");for(const n of this.qo)n(0)}ko(){cn(FR,"Network connectivity changed: UNAVAILABLE");for(const n of this.qo)n(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Sb=null;function cE(){return Sb===null?Sb=(function(){return 268435456+Math.round(2147483648*Math.random())})():Sb++,"0x"+Sb.toString(16)}const CT="RestConnection",uq={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class hq{get $o(){return!1}constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const l=n.ssl?"https":"http",p=encodeURIComponent(this.databaseId.projectId),b=encodeURIComponent(this.databaseId.database);this.Uo=l+"://"+n.host,this.Ko=`projects/${p}/databases/${b}`,this.Wo=this.databaseId.database===e1?`project_id=${p}`:`project_id=${p}&database_id=${b}`}Go(n,l,p,b,I){const P=cE(),s=this.zo(n,l.toUriEncodedString());cn(CT,`Sending RPC '${n}' ${P}:`,s,p);const G={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(G,b,I);const{host:q}=new URL(s),ie=Km(q);return this.Jo(n,s,G,p,ie).then((ce=>(cn(CT,`Received RPC '${n}' ${P}: `,ce),ce)),(ce=>{throw Ny(CT,`RPC '${n}' ${P} failed with error: `,ce,"url: ",s,"request:",p),ce}))}Ho(n,l,p,b,I,P){return this.Go(n,l,p,b,I)}jo(n,l,p){n["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+ev})(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),l&&l.headers.forEach(((b,I)=>n[I]=b)),p&&p.headers.forEach(((b,I)=>n[I]=b))}zo(n,l){const p=uq[n];return`${this.Uo}/v1/${l}:${p}`}terminate(){}}class dq{constructor(n){this.Yo=n.Yo,this.Zo=n.Zo}Xo(n){this.e_=n}t_(n){this.n_=n}r_(n){this.i_=n}onMessage(n){this.s_=n}close(){this.Zo()}send(n){this.Yo(n)}o_(){this.e_()}__(){this.n_()}a_(n){this.i_(n)}u_(n){this.s_(n)}}const Ml="WebChannelConnection";class fq extends hq{constructor(n){super(n),this.c_=[],this.forceLongPolling=n.forceLongPolling,this.autoDetectLongPolling=n.autoDetectLongPolling,this.useFetchStreams=n.useFetchStreams,this.longPollingOptions=n.longPollingOptions}Jo(n,l,p,b,I){const P=cE();return new Promise(((s,G)=>{const q=new gO;q.setWithCredentials(!0),q.listenOnce(_O.COMPLETE,(()=>{try{switch(q.getLastErrorCode()){case Pb.NO_ERROR:const ce=q.getResponseJson();cn(Ml,`XHR for RPC '${n}' ${P} received:`,JSON.stringify(ce)),s(ce);break;case Pb.TIMEOUT:cn(Ml,`RPC '${n}' ${P} timed out`),G(new Ji(di.DEADLINE_EXCEEDED,"Request time out"));break;case Pb.HTTP_ERROR:const be=q.getStatus();if(cn(Ml,`RPC '${n}' ${P} failed with status:`,be,"response text:",q.getResponseText()),be>0){let He=q.getResponseJson();Array.isArray(He)&&(He=He[0]);const Je=He?.error;if(Je&&Je.status&&Je.message){const it=(function(Pt){const ct=Pt.toLowerCase().replace(/_/g,"-");return Object.values(di).indexOf(ct)>=0?ct:di.UNKNOWN})(Je.status);G(new Ji(it,Je.message))}else G(new Ji(di.UNKNOWN,"Server responded with status "+q.getStatus()))}else G(new Ji(di.UNAVAILABLE,"Connection failed."));break;default:ir(9055,{l_:n,streamId:P,h_:q.getLastErrorCode(),P_:q.getLastError()})}}finally{cn(Ml,`RPC '${n}' ${P} completed.`)}}));const ie=JSON.stringify(b);cn(Ml,`RPC '${n}' ${P} sending request:`,b),q.send(l,"POST",ie,p,15)}))}T_(n,l,p){const b=cE(),I=[this.Uo,"/","google.firestore.v1.Firestore","/",n,"/channel"],P=xO(),s=vO(),G={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},q=this.longPollingOptions.timeoutSeconds;q!==void 0&&(G.longPollingTimeout=Math.round(1e3*q)),this.useFetchStreams&&(G.useFetchStreams=!0),this.jo(G.initMessageHeaders,l,p),G.encodeInitMessageHeaders=!0;const ie=I.join("");cn(Ml,`Creating RPC '${n}' stream ${b}: ${ie}`,G);const ce=P.createWebChannel(ie,G);this.I_(ce);let be=!1,He=!1;const Je=new dq({Yo:Ze=>{He?cn(Ml,`Not sending because RPC '${n}' stream ${b} is closed:`,Ze):(be||(cn(Ml,`Opening RPC '${n}' stream ${b} transport.`),ce.open(),be=!0),cn(Ml,`RPC '${n}' stream ${b} sending:`,Ze),ce.send(Ze))},Zo:()=>ce.close()}),it=(Ze,Pt,ct)=>{Ze.listen(Pt,(Gt=>{try{ct(Gt)}catch(ei){setTimeout((()=>{throw ei}),0)}}))};return it(ce,_0.EventType.OPEN,(()=>{He||(cn(Ml,`RPC '${n}' stream ${b} transport opened.`),Je.o_())})),it(ce,_0.EventType.CLOSE,(()=>{He||(He=!0,cn(Ml,`RPC '${n}' stream ${b} transport closed`),Je.a_(),this.E_(ce))})),it(ce,_0.EventType.ERROR,(Ze=>{He||(He=!0,Ny(Ml,`RPC '${n}' stream ${b} transport errored. Name:`,Ze.name,"Message:",Ze.message),Je.a_(new Ji(di.UNAVAILABLE,"The operation could not be completed")))})),it(ce,_0.EventType.MESSAGE,(Ze=>{if(!He){const Pt=Ze.data[0];Rs(!!Pt,16349);const ct=Pt,Gt=ct?.error||ct[0]?.error;if(Gt){cn(Ml,`RPC '${n}' stream ${b} received error:`,Gt);const ei=Gt.status;let Fi=(function(Oe){const je=da[Oe];if(je!==void 0)return tL(je)})(ei),Si=Gt.message;Fi===void 0&&(Fi=di.INTERNAL,Si="Unknown error status: "+ei+" with message "+Gt.message),He=!0,Je.a_(new Ji(Fi,Si)),ce.close()}else cn(Ml,`RPC '${n}' stream ${b} received:`,Pt),Je.u_(Pt)}})),it(s,yO.STAT_EVENT,(Ze=>{Ze.stat===KT.PROXY?cn(Ml,`RPC '${n}' stream ${b} detected buffering proxy`):Ze.stat===KT.NOPROXY&&cn(Ml,`RPC '${n}' stream ${b} detected no buffering proxy`)})),setTimeout((()=>{Je.__()}),0),Je}terminate(){this.c_.forEach((n=>n.close())),this.c_=[]}I_(n){this.c_.push(n)}E_(n){this.c_=this.c_.filter((l=>l===n))}}function RT(){return typeof document<"u"?document:null}function z1(c){return new _9(c,!0)}class mL{constructor(n,l,p=1e3,b=1.5,I=6e4){this.Mi=n,this.timerId=l,this.d_=p,this.A_=b,this.R_=I,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(n){this.cancel();const l=Math.floor(this.V_+this.y_()),p=Math.max(0,Date.now()-this.f_),b=Math.max(0,l-p);b>0&&cn("ExponentialBackoff",`Backing off for ${b} ms (base delay: ${this.V_} ms, delay with jitter: ${l} ms, last attempt: ${p} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,b,(()=>(this.f_=Date.now(),n()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const NR="PersistentStream";class gL{constructor(n,l,p,b,I,P,s,G){this.Mi=n,this.S_=p,this.b_=b,this.connection=I,this.authCredentialsProvider=P,this.appCheckCredentialsProvider=s,this.listener=G,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new mL(n,l)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(n){this.Q_(),this.stream.send(n)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(n,l){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,n!==4?this.M_.reset():l&&l.code===di.RESOURCE_EXHAUSTED?(pp(l.toString()),pp("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):l&&l.code===di.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=n,await this.listener.r_(l)}K_(){}auth(){this.state=1;const n=this.W_(this.D_),l=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([p,b])=>{this.D_===l&&this.G_(p,b)}),(p=>{n((()=>{const b=new Ji(di.UNKNOWN,"Fetching auth token failed: "+p.message);return this.z_(b)}))}))}G_(n,l){const p=this.W_(this.D_);this.stream=this.j_(n,l),this.stream.Xo((()=>{p((()=>this.listener.Xo()))})),this.stream.t_((()=>{p((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((b=>{p((()=>this.z_(b)))})),this.stream.onMessage((b=>{p((()=>++this.F_==1?this.J_(b):this.onNext(b)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(n){return cn(NR,`close with error: ${n}`),this.stream=null,this.close(4,n)}W_(n){return l=>{this.Mi.enqueueAndForget((()=>this.D_===n?l():(cn(NR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class pq extends gL{constructor(n,l,p,b,I,P){super(n,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",l,p,b,P),this.serializer=I}j_(n,l){return this.connection.T_("Listen",n,l)}J_(n){return this.onNext(n)}onNext(n){this.M_.reset();const l=x9(this.serializer,n),p=(function(I){if(!("targetChange"in I))return fr.min();const P=I.targetChange;return P.targetIds&&P.targetIds.length?fr.min():P.readTime?tf(P.readTime):fr.min()})(n);return this.listener.H_(l,p)}Y_(n){const l={};l.database=aE(this.serializer),l.addTarget=(function(I,P){let s;const G=P.target;if(s=tE(G)?{documents:T9(I,G)}:{query:E9(I,G).ft},s.targetId=P.targetId,P.resumeToken.approximateByteSize()>0){s.resumeToken=rL(I,P.resumeToken);const q=rE(I,P.expectedCount);q!==null&&(s.expectedCount=q)}else if(P.snapshotVersion.compareTo(fr.min())>0){s.readTime=s1(I,P.snapshotVersion.toTimestamp());const q=rE(I,P.expectedCount);q!==null&&(s.expectedCount=q)}return s})(this.serializer,n);const p=A9(this.serializer,n);p&&(l.labels=p),this.q_(l)}Z_(n){const l={};l.database=aE(this.serializer),l.removeTarget=n,this.q_(l)}}class mq extends gL{constructor(n,l,p,b,I,P){super(n,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",l,p,b,P),this.serializer=I}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(n,l){return this.connection.T_("Write",n,l)}J_(n){return Rs(!!n.streamToken,31322),this.lastStreamToken=n.streamToken,Rs(!n.writeResults||n.writeResults.length===0,55816),this.listener.ta()}onNext(n){Rs(!!n.streamToken,12678),this.lastStreamToken=n.streamToken,this.M_.reset();const l=w9(n.writeResults,n.commitTime),p=tf(n.commitTime);return this.listener.na(p,l)}ra(){const n={};n.database=aE(this.serializer),this.q_(n)}ea(n){const l={streamToken:this.lastStreamToken,writes:n.map((p=>b9(this.serializer,p)))};this.q_(l)}}class gq{}class _q extends gq{constructor(n,l,p,b){super(),this.authCredentials=n,this.appCheckCredentials=l,this.connection=p,this.serializer=b,this.ia=!1}sa(){if(this.ia)throw new Ji(di.FAILED_PRECONDITION,"The client has already been terminated.")}Go(n,l,p,b){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([I,P])=>this.connection.Go(n,sE(l,p),b,I,P))).catch((I=>{throw I.name==="FirebaseError"?(I.code===di.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),I):new Ji(di.UNKNOWN,I.toString())}))}Ho(n,l,p,b,I){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([P,s])=>this.connection.Ho(n,sE(l,p),b,P,s,I))).catch((P=>{throw P.name==="FirebaseError"?(P.code===di.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),P):new Ji(di.UNKNOWN,P.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class yq{constructor(n,l){this.asyncQueue=n,this.onlineStateHandler=l,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(n){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${n.toString()}`),this.ca("Offline")))}set(n){this.Pa(),this.oa=0,n==="Online"&&(this.aa=!1),this.ca(n)}ca(n){n!==this.state&&(this.state=n,this.onlineStateHandler(n))}la(n){const l=`Could not reach Cloud Firestore backend. ${n}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(pp(l),this.aa=!1):cn("OnlineStateTracker",l)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const p_="RemoteStore";class vq{constructor(n,l,p,b,I){this.localStore=n,this.datastore=l,this.asyncQueue=p,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=I,this.Aa.Oo((P=>{p.enqueueAndForget((async()=>{x_(this)&&(cn(p_,"Restarting streams for network reachability change."),await(async function(G){const q=xr(G);q.Ea.add(4),await tx(q),q.Ra.set("Unknown"),q.Ea.delete(4),await k1(q)})(this))}))})),this.Ra=new yq(p,b)}}async function k1(c){if(x_(c))for(const n of c.da)await n(!0)}async function tx(c){for(const n of c.da)await n(!1)}function _L(c,n){const l=xr(c);l.Ia.has(n.targetId)||(l.Ia.set(n.targetId,n),PS(l)?DS(l):rv(l).O_()&&MS(l,n))}function RS(c,n){const l=xr(c),p=rv(l);l.Ia.delete(n),p.O_()&&yL(l,n),l.Ia.size===0&&(p.O_()?p.L_():x_(l)&&l.Ra.set("Unknown"))}function MS(c,n){if(c.Va.Ue(n.targetId),n.resumeToken.approximateByteSize()>0||n.snapshotVersion.compareTo(fr.min())>0){const l=c.remoteSyncer.getRemoteKeysForTarget(n.targetId).size;n=n.withExpectedCount(l)}rv(c).Y_(n)}function yL(c,n){c.Va.Ue(n),rv(c).Z_(n)}function DS(c){c.Va=new f9({getRemoteKeysForTarget:n=>c.remoteSyncer.getRemoteKeysForTarget(n),At:n=>c.Ia.get(n)||null,ht:()=>c.datastore.serializer.databaseId}),rv(c).start(),c.Ra.ua()}function PS(c){return x_(c)&&!rv(c).x_()&&c.Ia.size>0}function x_(c){return xr(c).Ea.size===0}function vL(c){c.Va=void 0}async function xq(c){c.Ra.set("Online")}async function bq(c){c.Ia.forEach(((n,l)=>{MS(c,n)}))}async function wq(c,n){vL(c),PS(c)?(c.Ra.ha(n),DS(c)):c.Ra.set("Unknown")}async function Tq(c,n,l){if(c.Ra.set("Online"),n instanceof nL&&n.state===2&&n.cause)try{await(async function(b,I){const P=I.cause;for(const s of I.targetIds)b.Ia.has(s)&&(await b.remoteSyncer.rejectListen(s,P),b.Ia.delete(s),b.Va.removeTarget(s))})(c,n)}catch(p){cn(p_,"Failed to remove targets %s: %s ",n.targetIds.join(","),p),await a1(c,p)}else if(n instanceof kb?c.Va.Ze(n):n instanceof iL?c.Va.st(n):c.Va.tt(n),!l.isEqual(fr.min()))try{const p=await pL(c.localStore);l.compareTo(p)>=0&&await(function(I,P){const s=I.Va.Tt(P);return s.targetChanges.forEach(((G,q)=>{if(G.resumeToken.approximateByteSize()>0){const ie=I.Ia.get(q);ie&&I.Ia.set(q,ie.withResumeToken(G.resumeToken,P))}})),s.targetMismatches.forEach(((G,q)=>{const ie=I.Ia.get(G);if(!ie)return;I.Ia.set(G,ie.withResumeToken(ll.EMPTY_BYTE_STRING,ie.snapshotVersion)),yL(I,G);const ce=new zm(ie.target,G,q,ie.sequenceNumber);MS(I,ce)})),I.remoteSyncer.applyRemoteEvent(s)})(c,l)}catch(p){cn(p_,"Failed to raise snapshot:",p),await a1(c,p)}}async function a1(c,n,l){if(!iv(n))throw n;c.Ea.add(1),await tx(c),c.Ra.set("Offline"),l||(l=()=>pL(c.localStore)),c.asyncQueue.enqueueRetryable((async()=>{cn(p_,"Retrying IndexedDB access"),await l(),c.Ea.delete(1),await k1(c)}))}function xL(c,n){return n().catch((l=>a1(c,l,n)))}async function F1(c){const n=xr(c),l=Wm(n);let p=n.Ta.length>0?n.Ta[n.Ta.length-1].batchId:pS;for(;Eq(n);)try{const b=await sq(n.localStore,p);if(b===null){n.Ta.length===0&&l.L_();break}p=b.batchId,Sq(n,b)}catch(b){await a1(n,b)}bL(n)&&wL(n)}function Eq(c){return x_(c)&&c.Ta.length<10}function Sq(c,n){c.Ta.push(n);const l=Wm(c);l.O_()&&l.X_&&l.ea(n.mutations)}function bL(c){return x_(c)&&!Wm(c).x_()&&c.Ta.length>0}function wL(c){Wm(c).start()}async function Aq(c){Wm(c).ra()}async function Iq(c){const n=Wm(c);for(const l of c.Ta)n.ea(l.mutations)}async function Cq(c,n,l){const p=c.Ta.shift(),b=wS.from(p,n,l);await xL(c,(()=>c.remoteSyncer.applySuccessfulWrite(b))),await F1(c)}async function Rq(c,n){n&&Wm(c).X_&&await(async function(p,b){if((function(P){return u9(P)&&P!==di.ABORTED})(b.code)){const I=p.Ta.shift();Wm(p).B_(),await xL(p,(()=>p.remoteSyncer.rejectFailedWrite(I.batchId,b))),await F1(p)}})(c,n),bL(c)&&wL(c)}async function VR(c,n){const l=xr(c);l.asyncQueue.verifyOperationInProgress(),cn(p_,"RemoteStore received new credentials");const p=x_(l);l.Ea.add(3),await tx(l),p&&l.Ra.set("Unknown"),await l.remoteSyncer.handleCredentialChange(n),l.Ea.delete(3),await k1(l)}async function Mq(c,n){const l=xr(c);n?(l.Ea.delete(2),await k1(l)):n||(l.Ea.add(2),await tx(l),l.Ra.set("Unknown"))}function rv(c){return c.ma||(c.ma=(function(l,p,b){const I=xr(l);return I.sa(),new pq(p,I.connection,I.authCredentials,I.appCheckCredentials,I.serializer,b)})(c.datastore,c.asyncQueue,{Xo:xq.bind(null,c),t_:bq.bind(null,c),r_:wq.bind(null,c),H_:Tq.bind(null,c)}),c.da.push((async n=>{n?(c.ma.B_(),PS(c)?DS(c):c.Ra.set("Unknown")):(await c.ma.stop(),vL(c))}))),c.ma}function Wm(c){return c.fa||(c.fa=(function(l,p,b){const I=xr(l);return I.sa(),new mq(p,I.connection,I.authCredentials,I.appCheckCredentials,I.serializer,b)})(c.datastore,c.asyncQueue,{Xo:()=>Promise.resolve(),t_:Aq.bind(null,c),r_:Rq.bind(null,c),ta:Iq.bind(null,c),na:Cq.bind(null,c)}),c.da.push((async n=>{n?(c.fa.B_(),await F1(c)):(await c.fa.stop(),c.Ta.length>0&&(cn(p_,`Stopping write stream with ${c.Ta.length} pending writes`),c.Ta=[]))}))),c.fa}class OS{constructor(n,l,p,b,I){this.asyncQueue=n,this.timerId=l,this.targetTimeMs=p,this.op=b,this.removalCallback=I,this.deferred=new lp,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((P=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(n,l,p,b,I){const P=Date.now()+p,s=new OS(n,l,P,b,I);return s.start(p),s}start(n){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),n)}skipDelay(){return this.handleDelayElapsed()}cancel(n){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Ji(di.CANCELLED,"Operation cancelled"+(n?": "+n:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((n=>this.deferred.resolve(n)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function LS(c,n){if(pp("AsyncQueue",`${n}: ${c}`),iv(c))return new Ji(di.UNAVAILABLE,`${n}: ${c}`);throw c}class zy{static emptySet(n){return new zy(n.comparator)}constructor(n){this.comparator=n?(l,p)=>n(l,p)||zn.comparator(l.key,p.key):(l,p)=>zn.comparator(l.key,p.key),this.keyedMap=y0(),this.sortedSet=new Io(this.comparator)}has(n){return this.keyedMap.get(n)!=null}get(n){return this.keyedMap.get(n)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(n){const l=this.keyedMap.get(n);return l?this.sortedSet.indexOf(l):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal(((l,p)=>(n(l),!1)))}add(n){const l=this.delete(n.key);return l.copy(l.keyedMap.insert(n.key,n),l.sortedSet.insert(n,null))}delete(n){const l=this.get(n);return l?this.copy(this.keyedMap.remove(n),this.sortedSet.remove(l)):this}isEqual(n){if(!(n instanceof zy)||this.size!==n.size)return!1;const l=this.sortedSet.getIterator(),p=n.sortedSet.getIterator();for(;l.hasNext();){const b=l.getNext().key,I=p.getNext().key;if(!b.isEqual(I))return!1}return!0}toString(){const n=[];return this.forEach((l=>{n.push(l.toString())})),n.length===0?"DocumentSet ()":`DocumentSet (
  `+n.join(`  
`)+`
)`}copy(n,l){const p=new zy;return p.comparator=this.comparator,p.keyedMap=n,p.sortedSet=l,p}}class UR{constructor(){this.ga=new Io(zn.comparator)}track(n){const l=n.doc.key,p=this.ga.get(l);p?n.type!==0&&p.type===3?this.ga=this.ga.insert(l,n):n.type===3&&p.type!==1?this.ga=this.ga.insert(l,{type:p.type,doc:n.doc}):n.type===2&&p.type===2?this.ga=this.ga.insert(l,{type:2,doc:n.doc}):n.type===2&&p.type===0?this.ga=this.ga.insert(l,{type:0,doc:n.doc}):n.type===1&&p.type===0?this.ga=this.ga.remove(l):n.type===1&&p.type===2?this.ga=this.ga.insert(l,{type:1,doc:p.doc}):n.type===0&&p.type===1?this.ga=this.ga.insert(l,{type:2,doc:n.doc}):ir(63341,{Rt:n,pa:p}):this.ga=this.ga.insert(l,n)}ya(){const n=[];return this.ga.inorderTraversal(((l,p)=>{n.push(p)})),n}}class $y{constructor(n,l,p,b,I,P,s,G,q){this.query=n,this.docs=l,this.oldDocs=p,this.docChanges=b,this.mutatedKeys=I,this.fromCache=P,this.syncStateChanged=s,this.excludesMetadataChanges=G,this.hasCachedResults=q}static fromInitialDocuments(n,l,p,b,I){const P=[];return l.forEach((s=>{P.push({type:0,doc:s})})),new $y(n,l,zy.emptySet(l),P,p,b,!0,!1,I)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(n){if(!(this.fromCache===n.fromCache&&this.hasCachedResults===n.hasCachedResults&&this.syncStateChanged===n.syncStateChanged&&this.mutatedKeys.isEqual(n.mutatedKeys)&&M1(this.query,n.query)&&this.docs.isEqual(n.docs)&&this.oldDocs.isEqual(n.oldDocs)))return!1;const l=this.docChanges,p=n.docChanges;if(l.length!==p.length)return!1;for(let b=0;b<l.length;b++)if(l[b].type!==p[b].type||!l[b].doc.isEqual(p[b].doc))return!1;return!0}}class Dq{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((n=>n.Da()))}}class Pq{constructor(){this.queries=jR(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(l,p){const b=xr(l),I=b.queries;b.queries=jR(),I.forEach(((P,s)=>{for(const G of s.Sa)G.onError(p)}))})(this,new Ji(di.ABORTED,"Firestore shutting down"))}}function jR(){return new v_((c=>jO(c)),M1)}async function TL(c,n){const l=xr(c);let p=3;const b=n.query;let I=l.queries.get(b);I?!I.ba()&&n.Da()&&(p=2):(I=new Dq,p=n.Da()?0:1);try{switch(p){case 0:I.wa=await l.onListen(b,!0);break;case 1:I.wa=await l.onListen(b,!1);break;case 2:await l.onFirstRemoteStoreListen(b)}}catch(P){const s=LS(P,`Initialization of query '${Ay(n.query)}' failed`);return void n.onError(s)}l.queries.set(b,I),I.Sa.push(n),n.va(l.onlineState),I.wa&&n.Fa(I.wa)&&zS(l)}async function EL(c,n){const l=xr(c),p=n.query;let b=3;const I=l.queries.get(p);if(I){const P=I.Sa.indexOf(n);P>=0&&(I.Sa.splice(P,1),I.Sa.length===0?b=n.Da()?0:1:!I.ba()&&n.Da()&&(b=2))}switch(b){case 0:return l.queries.delete(p),l.onUnlisten(p,!0);case 1:return l.queries.delete(p),l.onUnlisten(p,!1);case 2:return l.onLastRemoteStoreUnlisten(p);default:return}}function Oq(c,n){const l=xr(c);let p=!1;for(const b of n){const I=b.query,P=l.queries.get(I);if(P){for(const s of P.Sa)s.Fa(b)&&(p=!0);P.wa=b}}p&&zS(l)}function Lq(c,n,l){const p=xr(c),b=p.queries.get(n);if(b)for(const I of b.Sa)I.onError(l);p.queries.delete(n)}function zS(c){c.Ca.forEach((n=>{n.next()}))}var uE,GR;(GR=uE||(uE={})).Ma="default",GR.Cache="cache";class SL{constructor(n,l,p){this.query=n,this.xa=l,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=p||{}}Fa(n){if(!this.options.includeMetadataChanges){const p=[];for(const b of n.docChanges)b.type!==3&&p.push(b);n=new $y(n.query,n.docs,n.oldDocs,p,n.mutatedKeys,n.fromCache,n.syncStateChanged,!0,n.hasCachedResults)}let l=!1;return this.Oa?this.Ba(n)&&(this.xa.next(n),l=!0):this.La(n,this.onlineState)&&(this.ka(n),l=!0),this.Na=n,l}onError(n){this.xa.error(n)}va(n){this.onlineState=n;let l=!1;return this.Na&&!this.Oa&&this.La(this.Na,n)&&(this.ka(this.Na),l=!0),l}La(n,l){if(!n.fromCache||!this.Da())return!0;const p=l!=="Offline";return(!this.options.qa||!p)&&(!n.docs.isEmpty()||n.hasCachedResults||l==="Offline")}Ba(n){if(n.docChanges.length>0)return!0;const l=this.Na&&this.Na.hasPendingWrites!==n.hasPendingWrites;return!(!n.syncStateChanged&&!l)&&this.options.includeMetadataChanges===!0}ka(n){n=$y.fromInitialDocuments(n.query,n.docs,n.mutatedKeys,n.fromCache,n.hasCachedResults),this.Oa=!0,this.xa.next(n)}Da(){return this.options.source!==uE.Cache}}class AL{constructor(n){this.key=n}}class IL{constructor(n){this.key=n}}class zq{constructor(n,l){this.query=n,this.Ya=l,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ns(),this.mutatedKeys=ns(),this.eu=GO(n),this.tu=new zy(this.eu)}get nu(){return this.Ya}ru(n,l){const p=l?l.iu:new UR,b=l?l.tu:this.tu;let I=l?l.mutatedKeys:this.mutatedKeys,P=b,s=!1;const G=this.query.limitType==="F"&&b.size===this.query.limit?b.last():null,q=this.query.limitType==="L"&&b.size===this.query.limit?b.first():null;if(n.inorderTraversal(((ie,ce)=>{const be=b.get(ie),He=D1(this.query,ce)?ce:null,Je=!!be&&this.mutatedKeys.has(be.key),it=!!He&&(He.hasLocalMutations||this.mutatedKeys.has(He.key)&&He.hasCommittedMutations);let Ze=!1;be&&He?be.data.isEqual(He.data)?Je!==it&&(p.track({type:3,doc:He}),Ze=!0):this.su(be,He)||(p.track({type:2,doc:He}),Ze=!0,(G&&this.eu(He,G)>0||q&&this.eu(He,q)<0)&&(s=!0)):!be&&He?(p.track({type:0,doc:He}),Ze=!0):be&&!He&&(p.track({type:1,doc:be}),Ze=!0,(G||q)&&(s=!0)),Ze&&(He?(P=P.add(He),I=it?I.add(ie):I.delete(ie)):(P=P.delete(ie),I=I.delete(ie)))})),this.query.limit!==null)for(;P.size>this.query.limit;){const ie=this.query.limitType==="F"?P.last():P.first();P=P.delete(ie.key),I=I.delete(ie.key),p.track({type:1,doc:ie})}return{tu:P,iu:p,Cs:s,mutatedKeys:I}}su(n,l){return n.hasLocalMutations&&l.hasCommittedMutations&&!l.hasLocalMutations}applyChanges(n,l,p,b){const I=this.tu;this.tu=n.tu,this.mutatedKeys=n.mutatedKeys;const P=n.iu.ya();P.sort(((ie,ce)=>(function(He,Je){const it=Ze=>{switch(Ze){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ir(20277,{Rt:Ze})}};return it(He)-it(Je)})(ie.type,ce.type)||this.eu(ie.doc,ce.doc))),this.ou(p),b=b??!1;const s=l&&!b?this._u():[],G=this.Xa.size===0&&this.current&&!b?1:0,q=G!==this.Za;return this.Za=G,P.length!==0||q?{snapshot:new $y(this.query,n.tu,I,P,n.mutatedKeys,G===0,q,!1,!!p&&p.resumeToken.approximateByteSize()>0),au:s}:{au:s}}va(n){return this.current&&n==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new UR,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(n){return!this.Ya.has(n)&&!!this.tu.has(n)&&!this.tu.get(n).hasLocalMutations}ou(n){n&&(n.addedDocuments.forEach((l=>this.Ya=this.Ya.add(l))),n.modifiedDocuments.forEach((l=>{})),n.removedDocuments.forEach((l=>this.Ya=this.Ya.delete(l))),this.current=n.current)}_u(){if(!this.current)return[];const n=this.Xa;this.Xa=ns(),this.tu.forEach((p=>{this.uu(p.key)&&(this.Xa=this.Xa.add(p.key))}));const l=[];return n.forEach((p=>{this.Xa.has(p)||l.push(new IL(p))})),this.Xa.forEach((p=>{n.has(p)||l.push(new AL(p))})),l}cu(n){this.Ya=n.Qs,this.Xa=ns();const l=this.ru(n.documents);return this.applyChanges(l,!0)}lu(){return $y.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const kS="SyncEngine";class kq{constructor(n,l,p){this.query=n,this.targetId=l,this.view=p}}class Fq{constructor(n){this.key=n,this.hu=!1}}class Bq{constructor(n,l,p,b,I,P){this.localStore=n,this.remoteStore=l,this.eventManager=p,this.sharedClientState=b,this.currentUser=I,this.maxConcurrentLimboResolutions=P,this.Pu={},this.Tu=new v_((s=>jO(s)),M1),this.Iu=new Map,this.Eu=new Set,this.du=new Io(zn.comparator),this.Au=new Map,this.Ru=new SS,this.Vu={},this.mu=new Map,this.fu=Hy.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Nq(c,n,l=!0){const p=OL(c);let b;const I=p.Tu.get(n);return I?(p.sharedClientState.addLocalQueryTarget(I.targetId),b=I.view.lu()):b=await CL(p,n,l,!0),b}async function Vq(c,n){const l=OL(c);await CL(l,n,!0,!1)}async function CL(c,n,l,p){const b=await oq(c.localStore,ef(n)),I=b.targetId,P=c.sharedClientState.addLocalQueryTarget(I,l);let s;return p&&(s=await Uq(c,n,I,P==="current",b.resumeToken)),c.isPrimaryClient&&l&&_L(c.remoteStore,b),s}async function Uq(c,n,l,p,b){c.pu=(ce,be,He)=>(async function(it,Ze,Pt,ct){let Gt=Ze.view.ru(Pt);Gt.Cs&&(Gt=await zR(it.localStore,Ze.query,!1).then((({documents:qe})=>Ze.view.ru(qe,Gt))));const ei=ct&&ct.targetChanges.get(Ze.targetId),Fi=ct&&ct.targetMismatches.get(Ze.targetId)!=null,Si=Ze.view.applyChanges(Gt,it.isPrimaryClient,ei,Fi);return HR(it,Ze.targetId,Si.au),Si.snapshot})(c,ce,be,He);const I=await zR(c.localStore,n,!0),P=new zq(n,I.Qs),s=P.ru(I.documents),G=ex.createSynthesizedTargetChangeForCurrentChange(l,p&&c.onlineState!=="Offline",b),q=P.applyChanges(s,c.isPrimaryClient,G);HR(c,l,q.au);const ie=new kq(n,l,P);return c.Tu.set(n,ie),c.Iu.has(l)?c.Iu.get(l).push(n):c.Iu.set(l,[n]),q.snapshot}async function jq(c,n,l){const p=xr(c),b=p.Tu.get(n),I=p.Iu.get(b.targetId);if(I.length>1)return p.Iu.set(b.targetId,I.filter((P=>!M1(P,n)))),void p.Tu.delete(n);p.isPrimaryClient?(p.sharedClientState.removeLocalQueryTarget(b.targetId),p.sharedClientState.isActiveQueryTarget(b.targetId)||await lE(p.localStore,b.targetId,!1).then((()=>{p.sharedClientState.clearQueryState(b.targetId),l&&RS(p.remoteStore,b.targetId),hE(p,b.targetId)})).catch(tv)):(hE(p,b.targetId),await lE(p.localStore,b.targetId,!0))}async function Gq(c,n){const l=xr(c),p=l.Tu.get(n),b=l.Iu.get(p.targetId);l.isPrimaryClient&&b.length===1&&(l.sharedClientState.removeLocalQueryTarget(p.targetId),RS(l.remoteStore,p.targetId))}async function qq(c,n,l){const p=Yq(c);try{const b=await(function(P,s){const G=xr(P),q=lo.now(),ie=s.reduce(((He,Je)=>He.add(Je.key)),ns());let ce,be;return G.persistence.runTransaction("Locally write mutations","readwrite",(He=>{let Je=mp(),it=ns();return G.Ns.getEntries(He,ie).next((Ze=>{Je=Ze,Je.forEach(((Pt,ct)=>{ct.isValidDocument()||(it=it.add(Pt))}))})).next((()=>G.localDocuments.getOverlayedDocuments(He,Je))).next((Ze=>{ce=Ze;const Pt=[];for(const ct of s){const Gt=s9(ct,ce.get(ct.key).overlayedDocument);Gt!=null&&Pt.push(new Jm(ct.key,Gt,LO(Gt.value.mapValue),Ju.exists(!0)))}return G.mutationQueue.addMutationBatch(He,q,Pt,s)})).next((Ze=>{be=Ze;const Pt=Ze.applyToLocalDocumentSet(ce,it);return G.documentOverlayCache.saveOverlays(He,Ze.batchId,Pt)}))})).then((()=>({batchId:be.batchId,changes:HO(ce)})))})(p.localStore,n);p.sharedClientState.addPendingMutation(b.batchId),(function(P,s,G){let q=P.Vu[P.currentUser.toKey()];q||(q=new Io(is)),q=q.insert(s,G),P.Vu[P.currentUser.toKey()]=q})(p,b.batchId,l),await ix(p,b.changes),await F1(p.remoteStore)}catch(b){const I=LS(b,"Failed to persist write");l.reject(I)}}async function RL(c,n){const l=xr(c);try{const p=await nq(l.localStore,n);n.targetChanges.forEach(((b,I)=>{const P=l.Au.get(I);P&&(Rs(b.addedDocuments.size+b.modifiedDocuments.size+b.removedDocuments.size<=1,22616),b.addedDocuments.size>0?P.hu=!0:b.modifiedDocuments.size>0?Rs(P.hu,14607):b.removedDocuments.size>0&&(Rs(P.hu,42227),P.hu=!1))})),await ix(l,p,n)}catch(p){await tv(p)}}function qR(c,n,l){const p=xr(c);if(p.isPrimaryClient&&l===0||!p.isPrimaryClient&&l===1){const b=[];p.Tu.forEach(((I,P)=>{const s=P.view.va(n);s.snapshot&&b.push(s.snapshot)})),(function(P,s){const G=xr(P);G.onlineState=s;let q=!1;G.queries.forEach(((ie,ce)=>{for(const be of ce.Sa)be.va(s)&&(q=!0)})),q&&zS(G)})(p.eventManager,n),b.length&&p.Pu.H_(b),p.onlineState=n,p.isPrimaryClient&&p.sharedClientState.setOnlineState(n)}}async function Hq(c,n,l){const p=xr(c);p.sharedClientState.updateQueryState(n,"rejected",l);const b=p.Au.get(n),I=b&&b.key;if(I){let P=new Io(zn.comparator);P=P.insert(I,Ol.newNoDocument(I,fr.min()));const s=ns().add(I),G=new L1(fr.min(),new Map,new Io(is),P,s);await RL(p,G),p.du=p.du.remove(I),p.Au.delete(n),FS(p)}else await lE(p.localStore,n,!1).then((()=>hE(p,n,l))).catch(tv)}async function $q(c,n){const l=xr(c),p=n.batch.batchId;try{const b=await iq(l.localStore,n);DL(l,p,null),ML(l,p),l.sharedClientState.updateMutationState(p,"acknowledged"),await ix(l,b)}catch(b){await tv(b)}}async function Wq(c,n,l){const p=xr(c);try{const b=await(function(P,s){const G=xr(P);return G.persistence.runTransaction("Reject batch","readwrite-primary",(q=>{let ie;return G.mutationQueue.lookupMutationBatch(q,s).next((ce=>(Rs(ce!==null,37113),ie=ce.keys(),G.mutationQueue.removeMutationBatch(q,ce)))).next((()=>G.mutationQueue.performConsistencyCheck(q))).next((()=>G.documentOverlayCache.removeOverlaysForBatchId(q,ie,s))).next((()=>G.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(q,ie))).next((()=>G.localDocuments.getDocuments(q,ie)))}))})(p.localStore,n);DL(p,n,l),ML(p,n),p.sharedClientState.updateMutationState(n,"rejected",l),await ix(p,b)}catch(b){await tv(b)}}function ML(c,n){(c.mu.get(n)||[]).forEach((l=>{l.resolve()})),c.mu.delete(n)}function DL(c,n,l){const p=xr(c);let b=p.Vu[p.currentUser.toKey()];if(b){const I=b.get(n);I&&(l?I.reject(l):I.resolve(),b=b.remove(n)),p.Vu[p.currentUser.toKey()]=b}}function hE(c,n,l=null){c.sharedClientState.removeLocalQueryTarget(n);for(const p of c.Iu.get(n))c.Tu.delete(p),l&&c.Pu.yu(p,l);c.Iu.delete(n),c.isPrimaryClient&&c.Ru.jr(n).forEach((p=>{c.Ru.containsKey(p)||PL(c,p)}))}function PL(c,n){c.Eu.delete(n.path.canonicalString());const l=c.du.get(n);l!==null&&(RS(c.remoteStore,l),c.du=c.du.remove(n),c.Au.delete(l),FS(c))}function HR(c,n,l){for(const p of l)p instanceof AL?(c.Ru.addReference(p.key,n),Zq(c,p)):p instanceof IL?(cn(kS,"Document no longer in limbo: "+p.key),c.Ru.removeReference(p.key,n),c.Ru.containsKey(p.key)||PL(c,p.key)):ir(19791,{wu:p})}function Zq(c,n){const l=n.key,p=l.path.canonicalString();c.du.get(l)||c.Eu.has(p)||(cn(kS,"New document in limbo: "+l),c.Eu.add(p),FS(c))}function FS(c){for(;c.Eu.size>0&&c.du.size<c.maxConcurrentLimboResolutions;){const n=c.Eu.values().next().value;c.Eu.delete(n);const l=new zn(Xs.fromString(n)),p=c.fu.next();c.Au.set(p,new Fq(l)),c.du=c.du.insert(l,p),_L(c.remoteStore,new zm(ef(vS(l.path)),p,"TargetPurposeLimboResolution",I1.ce))}}async function ix(c,n,l){const p=xr(c),b=[],I=[],P=[];p.Tu.isEmpty()||(p.Tu.forEach(((s,G)=>{P.push(p.pu(G,n,l).then((q=>{if((q||l)&&p.isPrimaryClient){const ie=q?!q.fromCache:l?.targetChanges.get(G.targetId)?.current;p.sharedClientState.updateQueryState(G.targetId,ie?"current":"not-current")}if(q){b.push(q);const ie=IS.As(G.targetId,q);I.push(ie)}})))})),await Promise.all(P),p.Pu.H_(b),await(async function(G,q){const ie=xr(G);try{await ie.persistence.runTransaction("notifyLocalViewChanges","readwrite",(ce=>yi.forEach(q,(be=>yi.forEach(be.Es,(He=>ie.persistence.referenceDelegate.addReference(ce,be.targetId,He))).next((()=>yi.forEach(be.ds,(He=>ie.persistence.referenceDelegate.removeReference(ce,be.targetId,He)))))))))}catch(ce){if(!iv(ce))throw ce;cn(CS,"Failed to update sequence numbers: "+ce)}for(const ce of q){const be=ce.targetId;if(!ce.fromCache){const He=ie.Ms.get(be),Je=He.snapshotVersion,it=He.withLastLimboFreeSnapshotVersion(Je);ie.Ms=ie.Ms.insert(be,it)}}})(p.localStore,I))}async function Xq(c,n){const l=xr(c);if(!l.currentUser.isEqual(n)){cn(kS,"User change. New user:",n.toKey());const p=await fL(l.localStore,n);l.currentUser=n,(function(I,P){I.mu.forEach((s=>{s.forEach((G=>{G.reject(new Ji(di.CANCELLED,P))}))})),I.mu.clear()})(l,"'waitForPendingWrites' promise is rejected due to a user change."),l.sharedClientState.handleUserChange(n,p.removedBatchIds,p.addedBatchIds),await ix(l,p.Ls)}}function Kq(c,n){const l=xr(c),p=l.Au.get(n);if(p&&p.hu)return ns().add(p.key);{let b=ns();const I=l.Iu.get(n);if(!I)return b;for(const P of I){const s=l.Tu.get(P);b=b.unionWith(s.view.nu)}return b}}function OL(c){const n=xr(c);return n.remoteStore.remoteSyncer.applyRemoteEvent=RL.bind(null,n),n.remoteStore.remoteSyncer.getRemoteKeysForTarget=Kq.bind(null,n),n.remoteStore.remoteSyncer.rejectListen=Hq.bind(null,n),n.Pu.H_=Oq.bind(null,n.eventManager),n.Pu.yu=Lq.bind(null,n.eventManager),n}function Yq(c){const n=xr(c);return n.remoteStore.remoteSyncer.applySuccessfulWrite=$q.bind(null,n),n.remoteStore.remoteSyncer.rejectFailedWrite=Wq.bind(null,n),n}class l1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(n){this.serializer=z1(n.databaseInfo.databaseId),this.sharedClientState=this.Du(n),this.persistence=this.Cu(n),await this.persistence.start(),this.localStore=this.vu(n),this.gcScheduler=this.Fu(n,this.localStore),this.indexBackfillerScheduler=this.Mu(n,this.localStore)}Fu(n,l){return null}Mu(n,l){return null}vu(n){return tq(this.persistence,new Q9,n.initialUser,this.serializer)}Cu(n){return new dL(AS.mi,this.serializer)}Du(n){return new lq}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}l1.provider={build:()=>new l1};class Qq extends l1{constructor(n){super(),this.cacheSizeBytes=n}Fu(n,l){Rs(this.persistence.referenceDelegate instanceof o1,46915);const p=this.persistence.referenceDelegate.garbageCollector;return new F9(p,n.asyncQueue,l)}Cu(n){const l=this.cacheSizeBytes!==void 0?kc.withCacheSize(this.cacheSizeBytes):kc.DEFAULT;return new dL((p=>o1.mi(p,l)),this.serializer)}}class dE{async initialize(n,l){this.localStore||(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(l),this.remoteStore=this.createRemoteStore(l),this.eventManager=this.createEventManager(l),this.syncEngine=this.createSyncEngine(l,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=p=>qR(this.syncEngine,p,1),this.remoteStore.remoteSyncer.handleCredentialChange=Xq.bind(null,this.syncEngine),await Mq(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(n){return(function(){return new Pq})()}createDatastore(n){const l=z1(n.databaseInfo.databaseId),p=(function(I){return new fq(I)})(n.databaseInfo);return(function(I,P,s,G){return new _q(I,P,s,G)})(n.authCredentials,n.appCheckCredentials,p,l)}createRemoteStore(n){return(function(p,b,I,P,s){return new vq(p,b,I,P,s)})(this.localStore,this.datastore,n.asyncQueue,(l=>qR(this.syncEngine,l,0)),(function(){return BR.v()?new BR:new cq})())}createSyncEngine(n,l){return(function(b,I,P,s,G,q,ie){const ce=new Bq(b,I,P,s,G,q);return ie&&(ce.gu=!0),ce})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,n.initialUser,n.maxConcurrentLimboResolutions,l)}async terminate(){await(async function(l){const p=xr(l);cn(p_,"RemoteStore shutting down."),p.Ea.add(5),await tx(p),p.Aa.shutdown(),p.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}dE.provider={build:()=>new dE};class LL{constructor(n){this.observer=n,this.muted=!1}next(n){this.muted||this.observer.next&&this.Ou(this.observer.next,n)}error(n){this.muted||(this.observer.error?this.Ou(this.observer.error,n):pp("Uncaught Error in snapshot listener:",n.toString()))}Nu(){this.muted=!0}Ou(n,l){setTimeout((()=>{this.muted||n(l)}),0)}}const Zm="FirestoreClient";class Jq{constructor(n,l,p,b,I){this.authCredentials=n,this.appCheckCredentials=l,this.asyncQueue=p,this.databaseInfo=b,this.user=Dl.UNAUTHENTICATED,this.clientId=fS.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=I,this.authCredentials.start(p,(async P=>{cn(Zm,"Received user=",P.uid),await this.authCredentialListener(P),this.user=P})),this.appCheckCredentials.start(p,(P=>(cn(Zm,"Received new app check token=",P),this.appCheckCredentialListener(P,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(n){this.authCredentialListener=n}setAppCheckTokenChangeListener(n){this.appCheckCredentialListener=n}terminate(){this.asyncQueue.enterRestrictedMode();const n=new lp;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(l){const p=LS(l,"Failed to shutdown persistence");n.reject(p)}})),n.promise}}async function MT(c,n){c.asyncQueue.verifyOperationInProgress(),cn(Zm,"Initializing OfflineComponentProvider");const l=c.configuration;await n.initialize(l);let p=l.initialUser;c.setCredentialChangeListener((async b=>{p.isEqual(b)||(await fL(n.localStore,b),p=b)})),n.persistence.setDatabaseDeletedListener((()=>c.terminate())),c._offlineComponents=n}async function $R(c,n){c.asyncQueue.verifyOperationInProgress();const l=await eH(c);cn(Zm,"Initializing OnlineComponentProvider"),await n.initialize(l,c.configuration),c.setCredentialChangeListener((p=>VR(n.remoteStore,p))),c.setAppCheckTokenChangeListener(((p,b)=>VR(n.remoteStore,b))),c._onlineComponents=n}async function eH(c){if(!c._offlineComponents)if(c._uninitializedComponentsProvider){cn(Zm,"Using user provided OfflineComponentProvider");try{await MT(c,c._uninitializedComponentsProvider._offline)}catch(n){const l=n;if(!(function(b){return b.name==="FirebaseError"?b.code===di.FAILED_PRECONDITION||b.code===di.UNIMPLEMENTED:!(typeof DOMException<"u"&&b instanceof DOMException)||b.code===22||b.code===20||b.code===11})(l))throw l;Ny("Error using user provided cache. Falling back to memory cache: "+l),await MT(c,new l1)}}else cn(Zm,"Using default OfflineComponentProvider"),await MT(c,new Qq(void 0));return c._offlineComponents}async function zL(c){return c._onlineComponents||(c._uninitializedComponentsProvider?(cn(Zm,"Using user provided OnlineComponentProvider"),await $R(c,c._uninitializedComponentsProvider._online)):(cn(Zm,"Using default OnlineComponentProvider"),await $R(c,new dE))),c._onlineComponents}function tH(c){return zL(c).then((n=>n.syncEngine))}async function kL(c){const n=await zL(c),l=n.eventManager;return l.onListen=Nq.bind(null,n.syncEngine),l.onUnlisten=jq.bind(null,n.syncEngine),l.onFirstRemoteStoreListen=Vq.bind(null,n.syncEngine),l.onLastRemoteStoreUnlisten=Gq.bind(null,n.syncEngine),l}function iH(c,n,l={}){const p=new lp;return c.asyncQueue.enqueueAndForget((async()=>(function(I,P,s,G,q){const ie=new LL({next:be=>{ie.Nu(),P.enqueueAndForget((()=>EL(I,ce)));const He=be.docs.has(s);!He&&be.fromCache?q.reject(new Ji(di.UNAVAILABLE,"Failed to get document because the client is offline.")):He&&be.fromCache&&G&&G.source==="server"?q.reject(new Ji(di.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):q.resolve(be)},error:be=>q.reject(be)}),ce=new SL(vS(s.path),ie,{includeMetadataChanges:!0,qa:!0});return TL(I,ce)})(await kL(c),c.asyncQueue,n,l,p))),p.promise}function nH(c,n,l={}){const p=new lp;return c.asyncQueue.enqueueAndForget((async()=>(function(I,P,s,G,q){const ie=new LL({next:be=>{ie.Nu(),P.enqueueAndForget((()=>EL(I,ce))),be.fromCache&&G.source==="server"?q.reject(new Ji(di.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):q.resolve(be)},error:be=>q.reject(be)}),ce=new SL(s,ie,{includeMetadataChanges:!0,qa:!0});return TL(I,ce)})(await kL(c),c.asyncQueue,n,l,p))),p.promise}function FL(c){const n={};return c.timeoutSeconds!==void 0&&(n.timeoutSeconds=c.timeoutSeconds),n}const WR=new Map;const BL="firestore.googleapis.com",ZR=!0;class XR{constructor(n){if(n.host===void 0){if(n.ssl!==void 0)throw new Ji(di.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=BL,this.ssl=ZR}else this.host=n.host,this.ssl=n.ssl??ZR;if(this.isUsingEmulator=n.emulatorOptions!==void 0,this.credentials=n.credentials,this.ignoreUndefinedProperties=!!n.ignoreUndefinedProperties,this.localCache=n.localCache,n.cacheSizeBytes===void 0)this.cacheSizeBytes=hL;else{if(n.cacheSizeBytes!==-1&&n.cacheSizeBytes<z9)throw new Ji(di.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=n.cacheSizeBytes}vG("experimentalForceLongPolling",n.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",n.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!n.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:n.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!n.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=FL(n.experimentalLongPollingOptions??{}),(function(p){if(p.timeoutSeconds!==void 0){if(isNaN(p.timeoutSeconds))throw new Ji(di.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (must not be NaN)`);if(p.timeoutSeconds<5)throw new Ji(di.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (minimum allowed value is 5)`);if(p.timeoutSeconds>30)throw new Ji(di.INVALID_ARGUMENT,`invalid long polling timeout: ${p.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!n.useFetchStreams}isEqual(n){return this.host===n.host&&this.ssl===n.ssl&&this.credentials===n.credentials&&this.cacheSizeBytes===n.cacheSizeBytes&&this.experimentalForceLongPolling===n.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===n.experimentalAutoDetectLongPolling&&(function(p,b){return p.timeoutSeconds===b.timeoutSeconds})(this.experimentalLongPollingOptions,n.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===n.ignoreUndefinedProperties&&this.useFetchStreams===n.useFetchStreams}}class B1{constructor(n,l,p,b){this._authCredentials=n,this._appCheckCredentials=l,this._databaseId=p,this._app=b,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new XR({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Ji(di.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(n){if(this._settingsFrozen)throw new Ji(di.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new XR(n),this._emulatorOptions=n.emulatorOptions||{},n.credentials!==void 0&&(this._authCredentials=(function(p){if(!p)return new cG;switch(p.type){case"firstParty":return new fG(p.sessionIndex||"0",p.iamToken||null,p.authTokenFactory||null);case"provider":return p.client;default:throw new Ji(di.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(n.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(l){const p=WR.get(l);p&&(cn("ComponentProvider","Removing Datastore"),WR.delete(l),p.terminate())})(this),Promise.resolve()}}function rH(c,n,l,p={}){c=sd(c,B1);const b=Km(n),I=c._getSettings(),P={...I,emulatorOptions:c._getEmulatorOptions()},s=`${n}:${l}`;b&&(GE(`https://${s}`),qE("Firestore",!0)),I.host!==BL&&I.host!==s&&Ny("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const G={...I,host:s,ssl:b,emulatorOptions:p};if(!hp(G,P)&&(c._setSettings(G),p.mockUserToken)){let q,ie;if(typeof p.mockUserToken=="string")q=p.mockUserToken,ie=Dl.MOCK_USER;else{q=BD(p.mockUserToken,c._app?.options.projectId);const ce=p.mockUserToken.sub||p.mockUserToken.user_id;if(!ce)throw new Ji(di.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");ie=new Dl(ce)}c._authCredentials=new uG(new wO(q,ie))}}class b_{constructor(n,l,p){this.converter=l,this._query=p,this.type="query",this.firestore=n}withConverter(n){return new b_(this.firestore,n,this._query)}}class Ko{constructor(n,l,p){this.converter=l,this._key=p,this.type="document",this.firestore=n}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nm(this.firestore,this.converter,this._key.path.popLast())}withConverter(n){return new Ko(this.firestore,n,this._key)}toJSON(){return{type:Ko._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(n,l,p){if(Q0(l,Ko._jsonSchema))return new Ko(n,p||null,new zn(Xs.fromString(l.referencePath)))}}Ko._jsonSchemaVersion="firestore/documentReference/1.0",Ko._jsonSchema={type:pa("string",Ko._jsonSchemaVersion),referencePath:pa("string")};class Nm extends b_{constructor(n,l,p){super(n,l,vS(p)),this._path=p,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const n=this._path.popLast();return n.isEmpty()?null:new Ko(this.firestore,null,new zn(n))}withConverter(n){return new Nm(this.firestore,n,this._path)}}function B0(c,n,...l){if(c=xo(c),TO("collection","path",n),c instanceof B1){const p=Xs.fromString(n,...l);return lR(p),new Nm(c,null,p)}{if(!(c instanceof Ko||c instanceof Nm))throw new Ji(di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const p=c._path.child(Xs.fromString(n,...l));return lR(p),new Nm(c.firestore,null,p)}}function Yu(c,n,...l){if(c=xo(c),arguments.length===1&&(n=fS.newId()),TO("doc","path",n),c instanceof B1){const p=Xs.fromString(n,...l);return aR(p),new Ko(c,null,new zn(p))}{if(!(c instanceof Ko||c instanceof Nm))throw new Ji(di.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const p=c._path.child(Xs.fromString(n,...l));return aR(p),new Ko(c.firestore,c instanceof Nm?c.converter:null,new zn(p))}}const KR="AsyncQueue";class YR{constructor(n=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new mL(this,"async_queue_retry"),this._c=()=>{const p=RT();p&&cn(KR,"Visibility state changed to "+p.visibilityState),this.M_.w_()},this.ac=n;const l=RT();l&&typeof l.addEventListener=="function"&&l.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(n){this.enqueue(n)}enqueueAndForgetEvenWhileRestricted(n){this.uc(),this.cc(n)}enterRestrictedMode(n){if(!this.ec){this.ec=!0,this.sc=n||!1;const l=RT();l&&typeof l.removeEventListener=="function"&&l.removeEventListener("visibilitychange",this._c)}}enqueue(n){if(this.uc(),this.ec)return new Promise((()=>{}));const l=new lp;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(n().then(l.resolve,l.reject),l.promise))).then((()=>l.promise))}enqueueRetryable(n){this.enqueueAndForget((()=>(this.Xu.push(n),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(n){if(!iv(n))throw n;cn(KR,"Operation failed with retryable error: "+n)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(n){const l=this.ac.then((()=>(this.rc=!0,n().catch((p=>{throw this.nc=p,this.rc=!1,pp("INTERNAL UNHANDLED ERROR: ",QR(p)),p})).then((p=>(this.rc=!1,p))))));return this.ac=l,l}enqueueAfterDelay(n,l,p){this.uc(),this.oc.indexOf(n)>-1&&(l=0);const b=OS.createAndSchedule(this,n,l,p,(I=>this.hc(I)));return this.tc.push(b),b}uc(){this.nc&&ir(47125,{Pc:QR(this.nc)})}verifyOperationInProgress(){}async Tc(){let n;do n=this.ac,await n;while(n!==this.ac)}Ic(n){for(const l of this.tc)if(l.timerId===n)return!0;return!1}Ec(n){return this.Tc().then((()=>{this.tc.sort(((l,p)=>l.targetTimeMs-p.targetTimeMs));for(const l of this.tc)if(l.skipDelay(),n!=="all"&&l.timerId===n)break;return this.Tc()}))}dc(n){this.oc.push(n)}hc(n){const l=this.tc.indexOf(n);this.tc.splice(l,1)}}function QR(c){let n=c.message||"";return c.stack&&(n=c.stack.includes(c.message)?c.stack:c.message+`
`+c.stack),n}class w_ extends B1{constructor(n,l,p,b){super(n,l,p,b),this.type="firestore",this._queue=new YR,this._persistenceKey=b?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const n=this._firestoreClient.terminate();this._queue=new YR(n),this._firestoreClient=void 0,await n}}}function sH(c,n){const l=typeof c=="object"?c:$E(),p=typeof c=="string"?c:e1,b=Qy(l,"firestore").getImmediate({identifier:p});if(!b._initialized){const I=zD("firestore");I&&rH(b,...I)}return b}function BS(c){if(c._terminated)throw new Ji(di.FAILED_PRECONDITION,"The client has already been terminated.");return c._firestoreClient||oH(c),c._firestoreClient}function oH(c){const n=c._freezeSettings(),l=(function(b,I,P,s){return new MG(b,I,P,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,FL(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator)})(c._databaseId,c._app?.options.appId||"",c._persistenceKey,n);c._componentsProvider||n.localCache?._offlineComponentProvider&&n.localCache?._onlineComponentProvider&&(c._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),c._firestoreClient=new Jq(c._authCredentials,c._appCheckCredentials,c._queue,l,c._componentsProvider&&(function(b){const I=b?._online.build();return{_offline:b?._offline.build(I),_online:I}})(c._componentsProvider))}class Ku{constructor(n){this._byteString=n}static fromBase64String(n){try{return new Ku(ll.fromBase64String(n))}catch(l){throw new Ji(di.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+l)}}static fromUint8Array(n){return new Ku(ll.fromUint8Array(n))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(n){return this._byteString.isEqual(n._byteString)}toJSON(){return{type:Ku._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(n){if(Q0(n,Ku._jsonSchema))return Ku.fromBase64String(n.bytes)}}Ku._jsonSchemaVersion="firestore/bytes/1.0",Ku._jsonSchema={type:pa("string",Ku._jsonSchemaVersion),bytes:pa("string")};class N1{constructor(...n){for(let l=0;l<n.length;++l)if(n[l].length===0)throw new Ji(di.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new al(n)}isEqual(n){return this._internalPath.isEqual(n._internalPath)}}class nx{constructor(n){this._methodName=n}}class nf{constructor(n,l){if(!isFinite(n)||n<-90||n>90)throw new Ji(di.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+n);if(!isFinite(l)||l<-180||l>180)throw new Ji(di.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+l);this._lat=n,this._long=l}get latitude(){return this._lat}get longitude(){return this._long}isEqual(n){return this._lat===n._lat&&this._long===n._long}_compareTo(n){return is(this._lat,n._lat)||is(this._long,n._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:nf._jsonSchemaVersion}}static fromJSON(n){if(Q0(n,nf._jsonSchema))return new nf(n.latitude,n.longitude)}}nf._jsonSchemaVersion="firestore/geoPoint/1.0",nf._jsonSchema={type:pa("string",nf._jsonSchemaVersion),latitude:pa("number"),longitude:pa("number")};class rf{constructor(n){this._values=(n||[]).map((l=>l))}toArray(){return this._values.map((n=>n))}isEqual(n){return(function(p,b){if(p.length!==b.length)return!1;for(let I=0;I<p.length;++I)if(p[I]!==b[I])return!1;return!0})(this._values,n._values)}toJSON(){return{type:rf._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(n){if(Q0(n,rf._jsonSchema)){if(Array.isArray(n.vectorValues)&&n.vectorValues.every((l=>typeof l=="number")))return new rf(n.vectorValues);throw new Ji(di.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}rf._jsonSchemaVersion="firestore/vectorValue/1.0",rf._jsonSchema={type:pa("string",rf._jsonSchemaVersion),vectorValues:pa("object")};const aH=/^__.*__$/;class lH{constructor(n,l,p){this.data=n,this.fieldMask=l,this.fieldTransforms=p}toMutation(n,l){return this.fieldMask!==null?new Jm(n,this.data,this.fieldMask,l,this.fieldTransforms):new J0(n,this.data,l,this.fieldTransforms)}}class NL{constructor(n,l,p){this.data=n,this.fieldMask=l,this.fieldTransforms=p}toMutation(n,l){return new Jm(n,this.data,this.fieldMask,l,this.fieldTransforms)}}function VL(c){switch(c){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ir(40011,{Ac:c})}}class V1{constructor(n,l,p,b,I,P){this.settings=n,this.databaseId=l,this.serializer=p,this.ignoreUndefinedProperties=b,I===void 0&&this.Rc(),this.fieldTransforms=I||[],this.fieldMask=P||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(n){return new V1({...this.settings,...n},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(n){const l=this.path?.child(n),p=this.Vc({path:l,fc:!1});return p.gc(n),p}yc(n){const l=this.path?.child(n),p=this.Vc({path:l,fc:!1});return p.Rc(),p}wc(n){return this.Vc({path:void 0,fc:!0})}Sc(n){return c1(n,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(n){return this.fieldMask.find((l=>n.isPrefixOf(l)))!==void 0||this.fieldTransforms.find((l=>n.isPrefixOf(l.field)))!==void 0}Rc(){if(this.path)for(let n=0;n<this.path.length;n++)this.gc(this.path.get(n))}gc(n){if(n.length===0)throw this.Sc("Document fields must not be empty");if(VL(this.Ac)&&aH.test(n))throw this.Sc('Document fields cannot begin and end with "__"')}}class cH{constructor(n,l,p){this.databaseId=n,this.ignoreUndefinedProperties=l,this.serializer=p||z1(n)}Cc(n,l,p,b=!1){return new V1({Ac:n,methodName:l,Dc:p,path:al.emptyPath(),fc:!1,bc:b},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function U1(c){const n=c._freezeSettings(),l=z1(c._databaseId);return new cH(c._databaseId,!!n.ignoreUndefinedProperties,l)}function UL(c,n,l,p,b,I={}){const P=c.Cc(I.merge||I.mergeFields?2:0,n,l,b);US("Data must be an object, but it was:",P,p);const s=GL(p,P);let G,q;if(I.merge)G=new gu(P.fieldMask),q=P.fieldTransforms;else if(I.mergeFields){const ie=[];for(const ce of I.mergeFields){const be=fE(n,ce,l);if(!P.contains(be))throw new Ji(di.INVALID_ARGUMENT,`Field '${be}' is specified in your field mask but missing from your input data.`);HL(ie,be)||ie.push(be)}G=new gu(ie),q=P.fieldTransforms.filter((ce=>G.covers(ce.field)))}else G=null,q=P.fieldTransforms;return new lH(new Fc(s),G,q)}class j1 extends nx{_toFieldTransform(n){if(n.Ac!==2)throw n.Ac===1?n.Sc(`${this._methodName}() can only appear at the top level of your update data`):n.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return n.fieldMask.push(n.path),null}isEqual(n){return n instanceof j1}}function jL(c,n,l){return new V1({Ac:3,Dc:n.settings.Dc,methodName:c._methodName,fc:l},n.databaseId,n.serializer,n.ignoreUndefinedProperties)}class NS extends nx{constructor(n,l){super(n),this.vc=l}_toFieldTransform(n){const l=jL(this,n,!0),p=this.vc.map((I=>T_(I,l))),b=new Gy(p);return new QO(n.path,b)}isEqual(n){return n instanceof NS&&hp(this.vc,n.vc)}}class VS extends nx{constructor(n,l){super(n),this.vc=l}_toFieldTransform(n){const l=jL(this,n,!0),p=this.vc.map((I=>T_(I,l))),b=new qy(p);return new QO(n.path,b)}isEqual(n){return n instanceof VS&&hp(this.vc,n.vc)}}function uH(c,n,l,p){const b=c.Cc(1,n,l);US("Data must be an object, but it was:",b,p);const I=[],P=Fc.empty();Qm(p,((G,q)=>{const ie=jS(n,G,l);q=xo(q);const ce=b.yc(ie);if(q instanceof j1)I.push(ie);else{const be=T_(q,ce);be!=null&&(I.push(ie),P.set(ie,be))}}));const s=new gu(I);return new NL(P,s,b.fieldTransforms)}function hH(c,n,l,p,b,I){const P=c.Cc(1,n,l),s=[fE(n,p,l)],G=[b];if(I.length%2!=0)throw new Ji(di.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let be=0;be<I.length;be+=2)s.push(fE(n,I[be])),G.push(I[be+1]);const q=[],ie=Fc.empty();for(let be=s.length-1;be>=0;--be)if(!HL(q,s[be])){const He=s[be];let Je=G[be];Je=xo(Je);const it=P.yc(He);if(Je instanceof j1)q.push(He);else{const Ze=T_(Je,it);Ze!=null&&(q.push(He),ie.set(He,Ze))}}const ce=new gu(q);return new NL(ie,ce,P.fieldTransforms)}function dH(c,n,l,p=!1){return T_(l,c.Cc(p?4:3,n))}function T_(c,n){if(qL(c=xo(c)))return US("Unsupported field value:",n,c),GL(c,n);if(c instanceof nx)return(function(p,b){if(!VL(b.Ac))throw b.Sc(`${p._methodName}() can only be used with update() and set()`);if(!b.path)throw b.Sc(`${p._methodName}() is not currently supported inside arrays`);const I=p._toFieldTransform(b);I&&b.fieldTransforms.push(I)})(c,n),null;if(c===void 0&&n.ignoreUndefinedProperties)return null;if(n.path&&n.fieldMask.push(n.path),c instanceof Array){if(n.settings.fc&&n.Ac!==4)throw n.Sc("Nested arrays are not supported");return(function(p,b){const I=[];let P=0;for(const s of p){let G=T_(s,b.wc(P));G==null&&(G={nullValue:"NULL_VALUE"}),I.push(G),P++}return{arrayValue:{values:I}}})(c,n)}return(function(p,b){if((p=xo(p))===null)return{nullValue:"NULL_VALUE"};if(typeof p=="number")return JG(b.serializer,p);if(typeof p=="boolean")return{booleanValue:p};if(typeof p=="string")return{stringValue:p};if(p instanceof Date){const I=lo.fromDate(p);return{timestampValue:s1(b.serializer,I)}}if(p instanceof lo){const I=new lo(p.seconds,1e3*Math.floor(p.nanoseconds/1e3));return{timestampValue:s1(b.serializer,I)}}if(p instanceof nf)return{geoPointValue:{latitude:p.latitude,longitude:p.longitude}};if(p instanceof Ku)return{bytesValue:rL(b.serializer,p._byteString)};if(p instanceof Ko){const I=b.databaseId,P=p.firestore._databaseId;if(!P.isEqual(I))throw b.Sc(`Document reference is for database ${P.projectId}/${P.database} but should be for database ${I.projectId}/${I.database}`);return{referenceValue:ES(p.firestore._databaseId||b.databaseId,p._key.path)}}if(p instanceof rf)return(function(P,s){return{mapValue:{fields:{[PO]:{stringValue:OO},[t1]:{arrayValue:{values:P.toArray().map((q=>{if(typeof q!="number")throw s.Sc("VectorValues must only contain numeric values.");return xS(s.serializer,q)}))}}}}}})(p,b);throw b.Sc(`Unsupported field value: ${A1(p)}`)})(c,n)}function GL(c,n){const l={};return AO(c)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):Qm(c,((p,b)=>{const I=T_(b,n.mc(p));I!=null&&(l[p]=I)})),{mapValue:{fields:l}}}function qL(c){return!(typeof c!="object"||c===null||c instanceof Array||c instanceof Date||c instanceof lo||c instanceof nf||c instanceof Ku||c instanceof Ko||c instanceof nx||c instanceof rf)}function US(c,n,l){if(!qL(l)||!EO(l)){const p=A1(l);throw p==="an object"?n.Sc(c+" a custom object"):n.Sc(c+" "+p)}}function fE(c,n,l){if((n=xo(n))instanceof N1)return n._internalPath;if(typeof n=="string")return jS(c,n);throw c1("Field path arguments must be of type string or ",c,!1,void 0,l)}const fH=new RegExp("[~\\*/\\[\\]]");function jS(c,n,l){if(n.search(fH)>=0)throw c1(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,c,!1,void 0,l);try{return new N1(...n.split("."))._internalPath}catch{throw c1(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,c,!1,void 0,l)}}function c1(c,n,l,p,b){const I=p&&!p.isEmpty(),P=b!==void 0;let s=`Function ${n}() called with invalid data`;l&&(s+=" (via `toFirestore()`)"),s+=". ";let G="";return(I||P)&&(G+=" (found",I&&(G+=` in field ${p}`),P&&(G+=` in document ${b}`),G+=")"),new Ji(di.INVALID_ARGUMENT,s+c+G)}function HL(c,n){return c.some((l=>l.isEqual(n)))}class $L{constructor(n,l,p,b,I){this._firestore=n,this._userDataWriter=l,this._key=p,this._document=b,this._converter=I}get id(){return this._key.path.lastSegment()}get ref(){return new Ko(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const n=new pH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(n)}return this._userDataWriter.convertValue(this._document.data.value)}}get(n){if(this._document){const l=this._document.data.field(G1("DocumentSnapshot.get",n));if(l!==null)return this._userDataWriter.convertValue(l)}}}class pH extends $L{data(){return super.data()}}function G1(c,n){return typeof n=="string"?jS(c,n):n instanceof N1?n._internalPath:n._delegate._internalPath}function mH(c){if(c.limitType==="L"&&c.explicitOrderBy.length===0)throw new Ji(di.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class GS{}class WL extends GS{}function gH(c,n,...l){let p=[];n instanceof GS&&p.push(n),p=p.concat(l),(function(I){const P=I.filter((G=>G instanceof qS)).length,s=I.filter((G=>G instanceof q1)).length;if(P>1||P>0&&s>0)throw new Ji(di.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(p);for(const b of p)c=b._apply(c);return c}class q1 extends WL{constructor(n,l,p){super(),this._field=n,this._op=l,this._value=p,this.type="where"}static _create(n,l,p){return new q1(n,l,p)}_apply(n){const l=this._parse(n);return ZL(n._query,l),new b_(n.firestore,n.converter,iE(n._query,l))}_parse(n){const l=U1(n.firestore);return(function(I,P,s,G,q,ie,ce){let be;if(q.isKeyField()){if(ie==="array-contains"||ie==="array-contains-any")throw new Ji(di.INVALID_ARGUMENT,`Invalid Query. You can't perform '${ie}' queries on documentId().`);if(ie==="in"||ie==="not-in"){eM(ce,ie);const Je=[];for(const it of ce)Je.push(JR(G,I,it));be={arrayValue:{values:Je}}}else be=JR(G,I,ce)}else ie!=="in"&&ie!=="not-in"&&ie!=="array-contains-any"||eM(ce,ie),be=dH(s,P,ce,ie==="in"||ie==="not-in");return fa.create(q,ie,be)})(n._query,"where",l,n.firestore._databaseId,this._field,this._op,this._value)}}function _H(c,n,l){const p=n,b=G1("where",c);return q1._create(b,p,l)}class qS extends GS{constructor(n,l){super(),this.type=n,this._queryConstraints=l}static _create(n,l){return new qS(n,l)}_parse(n){const l=this._queryConstraints.map((p=>p._parse(n))).filter((p=>p.getFilters().length>0));return l.length===1?l[0]:od.create(l,this._getOperator())}_apply(n){const l=this._parse(n);return l.getFilters().length===0?n:((function(b,I){let P=b;const s=I.getFlattenedFilters();for(const G of s)ZL(P,G),P=iE(P,G)})(n._query,l),new b_(n.firestore,n.converter,iE(n._query,l)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class HS extends WL{constructor(n,l){super(),this._field=n,this._direction=l,this.type="orderBy"}static _create(n,l){return new HS(n,l)}_apply(n){const l=(function(b,I,P){if(b.startAt!==null)throw new Ji(di.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(b.endAt!==null)throw new Ji(di.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new F0(I,P)})(n._query,this._field,this._direction);return new b_(n.firestore,n.converter,(function(b,I){const P=b.explicitOrderBy.concat([I]);return new nv(b.path,b.collectionGroup,P,b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)})(n._query,l))}}function yH(c,n="asc"){const l=n,p=G1("orderBy",c);return HS._create(p,l)}function JR(c,n,l){if(typeof(l=xo(l))=="string"){if(l==="")throw new Ji(di.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!UO(n)&&l.indexOf("/")!==-1)throw new Ji(di.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${l}' contains a '/' character.`);const p=n.path.child(Xs.fromString(l));if(!zn.isDocumentKey(p))throw new Ji(di.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${p}' is not because it has an odd number of segments (${p.length}).`);return gR(c,new zn(p))}if(l instanceof Ko)return gR(c,l._key);throw new Ji(di.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${A1(l)}.`)}function eM(c,n){if(!Array.isArray(c)||c.length===0)throw new Ji(di.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${n.toString()}' filters.`)}function ZL(c,n){const l=(function(b,I){for(const P of b)for(const s of P.getFlattenedFilters())if(I.indexOf(s.op)>=0)return s.op;return null})(c.filters,(function(b){switch(b){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(n.op));if(l!==null)throw l===n.op?new Ji(di.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${n.op.toString()}' filter.`):new Ji(di.INVALID_ARGUMENT,`Invalid query. You cannot use '${n.op.toString()}' filters with '${l.toString()}' filters.`)}class vH{convertValue(n,l="none"){switch($m(n)){case 0:return null;case 1:return n.booleanValue;case 2:return Xo(n.integerValue||n.doubleValue);case 3:return this.convertTimestamp(n.timestampValue);case 4:return this.convertServerTimestamp(n,l);case 5:return n.stringValue;case 6:return this.convertBytes(Hm(n.bytesValue));case 7:return this.convertReference(n.referenceValue);case 8:return this.convertGeoPoint(n.geoPointValue);case 9:return this.convertArray(n.arrayValue,l);case 11:return this.convertObject(n.mapValue,l);case 10:return this.convertVectorValue(n.mapValue);default:throw ir(62114,{value:n})}}convertObject(n,l){return this.convertObjectMap(n.fields,l)}convertObjectMap(n,l="none"){const p={};return Qm(n,((b,I)=>{p[b]=this.convertValue(I,l)})),p}convertVectorValue(n){const l=n.fields?.[t1].arrayValue?.values?.map((p=>Xo(p.doubleValue)));return new rf(l)}convertGeoPoint(n){return new nf(Xo(n.latitude),Xo(n.longitude))}convertArray(n,l){return(n.values||[]).map((p=>this.convertValue(p,l)))}convertServerTimestamp(n,l){switch(l){case"previous":const p=R1(n);return p==null?null:this.convertValue(p,l);case"estimate":return this.convertTimestamp(L0(n));default:return null}}convertTimestamp(n){const l=qm(n);return new lo(l.seconds,l.nanos)}convertDocumentKey(n,l){const p=Xs.fromString(n);Rs(uL(p),9688,{name:n});const b=new z0(p.get(1),p.get(3)),I=new zn(p.popFirst(5));return b.isEqual(l)||pp(`Document ${I} contains a document reference within a different database (${b.projectId}/${b.database}) which is not supported. It will be treated as a reference in the current database (${l.projectId}/${l.database}) instead.`),I}}function XL(c,n,l){let p;return p=c?c.toFirestore(n):n,p}class x0{constructor(n,l){this.hasPendingWrites=n,this.fromCache=l}isEqual(n){return this.hasPendingWrites===n.hasPendingWrites&&this.fromCache===n.fromCache}}class o_ extends $L{constructor(n,l,p,b,I,P){super(n,l,p,b,P),this._firestore=n,this._firestoreImpl=n,this.metadata=I}exists(){return super.exists()}data(n={}){if(this._document){if(this._converter){const l=new Fb(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(l,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}}get(n,l={}){if(this._document){const p=this._document.data.field(G1("DocumentSnapshot.get",n));if(p!==null)return this._userDataWriter.convertValue(p,l.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Ji(di.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n=this._document,l={};return l.type=o_._jsonSchemaVersion,l.bundle="",l.bundleSource="DocumentSnapshot",l.bundleName=this._key.toString(),!n||!n.isValidDocument()||!n.isFoundDocument()?l:(this._userDataWriter.convertObjectMap(n.data.value.mapValue.fields,"previous"),l.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),l)}}o_._jsonSchemaVersion="firestore/documentSnapshot/1.0",o_._jsonSchema={type:pa("string",o_._jsonSchemaVersion),bundleSource:pa("string","DocumentSnapshot"),bundleName:pa("string"),bundle:pa("string")};class Fb extends o_{data(n={}){return super.data(n)}}class ky{constructor(n,l,p,b){this._firestore=n,this._userDataWriter=l,this._snapshot=b,this.metadata=new x0(b.hasPendingWrites,b.fromCache),this.query=p}get docs(){const n=[];return this.forEach((l=>n.push(l))),n}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(n,l){this._snapshot.docs.forEach((p=>{n.call(l,new Fb(this._firestore,this._userDataWriter,p.key,p,new x0(this._snapshot.mutatedKeys.has(p.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(n={}){const l=!!n.includeMetadataChanges;if(l&&this._snapshot.excludesMetadataChanges)throw new Ji(di.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===l||(this._cachedChanges=(function(b,I){if(b._snapshot.oldDocs.isEmpty()){let P=0;return b._snapshot.docChanges.map((s=>{const G=new Fb(b._firestore,b._userDataWriter,s.doc.key,s.doc,new x0(b._snapshot.mutatedKeys.has(s.doc.key),b._snapshot.fromCache),b.query.converter);return s.doc,{type:"added",doc:G,oldIndex:-1,newIndex:P++}}))}{let P=b._snapshot.oldDocs;return b._snapshot.docChanges.filter((s=>I||s.type!==3)).map((s=>{const G=new Fb(b._firestore,b._userDataWriter,s.doc.key,s.doc,new x0(b._snapshot.mutatedKeys.has(s.doc.key),b._snapshot.fromCache),b.query.converter);let q=-1,ie=-1;return s.type!==0&&(q=P.indexOf(s.doc.key),P=P.delete(s.doc.key)),s.type!==1&&(P=P.add(s.doc),ie=P.indexOf(s.doc.key)),{type:xH(s.type),doc:G,oldIndex:q,newIndex:ie}}))}})(this,l),this._cachedChangesIncludeMetadataChanges=l),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Ji(di.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const n={};n.type=ky._jsonSchemaVersion,n.bundleSource="QuerySnapshot",n.bundleName=fS.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const l=[],p=[],b=[];return this.docs.forEach((I=>{I._document!==null&&(l.push(I._document),p.push(this._userDataWriter.convertObjectMap(I._document.data.value.mapValue.fields,"previous")),b.push(I.ref.path))})),n.bundle=(this._firestore,this.query._query,n.bundleName,"NOT SUPPORTED"),n}}function xH(c){switch(c){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ir(61501,{type:c})}}function Xm(c){c=sd(c,Ko);const n=sd(c.firestore,w_);return iH(BS(n),c._key).then((l=>wH(n,c,l)))}ky._jsonSchemaVersion="firestore/querySnapshot/1.0",ky._jsonSchema={type:pa("string",ky._jsonSchemaVersion),bundleSource:pa("string","QuerySnapshot"),bundleName:pa("string"),bundle:pa("string")};class KL extends vH{constructor(n){super(),this.firestore=n}convertBytes(n){return new Ku(n)}convertReference(n){const l=this.convertDocumentKey(n,this.firestore._databaseId);return new Ko(this.firestore,null,l)}}function $S(c){c=sd(c,b_);const n=sd(c.firestore,w_),l=BS(n),p=new KL(n);return mH(c._query),nH(l,c._query).then((b=>new ky(n,p,c,b)))}function WS(c,n,l){c=sd(c,Ko);const p=sd(c.firestore,w_),b=XL(c.converter,n);return H1(p,[UL(U1(p),"setDoc",c._key,b,c.converter!==null,l).toMutation(c._key,Ju.none())])}function tM(c,n,l,...p){c=sd(c,Ko);const b=sd(c.firestore,w_),I=U1(b);let P;return P=typeof(n=xo(n))=="string"||n instanceof N1?hH(I,"updateDoc",c._key,n,l,p):uH(I,"updateDoc",c._key,n),H1(b,[P.toMutation(c._key,Ju.exists(!0))])}function bH(c){return H1(sd(c.firestore,w_),[new bS(c._key,Ju.none())])}function YL(c,n){const l=sd(c.firestore,w_),p=Yu(c),b=XL(c.converter,n);return H1(l,[UL(U1(c.firestore),"addDoc",p._key,b,c.converter!==null,{}).toMutation(p._key,Ju.exists(!1))]).then((()=>p))}function H1(c,n){return(function(p,b){const I=new lp;return p.asyncQueue.enqueueAndForget((async()=>qq(await tH(p),b,I))),I.promise})(BS(c),n)}function wH(c,n,l){const p=l.docs.get(n._key),b=new KL(c);return new o_(c,b,n._key,p,new x0(l.hasPendingWrites,l.fromCache),n.converter)}function TH(...c){return new NS("arrayUnion",c)}function EH(...c){return new VS("arrayRemove",c)}(function(n,l=!0){(function(b){ev=b})(y_),nd(new eh("firestore",((p,{instanceIdentifier:b,options:I})=>{const P=p.getProvider("app").getImmediate(),s=new w_(new hG(p.getProvider("auth-internal")),new pG(P,p.getProvider("app-check-internal")),(function(q,ie){if(!Object.prototype.hasOwnProperty.apply(q.options,["projectId"]))throw new Ji(di.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new z0(q.options.projectId,ie)})(P,b),P);return I={useFetchStreams:l,...I},s._setSettings(I),s}),"PUBLIC").setMultipleInstances(!0)),Bc(nR,rR,n),Bc(nR,rR,"esm2020")})();const SH={apiKey:"AIzaSyBkVUw3Bybu0Klkk3gqwSV13NtH1lHRl8U",authDomain:"journeyly-p100.firebaseapp.com",projectId:"journeyly-p100",storageBucket:"journeyly-p100.firebasestorage.app",messagingSenderId:"205263669102",appId:"1:205263669102:web:75dea8a18873fef78de37f",measurementId:"G-QEB46W4740"},ZS=HD(SH),Ll=sH(ZS),td=Kj(ZS),QL=sG(ZS);var Bb={exports:{}},AH=Bb.exports,iM;function IH(){return iM||(iM=1,(function(c,n){(function(l,p){c.exports=p()})(AH,(function(){var l,p,b;function I(s,G){if(!l)l=G;else if(!p)p=G;else{var q="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+p+")(sharedChunk); self.onerror = null;",ie={};l(ie),b=G(ie),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([q],{type:"text/javascript"})))}}I(["exports"],(function(s){var G=1e-6,q=typeof Float32Array<"u"?Float32Array:Array;function ie(r,e){var i=e[0],a=e[1],h=e[2],m=e[3],_=i*m-h*a;return _?(r[0]=m*(_=1/_),r[1]=-a*_,r[2]=-h*_,r[3]=i*_,r):null}function ce(){var r=new q(9);return q!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function be(r,e){var i=e[0],a=e[1],h=e[2],m=e[3],_=e[4],v=e[5],E=e[6],S=e[7],M=e[8];return r[0]=_*M-v*S,r[1]=h*S-a*M,r[2]=a*v-h*_,r[3]=v*E-m*M,r[4]=i*M-h*E,r[5]=h*m-i*v,r[6]=m*S-_*E,r[7]=a*E-i*S,r[8]=i*_-a*m,r}function He(r,e,i){var a=e[0],h=e[1],m=e[2],_=e[3],v=e[4],E=e[5],S=e[6],M=e[7],D=e[8],O=i[0],N=i[1],V=i[2],$=i[3],Z=i[4],K=i[5],ne=i[6],ae=i[7],ue=i[8];return r[0]=O*a+N*_+V*S,r[1]=O*h+N*v+V*M,r[2]=O*m+N*E+V*D,r[3]=$*a+Z*_+K*S,r[4]=$*h+Z*v+K*M,r[5]=$*m+Z*E+K*D,r[6]=ne*a+ae*_+ue*S,r[7]=ne*h+ae*v+ue*M,r[8]=ne*m+ae*E+ue*D,r}function Je(){var r=new q(16);return q!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function it(r){var e=new q(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Ze(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Pt(r,e){var i=e[0],a=e[1],h=e[2],m=e[3],_=e[4],v=e[5],E=e[6],S=e[7],M=e[8],D=e[9],O=e[10],N=e[11],V=e[12],$=e[13],Z=e[14],K=e[15],ne=i*v-a*_,ae=i*E-h*_,ue=i*S-m*_,Te=a*E-h*v,_e=a*S-m*v,Ie=h*S-m*E,Me=M*$-D*V,Le=M*Z-O*V,at=M*K-N*V,Ge=D*Z-O*$,ut=D*K-N*$,gt=O*K-N*Z,Et=ne*gt-ae*ut+ue*Ge+Te*at-_e*Le+Ie*Me;return Et?(r[0]=(v*gt-E*ut+S*Ge)*(Et=1/Et),r[1]=(h*ut-a*gt-m*Ge)*Et,r[2]=($*Ie-Z*_e+K*Te)*Et,r[3]=(O*_e-D*Ie-N*Te)*Et,r[4]=(E*at-_*gt-S*Le)*Et,r[5]=(i*gt-h*at+m*Le)*Et,r[6]=(Z*ue-V*Ie-K*ae)*Et,r[7]=(M*Ie-O*ue+N*ae)*Et,r[8]=(_*ut-v*at+S*Me)*Et,r[9]=(a*at-i*ut-m*Me)*Et,r[10]=(V*_e-$*ue+K*ne)*Et,r[11]=(D*ue-M*_e-N*ne)*Et,r[12]=(v*Le-_*Ge-E*Me)*Et,r[13]=(i*Ge-a*Le+h*Me)*Et,r[14]=($*ae-V*Te-Z*ne)*Et,r[15]=(M*Te-D*ae+O*ne)*Et,r):null}function ct(r,e,i){var a=e[0],h=e[1],m=e[2],_=e[3],v=e[4],E=e[5],S=e[6],M=e[7],D=e[8],O=e[9],N=e[10],V=e[11],$=e[12],Z=e[13],K=e[14],ne=e[15],ae=i[0],ue=i[1],Te=i[2],_e=i[3];return r[0]=ae*a+ue*v+Te*D+_e*$,r[1]=ae*h+ue*E+Te*O+_e*Z,r[2]=ae*m+ue*S+Te*N+_e*K,r[3]=ae*_+ue*M+Te*V+_e*ne,r[4]=(ae=i[4])*a+(ue=i[5])*v+(Te=i[6])*D+(_e=i[7])*$,r[5]=ae*h+ue*E+Te*O+_e*Z,r[6]=ae*m+ue*S+Te*N+_e*K,r[7]=ae*_+ue*M+Te*V+_e*ne,r[8]=(ae=i[8])*a+(ue=i[9])*v+(Te=i[10])*D+(_e=i[11])*$,r[9]=ae*h+ue*E+Te*O+_e*Z,r[10]=ae*m+ue*S+Te*N+_e*K,r[11]=ae*_+ue*M+Te*V+_e*ne,r[12]=(ae=i[12])*a+(ue=i[13])*v+(Te=i[14])*D+(_e=i[15])*$,r[13]=ae*h+ue*E+Te*O+_e*Z,r[14]=ae*m+ue*S+Te*N+_e*K,r[15]=ae*_+ue*M+Te*V+_e*ne,r}function Gt(r,e,i){var a,h,m,_,v,E,S,M,D,O,N,V,$=i[0],Z=i[1],K=i[2];return e===r?(r[12]=e[0]*$+e[4]*Z+e[8]*K+e[12],r[13]=e[1]*$+e[5]*Z+e[9]*K+e[13],r[14]=e[2]*$+e[6]*Z+e[10]*K+e[14],r[15]=e[3]*$+e[7]*Z+e[11]*K+e[15]):(h=e[1],m=e[2],_=e[3],v=e[4],E=e[5],S=e[6],M=e[7],D=e[8],O=e[9],N=e[10],V=e[11],r[0]=a=e[0],r[1]=h,r[2]=m,r[3]=_,r[4]=v,r[5]=E,r[6]=S,r[7]=M,r[8]=D,r[9]=O,r[10]=N,r[11]=V,r[12]=a*$+v*Z+D*K+e[12],r[13]=h*$+E*Z+O*K+e[13],r[14]=m*$+S*Z+N*K+e[14],r[15]=_*$+M*Z+V*K+e[15]),r}function ei(r,e,i){var a=i[0],h=i[1],m=i[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*h,r[5]=e[5]*h,r[6]=e[6]*h,r[7]=e[7]*h,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Fi(r,e,i){var a=Math.sin(i),h=Math.cos(i),m=e[4],_=e[5],v=e[6],E=e[7],S=e[8],M=e[9],D=e[10],O=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*h+S*a,r[5]=_*h+M*a,r[6]=v*h+D*a,r[7]=E*h+O*a,r[8]=S*h-m*a,r[9]=M*h-_*a,r[10]=D*h-v*a,r[11]=O*h-E*a,r}function Si(r,e,i){var a=Math.sin(i),h=Math.cos(i),m=e[0],_=e[1],v=e[2],E=e[3],S=e[8],M=e[9],D=e[10],O=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*h-S*a,r[1]=_*h-M*a,r[2]=v*h-D*a,r[3]=E*h-O*a,r[8]=m*a+S*h,r[9]=_*a+M*h,r[10]=v*a+D*h,r[11]=E*a+O*h,r}function qe(r,e,i){var a=Math.sin(i),h=Math.cos(i),m=e[0],_=e[1],v=e[2],E=e[3],S=e[4],M=e[5],D=e[6],O=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*h+S*a,r[1]=_*h+M*a,r[2]=v*h+D*a,r[3]=E*h+O*a,r[4]=S*h-m*a,r[5]=M*h-_*a,r[6]=D*h-v*a,r[7]=O*h-E*a,r}function Oe(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function je(r,e,i){var a,h,m,_=i[0],v=i[1],E=i[2],S=Math.sqrt(_*_+v*v+E*E);return S<G?null:(_*=S=1/S,v*=S,E*=S,a=Math.sin(e),h=Math.cos(e),r[0]=_*_*(m=1-h)+h,r[1]=v*_*m+E*a,r[2]=E*_*m-v*a,r[3]=0,r[4]=_*v*m-E*a,r[5]=v*v*m+h,r[6]=E*v*m+_*a,r[7]=0,r[8]=_*E*m+v*a,r[9]=v*E*m-_*a,r[10]=E*E*m+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function tt(r,e){var i=e[0],a=e[1],h=e[2],m=e[4],_=e[5],v=e[6],E=e[8],S=e[9],M=e[10];return r[0]=Math.sqrt(i*i+a*a+h*h),r[1]=Math.sqrt(m*m+_*_+v*v),r[2]=Math.sqrt(E*E+S*S+M*M),r}function nt(r,e){var i=e[0],a=e[1],h=e[2],m=e[3],_=i+i,v=a+a,E=h+h,S=i*_,M=a*_,D=a*v,O=h*_,N=h*v,V=h*E,$=m*_,Z=m*v,K=m*E;return r[0]=1-D-V,r[1]=M+K,r[2]=O-Z,r[3]=0,r[4]=M-K,r[5]=1-S-V,r[6]=N+$,r[7]=0,r[8]=O+Z,r[9]=N-$,r[10]=1-S-D,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var yt=ct;function ze(){var r=new q(3);return q!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function ur(r){var e=new q(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function qn(r){var e=r[0],i=r[1],a=r[2];return Math.sqrt(e*e+i*i+a*a)}function Ct(r,e,i){var a=new q(3);return a[0]=r,a[1]=e,a[2]=i,a}function oi(r,e,i,a){return r[0]=e,r[1]=i,r[2]=a,r}function wi(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function bn(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Cn(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function rt(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function Yt(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function ai(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function _i(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r}function ln(r,e){var i=e[0]-r[0],a=e[1]-r[1],h=e[2]-r[2];return Math.sqrt(i*i+a*a+h*h)}function kn(r,e){var i=e[0]-r[0],a=e[1]-r[1],h=e[2]-r[2];return i*i+a*a+h*h}function Jn(r){var e=r[0],i=r[1],a=r[2];return e*e+i*i+a*a}function Mr(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Ki(r,e){var i=e[0],a=e[1],h=e[2],m=i*i+a*a+h*h;return m>0&&(m=1/Math.sqrt(m)),r[0]=e[0]*m,r[1]=e[1]*m,r[2]=e[2]*m,r}function hr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Wr(r,e,i){var a=e[0],h=e[1],m=e[2],_=i[0],v=i[1],E=i[2];return r[0]=h*E-m*v,r[1]=m*_-a*E,r[2]=a*v-h*_,r}function co(r,e,i,a){var h=e[0],m=e[1],_=e[2];return r[0]=h+a*(i[0]-h),r[1]=m+a*(i[1]-m),r[2]=_+a*(i[2]-_),r}function nr(r,e,i){var a=e[0],h=e[1],m=e[2],_=i[3]*a+i[7]*h+i[11]*m+i[15];return r[0]=(i[0]*a+i[4]*h+i[8]*m+i[12])/(_=_||1),r[1]=(i[1]*a+i[5]*h+i[9]*m+i[13])/_,r[2]=(i[2]*a+i[6]*h+i[10]*m+i[14])/_,r}function ps(r,e,i){var a=e[0],h=e[1],m=e[2];return r[0]=a*i[0]+h*i[3]+m*i[6],r[1]=a*i[1]+h*i[4]+m*i[7],r[2]=a*i[2]+h*i[5]+m*i[8],r}function rr(r,e,i){var a=i[0],h=i[1],m=i[2],_=i[3],v=e[0],E=e[1],S=e[2],M=h*S-m*E,D=m*v-a*S,O=a*E-h*v;return r[0]=v+_*(M+=M)+h*(O+=O)-m*(D+=D),r[1]=E+_*D+m*M-a*O,r[2]=S+_*O+a*D-h*M,r}function Ds(r){return r[0]=0,r[1]=0,r[2]=0,r}function Us(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Dr=bn,ms=Cn,hs=qn;function Di(){var r=new q(4);return q!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function rn(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function vn(r,e){var i=e[0],a=e[1],h=e[2],m=e[3],_=i*i+a*a+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),r[0]=i*_,r[1]=a*_,r[2]=h*_,r[3]=m*_,r}function $i(r,e,i){var a=e[0],h=e[1],m=e[2],_=e[3];return r[0]=i[0]*a+i[4]*h+i[8]*m+i[12]*_,r[1]=i[1]*a+i[5]*h+i[9]*m+i[13]*_,r[2]=i[2]*a+i[6]*h+i[10]*m+i[14]*_,r[3]=i[3]*a+i[7]*h+i[11]*m+i[15]*_,r}function Ks(){var r=new q(4);return q!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Kn(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function uo(r,e,i){i*=.5;var a=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=a*E+_*v,r[1]=h*E+m*v,r[2]=m*E-h*v,r[3]=_*E-a*v,r}function Uo(r,e,i){i*=.5;var a=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=a*E-m*v,r[1]=h*E+_*v,r[2]=m*E+a*v,r[3]=_*E-h*v,r}ze(),Di();var jo,ac,$a,Nc=vn,Yo=(jo=ze(),ac=Ct(1,0,0),$a=Ct(0,1,0),function(r,e,i){var a=hr(e,i);return a<-.999999?(Wr(jo,ac,e),hs(jo)<1e-6&&Wr(jo,$a,e),Ki(jo,jo),(function(h,m,_){_*=.5;var v=Math.sin(_);h[0]=v*m[0],h[1]=v*m[1],h[2]=v*m[2],h[3]=Math.cos(_)})(r,jo,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Wr(jo,e,i),r[0]=jo[0],r[1]=jo[1],r[2]=jo[2],r[3]=1+a,Nc(r,r))});function pr(){var r=new q(2);return q!=Float32Array&&(r[0]=0,r[1]=0),r}function Co(r,e){var i=new q(2);return i[0]=r,i[1]=e,i}function Ts(r,e,i){return r[0]=e,r[1]=i,r}function cl(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function Qo(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function ma(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function dr(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function Ps(r,e){var i=e[0],a=e[1],h=i*i+a*a;return h>0&&(h=1/Math.sqrt(h)),r[0]=e[0]*h,r[1]=e[1]*h,r}function Es(r,e){return r[0]*e[0]+r[1]*e[1]}Ks(),Ks(),ce();var Go,js,Ma=Qo;function ih(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}pr();var ad=(function(){if(js)return Go;function r(e,i,a,h){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=h}return js=1,Go=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,h=0;h<8;h++){var m=this.sampleCurveX(a)-e;if(Math.abs(m)<i)return a;var _=this.sampleCurveDerivativeX(a);if(Math.abs(_)<1e-6)break;a-=m/_}var v=0,E=1;for(a=e,h=0;h<20&&(m=this.sampleCurveX(a),!(Math.abs(m-e)<i));h++)e>m?v=a:E=a,a=.5*(E-v)+v;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Go})(),ga=ih(ad);function St(r,e){this.x=r,this.y=e}function Fl(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!Fl(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!Fl(r[i],e[i]))return!1;return!0}return r===e}St.prototype={clone(){return new St(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround(r,e){const i=Math.cos(r),a=Math.sin(r),h=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:St},St.convert=function(r){if(r instanceof St)return r;if(Array.isArray(r))return new St(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new St(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const Bl=Math.PI/180,Vc=180/Math.PI;function gn(r){return r*Bl}function Ls(r){return r*Vc}const Nl=[[0,0],[1,0],[1,1],[0,1]];function _u(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Ne(r,e,i,a){const h=new ga(r,e,i,a);return function(m){return h.solve(m)}}const Y=Ne(.25,.1,.25,1);function J(r,e,i){return Math.min(i,Math.max(e,r))}function de(r,e,i){return(i=J((i-r)/(e-r),0,1))*i*(3-2*i)}function Re(r,e,i){const a=i-e,h=((r-e)%a+a)%a+e;return h===e?i:h}function Ce(r,e,i){if(!r.length)return i(null,[]);let a=r.length;const h=new Array(r.length);let m=null;r.forEach(((_,v)=>{e(_,((E,S)=>{E&&(m=E),h[v]=S,--a==0&&i(m,h)}))}))}let Fe=1;function Ye(){return Fe++}function Be(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function We(r,e){r.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function Ot(r,e,i){const a={};for(const h in r)a[h]=e.call(this,r[h],h,r);return a}function xt(r,e,i){const a={};for(const h in r)e.call(this,r[h],h,r)&&(a[h]=r[h]);return a}function ui(r){return Array.isArray(r)?r.map(ui):typeof r=="object"&&r?Ot(r,ui):r}function Ii(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const Ci={};function gi(r){Ci[r]||(typeof console<"u"&&console.warn(r),Ci[r]=!0)}function en(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function sn(r){let e=0;for(let i,a,h=0,m=r.length,_=m-1;h<m;_=h++)i=r[h],a=r[_],e+=(a.x-i.x)*(i.y+a.y);return e}function Rn([r,e,i]){const a=gn(e+90),h=gn(i);return{x:r*Math.cos(a)*Math.sin(h),y:r*Math.sin(a)*Math.sin(h),z:r*Math.cos(h),azimuthal:e,polar:i}}function mr(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function ds(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,a,h,m)=>{const _=h||m;return e[a]=!_||_.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Zr=null;function Gr(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Hn(r,e,i,a){for(;e<i;){const h=e+i>>1;r[h]<a?e=h+1:i=h}return e}function dn(r,e,i,a){for(;e<i;){const h=e+i>>1;r[h]<=a?e=h+1:i=h}return e}function jn(r){return r>0?1/(1.001-r):1+r}function Pn(r){return r>0?1-1/(1.001-r):-r}function fn(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const or={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!or.API_URL)return null;try{const r=new URL(or.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function bs(r){return or.API_URL_REGEX.test(r)}function er(r){return or.API_SPRITE_REGEX.test(r)}let Ro,Jo,gs,Ms,Ys,Da;function Mo(){return Ro==null&&(Ro=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ro}const Qs={now:()=>Ms!==void 0?Ms:performance.now(),setNow(r){Ms=r},restoreNow(){Ms=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:a}=r;Ys||(Ys=document.createElement("canvas"));const h=Ys.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>Ys.width||a>Ys.height)&&(Ys.width=i,Ys.height=a),h.clearRect(-e,-e,i+2*e,a+2*e),h.drawImage(r,0,0,i,a),h.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:r=>(Jo||(Jo=document.createElement("a")),Jo.href=r,Jo.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(gs==null&&(gs=window.matchMedia("(prefers-reduced-motion: reduce)")),gs.matches)},hasCanvasFingerprintNoise(){if(Da!==void 0)return Da;if(!Mo())return Da=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<r.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const a=e.getImageData(0,0,r.width,r.height);i=0;for(let h=0;h<a.data.length;++h)if(h%4!=3&&i++!==a.data[h])return Da=!0,!0;return Da=!1,!1}};function nh(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(r.slice(i));for(const h in e)a.set(h,e[h]);return`${r.slice(0,i)}?${a.toString()}`}function ul(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const a=new URLSearchParams,h=new URLSearchParams(r.slice(i));for(const _ of e.persistentParams){const v=h.get(_);v&&a.set(_,v)}const m=a.toString();return`${r.slice(0,i)}${m.length>0?`?${m}`:""}`}const Do="mapbox-tiles";let yu=500,bo=50;const _a=["language","worldview","jobid"];let Js,ea;function ta(){try{return caches}catch{}}function hl(){const r=ta();r&&Js==null&&(Js=r.open(Do))}let Pa=1/0;const vu={supported:!1,testSupport:function(r){!dl&&ya&&(xu?lc(r):eo=r)}};let eo,ya,dl=!1,xu=!1;const qo=typeof self<"u"?self:{};function lc(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,ya),r.isContextLost())return;vu.supported=!0}catch{}r.deleteTexture(e),dl=!0}qo.document&&(ya=qo.document.createElement("img"),ya.onload=function(){eo&&lc(eo),eo=null,xu=!0},ya.onerror=function(){dl=!0,eo=null},ya.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ho={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Ho);class Po extends Error{constructor(e,i,a){i===401&&bs(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Uc=mr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Xr=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Uc())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(a,h){const m=new AbortController,_=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:Uc(),referrerPolicy:a.referrerPolicy,signal:m.signal});let v=!1,E=!1;const S=(M=_.url).indexOf("sku=")>0&&bs(M);var M;a.type==="json"&&_.headers.set("Accept","application/json");const D=(N,V,$)=>{if(E)return;if(N&&N.message!=="SecurityError"&&gi(N.toString()),V&&$)return O(V);const Z=Date.now();fetch(_).then((K=>{if(K.ok){const ne=S?K.clone():null;return O(K,ne,Z)}return h(new Po(K.statusText,K.status,a.url))})).catch((K=>{K.name!=="AbortError"&&h(new Error(`${K.message} ${a.url}`))}))},O=(N,V,$)=>{(a.type==="arrayBuffer"?N.arrayBuffer():a.type==="json"?N.json():N.text()).then((Z=>{E||(V&&$&&(function(K,ne,ae){if(hl(),Js==null)return;const ue=ds(ne.headers.get("Cache-Control")||"");if(ue["no-store"])return;const Te={status:ne.status,statusText:ne.statusText,headers:new Headers};ne.headers.forEach(((Me,Le)=>Te.headers.set(Le,Me))),ue["max-age"]&&Te.headers.set("Expires",new Date(ae+1e3*ue["max-age"]).toUTCString());const _e=Te.headers.get("Expires");if(!_e||new Date(_e).getTime()-ae<42e4)return;let Ie=ul(K.url,{persistentParams:_a});if(ne.status===206){const Me=K.headers.get("Range");if(!Me)return;Te.status=200,Ie=nh(Ie,{range:Me})}(function(Me,Le){if(ea===void 0)try{new Response(new ReadableStream),ea=!0}catch{ea=!1}ea?Le(Me.body):Me.blob().then(Le).catch((at=>gi(at.message)))})(ne,(Me=>{const Le=new Response((at=ne.status)!==200&&at!==404&&[101,103,204,205,304].includes(at)?null:Me,Te);var at;hl(),Js?.then((Ge=>Ge.put(Ie,Le))).catch((Ge=>gi(Ge.message)))}))})(_,V,$),v=!0,h(null,Z,N.headers))})).catch((Z=>{E||h(new Error(Z.message))}))};return S?(function(N,V){if(hl(),Js==null)return V(null);Js.then(($=>{let Z=ul(N.url,{persistentParams:_a});const K=N.headers.get("Range");K&&(Z=nh(Z,{range:K})),$.match(Z).then((ne=>{const ae=(function(ue){if(!ue)return!1;const Te=new Date(ue.headers.get("Expires")||0),_e=ds(ue.headers.get("Cache-Control")||"");return Number(Te)>Date.now()&&!_e["no-cache"]})(ne);$.delete(Z).catch(V),ae&&$.put(Z,ne.clone()).catch(V),V(null,ne,ae)})).catch(V)})).catch(V)})(_,D):D(null,null),{cancel:()=>{E=!0,v||m.abort()}}})(r,e);if(mr(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return(function(a,h){const m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const _ in a.headers)m.setRequestHeader(_,a.headers[_]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let _=m.response;if(a.type==="json")try{_=JSON.parse(m.response)}catch(E){return h(E)}const v=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((E=>{const S=E.split(": "),M=S.shift(),D=S.join(": ");v.append(M,D)})),h(null,_,v)}else h(new Po(m.statusText,m.status,a.url))},m.send(a.body),{cancel:()=>m.abort()}})(r,e)},va=function(r,e){return Xr(Object.assign(r,{type:"arrayBuffer"}),e)};function Mn(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const jc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Gc,Vl;Gc=[],Vl=0;const Ul=function(r,e){if(vu.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Vl>=or.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Gc.push(m),m}Vl++;let i=!1;const a=()=>{if(!i)for(i=!0,Vl--;Gc.length&&Vl<or.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Gc.shift(),{requestParameters:_,callback:v,cancelled:E}=m;E||(m.cancel=Ul(_,v).cancel)}},h=va(r,((m,_,v)=>{a(),m?e(m):_&&(self.createImageBitmap?(function(E,S){const M=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(M).then((D=>{S(null,D)})).catch((D=>{S(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((E,S)=>e(E,S,v))):(function(E,S){const M=new Image;M.onload=()=>{S(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame((()=>{M.src=jc}))},M.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(E)],{type:"image/png"});M.src=E.byteLength?URL.createObjectURL(D):jc})(_,((E,S)=>e(E,S,v))))}));return{cancel:()=>{h.cancel(),a()}}};var xa,to,Wa,ia={exports:{}},qc={exports:{}},bu={exports:{}},wu=(function(){if(Wa)return ia.exports;Wa=1;var r=(xa||(xa=1,qc.exports=function(i,a){var h,m,_,v,E,S,M,D;for(m=i.length-(h=3&i.length),_=a,E=3432918353,S=461845907,D=0;D<m;)M=255&i.charCodeAt(D)|(255&i.charCodeAt(++D))<<8|(255&i.charCodeAt(++D))<<16|(255&i.charCodeAt(++D))<<24,++D,_=27492+(65535&(v=5*(65535&(_=(_^=M=(65535&(M=(M=(65535&M)*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(M=0,h){case 3:M^=(255&i.charCodeAt(D+2))<<16;case 2:M^=(255&i.charCodeAt(D+1))<<8;case 1:_^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(D)))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*S+(((M>>>16)*S&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),qc.exports),e=(to||(to=1,bu.exports=function(i,a){for(var h,m=i.length,_=a^m,v=0;m>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(h>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++v;switch(m){case 3:_^=(255&i.charCodeAt(v+2))<<16;case 2:_^=(255&i.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),bu.exports);return ia.exports=r,ia.exports.murmur3=r,ia.exports.murmur2=e,ia.exports})(),cc=ih(wu);class Gs{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class uc extends Gs{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function hc(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function jl(r,e,i){if(i&&i[r]){const a=i[r].indexOf(e);a!==-1&&i[r].splice(a,1)}}class fl{on(e,i){return this._listeners=this._listeners||{},hc(e,i,this._listeners),this}off(e,i){return jl(e,i,this._listeners),jl(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},hc(e,i,this._oneTimeListeners),this):new Promise((a=>{this.once(e,a)}))}fire(e,i){const a=typeof e=="string"?new Gs(e,i):e,h=a.type;if(this.listens(h)){a.target=this;const m=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const E of m)E.call(this,a);const _=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const E of _)jl(h,E,this._oneTimeListeners),E.call(this,a);const v=this._eventedParent;if(v){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,E),v.fire(a)}}else a instanceof uc&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Ss{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Ss(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new Ss({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Ss.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Hc,rh={},ld=(function(){if(Hc)return rh;Hc=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function i(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function a(m){return(_=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:_>1?1:_;var _}function h(m,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?m+(_-m)*v*6:2*v<1?_:3*v<2?m+(_-m)*(2/3-v)*6:m}try{rh.parseCSSColor=function(m){var _,v=m.replace(/ /g,"").toLowerCase();if(v in r)return r[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var E=v.indexOf("("),S=v.indexOf(")");if(E!==-1&&S+1===v.length){var M=v.substr(0,E),D=v.substr(E+1,S-(E+1)).split(","),O=1;switch(M){case"rgba":if(D.length!==4)return null;O=a(D.pop());case"rgb":return D.length!==3?null:[i(D[0]),i(D[1]),i(D[2]),O];case"hsla":if(D.length!==4)return null;O=a(D.pop());case"hsl":if(D.length!==3)return null;var N=(parseFloat(D[0])%360+360)%360/360,V=a(D[1]),$=a(D[2]),Z=$<=.5?$*(V+1):$+V-$*V,K=2*$-Z;return[e(255*h(K,Z,N+1/3)),e(255*h(K,Z,N)),e(255*h(K,Z,N-1/3)),O];default:return null}}return null}}catch{}return rh})();class On{constructor(e,i,a,h=1){this.r=e,this.g=i,this.b=a,this.a=h}static parse(e){if(!e)return;if(e instanceof On)return e;if(typeof e!="string")return;const i=ld.parseCSSColor(e);return i?new On(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${h})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:h,a:m}=this;return new lf(e,i,a,h,m)}toPremultipliedRenderColor(e){const{r:i,g:a,b:h,a:m}=this;return new Gl(e,i*m,a*m,h*m,m)}clone(){return new On(this.r,this.g,this.b,this.a)}}class cd{constructor(e,i,a,h,m,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const v=e.image.height,E=v*v;this.premultiplied?(i=m===0?0:i/m*(v-1),a=m===0?0:a/m*(v-1),h=m===0?0:h/m*(v-1)):(i*=v-1,a*=v-1,h*=v-1);const S=Math.floor(i),M=Math.floor(a),D=Math.floor(h),O=Math.ceil(i),N=Math.ceil(a),V=Math.ceil(h),$=i-S,Z=a-M,K=h-D,ne=e.image.data,ae=4*(S+M*E+D*v),ue=4*(S+M*E+V*v),Te=4*(S+N*E+D*v),_e=4*(S+N*E+V*v),Ie=4*(O+M*E+D*v),Me=4*(O+M*E+V*v),Le=4*(O+N*E+D*v),at=4*(O+N*E+V*v);if(ae<0||at>=ne.length)throw new Error("out of range");this.r=Oi(Oi(Oi(ne[ae],ne[ue],K),Oi(ne[Te],ne[_e],K),Z),Oi(Oi(ne[Ie],ne[Me],K),Oi(ne[Le],ne[at],K),Z),$)/255*(this.premultiplied?m:1),this.g=Oi(Oi(Oi(ne[ae+1],ne[ue+1],K),Oi(ne[Te+1],ne[_e+1],K),Z),Oi(Oi(ne[Ie+1],ne[Me+1],K),Oi(ne[Le+1],ne[at+1],K),Z),$)/255*(this.premultiplied?m:1),this.b=Oi(Oi(Oi(ne[ae+2],ne[ue+2],K),Oi(ne[Te+2],ne[_e+2],K),Z),Oi(Oi(ne[Ie+2],ne[Me+2],K),Oi(ne[Le+2],ne[at+2],K),Z),$)/255*(this.premultiplied?m:1),this.a=m}else this.r=i,this.g=a,this.b=h,this.a=m}toArray(){const{r:e,g:i,b:a,a:h}=this;return[255*e,255*i,255*a,h]}toHslaArray(){let{r:e,g:i,b:a,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];const V=1/h;e*=V,i*=V,a*=V}const m=Math.min(Math.max(e,0),1),_=Math.min(Math.max(i,0),1),v=Math.min(Math.max(a,0),1),E=Math.min(m,_,v),S=Math.max(m,_,v),M=S-E,D=.5*(E+S);if(M===0)return[0,0,100*D,h];const O=D>.5?M/(2-S-E):M/(S+E);let N;switch(S){case m:N=60*((_-v)/M+(_<v?6:0));break;case _:N=60*((v-m)/M+2);break;default:N=60*((m-_)/M+4)}return[N,100*O,100*D,h]}toArray01(){const{r:e,g:i,b:a,a:h}=this;return[e,i,a,h]}toArray01Scaled(e){const{r:i,g:a,b:h}=this;return[i*e,a*e,h*e]}toArray01Linear(){const{r:e,g:i,b:a,a:h}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),h]}}class lf extends cd{constructor(e,i,a,h,m){super(e,i,a,h,m,!1)}}class Gl extends cd{constructor(e,i,a,h,m){super(e,i,a,h,m,!0)}}function Oi(r,e,i){return r*(1-i)+e*i}function Tu(r,e,i){return r.map(((a,h)=>Oi(a,e[h],i)))}On.black=new On(0,0,0,1),On.white=new On(1,1,1,1),On.transparent=new On(0,0,0,0),On.red=new On(1,0,0,1),On.blue=new On(0,0,1,1);var pl=Object.freeze({__proto__:null,array:Tu,color:function(r,e,i){return new On(Oi(r.r,e.r,i),Oi(r.g,e.g,i),Oi(r.b,e.b,i),Oi(r.a,e.a,i))},number:Oi});class ba extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class wo{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,h]of i)this.bindings[a]=h}concat(e){return new wo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ho={kind:"null"},xi={kind:"number"},An={kind:"string"},xn={kind:"boolean"},z={kind:"color"},Q={kind:"object"},oe={kind:"value"},De={kind:"collator"},Rt={kind:"formatted"},qt={kind:"resolvedImage"};function Ti(r,e){return{kind:"array",itemType:r,N:e}}function on(r){if(r.kind==="array"){const e=on(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const io=[ho,xi,An,xn,z,Rt,Q,Ti(oe),qt];function Pr(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Pr(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of io)if(!Pr(i,e))return null}}return`Expected ${on(r)} but found ${on(e)} instead.`}function As(r,e){return e.some((i=>i.kind===r.kind))}function na(r,e){return e.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function Za(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&Za(r.itemType,e.itemType):r.kind===e.kind}class Xa{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wa{constructor(e,i,a,h,m){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=h,this.textColor=m}}class ws{constructor(e){this.sections=e}static fromString(e){return new ws([new wa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof ws?e:ws.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class Oa{constructor(e,i={}){if(this.id=Ss.from(e),this.options=Object.assign({},i),i.transform){const{a,b:h,c:m,d:_,e:v,f:E}=i.transform;this.options.transform=new DOMMatrix([a,h,m,_,v,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:h,e:m,f:_}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:h,e:m,f:_}})}static parse(e){let i,a,h,m;try{({name:i,iconsetId:a,params:h,transform:m}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:_,b:v,c:E,d:S,e:M,f:D}=m||{};return new Oa({name:i,iconsetId:a},{params:h,transform:new DOMMatrix([_,v,E,S,M,D])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class fo{constructor(e,i,a,h,m=!1){this.primaryId=Ss.from(e),this.primaryOptions=i,a&&(this.secondaryId=Ss.from(a)),this.secondaryOptions=h,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Oa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Oa(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?fo.build({name:e}):e}static build(e,i,a,h){return!e||typeof e=="object"&&!("name"in e)?null:new fo(e,a,i,h)}}function vp(r,e,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,i,a]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ud(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof On||r instanceof Xa||r instanceof ws||r instanceof fo)return!0;if(Array.isArray(r)){for(const e of r)if(!ud(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!ud(r[e]))return!1;return!0}return!1}function qs(r){if(r===null)return ho;if(typeof r=="string")return An;if(typeof r=="boolean")return xn;if(typeof r=="number")return xi;if(r instanceof On)return z;if(r instanceof Xa)return De;if(r instanceof ws)return Rt;if(r instanceof fo)return qt;if(Array.isArray(r)){const e=r.length;let i;for(const a of r){const h=qs(a);if(i){if(i===h)continue;i=oe;break}i=h}return Ti(i||oe,e)}return Q}function ql(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof ws||r instanceof fo||r instanceof On?r.toString():JSON.stringify(r)}class dc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ud(e[1]))return i.error("invalid value");const a=e[1];let h=qs(a);const m=i.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new dc(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof On?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ws?this.value.serialize():this.value}}class Kr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Xi={string:An,number:xi,boolean:xn,object:Q};class pi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,h=1;const m=e[0];if(m==="array"){let v,E;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Xi)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Xi[S],h++}else v=oe;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],h++}a=Ti(v,E)}else a=Xi[m];const _=[];for(;h<e.length;h++){const v=i.parse(e[h],h,oe);if(!v)return null;_.push(v)}return new pi(a,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Pr(this.type,qs(a)))return a;if(i===this.args.length-1)throw new Kr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${on(qs(a))} but was expected to be of type ${on(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map((a=>a.serialize())))}}class fc{constructor(e){this.type=Rt,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let E=null;if(v["font-scale"]&&(E=i.parseObjectValue(v["font-scale"],_,"font-scale",xi),!E))return null;let S=null;if(v["text-font"]&&(S=i.parseObjectValue(v["text-font"],_,"text-font",Ti(An)),!S))return null;let M=null;if(v["text-color"]&&(M=i.parseObjectValue(v["text-color"],_,"text-color",z),!M))return null;const D=h[h.length-1];D.scale=E,D.font=S,D.textColor=M}else{const E=i.parse(e[_],_,oe);if(!E)return null;const S=E.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new fc(h)}evaluate(e){return new ws(this.sections.map((i=>{const a=i.content.evaluate(e);return Za(qs(a),qt)?new wa("",a,null,null,null):new wa(ql(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Ui{constructor(e,i,a,h){this._imageWarnHistory={},this.type=qt,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const h=[];function m(){if(a<e.length){const v=i.parse(e[a],a++,An);return v?(h.push({image:v,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(a<e.length){const E=e[a];if((v=E)===null||typeof v!="object"||Array.isArray(v))return!0;const S=E.params,M=E.iconset,D=i.concat(a);if(!S&&!M)return a++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const O={},N=D.concat(void 0,"params");for(const V in S){if(!V)return N.error("Image parameter name should be non-empty"),!1;const $=N.concat(void 0,V).parse(S[V],void 0,z,void 0,{typeAnnotation:"coerce"});if(!$)return!1;O[V]=$}h[h.length-1].options.params=O}if(M){if(typeof M!="object"||M.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!M.id)return D.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=M}return a++,!0}var v;return!0}for(let v=0;v<2;v++)if(!m()||!_())return;return new Ui(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const h in i)if(i[h])try{a[h]=i[h].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=fo.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const m=h.getPrimary().id;if(h.available=e.availableImages.some((_=>Ss.isEqual(_,m))),h.available){const _=h.getSecondary()?h.getSecondary().id:null;_&&(h.available=e.availableImages.some((v=>Ss.isEqual(v,_))))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const h in e)e[h]&&(a.params[h]=e[h].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function sh(r){return Li(r)?"string":dd(r)?"number":cf(r)?"boolean":Array.isArray(r)?"array":r===null?"null":hd(r)?"object":typeof r}function hd(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function Li(r){return typeof r=="string"||r instanceof String}function dd(r){return typeof r=="number"||r instanceof Number}function cf(r){return typeof r=="boolean"||r instanceof Boolean}const eg={"to-boolean":xn,"to-color":z,"to-number":xi,"to-string":An};class pc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],h=[];let m=ho;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);m=Ti(i.expectedType.itemType,_)}else{if(!(_>0&&ud(e[1][0])))return null;m=Ti(qs(e[1][0]),_)}for(let v=0;v<_;v++){const E=e[1][v];let S;if(Array.isArray(E))S=i.parse(E,void 0,m.itemType);else{const M=sh(E);if(M!==m.itemType.kind)return i.error(`Expected ${m.itemType.kind} but found ${M}.`);S=i.registry.literal.parse(["literal",E===void 0?null:E],i)}if(!S)return null;h.push(S)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");m=eg[a];for(let _=1;_<e.length;_++){const v=i.parse(e[_],_,oe);if(!v)return null;h.push(v)}}return new pc(m,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const h of this.args){if(i=h.evaluate(e),a=null,i instanceof On)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:vp(i[0],i[1],i[2],i[3]),!a))return new On(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Kr(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Kr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ws.fromString(ql(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?fo.build(ql(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):ql(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new fc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ui(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const xp=["Unknown","Point","LineString","Polygon"];class po{constructor(e,i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=On.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class $o{constructor(e,i,a,h,m){this.name=e,this.type=i,this._evaluate=a,this.args=h,this._overloadIndex=m}evaluate(e){if(!this._evaluate){const i=$o.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const a=e[0],h=$o.definitions[a];if(!h)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=[];let E=null,S=-1;for(const[M,D]of _){if(Array.isArray(M)&&M.length!==e.length-1)continue;v.push(M),S++,E=new gf(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const O=[];let N=!1;for(let V=1;V<e.length;V++){const $=e[V],Z=Array.isArray(M)?M[V-1]:M.type,K=E.parse($,1+O.length,Z);if(!K){N=!0;break}O.push(K)}if(!N)if(Array.isArray(M)&&M.length!==O.length)E.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const $=Array.isArray(M)?M[V]:M.type,Z=O[V];E.concat(V+1).checkSubtype($,Z.type)}if(E.errors.length===0)return new $o(a,m,D,O,S)}}if(v.length===1)i.errors.push(...E.errors);else{const M=(v.length?v:_.map((([O])=>O))).map(oh).join(" | "),D=[];for(let O=1;O<e.length;O++){const N=i.parse(e[O],1+D.length);if(!N)return null;D.push(on(N.type))}i.error(`Expected arguments of type ${M}, but found (${D.join(", ")}) instead.`)}return null}static register(e,i){$o.definitions=i;for(const a in i)e[a]=$o}}function oh(r){return Array.isArray(r)?`(${r.map(on).join(", ")})`:`(${on(r.type)}...)`}class Oo{constructor(e,i,a){this.type=De,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const h=a["case-sensitive"]===void 0?i.parse(!1,1,xn):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",xn);if(!h)return null;const m=a["diacritic-sensitive"]===void 0?i.parse(!1,1,xn):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",xn);if(!m)return null;let _=null;return a.locale&&(_=i.parseObjectValue(a.locale,1,"locale",An),!_)?null:new Oo(h,m,_)}evaluate(e){return new Xa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Ka(r,e,i=0,a=r.length-1,h=E_){for(;a>i;){if(a-i>600){const E=a-i+1,S=e-i+1,M=Math.log(E),D=.5*Math.exp(2*M/3),O=.5*Math.sqrt(M*D*(E-D)/E)*(S-E/2<0?-1:1);Ka(r,e,Math.max(i,Math.floor(e-S*D/E+O)),Math.min(a,Math.floor(e+(E-S)*D/E+O)),h)}const m=r[e];let _=i,v=a;for(no(r,i,e),h(r[a],m)>0&&no(r,i,a);_<v;){for(no(r,_,v),_++,v--;h(r[_],m)<0;)_++;for(;h(r[v],m)>0;)v--}h(r[i],m)===0?no(r,i,v):(v++,no(r,v,a)),v<=e&&(i=v+1),e<=v&&(a=v-1)}}function no(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function E_(r,e){return r<e?-1:r>e?1:0}function S_(r){let e=0;for(let i,a,h=0,m=r.length,_=m-1;h<m;_=h++)i=r[h],a=r[_],e+=(a.x-i.x)*(i.y+a.y);return e}function fd(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function mc(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function A_(r,e,i){const a=r[0]-e[0],h=r[1]-e[1],m=r[0]-i[0],_=r[1]-i[1];return a*_-m*h==0&&a*m<=0&&h*_<=0}function Wo(r,e,i=!1){let a=!1;for(let v=0,E=e.length;v<E;v++){const S=e[v];for(let M=0,D=S.length,O=D-1;M<D;O=M++){const N=S[O],V=S[M];if(A_(r,N,V))return i;(m=N)[1]>(h=r)[1]!=(_=V)[1]>h[1]&&h[0]<(_[0]-m[0])*(h[1]-m[1])/(_[1]-m[1])+m[0]&&(a=!a)}}var h,m,_;return a}function bp(r,e,i,a){const h=a[0]-i[0],m=a[1]-i[1],_=(r[0]-i[0])*m-h*(r[1]-i[1]),v=(e[0]-i[0])*m-h*(e[1]-i[1]);return _>0&&v<0||_<0&&v>0}function Eu(r,e,i,a){return(h=[a[0]-i[0],a[1]-i[1]])[0]*(m=[e[0]-r[0],e[1]-r[1]])[1]-h[1]*m[0]!=0&&!(!bp(r,e,i,a)||!bp(i,a,r,e));var h,m}function ah(r){const e=new St(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new St(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of r[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const $c=8192;function lh(r,e){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*$c),Math.round(a*h*$c)]}function ch(r,e){for(let i=0;i<e.length;i++)if(Wo(r,e[i]))return!0;return!1}function tg(r,e,i){for(const a of i)for(let h=0,m=a.length,_=m-1;h<m;_=h++)if(Eu(r,e,a[_],a[h]))return!0;return!1}function Wc(r,e){for(let i=0;i<r.length;++i)if(!Wo(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(tg(r[i],r[i+1],e))return!1;return!0}function uh(r,e){for(let i=0;i<e.length;i++)if(Wc(r,e[i]))return!0;return!1}function wp(r,e,i){const a=[];for(let h=0;h<r.length;h++){const m=[];for(let _=0;_<r[h].length;_++){const v=lh(r[h][_],i);fd(e,v),m.push(v)}a.push(m)}return a}function uf(r,e,i){const a=[];for(let h=0;h<r.length;h++){const m=wp(r[h],e,i);a.push(m)}return a}function Tp(r,e,i,a){if(r[0]<i[0]||r[0]>i[2]){const h=.5*a;let m=r[0]-i[0]>h?-a:i[0]-r[0]>h?a:0;m===0&&(m=r[0]-i[2]>h?-a:i[2]-r[0]>h?a:0),r[0]+=m}fd(e,r)}function ig(r,e,i,a){const h=Math.pow(2,a.z)*$c,m=[a.x*$c,a.y*$c],_=[];if(!r)return _;for(const v of r)for(const E of v){const S=[E.x+m[0],E.y+m[1]];Tp(S,e,i,h),_.push(S)}return _}function ml(r,e,i,a){const h=Math.pow(2,a.z)*$c,m=[a.x*$c,a.y*$c],_=[];if(!r)return _;for(const E of r){const S=[];for(const M of E){const D=[M.x+m[0],M.y+m[1]];fd(e,D),S.push(D)}_.push(S)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const E of _)for(const S of E)Tp(S,e,i,h)}var v;return _}class hh{constructor(e,i){this.type=xn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ud(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){const m=a.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new hh(a,a.features[h].geometry)}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new hh(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new hh(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(a.type==="Polygon"){const v=wp(a.coordinates,m,_),E=ig(i.geometry(),h,m,_);if(!mc(h,m))return!1;for(const S of E)if(!Wo(S,v))return!1}if(a.type==="MultiPolygon"){const v=uf(a.coordinates,m,_),E=ig(i.geometry(),h,m,_);if(!mc(h,m))return!1;for(const S of E)if(!ch(S,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(a.type==="Polygon"){const v=wp(a.coordinates,m,_),E=ml(i.geometry(),h,m,_);if(!mc(h,m))return!1;for(const S of E)if(!Wc(S,v))return!1}if(a.type==="MultiPolygon"){const v=uf(a.coordinates,m,_),E=ml(i.geometry(),h,m,_);if(!mc(h,m))return!1;for(const S of E)if(!uh(S,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const pd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ep=1/298.257223563,hf=Ep*(2-Ep),ra=Math.PI/180;class Zc{static fromTile(e,i,a){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),m=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/ra;return new Zc(m,a)}static get units(){return pd}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!pd[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(pd).join(", ")}`);const a=6378.137*ra*(i?pd[i]:1),h=Math.cos(e*ra),m=1/(1-hf*(1-h*h)),_=Math.sqrt(m);this.kx=a*_*h,this.ky=a*_*m*(1-hf)}distance(e,i){const a=Ta(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+h*h)}bearing(e,i){const a=Ta(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/ra}destination(e,i,a){const h=a*ra;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const h=e[a];for(let m=0,_=h.length,v=_-1;m<_;v=m++)i+=Ta(h[m][0]-h[v][0])*(h[m][1]+h[v][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const m=e[h],_=e[h+1],v=this.distance(m,_);if(a+=v,a>i)return Xc(m,_,(i-(a-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[h,m]=i,_=Ta(a[0]-h)*this.kx,v=(a[1]-m)*this.ky;if(_!==0||v!==0){const E=(Ta(e[0]-h)*this.kx*_+(e[1]-m)*this.ky*v)/(_*_+v*v);E>1?(h=a[0],m=a[1]):E>0&&(h+=_/this.kx*E,m+=v/this.ky*E)}return _=Ta(e[0]-h)*this.kx,v=(e[1]-m)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(e,i){let a=1/0,h=e[0][0],m=e[0][1],_=0,v=0;for(let E=0;E<e.length-1;E++){let S=e[E][0],M=e[E][1],D=Ta(e[E+1][0]-S)*this.kx,O=(e[E+1][1]-M)*this.ky,N=0;D===0&&O===0||(N=(Ta(i[0]-S)*this.kx*D+(i[1]-M)*this.ky*O)/(D*D+O*O),N>1?(S=e[E+1][0],M=e[E+1][1]):N>0&&(S+=D/this.kx*N,M+=O/this.ky*N)),D=Ta(i[0]-S)*this.kx,O=(i[1]-M)*this.ky;const V=D*D+O*O;V<a&&(a=V,h=S,m=M,_=E,v=N)}return{point:[h,m],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,a){let h=this.pointOnLine(a,e),m=this.pointOnLine(a,i);if(h.index>m.index||h.index===m.index&&h.t>m.t){const S=h;h=m,m=S}const _=[h.point],v=h.index+1,E=m.index;!La(a[v],_[0])&&v<=E&&_.push(a[v]);for(let S=v+1;S<=E;S++)_.push(a[S]);return La(a[E],m.point)||_.push(m.point),_}lineSliceAlong(e,i,a){let h=0;const m=[];for(let _=0;_<a.length-1;_++){const v=a[_],E=a[_+1],S=this.distance(v,E);if(h+=S,h>e&&m.length===0&&m.push(Xc(v,E,(e-(h-S))/S)),h>=i)return m.push(Xc(v,E,(i-(h-S))/S)),m;h>e&&m.push(E)}return m}bufferPoint(e,i){const a=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-a,e[0]+h,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-a,e[2]+h,e[3]+a]}insideBBox(e,i){return Ta(e[0]-i[0])>=0&&Ta(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function La(r,e){return r[0]===e[0]&&r[1]===e[1]}function Xc(r,e,i){const a=Ta(e[0]-r[0]);return[r[0]+a*i,r[1]+(e[1]-r[1])*i]}function Ta(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class dh{constructor(e=[],i=((a,h)=>a<h?-1:a>h?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,h=i[e];for(;e>0;){const m=e-1>>1,_=i[m];if(a(h,_)>=0)break;i[e]=_,e=m}i[e]=h}_down(e){const{data:i,compare:a}=this,h=this.length>>1,m=i[e];for(;e<h;){let _=1+(e<<1);const v=_+1;if(v<this.length&&a(i[v],i[_])<0&&(_=v),a(i[_],m)>=0)break;i[e]=i[_],e=_}i[e]=m}}var Nt=8192;function df(r,e){return e.dist-r.dist}const gl=100,fh=50;function Su(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function gc(r){return r[1]-r[0]+1}function _c(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function sa(r,e){if(r[0]>r[1])return[null,null];const i=gc(r);if(e){if(i===2)return[r,null];const a=Math.floor(i/2);return[[r[0],r[0]+a],[r[0]+a,r[1]]]}{if(i===1)return[r,null];const a=Math.floor(i/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}}function za(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!_c(e,r.length))return i;for(let a=e[0];a<=e[1];++a)fd(i,r[a]);return i}function an(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let a=0;a<r[i].length;++a)fd(e,r[i][a]);return e}function ph(r,e,i){if(Su(r)||Su(e))return NaN;let a=0,h=0;return r[2]<e[0]&&(a=e[0]-r[2]),r[0]>e[2]&&(a=r[0]-e[2]),r[1]>e[3]&&(h=r[1]-e[3]),r[3]<e[1]&&(h=e[1]-r[3]),i.distance([0,0],[a,h])}function Sp(r){return 360*r-180}function mh(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function md(r,e){const i=Math.pow(2,e.z),a=(r.y/Nt+e.y)/i;return[Sp((r.x/Nt+e.x)/i),mh(a)]}function I_(r,e){const i=[];for(let a=0;a<r.length;++a)i.push(md(r[a],e));return i}function Or(r,e,i){const a=i.pointOnLine(e,r).point;return i.distance(r,a)}function ng(r,e,i,a,h){const m=i.slice(a[0],a[1]+1);let _=1/0;for(let v=e[0];v<=e[1];++v)if((_=Math.min(_,Or(r[v],m,h)))===0)return 0;return _}function ka(r,e,i,a,h){const m=Math.min(h.pointToSegmentDistance(r,i,a),h.pointToSegmentDistance(e,i,a)),_=Math.min(h.pointToSegmentDistance(i,r,e),h.pointToSegmentDistance(a,r,e));return Math.min(m,_)}function gd(r,e,i,a,h){if(!_c(e,r.length)||!_c(a,i.length))return NaN;let m=1/0;for(let _=e[0];_<e[1];++_)for(let v=a[0];v<a[1];++v){if(Eu(r[_],r[_+1],i[v],i[v+1]))return 0;m=Math.min(m,ka(r[_],r[_+1],i[v],i[v+1],h))}return m}function _d(r,e,i,a,h){if(!_c(e,r.length)||!_c(a,i.length))return NaN;let m=1/0;for(let _=e[0];_<=e[1];++_)for(let v=a[0];v<=a[1];++v)if((m=Math.min(m,h.distance(r[_],i[v])))===0)return m;return m}function Ap(r,e,i){if(Wo(r,e,!0))return 0;let a=1/0;for(const h of e){const m=h.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[m-1]&&(a=Math.min(a,i.pointToSegmentDistance(r,h[m-1],h[0])))===0||(a=Math.min(a,Or(r,h,i)))===0)return a}return a}function ff(r,e,i,a){if(!_c(e,r.length))return NaN;for(let m=e[0];m<=e[1];++m)if(Wo(r[m],i,!0))return 0;let h=1/0;for(let m=e[0];m<e[1];++m)for(const _ of i)for(let v=0,E=_.length,S=E-1;v<E;S=v++){if(Eu(r[m],r[m+1],_[S],_[v]))return 0;h=Math.min(h,ka(r[m],r[m+1],_[S],_[v],a))}return h}function Ya(r,e){for(const i of r)for(let a=0;a<=i.length-1;++a)if(Wo(i[a],e,!0))return!0;return!1}function _l(r,e,i,a=1/0){const h=an(r),m=an(e);if(a!==1/0&&ph(h,m,i)>=a)return a;if(mc(h,m)){if(Ya(r,e))return 0}else if(Ya(e,r))return 0;let _=a;for(const v of r)for(let E=0,S=v.length,M=S-1;E<S;M=E++)for(const D of e)for(let O=0,N=D.length,V=N-1;O<N;V=O++){if(Eu(v[M],v[E],D[V],D[O]))return 0;_=Math.min(_,ka(v[M],v[E],D[V],D[O],i))}return _}function Hl(r,e,i,a,h,m,_){if(m===null||_===null)return;const v=ph(za(a,m),za(h,_),i);v<e&&r.push({dist:v,range1:m,range2:_})}function yc(r,e,i,a,h=1/0){let m=Math.min(a.distance(r[0],i[0][0]),h);if(m===0)return m;const _=new dh([{dist:0,range1:[0,r.length-1],range2:[0,0]}],df),v=e?fh:gl,E=an(i);for(;_.length;){const S=_.pop();if(S.dist>=m)continue;const M=S.range1;if(gc(M)<=v){if(!_c(M,r.length))return NaN;if(e){const D=ff(r,M,i,a);if((m=Math.min(m,D))===0)return m}else for(let D=M[0];D<=M[1];++D){const O=Ap(r[D],i,a);if((m=Math.min(m,O))===0)return m}}else{const D=sa(M,e);if(D[0]!==null){const O=ph(za(r,D[0]),E,a);O<m&&_.push({dist:O,range1:D[0],range2:[0,0]})}if(D[1]!==null){const O=ph(za(r,D[1]),E,a);O<m&&_.push({dist:O,range1:D[1],range2:[0,0]})}}}return m}function $l(r,e,i,a,h,m=1/0){let _=Math.min(m,h.distance(r[0],i[0]));if(_===0)return _;const v=new dh([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],df),E=e?fh:gl,S=a?fh:gl;for(;v.length;){const M=v.pop();if(M.dist>=_)continue;const D=M.range1,O=M.range2;if(gc(D)<=E&&gc(O)<=S){if(!_c(D,r.length)||!_c(O,i.length))return NaN;if(e&&a?_=Math.min(_,gd(r,D,i,O,h)):e||a?e&&!a?_=Math.min(_,ng(i,O,r,D,h)):!e&&a&&(_=Math.min(_,ng(r,D,i,O,h))):_=Math.min(_,_d(r,D,i,O,h)),_===0)return _}else{const N=sa(D,e),V=sa(O,a);Hl(v,_,h,r,i,N[0],V[0]),Hl(v,_,h,r,i,N[0],V[1]),Hl(v,_,h,r,i,N[1],V[0]),Hl(v,_,h,r,i,N[1],V[1])}}return _}function Wl(r,e,i,a,h=1/0){let m=h;const _=za(r,[0,r.length-1]);for(const v of i)if(!(m!==1/0&&ph(_,za(v,[0,v.length-1]),a)>=m)&&(m=Math.min(m,$l(r,e,v,!0,a,m)),m===0))return m;return m}function pf(r,e,i,a,h=1/0){let m=h;const _=za(r,[0,r.length-1]);for(const v of i){if(m!==1/0&&ph(_,an(v),a)>=m)continue;const E=yc(r,e,v,a,m);if(isNaN(E))return E;if((m=Math.min(m,E))===0)return m}return m}function mf(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class Kc{constructor(e,i){this.type=xi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ud(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let h=0;h<a.features.length;++h)if(mf(a.features[h].geometry.type))return new Kc(a,a.features[h].geometry)}else if(a.type==="Feature"){if(mf(a.geometry.type))return new Kc(a,a.geometry)}else if(mf(a.type))return new Kc(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return(function(h,m,_){const v=[];for(const S of h)for(const M of S)v.push(md(M,m));const E=new Zc(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?$l(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",E):_.type==="MultiLineString"?Wl(v,!1,_.coordinates,E):_.type==="Polygon"||_.type==="MultiPolygon"?pf(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,E):null})(i,a,this.geometries);if(e.geometryType()==="LineString")return(function(h,m,_){const v=[];for(const S of h){const M=[];for(const D of S)M.push(md(D,m));v.push(M)}const E=new Zc(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Wl(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,E);if(_.type==="MultiLineString"){let S=1/0;for(let M=0;M<_.coordinates.length;M++){const D=Wl(_.coordinates[M],!0,v,E,S);if(isNaN(D))return D;if((S=Math.min(S,D))===0)return S}return S}if(_.type==="Polygon"||_.type==="MultiPolygon"){let S=1/0;for(let M=0;M<v.length;M++){const D=pf(v[M],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,E,S);if(isNaN(D))return D;if((S=Math.min(S,D))===0)return S}return S}return null})(i,a,this.geometries);if(e.geometryType()==="Polygon")return(function(h,m,_){const v=[];for(const S of(function(M,D){const O=M.length;if(O<=1)return[M];const N=[];let V,$;for(let Z=0;Z<O;Z++){const K=S_(M[Z]);K!==0&&(M[Z].area=Math.abs(K),$===void 0&&($=K<0),$===K<0?(V&&N.push(V),V=[M[Z]]):V.push(M[Z]))}return V&&N.push(V),N})(h)){const M=[];for(let D=0;D<S.length;++D)M.push(I_(S[D],m));v.push(M)}const E=new Zc(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return pf(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,E);if(_.type==="MultiLineString"){let S=1/0;for(let M=0;M<_.coordinates.length;M++){const D=pf(_.coordinates[M],!0,v,E,S);if(isNaN(D))return D;if((S=Math.min(S,D))===0)return S}return S}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(S,M,D){let O=1/0;for(const N of S)for(const V of M){const $=_l(N,V,D,O);if(isNaN($))return $;if((O=Math.min(O,$))===0)return O}return O})(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,E):null})(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function gh(r){if(r instanceof $o&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof hh||r instanceof Kc)return!1;if(r instanceof Au)return r.featureConstant;let e=!0;return r.eachChild((i=>{e&&!gh(i)&&(e=!1)})),e}function ro(r){if(r instanceof $o&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((i=>{e&&!ro(i)&&(e=!1)})),e}function os(r,e){if(r instanceof $o&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((a=>{i&&!os(a,e)&&(i=!1)})),i}function Ir(r,e,i){return[r,e,i].filter(Boolean).join("")}function vc(r,e){switch(r){case"string":return ql(e);case"number":return+e;case"boolean":return!!e;case"color":return On.parse(e);case"formatted":return ws.fromString(ql(e));case"resolvedImage":return fo.build(ql(e))}return e}function Qa(r,e,i,a){return a!==void 0&&(r=a*Math.round(r/a)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Au{constructor(e,i,a,h=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=h}static parse(e,i){let a=i.expectedType;if(a==null&&(a=oe),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof dc))return i.error("Key name of 'config' expression must be a string literal.");let m,_=!0;const v=ql(h.value);if(e.length>=3){const E=i.parse(e[2],2);if(!(E instanceof dc))return i.error("Scope of 'config' expression must be a string literal.");m=ql(E.value)}if(i.options){const E=Ir(v,m,i._scope),S=i.options.get(E);S&&(_=gh(S.value||S.default))}return new Au(a,v,m,_)}evaluate(e){const i=Ir(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:h,value:m,values:_,minValue:v,maxValue:E,stepValue:S}=a,M=a.default.evaluate(e);let D=M;if(m){const O=e.scope;e.scope=(O||"").split("").slice(1).join(""),D=m.evaluate(e),e.scope=O}return h&&(D=vc(h,D)),D===void 0||v===void 0&&E===void 0&&S===void 0||(typeof D=="number"?D=Qa(D,v,E,S):Array.isArray(D)&&(D=D.map((O=>typeof O=="number"?Qa(O,v,E,S):O)))),m!==void 0&&D!==void 0&&_&&!_.includes(D)&&(D=M,h&&(D=vc(h,D))),(h&&h!==this.type||D!==void 0&&!Za(qs(D),this.type))&&(D=vc(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Zl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new Zl(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class gf{constructor(e,i=[],a,h=new wo,m=[],_,v,E){this.registry=e,this.path=i,this.key=i.map((S=>typeof S=="string"?`['${S}']`:`[${S}]`)).join(""),this.scope=h,this.errors=m,this.expectedType=a,this._scope=_,this.options=v,this.iconImageUseTheme=E}parse(e,i,a,h,m={}){return i||a?this.concat(i,null,a,h)._parse(e,m):this._parse(e,m)}parseObjectValue(e,i,a,h,m,_={}){return this.concat(i,a,h,m)._parse(e,_)}_parse(e,i){function a(h,m,_){return _==="assert"?new pi(m,[h]):_==="coerce"?new pc(m,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let m=h.parse(e,this);if(!m)return null;if(this.expectedType){const _=this.expectedType,v=m.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else m=a(m,_,i.typeAnnotation||"coerce");else m=a(m,_,i.typeAnnotation||"assert")}if(!(m instanceof dc)&&m.type.kind!=="resolvedImage"&&Ip(m)){const _=new po(this._scope,this.options,this.iconImageUseTheme);try{m=new dc(m.type,m.evaluate(_))}catch(v){return this.error(v.message),null}}return m}return pc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,h){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof i=="string"?m.concat(i):m;const _=h?this.scope.concat(h):this.scope;return new gf(this.registry,m,a||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const a=`${this.key}${i.map((h=>`[${h}]`)).join("")}`;this.errors.push(new ba(a,e))}checkSubtype(e,i){const a=Pr(e,i);return a&&this.error(a),a}}function Ip(r){if(r instanceof Zl)return Ip(r.boundExpression);if(r instanceof $o&&r.name==="error"||r instanceof Oo||r instanceof hh||r instanceof Kc||r instanceof Au)return!1;const e=r instanceof pc||r instanceof pi;let i=!0;return r.eachChild((a=>{i=e?i&&Ip(a):i&&a instanceof dc})),!!i&&gh(r)&&os(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Yc(r,e){const i=r.length-1;let a,h,m=0,_=i,v=0;for(;m<=_;)if(v=Math.floor((m+_)/2),a=r[v],h=r[v+1],a<=e){if(v===i||e<h)return v;m=v+1}else{if(!(a>e))throw new Kr("Input is not a number.");_=v-1}return 0}class Xl{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,m]of a)this.labels.push(h),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,xi);if(!a)return null;const h=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let _=1;_<e.length;_+=2){const v=_===1?-1/0:e[_],E=e[_+1],S=_,M=_+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(h.length&&h[h.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const D=i.parse(E,M,m);if(!D)return null;m=m||D.type,h.push([v,D])}return new Xl(m,a,h)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return a[0].evaluate(e);const m=i.length;return h>=i[m-1]?a[m-1].evaluate(e):a[Yc(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Cp=.95047,yd=1.08883,Rp=4/29,yl=6/29,vl=3*yl*yl,Iu=yl*yl*yl,xc=Math.PI/180,rg=180/Math.PI;function _f(r){return r>Iu?Math.pow(r,1/3):r/vl+Rp}function Cu(r){return r>yl?r*r*r:vl*(r-Rp)}function _h(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function bc(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function zs(r){const e=bc(r.r),i=bc(r.g),a=bc(r.b),h=_f((.4124564*e+.3575761*i+.1804375*a)/Cp),m=_f((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-_f((.0193339*e+.119192*i+.9503041*a)/yd)),alpha:r.a}}function vd(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*Cu(e),i=Cp*Cu(i),a=yd*Cu(a),new On(_h(3.2404542*i-1.5371385*e-.4985314*a),_h(-.969266*i+1.8760108*e+.041556*a),_h(.0556434*i-.2040259*e+1.0572252*a),r.alpha)}function sg(r,e,i){const a=e-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const yf={forward:zs,reverse:vd,interpolate:function(r,e,i){return{l:Oi(r.l,e.l,i),a:Oi(r.a,e.a,i),b:Oi(r.b,e.b,i),alpha:Oi(r.alpha,e.alpha,i)}}},yh={forward:function(r){const{l:e,a:i,b:a}=zs(r),h=Math.atan2(a,i)*rg;return{h:h<0?h+360:h,c:Math.sqrt(i*i+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*xc,i=r.c;return vd({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:sg(r.h,e.h,i),c:Oi(r.c,e.c,i),l:Oi(r.l,e.l,i),alpha:Oi(r.alpha,e.alpha,i)}}};var Mp=Object.freeze({__proto__:null,hcl:yh,lab:yf});class Yr{constructor(e,i,a,h,m){this.type=e,this.operator=i,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of m)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,i,a,h){let m=0;if(e.name==="exponential")m=vf(i,e.base,a,h);else if(e.name==="linear")m=vf(i,1,a,h);else if(e.name==="cubic-bezier"){const _=e.controlPoints;m=new ga(_[0],_[1],_[2],_[3]).solve(vf(i,1,a,h))}return m}static parse(e,i){let[a,h,m,..._]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const S=h[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const S=h.slice(1);if(S.length!==4||S.some((M=>typeof M!="number"||M<0||M>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,xi),!m)return null;const v=[];let E=null;a==="interpolate-hcl"||a==="interpolate-lab"?E=z:i.expectedType&&i.expectedType.kind!=="value"&&(E=i.expectedType);for(let S=0;S<_.length;S+=2){const M=_[S],D=_[S+1],O=S+3,N=S+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',O);const V=i.parse(D,N,E);if(!V)return null;E=E||V.type,v.push([M,V])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Yr(E,a,h,m,v):i.error(`Type ${on(E)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return a[0].evaluate(e);const m=i.length;if(h>=i[m-1])return a[m-1].evaluate(e);const _=Yc(i,h),v=Yr.interpolationFactor(this.interpolation,h,i[_],i[_+1]),E=a[_].evaluate(e),S=a[_+1].evaluate(e);return this.operator==="interpolate"?pl[this.type.kind.toLowerCase()](E,S,v):this.operator==="interpolate-hcl"?yh.reverse(yh.interpolate(yh.forward(E),yh.forward(S),v)):yf.reverse(yf.interpolate(yf.forward(E),yf.forward(S),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function vf(r,e,i,a){const h=a-i,m=r-i;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}class Qc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const h=i.expectedType;h&&h.kind!=="value"&&(a=h);const m=[];for(const v of e.slice(1)){const E=i.parse(v,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!E)return null;a=a||E.type,m.push(E)}const _=h&&m.some((v=>Pr(h,v.type)));return new Qc(_?oe:a,m)}evaluate(e){let i,a=null,h=0;for(const m of this.args){if(h++,a=m.evaluate(e),a&&a instanceof fo&&!a.available&&(i||(i=a),a=null,h===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Jc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if(typeof _!="string")return i.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=i.parse(e[m+1],m+1);if(!v)return null;a.push([_,v])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return h?new Jc(a,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class xf{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,xi),h=i.parse(e[2],2,Ti(i.expectedType||oe));return a&&h?new xf(h.type.itemType,a,h):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Kr("Array index out of bounds: negative index");if(i>=a.length)throw new Kr("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Kr("Array index must be an integer. Use at-interpolated for fractional indices");return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ru{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,xi),h=i.parse(e[2],2,Ti(i.expectedType||oe));return a&&h?new Ru(h.type.itemType,a,h):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Kr(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new Kr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const h=Math.floor(i),m=Math.ceil(i),_=a[h],v=a[m];if(typeof _!="number"||typeof v!="number")throw new Kr(`Cannot interpolate between non-number values at index ${i}.`);const E=i-h;return _*(1-E)+v*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Mu{constructor(e,i){this.type=xn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,oe),h=i.parse(e[2],2,oe);return a&&h?As(a.type,[xn,An,xi,ho,oe])?new Mu(a,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!na(i,["boolean","string","number","null"]))throw new Kr(`Expected first argument to be of type boolean, string, number or null, but found ${on(qs(i))} instead.`);if(!na(a,["string","array"]))throw new Kr(`Expected second argument to be of type array or string, but found ${on(qs(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class bf{constructor(e,i,a){this.type=xi,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,oe),h=i.parse(e[2],2,oe);if(!a||!h)return null;if(!As(a.type,[xn,An,xi,ho,oe]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${on(a.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,xi);return m?new bf(a,h,m):null}return new bf(a,h)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!na(i,["boolean","string","number","null"]))throw new Kr(`Expected first argument to be of type boolean, string, number or null, but found ${on(qs(i))} instead.`);if(!na(a,["string","array"]))throw new Kr(`Expected second argument to be of type array or string, but found ${on(qs(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(i,h)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class wf{constructor(e,i,a,h,m,_){this.inputType=e,this.type=i,this.input=a,this.cases=h,this.outputs=m,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const m={},_=[];for(let S=2;S<e.length-1;S+=2){let M=e[S];const D=e[S+1];Array.isArray(M)||(M=[M]);const O=i.concat(S);if(M.length===0)return O.error("Expected at least one branch label.");for(const V of M){if(typeof V!="number"&&typeof V!="string")return O.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return O.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return O.error("Numeric branch labels must be integer values.");if(a){if(O.checkSubtype(a,qs(V)))return null}else a=qs(V);if(m[String(V)]!==void 0)return O.error("Branch labels must be unique.");m[String(V)]=_.length}const N=i.parse(D,S,h);if(!N)return null;h=h||N.type,_.push(N)}const v=i.parse(e[1],1,oe);if(!v)return null;const E=i.parse(e[e.length-1],e.length-1,h);return E?v.type.kind!=="value"&&i.concat(1).checkSubtype(a,v.type)?null:new wf(a,h,v,m,_,E):null}evaluate(e){const i=this.input.evaluate(e);return(Za(qs(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],h={};for(const _ of i){const v=h[this.cases[_]];v===void 0?(h[this.cases[_]]=a.length,a.push([this.cases[_],[_]])):a[v][1].push(_)}const m=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of a)e.push(v.length===1?m(v[0]):v.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class xd{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const v=i.parse(e[_],_,xn);if(!v)return null;const E=i.parse(e[_+1],_+1,a);if(!E)return null;h.push([v,E]),a=a||E.type}const m=i.parse(e[e.length-1],e.length-1,a);return m?new xd(a,h,m):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Tf{constructor(e,i,a,h){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,oe),h=i.parse(e[2],2,xi);if(!a||!h)return null;if(!As(a.type,[Ti(oe),An,oe]))return i.error(`Expected first argument to be of type array or string, but found ${on(a.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,xi);return m?new Tf(a.type,a,h,m):null}return new Tf(a.type,a,h)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!na(i,["string","array"]))throw new Kr(`Expected first argument to be of type array or string, but found ${on(qs(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(a,h)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class wc{constructor(e,i){this.type=Ti(An),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,An),h=i.parse(e[2],2,An);return a&&h?new wc(a,h):void 0}evaluate(e){const i=this.str.evaluate(e),a=this.delimiter.evaluate(e);return i.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Dp(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ef(r,e,i,a){return a.compare(e,i)===0}function vh(r,e,i){const a=r!=="=="&&r!=="!=";return class JL{constructor(m,_,v){this.type=xn,this.lhs=m,this.rhs=_,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||_.type.kind==="value"}static parse(m,_){if(m.length!==3&&m.length!==4)return _.error("Expected two or three arguments.");const v=m[0];let E=_.parse(m[1],1,oe);if(!E)return null;if(!Dp(v,E.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${on(E.type)}'.`);let S=_.parse(m[2],2,oe);if(!S)return null;if(!Dp(v,S.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${on(S.type)}'.`);if(E.type.kind!==S.type.kind&&E.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${on(E.type)}' and '${on(S.type)}'.`);a&&(E.type.kind==="value"&&S.type.kind!=="value"?E=new pi(S.type,[E]):E.type.kind!=="value"&&S.type.kind==="value"&&(S=new pi(E.type,[S])));let M=null;if(m.length===4){if(E.type.kind!=="string"&&S.type.kind!=="string"&&E.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(m[3],3,De),!M)return null}return new JL(E,S,M)}evaluate(m){const _=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const E=qs(_),S=qs(v);if(E.kind!==S.kind||E.kind!=="string"&&E.kind!=="number")throw new Kr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${E.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const E=qs(_),S=qs(v);if(E.kind!=="string"||S.kind!=="string")return e(m,_,v)}return this.collator?i(m,_,v,this.collator.evaluate(m)):e(m,_,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[r];return this.eachChild((_=>{m.push(_.serialize())})),m}}}const xh=vh("==",(function(r,e,i){return e===i}),Ef),Pp=vh("!=",(function(r,e,i){return e!==i}),(function(r,e,i,a){return!Ef(0,e,i,a)})),Op=vh("<",(function(r,e,i){return e<i}),(function(r,e,i,a){return a.compare(e,i)<0})),Lp=vh(">",(function(r,e,i){return e>i}),(function(r,e,i,a){return a.compare(e,i)>0})),C_=vh("<=",(function(r,e,i){return e<=i}),(function(r,e,i,a){return a.compare(e,i)<=0})),Sf=vh(">=",(function(r,e,i){return e>=i}),(function(r,e,i,a){return a.compare(e,i)>=0}));class eu{constructor(e,i,a,h,m,_){this.type=An,this.number=e,this.locale=i,this.currency=a,this.unit=h,this.minFractionDigits=m,this.maxFractionDigits=_}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,xi);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=i.parseObjectValue(h.locale,2,"locale",An),!m))return null;let _=null;if(h.currency&&(_=i.parseObjectValue(h.currency,2,"currency",An),!_))return null;let v=null;if(h.unit&&(v=i.parseObjectValue(h.unit,2,"unit",An),!v))return null;let E=null;if(h["min-fraction-digits"]&&(E=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",xi),!E))return null;let S=null;return h["max-fraction-digits"]&&(S=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",xi),!S)?null:new eu(a,m,_,v,E,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class tu{constructor(e){this.type=xi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${on(a.type)} instead.`):new tu(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Kr(`Expected value to be of type string or array, but found ${on(qs(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function og(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const bh={"==":xh,"!=":Pp,">":Lp,"<":Op,">=":Sf,"<=":C_,array:pi,at:xf,"at-interpolated":Ru,boolean:pi,case:xd,coalesce:Qc,collator:Oo,format:fc,image:Ui,in:Mu,"index-of":bf,interpolate:Yr,"interpolate-hcl":Yr,"interpolate-lab":Yr,length:tu,let:Jc,literal:dc,match:wf,number:pi,"number-format":eu,object:pi,slice:Tf,step:Xl,string:pi,"to-boolean":pc,"to-color":pc,"to-number":pc,"to-string":pc,var:Zl,within:hh,distance:Kc,config:Au,split:wc};function Du(r,[e,i,a,h]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const m=h?h.evaluate(r):1,_=vp(e,i,a,m);if(_)throw new Kr(_);return new On(e/255,i/255,a/255,m)}function bd(r,[e,i,a,h]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const m=h?h.evaluate(r):1,_=(function(S,M,D,O){return typeof S=="number"&&S>=0&&S<=360?typeof M=="number"&&M>=0&&M<=100&&typeof D=="number"&&D>=0&&D<=100?O===void 0||typeof O=="number"&&O>=0&&O<=1?null:`Invalid hsla value [${[S,M,D,O].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof O=="number"?[S,M,D,O]:[S,M,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof O=="number"?[S,M,D,O]:[S,M,D]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,a,m);if(_)throw new Kr(_);const v=`hsla(${e}, ${i}%, ${a}%, ${m})`,E=On.parse(v);if(!E)throw new Kr(`Failed to parse HSLA color: ${v}`);return E}function Af(r,e){return r in e}function Pu(r,e){const i=e[r];return i===void 0?null:i}function xl(r){return{type:r}}function wd(r){if(r instanceof Au)return new Set([r.key]);let e=new Set;return r.eachChild((i=>{e=new Set([...e,...wd(i)])})),e}function Tc(r){if(r instanceof $o&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild((i=>{!e&&Tc(i)&&(e=!0)})),e}function Ou(r){return{result:"success",value:r}}function Ea(r){return{result:"error",value:r}}function If(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Td(r){return r["property-type"]==="data-driven"}function Ec(r){return If(r.expression,"measure-light")}function Sc(r){return If(r.expression,"zoom")}function Lu(r){return!!r.expression&&r.expression.interpolated}function Ed(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Cf(r){return r}function zu(r,e){const i=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",h=a||!(a||r.property!==void 0),m=r.type||(Lu(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map((S=>[S[0],On.parse(S[1])]))),r.default=On.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Mp[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,v,E;if(m==="exponential")_=wh;else if(m==="interval")_=iu;else if(m==="categorical"){_=R_,v=Object.create(null);for(const S of r.stops)v[S[0]]=S[1];E=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=zp}if(a){const S={},M=[];for(let N=0;N<r.stops.length;N++){const V=r.stops[N],$=V[0].zoom;S[$]===void 0&&(S[$]={zoom:$,type:r.type,property:r.property,default:r.default,stops:[]},M.push($)),S[$].stops.push([V[0].value,V[1]])}const D=[];for(const N of M)D.push([S[N].zoom,zu(S[N],e)]);const O={name:"linear"};return{kind:"composite",interpolationType:O,interpolationFactor:Yr.interpolationFactor.bind(void 0,O),zoomStops:D.map((N=>N[0])),evaluate:({zoom:N},V)=>wh({stops:D,base:r.base},e,N).evaluate(N,V)}}if(h){const S=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Yr.interpolationFactor.bind(void 0,S),zoomStops:r.stops.map((M=>M[0])),evaluate:({zoom:M})=>_(r,e,M,v,E)}}return{kind:"source",evaluate(S,M){const D=M&&M.properties?M.properties[r.property]:void 0;return D===void 0?Ac(r.default,e.default):_(r,e,D,v,E)}}}function Ac(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function R_(r,e,i,a,h){return Ac(typeof i===h?a[i]:void 0,r.default,e.default)}function iu(r,e,i){if(!dd(i))return Ac(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const h=Yc(r.stops.map((m=>m[0])),i);return r.stops[h][1]}function wh(r,e,i){const a=r.base!==void 0?r.base:1;if(!dd(i))return Ac(r.default,e.default);const h=r.stops.length;if(h===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[h-1][0])return r.stops[h-1][1];const m=Yc(r.stops.map((M=>M[0])),i),_=(function(M,D,O,N){const V=N-O,$=M-O;return V===0?0:D===1?$/V:(Math.pow(D,$)-1)/(Math.pow(D,V)-1)})(i,a,r.stops[m][0],r.stops[m+1][0]),v=r.stops[m][1],E=r.stops[m+1][1];let S=pl[e.type]||Cf;if(r.colorSpace&&r.colorSpace!=="rgb"){const M=Mp[r.colorSpace];S=(D,O)=>M.reverse(M.interpolate(M.forward(D),M.forward(O),_))}return typeof v.evaluate=="function"?{evaluate(...M){const D=v.evaluate.apply(void 0,M),O=E.evaluate.apply(void 0,M);if(D!==void 0&&O!==void 0)return S(D,O,_)}}:S(v,E,_)}function zp(r,e,i){return e.type==="color"?i=On.parse(i):e.type==="formatted"?i=ws.fromString(i.toString()):e.type==="resolvedImage"?i=fo.build(i.toString()):sh(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ac(i,r.default,e.default)}$o.register(bh,{error:[{kind:"error"},[An],(r,[e])=>{throw new Kr(e.evaluate(r))}],typeof:[An,[oe],(r,[e])=>on(qs(e.evaluate(r)))],"to-rgba":[Ti(xi,4),[z],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ti(xi,4),[z],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[z,[xi,xi,xi],Du],rgba:[z,[xi,xi,xi,xi],Du],hsl:[z,[xi,xi,xi],bd],hsla:[z,[xi,xi,xi,xi],bd],has:{type:xn,overloads:[[[An],(r,[e])=>Af(e.evaluate(r),r.properties())],[[An,Q],(r,[e,i])=>Af(e.evaluate(r),i.evaluate(r))]]},get:{type:oe,overloads:[[[An],(r,[e])=>Pu(e.evaluate(r),r.properties())],[[An,Q],(r,[e,i])=>Pu(e.evaluate(r),i.evaluate(r))]]},"feature-state":[oe,[An],(r,[e])=>Pu(e.evaluate(r),r.featureState||{})],properties:[Q,[],r=>r.properties()],"geometry-type":[An,[],r=>r.geometryType()],worldview:[An,[],r=>r.globals.worldview||""],"is-active-floor":[xn,xl(An),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const i=r.globals.activeFloors;return e.some((a=>{const h=a.evaluate(r);return i.has(h)}))}],id:[oe,[],r=>r.id()],zoom:[xi,[],r=>r.globals.zoom],pitch:[xi,[],r=>r.globals.pitch||0],"distance-from-center":[xi,[],r=>r.distanceFromCenter()],"measure-light":[xi,[An],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[xi,[],r=>r.globals.heatmapDensity||0],"line-progress":[xi,[],r=>r.globals.lineProgress||0],"raster-value":[xi,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[xi,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[xi,[],r=>r.globals.skyRadialProgress||0],accumulated:[oe,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[xi,xl(xi),(r,e)=>{let i=0;for(const a of e)i+=a.evaluate(r);return i}],"*":[xi,xl(xi),(r,e)=>{let i=1;for(const a of e)i*=a.evaluate(r);return i}],"-":{type:xi,overloads:[[[xi,xi],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[xi],(r,[e])=>-e.evaluate(r)]]},"/":[xi,[xi,xi],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[xi,[xi,xi],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[xi,[],()=>Math.LN2],pi:[xi,[],()=>Math.PI],e:[xi,[],()=>Math.E],"^":[xi,[xi,xi],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[xi,[xi],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[xi,[xi],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[xi,[xi],(r,[e])=>Math.log(e.evaluate(r))],log2:[xi,[xi],(r,[e])=>Math.log2(e.evaluate(r))],sin:[xi,[xi],(r,[e])=>Math.sin(e.evaluate(r))],cos:[xi,[xi],(r,[e])=>Math.cos(e.evaluate(r))],tan:[xi,[xi],(r,[e])=>Math.tan(e.evaluate(r))],asin:[xi,[xi],(r,[e])=>Math.asin(e.evaluate(r))],acos:[xi,[xi],(r,[e])=>Math.acos(e.evaluate(r))],atan:[xi,[xi],(r,[e])=>Math.atan(e.evaluate(r))],min:[xi,xl(xi),(r,e)=>Math.min(...e.map((i=>i.evaluate(r))))],max:[xi,xl(xi),(r,e)=>Math.max(...e.map((i=>i.evaluate(r))))],abs:[xi,[xi],(r,[e])=>Math.abs(e.evaluate(r))],round:[xi,[xi],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[xi,[xi],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[xi,[xi],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[xn,[An,oe],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[xn,[oe],(r,[e])=>r.id()===e.value],"filter-type-==":[xn,[An],(r,[e])=>r.geometryType()===e.value],"filter-<":[xn,[An,oe],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a<h}],"filter-id-<":[xn,[oe],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[xn,[An,oe],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a>h}],"filter-id->":[xn,[oe],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[xn,[An,oe],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[xn,[oe],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[xn,[An,oe],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[xn,[oe],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[xn,[oe],(r,[e])=>e.value in r.properties()],"filter-has-id":[xn,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[xn,[Ti(An)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[xn,[Ti(oe)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[xn,[An,Ti(oe)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[xn,[An,Ti(oe)],(r,[e,i])=>(function(a,h,m,_){for(;m<=_;){const v=m+_>>1;if(h[v]===a)return!0;h[v]>a?_=v-1:m=v+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:xn,overloads:[[[xn,xn],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[xl(xn),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:xn,overloads:[[[xn,xn],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[xl(xn),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[xn,[xn],(r,[e])=>!e.evaluate(r)],"is-supported-script":[xn,[An],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[An,[An],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[An,[An],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[An,xl(oe),(r,e)=>e.map((i=>ql(i.evaluate(r)))).join("")],"resolved-locale":[An,[De],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[xi,[xi,xi,oe],(r,e)=>{const[i,a,h]=e.map((_=>_.evaluate(r)));if(i>a||i===a)return i;let m;if(typeof h=="string")m=(function(_){let v=0;if(_.length===0)return v;for(let E=0;E<_.length;E++)v=(v<<5)-v+_.charCodeAt(E),v|=0;return v})(h);else{if(typeof h!="number")throw new Kr(`Invalid seed input: ${h}`);m=h}return i+og(m)()*(a-i)}]});class Rf{constructor(e,i,a,h,m){this.expression=e,this._warningHistory={},this._scope=a,this._options=h,this._iconImageUseTheme=m,this._evaluator=new po(a,h,m),this._defaultValue=i?(function(_){return _.type==="color"&&(Ed(_.default)||Array.isArray(_.default))?new On(0,0,0,0):_.type==="color"?On.parse(_.default)||null:_.default===void 0?null:_.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=wd(e),this.isIndoorDependent=Tc(e)}evaluateWithoutErrorHandling(e,i,a,h,m,_,v,E){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,h,m,_,v,E,S){this._evaluator||(this._evaluator=new po(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=S||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Kr(`Expected value to be one of ${Object.keys(this._enumValues).map((D=>JSON.stringify(D))).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function Sd(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in bh}function bl(r,e,i,a,h){const m=new gf(bh,[],e?(function(v){const E={color:z,string:An,number:xi,enum:An,boolean:xn,formatted:Rt,resolvedImage:qt};return v.type==="array"?Ti(E[v.value]||oe,v.length):E[v.type]})(e):void 0,void 0,void 0,i,a,h),_=m.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Ou(new Rf(_,e,i,a,h)):Ea(m.errors)}class Zo{constructor(e,i,a,h){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!ro(i.expression),this.configDependencies=wd(i.expression),this.isIndoorDependent=Tc(i.expression)}evaluateWithoutErrorHandling(e,i,a,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,h,m,_)}evaluate(e,i,a,h,m,_,v){return this._styleExpression.evaluate(e,i,a,h,m,_,void 0,void 0,v)}}class To{constructor(e,i,a,h,m,_){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!ro(i.expression),this.isIndoorDependent=Tc(i.expression),this.isLightConstant=m,this.isLineProgressConstant=_,this.configDependencies=wd(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,a,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,h,m,_)}evaluate(e,i,a,h,m,_){return this._styleExpression.evaluate(e,i,a,h,m,_)}interpolationFactor(e,i,a){return this.interpolationType?Yr.interpolationFactor(this.interpolationType,e,i,a):0}}function Ic(r,e,i,a,h){if((r=bl(r,e,i,a,h)).result==="error")return r;const m=r.value.expression,_=gh(m);if(!_&&!Td(e))return Ea([new ba("","data expressions not supported")]);const v=os(m,["zoom","pitch","distance-from-center"]);if(!v&&!Sc(e))return Ea([new ba("","zoom expressions not supported")]);const E=os(m,["measure-light"]);if(!E&&!Ec(e))return Ea([new ba("","measure-light expression not supported")]);const S=os(m,["line-progress"]);if(!S&&!(function(O){return If(O.expression,"line-progress")})(e))return Ea([new ba("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,D=Mf(m);return D||v||M?D instanceof ba?Ea([D]):D instanceof Yr&&!Lu(e)?Ea([new ba("",'"interpolate" expressions cannot be used with this property')]):Ou(D?new To(_&&S?"camera":"composite",r.value,D.labels,D instanceof Yr?D.interpolation:void 0,E,S):new Zo(_&&S?"constant":"source",r.value,E,S)):Ea([new ba("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ad{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,zu(this._parameters,this._specification))}static deserialize(e){return new Ad(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Mf(r){let e=null;if(r instanceof Jc)e=Mf(r.result);else if(r instanceof Qc){for(const i of r.args)if(e=Mf(i),e)break}else(r instanceof Xl||r instanceof Yr)&&r.input instanceof $o&&r.input.name==="zoom"&&(e=r);return e instanceof ba||r.eachChild((i=>{const a=Mf(i);a instanceof ba?e=a:e&&a&&e!==a&&(e=new ba("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var wl,oa,Hs=(function(){if(oa)return wl;oa=1,wl=e;var r=3;function e(i,a,h){var m=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var _=new Int32Array(this.arrayBuffer);i=_[0],this.d=(a=_[1])+2*(h=_[2]);for(var v=0;v<this.d*this.d;v++){var E=_[r+v],S=_[r+v+1];m.push(E===S?null:_.subarray(E,S))}var M=_[r+m.length+1];this.keys=_.subarray(_[r+m.length],M),this.bboxes=_.subarray(M),this.insert=this._insertReadonly}else{this.d=a+2*h;for(var D=0;D<this.d*this.d;D++)m.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=h,this.scale=a/i,this.uid=0;var O=h/a*i;this.min=-O,this.max=i+O}return e.prototype.insert=function(i,a,h,m,_){this._forEachCell(a,h,m,_,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,h,m,_,v){this.cells[_].push(v)},e.prototype.query=function(i,a,h,m,_){var v=this.min,E=this.max;if(i<=v&&a<=v&&E<=h&&E<=m&&!_)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(i,a,h,m,this._queryCell,S,{},_),S},e.prototype._queryCell=function(i,a,h,m,_,v,E,S){var M=this.cells[_];if(M!==null)for(var D=this.keys,O=this.bboxes,N=0;N<M.length;N++){var V=M[N];if(E[V]===void 0){var $=4*V;(S?S(O[$+0],O[$+1],O[$+2],O[$+3]):i<=O[$+2]&&a<=O[$+3]&&h>=O[$+0]&&m>=O[$+1])?(E[V]=!0,v.push(D[V])):E[V]=!1}}},e.prototype._forEachCell=function(i,a,h,m,_,v,E,S){for(var M=this._convertToCellCoord(i),D=this._convertToCellCoord(a),O=this._convertToCellCoord(h),N=this._convertToCellCoord(m),V=M;V<=O;V++)for(var $=D;$<=N;$++){var Z=this.d*$+V;if((!S||S(this._convertFromCellCoord(V),this._convertFromCellCoord($),this._convertFromCellCoord(V+1),this._convertFromCellCoord($+1)))&&_.call(this,i,a,h,m,Z,v,E,S))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=r+this.cells.length+1+1,h=0,m=0;m<this.cells.length;m++)h+=this.cells[m].length;var _=new Int32Array(a+h+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=a,E=0;E<i.length;E++){var S=i[E];_[r+E]=v,_.set(S,v),v+=S.length}return _[r+i.length]=v,_.set(this.keys,v),_[r+i.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},wl})(),Cc=ih(Hs);const Fa={};function Lt(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Fa[e]={klass:r,omit:i.omit||[]}}Lt(Object,"Object"),Cc.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},Cc.deserialize=function(r){return new Cc(r.buffer)},Object.defineProperty(Cc,"name",{value:"Grid"}),Lt(Cc,"Grid"),delete St.prototype.constructor,typeof DOMMatrix<"u"&&Lt(DOMMatrix,"DOMMatrix"),Lt(On,"Color"),Lt(Error,"Error"),Lt(ws,"Formatted"),Lt(wa,"FormattedSection"),Lt(Po,"AJAXError"),Lt(fo,"ResolvedImage"),Lt(Ad,"StylePropertyFunction"),Lt(Rf,"StyleExpression",{omit:["_evaluator"]}),Lt(Ss,"ImageId"),Lt(Oa,"ImageVariant"),Lt(To,"ZoomDependentExpression"),Lt(Zo,"ZoomConstantExpression"),Lt($o,"CompoundExpression",{omit:["_evaluate"]});for(const r in bh)Fa[bh[r]._classRegistryKey]||Lt(bh[r],`Expression${r}`);function as(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function _s(r){return self.ImageBitmap&&r instanceof ImageBitmap}function Kl(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(as(r)||_s(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(Kl(a,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[a,h]of r.entries())i.entries.push(Kl(a),Kl(h,e));return i}if(r instanceof Set){const i={$name:"Set"};let a=0;for(const h of r.values())i[++a]=Kl(h);return i}if(r instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of a)i[h]=r[h];return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const m in r)r.hasOwnProperty(m)&&(Fa[a].omit.indexOf(m)>=0||(h[m]=Kl(r[m],e)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof r)}function Ja(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||as(r)||_s(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Ja);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const h=r.entries||[],m=new Map;for(let _=0;_<h.length;_+=2)m.set(Ja(h[_]),Ja(h[_+1]));return m}if(e==="Set"){const h=new Set;for(const m of Object.keys(r))m!=="$name"&&h.add(Ja(r[m]));return h}if(e==="DOMMatrix"){let h;return h=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(r.value);const{klass:i}=Fa[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const h of Object.keys(r))h!=="$name"&&(a[h]=Ja(r[h]));return a}throw new Error("can't deserialize object of type "+typeof r)}const Ai={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Id(r){for(const e of r)if(kp(e.charCodeAt(0)))return!0;return!1}function Cd(r){for(const e of r)if(!nu(e.charCodeAt(0)))return!1;return!0}function nu(r){return!(Ai.Arabic(r)||Ai["Arabic Supplement"](r)||Ai["Arabic Extended-A"](r)||Ai["Arabic Presentation Forms-A"](r)||Ai["Arabic Presentation Forms-B"](r))}function kp(r){return!(r!==746&&r!==747&&(r<4352||!(Ai["Bopomofo Extended"](r)||Ai.Bopomofo(r)||Ai["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ai["CJK Compatibility Ideographs"](r)||Ai["CJK Compatibility"](r)||Ai["CJK Radicals Supplement"](r)||Ai["CJK Strokes"](r)||!(!Ai["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ai["CJK Unified Ideographs Extension A"](r)||Ai["CJK Unified Ideographs"](r)||Ai["Enclosed CJK Letters and Months"](r)||Ai["Hangul Compatibility Jamo"](r)||Ai["Hangul Jamo Extended-A"](r)||Ai["Hangul Jamo Extended-B"](r)||Ai["Hangul Jamo"](r)||Ai["Hangul Syllables"](r)||Ai.Hiragana(r)||Ai["Ideographic Description Characters"](r)||Ai.Kanbun(r)||Ai["Kangxi Radicals"](r)||Ai["Katakana Phonetic Extensions"](r)||Ai.Katakana(r)&&r!==12540||!(!Ai["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ai["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ai["Unified Canadian Aboriginal Syllabics"](r)||Ai["Unified Canadian Aboriginal Syllabics Extended"](r)||Ai["Vertical Forms"](r)||Ai["Yijing Hexagram Symbols"](r)||Ai["Yi Syllables"](r)||Ai["Yi Radicals"](r))))}function Os(r){return!(kp(r)||(function(e){return!!(Ai["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ai["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ai["Letterlike Symbols"](e)||Ai["Number Forms"](e)||Ai["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ai["Control Pictures"](e)&&e!==9251||Ai["Optical Character Recognition"](e)||Ai["Enclosed Alphanumerics"](e)||Ai["Geometric Shapes"](e)||Ai["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ai["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ai["CJK Symbols and Punctuation"](e)||Ai.Katakana(e)||Ai["Private Use Area"](e)||Ai["CJK Compatibility Forms"](e)||Ai["Small Form Variants"](e)||Ai["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function Df(r){return Ai.Arabic(r)||Ai["Arabic Supplement"](r)||Ai["Arabic Extended-A"](r)||Ai["Arabic Presentation Forms-A"](r)||Ai["Arabic Presentation Forms-B"](r)}function Fp(r){return r>=1424&&r<=2303||Ai["Arabic Presentation Forms-A"](r)||Ai["Arabic Presentation Forms-B"](r)}function M_(r,e){return!(!e&&Fp(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ai.Khmer(r))}function D_(r){for(const e of r)if(Fp(e.charCodeAt(0)))return!0;return!1}const Ba={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Pf=null,Lo=Ba.unavailable,Rc=null;const aa=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Lo=Ba.error),Pf&&Pf(r)};function ks(){Rd.fire(new Gs("pluginStateChange",{pluginStatus:Lo,pluginURL:Rc}))}const Rd=new fl,Th=function(){return Lo},Md=function(){if(Lo!==Ba.deferred||!Rc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Lo=Ba.loading,ks(),Rc&&va({url:Rc},(r=>{r?aa(r):(Lo=Ba.loaded,ks())}))},la={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Lo===Ba.loaded||la.applyArabicShaping!=null,isLoading:()=>Lo===Ba.loading,setState(r){Lo=r.pluginStatus,Rc=r.pluginURL},isParsing:()=>Lo===Ba.parsing,isParsed:()=>Lo===Ba.parsed,getPluginURL:()=>Rc};class Yn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,a){for(const h of i)if(!M_(h.charCodeAt(0),a))return!1;return!0})(e,la.isLoaded())}}class ku{constructor(e,i,a,h,m){this.property=e,this.value=i,this.expression=(function(_,v,E,S,M){if(Ed(_))return new Ad(_,v);if(Sd(_)||Array.isArray(_)&&_.length>0){const D=Ic(_,v,E,S,M);if(D.result==="error")throw new Error(D.value.map((O=>`${O.key}: ${O.message}`)).join(", "));return D.value}{let D=_;return typeof _=="string"&&v.type==="color"&&(D=On.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>D}}})(i===void 0?e.specification.default:i,e.specification,a,h,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a,h){return this.property.possiblyEvaluate(this,e,i,a,h)}}class Fu{constructor(e,i,a,h){this.property=e,this.value=new ku(e,void 0,i,a,h)}transitioned(e,i){return new ag(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new ag(this.property,this.value,null,{},0)}}class Bp{constructor(e,i,a,h){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return ui(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Fu(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new ku(this._values[e].property,i===null?void 0:ui(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const h in e){const m=e[h];if(h.endsWith("-transition")){const _=h.slice(0,-11);a[_]&&this.setTransition(_,m)}else a.hasOwnProperty(h)&&this.setValue(h,m)}}getTransition(e){return ui(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Fu(this._values[e].property)),this._values[e].transition=ui(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const a=new Mc(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,i._values[h]);return a}untransitioned(){const e=new Mc(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class ag{constructor(e,i,a,h,m){const _=h.delay||0,v=h.duration||0;m=m||0,this.property=e,this.value=i,this.begin=m+_,this.end=this.begin+v,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const h=e.now||0,m=this.value.possiblyEvaluate(e,i,a),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(e,i,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,a),m,_u(v))}}return m}}class Mc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const h=new Bu(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,i,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Np{constructor(e,i,a,h){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=h,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return ui(this._values[e].value)}setValue(e,i){this._values[e]=new ku(this._values[e].property,i===null?void 0:ui(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a,h){const m=new Bu(this._properties);for(const _ of Object.keys(this._values))m._values[_]=this._values[_].possiblyEvaluate(e,i,a,h);return m}isIndoorDependent(){return this._isIndoorDependent}}class el{constructor(e,i,a,h){this.property=e,this.value=i,this.parameters=a,this.iconImageUseTheme=h}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,h){return this.property.evaluate(this.value,this.parameters,e,i,a,h,this.iconImageUseTheme)}}class Bu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class kt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const h=pl[this.specification.type];return h?h(e,i,a):e}}class ti{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,h,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new el(this,{kind:"constant",value:e.expression.evaluate(i,null,{},a,h,void 0,m)},i):new el(this,e.expression,i,m)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new el(this,{kind:"constant",value:void 0},e.parameters);const h=pl[this.specification.type];return h?new el(this,{kind:"constant",value:h(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,h,m,_,v){return e.kind==="constant"?e.value:e.evaluate(i,a,h,m,_,void 0,v)}}class Eh{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,h){return!!e.expression.evaluate(i,null,{},a,h)}interpolate(){return!1}}class rs{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Yn(0,{});for(const a in e){const h=e[a];h.specification.overridable&&this.overridableProperties.push(a);const m=this.defaultPropertyValues[a]=new ku(h,void 0),_=this.defaultTransitionablePropertyValues[a]=new Fu(h);this.defaultTransitioningPropertyValues[a]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate(i)}}}Lt(ti,"DataDrivenProperty"),Lt(kt,"DataConstantProperty"),Lt(Eh,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Vp(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Sh(r){if(Array.isArray(r))return r.map(Sh);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Sh(r[i]);return e}return Vp(r)}function Nu(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Nu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Of(r,e="",i=null,a="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Nu(r)||(r=zo(r));const h=r;let m=!0;try{m=(function(M){if(!Ih(M))return M;let D=Sh(M);return Ah(D),D=Lf(D),D})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let _=null,v=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){v=Ue[`filter_${a}`];const M=bl(m,v,e,i);if(M.result==="error")throw new Error(M.value.map((D=>`${D.key}: ${D.message}`)).join(", "));_=(D,O,N)=>M.value.evaluate(D,O,{},N)}let E=null,S=null;if(m!==h){const M=bl(h,v,e,i);if(M.result==="error")throw new Error(M.value.map((D=>`${D.key}: ${D.message}`)).join(", "));E=(D,O,N,V,$)=>M.value.evaluate(D,O,{},N,void 0,void 0,V,$),S=!gh(M.value.expression)}return{filter:_,dynamicFilter:E||void 0,needGeometry:lg(m),needFeature:!!S}}function Lf(r){if(!Array.isArray(r))return r;const e=(function(i){if(P_.has(i[0])){for(let a=1;a<i.length;a++)if(Ih(i[a]))return!0}return i})(r);return e===!0?e:e.map((i=>Lf(i)))}function Ah(r){let e=!1;const i=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)e=e||Ih(r[a]),i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Ih(r[1]);for(let a=2;a<r.length-1;a+=2)i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Ih(r[1]);for(let a=1;a<r.length-1;a+=2)i.push(r[a+1])}e&&(r.length=0,r.push("any",...i));for(let a=1;a<r.length;a++)Ah(r[a])}function Ih(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Ih(r[i]))return!0;return!1}const P_=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function O_(r,e){return r<e?-1:r>e?1:0}function lg(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(lg(r[e]))return!0;return!1}function zo(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Up(r[1],r[2],"=="):e==="!="?kf(Up(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Up(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(zo))):e==="all"?["all"].concat(r.slice(1).map(zo)):e==="none"?["all"].concat(r.slice(1).map(zo).map(kf)):e==="in"?Dd(r[1],r.slice(2)):e==="!in"?kf(Dd(r[1],r.slice(2))):e==="has"?zf(r[1]):e!=="!has"||kf(zf(r[1]));var i}function Up(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Dd(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(O_)]]:["filter-in-small",r,["literal",e]]}}function zf(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function kf(r){return["!",r]}const Ch="";function Rh(r,e){return e?`${r}${Ch}${e}`:r}let cg;const ug=()=>cg||(cg=new rs({"icon-size":new ti(Ue.layout_symbol["icon-size"]),"icon-image":new ti(Ue.layout_symbol["icon-image"]),"icon-rotate":new ti(Ue.layout_symbol["icon-rotate"]),"icon-offset":new ti(Ue.layout_symbol["icon-offset"])}));class L_{constructor(e,i,a,h,m,_){this.cachedIconPrimary=null;const v=bl(e,Ue.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=i,a){this.properties=new Bu(ug()),this.unevaluatedLayout=new Np(ug(),h,m,_);for(const E in a)this.unevaluatedLayout.setValue(E,a[E])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,i,a){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,a))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const hg="-transition",z_=new Set(["fill","line","background","hillshade","raster"]);class Eo extends fl{constructor(e,i,a,h,m,_){if(super(),this.id=e.id,this.fqid=Rh(this.id,a),this.type=e.type,this.scope=a,this.lut=h,this.options=m,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=bl(this.filter,Ue[`filter_${e.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Np(i.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Bp(i.paint,this.scope,m);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bu(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&z_.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((i=>{this.appearances.push(new L_(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(hg)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const a=this._transitionablePaint,h=a._properties.properties;if(e.endsWith(hg)){const D=e.slice(0,-11);return h[D]&&a.setTransition(D,i||void 0),!1}if(!h[e])return!1;const m=a._values[e],_=m.value.isDataDriven(),v=m.value;a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const E=a._values[e].value,S=E.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return S||_||M||this._handleOverridablePaintPropertyUpdate(e,v,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),xt(e,((i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof el&&Td(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!ro(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Of(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,a){return{}}queryRadius(e){}queryIntersectsFeature(e,i,a,h,m,_,v,E,S){}}const k_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pd{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Tr{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function hn(r,e=1){let i=0,a=0;return{members:r.map((h=>{const m=k_[h.type].BYTES_PER_ELEMENT,_=i=jp(i,Math.max(e,m)),v=h.components||1;return a=Math.max(a,m),i+=m*v,{name:h.name,type:h.type,components:v,offset:_}})),size:jp(i,Math.max(a,e)),alignment:e}}function jp(r,e){return Math.ceil(r/e)*e}class Sa extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=a,e}}Sa.prototype.bytesPerElement=4,Lt(Sa,"StructArrayLayout2i4");class ru extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=h,e}}ru.prototype.bytesPerElement=6,Lt(ru,"StructArrayLayout3i6");class Mh extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h)}emplace(e,i,a,h,m){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=a,this.int16[_+2]=h,this.int16[_+3]=m,e}}Mh.prototype.bytesPerElement=8,Lt(Mh,"StructArrayLayout4i8");class Dc extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Dc.prototype.bytesPerElement=4,Lt(Dc,"StructArrayLayout1f4");class Ff extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const m=4*e,_=2*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.float32[_+1]=h,e}}Ff.prototype.bytesPerElement=8,Lt(Ff,"StructArrayLayout2i1f8");class Gp extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=h,e}}Gp.prototype.bytesPerElement=8,Lt(Gp,"StructArrayLayout3i8");class Bf extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,m)}emplace(e,i,a,h,m,_){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=a,this.int16[v+2]=h,this.int16[v+3]=m,this.int16[v+4]=_,e}}Bf.prototype.bytesPerElement=10,Lt(Bf,"StructArrayLayout5i10");class qp extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,m,_,v)}emplace(e,i,a,h,m,_,v,E){const S=6*e,M=12*e,D=3*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.uint8[M+4]=h,this.uint8[M+5]=m,this.uint8[M+6]=_,this.uint8[M+7]=v,this.float32[D+2]=E,e}}qp.prototype.bytesPerElement=12,Lt(qp,"StructArrayLayout2i4ub1f12");class tl extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=h,e}}tl.prototype.bytesPerElement=12,Lt(tl,"StructArrayLayout3f12");class su extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,m)}emplace(e,i,a,h,m,_){const v=6*e,E=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=a,this.uint16[v+2]=h,this.uint16[v+3]=m,this.float32[E+2]=_,e}}su.prototype.bytesPerElement=12,Lt(su,"StructArrayLayout4ui1f12");class Yl extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h)}emplace(e,i,a,h,m){const _=4*e;return this.uint16[_+0]=i,this.uint16[_+1]=a,this.uint16[_+2]=h,this.uint16[_+3]=m,e}}Yl.prototype.bytesPerElement=8,Lt(Yl,"StructArrayLayout4ui8");class Od extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,h,m,_)}emplace(e,i,a,h,m,_,v){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=h,this.int16[E+3]=m,this.int16[E+4]=_,this.int16[E+5]=v,e}}Od.prototype.bytesPerElement=12,Lt(Od,"StructArrayLayout6i12");class Dh extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v,E,S,M,D,O){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,a,h,m,_,v,E,S,M,D,O)}emplace(e,i,a,h,m,_,v,E,S,M,D,O,N){const V=12*e;return this.int16[V+0]=i,this.int16[V+1]=a,this.int16[V+2]=h,this.int16[V+3]=m,this.uint16[V+4]=_,this.uint16[V+5]=v,this.uint16[V+6]=E,this.uint16[V+7]=S,this.int16[V+8]=M,this.int16[V+9]=D,this.int16[V+10]=O,this.int16[V+11]=N,e}}Dh.prototype.bytesPerElement=24,Lt(Dh,"StructArrayLayout4i4ui4i24");class Ph extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,h,m,_)}emplace(e,i,a,h,m,_,v){const E=10*e,S=5*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=h,this.float32[S+2]=m,this.float32[S+3]=_,this.float32[S+4]=v,e}}Ph.prototype.bytesPerElement=20,Lt(Ph,"StructArrayLayout3i3f20");class ou extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h)}emplace(e,i,a,h,m){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=h,this.float32[_+3]=m,e}}ou.prototype.bytesPerElement=16,Lt(ou,"StructArrayLayout4f16");class Oh extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Oh.prototype.bytesPerElement=4,Lt(Oh,"StructArrayLayout1ul4");class il extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=a,e}}il.prototype.bytesPerElement=4,Lt(il,"StructArrayLayout2ui4");class Nf extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v,E,S,M,D,O,N){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,a,h,m,_,v,E,S,M,D,O,N)}emplace(e,i,a,h,m,_,v,E,S,M,D,O,N,V){const $=20*e,Z=10*e;return this.int16[$+0]=i,this.int16[$+1]=a,this.int16[$+2]=h,this.int16[$+3]=m,this.int16[$+4]=_,this.float32[Z+3]=v,this.float32[Z+4]=E,this.float32[Z+5]=S,this.float32[Z+6]=M,this.int16[$+14]=D,this.uint32[Z+8]=O,this.uint16[$+18]=N,this.uint16[$+19]=V,e}}Nf.prototype.bytesPerElement=40,Lt(Nf,"StructArrayLayout5i4f1i1ul2ui40");class Vf extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,m,_,v)}emplace(e,i,a,h,m,_,v,E){const S=8*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+4]=m,this.int16[S+5]=_,this.int16[S+6]=v,this.int16[S+7]=E,e}}Vf.prototype.bytesPerElement=16,Lt(Vf,"StructArrayLayout3i2i2i16");class Vu extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,m)}emplace(e,i,a,h,m,_){const v=4*e,E=8*e;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[E+6]=m,this.int16[E+7]=_,e}}Vu.prototype.bytesPerElement=16,Lt(Vu,"StructArrayLayout2f1f2i16");class Uu extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,h,m,_)}emplace(e,i,a,h,m,_,v){const E=20*e,S=5*e;return this.uint8[E+0]=i,this.uint8[E+1]=a,this.float32[S+1]=h,this.float32[S+2]=m,this.float32[S+3]=_,this.float32[S+4]=v,e}}Uu.prototype.bytesPerElement=20,Lt(Uu,"StructArrayLayout2ub4f20");class Cr extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=h,e}}Cr.prototype.bytesPerElement=6,Lt(Cr,"StructArrayLayout3ui6");class Lh extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne,ae,ue,Te){const _e=this.length;return this.resize(_e+1),this.emplace(_e,e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne,ae,ue,Te)}emplace(e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne,ae,ue,Te,_e){const Ie=30*e,Me=15*e,Le=60*e;return this.int16[Ie+0]=i,this.int16[Ie+1]=a,this.int16[Ie+2]=h,this.float32[Me+2]=m,this.float32[Me+3]=_,this.uint16[Ie+8]=v,this.uint16[Ie+9]=E,this.uint32[Me+5]=S,this.uint32[Me+6]=M,this.uint32[Me+7]=D,this.uint16[Ie+16]=O,this.uint16[Ie+17]=N,this.uint16[Ie+18]=V,this.float32[Me+10]=$,this.float32[Me+11]=Z,this.uint8[Le+48]=K,this.uint8[Le+49]=ne,this.uint8[Le+50]=ae,this.uint32[Me+13]=ue,this.int16[Ie+28]=Te,this.uint8[Le+58]=_e,e}}Lh.prototype.bytesPerElement=60,Lt(Lh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class au extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne,ae,ue,Te,_e,Ie,Me,Le,at,Ge,ut,gt,Et,jt,Dt,vt){const Mt=this.length;return this.resize(Mt+1),this.emplace(Mt,e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne,ae,ue,Te,_e,Ie,Me,Le,at,Ge,ut,gt,Et,jt,Dt,vt)}emplace(e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne,ae,ue,Te,_e,Ie,Me,Le,at,Ge,ut,gt,Et,jt,Dt,vt,Mt){const ot=20*e,et=40*e,It=80*e;return this.float32[ot+0]=i,this.float32[ot+1]=a,this.int16[et+4]=h,this.int16[et+5]=m,this.int16[et+6]=_,this.int16[et+7]=v,this.int16[et+8]=E,this.int16[et+9]=S,this.int16[et+10]=M,this.int16[et+11]=D,this.int16[et+12]=O,this.uint16[et+13]=N,this.uint16[et+14]=V,this.uint16[et+15]=$,this.uint16[et+16]=Z,this.uint16[et+17]=K,this.uint16[et+18]=ne,this.uint16[et+19]=ae,this.uint16[et+20]=ue,this.uint16[et+21]=Te,this.uint16[et+22]=_e,this.uint16[et+23]=Ie,this.uint16[et+24]=Me,this.uint16[et+25]=Le,this.uint16[et+26]=at,this.uint16[et+27]=Ge,this.uint32[ot+14]=ut,this.float32[ot+15]=gt,this.float32[ot+16]=Et,this.float32[ot+17]=jt,this.float32[ot+18]=Dt,this.uint8[It+76]=vt,this.uint16[et+39]=Mt,e}}au.prototype.bytesPerElement=80,Lt(au,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Hp extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,a,h,m,_)}emplace(e,i,a,h,m,_,v){const E=6*e;return this.float32[E+0]=i,this.float32[E+1]=a,this.float32[E+2]=h,this.float32[E+3]=m,this.float32[E+4]=_,this.float32[E+5]=v,e}}Hp.prototype.bytesPerElement=24,Lt(Hp,"StructArrayLayout6f24");class ju extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,h,m)}emplace(e,i,a,h,m,_){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=a,this.float32[v+2]=h,this.float32[v+3]=m,this.float32[v+4]=_,e}}ju.prototype.bytesPerElement=20,Lt(ju,"StructArrayLayout5f20");class $p extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,m,_,v)}emplace(e,i,a,h,m,_,v,E){const S=7*e;return this.float32[S+0]=i,this.float32[S+1]=a,this.float32[S+2]=h,this.float32[S+3]=m,this.float32[S+4]=_,this.float32[S+5]=v,this.float32[S+6]=E,e}}$p.prototype.bytesPerElement=28,Lt($p,"StructArrayLayout7f28");class Gu extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v,E,S,M,D){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,a,h,m,_,v,E,S,M,D)}emplace(e,i,a,h,m,_,v,E,S,M,D,O){const N=11*e;return this.float32[N+0]=i,this.float32[N+1]=a,this.float32[N+2]=h,this.float32[N+3]=m,this.float32[N+4]=_,this.float32[N+5]=v,this.float32[N+6]=E,this.float32[N+7]=S,this.float32[N+8]=M,this.float32[N+9]=D,this.float32[N+10]=O,e}}Gu.prototype.bytesPerElement=44,Lt(Gu,"StructArrayLayout11f44");class Wp extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v,E,S){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,h,m,_,v,E,S)}emplace(e,i,a,h,m,_,v,E,S,M){const D=9*e;return this.float32[D+0]=i,this.float32[D+1]=a,this.float32[D+2]=h,this.float32[D+3]=m,this.float32[D+4]=_,this.float32[D+5]=v,this.float32[D+6]=E,this.float32[D+7]=S,this.float32[D+8]=M,e}}Wp.prototype.bytesPerElement=36,Lt(Wp,"StructArrayLayout9f36");class Pc extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=a,e}}Pc.prototype.bytesPerElement=8,Lt(Pc,"StructArrayLayout2f8");class Zp extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h)}emplace(e,i,a,h,m){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=a,this.uint16[_+3]=h,this.uint16[_+4]=m,e}}Zp.prototype.bytesPerElement=12,Lt(Zp,"StructArrayLayout1ul3ui12");class Uf extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Uf.prototype.bytesPerElement=2,Lt(Uf,"StructArrayLayout1ui2");class Xp extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z){const K=this.length;return this.resize(K+1),this.emplace(K,e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z)}emplace(e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K){const ne=16*e;return this.float32[ne+0]=i,this.float32[ne+1]=a,this.float32[ne+2]=h,this.float32[ne+3]=m,this.float32[ne+4]=_,this.float32[ne+5]=v,this.float32[ne+6]=E,this.float32[ne+7]=S,this.float32[ne+8]=M,this.float32[ne+9]=D,this.float32[ne+10]=O,this.float32[ne+11]=N,this.float32[ne+12]=V,this.float32[ne+13]=$,this.float32[ne+14]=Z,this.float32[ne+15]=K,e}}Xp.prototype.bytesPerElement=64,Lt(Xp,"StructArrayLayout16f64");class qu extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,m,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,a,h,m,_,v)}emplace(e,i,a,h,m,_,v,E){const S=10*e,M=5*e;return this.uint16[S+0]=i,this.uint16[S+1]=a,this.uint16[S+2]=h,this.uint16[S+3]=m,this.float32[M+2]=_,this.float32[M+3]=v,this.float32[M+4]=E,e}}qu.prototype.bytesPerElement=20,Lt(qu,"StructArrayLayout4ui3f20");class $s extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}$s.prototype.bytesPerElement=2,Lt($s,"StructArrayLayout1i2");class mo extends Tr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}mo.prototype.bytesPerElement=1,Lt(mo,"StructArrayLayout1ub1");class Kp extends Pd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Kp.prototype.size=40;class dg extends Nf{get(e){return new Kp(this,e)}}Lt(dg,"CollisionBoxArray");class jf extends Pd{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}jf.prototype.size=60;class Ld extends Lh{get(e){return new jf(this,e)}}Lt(Ld,"PlacedSymbolArray");class zh extends Pd{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}zh.prototype.size=80;class fg extends au{get(e){return new zh(this,e)}}Lt(fg,"SymbolInstanceArray");class zd extends Dc{getoffsetX(e){return this.float32[1*e+0]}}Lt(zd,"GlyphOffsetArray");class pg extends Sa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Lt(pg,"SymbolLineVertexArray");class Yp extends Pd{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Yp.prototype.size=12;class Gf extends Zp{get(e){return new Yp(this,e)}}Lt(Gf,"FeatureIndexArray");class Qp extends il{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Lt(Qp,"FillExtrusionCentroidArray");class mg extends Pd{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}mg.prototype.size=6;class gg extends ru{get(e){return new mg(this,e)}}Lt(gg,"FillExtrusionWallArray");const _g=hn([{name:"a_pos",components:2,type:"Int16"}],4),yg=hn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),vg=hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Lr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,h){let m=this.segments[this.segments.length-1];return e>Lr.MAX_VERTEX_ARRAY_LENGTH&&gi(`Max vertices per segment is ${Lr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Lr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}prepareSegment(e,i,a,h){return this._prepareSegment(e,i.length,a.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,h){return new Lr([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function xg(r,e){return 256*(r=J(Math.floor(r),0,255))+J(Math.floor(e),0,255)}Lr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Lt(Lr,"SegmentVector");const bg=hn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Jp=hn([{name:"a_pattern_b",components:4,type:"Uint16"}]),wg=hn([{name:"a_dash",components:4,type:"Uint16"}]);class kd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,h){this.ids.push(kh(e)),this.positions.push(i,a,h)}eachPosition(e,i){const a=kh(e);let h=0,m=this.ids.length-1;for(;h<m;){const _=h+m>>1;this.ids[_]>=a?m=_:h=_+1}for(;this.ids[h]===a;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return em(a,h,0,a.length-1),i&&(i.add(a.buffer),i.add(h.buffer)),{ids:a,positions:h}}static deserialize(e){const i=new kd;let a;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==a&&i.uniqueIds.push(h),a=h;return i.indexed=!0,i}}function kh(r){const e=+r;return Number.isSafeInteger(e)?e:cc(String(r))}function em(r,e,i,a){for(;i<a;){const h=r[i+a>>1];let m=i-1,_=a+1;for(;;){do m++;while(r[m]<h);do _--;while(r[_]>h);if(m>=_)break;Tl(r,m,_),Tl(e,3*m,3*_),Tl(e,3*m+1,3*_+1),Tl(e,3*m+2,3*_+2)}_-i<a-_?(em(r,e,i,_),i=_+1):(em(r,e,_+1,a),a=_)}}function Tl(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}Lt(kd,"FeaturePositionMap");class Na{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class tm extends Na{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class ys extends Na{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ko extends Na{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Hu extends Na{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Fd extends Na{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Bd extends Na{constructor(e){super(e),this.current=On.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Nd=new Float32Array(16);class fs extends Na{constructor(e){super(e),this.current=Nd}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let h=1;h<16;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const sv=new Float32Array(9),F_=new Float32Array(4);class im extends Na{constructor(e){super(e),this.current=F_}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Fh(r){return[xg(255*r.r,255*r.g),xg(255*r.b,255*r.a)]}function Ql(r,e,i,a,h,m,_,v){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Yn(0,{brightness:m,worldview:v}),e,i,h,a,_)==="none":r.value==="none")}class qf{constructor(e,i,a,h){this.value=e,this.uniformNames=i.map((m=>`u_${m}`)),this.type=a,this.context=h}setUniform(e,i,a,h,m){const _=h.constantOr(this.value);i.set(e,m,_ instanceof On?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,i){return this.type==="color"?new Bd(e):new ys(e)}}class Vd{constructor(e,i){this.uniformNames=i.map((a=>`u_${a}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,h,m){let _=null;m!=="u_pattern"&&m!=="u_dash"||(_=this.pattern),m==="u_pattern_b"&&(_=this.patternTransition),m==="u_pixel_ratio"&&(_=this.pixelRatio),_&&i.set(e,m,_)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Fd(e):new ys(e)}}class nl{constructor(e,i,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map((m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,i,a,h,m,_,v,E){const S=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Yn(0,{brightness:_,worldview:E}),i,{},m,h,v):this.expression.kind==="constant"&&this.expression.value,D=Ql(this.lutExpression,i,{},h,m,_,v,E);this.paintVertexArray.resize(e),this._setPaintValue(S,e,M,D?null:this.context.lut)}updatePaintArray(e,i,a,h,m,_,v,E){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:E},a,h,void 0,m):this.expression.kind==="constant"&&this.expression.value,M=Ql(this.lutExpression,a,h,m,void 0,v,void 0,E);this._setPaintValue(e,i,S,M?null:this.context.lut)}_setPaintValue(e,i,a,h){if(this.type==="color"){const m=Fh(a.toPremultipliedRenderColor(h));for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,m[0],m[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class go{constructor(e,i,a,h,m,_){this.expression=e,this.uniformNames=i.map((v=>`u_${v}_t`)),this.type=a,this.useIntegerZoom=h,this.context=m,this.maxValue=0,this.paintVertexAttributes=i.map((v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(e,i,a,h,m,_,v,E){const S=this.expression.evaluate(new Yn(this.context.zoom,{brightness:_,worldview:E}),i,{},m,h,v),M=this.expression.evaluate(new Yn(this.context.zoom+1,{brightness:_,worldview:E}),i,{},m,h,v),D=Ql(this.lutExpression,i,{},h,m,_,v,E),O=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(O,e,S,M,D?null:this.context.lut)}updatePaintArray(e,i,a,h,m,_,v,E){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:E},a,h,void 0,m),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:E},a,h,void 0,m),D=Ql(this.lutExpression,a,h,m,void 0,v,void 0,E);this._setPaintValue(e,i,S,M,D?null:this.context.lut)}_setPaintValue(e,i,a,h,m){if(this.type==="color"){const _=Fh(a.toPremultipliedRenderColor(m)),v=Fh(a.toPremultipliedRenderColor(m));for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,_[0],_[1],v[0],v[1])}else{for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,h,m){const _=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,v=J(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);i.set(e,m,v)}getBinding(e,i){return new ys(e)}}class So{constructor(e,i,a,h,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(a==="array"?wg:bg).members;for(let _=0;_<i.length;++_);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Yl}populatePaintArray(e,i,a,h){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,h,m,_,v){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],_)}_setPaintValues(e,i,a,h){if(!h||!a)return;const m=h[a[0]],_=h[a[1]];if(m){if(m){const{tl:v,br:E,pixelRatio:S}=m;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,v[0],v[1],E[0],E[1],S)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:E}=_;for(let S=e;S<i;S++)this.paintTransitionVertexArray.emplace(S,v[0],v[1],E[0],E[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Jp.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Jl{constructor(e,i,a=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const h=[];for(const m in e.paint._values){const _=e.paint.get(m);if(m.endsWith("-use-theme")||!a(m)||!(_ instanceof el&&Td(_.property.specification)))continue;const v=Eg(m,e.type),E=_.value,S=_.property.specification.type,M=!!_.property.useIntegerZoom,D=m==="line-dasharray"||m.endsWith("pattern"),O=e.paint.get(`${m}-use-theme`),N=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||O&&O.value.kind!=="constant";if(E.kind!=="constant"||N)if(E.kind==="source"||N||D){const V=ec(m,S,"source");this.binders[m]=D?new So(E,v,S,V,e.id):new nl(E,v,S,V),h.push(`/a_${m}`)}else{const V=ec(m,S,"composite");this.binders[m]=new go(E,v,S,M,i,V),h.push(`/z_${m}`)}else this.binders[m]=D?new Vd(E.value,v):new qf(E.value,v,S,i),h.push(`/u_${m}`);O&&(this.binders[m].lutExpression=O.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof nl||i instanceof go?i.maxValue:0}populatePaintArrays(e,i,a,h,m,_,v,E){for(const S in this.binders){const M=this.binders[S];M.context=this.context,(M instanceof nl||M instanceof go||M instanceof So)&&M.populatePaintArray(e,i,a,h,m,_,v,E)}}setConstantPatternPositions(e,i){for(const a in this.binders){const h=this.binders[a];h instanceof Vd&&h.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof So?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,h,m,_,v,E,S,M){let D=!1;const O=Object.keys(e),N=O.length!==0&&!E,V=N?O:i.uniqueIds;this.context.lut=m.lut;for(const $ in this.binders){const Z=this.binders[$];if(Z.context=this.context,(Z instanceof nl||Z instanceof go||Z instanceof So)&&Z.expression&&Z.expression.kind&&Z.expression.kind!=="constant"&&(Z.expression.isStateDependent===!0||Z.expression.isLightConstant===!1)){const K=m.paint.get($);Z.expression=K.value;for(const ne of V){const ae=e[ne.toString()];i.eachPosition(ne,((ue,Te,_e)=>{const Ie=h.feature(ue);Z.updatePaintArray(Te,_e,Ie,ae,_,v,S,M)}))}if(!N)for(const ne of a.uniqueIds){const ae=e[ne.toString()];a.eachPosition(ne,((ue,Te,_e)=>{const Ie=h.feature(ue);Z.updatePaintArray(Te,_e,Ie,ae,_,v,S,M)}))}D=!0}}return D}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof qf||a instanceof Vd)&&e.push(...a.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof qf||h instanceof Vd||h instanceof go)for(const m of h.uniformNames)i.push({name:m,property:a,binding:h.getBinding(e,m)})}return i}setUniforms(e,i,a,h,m){for(const{name:_,property:v,binding:E}of a)this.binders[v].setUniform(e,E,m,h.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof nl||i instanceof go||i instanceof So)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof So&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof nl||a instanceof go||a instanceof So)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof nl||i instanceof go||i instanceof So)&&i.destroy()}}}class El{constructor(e,i,a=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Jl(h,i,a);this.needsUpload=!1,this._featureMap=new kd,this._featureMapWithoutIds=new kd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,h,m,_,v,E,S){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,h,m,_,v,E,S);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,h,m,_,v,E){for(const S of a)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,S,h,m,_,v||0,E)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Tg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Eg(r,e){return Tg[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const nm={"line-pattern":{source:su,composite:su},"fill-pattern":{source:su,composite:su},"fill-extrusion-pattern":{source:su,composite:su},"line-dasharray":{source:Yl,composite:Yl}},B_={color:{source:Pc,composite:ou},number:{source:Dc,composite:Pc}};function ec(r,e,i){const a=nm[r];return a&&a[i]||B_[e][i]}Lt(qf,"ConstantBinder"),Lt(Vd,"PatternConstantBinder"),Lt(nl,"SourceExpressionBinder"),Lt(So,"PatternCompositeBinder"),Lt(go,"CompositeExpressionBinder"),Lt(Jl,"ProgramConfiguration",{omit:["_buffers"]}),Lt(El,"ProgramConfigurationSet");const Fr=Nt/Math.PI/2,d=5,t=6,o=16383,f=64,y=[f,32,16],x=-Fr,T=Fr;function A(r,e,i,a=Fr){return i=gn(i),[r*Math.sin(i)*a,-e*a,r*Math.cos(i)*a]}function R(r,e,i){return A(Math.cos(gn(r)),Math.sin(gn(r)),e,i)}const L=63710088e-1,k=2*Math.PI*L;class U{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new U(Re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,h=e.lat*i,m=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return L*Math.acos(Math.min(m,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new B({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return R(this.lat,this.lng,Fr+e*Fr/L)}static convert(e){if(e instanceof U)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new U(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new U(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class B{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}setSouthWest(e){return this._sw=e instanceof U?new U(e.lng,e.lat):U.convert(e),this}extend(e){const i=this._sw,a=this._ne;let h,m;if(e instanceof U)h=e,m=e;else{if(!(e instanceof B))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(B.convert(e)):this.extend(U.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(U.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return i||a?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new U(h.lng,h.lat),this._ne=new U(m.lng,m.lat)),this}getCenter(){return new U((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new U(this.getWest(),this.getNorth())}getSouthEast(){return new U(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=U.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(e){if(e)return e instanceof B?e:new B(e)}}const H=0,W=25.5;function X(r){return k*Math.cos(r*Math.PI/180)}function te(r){return(180+r)/360}function ee(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function re(r,e){return r/X(e)}function he(r){return 360*r-180}function le(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function we(r,e){return r*X(le(e))}const fe=85.051129;function Ee(r){return Math.cos(gn(J(r,-fe,fe)))}function ge(r,e){const i=J(e,H,W),a=Math.pow(2,i);return Ee(r)*k/(512*a)}function me(r){return 1/Math.cos(r*Math.PI/180)}function Se(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/Nt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/Nt/(1<<r.z)}class Ve{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=U.convert(e);return new Ve(te(a.lng),ee(a.lat),re(i,a.lat))}toLngLat(){return new U(he(this.x),le(this.y))}toAltitude(){return we(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/k*me(le(this.y))}}function ke(r,e,i,a,h,m,_,v,E){const S=(e+a)/2,M=(i+h)/2,D=new St(S,M);v(D),(function(O,N,V,$,Z,K){const ne=V-Z,ae=$-K;return Math.abs(($-N)*ne-(V-O)*ae)/Math.hypot(ne,ae)})(D.x,D.y,m.x,m.y,_.x,_.y)>=E?(ke(r,e,i,S,M,m,D,v,E),ke(r,S,M,a,h,D,_,v,E)):r.push(_)}function st(r,e,i){let a=r[0],h=a.x,m=a.y;e(a);const _=[a];for(let v=1;v<r.length;v++){const E=r[v],{x:S,y:M}=E;e(E),ke(_,h,m,S,M,a,E,e,i),h=S,m=M,a=E}return _}function Xe(r,e,i,a){if(a(e,i)){const h=e.add(i)._mult(.5);Xe(r,e,h,a),Xe(r,h,i,a)}else r.push(i)}function ht(r,e){let i=r[0];const a=[i];for(let h=1;h<r.length;h++){const m=r[h];Xe(a,i,m,e),i=m}return a}const zt=Math.pow(2,14)-1,$e=-zt-1;function Pe(r,e){const i=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=J(i,$e,zt),r.y=J(a,$e,zt),(i<r.x||i>r.x+1||a<r.y||a>r.y+1)&&gi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function dt(r,e,i){const a=r.loadGeometry(),h=r.extent,m=Nt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:E,y:S,projection:M}=i,D=O=>{const N=he((e.x+O.x/h)/_),V=le((e.y+O.y/h)/_),$=M.project(N,V);O.x=($.x*v-E)*h,O.y=($.y*v-S)*h};for(let O=0;O<a.length;O++)if(r.type!==1)a[O]=st(a[O],D,1);else{const N=[];for(const V of a[O])V.x<0||V.x>=h||V.y<0||V.y>=h||(D(V),N.push(V));a[O]=N}}for(const _ of a)for(const v of _)Pe(v,m);return a}function Ke(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?dt(r):[]}}class At{constructor(e,i,a,h,m){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=m,e.readFields(wt,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,a=[];let h,m=1,_=0,v=0,E=0;for(;e.pos<i;){if(_<=0){const S=e.readVarint();m=7&S,_=S>>3}if(_--,m===1||m===2)v+=e.readSVarint(),E+=e.readSVarint(),m===1&&(h&&a.push(h),h=[]),h&&h.push(new St(v,E));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&a.push(h),a}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let a=1,h=0,m=0,_=0,v=1/0,E=-1/0,S=1/0,M=-1/0;for(;e.pos<i;){if(h<=0){const D=e.readVarint();a=7&D,h=D>>3}if(h--,a===1||a===2)m+=e.readSVarint(),_+=e.readSVarint(),m<v&&(v=m),m>E&&(E=m),_<S&&(S=_),_>M&&(M=_);else if(a!==7)throw new Error(`unknown command ${a}`)}return[v,S,E,M]}toGeoJSON(e,i,a){const h=this.extent*Math.pow(2,a),m=this.extent*e,_=this.extent*i,v=this.loadGeometry();function E(O){return[360*(O.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(O.y+_)/h)*Math.PI))-90]}function S(O){return O.map(E)}let M;if(this.type===1){const O=[];for(const V of v)O.push(V[0]);const N=S(O);M=O.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N}}else if(this.type===2){const O=v.map(S);M=O.length===1?{type:"LineString",coordinates:O[0]}:{type:"MultiLineString",coordinates:O}}else{if(this.type!==3)throw new Error("unknown feature type");{const O=(function(V){const $=V.length;if($<=1)return[V];const Z=[];let K,ne;for(let ae=0;ae<$;ae++){const ue=Ht(V[ae]);ue!==0&&(ne===void 0&&(ne=ue<0),ne===ue<0?(K&&Z.push(K),K=[V[ae]]):K&&K.push(V[ae]))}return K&&Z.push(K),Z})(v),N=[];for(const V of O)N.push(V.map(S));M=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N}}}const D={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function wt(r,e,i){r===1?e.id=i.readVarint():r===2?(function(a,h){const m=a.readVarint()+a.pos;for(;a.pos<m;){const _=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[_]=v}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function Ht(r){let e=0;for(let i,a,h=0,m=r.length,_=m-1;h<m;_=h++)i=r[h],a=r[_],e+=(a.x-i.x)*(i.y+a.y);return e}At.types=["Unknown","Point","LineString","Polygon"];class mt{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(_t,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new At(this._pbf,i,this.extent,this._keys,this._values)}}function _t(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(a){let h=null;const m=a.readVarint()+a.pos;for(;a.pos<m;){const _=a.readVarint()>>3;h=_===1?a.readString():_===2?a.readFloat():_===3?a.readDouble():_===4?a.readVarint64():_===5?a.readVarint():_===6?a.readSVarint():_===7?a.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(i))}class $t{constructor(e,i){this.layers=e.readFields(Jt,{},i)}}function Jt(r,e,i){if(r===3){const a=new mt(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}const Xt="3d_elevation_id",ri="level";class Mi{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,h){const m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?a(h?h(m):m):i&&(this._valid=!1),this}}class tn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const Gi=new tn(((r,e,i)=>r.reset(e).require(Xt,(a=>{i.id=a})).optional("fixed_height_relative",(a=>{i.constantHeight=a}),Pi.decodeRelativeHeight).geometry((a=>{i.bounds=a}),ah).success()),((r,e,i)=>r.reset(e).require(Xt,(a=>{i.id=a})).require("elevation_idx",(a=>{i.idx=a})).require("extent",(a=>{i.extent=a})).require("height_relative",(a=>{i.height=a}),Pi.decodeRelativeHeight).geometry((a=>{i.position=a}),Pi.getPoint).success())),Fn=new tn(((r,e,i)=>r.reset(e).require(Xt,(a=>{i.id=a})).optional("fixed_height",(a=>{i.constantHeight=a}),Pi.decodeMetricHeight).geometry((a=>{i.bounds=a}),ah).success()),((r,e,i)=>r.reset(e).require(Xt,(a=>{i.id=a})).require("elevation_idx",(a=>{i.idx=a})).require("extent",(a=>{i.extent=a})).require("height",(a=>{i.height=a}),Pi.decodeMetricHeight).geometry((a=>{i.position=a}),Pi.getPoint).success()));class Pi{static getPoint(e){return Co(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Fn:void 0:Gi}static parse(e){const i=[],a=[],h=e.length,m=new Mi;for(let _=0;_<h;_++){const v=e.feature(_),E=v.properties.version,S=Pi.getVersionSchema(E);if(S===void 0){gi(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const M=v.properties.type;if(!M)continue;const D=At.types[v.type];if(D==="Point"&&M==="curve_point"){const O={};S.parseVertex(m,v,O)&&i.push(O)}else if(D==="Polygon"&&M==="curve_meta"){const O={};S.parseFeature(m,v,O)&&a.push(O)}}return{vertices:i,features:a}}}class yn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const h=Es(i,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/h;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,!0}}class Ni{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const h=hr(i,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,a[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,i,a){if((function(N,V){var $=N[0],Z=N[1],K=N[2],ne=V[0],ae=V[1],ue=V[2];return Math.abs($-ne)<=G*Math.max(1,Math.abs($),Math.abs(ne))&&Math.abs(Z-ae)<=G*Math.max(1,Math.abs(Z),Math.abs(ae))&&Math.abs(K-ue)<=G*Math.max(1,Math.abs(K),Math.abs(ue))})(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[h,m,_]=this.dir,v=this.pos[0]-e[0],E=this.pos[1]-e[1],S=this.pos[2]-e[2],M=h*h+m*m+_*_,D=2*(v*h+E*m+S*_),O=D*D-4*M*(v*v+E*E+S*S-i*i);if(O<0){const N=Math.max(-D/2,0),V=v+h*N,$=E+m*N,Z=S+_*N,K=Math.hypot(V,$,Z);return a[0]=V*i/K,a[1]=$*i/K,a[2]=Z*i/K,!1}{const N=(-D-Math.sqrt(O))/(2*M);if(N<0){const V=Math.hypot(v,E,S);return a[0]=v*i/V,a[1]=E*i/V,a[2]=S*i/V,!1}return a[0]=v+h*N,a[1]=E+m*N,a[2]=S+_*N,!0}}}class Bn{constructor(e,i,a,h,m){this.TL=e,this.TR=i,this.BR=a,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(e,i,a){const h=[-1,1,1],m=[1,1,1],_=[1,-1,1],v=[-1,-1,1],E=nr(h,h,e),S=nr(m,m,e),M=nr(_,_,e),D=nr(v,v,e);return new Bn(E,S,M,D,i/a)}}function _n(r,e,i){let a=1/0,h=-1/0;const m=[];for(const _ of r){Dr(m,_,e);const v=hr(m,i);a=Math.min(a,v),h=Math.max(h,v)}return[a,h]}function In(r,e){let i=!0;for(let a=0;a<r.planes.length;a++){const h=r.planes[a];let m=0;for(let _=0;_<e.length;_++)m+=+(hr(h,e[_])+h[3]>=0);if(m===0)return 0;m!==e.length&&(i=!1)}return i?2:1}function Dn(r,e){for(const i of r.projections){const a=_n(e,r.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function Wi(r,e){let i=0;const a=[0,0,0,0];for(let _=0;_<r.length;_++)a[0]=r[_][0],a[1]=r[_][1],a[2]=r[_][2],a[3]=1,(h=a)[0]*(m=e)[0]+h[1]*m[1]+h[2]*m[2]+h[3]*m[3]>=0&&i++;var h,m;return i}class Un{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=nn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Dr([],this.points[2],this.points[3]),Dr([],this.points[0],this.points[3]),Dr([],this.points[4],this.points[0]),Dr([],this.points[5],this.points[1]),Dr([],this.points[6],this.points[2]),Dr([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const h=[0,-a[2],a[1]],m=[a[2],0,-a[0]];this.projections.push({axis:h,projection:_n(this.points,this.points[0],h)}),this.projections.push({axis:m,projection:_n(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,i,a,h){const m=Math.pow(2,a),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((S=>{const M=$i([],S,e),D=1/M[3]/i*m;return(O=M)[0]=(N=M)[0]*(V=[D,D,h?1/M[3]:D,D])[0],O[1]=N[1]*V[1],O[2]=N[2]*V[2],O[3]=N[3]*V[3],O;var O,N,V})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((S=>{const M=Ki([],Wr([],Dr([],_[S[0]],_[S[1]]),Dr([],_[S[2]],_[S[1]]))),D=-hr(M,_[S[1]]);return M.concat(D)})),E=[];for(let S=0;S<_.length;S++)E.push([_[S][0],_[S][1],_[S][2]]);return new Un(E,v)}intersectsPrecise(e,i,a){for(let h=0;h<i.length;h++)if(!Wi(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Wi(e,this.planes[h]))return 0;for(const h of a)for(const m of this.frustumEdges){const _=Wr([],h,m),v=qn(_);if(v===0)continue;ai(_,_,1/v);const E=_n(this.points,this.points[0],_),S=_n(e,this.points[0],_);if(E[0]>S[1]||S[0]>E[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(hr([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class nn{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const h of e)rt(i,i,h),Yt(a,a,h);return new nn(i,a)}static fromTileIdAndHeight(e,i,a){const h=1<<e.canonical.z,m=e.canonical.x,_=e.canonical.y;return new nn([m/h,_/h,i],[(m+1)/h,(_+1)/h,a])}static applyTransform(e,i){const a=e.getCorners();for(let h=0;h<a.length;++h)nr(a[h],a[h],i);return nn.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],h=[...a];for(let m=0;m<3;m++)for(let _=0;_<3;_++){const v=i[4*_+m],E=v*e.min[_],S=v*e.max[_];a[m]+=Math.min(E,S),h[m]+=Math.max(E,S)}return new nn(a,h)}static projectAabbCorners(e,i){const a=e.getCorners();for(let h=0;h<a.length;++h)nr(a[h],a[h],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=ai([],wi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=ur(this.min),h=ur(this.max);for(let m=0;m<i.length;m++)a[m]=i[m]?this.min[m]:this.center[m],h[m]=i[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new nn(a,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?In(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?In(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Dn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Dn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Lt(nn,"Aabb");class gr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],h=-i[0],m=(e.extent+1)*this.metersToTile;return[new St(Math.trunc(e.position[0]+a*m),Math.trunc(e.position[1]+h*m)),new St(Math.trunc(e.position[0]-a*m),Math.trunc(e.position[1]-h*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class wn{constructor(e,i,a,h,m,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[pr(),pr(),pr(),pr(),pr(),pr(),pr()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=m,this.edges=this.edges.filter((v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((E=this.vertices[v.a].position)[0]===(S=this.vertices[v.b].position)[0]&&E[1]===S[1]);var E,S})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:Co(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const E=this.vertices[v.a].position,S=this.vertices[v.b].position,M=Qo(pr(),S,E),D=dr(M),O=ma(pr(),M,1/D);this.edgeProps.push({vec:M,dir:O,len:D});const N=this.vertexProps[v.a].dir,V=this.vertexProps[v.b].dir;cl(N,N,O),cl(V,V,O)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||Ps(v.dir,v.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,h]=i;return Oi(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,h)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return Ct(0,0,1);const h=a[0],m=this.edges[h],_=this.edgeProps[h].vec,v=Ct(_[0],_[1],(this.vertices[m.b].height-this.vertices[m.a].height)*i),E=Ct(v[1],-v[0],0);Wr(E,E,v);const S=qn(E);return S>0?ai(E,E,1/S):oi(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,h=0;const[m,_,v,E,S,M,D]=this._tmpVec2;Ts(D,e.x,e.y);const O=new yn(D,null);for(let N=0;N<this.edges.length;N++){const V=this.edges[N],$=this.edgeProps[N].dir;O.dir=$;const Z=this.vertices[V.a].position,K=this.vertices[V.b].position,ne=O.intersectsPlane(Z,this.vertexProps[V.a].dir,m),ae=O.intersectsPlane(K,this.vertexProps[V.b].dir,_);if(!ne||!ae)continue;Qo(v,_,m),Qo(E,D,m);const ue=Es(v,v),Te=ue>0?Es(E,v)/ue:0,_e=J(Te,0,1),Ie=Math.abs((Te-_e)*this.edgeProps[N].len);Qo(S,D,Z),Ts(M,$[1],-$[0]);const Me=Ie+Math.abs(Es(S,M));Me<a&&(i=N,a=Me,h=_e)}return[i,h]}tessellate(e){const i=ze(),a=ze(),h=ze(),m=ze();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,E=this.edges[_].b,{position:S,height:M,extent:D}=this.vertices[v],{position:O,height:N,extent:V}=this.vertices[E],$=this.vertexProps[v].dir,Z=this.vertexProps[E].dir;if(oi(i,S[0]/e,S[1]/e,M),oi(a,O[0]/e,O[1]/e,N),oi(h,$[1],-$[0],0),ai(h,h,D),oi(m,Z[1],-Z[0],0),ai(m,m,V),this.distSqLines(Ct(i[0]+.5*h[0],i[1]+.5*h[1],i[2]+.5*h[2]),Ct(a[0]-.5*m[0],a[1]-.5*m[1],a[2]-.5*m[2]),Ct(i[0]-.5*h[0],i[1]-.5*h[1],i[2]-.5*h[2]),Ct(a[0]+.5*m[0],a[1]+.5*m[1],a[2]+.5*m[2]))<=.0025000000000000005)continue;const K=this.vertices.length,ne=cl(pr(),S,O);this.vertices.push({position:ma(ne,ne,.5),height:.5*(M+N),extent:.5*(D+V)});const ae=cl(pr(),$,Z);this.vertexProps.push({dir:Ps(ae,ae)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:K}),this.edges.push({a:K,b:E});const ue=Qo(pr(),this.vertices[K].position,S),Te=dr(ue),_e={vec:ue,dir:ma(pr(),ue,1/Te),len:Te};this.edgeProps.push(_e),this.edgeProps.push(_e)}}distSqLines(e,i,a,h){const m=bn(ze(),i,e),_=bn(ze(),h,a),v=bn(ze(),e,a),E=hr(m,m),S=hr(m,_),M=hr(m,v),D=hr(_,_),O=hr(_,v),N=E*D-S*S;if(N===0)return kn(co(m,a,h,hr(v,_)/hr(_,_)),e);const V=(E*O-S*M)/N;return kn(co(m,e,i,(S*O-M*D)/N),co(_,a,h,V))}}class Ei{static parseFrom(e,i){const a=Pi.parse(e);if(!a)return[];let{vertices:h,features:m}=a;const _=1/Se(i);m.sort(((M,D)=>M.id-D.id)),h.sort(((M,D)=>M.id-D.id||M.idx-D.idx)),h=h.filter(((M,D,O)=>D===O.findIndex((N=>N.id===M.id&&N.idx===M.idx))));const v=new Array;let E=0;const S=h.length;for(const M of m){if(M.constantHeight){v.push(new wn(M.id,M.bounds,M.constantHeight));continue}for(;E!==S&&h[E].id<M.id;)E++;if(E===S||h[E].id!==M.id)continue;const D=new Array,O=new Array,N=E;for(;E!==S&&h[E].id===M.id;){const V=h[E];if(D.push({position:V.position,height:V.height,extent:V.extent}),E!==N&&h[E-1].idx===V.idx-1){const $=E-N;O.push({a:$-1,b:$})}E++}v.push(new wn(M.id,M.bounds,void 0,D,O,_))}return v}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[Xt];return Number.isNaN(a)?void 0:i.find((h=>h.id===a))}}class pn{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Nt,this.yOffset=(e.y*this.zScale-i.y)*Nt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const h=this.constantElevation(i,a);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*de(0,i,e>=0?e:Math.abs(.5*e))}}Lt(wn,"ElevationFeature");class br{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Sa,this.indexArray=new Cr,this.segments=new Lr,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Dc),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,h){}populate(e,i,a,h){const m=this.layers[0],_=[];let v=null;m.type==="circle"&&(v=m.layout.get("circle-sort-key"));for(const{feature:S,id:M,index:D,sourceLayerIndex:O}of e){const N=this.layers[0]._featureFilter.needGeometry,V=Ke(S,N);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),V,a))continue;const $=v?v.evaluate(V,{},a):void 0,Z={id:M,properties:S.properties,type:S.type,sourceLayerIndex:O,index:D,geometry:N?V.geometry:dt(S,a,h),patterns:{},sortKey:$};_.push(Z)}v&&_.sort(((S,M)=>S.sortKey-M.sortKey));let E=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Od,E=h.projection);for(const S of _){const{geometry:M,index:D,sourceLayerIndex:O}=S,N=e[D].feature;this.addFeature(S,M,D,i.availableImages,a,E,i.brightness,i.elevationFeatures),i.featureIndex.insert(N,M,D,O,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,h,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,a,h,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_g.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,vg.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,yg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,h,m,_,v,E){let S;this.elevationMode!=="none"&&(S=Ei.getElevationFeature(e,E));for(const M of i)for(const D of M){const O=D.x,N=D.y;if(O<0||O>=Nt||N<0||N>=Nt)continue;if(_){const Z=_.projectTilePoint(O,N,m),K=_.upVector(m,O,N);this.addGlobeExtVertex(Z,K),this.addGlobeExtVertex(Z,K),this.addGlobeExtVertex(Z,K),this.addGlobeExtVertex(Z,K)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),$=V.vertexLength;if(this.addCircleVertex(O,N,-1,-1),this.addCircleVertex(O,N,1,-1),this.addCircleVertex(O,N,1,1),this.addCircleVertex(O,N,-1,1),this.elevationMode!=="none"){const Z=S?S.pointElevation(new St(O,N)):0;this.hasElevation=this.hasElevation||Z!==0;for(let K=0;K<4;K++)this.elevatedLayoutVertexArray.emplaceBack(Z)}this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h,m,v,void 0,this.worldview)}addCircleVertex(e,i,a,h){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(h+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Er(r,e){for(let i=0;i<r.length;i++)if(oo(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(oo(r,e[i]))return!0;return!!_o(r,e)}function zr(r,e,i){return!!oo(r,e)||!!Qr(e,r,i)}function qr(r,e){if(r.length===1)return rl(e,r[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let h=0;h<a.length;h++)if(oo(r,a[h]))return!0}for(let i=0;i<r.length;i++)if(rl(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(_o(r,e[i]))return!0;return!1}function ca(r,e,i){if(r.length>1){if(_o(r,e))return!0;for(let a=0;a<e.length;a++)if(Qr(e[a],r,i))return!0}for(let a=0;a<r.length;a++)if(Qr(r[a],e,i))return!0;return!1}function _o(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],h=r[i+1];for(let m=0;m<e.length-1;m++)if(so(a,h,e[m],e[m+1]))return!0}return!1}function so(r,e,i,a){return en(r,i,a)!==en(e,i,a)&&en(r,e,i)!==en(r,e,a)}function ls(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function Va(r,e,i,a){const h=ls(r,e,a),m=ls(r,e,i);if(Math.sign(h)===Math.sign(m))return;const _=ls(i,a,r),v=_+m-h;return Math.sign(_)!==Math.sign(v)?[_/(_-v),m/(m-h)]:void 0}function Qr(r,e,i){const a=i*i;if(e.length===1)return r.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(Ua(r,e[h-1],e[h])<a)return!0;return!1}function Ua(r,e,i){const a=e.distSqr(i);if(a===0)return r.distSqr(e);const h=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/a;return r.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function rl(r,e){let i,a,h,m=!1;for(let _=0;_<r.length;_++){i=r[_];for(let v=0,E=i.length-1;v<i.length;E=v++)a=i[v],h=i[E],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(m=!m)}return m}function oo(r,e){let i=!1;for(let a=0,h=r.length-1;a<r.length;h=a++){const m=r[a],_=r[h];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(i=!i)}return i}function wr(r,e,i,a,h){for(const _ of r)if(e<=_.x&&i<=_.y&&a>=_.x&&h>=_.y)return!0;const m=[new St(e,i),new St(e,h),new St(a,h),new St(a,i)];if(r.length>2){for(const _ of m)if(oo(r,_))return!0}for(let _=0;_<r.length-1;_++)if(Jr(r[_],r[_+1],m))return!0;return!1}function Jr(r,e,i){const a=i[0],h=i[2];if(r.x<a.x&&e.x<a.x||r.x>h.x&&e.x>h.x||r.y<a.y&&e.y<a.y||r.y>h.y&&e.y>h.y)return!1;const m=en(r,e,i[0]);return m!==en(r,e,i[1])||m!==en(r,e,i[2])||m!==en(r,e,i[3])}function ar(r,e,i,a,h,m){let _=e.y-r.y,v=r.x-e.x;if(m=m||0){const E=_*_+v*v;if(E===0)return!0;const S=Math.sqrt(E);_/=S,v/=S}return!((i.x-r.x)*_+(i.y-r.y)*v-m<0||(a.x-r.x)*_+(a.y-r.y)*v-m<0||(h.x-r.x)*_+(h.y-r.y)*v-m<0)}function Hr(r,e,i,a,h,m,_){return!(ar(r,e,a,h,m,_)||ar(e,i,a,h,m,_)||ar(i,r,a,h,m,_)||ar(a,h,r,e,i,_)||ar(h,m,r,e,i,_)||ar(m,a,r,e,i,_))}function Ws(r,e,i){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(r)}function $r(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function ja(r,e,i,a,h){if(!e[0]&&!e[1])return r;const m=St.convert(e)._mult(h);i==="viewport"&&m._rotate(-a);const _=[];for(let v=0;v<r.length;v++)_.push(r[v].sub(m));return _}function Bh(r,e,i,a){const h=St.convert(r)._mult(a);return e==="viewport"&&h._rotate(-i),h}let Sl,$u;function Ud(r,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}Lt(br,"CircleBucket",{omit:["layers"]});class sl{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Ga(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const a=(function(m,_,v){var E=Ud(256*m,256*(_=Math.pow(2,v)-_-1),v),S=Ud(256*(m+1),256*(_+1),v);return E[0]+","+E[1]+","+S[0]+","+S[1]})(this.x,this.y,this.z),h=(function(m,_,v){let E,S="";for(let M=m;M>0;M--)E=1<<M-1,S+=(_&E?1:0)+(v&E?2:0);return S})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oc{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ga(e,i.z,i.z,i.x,i.y)}}class Fs{constructor(e,i,a,h,m){this.overscaledZ=e,this.wrap=i,this.canonical=new sl(a,+h,+m),this.key=i===0&&e===a?this.canonical.key:Ga(i,e,a,h,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Fs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Fs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Ga(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Ga(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Fs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Fs(i,this.wrap,i,a,h),new Fs(i,this.wrap,i,a+1,h),new Fs(i,this.wrap,i,a,h+1),new Fs(i,this.wrap,i,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Fs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Fs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ga(r,e,i,a,h){const m=1<<Math.min(i,22);let _=m*(h%m)+a%m;return r&&i<22&&(_+=m*m*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}const Al=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new Fs(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new Fs(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new Fs(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Fs(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Lt(sl,"CanonicalTileID"),Lt(Fs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Hf=hn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:$f}=Hf,rx=hn([{name:"a_pos_3",components:3,type:"Int16"}]);var ov=hn([{name:"a_pos",type:"Int16",components:2}]);function Sg(r){return r*Fr/L}const sx=[new nn([x,x,x],[T,T,T]),new nn([x,x,x],[0,0,T]),new nn([0,x,x],[T,0,T]),new nn([x,0,x],[0,T,T]),new nn([0,0,x],[T,T,T])];function av(r,e,i,a=!0){const h=ai([],r._camera.position,r.worldSize),m=[e,i,1,1];$i(m,m,r.pixelMatrixInverse),rn(m,m,1/m[3]);const _=Ki([],Dr([],m,h)),v=r.globeMatrix,E=[v[12],v[13],v[14]],S=Dr([],E,h),M=qn(S),D=Ki([],S),O=r.worldSize/(2*Math.PI),N=hr(D,_),V=Math.asin(O/M);if(V<Math.acos(N)){if(!a)return null;const at=[],Ge=[];ai(at,_,M/N),Ki(Ge,Dr(Ge,at,S)),Ki(_,wi(_,S,ai(_,Ge,Math.tan(V)*M)))}const $=[];new Ni(h,_).closestPointOnSphere(E,O,$);const Z=Ki([],Gr(v,0)),K=Ki([],Gr(v,1)),ne=Ki([],Gr(v,2)),ae=hr(Z,$),ue=hr(K,$),Te=hr(ne,$),_e=Ls(Math.asin(-ue/O));let Ie=Ls(Math.atan2(ae,Te));Ie=r.center.lng+(function(at,Ge){const ut=(Ge-at+180)%360-180;return ut<-180?ut+360:ut})(r.center.lng,Ie);const Me=te(Ie),Le=J(ee(_e),0,1);return new Ve(Me,Le)}class N_{constructor(e,i,a){this.a=Dr([],e,a),this.b=Dr([],i,a),this.center=a;const h=Ki([],this.a),m=Ki([],this.b);this.angle=Math.acos(hr(h,m))}}function V_(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:(function(a,h,m,_){const v=Math.sin(m);return a*(Math.sin((1-_)*m)/v)+h*(Math.sin(_*m)/v)})(r.a[e],r.b[e],r.angle,J(i,0,1))+r.center[e]}function lu(r){if(r.z<=1)return sx[r.z+2*r.y+r.x];const e=lv(Ag(r));return nn.fromPoints(e)}function kr(r,e,i){return ai(r,r,1-i),_i(r,r,e,i)}function U_(r,e,i){for(const a of r)nr(a,a,e),ai(a,a,i)}function ox(r,e,i,a){const h=e/r.worldSize,m=r.globeMatrix;if(i.z<=1){const Le=lu(i).getCorners();return U_(Le,m,h),nn.fromPoints(Le)}const _=Ag(i,a),v=lv(_,Fr+Sg(r._tileCoverLift));U_(v,m,h);const E=Number.MAX_VALUE,S=[-E,-E,-E],M=[E,E,E];if(_.contains(r.center)){for(const Ge of v)rt(M,M,Ge),Yt(S,S,Ge);S[2]=0;const Le=r.point,at=[Le.x*h,Le.y*h,0];return rt(M,M,at),Yt(S,S,at),new nn(M,S)}if(r._tileCoverLift>0){for(const Le of v)rt(M,M,Le),Yt(S,S,Le);return new nn(M,S)}const D=[m[12]*h,m[13]*h,m[14]*h],O=_.getCenter(),N=J(r.center.lat,-fe,fe),V=J(O.lat,-fe,fe),$=te(r.center.lng),Z=ee(N);let K=$-te(O.lng);const ne=Z-ee(V);K>.5?K-=1:K<-.5&&(K+=1);let ae=0;Math.abs(K)>Math.abs(ne)?ae=K>=0?1:3:(ae=ne>=0?0:2,_i(D,D,[m[4]*h,m[5]*h,m[6]*h],-Math.sin(gn(ne>=0?_.getSouth():_.getNorth()))*Fr));const ue=v[ae],Te=v[(ae+1)%4],_e=new N_(ue,Te,D),Ie=[V_(_e,0)||ue[0],V_(_e,1)||ue[1],V_(_e,2)||ue[2]],Me=Aa(r.zoom);if(Me>0){const Le=(function({x:Ge,y:ut,z:gt},Et,jt,Dt,vt){const Mt=1/(1<<gt);let ot=Ge*Mt,et=ot+Mt,It=ut*Mt,Vt=It+Mt,bt=0;const li=(ot+et)/2-Dt;return li>.5?bt=-1:li<-.5&&(bt=1),ot=((ot+bt)*Et-(Dt*=Et))*jt+Dt,et=((et+bt)*Et-Dt)*jt+Dt,It=(It*Et-(vt*=Et))*jt+vt,Vt=(Vt*Et-vt)*jt+vt,[[ot,Vt,0],[et,Vt,0],[et,It,0],[ot,It,0]]})(i,e,r._pixelsPerMercatorPixel,$,Z);for(let Ge=0;Ge<v.length;Ge++)kr(v[Ge],Le[Ge],Me);const at=wi([],Le[ae],Le[(ae+1)%4]);ai(at,at,.5),kr(Ie,at,Me)}for(const Le of v)rt(M,M,Le),Yt(S,S,Le);return M[2]=Math.min(ue[2],Te[2]),rt(M,M,Ie),Yt(S,S,Ie),new nn(M,S)}function Ag({x:r,y:e,z:i},a=!1){const h=1/(1<<i),m=new U(he(r*h),e===(1<<i)-1&&a?-90:le((e+1)*h)),_=new U(he((r+1)*h),e===0&&a?90:le(e*h));return new B(m,_)}function lv(r,e=Fr){const i=gn(r.getNorth()),a=gn(r.getSouth()),h=Math.cos(i),m=Math.cos(a),_=Math.sin(i),v=Math.sin(a),E=r.getWest(),S=r.getEast();return[A(m,v,E,e),A(m,v,S,e),A(h,_,S,e),A(h,_,E,e)]}function Ig(r,e,i,a){const h=1<<i.z,m=(r/Nt+i.x)/h;return R(le((e/Nt+i.y)/h),he(m),a)}function j_({min:r,max:e}){return o/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const Cg=new Float64Array(16);function Nh(r){const e=j_(r),i=Oe(Cg,[e,e,e]);return Gt(i,i,Mr([],r.min))}function Rg(r){const e=(a=r.min,(i=Cg)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const h=1/j_(r);return ei(e,e,[h,h,h])}function rm(r){const e=Nt/(2*Math.PI);return r/(2*Math.PI)/e}function G_(r,e){return Nt/(512*Math.pow(2,r))*j_(lu(e))}function Vh(r,e,i,a,h){const m=rm(i),_=[r,e,-i/(2*Math.PI)],v=Ze(new Float64Array(16));return Gt(v,v,_),ei(v,v,[m,m,m]),Fi(v,v,gn(-h)),Si(v,v,gn(-a)),v}function Aa(r){return de(d,t,r)}function sm(r,e){const i=R(e.lat,e.lng),a=(function(V){const $=R(V._center.lat,V._center.lng);let Z=Wr([],Ct(0,1,0),$);const K=je([],-V.angle,$);Z=nr(Z,Z,K),je(K,-V._pitch,Z);const ne=Ki([],$);return ai(ne,ne,Sg(V.cameraToCenterDistance/V.pixelsPerMeter)),nr(ne,ne,K),wi([],$,ne)})(r);return _=(h=bn([],a,i))[0],v=h[1],E=h[2],S=(m=i)[0],M=m[1],D=m[2],N=(O=Math.sqrt((_*_+v*v+E*E)*(S*S+M*M+D*D)))&&hr(h,m)/O,Math.acos(Math.min(Math.max(N,-1),1));var h,m,_,v,E,S,M,D,O,N}function cv(r,e){return sm(r,e)>Math.PI/2*1.01}const uv=gn(85),ax=Math.cos(uv),lx=Math.sin(uv),cx=Je(),ux=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function q_(r,e,i,a,h,m,_,v,E){if(m&&r.queryGeometry.isAboveHorizon)return!1;m&&(E*=r.pixelToTileUnitsFactor);const S=r.tileID.canonical,M=i.projection.upVectorScale(S,i.center.lat,i.worldSize).metersToTile;for(const D of e)for(const O of D){const N=O.add(v),V=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(N.x,N.y,!0):0,$=i.projection.projectTilePoint(N.x,N.y,S);if(V>0){const ae=i.projection.upVector(S,N.x,N.y);$.x+=ae[0]*M*V,$.y+=ae[1]*M*V,$.z+=ae[2]*M*V}const Z=m?N:hx($.x,$.y,$.z,a),K=m?r.tilespaceRays.map((ae=>dv(ae,V))):r.queryGeometry.screenGeometry,ne=$i([],[$.x,$.y,$.z,1],a);if(!_&&m?E*=ne[3]/i.cameraToCenterDistance:_&&!m&&(E*=i.cameraToCenterDistance/ne[3]),m){const ae=le((O.y/Nt+S.y)/(1<<S.z));E/=i.projection.pixelsPerMeter(ae,1)/re(1,ae)}if(zr(K,Z,E))return!0}return!1}function hx(r,e,i,a){const h=$i([],[r,e,i,1],a);return new St(h[0]/h[3],h[1]/h[3])}const hv=Ct(0,0,0),$1=Ct(0,0,1);function dv(r,e){const i=ze();return hv[2]=e,r.intersectsPlane(hv,$1,i),new St(i[0],i[1])}class H_ extends br{}let dx,fx,om,px;function fv(r,{width:e,height:i},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*a)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*a);return r.width=e,r.height=i,r.data=h,r}function Rr(r,e,i){const{width:a,height:h}=e;a===r.width&&h===r.height||(Mg(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,h)},i,null),r.width=a,r.height=h,r.data=e.data)}function Mg(r,e,i,a,h,m,_,v){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||i.x>r.width-h.width||i.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const E=r.data,S=e.data,M=m===4&&v;for(let D=0;D<h.height;D++){const O=((i.y+D)*r.width+i.x)*m,N=((a.y+D)*e.width+a.x)*m;if(M)for(let V=0;V<h.width;V++){const $=O+V*m+3,Z=N+V*m;S[Z+0]=255,S[Z+1]=255,S[Z+2]=255,S[Z+3]=E[$]}else if(_)for(let V=0;V<h.width;V++){const $=O+V*m,Z=N+V*m,K=new On(E[$+0]/255,E[$+1]/255,E[$+2]/255,E[$+3]).toNonPremultipliedRenderColor(_).toArray();S[Z+0]=K[0],S[Z+1]=K[1],S[Z+2]=K[2],S[Z+3]=K[3]}else for(let V=0;V<h.width*m;V++)S[N+V]=E[O+V]}return e}Lt(H_,"HeatmapBucket",{omit:["layers"]});class cu{constructor(e,i){fv(this,e,1,i)}resize(e){Rr(this,new cu(e),1)}clone(){return new cu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,h,m){Mg(e,i,a,h,m,1,null)}}class yo{constructor(e,i){fv(this,e,4,i)}resize(e){Rr(this,new yo(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new yo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,h,m,_,v){Mg(e,i,a,h,m,4,_,v)}}class pv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Wf(r){const e={},i=r.resolution||256,a=r.clips?r.clips.length:1,h=r.image||new yo({width:i,height:a}),m=(_,v,E)=>{e[r.evaluationKey]=E;const S=r.expression.evaluate(e),M=S?S.toNonPremultipliedRenderColor(null):null;M&&(h.data[_+v+0]=Math.floor(255*M.r),h.data[_+v+1]=Math.floor(255*M.g),h.data[_+v+2]=Math.floor(255*M.b),h.data[_+v+3]=Math.floor(255*M.a))};if(r.clips)for(let _=0,v=0;_<a;++_,v+=4*i)for(let E=0,S=0;E<i;E++,S+=4){const M=E/(i-1),{start:D,end:O}=r.clips[_];m(v,S,D*(1-M)+O*M)}else for(let _=0,v=0;_<i;_++,v+=4)m(0,v,_/(i-1));return h}Lt(cu,"AlphaImage"),Lt(yo,"RGBAImage");const Dg=hn([{name:"a_pos",components:2,type:"Int16"}],4),$_=hn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),W1=hn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),mx=hn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function am(r,e,i=2){const a=e&&e.length,h=a?e[0]*i:r.length;let m=gx(r,0,h,i,!0);const _=[];if(!m||m.next===m.prev)return _;let v,E,S;if(a&&(m=(function(M,D,O,N){const V=[];for(let $=0,Z=D.length;$<Z;$++){const K=gx(M,D[$]*N,$<Z-1?D[$+1]*N:M.length,N,!1);K===K.next&&(K.steiner=!0),V.push(W_(K))}V.sort(_x);for(let $=0;$<V.length;$++)O=X1(V[$],O);return O})(r,e,m,i)),r.length>80*i){v=r[0],E=r[1];let M=v,D=E;for(let O=i;O<h;O+=i){const N=r[O],V=r[O+1];N<v&&(v=N),V<E&&(E=V),N>M&&(M=N),V>D&&(D=V)}S=Math.max(M-v,D-E),S=S!==0?32767/S:0}return lm(m,_,i,v,E,S,0),_}function gx(r,e,i,a,h){let m;if(h===(function(_,v,E,S){let M=0;for(let D=v,O=E-S;D<E;D+=S)M+=(_[O]-_[D])*(_[D+1]+_[O+1]),O=D;return M})(r,e,i,a)>0)for(let _=e;_<i;_+=a)m=Uh(_/a|0,r[_],r[_+1],m);else for(let _=i-a;_>=e;_-=a)m=Uh(_/a|0,r[_],r[_+1],m);return m&&um(m,m.next)&&(hm(m),m=m.next),m}function jd(r,e){if(!r)return r;e||(e=r);let i,a=r;do if(i=!1,a.steiner||!um(a,a.next)&&Bs(a.prev,a,a.next)!==0)a=a.next;else{if(hm(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function lm(r,e,i,a,h,m,_){if(!r)return;!_&&m&&(function(E,S,M,D){let O=E;do O.z===0&&(O.z=Pg(O.x,O.y,S,M,D)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==E);O.prevZ.nextZ=null,O.prevZ=null,(function(N){let V,$=1;do{let Z,K=N;N=null;let ne=null;for(V=0;K;){V++;let ae=K,ue=0;for(let _e=0;_e<$&&(ue++,ae=ae.nextZ,ae);_e++);let Te=$;for(;ue>0||Te>0&&ae;)ue!==0&&(Te===0||!ae||K.z<=ae.z)?(Z=K,K=K.nextZ,ue--):(Z=ae,ae=ae.nextZ,Te--),ne?ne.nextZ=Z:N=Z,Z.prevZ=ne,ne=Z;K=ae}ne.nextZ=null,$*=2}while(V>1)})(O)})(r,a,h,m);let v=r;for(;r.prev!==r.next;){const E=r.prev,S=r.next;if(m?mv(r,a,h,m):Is(r))e.push(E.i,r.i,S.i),hm(r),r=S.next,v=S.next;else if((r=S)===v){_?_===1?lm(r=Ia(jd(r),e),e,i,a,h,m,2):_===2&&Z1(r,e,i,a,h,m):lm(jd(r),e,i,a,h,m,1);break}}}function Is(r){const e=r.prev,i=r,a=r.next;if(Bs(e,i,a)>=0)return!1;const h=e.x,m=i.x,_=a.x,v=e.y,E=i.y,S=a.y,M=Math.min(h,m,_),D=Math.min(v,E,S),O=Math.max(h,m,_),N=Math.max(v,E,S);let V=a.next;for(;V!==e;){if(V.x>=M&&V.x<=O&&V.y>=D&&V.y<=N&&cm(h,v,m,E,_,S,V.x,V.y)&&Bs(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function mv(r,e,i,a){const h=r.prev,m=r,_=r.next;if(Bs(h,m,_)>=0)return!1;const v=h.x,E=m.x,S=_.x,M=h.y,D=m.y,O=_.y,N=Math.min(v,E,S),V=Math.min(M,D,O),$=Math.max(v,E,S),Z=Math.max(M,D,O),K=Pg(N,V,e,i,a),ne=Pg($,Z,e,i,a);let ae=r.prevZ,ue=r.nextZ;for(;ae&&ae.z>=K&&ue&&ue.z<=ne;){if(ae.x>=N&&ae.x<=$&&ae.y>=V&&ae.y<=Z&&ae!==h&&ae!==_&&cm(v,M,E,D,S,O,ae.x,ae.y)&&Bs(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,ue.x>=N&&ue.x<=$&&ue.y>=V&&ue.y<=Z&&ue!==h&&ue!==_&&cm(v,M,E,D,S,O,ue.x,ue.y)&&Bs(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ae&&ae.z>=K;){if(ae.x>=N&&ae.x<=$&&ae.y>=V&&ae.y<=Z&&ae!==h&&ae!==_&&cm(v,M,E,D,S,O,ae.x,ae.y)&&Bs(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;ue&&ue.z<=ne;){if(ue.x>=N&&ue.x<=$&&ue.y>=V&&ue.y<=Z&&ue!==h&&ue!==_&&cm(v,M,E,D,S,O,ue.x,ue.y)&&Bs(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function Ia(r,e){let i=r;do{const a=i.prev,h=i.next.next;!um(a,h)&&vv(a,i,i.next,h)&&Lg(a,h)&&Lg(h,a)&&(e.push(a.i,i.i,h.i),hm(i),hm(i.next),i=r=h),i=i.next}while(i!==r);return jd(i)}function Z1(r,e,i,a,h,m){let _=r;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&yv(_,v)){let E=yx(_,v);return _=jd(_,_.next),E=jd(E,E.next),lm(_,e,i,a,h,m,0),void lm(E,e,i,a,h,m,0)}v=v.next}_=_.next}while(_!==r)}function _x(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function X1(r,e){const i=(function(h,m){let _=m;const v=h.x,E=h.y;let S,M=-1/0;if(um(h,_))return _;do{if(um(h,_.next))return _.next;if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){const $=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if($<=v&&$>M&&(M=$,S=_.x<_.next.x?_:_.next,$===v))return S}_=_.next}while(_!==m);if(!S)return null;const D=S,O=S.x,N=S.y;let V=1/0;_=S;do{if(v>=_.x&&_.x>=O&&v!==_.x&&_v(E<N?v:M,E,O,N,E<N?M:v,E,_.x,_.y)){const $=Math.abs(E-_.y)/(v-_.x);Lg(_,h)&&($<V||$===V&&(_.x>S.x||_.x===S.x&&gv(S,_)))&&(S=_,V=$)}_=_.next}while(_!==D);return S})(r,e);if(!i)return e;const a=yx(i,r);return jd(a,a.next),jd(i,i.next)}function gv(r,e){return Bs(r.prev,r,e.prev)<0&&Bs(e.next,r,r.next)<0}function Pg(r,e,i,a,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function W_(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function _v(r,e,i,a,h,m,_,v){return(h-_)*(e-v)>=(r-_)*(m-v)&&(r-_)*(a-v)>=(i-_)*(e-v)&&(i-_)*(m-v)>=(h-_)*(a-v)}function cm(r,e,i,a,h,m,_,v){return!(r===_&&e===v)&&_v(r,e,i,a,h,m,_,v)}function yv(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,a){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==a.i&&h.next.i!==a.i&&vv(h,h.next,i,a))return!0;h=h.next}while(h!==i);return!1})(r,e)&&(Lg(r,e)&&Lg(e,r)&&(function(i,a){let h=i,m=!1;const _=(i.x+a.x)/2,v=(i.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==i);return m})(r,e)&&(Bs(r.prev,r,e.prev)||Bs(r,e.prev,e))||um(r,e)&&Bs(r.prev,r,r.next)>0&&Bs(e.prev,e,e.next)>0)}function Bs(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function um(r,e){return r.x===e.x&&r.y===e.y}function vv(r,e,i,a){const h=Og(Bs(r,e,i)),m=Og(Bs(r,e,a)),_=Og(Bs(i,a,r)),v=Og(Bs(i,a,e));return h!==m&&_!==v||!(h!==0||!Z_(r,i,e))||!(m!==0||!Z_(r,a,e))||!(_!==0||!Z_(i,r,a))||!(v!==0||!Z_(i,e,a))}function Z_(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Og(r){return r>0?1:r<0?-1:0}function Lg(r,e){return Bs(r.prev,r,r.next)<0?Bs(r,e,r.next)>=0&&Bs(r,r.prev,e)>=0:Bs(r,e,r.prev)<0||Bs(r,r.next,e)<0}function yx(r,e){const i=X_(r.i,r.x,r.y),a=X_(e.i,e.x,e.y),h=r.next,m=e.prev;return r.next=e,e.prev=r,i.next=h,h.prev=i,a.next=i,i.prev=a,m.next=a,a.prev=m,a}function Uh(r,e,i,a){const h=X_(r,e,i);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function hm(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function X_(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Zf(r,e){const i=r.length;if(i<=1)return[r];const a=[];let h,m;for(let _=0;_<i;_++){const v=sn(r[_]);v!==0&&(r[_].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(h&&a.push(h),h=[r[_]]):h.push(r[_]))}if(h&&a.push(h),e>1)for(let _=0;_<a.length;_++)a[_].length<=e||(Ka(a[_],e,1,a[_].length-1,K1),a[_]=a[_].slice(0,e));return a}function K1(r,e){return e.area-r.area}function vx(r,e,i=1){if(!r)return null;const a=typeof r=="string"?fo.from(r).getPrimary():r.getPrimary(),h=typeof r=="string"?null:r.getSecondary();for(const m of[a,h]){if(!m)continue;const _=m.id.toString();e.has(_)||e.set(_,[]),m.scaleSelf(i),e.get(_).push(m)}return{primary:a.toString(),secondary:h?h.toString():null}}function K_(r,e,i,a){const h=a.patternDependencies;let m=!1;for(const _ of e){const v=_.paint.get(`${r}-pattern`);v.isConstant()||(m=!0),vx(v.constantOr(null),h,i)&&(m=!0)}return m}function zg(r,e,i,a,h,m){const _=m.patternDependencies;for(const v of e){const E=v.paint.get(`${r}-pattern`).value;if(E.kind!=="constant"){let S=E.evaluate({zoom:a},i,{},m.availableImages);S=S&&S.name?S.name:S;const M=vx(S,_,h);if(!M)continue;const{primary:D,secondary:O}=M;D&&(i.patterns[v.id]=[D,O].filter(Boolean))}}return i}class Y_{constructor(){this.polygons=new Map}add(e,...i){const a=this.polygons.get(e);a?a.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class jh{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Nt&&i>=Nt}static evaluate(e){if(e.length===0)return new jh;let i=[];for(const E of e)i.push(...E.portals);if(i.length===0)return new jh;for(const E of i){const S=E.va,M=E.vb;(jh.isOnBorder(S.x,M.x)||jh.isOnBorder(S.y,M.y))&&(E.type="border")}const a=i.filter((E=>E.type!=="unevaluated")),h=i.filter((E=>E.type==="unevaluated"));if(h.length===0)return new jh;h.sort(((E,S)=>E.hash===S.hash?E.isTunnel===S.isTunnel?0:E.isTunnel?-1:1:E.hash<S.hash?1:-1)),i=a.concat(h);let m=a.length,_=m,v=m;do if(_++,_===i.length||i[m].hash!==i[_].hash){if(_-m==2){v<m&&(i[v]=i[m],i[m]=null);const E=i[v],S=i[_-1];E.type=E.isTunnel!==S.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:S.connection.a},v++}m=_}while(m!==i.length);return i.splice(v),i.sort(((E,S)=>E.hash<S.hash?1:-1)),{portals:i}}}Lt(jh,"ElevationPortalGraph"),Lt(Y_,"ElevationPolygons");class Lc{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,i,a){let h=e[2];a!=null&&(h*=a);const m=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,_=this.vertexLookup.get(m);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(m,v);const E=Math.trunc(16384*i[0]),S=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(E,S,M),v}addTriangle(e,i,a){this.outIndices.emplaceBack(e,i,a)}addTriangles(e,i,a){if(e.length===0)return;const h=a.length===1,m=ze(),_=ze();for(let v=0;v<e.length;v+=3){const E=i[e[v+0]],S=i[e[v+1]],M=i[e[v+2]],D=h?a[0]:a[e[v+1]],O=h?a[0]:a[e[v+2]];oi(m,E.x,E.y,h?a[0]:a[e[v+0]]);const N=this.addVertex(m,_);oi(m,S.x,S.y,D);const V=this.addVertex(m,_);oi(m,M.x,M.y,O);const $=this.addVertex(m,_);this.outIndices.emplaceBack(N,V,$)}}addQuad(e,i,a,h,m,_){const v=this.addVertex(e,m,_),E=this.addVertex(i,m,_),S=this.addVertex(a,m,_),M=this.addVertex(h,m,_);this.addTriangle(v,E,S),this.addTriangle(S,M,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Ca{constructor(e,i,a,h){this.unevaluatedPortals=new jh,this.portalPolygons=new Y_,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Ff,this.vertexNormals=new Gp,this.indexArray=new Cr,this.tileToMeters=Se(e),this.bridgeProgramConfigurations=new El(i,{zoom:a,lut:h},(m=>m!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new El(i,{zoom:a,lut:h},(m=>m!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const a=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(i[h]);return a}addTriangles(e,i,a){const h=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of e)h.push(m+i)}addRenderableRing(e,i,a,h,m,_){const v=[new St(m.min.x,m.min.y),new St(m.max.x,m.min.y),new St(m.max.x,m.max.y),new St(m.min.x,m.max.y)];for(let E=0;E<a-1;E++){const S=i+E,M=S+1,D=this.unevalVertices[S],O=this.unevalVertices[M];if(!(D.x>=m.min.x&&D.x<=m.max.x&&D.y>=m.min.y&&D.y<=m.max.y||O.x>=m.min.x&&O.x<=m.max.x&&O.y>=m.min.y&&O.y<=m.max.y||Jr(D,O,v))||this.isOnBorder(D.x,O.x)||this.isOnBorder(D.y,O.y))continue;const N=Ca.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[M]);let V,$=this.vertexHashLookup.get(Ca.computePosHash(D));$!=null?V=$.next:($=this.vertexHashLookup.get(Ca.computePosHash(O)),V=$!=null?$.prev:N),this.unevalEdges.push({polygonIdx:e,a:S,b:M,hash:N,portalHash:V,isTunnel:h,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,i,a,h,m){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:m});const _=i[0];this.vertexHashLookup.clear();let v=Ca.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let E=0;E<_.length-1;E++){const S=_[E+0],M=_[E+1],D=Co(M.x-S.x,M.y-S.y),O=dr(D);if(O===0)continue;let N="unevaluated";const V=h.pointElevation(S),$=h.pointElevation(M);Math.abs(V)<.01&&Math.abs($)<.01?N="entrance":(this.isOnBorder(S.x,M.x)||this.isOnBorder(S.y,M.y))&&(N="border");const Z=Ca.computeEdgeHash(S,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:S,vb:M,vab:D,length:O,hash:Z,isTunnel:a,type:N});const K=Ca.computePosHash(S);this.vertexHashLookup.set(K,{prev:v,next:Z}),v=Z}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=O=>{O.primitiveLength=this.indexArray.length-O.primitiveOffset},h=new Lc(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const m=i(),_=i(),v=i(),E=(O,N)=>{O.sort((($,Z)=>$.type===N&&Z.type!==N?-1:$.type!==N&&Z.type===N?1:0));const V=O.findIndex(($=>$.type!==N));return V>=0?V:O.length};let S=0;this.unevalEdges.length>0&&(S=E(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),a(v);const M=i(),D=i();if(this.unevalEdges.length>0){const O=this.unevalEdges.splice(S),N=E(O,"tunnel")+S;this.unevalEdges.push(...O),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:N})}a(M),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(D),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(_),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(m),this.maskSegments=Lr.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=Lr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=Lr.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=Lr.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=Lr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,i,a,h,m,_,v,E){this.bridgeProgramConfigurations.updatePaintArrays(e,i,m,a,h,_,v,E),this.tunnelProgramConfigurations.updatePaintArrays(e,i,m,a,h,_,v,E)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,W1.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,mx.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,h,m){const _=(v,E)=>{for(let S=0;S<E.length-1;S++){const M=E[S].featureIndex,D=E[S+1].vertexStart,O=e.feature(M);v.populatePaintArrays(D,O,M,{},a,i,h,void 0,m)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,h,m){const _=new Map;for(let v=h;v<m;v++){const E=a[v],S=E.a,M=E.b,D=Ca.computePosHash(e[S]),O=Ca.computePosHash(e[M]);let N=_.get(D);N||(N={},_.set(D,N));let V=_.get(O);V||(V={},_.set(O,V)),i[S]<=0&&i[M]<=0||(N.to=M,V.from=S)}return _}isTerminalVertex(e,i){const a=Ca.computePosHash(this.unevalVertices[e]),h=i.get(a);return!h||!h.from||!h.to}constructBridgeStructures(e,i,a,h,m,_){e.clearVertexLookup();const v=this.computeVertexConnections(i,a,h,m.min,m.max),E=1/_,S=.5*E,M=(jt,Dt)=>oi(jt,i[Dt].x,i[Dt].y,a[Dt]*E),D=ze(),O=ze(),N=ze(),V=ze(),$=ze(),Z=(jt,Dt)=>{const vt=v.get(Ca.computePosHash(i[Dt])),Mt=vt.from,ot=vt.to;if(!Mt||!ot)return;M(D,Mt),M(O,Dt),M(N,ot),Ds(V),Us(D,O)||(Dr($,O,D),Ki(V,$)),Us(N,O)||(Dr($,N,O),wi(V,V,Ki($,$)));const et=hs(V);return et>0?ai(jt,V,1/et):void 0};let K=Number.POSITIVE_INFINITY;this.sortSubarray(h,m.min,m.max,((jt,Dt)=>jt.featureInfo.featureIndex-Dt.featureInfo.featureIndex));const ne=ze(),ae=ze(),ue=ze(),Te=ze(),_e=ze(),Ie=ze(),Me=ze(),Le=ze(),at=ze(),Ge=[ze(),ze(),ze(),ze()],ut=[ze(),ze(),ze(),ze()],gt=[{coord:new St(0,0),height:0},{coord:new St(0,0),height:0}],Et=(jt,Dt)=>jt>Dt;for(let jt=m.min;jt<m.max;jt++){const Dt=h[jt];if(!Dt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(gt,i,a,Dt,Et))continue;const[vt,Mt]=gt;if(oi(ne,vt.coord.x,vt.coord.y,E*vt.height),oi(ae,Mt.coord.x,Mt.coord.y,E*Mt.height),Us(ne,ae))continue;Dr(ue,ae,ne),Ki(ue,ue);const ot=Z(Le,Dt.a)||ue,et=Z(at,Dt.b)||ue;oi(Te,ot[1],-ot[0],0),Ki(Te,Te),oi(_e,et[1],-et[0],0),Ki(_e,_e),Wr(Le,Te,ot),Ki(Ie,Le),Wr(Le,_e,et),Ki(Me,Le),wi(Ge[0],ne,ai(Le,Dr(Le,Te,Ie),S)),wi(Ge[1],ne,ai(Le,wi(Le,Te,Ie),S)),wi(Ge[2],ne,ai(Le,Ie,S)),Ge[3]=ne,wi(ut[0],ae,ai(Le,Dr(Le,_e,Me),S)),wi(ut[1],ae,ai(Le,wi(Le,_e,Me),S)),wi(ut[2],ae,ai(Le,Me,S)),ut[3]=ae,K=this.addFeatureSection(Dt.featureInfo.featureIndex,K,this.bridgeFeatureSections,e);const It=e.addVertex(Ge[0],Te,_),Vt=e.addVertex(Ge[1],Te,_),bt=e.addVertex(ut[0],_e,_),li=e.addVertex(ut[1],_e,_);e.addTriangle(It,Vt,bt),e.addTriangle(Vt,li,bt);const fi=e.addVertex(Ge[1],Ie,_),ni=e.addVertex(Ge[2],Ie,_),Kt=e.addVertex(ut[1],Me,_),ji=e.addVertex(ut[2],Me,_);e.addTriangle(fi,ni,Kt),e.addTriangle(ni,ji,Kt),Mr(Te,Te),Mr(_e,_e);const ii=e.addVertex(Ge[2],Te,_),Ri=e.addVertex(Ge[3],Te,_),qi=e.addVertex(ut[2],_e,_),un=e.addVertex(ut[3],_e,_);e.addTriangle(ii,Ri,qi),e.addTriangle(Ri,un,qi);const Nn=this.isTerminalVertex(Dt.a,v),Zi=this.isTerminalVertex(Dt.b,v);vt.height<.01&&Nn&&e.addQuad(Ge[3],Ge[2],Ge[1],Ge[0],Mr(ot,ot),_),Mt.height<.01&&Zi&&e.addQuad(ut[0],ut[1],ut[2],ut[3],et,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,h,m,_){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const E=(K,ne)=>K.featureInfo.featureIndex-ne.featureInfo.featureIndex;this.sortSubarray(h,m.min,m.max,E),this.sortSubarray(h,_.min,_.max,E);const S=K=>Ki(K,K),M=[{coord:new St(0,0),height:0},{coord:new St(0,0),height:0}],D=(K,ne)=>K<ne,O=ze(),N=ze(),V=ze(),$=ze(),Z=ze();for(let K=m.min;K<m.max;K++){if(!this.prepareEdgePoints(M,i,a,h[K],D))continue;const[ne,ae]=M,ue=S(oi(Z,-(ae.coord.y-ne.coord.y),ae.coord.x-ne.coord.x,0));v=this.addFeatureSection(h[K].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(oi(O,ne.coord.x,ne.coord.y,ne.height),oi(N,ae.coord.x,ae.coord.y,ae.height),oi(V,ae.coord.x,ae.coord.y,h[K].isTunnel?-.1:0),oi($,ne.coord.x,ne.coord.y,h[K].isTunnel?-.1:0),ue)}for(let K=_.min;K<_.max;K++){const ne=h[K];ne.isTunnel&&([ne.a,ne.b]=[ne.b,ne.a]);const ae=i[ne.a],ue=i[ne.b],Te=S(oi(Z,-(ue.y-ae.y),ue.x-ae.x,0));v=this.addFeatureSection(ne.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(oi(O,ue.x,ue.y,0),oi(N,ae.x,ae.y,0),oi(V,ae.x,ae.y,a[ne.a]+4),oi($,ue.x,ue.y,a[ne.b]+4),Te),e.addQuad(oi(O,ae.x,ae.y,0),oi(N,ue.x,ue.y,0),oi(V,ue.x,ue.y,a[ne.b]+4),oi($,ae.x,ae.y,a[ne.a]+4),Te)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,a,h){e.coord.x=i,e.coord.y=a,e.height=h}prepareEdgePoints(e,i,a,h,m){let _=i[h.a].x,v=i[h.a].y,E=i[h.b].x,S=i[h.b].y,M=a[h.a],D=a[h.b];const O=m(M,0),N=m(D,0);if(O&&N)return this.setElevatedPoint(e[0],_,v,M),this.setElevatedPoint(e[1],E,S,D),!0;if(!O&&!N)return!1;if(O){if(!N){const V=D/(D-M);E=Oi(E,_,V),S=Oi(S,v,V),D=Oi(D,M,V)}}else{const V=M/(M-D);_=Oi(_,E,V),v=Oi(v,S,V),M=Oi(M,D,V)}return this.setElevatedPoint(e[0],_,v,M),this.setElevatedPoint(e[1],E,S,D),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((v,E)=>v.hash===E.hash?E.polygonIdx-v.polygonIdx:E.hash>v.hash?1:-1));let a=0,h=0,m=0,_=i[a].polygonIdx;do h++,(h===i.length||i[a].hash!==i[h].hash)&&((h-a==1||i[h-1].polygonIdx!==_)&&(m<a&&(i[m]=i[a],i[a]=null),i[m].type="none",m++),a=h,a!==i.length&&(_=i[a].polygonIdx));while(a!==i.length);if(i.splice(m),i.length!==0&&e.length!==0){i.sort(((S,M)=>S.portalHash<M.portalHash?1:-1));let v=0,E=0;for(;v!==i.length&&E!==e.length;){const S=i[v],M=e[E];S.portalHash>M.hash?v++:M.hash>S.portalHash?E++:(S.type=M.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Nt&&i>=Nt}addFeatureSection(e,i,a,h){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),i}sortSubarray(e,i,a,h){const m=e.slice(i,a);m.sort(h),e.splice(i,m.length,...m)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Ca.computePosHash(e))<<32n|BigInt(Ca.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var xv,bv={exports:{}},wv=(xv||(xv=1,(function(r,e){(function(i){function a(ye,pe){return ye>pe?1:ye<pe?-1:0}var h=function(ye,pe){ye===void 0&&(ye=a),pe===void 0&&(pe=!1),this._compare=ye,this._root=null,this._size=0,this._noDuplicates=!!pe},m={size:{configurable:!0}};function _(ye,pe,ft,Wt,pt){var Qt=pt-Wt;if(Qt>0){var bi=Wt+Math.floor(Qt/2),vi={key:pe[bi],data:ft[bi],parent:ye};return vi.left=_(vi,pe,ft,Wt,bi),vi.right=_(vi,pe,ft,bi+1,pt),vi}return null}function v(ye,pe,ft,Wt,pt){if(!(ft>=Wt)){for(var Qt=ye[ft+Wt>>1],bi=ft-1,vi=Wt+1;;){do bi++;while(pt(ye[bi],Qt)<0);do vi--;while(pt(ye[vi],Qt)>0);if(bi>=vi)break;var Yi=ye[bi];ye[bi]=ye[vi],ye[vi]=Yi,Yi=pe[bi],pe[bi]=pe[vi],pe[vi]=Yi}v(ye,pe,ft,vi,pt),v(ye,pe,vi+1,Wt,pt)}}h.prototype.rotateLeft=function(ye){var pe=ye.right;pe&&(ye.right=pe.left,pe.left&&(pe.left.parent=ye),pe.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=pe:ye.parent.right=pe:this._root=pe,pe&&(pe.left=ye),ye.parent=pe},h.prototype.rotateRight=function(ye){var pe=ye.left;pe&&(ye.left=pe.right,pe.right&&(pe.right.parent=ye),pe.parent=ye.parent),ye.parent?ye===ye.parent.left?ye.parent.left=pe:ye.parent.right=pe:this._root=pe,pe&&(pe.right=ye),ye.parent=pe},h.prototype._splay=function(ye){for(;ye.parent;){var pe=ye.parent;pe.parent?pe.left===ye&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===ye&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===ye&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===ye?this.rotateRight(pe):this.rotateLeft(pe)}},h.prototype.splay=function(ye){for(var pe,ft,Wt,pt,Qt;ye.parent;)(ft=(pe=ye.parent).parent)&&ft.parent?((Wt=ft.parent).left===ft?Wt.left=ye:Wt.right=ye,ye.parent=Wt):(ye.parent=null,this._root=ye),pt=ye.left,Qt=ye.right,ye===pe.left?(ft&&(ft.left===pe?(pe.right?(ft.left=pe.right,ft.left.parent=ft):ft.left=null,pe.right=ft,ft.parent=pe):(pt?(ft.right=pt,pt.parent=ft):ft.right=null,ye.left=ft,ft.parent=ye)),Qt?(pe.left=Qt,Qt.parent=pe):pe.left=null,ye.right=pe,pe.parent=ye):(ft&&(ft.right===pe?(pe.left?(ft.right=pe.left,ft.right.parent=ft):ft.right=null,pe.left=ft,ft.parent=pe):(Qt?(ft.left=Qt,Qt.parent=ft):ft.left=null,ye.right=ft,ft.parent=ye)),pt?(pe.right=pt,pt.parent=pe):pe.right=null,ye.left=pe,pe.parent=ye)},h.prototype.replace=function(ye,pe){ye.parent?ye===ye.parent.left?ye.parent.left=pe:ye.parent.right=pe:this._root=pe,pe&&(pe.parent=ye.parent)},h.prototype.minNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.left;)ye=ye.left;return ye},h.prototype.maxNode=function(ye){if(ye===void 0&&(ye=this._root),ye)for(;ye.right;)ye=ye.right;return ye},h.prototype.insert=function(ye,pe){var ft=this._root,Wt=null,pt=this._compare;if(this._noDuplicates)for(;ft;){if(Wt=ft,pt(ft.key,ye)===0)return;ft=pt(ft.key,ye)<0?ft.right:ft.left}else for(;ft;)Wt=ft,ft=pt(ft.key,ye)<0?ft.right:ft.left;return ft={key:ye,data:pe,left:null,right:null,parent:Wt},Wt?pt(Wt.key,ft.key)<0?Wt.right=ft:Wt.left=ft:this._root=ft,this.splay(ft),this._size++,ft},h.prototype.find=function(ye){for(var pe=this._root,ft=this._compare;pe;){var Wt=ft(pe.key,ye);if(Wt<0)pe=pe.right;else{if(!(Wt>0))return pe;pe=pe.left}}return null},h.prototype.contains=function(ye){for(var pe=this._root,ft=this._compare;pe;){var Wt=ft(ye,pe.key);if(Wt===0)return!0;pe=Wt<0?pe.left:pe.right}return!1},h.prototype.remove=function(ye){var pe=this.find(ye);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var ft=this.minNode(pe.right);ft.parent!==pe&&(this.replace(ft,ft.right),ft.right=pe.right,ft.right.parent=ft),this.replace(pe,ft),ft.left=pe.left,ft.left.parent=ft}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},h.prototype.removeNode=function(ye){if(!ye)return!1;if(this.splay(ye),ye.left)if(ye.right){var pe=this.minNode(ye.right);pe.parent!==ye&&(this.replace(pe,pe.right),pe.right=ye.right,pe.right.parent=pe),this.replace(ye,pe),pe.left=ye.left,pe.left.parent=pe}else this.replace(ye,ye.left);else this.replace(ye,ye.right);return this._size--,!0},h.prototype.erase=function(ye){var pe=this.find(ye);if(pe){this.splay(pe);var ft=pe.left,Wt=pe.right,pt=null;ft&&(ft.parent=null,pt=this.maxNode(ft),this.splay(pt),this._root=pt),Wt&&(ft?pt.right=Wt:this._root=Wt,Wt.parent=pt),this._size--}},h.prototype.pop=function(){var ye=this._root,pe=null;if(ye){for(;ye.left;)ye=ye.left;pe={key:ye.key,data:ye.data},this.remove(ye.key)}return pe},h.prototype.next=function(ye){var pe=ye;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=ye.parent;pe&&pe.right===ye;)ye=pe,pe=pe.parent;return pe},h.prototype.prev=function(ye){var pe=ye;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=ye.parent;pe&&pe.left===ye;)ye=pe,pe=pe.parent;return pe},h.prototype.forEach=function(ye){for(var pe=this._root,ft=[],Wt=!1,pt=0;!Wt;)pe?(ft.push(pe),pe=pe.left):ft.length>0?(ye(pe=ft.pop(),pt++),pe=pe.right):Wt=!0;return this},h.prototype.range=function(ye,pe,ft,Wt){for(var pt=[],Qt=this._compare,bi=this._root;pt.length!==0||bi;)if(bi)pt.push(bi),bi=bi.left;else{if(Qt((bi=pt.pop()).key,pe)>0)break;if(Qt(bi.key,ye)>=0&&ft.call(Wt,bi))return this;bi=bi.right}return this},h.prototype.keys=function(){for(var ye=this._root,pe=[],ft=[],Wt=!1;!Wt;)ye?(pe.push(ye),ye=ye.left):pe.length>0?(ye=pe.pop(),ft.push(ye.key),ye=ye.right):Wt=!0;return ft},h.prototype.values=function(){for(var ye=this._root,pe=[],ft=[],Wt=!1;!Wt;)ye?(pe.push(ye),ye=ye.left):pe.length>0?(ye=pe.pop(),ft.push(ye.data),ye=ye.right):Wt=!0;return ft},h.prototype.at=function(ye){for(var pe=this._root,ft=[],Wt=!1,pt=0;!Wt;)if(pe)ft.push(pe),pe=pe.left;else if(ft.length>0){if(pe=ft.pop(),pt===ye)return pe;pt++,pe=pe.right}else Wt=!0;return null},h.prototype.load=function(ye,pe,ft){if(ye===void 0&&(ye=[]),pe===void 0&&(pe=[]),ft===void 0&&(ft=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Wt=ye.length;return ft&&v(ye,pe,0,Wt-1,this._compare),this._root=_(null,ye,pe,0,Wt),this._size=Wt,this},h.prototype.min=function(){var ye=this.minNode(this._root);return ye?ye.key:null},h.prototype.max=function(){var ye=this.maxNode(this._root);return ye?ye.key:null},h.prototype.isEmpty=function(){return this._root===null},m.size.get=function(){return this._size},h.createTree=function(ye,pe,ft,Wt,pt){return new h(ft,pt).load(ye,pe,Wt)},Object.defineProperties(h.prototype,m);var E=0,S=1,M=2,D=3,O=0,N=1,V=2,$=3;function Z(ye,pe,ft){pe===null?(ye.inOut=!1,ye.otherInOut=!0):(ye.isSubject===pe.isSubject?(ye.inOut=!pe.inOut,ye.otherInOut=pe.otherInOut):(ye.inOut=!pe.otherInOut,ye.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(ye.prevInResult=!K(pe,ft)||pe.isVertical()?pe.prevInResult:pe));var Wt=K(ye,ft);ye.resultTransition=Wt?(function(pt,Qt){var bi,vi=!pt.inOut,Yi=!pt.otherInOut;switch(Qt){case O:bi=vi&&Yi;break;case N:bi=vi||Yi;break;case $:bi=vi^Yi;break;case V:bi=pt.isSubject?vi&&!Yi:Yi&&!vi}return bi?1:-1})(ye,ft):0}function K(ye,pe){switch(ye.type){case E:switch(pe){case O:return!ye.otherInOut;case N:return ye.otherInOut;case V:return ye.isSubject&&ye.otherInOut||!ye.isSubject&&!ye.otherInOut;case $:return!0}break;case M:return pe===O||pe===N;case D:return pe===V;case S:return!1}return!1}var ne=function(ye,pe,ft,Wt,pt){this.left=pe,this.point=ye,this.otherEvent=ft,this.isSubject=Wt,this.type=pt||E,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ae={inResult:{configurable:!0}};function ue(ye,pe){return ye[0]===pe[0]&&ye[1]===pe[1]}ne.prototype.isBelow=function(ye){var pe=this.point,ft=this.otherEvent.point;return this.left?(pe[0]-ye[0])*(ft[1]-ye[1])-(ft[0]-ye[0])*(pe[1]-ye[1])>0:(ft[0]-ye[0])*(pe[1]-ye[1])-(pe[0]-ye[0])*(ft[1]-ye[1])>0},ne.prototype.isAbove=function(ye){return!this.isBelow(ye)},ne.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ae.inResult.get=function(){return this.resultTransition!==0},ne.prototype.clone=function(){var ye=new ne(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ye.contourId=this.contourId,ye.resultTransition=this.resultTransition,ye.prevInResult=this.prevInResult,ye.isExteriorRing=this.isExteriorRing,ye.inOut=this.inOut,ye.otherInOut=this.otherInOut,ye},Object.defineProperties(ne.prototype,ae);var Te=11102230246251565e-32,_e=134217729,Ie=(3+8*Te)*Te;function Me(ye,pe,ft,Wt,pt){var Qt,bi,vi,Yi,zi=pe[0],mi=Wt[0],Gn=0,_r=0;mi>zi==mi>-zi?(Qt=zi,zi=pe[++Gn]):(Qt=mi,mi=Wt[++_r]);var Bi=0;if(Gn<ye&&_r<ft)for(mi>zi==mi>-zi?(vi=Qt-((bi=zi+Qt)-zi),zi=pe[++Gn]):(vi=Qt-((bi=mi+Qt)-mi),mi=Wt[++_r]),Qt=bi,vi!==0&&(pt[Bi++]=vi);Gn<ye&&_r<ft;)mi>zi==mi>-zi?(vi=Qt-((bi=Qt+zi)-(Yi=bi-Qt))+(zi-Yi),zi=pe[++Gn]):(vi=Qt-((bi=Qt+mi)-(Yi=bi-Qt))+(mi-Yi),mi=Wt[++_r]),Qt=bi,vi!==0&&(pt[Bi++]=vi);for(;Gn<ye;)vi=Qt-((bi=Qt+zi)-(Yi=bi-Qt))+(zi-Yi),zi=pe[++Gn],Qt=bi,vi!==0&&(pt[Bi++]=vi);for(;_r<ft;)vi=Qt-((bi=Qt+mi)-(Yi=bi-Qt))+(mi-Yi),mi=Wt[++_r],Qt=bi,vi!==0&&(pt[Bi++]=vi);return Qt===0&&Bi!==0||(pt[Bi++]=Qt),Bi}function Le(ye){return new Float64Array(ye)}var at=33306690738754716e-32,Ge=22204460492503146e-32,ut=11093356479670487e-47,gt=Le(4),Et=Le(8),jt=Le(12),Dt=Le(16),vt=Le(4);function Mt(ye,pe,ft){var Wt=(function(pt,Qt,bi,vi,Yi,zi){var mi=(Qt-zi)*(bi-Yi),Gn=(pt-Yi)*(vi-zi),_r=mi-Gn;if(mi===0||Gn===0||mi>0!=Gn>0)return _r;var Bi=Math.abs(mi+Gn);return Math.abs(_r)>=at*Bi?_r:-(function(Ln,yr,sr,cs,Vr,Sr,cr){var Zn,Qi,Xn,Ar,ki,Vn,Ur,xs,Cs,Zs,jr,Ns,Il,Vs,ic,ua,du,Cl,nc=Ln-Vr,ha=sr-Vr,rc=yr-Sr,fu=cs-Sr;gt[0]=(ic=(xs=nc-(Ur=(Vn=_e*nc)-(Vn-nc)))*(Zs=fu-(Cs=(Vn=_e*fu)-(Vn-fu)))-((Vs=nc*fu)-Ur*Cs-xs*Cs-Ur*Zs))-((jr=ic-(du=(xs=rc-(Ur=(Vn=_e*rc)-(Vn-rc)))*(Zs=ha-(Cs=(Vn=_e*ha)-(Vn-ha)))-((ua=rc*ha)-Ur*Cs-xs*Cs-Ur*Zs)))+(ki=ic-jr))+(ki-du),gt[1]=(Il=Vs-((Ns=Vs+jr)-(ki=Ns-Vs))+(jr-ki))-((jr=Il-ua)+(ki=Il-jr))+(ki-ua),gt[2]=Ns-((Cl=Ns+jr)-(ki=Cl-Ns))+(jr-ki),gt[3]=Cl;var Bo=(function(Im,Zd){for(var fb=Zd[0],xy=1;xy<4;xy++)fb+=Zd[xy];return fb})(0,gt),qa=Ge*cr;if(Bo>=qa||-Bo>=qa||(Zn=Ln-(nc+(ki=Ln-nc))+(ki-Vr),Xn=sr-(ha+(ki=sr-ha))+(ki-Vr),Qi=yr-(rc+(ki=yr-rc))+(ki-Sr),Ar=cs-(fu+(ki=cs-fu))+(ki-Sr),Zn===0&&Qi===0&&Xn===0&&Ar===0)||(qa=ut*cr+Ie*Math.abs(Bo),(Bo+=nc*Ar+fu*Zn-(rc*Xn+ha*Qi))>=qa||-Bo>=qa))return Bo;vt[0]=(ic=(xs=Zn-(Ur=(Vn=_e*Zn)-(Vn-Zn)))*(Zs=fu-(Cs=(Vn=_e*fu)-(Vn-fu)))-((Vs=Zn*fu)-Ur*Cs-xs*Cs-Ur*Zs))-((jr=ic-(du=(xs=Qi-(Ur=(Vn=_e*Qi)-(Vn-Qi)))*(Zs=ha-(Cs=(Vn=_e*ha)-(Vn-ha)))-((ua=Qi*ha)-Ur*Cs-xs*Cs-Ur*Zs)))+(ki=ic-jr))+(ki-du),vt[1]=(Il=Vs-((Ns=Vs+jr)-(ki=Ns-Vs))+(jr-ki))-((jr=Il-ua)+(ki=Il-jr))+(ki-ua),vt[2]=Ns-((Cl=Ns+jr)-(ki=Cl-Ns))+(jr-ki),vt[3]=Cl;var Wd=Me(4,gt,4,vt,Et);vt[0]=(ic=(xs=nc-(Ur=(Vn=_e*nc)-(Vn-nc)))*(Zs=Ar-(Cs=(Vn=_e*Ar)-(Vn-Ar)))-((Vs=nc*Ar)-Ur*Cs-xs*Cs-Ur*Zs))-((jr=ic-(du=(xs=rc-(Ur=(Vn=_e*rc)-(Vn-rc)))*(Zs=Xn-(Cs=(Vn=_e*Xn)-(Vn-Xn)))-((ua=rc*Xn)-Ur*Cs-xs*Cs-Ur*Zs)))+(ki=ic-jr))+(ki-du),vt[1]=(Il=Vs-((Ns=Vs+jr)-(ki=Ns-Vs))+(jr-ki))-((jr=Il-ua)+(ki=Il-jr))+(ki-ua),vt[2]=Ns-((Cl=Ns+jr)-(ki=Cl-Ns))+(jr-ki),vt[3]=Cl;var Am=Me(Wd,Et,4,vt,jt);vt[0]=(ic=(xs=Zn-(Ur=(Vn=_e*Zn)-(Vn-Zn)))*(Zs=Ar-(Cs=(Vn=_e*Ar)-(Vn-Ar)))-((Vs=Zn*Ar)-Ur*Cs-xs*Cs-Ur*Zs))-((jr=ic-(du=(xs=Qi-(Ur=(Vn=_e*Qi)-(Vn-Qi)))*(Zs=Xn-(Cs=(Vn=_e*Xn)-(Vn-Xn)))-((ua=Qi*Xn)-Ur*Cs-xs*Cs-Ur*Zs)))+(ki=ic-jr))+(ki-du),vt[1]=(Il=Vs-((Ns=Vs+jr)-(ki=Ns-Vs))+(jr-ki))-((jr=Il-ua)+(ki=Il-jr))+(ki-ua),vt[2]=Ns-((Cl=Ns+jr)-(ki=Cl-Ns))+(jr-ki),vt[3]=Cl;var vy=Me(Am,jt,4,vt,Dt);return Dt[vy-1]})(pt,Qt,bi,vi,Yi,zi,Bi)})(ye[0],ye[1],pe[0],pe[1],ft[0],ft[1]);return Wt>0?-1:Wt<0?1:0}function ot(ye,pe){var ft=ye.point,Wt=pe.point;return ft[0]>Wt[0]?1:ft[0]<Wt[0]?-1:ft[1]!==Wt[1]?ft[1]>Wt[1]?1:-1:(function(pt,Qt,bi,vi){return pt.left!==Qt.left?pt.left?1:-1:Mt(bi,pt.otherEvent.point,Qt.otherEvent.point)!==0?pt.isBelow(Qt.otherEvent.point)?-1:1:!pt.isSubject&&Qt.isSubject?1:-1})(ye,pe,ft)}function et(ye,pe,ft){var Wt=new ne(pe,!1,ye,ye.isSubject),pt=new ne(pe,!0,ye.otherEvent,ye.isSubject);return ue(ye.point,ye.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ye),Wt.contourId=pt.contourId=ye.contourId,ot(pt,ye.otherEvent)>0&&(ye.otherEvent.left=!0,pt.left=!1),ye.otherEvent.otherEvent=pt,ye.otherEvent=Wt,ft.push(pt),ft.push(Wt),ft}function It(ye,pe){return ye[0]*pe[1]-ye[1]*pe[0]}function Vt(ye,pe){return ye[0]*pe[0]+ye[1]*pe[1]}function bt(ye,pe,ft){var Wt=(function(Yi,zi,mi,Gn,_r){var Bi=[zi[0]-Yi[0],zi[1]-Yi[1]],Ln=[Gn[0]-mi[0],Gn[1]-mi[1]];function yr(Vn,Ur,xs){return[Vn[0]+Ur*xs[0],Vn[1]+Ur*xs[1]]}var sr=[mi[0]-Yi[0],mi[1]-Yi[1]],cs=It(Bi,Ln),Vr=cs*cs,Sr=Vt(Bi,Bi);if(Vr>0){var cr=It(sr,Ln)/cs;if(cr<0||cr>1)return null;var Zn=It(sr,Bi)/cs;return Zn<0||Zn>1?null:cr===0||cr===1?[yr(Yi,cr,Bi)]:Zn===0||Zn===1?[yr(mi,Zn,Ln)]:[yr(Yi,cr,Bi)]}if((Vr=(cs=It(sr,Bi))*cs)>0)return null;var Qi=Vt(Bi,sr)/Sr,Xn=Qi+Vt(Bi,Ln)/Sr,Ar=Math.min(Qi,Xn),ki=Math.max(Qi,Xn);return Ar<=1&&ki>=0?Ar===1?[yr(Yi,Ar>0?Ar:0,Bi)]:ki===0?[yr(Yi,ki<1?ki:1,Bi)]:[yr(Yi,Ar>0?Ar:0,Bi),yr(Yi,ki<1?ki:1,Bi)]:null})(ye.point,ye.otherEvent.point,pe.point,pe.otherEvent.point),pt=Wt?Wt.length:0;if(pt===0||pt===1&&(ue(ye.point,pe.point)||ue(ye.otherEvent.point,pe.otherEvent.point))||pt===2&&ye.isSubject===pe.isSubject)return 0;if(pt===1)return ue(ye.point,Wt[0])||ue(ye.otherEvent.point,Wt[0])||et(ye,Wt[0],ft),ue(pe.point,Wt[0])||ue(pe.otherEvent.point,Wt[0])||et(pe,Wt[0],ft),1;var Qt=[],bi=!1,vi=!1;return ue(ye.point,pe.point)?bi=!0:ot(ye,pe)===1?Qt.push(pe,ye):Qt.push(ye,pe),ue(ye.otherEvent.point,pe.otherEvent.point)?vi=!0:ot(ye.otherEvent,pe.otherEvent)===1?Qt.push(pe.otherEvent,ye.otherEvent):Qt.push(ye.otherEvent,pe.otherEvent),bi&&vi||bi?(pe.type=S,ye.type=pe.inOut===ye.inOut?M:D,bi&&!vi&&et(Qt[1].otherEvent,Qt[0].point,ft),2):vi?(et(Qt[0],Qt[1].point,ft),3):Qt[0]!==Qt[3].otherEvent?(et(Qt[0],Qt[1].point,ft),et(Qt[1],Qt[2].point,ft),3):(et(Qt[0],Qt[1].point,ft),et(Qt[3].otherEvent,Qt[2].point,ft),3)}function li(ye,pe){if(ye===pe)return 0;if(Mt(ye.point,ye.otherEvent.point,pe.point)!==0||Mt(ye.point,ye.otherEvent.point,pe.otherEvent.point)!==0)return ue(ye.point,pe.point)?ye.isBelow(pe.otherEvent.point)?-1:1:ye.point[0]===pe.point[0]?ye.point[1]<pe.point[1]?-1:1:ot(ye,pe)===1?pe.isAbove(ye.point)?-1:1:ye.isBelow(pe.point)?-1:1;if(ye.isSubject!==pe.isSubject)return ye.isSubject?-1:1;var ft=ye.point,Wt=pe.point;return ft[0]===Wt[0]&&ft[1]===Wt[1]?(ft=ye.otherEvent.point)[0]===(Wt=pe.otherEvent.point)[0]&&ft[1]===Wt[1]?0:ye.contourId>pe.contourId?1:-1:ot(ye,pe)===1?1:-1}var fi=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ni(ye,pe,ft,Wt){var pt,Qt=ye+1,bi=pe[ye].point,vi=pe.length;for(Qt<vi&&(pt=pe[Qt].point);Qt<vi&&pt[0]===bi[0]&&pt[1]===bi[1];){if(!ft[Qt])return Qt;++Qt<vi&&(pt=pe[Qt].point)}for(Qt=ye-1;ft[Qt]&&Qt>Wt;)Qt--;return Qt}fi.prototype.isExterior=function(){return this.holeOf==null};var Kt=ii,ji=ii;function ii(ye,pe){if(!(this instanceof ii))return new ii(ye,pe);if(this.data=ye||[],this.length=this.data.length,this.compare=pe||Ri,this.length>0)for(var ft=(this.length>>1)-1;ft>=0;ft--)this._down(ft)}function Ri(ye,pe){return ye<pe?-1:ye>pe?1:0}ii.prototype={push:function(ye){this.data.push(ye),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ye=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ye}},peek:function(){return this.data[0]},_up:function(ye){for(var pe=this.data,ft=this.compare,Wt=pe[ye];ye>0;){var pt=ye-1>>1,Qt=pe[pt];if(ft(Wt,Qt)>=0)break;pe[ye]=Qt,ye=pt}pe[ye]=Wt},_down:function(ye){for(var pe=this.data,ft=this.compare,Wt=this.length>>1,pt=pe[ye];ye<Wt;){var Qt=1+(ye<<1),bi=Qt+1,vi=pe[Qt];if(bi<this.length&&ft(pe[bi],vi)<0&&(Qt=bi,vi=pe[bi]),ft(vi,pt)>=0)break;pe[ye]=vi,ye=Qt}pe[ye]=pt}},Kt.default=ji;var qi=Math.max,un=Math.min,Nn=0;function Zi(ye,pe,ft,Wt,pt,Qt){var bi,vi,Yi,zi,mi,Gn;for(bi=0,vi=ye.length-1;bi<vi;bi++)if(zi=ye[bi+1],mi=new ne(Yi=ye[bi],!1,void 0,pe),Gn=new ne(zi,!1,mi,pe),mi.otherEvent=Gn,Yi[0]!==zi[0]||Yi[1]!==zi[1]){mi.contourId=Gn.contourId=ft,Qt||(mi.isExteriorRing=!1,Gn.isExteriorRing=!1),ot(mi,Gn)>0?Gn.left=!0:mi.left=!0;var _r=Yi[0],Bi=Yi[1];pt[0]=un(pt[0],_r),pt[1]=un(pt[1],Bi),pt[2]=qi(pt[2],_r),pt[3]=qi(pt[3],Bi),Wt.push(mi),Wt.push(Gn)}}var $n=[];function Wn(ye,pe,ft){typeof ye[0][0][0]=="number"&&(ye=[ye]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var Wt=(function(Bi,Ln,yr){var sr=null;return Bi.length*Ln.length==0&&(yr===O?sr=$n:yr===V?sr=Bi:yr!==N&&yr!==$||(sr=Bi.length===0?Ln:Bi)),sr})(ye,pe,ft);if(Wt)return Wt===$n?null:Wt;var pt=[1/0,1/0,-1/0,-1/0],Qt=[1/0,1/0,-1/0,-1/0],bi=(function(Bi,Ln,yr,sr,cs){var Vr,Sr,cr,Zn,Qi,Xn,Ar=new Kt(null,ot);for(cr=0,Zn=Bi.length;cr<Zn;cr++)for(Qi=0,Xn=(Vr=Bi[cr]).length;Qi<Xn;Qi++)(Sr=Qi===0)&&Nn++,Zi(Vr[Qi],!0,Nn,Ar,yr,Sr);for(cr=0,Zn=Ln.length;cr<Zn;cr++)for(Qi=0,Xn=(Vr=Ln[cr]).length;Qi<Xn;Qi++)Sr=Qi===0,cs===V&&(Sr=!1),Sr&&Nn++,Zi(Vr[Qi],!1,Nn,Ar,sr,Sr);return Ar})(ye,pe,pt,Qt,ft);if(Wt=(function(Bi,Ln,yr,sr,cs){var Vr=null;return(yr[0]>sr[2]||sr[0]>yr[2]||yr[1]>sr[3]||sr[1]>yr[3])&&(cs===O?Vr=$n:cs===V?Vr=Bi:cs!==N&&cs!==$||(Vr=Bi.concat(Ln))),Vr})(ye,pe,pt,Qt,ft))return Wt===$n?null:Wt;for(var vi=(function(Bi){var Ln,yr,sr=(function(cr){var Zn,Qi,Xn,Ar,ki=[];for(Qi=0,Xn=cr.length;Qi<Xn;Qi++)((Zn=cr[Qi]).left&&Zn.inResult||!Zn.left&&Zn.otherEvent.inResult)&&ki.push(Zn);for(var Vn=!1;!Vn;)for(Vn=!0,Qi=0,Xn=ki.length;Qi<Xn;Qi++)Qi+1<Xn&&ot(ki[Qi],ki[Qi+1])===1&&(Ar=ki[Qi],ki[Qi]=ki[Qi+1],ki[Qi+1]=Ar,Vn=!1);for(Qi=0,Xn=ki.length;Qi<Xn;Qi++)(Zn=ki[Qi]).otherPos=Qi;for(Qi=0,Xn=ki.length;Qi<Xn;Qi++)(Zn=ki[Qi]).left||(Ar=Zn.otherPos,Zn.otherPos=Zn.otherEvent.otherPos,Zn.otherEvent.otherPos=Ar);return ki})(Bi),cs={},Vr=[],Sr=function(){if(!cs[Ln]){var cr=Vr.length,Zn=(function(ki,Vn,Ur){var xs=new fi;if(ki.prevInResult!=null){var Cs=ki.prevInResult,Zs=Cs.outputContourId;if(Cs.resultTransition>0){var jr=Vn[Zs];if(jr.holeOf!=null){var Ns=jr.holeOf;Vn[Ns].holeIds.push(Ur),xs.holeOf=Ns,xs.depth=Vn[Zs].depth}else Vn[Zs].holeIds.push(Ur),xs.holeOf=Zs,xs.depth=Vn[Zs].depth+1}else xs.holeOf=null,xs.depth=Vn[Zs].depth}else xs.holeOf=null,xs.depth=0;return xs})(sr[Ln],Vr,cr),Qi=function(ki){cs[ki]=!0,ki<sr.length&&sr[ki]&&(sr[ki].outputContourId=cr)},Xn=Ln,Ar=Ln;for(Zn.points.push(sr[Ln].point);Qi(Xn),Qi(Xn=sr[Xn].otherPos),Zn.points.push(sr[Xn].point),!((Xn=ni(Xn,sr,cs,Ar))==Ar||Xn>=sr.length)&&sr[Xn];);Vr.push(Zn)}};for(Ln=0,yr=sr.length;Ln<yr;Ln++)Sr();return Vr})((function(Bi,Ln,yr,sr,cs,Vr){for(var Sr,cr,Zn,Qi=new h(li),Xn=[],Ar=Math.min(sr[2],cs[2]);Bi.length!==0;){var ki=Bi.pop();if(Xn.push(ki),Vr===O&&ki.point[0]>Ar||Vr===V&&ki.point[0]>sr[2])break;if(ki.left){cr=Sr=Qi.insert(ki),Sr=Sr!==(Zn=Qi.minNode())?Qi.prev(Sr):null,cr=Qi.next(cr);var Vn=Sr?Sr.key:null;if(Z(ki,Vn,Vr),cr&&bt(ki,cr.key,Bi)===2&&(Z(ki,Vn,Vr),Z(cr.key,ki,Vr)),Sr&&bt(Sr.key,ki,Bi)===2){var Ur=Sr;Z(Vn,(Ur=Ur!==Zn?Qi.prev(Ur):null)?Ur.key:null,Vr),Z(ki,Vn,Vr)}}else cr=Sr=Qi.find(ki=ki.otherEvent),Sr&&cr&&(Sr=Sr!==Zn?Qi.prev(Sr):null,cr=Qi.next(cr),Qi.remove(ki),cr&&Sr&&bt(Sr.key,cr.key,Bi))}return Xn})(bi,0,0,pt,Qt,ft)),Yi=[],zi=0;zi<vi.length;zi++){var mi=vi[zi];if(mi.isExterior()){for(var Gn=[mi.points],_r=0;_r<mi.holeIds.length;_r++)Gn.push(vi[mi.holeIds[_r]].points);Yi.push(Gn)}}return Yi}var es={UNION:N,DIFFERENCE:V,INTERSECTION:O,XOR:$};i.diff=function(ye,pe){return Wn(ye,pe,V)},i.intersection=function(ye,pe){return Wn(ye,pe,O)},i.operations=es,i.union=function(ye,pe){return Wn(ye,pe,N)},i.xor=function(ye,pe){return Wn(ye,pe,$)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,bv.exports)),bv.exports);function Gd(r,e,i,a){const h=[],m=a===0?(_,v,E,S,M,D)=>{_.push(new St(D,E+(D-v)/(S-v)*(M-E)))}:(_,v,E,S,M,D)=>{_.push(new St(v+(D-E)/(M-E)*(S-v),D))};for(const _ of r){const v=[];for(const E of _){if(E.length<=2)continue;const S=[];for(let O=0;O<E.length-1;O++){const N=E[O].x,V=E[O].y,$=E[O+1].x,Z=E[O+1].y,K=a===0?N:V,ne=a===0?$:Z;K<e?ne>e&&m(S,N,V,$,Z,e):K>i?ne<i&&m(S,N,V,$,Z,i):S.push(E[O]),ne<e&&K>=e&&m(S,N,V,$,Z,e),ne>i&&K<=i&&m(S,N,V,$,Z,i)}let M=E[E.length-1];const D=a===0?M.x:M.y;D>=e&&D<=i&&S.push(M),S.length&&(M=S[S.length-1],S[0].x===M.x&&S[0].y===M.y||S.push(S[0]),v.push(S))}v.length&&h.push(v)}return h}function zc(r,e){const i=dm(r),a=dm([e]),h=wv.intersection(i,a);return h==null?[]:Wu(h)}function xx(r,e){let a=dm(r,65536);const h=[];for(;e.valid();e.next()){const[m,_]=e.get(),v=m.x*65536,E=m.y*65536,S=_.x*65536,M=_.y*65536,D=S-v,O=M-E,N=Math.hypot(D,O);if(N===0)continue;const V=Math.trunc(O/N*3),$=-Math.trunc(D/N*3);h.push([[[v,E],[S,M],[S+V,M+$],[v+V,E+$],[v,E]]])}return h.length>0&&(a=wv.diff(a,h)),Wu(a,1/65536)}function dm(r,e=1){return[r.map((i=>i.map((a=>[a.x*e,a.y*e]))))]}function Wu(r,e=1){return r.map((i=>i.map(((a,h)=>{const m=a.map((_=>new St(_[0]*e,_[1]*e).round()));return h>0&&m.reverse(),m}))))}class Tv{constructor(e,i){this.layoutVertexArray=new Sa,this.indexArray=new Cr,this.lineIndexArray=new il,this.triangleSegments=new Lr,this.lineSegments=new Lr,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Dc)}update(e,i,a,h,m,_,v,E){this.programConfigurations.updatePaintArrays(e,i,m,a,h,_,v,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,$_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,h,m,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,h,m,_,void 0,v)}}class Ev{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Tv(e,!1),this.elevationBufferData=new Tv(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,h){}populate(e,i,a,h){this.hasPattern=K_("fill",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:E,index:S,sourceLayerIndex:M}of e){const D=this.layers[0]._featureFilter.needGeometry,O=Ke(v,D);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),O,a))continue;const N=m?m.evaluate(O,{},a,i.availableImages):void 0,V={id:E,properties:v.properties,type:v.type,sourceLayerIndex:M,index:S,geometry:D?O.geometry:dt(v,a,h),patterns:{},sortKey:N};_.push(V)}m&&_.sort(((v,E)=>v.sortKey-E.sortKey));for(const v of _){const{geometry:E,index:S,sourceLayerIndex:M}=v;if(this.hasPattern){const D=zg("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(D)}else this.addFeature(v,E,S,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[S].feature,E,S,M,this.index)}}update(e,i,a,h,m,_,v){this.bufferData.update(e,i,a,h,m,_,v,this.worldview),this.elevationBufferData.update(e,i,a,h,m,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,h,m,_,v,this.worldview)}addFeatures(e,i,a,h,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,a,h,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,h,m,_=[],v,E){const S=Zf(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,h,a,E):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,a,m,_,h,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,m,_,h,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,a,h,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,h,m,this.worldview))}addElevatedRoadFeature(e,i,a,h,m){const _=new Array,v=Ei.getElevationFeature(e,m);if(!v)return void this.addGeometry(i,this.bufferData);{const S=this.clipPolygonsToTile(i,1);S.length>0&&_.push({polygons:S,elevationFeature:v,elevationTileID:a})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:h};for(const S of _)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ca(S.elevationTileID,this.layers,this.zoom,this.lut));const D=S.elevationFeature.isTunnel();let O=0;e.properties.hasOwnProperty(ri)&&(O=+e.properties[ri]);for(const N of S.polygons)this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,N,D,S.elevationFeature,O)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const M=new pn(a,S.elevationTileID);this.addElevatedGeometry(S.polygons,M,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,E)}}addElevatedGeometry(e,i,a,h,m,_){const v={elevation:a,elevationSampler:i,bias:h,index:m,featureInfo:_},[E,S]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(e,i,a){let h=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,_=null;a&&(_=a.elevationSampler.constantElevation(a.elevation,a.bias),_!=null&&(h=_,m=_));const v=(E,S,M)=>{if(a!=null)if(S.push(E),_!=null)i.elevatedLayoutVertexArray.emplaceBack(_),M.push(_);else{const D=a.elevationSampler.pointElevation(E,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(D),M.push(D),h=Math.min(h,D),m=Math.max(m,D)}};for(const E of e){let S=0;for(const ae of E)S+=ae.length;const M=i.triangleSegments.prepareSegment(S,i.layoutVertexArray,i.indexArray),D=M.vertexLength,O=[],N=[],V=[],$=[],Z=[],K=i.layoutVertexArray.length;for(const ae of E){if(ae.length===0)continue;ae!==E[0]&&N.push(O.length/2);const ue=i.lineSegments.prepareSegment(ae.length,i.layoutVertexArray,i.lineIndexArray),Te=ue.vertexLength;a&&Z.push(i.layoutVertexArray.length-K),v(ae[0],V,$),i.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),i.lineIndexArray.emplaceBack(Te+ae.length-1,Te),O.push(ae[0].x),O.push(ae[0].y);for(let _e=1;_e<ae.length;_e++)v(ae[_e],V,$),i.layoutVertexArray.emplaceBack(ae[_e].x,ae[_e].y),i.lineIndexArray.emplaceBack(Te+_e-1,Te+_e),O.push(ae[_e].x),O.push(ae[_e].y);ue.vertexLength+=ae.length,ue.primitiveLength+=ae.length}const ne=am(O,N);for(let ae=0;ae<ne.length;ae+=3)i.indexArray.emplaceBack(D+ne[ae],D+ne[ae+1],D+ne[ae+2]);if(ne.length>0&&a&&this.elevationMode==="hd-road-base"){const ae=a.elevation.isTunnel(),ue=a.elevation.safeArea,Te=this.elevatedStructures.addVertices(V,$);this.elevatedStructures.addTriangles(ne,Te,ae);const _e=Z.length;if(_e>0){for(let Ie=0;Ie<_e-1;Ie++)this.elevatedStructures.addRenderableRing(a.index,Z[Ie]+Te,Z[Ie+1]-Z[Ie],ae,ue,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,Z[_e-1]+Te,V.length-Z[_e-1],ae,ue,a.featureInfo)}}M.vertexLength+=S,M.primitiveLength+=ne.length/3}return[h,m]}prepareElevatedPolygons(e,i,a){const h=1/Se(a),m=[];for(const _ of e){const v=xx(_,new gr(i,h));m.push(...v)}return m}clipPolygonsToTile(e,i){const a=-i,h=-i,m=Nt+i,_=Nt+i;let v=0;const E=[],S=[];for(;v<e.length;v++){const O=e[v],N=ah(O);(N.min.x>=a&&N.max.x<=m&&N.min.y>=h&&N.max.y<=_?E:S).push(O)}if(E.length===e.length)return e;const M=[new St(a,h),new St(m,h),new St(m,_),new St(a,_),new St(a,h)],D=E;for(const O of S)D.push(...zc(O,M));return D}}let Xf,Sv,bx,wx;Lt(Ev,"FillBucket",{omit:["layers","patternFeatures"]}),Lt(Tv,"FillBufferData"),Lt(Ca,"ElevatedStructures");class Q_{constructor(e,i,a,h){if(this.triangleCount=i.length/3,this.min=new St(0,0),this.max=new St(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[m,_]=[e[0].clone(),e[0].clone()];for(let D=1;D<e.length;++D){const O=e[D];m.x=Math.min(m.x,O.x),m.y=Math.min(m.y,O.y),_.x=Math.max(_.x,O.x),_.y=Math.max(_.y,O.y)}if(h){const D=Math.ceil(Math.max(_.x-m.x,_.y-m.y)/h);a=Math.max(a,D)}if(a===0)return;this.min=m,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const E=Math.max(v.x,v.y)/a;this.cellsX=Math.max(1,Math.ceil(v.x/E)),this.cellsY=Math.max(1,Math.ceil(v.y/E)),this.xScale=1/E,this.yScale=1/E;const S=[];for(let D=0;D<this.triangleCount;D++){const O=e[i[3*D+0]].sub(this.min),N=e[i[3*D+1]].sub(this.min),V=e[i[3*D+2]].sub(this.min),$=Zu(Math.floor(Math.min(O.x,N.x,V.x)),this.xScale,this.cellsX),Z=Zu(Math.floor(Math.max(O.x,N.x,V.x)),this.xScale,this.cellsX),K=Zu(Math.floor(Math.min(O.y,N.y,V.y)),this.yScale,this.cellsY),ne=Zu(Math.floor(Math.max(O.y,N.y,V.y)),this.yScale,this.cellsY),ae=new St(0,0),ue=new St(0,0),Te=new St(0,0),_e=new St(0,0);for(let Ie=K;Ie<=ne;++Ie){ae.y=ue.y=Ie*E,Te.y=_e.y=(Ie+1)*E;for(let Me=$;Me<=Z;++Me)ae.x=Te.x=Me*E,ue.x=_e.x=(Me+1)*E,(Hr(O,N,V,ae,ue,_e)||Hr(O,N,V,ae,_e,Te))&&S.push({cellIdx:Ie*this.cellsX+Me,triIdx:D})}}if(S.length===0)return;S.sort(((D,O)=>D.cellIdx-O.cellIdx||D.triIdx-O.triIdx));let M=0;for(;M<S.length;){const D=S[M].cellIdx,O={start:this.payload.length,len:0};for(;M<S.length&&S[M].cellIdx===D;)++O.len,this.payload.push(S[M++].triIdx);this.cells[D]=O}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Zu(e.x-this.min.x,this.xScale,this.cellsX),h=Zu(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[h*this.cellsX+a];if(m){this._lazyInitLookup();for(let _=0;_<m.len;_++){const v=this.payload[m.start+_],E=Math.floor(v/8),S=1<<v%8;if(!(this.lookup[E]&S)&&(this.lookup[E]|=S,i.push(v),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Zu(e.x-this.min.x,this.xScale,this.cellsX),m=Zu(i.x-this.min.x,this.xScale,this.cellsX),_=Zu(e.y-this.min.y,this.yScale,this.cellsY),v=Zu(i.y-this.min.y,this.yScale,this.cellsY);for(let E=_;E<=v;E++)for(let S=h;S<=m;S++){const M=this.cells[E*this.cellsX+S];if(M)for(let D=0;D<M.len;D++){const O=this.payload[M.start+D],N=Math.floor(O/8),V=1<<O%8;if(!(this.lookup[N]&V)&&(this.lookup[N]|=V,a.push(O),a.length===this.triangleCount))return}}}}function Zu(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Lt(Q_,"TriangleGridIndex");class Tx{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}updateAppearances(e,i,a,h){}populate(e,i,a,h){const m=[];for(const{feature:_,id:v,index:E,sourceLayerIndex:S}of e){const M=this.layers[0]._featureFilter.needGeometry,D=Ke(_,M);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),D,a))continue;const O={id:v,properties:_.properties,type:_.type,sourceLayerIndex:S,index:E,geometry:M?D.geometry:dt(_,a,h),patterns:{}};m.push(O)}for(const _ of m){const{geometry:v,index:E,sourceLayerIndex:S}=_;this.addFeature(_,v,E,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[E].feature,v,E,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,h,m,_,v){}destroy(){}addFeature(e,i,a,h,m,_=[],v){for(const E of Zf(i,2)){const S=[],M=[],D=[],O=new St(1/0,1/0),N=new St(-1/0,-1/0);for(const Z of E)if(Z.length!==0){Z!==E[0]&&D.push(M.length/2);for(let K=0;K<Z.length;K++)M.push(Z[K].x),M.push(Z[K].y),S.push(Z[K]),O.x=Math.min(O.x,Z[K].x),O.y=Math.min(O.y,Z[K].y),N.x=Math.max(N.x,Z[K].x),N.y=Math.max(N.y,Z[K].y)}const V=am(M,D),$=new Q_(S,V,8,256);this.footprints.push({vertices:S,indices:V,grid:$,min:O,max:N})}}}Lt(Tx,"ClipBucket",{omit:["layers"]});const Y1=hn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Q1=hn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ex=hn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),fm=hn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),kg=hn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Sx=hn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),J1=hn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:pm}=Y1,Gh=Number.MAX_SAFE_INTEGER,Av=Gh-1;function Fg(r,e,i,a){return r.order<e||r.order===Gh||!(r.clipMask&i)||(function(h,m){return m.length!==0&&m.find((_=>_===h))===void 0})(a,r.clipScope)}function mm(r,e){return r.x-e.x||r.y-e.y}function J_(r,e){return mm(r.min,e.min)===0&&mm(r.max,e.max)===0}function gm(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function Bg(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!J_(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!Fl(r[i].clipScope,e[i].clipScope))return!1;return!0}function Iv(r,e,i){const a=1/Nt,h=1/(1<<i.canonical.z),m=(e.x*a+i.canonical.x)*h+i.wrap,_=(e.y*a+i.canonical.y)*h;return{min:new St((r.x*a+i.canonical.x)*h+i.wrap,(r.y*a+i.canonical.y)*h),max:new St(m,_)}}function ew(r,e,i){const a=1<<i.canonical.z,h=((e.x-i.wrap)*a-i.canonical.x)*Nt,m=(e.y*a-i.canonical.y)*Nt;return{min:new St(((r.x-i.wrap)*a-i.canonical.x)*Nt,(r.y*a-i.canonical.y)*Nt),max:new St(h,m)}}function ey(r,e,i,a,h,m,_){const v=r.indices,E=r.vertices,S=[];for(let M=a;M<a+h;M+=3){const D=e[i[M+0]+m],O=e[i[M+1]+m],N=e[i[M+2]+m],V=Math.min(D.x,O.x,N.x),$=Math.max(D.x,O.x,N.x),Z=Math.min(D.y,O.y,N.y),K=Math.max(D.y,O.y,N.y);S.length=0,r.grid.query(new St(V,Z),new St($,K),S);for(let ne=0;ne<S.length;ne++){const ae=S[ne];if(Hr(E[v[3*ae+0]],E[v[3*ae+1]],E[v[3*ae+2]],D,O,N,_))return!0}}return!1}function Ax(r,e,i,a){if(!r||!i)return!1;let h=r.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<r.vertices.length)return Ax(i,a,r,e);const m=e.canonical,_=a.canonical,v=Math.pow(2,_.z-m.z);h=r.vertices.map((E=>new St((E.x+m.x*Nt)*v-_.x*Nt,(E.y+m.y*Nt)*v-_.y*Nt)))}return ey(i,h,r.indices,0,r.indices.length,0,0)}function ty(r,e,i,a){const h=Math.pow(2,a.z-i.z);return new St((r+i.x*Nt)*h-a.x*Nt,(e+i.y*Nt)*h-a.y*Nt)}function Cv(r,e){const i=[];e.grid.queryPoint(r,i);const a=e.indices,h=e.vertices;for(let m=0;m<i.length;m++){const _=i[m];if(oo([h[a[3*_+0]],h[a[3*_+1]],h[a[3*_+2]]],r))return!0}return!1}const _m=[new St(0,0),new St(Nt,0),new St(Nt,Nt),new St(0,Nt)];function Ng(r,e){const i=[];let a=[];if(!e||r.length<2)return[r];if(r.length===2)return Jr(r[0],r[1],_m)?[r]:[];for(let h=0;h<r.length+2;h++){const m=r[h%r.length],_=r[(h+1)%r.length],v=Jr(h===0?r[r.length-1]:r[(h-1)%r.length],m,_m),E=Jr(m,_,_m),S=v||E;S&&a.push(m),S&&E||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const ym=At.types,tw=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Vg=["fill-extrusion-flood-light-ground-radius"],iw=Math.pow(2,13),Ix=Math.pow(2,15)-1,Rv=new St(0,1),qh=2147483648,Mv=7,iy=450;function vm(r,e,i,a,h,m,_,v){r.emplaceBack((e<<1)+_,(i<<1)+m,(Math.floor(a*iw)<<1)+h,Math.round(v))}function xm(r,e,i){r.emplaceBack(e.x*Nt,e.y*Nt,i?1:0)}function Kf(r,e,i,a,h,m){r.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+h,m)}function Ug(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Cx{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ny{constructor(){this.centroidXY=new St(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new St(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new St(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new St(this.max.x-this.min.x,this.max.y-this.min.y)}}class ry{constructor(){this.acc=new St(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===Nt)&&i.x===a.x)!=((i.y===0||i.y===Nt)&&i.y===a.y)&&this.processBorderOverlap(i,a),h&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Oi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Nt!=e.x>Nt&&this.addBorderIntersection(1,Oi(i.y,e.y,(Nt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Oi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Nt!=e.y>Nt&&this.addBorderIntersection(3,Oi(i.x,e.x,(Nt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new St(0,0):new St(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function jg(r,e){const i=r.add(e)._unit(),a=J(r.x*i.x+r.y*i.y,-1,1);var h,m,_;return h=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(h)))/4*Ix*((m=r).x*(_=e).y-m.y*_.x<0?-1:1)}const Dv=[r=>r.x<0,r=>r.x>Nt,r=>r.y<0,r=>r.y>Nt];function Rx(r,e,i,a){const h=[4];if(a===0)return h;i._mult(a);const m=r.sub(i),_=e.sub(i),v=[r,e,m,_];for(let E=0;E<4;E++)for(const S of v)if(Dv[E](S)){h.push(E);break}return h}class Gg{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Bf,this.indexArray=new Cr,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut},(i=>Vg.includes(i))),this._segments=new Lr,this.hiddenByLandmarkVertexArray=new mo,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Lr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,h=!1){const m=e.length;if(m>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let E;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const S=e[0],M=e[1];E=jg(S.sub(e[m-1])._perp()._unit(),M.sub(S)._perp()._unit())}for(let S=0;S<m;S++){const M=S===m-1?0:S+1,D=e[S],O=e[M],N=e[M===m-1?0:M+1],V=O.sub(D)._perp()._unit(),$=jg(V,N.sub(O)._perp()._unit()),Z=E,K=$;if(Yf(D,O,i)||h&&$h(D,i)&&$h(O,i)){E=$;continue}const ne=v.vertexLength;Kf(this.vertexArray,D,O,1,1,Z),Kf(this.vertexArray,D,O,1,0,Z),Kf(this.vertexArray,D,O,0,1,K),Kf(this.vertexArray,D,O,0,0,K),v.vertexLength+=4;const ae=Rx(D,O,V,a);for(const ue of ae)this._segmentToGroundQuads[_].push({id:ne,region:ue}),this._segmentToRegionTriCounts[_][ue]+=2,v.primitiveLength+=2;E=$}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort(((h,m)=>h.region-m.region));for(let a=0;a<i;a++){const h=this._segmentToGroundQuads[a],m=e[a],_=this._segmentToRegionTriCounts[a];_.reduce(((E,S)=>E+S),0);let v=0;for(let E=0;E<=4;E++){const S=_[E];if(S!==0){let M=this.regionSegments[E];M||(M=this.regionSegments[E]=new Lr);const D={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+v,vertexLength:m.vertexLength,primitiveLength:S};M.get().push(D)}v+=S}for(let E=0;E<h.length;E++){const S=h[E].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,h,m,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,h,m,_,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Q1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Ex.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,h,m,_,v,E){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,h,m,_,v,E)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&qh))}updateHiddenByLandmarkRange(e,i,a){if(!this.hasData())return;const h=i+e;if(i!==0){for(let m=e;m<h;++m)this.hiddenByLandmarkVertexArray.emplace(m,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Sx.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class uu{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Cr,this.footprintVertices=new Sa,this.footprintSegments=[],this.layoutVertexArray=new Mh,this.centroidVertexArray=new Qp,this.wallVertexArray=new gg,this.indexArray=new Cr,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut},(i=>tw.includes(i))),this.segments=new Lr,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new Gg(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,h){}populate(e,i,a,h){this.features=[],this.hasPattern=K_("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Se(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:_,index:v,sourceLayerIndex:E}of e){const S=this.layers[0]._featureFilter.needGeometry,M=Ke(m,S);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),M,a))continue;const D={id:_,sourceLayerIndex:E,index:v,geometry:S?M.geometry:dt(m,a,h),properties:m.properties,type:m.type,patterns:{}},O=this.layoutVertexArray.length,N=ym[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:zg("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const V of D.geometry)for(const $ of Ng(V,N))this.addFeature(m.id,D,[$],v,a,{},i.availableImages,h,i.brightness);else this.addFeature(m.id,D,D.geometry,v,a,{},i.availableImages,h,i.brightness);i.featureIndex.insert(m,D.geometry,v,E,this.index,O)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,h,m,_){for(const{featureId:v,feature:E}of this.features){const S=ym[E.type]==="Polygon",{geometry:M}=E;if(this.wallMode)for(const D of M)for(const O of Ng(D,S))this.addFeature(v,E,[O],E.index,i,a,h,m,_);else this.addFeature(v,E,M,E.index,i,a,h,m,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,h,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,a,h,_,v,this.worldview),this.groundEffect.update(e,i,m,a,h,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,kg.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,J1.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,fm.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,h,m,_,v,E,S){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,D=[new St(0,0),new St(Nt,Nt)],O=E.projection,N=O.name==="globe",V=this.wallMode||ym[i.type]==="Polygon",$=new ry;$.centroidDataIndex=this.centroidData.length;const Z=new ny;Z.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(Z.buildingId=i.properties.building_id);const K=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},m)<=0,ne=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},m);let ae;if(Z.height=ne,Z.vertexArrayOffset=this.layoutVertexArray.length,Z.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Od),this.wallMode){if(N)return void gi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;ae=(function(Ge){const ut=Ge[0].x===Ge[Ge.length-1].x&&Ge[0].y===Ge[Ge.length-1].y;(function(ni){let Kt=0;const ji=ni.length;for(let ii=0;ii<ji;ii++)Kt+=(ni[(ii+1)%ji].x-ni[ii].x)*(ni[(ii+1)%ji].y+ni[ii].y);return Kt>=0})(Ge)||(Ge=Ge.reverse());const Et={geometry:[],joinNormals:[],indices:[]},jt=[],Dt=[],vt=[];let Mt=Ge.length;for(;Mt>=2&&Ge[Mt-1].equals(Ge[Mt-2]);)Mt--;if(Mt<(ut?3:2))return Et;let ot,et,It,Vt,bt,li=0;for(;li<Mt-1&&Ge[li].equals(Ge[li+1]);)li++;ut&&(ot=Ge[Mt-2],bt=Ge[li].sub(ot)._unit()._perp());for(let ni=li;ni<Mt;ni++){if(It=ni===Mt-1?ut?Ge[li+1]:void 0:Ge[ni+1],It&&Ge[ni].equals(It))continue;bt&&(Vt=bt),ot&&(et=ot),ot=Ge[ni],bt=It?It.sub(ot)._unit()._perp():Vt,Vt=Vt||bt;let Kt=Vt.add(bt);Kt.x===0&&Kt.y===0||Kt._unit();const ji=Kt.x*bt.x+Kt.y*bt.y,ii=ji!==0?1/ji:1/0,Ri=Vt.x*bt.y-Vt.y*bt.x>0;let qi="miter";const un=2;qi==="miter"&&ii>un&&(qi="bevel"),qi==="bevel"&&(ii>100&&(qi="flipbevel"),ii<un&&(qi="miter"));const Nn=(Zi,$n,Wn,es)=>{const ye=new St(Zi.x,Zi.y),pe=new St(Zi.x,Zi.y);ye.x+=$n.x*es,ye.y+=$n.y*es,pe.x-=$n.x*Math.max(Wn,1),pe.y-=$n.y*Math.max(Wn,1),vt.push($n),jt.push(ye),Dt.push(pe)};if(qi==="miter")Kt._mult(ii),Nn(ot,Kt,0,0);else if(qi==="flipbevel")Kt=bt.mult(-1),Nn(ot,Kt,0,0),Nn(ot,Kt.mult(-1),0,0);else{const Zi=-Math.sqrt(ii*ii-1),$n=Ri?Zi:0,Wn=Ri?0:Zi;et&&Nn(ot,Vt,$n,Wn),It&&Nn(ot,bt,$n,Wn)}}Et.geometry=[...jt,...Dt.reverse(),jt[0]],Et.joinNormals=[...vt,...vt.reverse(),vt[vt.length-1]];const fi=Et.geometry.length-1;for(let ni=0;ni<fi/2;ni++)if(ni+1<fi/2){let Kt=ni,ji=ni+1,ii=fi-1-ni,Ri=fi-2-ni;Kt=Kt===0?fi-1:Kt-1,ji=ji===0?fi-1:ji-1,ii=ii===0?fi-1:ii-1,Ri=Ri===0?fi-1:Ri-1,Et.indices.push(ii),Et.indices.push(ji),Et.indices.push(Kt),Et.indices.push(ii),Et.indices.push(Ri),Et.indices.push(ji)}return Et})(a[0]),a=[ae.geometry]}const ue=(Ge,ut)=>Ge<(ut.length-1)/2||Ge===ut.length-1,Te=this.wallMode?[a]:Zf(a,500);for(let Ge=Te.length-1;Ge>=0;Ge--){const ut=Te[Ge];(ut.length===0||(_e=ut[0]).every((gt=>gt.x<=0))||_e.every((gt=>gt.x>=Nt))||_e.every((gt=>gt.y<=0))||_e.every((gt=>gt.y>=Nt)))&&Te.splice(Ge,1)}var _e;let Ie;if(N)Ie=Dx(Te,D,m);else{Ie=[];for(const Ge of Te)Ie.push({polygon:Ge,bounds:D})}const Me=V?this.edgeRadius:0,Le=Me>0&&this.zoom<17,at=(Ge,ut)=>{if(Ge.length===0)return!1;const gt=Ge[Ge.length-1];return ut.x===gt.x&&ut.y===gt.y};for(const{polygon:Ge,bounds:ut}of Ie){let gt=0,Et=0;for(const Mt of Ge)V&&!Mt[0].equals(Mt[Mt.length-1])&&Mt.push(Mt[0]),Et+=V?Mt.length-1:Mt.length;const jt=this.segments.prepareSegment((V?5:4)*Et,this.layoutVertexArray,this.indexArray);Z.footprintSegIdx<0&&(Z.footprintSegIdx=this.footprintSegments.length),Z.polygonSegIdx<0&&(Z.polygonSegIdx=this.polygonSegments.length);const Dt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},vt=new Cx;if(vt.vertexOffset=this.footprintVertices.length,vt.indexOffset=3*this.footprintIndices.length,vt.ringIndices=[],V){const Mt=[],ot=[];gt=jt.vertexLength;for(let It=0;It<Ge.length;It++){const Vt=Ge[It];Vt.length&&It!==0&&ot.push(Mt.length/2);const bt=[];let li,fi;li=Vt[1].sub(Vt[0])._perp()._unit(),vt.ringIndices.push(Vt.length-1);for(let ni=1;ni<Vt.length;ni++){const Kt=Vt[ni],ji=Vt[ni===Vt.length-1?1:ni+1],ii=Kt.clone();if(Me){fi=ji.sub(Kt)._perp()._unit();const Ri=li.add(fi)._unit(),qi=Me*Math.min(4,1/(li.x*Ri.x+li.y*Ri.y));ii.x+=qi*Ri.x,ii.y+=qi*Ri.y,ii.x=Math.round(ii.x),ii.y=Math.round(ii.y),li=fi}if(!K||Me!==0&&!Le||at(bt,ii)||bt.push(ii),vm(this.layoutVertexArray,ii.x,ii.y,0,0,1,1,0),this.wallMode){const Ri=ue(ni,Vt);xm(this.wallVertexArray,ae.joinNormals[ni],!Ri)}jt.vertexLength++,this.footprintVertices.emplaceBack(Kt.x,Kt.y),Mt.push(Kt.x,Kt.y),N&&Ug(this.layoutVertexExtArray,O.projectTilePoint(ii.x,ii.y,m),O.upVector(m,ii.x,ii.y))}K&&(Me===0||Le)&&(bt.length!==0&&at(bt,bt[0])&&bt.pop(),this.groundEffect.addData(bt,ut,M))}const et=this.wallMode?ae.indices:am(Mt,ot);for(let It=0;It<et.length;It+=3)this.footprintIndices.emplaceBack(vt.vertexOffset+et[It+0],vt.vertexOffset+et[It+1],vt.vertexOffset+et[It+2]),this.indexArray.emplaceBack(gt+et[It],gt+et[It+2],gt+et[It+1]),jt.primitiveLength++;vt.indexCount+=et.length,vt.vertexCount+=this.footprintVertices.length-vt.vertexOffset}for(let Mt=0;Mt<Ge.length;Mt++){const ot=Ge[Mt];$.startRing(Z,ot[0]);let et=ot.length>4&&Mx(ot[ot.length-2],ot[0],ot[1]),It=Me?qd(ot[ot.length-2],ot[0],ot[1],Me):0;const Vt=[];let bt,li,fi;li=ot[1].sub(ot[0])._perp()._unit();let ni=!0;for(let Kt=1,ji=0;Kt<ot.length;Kt++){let ii=ot[Kt-1],Ri=ot[Kt];const qi=ot[Kt===ot.length-1?1:Kt+1];if($.appendEdge(Z,Ri,ii),Yf(Ri,ii,ut)){Me&&(li=qi.sub(Ri)._perp()._unit(),ni=!ni);continue}const un=Ri.sub(ii)._perp(),Nn=un.x/(Math.abs(un.x)+Math.abs(un.y)),Zi=un.y>0?1:0,$n=ii.dist(Ri);if(ji+$n>32768&&(ji=0),Me){fi=qi.sub(Ri)._perp()._unit();let pe=bm(ii,Ri,qi,Hh(li,fi),Me);isNaN(pe)&&(pe=0);const ft=Ri.sub(ii)._unit();ii=ii.add(ft.mult(It))._round(),Ri=Ri.add(ft.mult(-pe))._round(),It=pe,li=fi,K&&this.zoom>=17&&(at(Vt,ii)||Vt.push(ii),at(Vt,Ri)||Vt.push(Ri))}const Wn=jt.vertexLength,es=ot.length>4&&Mx(ii,Ri,qi);let ye=Pv(ji,et,ni);if(vm(this.layoutVertexArray,ii.x,ii.y,Nn,Zi,0,0,ye),vm(this.layoutVertexArray,ii.x,ii.y,Nn,Zi,0,1,ye),this.wallMode){const pe=ue(Kt-1,ot),ft=ae.joinNormals[Kt-1];xm(this.wallVertexArray,ft,pe),xm(this.wallVertexArray,ft,pe)}if(ji+=$n,ye=Pv(ji,es,!ni),et=es,vm(this.layoutVertexArray,Ri.x,Ri.y,Nn,Zi,0,0,ye),vm(this.layoutVertexArray,Ri.x,Ri.y,Nn,Zi,0,1,ye),this.wallMode){const pe=ue(Kt,ot),ft=ae.joinNormals[Kt];xm(this.wallVertexArray,ft,pe),xm(this.wallVertexArray,ft,pe)}if(jt.vertexLength+=4,this.indexArray.emplaceBack(Wn+0,Wn+1,Wn+2),this.indexArray.emplaceBack(Wn+1,Wn+3,Wn+2),jt.primitiveLength+=2,Me){const pe=gt+(Kt===1?ot.length-2:Kt-2),ft=Kt===1?gt:pe+1;if(this.indexArray.emplaceBack(Wn+1,pe,Wn+3),this.indexArray.emplaceBack(pe,ft,Wn+3),jt.primitiveLength+=2,bt===void 0&&(bt=Wn),!Yf(qi,ot[Kt],ut)){const Wt=Kt===ot.length-1?bt:jt.vertexLength;this.indexArray.emplaceBack(Wn+2,Wn+3,Wt),this.indexArray.emplaceBack(Wn+3,Wt+1,Wt),this.indexArray.emplaceBack(Wn+3,ft,Wt+1),jt.primitiveLength+=3}ni=!ni}if(N){const pe=this.layoutVertexExtArray,ft=O.projectTilePoint(ii.x,ii.y,m),Wt=O.projectTilePoint(Ri.x,Ri.y,m),pt=O.upVector(m,ii.x,ii.y),Qt=O.upVector(m,Ri.x,Ri.y);Ug(pe,ft,pt),Ug(pe,ft,pt),Ug(pe,Wt,Qt),Ug(pe,Wt,Qt)}}V&&(gt+=ot.length-1),K&&Me&&this.zoom>=17&&(Vt.length!==0&&at(Vt,Vt[0])&&Vt.pop(),this.groundEffect.addData(Vt,ut,M,Me>0))}this.footprintSegments.push(vt),Dt.triangleCount=this.indexArray.length-Dt.triangleArrayOffset,this.polygonSegments.push(Dt),++Z.footprintSegLen,++Z.polygonSegLen}if(Z.vertexCount=this.layoutVertexArray.length-Z.vertexArrayOffset,Z.groundVertexCount=this.groundEffect.vertexArray.length-Z.groundVertexArrayOffset,Z.vertexCount!==0){if(Z.centroidXY=$.borders?Rv:this.encodeCentroid($,Z),this.centroidData.push(Z),$.borders){this.featuresOnBorder.push($);const Ge=this.featuresOnBorder.length-1;for(let ut=0;ut<$.borders.length;ut++)$.borders[ut][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ut].push(Ge)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,_,v,m,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,h,_,v,m,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,ne)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0]))}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const E=this.centroidData[v],S=+(E.min.y+E.max.y>Nt),M=2*S+(+(E.min.x+E.max.x>Nt)^S);for(let D=0;D<E.polygonSegLen;D++){const O=E.polygonSegIdx+D;e.push({centroidIdx:v,subtile:M,polygonSegmentIdx:O,triangleSegmentIdx:this.polygonSegments[O].triangleSegIdx})}}const i=new Cr;e.sort(((v,E)=>v.triangleSegmentIdx===E.triangleSegmentIdx?v.subtile-E.subtile:v.triangleSegmentIdx-E.triangleSegmentIdx));let a=0,h=0,m=0;for(const v of e){if(v.triangleSegmentIdx!==a)break;m++}const _=e.length;for(;h!==e.length;){a=e[h].triangleSegmentIdx;let v=0,E=h,S=h;for(let M=E;M<m&&e[M].subtile===v;M++)S++;for(;E!==m;){const M=e[E];v=M.subtile;const D=this.centroidData[M.centroidIdx].min.clone(),O=this.centroidData[M.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=E;V<S;V++){const $=e[V],Z=this.polygonSegments[$.polygonSegmentIdx],K=this.centroidData[$.centroidIdx].min,ne=this.centroidData[$.centroidIdx].max,ae=this.indexArray.uint16;for(let ue=Z.triangleArrayOffset;ue<Z.triangleArrayOffset+Z.triangleCount;ue++)i.emplaceBack(ae[3*ue],ae[3*ue+1],ae[3*ue+2]);N.primitiveLength+=Z.triangleCount,D.x=Math.min(D.x,K.x),D.y=Math.min(D.y,K.y),O.x=Math.max(O.x,ne.x),O.y=Math.max(O.y,ne.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:D,max:O}),E=S;for(let V=E;V<m&&e[V].subtile===e[E].subtile;V++)S++}h=m;for(let M=h;M<_&&e[M].triangleSegmentIdx===e[h].triangleSegmentIdx;M++)m++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const h=new Lr;if(this.wallMode){for(const $ of this.triangleSubSegments)h.segments.push($.segment);return h}let m=0,_=0;const v=1<<e.canonical.z;if(i){const $=i.getMinMaxForTile(e);$&&(m=$.min,_=$.max)}_+=this.maxHeight;const E=e.toUnwrapped();let S;const M=[E.canonical.x/v+E.wrap,E.canonical.y/v],D=[(E.canonical.x+1)/v+E.wrap,(E.canonical.y+1)/v],O=($,Z,K)=>[$[0]*(1-K[0])+Z[0]*K[0],$[1]*(1-K[1])+Z[1]*K[1]],N=[],V=[];for(const $ of this.triangleSubSegments){N[0]=$.min.x/Nt,N[1]=$.min.y/Nt,V[0]=$.max.x/Nt,V[1]=$.max.y/Nt;const Z=O(M,D,N),K=O(M,D,V);if(new nn([Z[0],Z[1],m],[K[0],K[1],_]).intersectsPrecise(a)===0){S&&(h.segments.push(S),S=void 0);continue}const ne=$.segment;S&&S.vertexOffset!==ne.vertexOffset&&(h.segments.push(S),S=void 0),S?(S.vertexLength+=ne.vertexLength,S.primitiveLength+=ne.primitiveLength):S={vertexOffset:ne.vertexOffset,primitiveLength:ne.primitiveLength,vertexLength:ne.vertexLength,primitiveOffset:ne.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&h.segments.push(S),h}encodeCentroid(e,i){const a=e.centroid(),h=i.span(),m=Math.min(7,Math.round(h.x*this.tileToMeter/10)),_=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new St(J(a.x,1,Nt-1)<<3|m,J(a.y,1,Nt-1)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new St(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const h=i[0][0]!==a?0:1;return new St(6|(i[0][0]!==a?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==a?2:3;return new St((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,h=e.flags&qh?Rv:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||m!==h.x){for(let _=i;_<a;++_)this.centroidVertexArray.emplace(_,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(Bg(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const m=[];for(const _ of this.activeReplacements){if(_.order<a)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingId){const E=_.footprint.buildingId;for(const S of this.centroidData)S.buildingId===E&&(S.flags|=qh)}else for(const E of this.centroidData)if(!(E.flags&qh||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y))for(let S=0;S<E.footprintSegLen;S++){const M=this.footprintSegments[E.footprintSegIdx+S];if(m.length=0,Px(this.footprintVertices,M.vertexOffset,M.vertexCount,_.footprintTileId.canonical,e.canonical,m),ey(_.footprint,m,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-v)){E.flags|=qh;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let h=!1;for(let m=0;m<a.footprintSegLen;m++){const _=this.footprintSegments[a.footprintSegIdx+m];let v=0;for(const E of _.ringIndices){for(let S=v,M=E+v-1;S<E+v;M=S++){const D=this.footprintVertices.int16[2*(S+_.vertexOffset)+0],O=this.footprintVertices.int16[2*(S+_.vertexOffset)+1],N=this.footprintVertices.int16[2*(M+_.vertexOffset)+1];O>i!=N>i&&e<(this.footprintVertices.int16[2*(M+_.vertexOffset)+0]-D)*(i-O)/(N-O)+D&&(h=!h)}v=E}}return h}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,h=!0;const m=4*(e+Nt)*Nt+(i+Nt);if(this.partLookup.hasOwnProperty(m)){const _=this.partLookup[m];return _?{height:_.height,hidden:!!(_.flags&qh)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||i>_.max.y||_.min.y>i||_.height<=a||this.footprintContainsPoint(e,i,_)&&(a=_.height,this.partLookup[m]=_,h=!!(_.flags&qh));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:h};this.partLookup[m]=void 0}}function Hh(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function qd(r,e,i,a){const h=e.sub(r)._perp()._unit(),m=i.sub(e)._perp()._unit();return bm(r,e,i,Hh(h,m),a)}function bm(r,e,i,a,h){const m=Math.sqrt(1-a*a);return Math.min(r.dist(e)/3,e.dist(i)/3,h*m/a)}function Yf(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function $h(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function Mx(r,e,i){if(r.x<0||r.x>=Nt||e.x<0||e.x>=Nt||i.x<0||i.x>=Nt)return!1;const a=i.sub(e),h=a.perp(),m=r.sub(e);return(a.x*m.x+a.y*m.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(m.x*m.x+m.y*m.y))>-.866&&h.x*m.x+h.y*m.y<0}function Pv(r,e,i){const a=e?2|r:-3&r;return i?1|a:-2&a}function wm(){const r=Math.PI/32,e=Math.tan(r),i=L;return i*Math.sqrt(1+2*e*e)-i}function Dx(r,e,i){const a=1<<i.z,h=he(i.x/a),m=he((i.x+1)/a),_=le(i.y/a),v=le((i.y+1)/a);return(function(E,S,M,D,O=0,N){const V=[];if(!E.length||!M||!D)return V;const $=(_e,Ie)=>{for(const Me of _e)V.push({polygon:Me,bounds:Ie})},Z=Math.ceil(Math.log2(M)),K=Math.ceil(Math.log2(D)),ne=Z-K,ae=[];for(let _e=0;_e<Math.abs(ne);_e++)ae.push(ne>0?0:1);for(let _e=0;_e<Math.min(Z,K);_e++)ae.push(0),ae.push(1);let ue=E;if(ue=Gd(ue,S[0].y-O,S[1].y+O,1),ue=Gd(ue,S[0].x-O,S[1].x+O,0),!ue.length)return V;const Te=[];for(ae.length?Te.push({polygons:ue,bounds:S,depth:0}):$(ue,S);Te.length;){const _e=Te.pop(),Ie=_e.depth,Me=ae[Ie],Le=_e.bounds[0],at=_e.bounds[1],Ge=Me===0?Le.x:Le.y,ut=Me===0?at.x:at.y,gt=N?N(Me,Ge,ut):.5*(Ge+ut),Et=Gd(_e.polygons,Ge-O,gt+O,Me),jt=Gd(_e.polygons,gt-O,ut+O,Me);if(Et.length){const Dt=[Le,new St(Me===0?gt:at.x,Me===1?gt:at.y)];ae.length>Ie+1?Te.push({polygons:Et,bounds:Dt,depth:Ie+1}):$(Et,Dt)}if(jt.length){const Dt=[new St(Me===0?gt:Le.x,Me===1?gt:Le.y),at];ae.length>Ie+1?Te.push({polygons:jt,bounds:Dt,depth:Ie+1}):$(jt,Dt)}}return V})(r,e,Math.ceil((m-h)/11.25),Math.ceil((_-v)/11.25),1,((E,S,M)=>{if(E===0)return .5*(S+M);{const D=le((i.y+S/Nt)/a);return(ee(.5*(le((i.y+M/Nt)/a)+D))*a-i.y)*Nt}}))}function Px(r,e,i,a,h,m){const _=Math.pow(2,a.z-h.z);for(let v=0;v<i;v++){let E=r.int16[2*(v+e)+0],S=r.int16[2*(v+e)+1];E=(E+h.x*Nt)*_-a.x*Nt,S=(S+h.y*Nt)*_-a.y*Nt,m.push(new St(E,S))}}let qg,Ov;Lt(uu,"FillExtrusionBucket",{omit:["layers","features"]}),Lt(ny,"PartData"),Lt(Cx,"FootprintSegment"),Lt(ry,"BorderCentroidData"),Lt(Gg,"GroundEffect");class Qf extends St{constructor(e,i,a){super(e,i),this.z=a}}class Hg extends Qf{constructor(e,i,a,h){super(e,i,a),this.w=h}}function $g(r,e,i,a){const h=i==="x"?"y":"x",m=(a-r[i])/(e[i]-r[i]);r[h]=Math.round(r[h]+(e[h]-r[h])*m),r[i]=a,r.hasOwnProperty("z")&&(r.z=Oi(r.z,e.z,m)),r.hasOwnProperty("w")&&(r.w=Oi(r.w,e.w,m))}function Lv(r,e,i,a){const h=i,m=a;for(const _ of["x","y"]){let v=r,E=e;v[_]>=E[_]&&(v=e,E=r),v[_]<h&&E[_]>h&&$g(v,E,_,h),v[_]<m&&E[_]>m&&$g(E,v,_,m)}}function Wh(r,e,i,a,h,m){const _=[];for(let v=0;v<r.length;v++){const E=r[v];let S;const M=_.length;let D=0;for(let O=0;O<E.length-1;O++){let N=E[O],V=E[O+1],$=0;const Z=D;let K,ne;m&&($=Math.hypot(V.x-N.x,V.y-N.y),D+=$,K=N,ne=V),N.x<e&&V.x<e||(N.x<e?N=new St(e,N.y+(e-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x<e&&(V=new St(e,N.y+(e-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y<i&&V.y<i||(N.y<i?N=new St(N.x+(i-N.y)/(V.y-N.y)*(V.x-N.x),i)._round():V.y<i&&(V=new St(N.x+(i-N.y)/(V.y-N.y)*(V.x-N.x),i)._round()),N.x>=a&&V.x>=a||(N.x>=a?N=new St(a,N.y+(a-N.x)/(V.x-N.x)*(V.y-N.y))._round():V.x>=a&&(V=new St(a,N.y+(a-N.x)/(V.x-N.x)*(V.y-N.y))._round()),N.y>=h&&V.y>=h||(N.y>=h?N=new St(N.x+(h-N.y)/(V.y-N.y)*(V.x-N.x),h)._round():V.y>=h&&(V=new St(N.x+(h-N.y)/(V.y-N.y)*(V.x-N.x),h)._round()),S&&N.equals(S[S.length-1])||(S=[N],_.push(S),m&&m.push({progress:{min:Z+sy(K,ne,N)*$,max:1},parentIndex:v,prevPoint:K,nextPoint:ne})),S.push(V),m&&(m[m.length-1].progress.max=Z+sy(K,ne,V)*$,m[m.length-1].nextPoint=ne)))))}if(m&&D>0)for(let O=M;O<_.length;O++)m[O].progress.min/=D,m[O].progress.max/=D}return _}function Ox(r,e,i,a,h){if(r.length<2)return void a.push(r);const m=[];for(;e.valid();){const[S,M]=e.get();for(let D=0;D<r.length-1;D++){const O=r[D],N=r[D+1],V=Va(O,N,S,M);if(V){const[$]=V,Z=new St(Oi(O.x,N.x,$),Oi(O.y,N.y,$));m.push({t:D+$,distance:0,point:Z})}}e.next()}if(m.length===0)return void a.push(r);m.sort(((S,M)=>S.t-M.t));let _=0,v=0,E=[];for(a.push(E);_!==r.length;){if(v===m.length){for(;_!==r.length;)E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++;break}m[v].t<=_?(E.length!==0&&E[E.length-1].equals(m[v].point)||E.push(m[v].point),Math.trunc(m[v].t),v++):(E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++)}}function sy(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function Hd(r,e){return r.x*e.x+r.y*e.y}function zv(r,e){if(r.length===1){let i=0;const a=e[i++];let h;for(;!h||a.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const m=e[i],_=r[0],v=h.sub(a),E=m.sub(a),S=_.sub(a),M=Hd(v,v),D=Hd(v,E),O=Hd(E,E),N=Hd(S,v),V=Hd(S,E),$=M*O-D*D,Z=(O*N-D*V)/$,K=(M*V-D*N)/$,ne=a.z*(1-Z-K)+h.z*Z+m.z*K;if(isFinite(ne))return ne}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function Lx(r,e,i){let a=1/0;qr(i,e)&&(a=zv(i,e[0]));for(let h=0;h<e.length;h++){const m=e[h],_=r[h];for(let v=0;v<m.length-1;v++){const E=m[v],S=[E,m[v+1],_[v+1],_[v],E];Er(i,S)&&(a=Math.min(a,zv(i,S)))}}return a!==1/0&&a}function Wg(r,e,i,a,h,m,_,v,E,S,M){return r.projection.name==="globe"?(function(D,O,N,V,$,Z,K,ne,ae,ue,Te){const _e=[],Ie=[],Me=D.projection.upVectorScale(Te,D.center.lat,D.worldSize).metersToTile,Le=[0,0,0,1],at=[0,0,0,1],Ge=(gt,Et,jt,Dt)=>{gt[0]=Et,gt[1]=jt,gt[2]=Dt,gt[3]=1},ut=wm();N>0&&(N+=ut),V+=ut;for(const gt of O){const Et=[],jt=[];for(const Dt of gt){const vt=Dt.x+$.x,Mt=Dt.y+$.y,ot=D.projection.projectTilePoint(vt,Mt,Te),et=D.projection.upVector(Te,Dt.x,Dt.y);let It=N,Vt=V;if(K){const bt=u(vt,Mt,N,V,K,ne,ae,ue);It+=bt.base,Vt+=bt.top}N!==0?Ge(Le,ot.x+et[0]*Me*It,ot.y+et[1]*Me*It,ot.z+et[2]*Me*It):Ge(Le,ot.x,ot.y,ot.z),Ge(at,ot.x+et[0]*Me*Vt,ot.y+et[1]*Me*Vt,ot.z+et[2]*Me*Vt),nr(Le,Le,Z),nr(at,at,Z),Et.push(new Qf(Le[0],Le[1],Le[2])),jt.push(new Qf(at[0],at[1],at[2]))}_e.push(Et),Ie.push(jt)}return[_e,Ie]})(r,e,i,a,h,m,_,v,E,S,M):_?(function(D,O,N,V,$,Z,K,ne,ae){const ue=[],Te=[],_e=[0,0,0,1];for(const Ie of D){const Me=[],Le=[];for(const at of Ie){const Ge=at.x+V.x,ut=at.y+V.y,gt=u(Ge,ut,O,N,Z,K,ne,ae);_e[0]=Ge,_e[1]=ut,_e[2]=gt.base,_e[3]=1,$i(_e,_e,$),_e[3]=Math.max(_e[3],1e-5);const Et=new Qf(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);_e[0]=Ge,_e[1]=ut,_e[2]=gt.top,_e[3]=1,$i(_e,_e,$),_e[3]=Math.max(_e[3],1e-5);const jt=new Qf(_e[0]/_e[3],_e[1]/_e[3],_e[2]/_e[3]);Me.push(Et),Le.push(jt)}ue.push(Me),Te.push(Le)}return[ue,Te]})(e,i,a,h,m,_,v,E,S):(function(D,O,N,V,$){const Z=[],K=[],ne=$[8]*O,ae=$[9]*O,ue=$[10]*O,Te=$[11]*O,_e=$[8]*N,Ie=$[9]*N,Me=$[10]*N,Le=$[11]*N;for(const at of D){const Ge=[],ut=[];for(const gt of at){const Et=gt.x+V.x,jt=gt.y+V.y,Dt=$[0]*Et+$[4]*jt+$[12],vt=$[1]*Et+$[5]*jt+$[13],Mt=$[2]*Et+$[6]*jt+$[14],ot=$[3]*Et+$[7]*jt+$[15],et=Dt+ne,It=vt+ae,Vt=Mt+ue,bt=Math.max(ot+Te,1e-5),li=Dt+_e,fi=vt+Ie,ni=Mt+Me,Kt=Math.max(ot+Le,1e-5);Ge.push(new Qf(et/bt,It/bt,Vt/bt)),ut.push(new Qf(li/Kt,fi/Kt,ni/Kt))}Z.push(Ge),K.push(ut)}return[Z,K]})(e,i,a,h,m)}function u(r,e,i,a,h,m,_,v){const E=_*h.getElevationAt(r,e,!0,!0),S=m[0]!==0,M=S?m[1]===0?_*(m[0]/Mv-iy):_*(function(D,O,N){const V=Math.floor(O[0]/8),$=Math.floor(O[1]/8),Z=10*(O[0]-8*V),K=10*(O[1]-8*$),ne=D.getElevationAt(V,$,!0,!0),ae=D.getMeterToDEM(N),ue=Math.floor(.5*(Z*ae-1)),Te=Math.floor(.5*(K*ae-1)),_e=D.tileCoordToPixel(V,$),Ie=2*ue+1,Me=2*Te+1,Le=(function(jt,Dt,vt,Mt,ot){return[jt.getElevationAtPixel(Dt,vt,!0),jt.getElevationAtPixel(Dt+ot,vt,!0),jt.getElevationAtPixel(Dt,vt+ot,!0),jt.getElevationAtPixel(Dt+Mt,vt+ot,!0)]})(D,_e.x-ue,_e.y-Te,Ie,Me),at=Math.abs(Le[0]-Le[1]),Ge=Math.abs(Le[2]-Le[3]),ut=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),gt=Math.min(.25,.5*ae*(at+Ge)/Ie),Et=Math.min(.25,.5*ae*ut/Me);return ne+Math.max(gt*Z,Et*K)})(h,m,v):E;return{base:E+(i===0?-1:i),top:S?Math.max(M+a,E+i+2):E+a}}class g{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class w{constructor(){this.tasks={},this.taskQueue=[],We(["process"],this),this.invoker=new g(this.process),this.nextId=0}add(e,i){const a=this.nextId++,h=(function({type:m,isSymbolTile:_,zoom:v}){return v=v||0,m==="message"?0:m!=="maybePrepare"||_?m!=="parseTile"||_?m==="parseTile"&&_?300-v:m==="maybePrepare"&&_?400-v:500:200-v:100-v})(i);if(h===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:h,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((a=>!!this.tasks[a])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<i&&(i=m.priority,e=h)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class C{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},We(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new w}send(e,i,a,h,m=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=_,this.callbacks[v]=a);const E=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!a,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:Kl(i,E)},E),{cancel:()=>{a&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[a];delete this.cancelCallbacks[a],h&&h.cancel()}else if(i.mustQueue||mr(self)){const h=this.callbacks[a],m=this.scheduler.add((()=>this.processTask(a,i)),h&&h.metadata||{type:"message"});m&&(this.cancelCallbacks[a]=m)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(Ja(i.error)):a(null,Ja(i.data)))}else{const a=new Set,h=i.hasCallback?(_,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?Kl(_):null,data:Kl(v,a)},a)}:()=>{},m=Ja(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,h);else if(this.parent.getWorkerSource){const _=i.type.split("."),{source:v,scope:E}=m;this.parent.getWorkerSource(i.sourceMapId,_[0],v,E)[_[1]](m,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var F={workerUrl:"",workerClass:null,workerParams:void 0};const j="mapboxgl_preloaded_worker_pool";class se{constructor(){this.active={}}acquire(e,i=se.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(F.workerClass!=null?new F.workerClass:new self.Worker(F.workerUrl,F.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[j]}numActive(){return Object.keys(this.active).length}}se.workerCount=2;class Ae{constructor(e,i,a="Worker",h=se.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ye();const m=this.workerPool.acquire(this.id,h);for(let _=0;_<m.length;_++){const v=new Ae.Actor(m[_],i,this.id);v.name=`${a} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,a){Ce(this.actors,((h,m)=>{h.send(e,i,m)}),a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Qe,Ft;function si(){return Qe||(Qe=new se),Qe}Ae.Actor=C;class hi{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,a/i.BYTES_PER_ELEMENT),a}createFloatArray(e){const i=new Float32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,a/i.BYTES_PER_ELEMENT),a}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let a=0;a<e.length;++a)this.module.heapU8[i+a]=e.charCodeAt(a);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,a=e.facadeGlazingColorRgb,h=e.roofColorRgb,m=e.wallColorRgb,_=e.normalScale;this.module.setStyle(i[0],i[1],i[2],a[0],a[1],a[2],h[0],h[1],h[2],m[0],m[1],m[2],_[0],_[1],_[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,a){this.module.setFauxFacadeOptions(e?1:0,i?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const v of e){const E=this.createStringBuffer(v.roofType),S=[0],M=[];for(const N of v.coordinates)if(Array.isArray(N)){for(const V of N)M.push(V.x),M.push(V.y);S.push(M.length)}const D=this.createIntArray(S),O=this.createFloatArray(M);this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,E,v.roofType.length,O,D,S.length-1),this.module.free(E),this.module.free(D),this.module.free(O)}for(const v of i){let E;E=v.entrances?JSON.parse(v.entrances):[];const S=this.createFloatArray(E),M=[];for(const O of v.coordinates)M.push(O.x),M.push(O.y);const D=this.createFloatArray(M);this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,S,E.length,D,M.length),this.module.free(S),this.module.free(D)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const a=this.module.getMeshCount(),h=new Array(a);for(let v=0;v<a;v++){const E=this.module.getPositionsPtr(v),S=this.module.getPositionsLength(v),M=new Float32Array(this.module.heapF32.buffer,E,S),D=this.module.getNormalsPtr(v),O=this.module.getNormalsLength(v),N=new Float32Array(this.module.heapF32.buffer,D,O),V=this.module.getColorsPtr(v),$=this.module.getColorsLength(v),Z=new Uint8Array(this.module.heapU8.buffer,V,$),K=this.module.getAOPtr(v),ne=this.module.getAOLength(v),ae=new Float32Array(this.module.heapF32.buffer,K,ne),ue=this.module.getUVPtr(v),Te=this.module.getUVLength(v),_e=new Float32Array(this.module.heapF32.buffer,ue,Te),Ie=this.module.getFauxFacadePtr(v),Me=this.module.getFauxFacadeLength(v),Le=new Uint8Array(this.module.heapU8.buffer,Ie,Me),at=this.module.getIndicesPtr(v),Ge=this.module.getIndicesLength(v),ut=new Int32Array(this.module.heap32.buffer,at,Ge),gt=this.module.getBuildingPart(v),Et=this.readStringBuffer(gt);h[v]={positions:M,normals:N,colors:Z,ao:ae,uv:_e,isFauxFacade:Le,indices:ut,buildingPart:Et}}const m=this.module.getRingCount(),_=[];for(let v=0;v<m;v++){const E=this.module.getRingPtr(v),S=this.module.getRingLength(v),M=new Float32Array(this.module.heapF32.buffer,E,S);_.push(M)}return{meshes:h,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Ut,Zt,Hi,Tn,vs,Tt=null,lt=null,Bt=null,ci=null;function En(){return mr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Zt||or.DRACO_URL}function ss(){if(mr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Tn)return Tn;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Tn=WebAssembly.validate(r)?or.MESHOPT_SIMD_URL:or.MESHOPT_URL,Tn}function mn(){return ci}const lr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Br={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Nr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Zh(r,e,i){const a=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:h,byteLength:r.byteLength},i.buffers[h]=r}const kv="KHR_draco_mesh_compression";function ez(r,e){const i=r.extensions&&r.extensions[kv];if(!i)return;const a=new Hi.Decoder,h=QS(e,i.bufferView),m=new Hi.Mesh;if(!a.DecodeArrayToMesh(h,h.byteLength,m))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[r.indices],v=lr[_.componentType],E=_.count*v.BYTES_PER_ELEMENT,S=Hi._malloc(E);v===Uint16Array?a.GetTrianglesUInt16Array(m,E,S):a.GetTrianglesUInt32Array(m,E,S),Zh(Hi.memory.buffer.slice(S,S+E),_,e),Hi._free(S);for(const M of Object.keys(i.attributes)){const D=a.GetAttributeByUniqueId(m,i.attributes[M]),O=e.json.accessors[r.attributes[M]],N=Br[O.componentType],V=O.count*Nr[O.type]*lr[O.componentType].BYTES_PER_ELEMENT,$=Hi._malloc(V);a.GetAttributeDataArrayForAllPoints(m,D,Hi[N],V,$),Zh(Hi.memory.buffer.slice($,$+V),O,e),Hi._free($)}a.destroy(),m.destroy(),delete r.extensions[kv]}const zx="EXT_meshopt_compression";function tz(r,e){if(!r.extensions||!r.extensions[zx])return;const i=r.extensions[zx],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);vs.decodeGltfBuffer(h,i.count,i.byteStride,a,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=h.buffer,delete r.extensions[zx]}const XS=1179937895,KS=new TextDecoder("utf8");function YS(r,e){return new URL(r,e).href}function iz(r,e,i,a){return fetch(YS(r.uri,a)).then((h=>h.arrayBuffer())).then((h=>{e.buffers[i]=h}))}function QS(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function nz(r,e,i,a){if(r.uri){const h=YS(r.uri,a);return fetch(h).then((m=>m.blob())).then((m=>createImageBitmap(m))).then((m=>{e.images[i]=m}))}if(r.bufferView!==void 0){const h=QS(e,r.bufferView),m=new Blob([h],{type:r.mimeType});return createImageBitmap(m).then((_=>{e.images[i]=_}))}}function JS(r,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===XS){const M=new Uint32Array(r,e);let D=2;const O=(M[D++]>>2)-3,N=M[D++]>>2;if(D++,a.json=JSON.parse(KS.decode(M.subarray(D,D+N))),D+=N,D<O){const V=M[D++];D++;const $=e+(D<<2);a.buffers[0]=r.slice($,$+V)}}else a.json=JSON.parse(KS.decode(new Uint8Array(r,e)));const{buffers:h,images:m,meshes:_,extensionsUsed:v,bufferViews:E}=a.json;let S=Promise.resolve();if(h){const M=[];for(let D=0;D<h.length;D++){const O=h[D];O.uri?M.push(iz(O,a,D,i)):a.buffers[D]||(a.buffers[D]=null)}S=Promise.all(M)}return S.then((()=>{const M=[],D=v&&v.includes(kv),O=v&&v.includes(zx);if(D&&M.push((function(){if(!Hi)return Ut??(Ut=(function(N){let V,$=null;function Z(){V=new Uint8Array($.buffer)}function K(){throw new Error("Unexpected Draco error.")}const ne={a:{a:K,d:function(ae,ue,Te){return V.copyWithin(ae,ue,ue+Te)},c:function(ae){const ue=V.length,Te=Math.max(ae>>>0,Math.ceil(1.2*ue)),_e=Math.ceil((Te-ue)/65536);try{return $.grow(_e),Z(),!0}catch{return!1}},b:K}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,ne):N.then((ae=>ae.arrayBuffer())).then((ae=>WebAssembly.instantiate(ae,ne)))).then((ae=>{const{Rb:ue,Qb:Te,P:_e,T:Ie,X:Me,Ja:Le,La:at,Qa:Ge,Va:ut,Wa:gt,eb:Et,jb:jt,f:Dt,e:vt,yb:Mt,zb:ot,Ab:et,Bb:It,Db:Vt,Gb:bt}=ae.instance.exports;$=vt;const li=(()=>{let fi=0,ni=0,Kt=0,ji=0;return ii=>{Kt&&(ue(ji),ue(fi),ni+=Kt,Kt=fi=0),fi||(ni+=128,fi=Te(ni));const Ri=ii.length+7&-8;let qi=fi;Ri>=ni&&(Kt=Ri,qi=ji=Te(Ri));for(let un=0;un<ii.length;un++)V[qi+un]=ii[un];return qi}})();return Z(),Dt(),{memory:vt,_free:ue,_malloc:Te,Mesh:class{constructor(){this.ptr=_e()}destroy(){Ie(this.ptr)}},Decoder:class{constructor(){this.ptr=Le()}destroy(){jt(this.ptr)}DecodeArrayToMesh(fi,ni,Kt){const ji=li(fi),ii=at(this.ptr,ji,ni,Kt.ptr);return!!Me(ii)}GetAttributeByUniqueId(fi,ni){return{ptr:Ge(this.ptr,fi.ptr,ni)}}GetTrianglesUInt16Array(fi,ni,Kt){ut(this.ptr,fi.ptr,ni,Kt)}GetTrianglesUInt32Array(fi,ni,Kt){gt(this.ptr,fi.ptr,ni,Kt)}GetAttributeDataArrayForAllPoints(fi,ni,Kt,ji,ii){Et(this.ptr,fi.ptr,ni.ptr,Kt,ji,ii)}},DT_INT8:Mt(),DT_UINT8:ot(),DT_INT16:et(),DT_UINT16:It(),DT_UINT32:Vt(),DT_FLOAT32:bt()}}))})(fetch(En())),Ut.then((N=>{Hi=N,Ut=void 0})))})()),O&&M.push((function(){if(vs)return;const N=(function(V){let $;const Z=WebAssembly.instantiateStreaming(V,{}).then((ae=>{$=ae.instance,$.exports.__wasm_call_ctors()})),K={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ne={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Z,supported:!0,decodeGltfBuffer(ae,ue,Te,_e,Ie,Me){(function(Le,at,Ge,ut,gt,Et,jt){const Dt=Le.exports.sbrk,vt=ut+3&-4,Mt=Dt(vt*gt),ot=Dt(Et.length),et=new Uint8Array(Le.exports.memory.buffer);et.set(Et,ot);const It=at(Mt,ut,gt,ot,Et.length);if(It===0&&jt&&jt(Mt,vt,gt),Ge.set(et.subarray(Mt,Mt+ut*gt)),Dt(Mt-Dt(0)),It!==0)throw new Error(`Malformed buffer data: ${It}`)})($,$.exports[ne[Ie]],ae,ue,Te,_e,$.exports[K[Me]])}}})(fetch(ss()));return N.ready.then((()=>{vs=N}))})()),m)for(let N=0;N<m.length;N++)M.push(nz(m[N],a,N,i));return(M.length?Promise.all(M):Promise.resolve()).then((()=>{if(D&&_)for(const{primitives:N}of _)for(const V of N)ez(V,a);if(O&&_&&E)for(const N of E)tz(N,a);return a}))}))}function eA(r){return fetch(r).then((e=>e.arrayBuffer())).then((e=>JS(e,0,r)))}function nw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function rw(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class sw{constructor(e,i,a,h){this.context=e,this.format=a,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:_}=m,{x:v,y:E}=i&&i.position?i.position:{x:0,y:0},S=v+a,M=E+h;!this.size||this.size[0]===S&&this.size[1]===M||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!i||i.premultiply!==!1));const D=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&M>0){const O=this.useMipmap?Math.floor(Math.log2(Math.max(S,M)))+1:1;_.texStorage2D(_.TEXTURE_2D,O,this.format,S,M),this.size=[S,M]}this.size&&(D?_.texSubImage2D(_.TEXTURE_2D,0,v,E,nw(this.format),rw(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,E,a,h,nw(this.format),rw(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,a=!1){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,h,m){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,a),this.wrapS=a),h!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrapT=h),m!==this.compareMode&&(m?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,m)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=m)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Fv{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}const rz=hn([{name:"a_pos_3f",components:3,type:"Float32"}]),sz=hn([{name:"a_color_3f",components:3,type:"Float32"}]),oz=hn([{name:"a_color_4f",components:4,type:"Float32"}]),az=hn([{name:"a_uv_2f",components:2,type:"Float32"}]),lz=hn([{name:"a_normal_3f",components:3,type:"Float32"}]),cz=hn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),uz=hn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function tA(r,e){const i=kx(r.projection,r.zoom,r.width,r.height),a=(function(m,_,v,E,S){const M=new U(v.lng-180*Tm,v.lat),D=new U(v.lng+180*Tm,v.lat),O=m.project(M.lng,M.lat),N=m.project(D.lng,D.lat),V=-Math.atan2(N.y-O.y,N.x-O.x),$=Ve.fromLngLat(v);$.y=J($.y,-1+Tm,1-Tm);const Z=$.toLngLat(),K=m.project(Z.lng,Z.lat),ne=Ve.fromLngLat(Z);ne.x+=Tm;const ae=ne.toLngLat(),ue=m.project(ae.lng,ae.lat),Te=nA(ue.x-K.x,ue.y-K.y,V),_e=Ve.fromLngLat(Z);_e.y+=Tm;const Ie=_e.toLngLat(),Me=m.project(Ie.lng,Ie.lat),Le=nA(Me.x-K.x,Me.y-K.y,V),at=Math.abs(Te.x)/Math.abs(Le.y),Ge=Ze([]);qe(Ge,Ge,-V*(1-(S?0:E)));const ut=Ze([]);return ei(ut,ut,[1,1-(1-at)*E,1]),ut[4]=-Le.x/Le.y*E,qe(ut,ut,V),ct(ut,Ge,ut),ut})(r.projection,0,r.center,i,e),h=iA(r);return ei(a,a,[h,h,1]),a}function iA(r){const e=r.projection,i=kx(r.projection,r.zoom,r.width,r.height),a=ow(e,r.center),h=ow(e,U.convert(e.center));return Math.pow(2,a*i+(1-i)*h)}function kx(r,e,i,a,h=1/0){const m=r.range;if(!m)return 0;const _=Math.min(h,Math.max(i,a)),v=Math.log2(_/1024);return de(m[0]+v,m[1]+v,e)}const Tm=1/4e4;function ow(r,e){const i=J(e.lat,-fe,fe),a=new U(e.lng-180*Tm,i),h=new U(e.lng+180*Tm,i),m=r.project(a.lng,i),_=r.project(h.lng,i),v=Ve.fromLngLat(a),E=Ve.fromLngLat(h),S=_.x-m.x,M=_.y-m.y,D=E.x-v.x,O=E.y-v.y,N=Math.sqrt((D*D+O*O)/(S*S+M*M));return Math.log2(N)}function nA(r,e,i){const a=Math.cos(i),h=Math.sin(i);return{x:r*a-e*h,y:r*h+e*a}}function rA(r,e,i){Ze(r),qe(r,r,gn(e[2])),Fi(r,r,gn(e[0])),Si(r,r,gn(e[1])),ei(r,r,i),ct(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Fx(r,e,i,a,h,m,_,v){const E=[i[0]-e[0],i[1]-e[1],0],S=[a[0]-e[0],a[1]-e[1],0];if(qn(E)<1e-12||qn(S)<1e-12)return Kn(r);const M=Wr([],E,S);Ki(M,M),bn(S,a,e),E[2]=(m-h)*v,S[2]=(_-h)*v;const D=E;return Wr(D,E,S),Ki(D,D),Yo(r,M,D)}function Bx(r,e,i=!1){const a=Aa(e.zoom),h=(function(m,_,v){const E=_.worldSize,S=[m[12],m[13],m[14]],M=le(S[1]/E),D=he(S[0]/E),O=Ze([]),N=re(1,M)*E,V=re(1,0)*E*ge(M,_.zoom),$=1/rm(E);let Z=V*$;if(v){const ue=kx(_.projection,_.zoom,_.width,_.height,1024);Z=$*_.projection.pixelSpaceConversion(_.center.lat,E,ue)}const K=R(M,D);wi(K,K,ai([],Ki([],K),N*Z*S[2]));const ne=(function(ue){const Te=[ue[0],ue[1],ue[2]];let _e=[0,1,0];const Ie=Wr([],_e,Te);return Wr(_e,Te,Ie),Jn(_e)===0&&(_e=[0,1,0],Wr(Ie,Te,_e)),Ki(Ie,Ie),Ki(_e,_e),Ki(Te,Te),[Ie[0],Ie[1],Ie[2],0,_e[0],_e[1],_e[2],0,Te[0],Te[1],Te[2],0,ue[0],ue[1],ue[2],1]})(K);ei(O,O,[Z,Z,Z*N]),Gt(O,O,[-S[0],-S[1],-S[2]]);const ae=ct([],_.globeMatrix,ne);return ct(ae,ae,O),ct(ae,ae,m),ae})(r,e,i);if(a>0){const m=(function(_,v){const E=v.worldSize,S=re(1,0)*E*ge(v.center.lat,v.zoom)/rm(E),M=re(1,v.center.lat)*E,D=Ze([]);Si(D,D,gn(v.center.lng)),Fi(D,D,gn(v.center.lat)),Gt(D,D,[0,0,Fr]),ei(D,D,[S,S,S*M]);const O=v.point;return Gt(D,D,[-O.x,-O.y,0]),ct(D,D,_),ct(D,v.globeMatrix,D)})(r,e);return(function(_,v,E){const S=(V,$,Z)=>{const K=qn(V),ne=qn($),ae=kr(V,$,Z);return ai(ae,ae,1/qn(ae)*Oi(K,ne,Z))},M=S([_[0],_[1],_[2]],[v[0],v[1],v[2]],E),D=S([_[4],_[5],_[6]],[v[4],v[5],v[6]],E),O=S([_[8],_[9],_[10]],[v[8],v[9],v[10]],E),N=kr([_[12],_[13],_[14]],[v[12],v[13],v[14]],E);return[M[0],M[1],M[2],0,D[0],D[1],D[2],0,O[0],O[1],O[2],0,N[0],N[1],N[2],1]})(h,m,a)}return h}function aw(r,e,i,a){const h=nn.projectAabbCorners(a,i);let m=Number.MAX_VALUE;for(let v=0;v<h.length;++v){const E=h[v];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<m&&(m=E[2])}const _=(function(v){const E=[];let S=0;for(let N=1;N<v.length;N++)(v[N][0]<v[S][0]||v[N][0]===v[S][0]&&v[N][1]<v[S][1])&&(S=N);let M,D=S;const O=new Uint8Array(v.length);do{if(O[D])break;E.push(new St(v[D][0],v[D][1])),O[D]=1,M=(D+1)%v.length;for(let N=0;N<v.length;N++){if(v[N][0]===v[M][0]&&v[N][1]===v[M][1]||v[N][0]===v[D][0]&&v[N][1]===v[D][1])continue;const V=[v[N][0]-v[D][0],v[N][1]-v[D][1]],$=[v[M][0]-v[D][0],v[M][1]-v[D][1]],Z=V[0]*$[1]-V[1]*$[0];(Z>0||Z===0&&V[0]*$[0]+V[1]*$[1]>=0&&V[0]*V[0]+V[1]*V[1]>$[0]*$[0]+$[1]*$[1])&&(M=N)}D=M}while(D!==S);return E.length>0&&E.push(E[0]),E})(h);if(Er(r,_))return m}const Zg=64,oy={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Nx(r,e,i,a,h,m,_,v,E,S=!1){const M=i.zoom,D=i.project(a),O=ge(a.lat,M),N=1/O;Ze(r),Gt(r,r,[D.x+_[0]*N,D.y+_[1]*N,_[2]]);let V=1,$=1;const Z=i.worldSize;if(S){if(i.projection.name==="mercator"){let ue=0;i.elevation&&(ue=i.elevation.getAtPointOrZero(new Ve(D.x/Z,D.y/Z),0));const Te=$i([],[D.x,D.y,ue,1],i.projMatrix)[3]/i.cameraToCenterDistance;V=Te,$=Te*ge(i.center.lat,M)}else if(i.projection.name==="globe"){const ue=Bx(r,i),Te=[0,0,0,1];$i(Te,Te,ct([],i.projMatrix,ue));const _e=Te[3]/i.cameraToCenterDistance,Ie=Aa(M),Me=i.projection.pixelsPerMeter(a.lat,Z)*ge(a.lat,M),Le=i.projection.pixelsPerMeter(i.center.lat,Z)*ge(i.center.lat,M);V=_e/Oi(Me,Ee(i.center.lat),Ie),$=_e*O/Me,V*=Le,$*=Le}}else V=N;ei(r,r,[V,V,$]);const K=[...r],ne=e.orientation,ae=[];if(rA(ae,[ne[0]+(h?h[0]:0),ne[1]+(h?h[1]:0),ne[2]+(h?h[2]:0)],m),ct(r,K,ae),v&&i.elevation){let ue=0;const Te=[];if(E&&i.elevation){ue=(function(Ie,Me,Le,at,Ge){const ut=Me.elevation;if(!ut)return 0;const gt=nn.projectAabbCorners(Le,at),Et=re(1,Ge.lat)*Me.worldSize,jt=(function(ni,Kt){const ji=[0,0,1],ii=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ri of ii){const qi=ni[Ri.corners[0]],un=ni[Ri.corners[1]],Nn=ni[Ri.corners[2]],Zi=[un[0]-qi[0],un[1]-qi[1],Kt*(un[2]-qi[2])],$n=Wr(Zi,Zi,[Nn[0]-qi[0],Nn[1]-qi[1],Kt*(Nn[2]-qi[2])]);Ki($n,$n),Ri.dotProductWithUp=hr($n,ji)}return ii.sort(((Ri,qi)=>Ri.dotProductWithUp-qi.dotProductWithUp)),ii[0].corners})(gt,Et),Dt=gt[jt[0]],vt=gt[jt[1]],Mt=gt[jt[2]],ot=gt[jt[3]],et=ut.getAtPointOrZero(new Ve(Dt[0]/Me.worldSize,Dt[1]/Me.worldSize),0),It=ut.getAtPointOrZero(new Ve(vt[0]/Me.worldSize,vt[1]/Me.worldSize),0),Vt=ut.getAtPointOrZero(new Ve(Mt[0]/Me.worldSize,Mt[1]/Me.worldSize),0),bt=ut.getAtPointOrZero(new Ve(ot[0]/Me.worldSize,ot[1]/Me.worldSize),0),li=(et+bt)/2,fi=(It+Vt)/2;return li>fi?It<Vt?Fx(Ie,vt,ot,Dt,It,bt,et,Et):Fx(Ie,Mt,Dt,ot,Vt,et,bt,Et):et<bt?Fx(Ie,Dt,vt,Mt,et,It,Vt,Et):Fx(Ie,ot,Mt,vt,bt,Vt,It,Et),Math.max(li,fi)})(Te,i,e.aabb,r,a);const _e=ct([],nt([],Te),ae);ct(r,K,_e)}else ue=i.elevation.getAtPointOrZero(new Ve(D.x/Z,D.y/Z),0);ue!==0&&(r[14]+=ue)}}class sA{constructor(e,i,a,h,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=a!=null?new U(a[0],a[1]):new U(0,0),this.orientation=h??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){ct(e.globalMatrix,i,e.localMatrix);const a=this.nodeOverrides.get(e.name);if(a!==void 0){const _=[];m=a.orientation,Ze(h=_),Si(h,h,gn(m[1])),qe(h,h,gn(m[2])),Fi(h,h,gn(m[0])),ct(e.globalMatrix,e.globalMatrix,_)}var h,m;if(e.meshes)for(const _ of e.meshes){const v=nn.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(v)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Ze([]);this.aabb=new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,a,h,m,_,v=!1){Nx(this.matrix,this,e.transform,this.position,i,a,h,m,_,v)}upload(e){if(!this.uploaded){for(const i of this.nodes)lw(i,e);for(const i of this.nodes)Vx(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)cw(e)}}function Bv(r,e,i=!1){r.uploaded||(r.gfxTexture=new sw(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function hz(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,rz.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,lz.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,az.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?sz:oz).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,uz.members,!0)),r.segments=Lr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const a=r.material;a.pbrMetallicRoughness.baseColorTexture&&Bv(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Bv(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Bv(a.normalTexture,e),a.occlusionTexture&&Bv(a.occlusionTexture,e,i),a.emissionTexture&&Bv(a.emissionTexture,e)}function lw(r,e,i){if(r.meshes)for(const a of r.meshes)hz(a,e,i);if(r.children)for(const a of r.children)lw(a,e,i)}function Vx(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)Vx(e)}function cw(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)cw(i)}function Xg(r,e){const i=r.json.bufferViews[e.bufferView],a=lr[e.componentType];return new a(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Nr[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:Nr[e.type]))}function uw(r,e,i,a){const h=lr[e.componentType],m=(function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),_=r.json.bufferViews[e.bufferView],v=_.byteStride?_.byteStride/h.BYTES_PER_ELEMENT:Nr[e.type],E=i.float32,S=E.length/i.capacity;for(let M=0,D=0;M<e.count*v;M+=v,D+=S)for(let O=0;O<S;O++)E[D+O]=a[M+O]*m;i._trim()}function dz(r,e,i){const a=r.indices,h=r.attributes,m={};m.indexArray=new Cr;const _=e.json.accessors[a],v=_.count/3;m.indexArray.reserve(v);const E=Xg(e,_);for(let O=0;O<v;O++)m.indexArray.emplaceBack(E[3*O],E[3*O+1],E[3*O+2]);m.indexArray._trim(),m.vertexArray=new tl;const S=e.json.accessors[h.POSITION];m.vertexArray.reserve(S.count);const M=Xg(e,S);for(let O=0;O<S.count;O++)m.vertexArray.emplaceBack(M[3*O],M[3*O+1],M[3*O+2]);if(m.vertexArray._trim(),m.aabb=new nn(S.min,S.max),m.centroid=(function(O,N){const V=[0,0,0],$=O.length;if($>0){for(let Z=0;Z<$;Z++){const K=3*O[Z];V[0]+=N[K],V[1]+=N[K+1],V[2]+=N[K+2]}V[0]/=$,V[1]/=$,V[2]/=$}return V})(E,M),h.COLOR_0!==void 0){const O=e.json.accessors[h.COLOR_0],N=Nr[O.type],V=Xg(e,O);m.colorArray=N===3?new tl:new ou,m.colorArray.resize(O.count),uw(e,O,m.colorArray,V)}if(h.NORMAL!==void 0){m.normalArray=new tl;const O=e.json.accessors[h.NORMAL];m.normalArray.resize(O.count);const N=Xg(e,O);uw(e,O,m.normalArray,N)}if(h.TEXCOORD_0!==void 0&&i.length>0){m.texcoordArray=new Pc;const O=e.json.accessors[h.TEXCOORD_0];m.texcoordArray.resize(O.count);const N=Xg(e,O);uw(e,O,m.texcoordArray,N)}if(h._FEATURE_ID_RGBA4444!==void 0){const O=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Xg(e,O))}h._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Xg(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const D=r.material;return m.material=(function(O,N){const{emissiveFactor:V=[0,0,0],alphaMode:$="OPAQUE",alphaCutoff:Z=.5,normalTexture:K,occlusionTexture:ne,emissiveTexture:ae,doubleSided:ue,name:Te}=O,{baseColorFactor:_e=[1,1,1,1],metallicFactor:Ie=1,roughnessFactor:Me=1,baseColorTexture:Le,metallicRoughnessTexture:at}=O.pbrMetallicRoughness||{},Ge=ne?N[ne.index]:void 0;if(ne&&ne.extensions&&ne.extensions.KHR_texture_transform&&Ge){const ut=ne.extensions.KHR_texture_transform;Ge.offsetScale=[ut.offset[0],ut.offset[1],ut.scale[0],ut.scale[1]]}return{name:Te,pbrMetallicRoughness:{baseColorFactor:new On(..._e),metallicFactor:Ie,roughnessFactor:Me,baseColorTexture:Le?N[Le.index]:void 0,metallicRoughnessTexture:at?N[at.index]:void 0},doubleSided:ue,emissiveFactor:new On(...V),alphaMode:$,alphaCutoff:Z,normalTexture:K?N[K.index]:void 0,occlusionTexture:Ge,emissionTexture:ae?N[ae.index]:void 0,defined:O.defined===void 0}})(D!==void 0?e.json.materials[D]:{defined:!1},i),m}function oA(r,e,i){const{matrix:a,rotation:h,translation:m,scale:_,mesh:v,extras:E,children:S,name:M}=r,D={};if(D.name=M,D.localMatrix=a||(function(O,N,V,$){var Z=N[0],K=N[1],ne=N[2],ae=N[3],ue=Z+Z,Te=K+K,_e=ne+ne,Ie=Z*ue,Me=Z*Te,Le=Z*_e,at=K*Te,Ge=K*_e,ut=ne*_e,gt=ae*ue,Et=ae*Te,jt=ae*_e,Dt=$[0],vt=$[1],Mt=$[2];return O[0]=(1-(at+ut))*Dt,O[1]=(Me+jt)*Dt,O[2]=(Le-Et)*Dt,O[3]=0,O[4]=(Me-jt)*vt,O[5]=(1-(Ie+ut))*vt,O[6]=(Ge+gt)*vt,O[7]=0,O[8]=(Le+Et)*Mt,O[9]=(Ge-gt)*Mt,O[10]=(1-(Ie+at))*Mt,O[11]=0,O[12]=V[0],O[13]=V[1],O[14]=V[2],O[15]=1,O})([],h||[0,0,0,1],m||[0,0,0],_||[1,1,1]),D.globalMatrix=it(D.localMatrix),v!==void 0){D.meshes=i[v];const O=D.anchor=[0,0];for(const N of D.meshes){const{min:V,max:$}=N.aabb;O[0]+=V[0]+$[0],O[1]+=V[1]+$[1]}O[0]=Math.floor(O[0]/D.meshes.length/2),O[1]=Math.floor(O[1]/D.meshes.length/2)}if(E&&(E.id&&(D.id=E.id),E.lights&&(D.lights=(function(O){if(!O.length)return[];const N=(function(ne){const ae=atob(ne),ue=new Uint8Array(ae.length);for(let Te=0;Te<ae.length;Te++)ue[Te]=ae.codePointAt(Te);return ue})(O),V=[],$=N.length/24,Z=new Uint16Array(N.buffer),K=new Float32Array(N.buffer);for(let ne=0;ne<$;ne++){const ae=Z[2*ne*6]/30,ue=Z[2*ne*6+1]/30,Te=Z[2*ne*6+10]/100,_e=K[6*ne+1],Ie=K[6*ne+2],Me=K[6*ne+3],Le=K[6*ne+4],at=Me-_e,Ge=Le-Ie,ut=Math.hypot(at,Ge);V.push({pos:[_e+.5*at,Ie+.5*Ge,ue],normal:[Ge/ut,-at/ut,0],width:ut,height:ae,depth:Te,points:[_e,Ie,Me,Le]})}return V})(E.lights)),E.MAPBOX_geometry_bloom&&(D.isGeometryBloom=E.MAPBOX_geometry_bloom)),S){const O=[];for(const N of S)O.push(oA(e.json.nodes[N],e,i));D.children=O}return D}function fz(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Q_(r.vertices,r.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:a}}function pz(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const _ of i){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],E=_[1];typeof v=="number"&&typeof E=="number"&&a.push(new St(v,E))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let h=0;for(let _=0;_<a.length;_++){const v=a[_],E=a[(_+1)%a.length],S=a[(_+2)%a.length];h+=(v.x-E.x)*(S.y-E.y)-(S.x-E.x)*(v.y-E.y)}h>0&&a.reverse();const m=am(a.flatMap((_=>[_.x,_.y])),[]);return m.length===0?null:{vertices:a,indices:m}}function mz(r,e){const i=[],a=[];let h=0;const m=[];for(const _ of r){h=i.length;const v=_.vertexArray.float32,E=_.indexArray.uint16;for(let S=0;S<_.vertexArray.length;S++)m[0]=v[3*S+0],m[1]=v[3*S+1],m[2]=v[3*S+2],nr(m,m,e),i.push(new St(m[0],m[1]));for(let S=0;S<3*_.indexArray.length;S++)a.push(E[S]+h)}if(a.length%3!=0)return null;for(let _=0;_<a.length;_+=3){const v=i[a[_+0]],E=i[a[_+1]],S=i[a[_+2]];(v.x-E.x)*(S.y-E.y)-(S.x-E.x)*(v.y-E.y)>0&&([a[_+1],a[_+2]]=[a[_+2],a[_+1]])}return{vertices:i,indices:a}}function hw(r){const e=(function(E,S){const M=[],D=WebGL2RenderingContext;if(E.json.textures)for(const O of E.json.textures){const N={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};O.sampler!==void 0&&Object.assign(N,E.json.samplers[O.sampler]),M.push({image:S[O.source],sampler:N,uploaded:!1})}return M})(r,r.images),i=(function(E,S){const M=[];for(const D of E.json.meshes){const O=[];for(const N of D.primitives)O.push(dz(N,E,S));M.push(O)}return M})(r,e),{scenes:a,scene:h,nodes:m}=r.json,_=a?a[h||0].nodes:[...m.keys()],v=[];for(const E of _)v.push(oA(m[E],r,i));return(function(E,S,M){const D={},O=new Set;for(let N=0;N<E.length;N++){const V=M[S[N]];if(!V.extras)continue;const $=V.extras["mapbox:footprint:version"],Z=V.extras["mapbox:footprint:id"];($||Z)&&O.add(N),$==="1.0.0"&&Z&&(D[Z]=N)}for(let N=0;N<E.length;N++){if(O.has(N))continue;const V=E[N],$=M[S[N]];if(!$.extras)continue;let Z=null;V.id in D&&(Z=mz(E[D[V.id]].meshes,V.localMatrix)),Z||(Z=pz($)),Z&&(V.footprint=fz(Z))}if(O.size>0){const N=Array.from(O.values()).sort(((V,$)=>V-$));for(let V=N.length-1;V>=0;V--)E.splice(N[V],1)}})(v,_,r.json.nodes),v}function gz(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,a=r.aabb.min[1]-1,h=Zg/(r.aabb.max[0]-i+2),m=Zg/(r.aabb.max[1]-a+2);for(let _=0;_<e.length;_+=3){const v=e[_+2],E=(e[_+0]-i)*h|0,S=(e[_+1]-a)*m|0;v>r.heightmap[S*Zg+E]&&(r.heightmap[S*Zg+E]=v)}}function aA(r,e,i,a,h){i.reserve(i.length+4*r.length),a.reserve(a.length+10*r.length),h.reserve(h.length+10*r.length);let m=a.length;for(const _ of r){const v=Math.min(10,Math.max(4,1.3*_.height))*e,E=[-_.normal[1],_.normal[0],0],S=Math.min(.29,.1*_.width/_.depth),M=_.width-2*_.depth*e*(S+.01),D=_i([],_.pos,E,M/2),O=_i([],_.pos,E,-M/2),N=[D[0],D[1],D[2]+_.height],V=[O[0],O[1],O[2]+_.height],$=_i([],_.normal,E,S);ai($,$,v);const Z=_i([],_.normal,E,-S);ai(Z,Z,v),wi($,D,$),wi(Z,O,Z),D[2]+=.1,O[2]+=.1,a.emplaceBack($[0],$[1],$[2]),a.emplaceBack(Z[0],Z[1],Z[2]),a.emplaceBack(D[0],D[1],D[2]),a.emplaceBack(O[0],O[1],O[2]),a.emplaceBack(N[0],N[1],N[2]),a.emplaceBack(V[0],V[1],V[2]),a.emplaceBack(D[0],D[1],D[2]),a.emplaceBack(O[0],O[1],O[2]),a.emplaceBack($[0],$[1],$[2]),a.emplaceBack(Z[0],Z[1],Z[2]);const K=M/v/2;h.emplaceBack(-K-S,-1,K,.8),h.emplaceBack(K+S,-1,K,.8),h.emplaceBack(-K,0,K,1.3),h.emplaceBack(K,0,K,1.3),h.emplaceBack(K+S,-.8,K,.7),h.emplaceBack(K+S,-.8,K,.7),h.emplaceBack(0,0,K,1.3),h.emplaceBack(0,0,K,1.3),h.emplaceBack(K+S,-1.2,K,.8),h.emplaceBack(K+S,-1.2,K,.8),i.emplaceBack(6+m,4+m,8+m),i.emplaceBack(7+m,9+m,5+m),i.emplaceBack(0+m,1+m,2+m),i.emplaceBack(1+m,3+m,2+m),m+=10}}function _z(r,e){const i={};i.indexArray=new Cr,i.vertexArray=new tl,i.colorArray=new ou,aA(r,e,i.indexArray,i.vertexArray,i.colorArray);const a={defined:!0};a.emissiveFactor=On.black;const h={};return h.baseColorFactor=On.white,a.pbrMetallicRoughness=h,i.material=a,i.aabb=new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const lA=hn([{name:"a_pos_3f",components:3,type:"Float32"}]),yz=hn([{name:"a_normal_3",components:3,type:"Int16"}]),vz=hn([{name:"a_centroid_3",components:3,type:"Int16"}]),cA=hn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),xz=hn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),bz=hn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),wz=hn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Tz=hn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Ez=hn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),uA=At.types,Ux=32767;function Sz(r,e){const i=Nt+e;for(const a of r)for(const h of a)if(h.x<-e||h.x>i||h.y<-e||h.y>i)return!1;return!0}class hA{constructor(){this.layoutVertexArray=new tl,this.layoutAttenuationArray=new ou,this.layoutColorArray=new il,this.indexArray=new Cr,this.indexArrayForConflation=new Cr,this.segmentsBucket=new Lr}}class dw{constructor(){this.layoutVertexArray=new tl,this.layoutNormalArray=new ru,this.layoutCentroidArray=new ru,this.layoutColorArray=new il,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new Uf,this.layoutAOArray=new Dc,this.indexArray=new Cr,this.indexArrayForConflation=new Cr,this.segmentsBucket=new Lr,this.entranceBloom=new hA}}class dA{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new dw,this.buildingWithFacade=new dw,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new il,this.buildingWithFacade.layoutFacadeDataArray=new Yl,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new il,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new Gg(e),this.groundEffect.groundRadiusArray=new Dc,this.hasAppearances=null}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}updateAppearances(e,i,a,h){}prepare(){return(function(){if(ci!=null||Bt!=null)return null;if(lt!=null)return lt;const e=fetch(or.BUILDING_GEN_URL);return lt=(function(i){let a,h,m,_;function v(){a=new Uint8Array(_.buffer),h=new Int32Array(_.buffer),m=new Float32Array(_.buffer)}function E(){throw new Error("Unexpected BuildingGen error.")}const S=()=>{},M={a:{a:E,f:function(D){const O=a.length,N=Math.max(D>>>0,Math.ceil(1.2*O)),V=Math.ceil((N-O)/65536);try{return _.grow(V),v(),!0}catch{return!1}},g:E,b:S,c:S,d:S,e:S}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then((D=>D.arrayBuffer())).then((D=>WebAssembly.instantiate(D,M)))).then((D=>{const O=D.instance.exports;return(0,O.g)(),_=O.f,v(),new hi({setStyle:O.h,setAOOptions:O.i,setMetricOptions:O.j,setStructuralOptions:O.k,setFacadeOptions:O.l,setFauxFacadeOptions:O.m,setFacadeClassifierOptions:O.n,addFeature:O.o,addFacade:O.p,generateMesh:O.q,getLastError:O.r,getOuterRingLength:O.s,getMeshCount:O.t,getPositionsPtr:O.u,getPositionsLength:O.v,getNormalsPtr:O.w,getNormalsLength:O.x,getColorsPtr:O.y,getColorsLength:O.z,getAOPtr:O.A,getAOLength:O.B,getUVPtr:O.C,getUVLength:O.D,getFauxFacadePtr:O.E,getFauxFacadeLength:O.F,getIndicesPtr:O.G,getIndicesLength:O.H,getBuildingPart:O.I,getRingCount:O.J,getRingPtr:O.K,getRingLength:O.L,free:O.M,malloc:O.N,heapU8:a,heap32:h,heapF32:m})}))})(e).then((i=>(lt=null,ci=i,ci))).catch((i=>{gi("Could not load building-gen"),lt=null,Bt=i})),lt})()}populate(e,i,a,h){const m=mn();if(!m)return;const _=Se(a);this.tileToMeter=_,this.brightness=i.brightness,m.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,_],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:_,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const v=new Map,E=new Map;for(const{feature:S}of e){if(uA[S.type]!=="LineString"){v.set(S.id,S.properties.source_id);continue}const M=this.layers[0]._featureFilter.needGeometry,D=Ke(S,M);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom),D,a))continue;const O=M?D.geometry:dt(S,a,h),N=[];for(const K of O)for(const ne of K)N.push({x:ne.x,y:ne.y});const V={coordinates:N,crossPerc:S.properties.cross_perc,distanceToRoad:S.properties.distance_to_road,entrances:S.properties.entrances,sourceId:0},$=S.properties.source_id;let Z=E.get($);Z||(Z=[],E.set($,Z)),Z.push(V)}this.maxHeight=0;for(const{feature:S,id:M,index:D,sourceLayerIndex:O}of e){if(uA[S.type]==="LineString")continue;const N=this.layers[0]._featureFilter.needGeometry,V=Ke(S,N);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom),V,a))continue;const $=N?V.geometry:dt(S,a,h),Z=Zf($,500);if(!Sz($,163))continue;const K=this.layers[0],ne=K.layout.get("building-roof-shape").evaluate(S,{},a);if(ne==="flat")continue;const ae=K.layout.get("building-base").evaluate(S,{},a),ue=K.layout.get("building-height").evaluate(S,{},a),Te=K.layout.get("building-flood-light-ground-radius").evaluate(S,{},a),_e=K.paint.get("building-ambient-occlusion-intensity"),Ie=Te/this.tileToMeter;let Me=K.layout.get("building-flood-light-wall-radius").evaluate(S,{},a);Me=J(Me,0,2048);const Le=Me/2048*Ux,at=v.get(M);let Ge;Ge=E.has(at)?E.get(at):[];const ut=Ge.length!==0&&K.layout.get("building-facade").evaluate(S,{},a);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(ut,!1,1);let gt=0,Et=0,jt=0,Dt=0,vt=0,Mt=0;if(ut){let pt=Math.round(K.layout.get("building-facade-floors").evaluate(S,{},a));if(ae===0){pt=Math.max(1,pt-(Ge.length>0?1:0));let bi=4;if(ue>100){const vi=[10,13,15];bi=vi[S.id?S.id%vi.length:0],m.setFacadeOptions(bi,!0)}vt=1.6803*bi/_}else vt=ae/_;Mt=ue/_,vt=Math.min(vt,Mt),jt=K.layout.get("building-facade-unit-width").evaluate(S,{},a)/_,Dt=(Mt-vt)/pt,m.setFauxFacadeOptions(!0,!0,jt);const Qt=K.layout.get("building-facade-window").evaluate(S,{},a);gt=Qt[0],Et=Qt[1]}const ot=[],et=new St(1/0,1/0),It=new St(-1/0,-1/0),Vt=new St(0,0);let bt=0;for(const pt of Z)if(pt.length>0){const Qt=[];for(const bi of pt){const vi=[];for(let Yi=bi.length-1;Yi>=0;Yi--){const zi=bi[Yi];vi.push({x:zi.x,y:zi.y}),et.x=Math.min(et.x,zi.x),et.y=Math.min(et.y,zi.y),It.x=Math.max(It.x,zi.x),It.y=Math.max(It.y,zi.y),Vt.x+=zi.x,Vt.y+=zi.y,bt++}Qt.push(vi)}ot.push({id:S.id?S.id:0,height:ue,minHeight:ae,sourceId:0,roofType:ne,coordinates:Qt})}Vt.x/=bt||1,Vt.y/=bt||1;const li=m.generateMesh(ot,Ge);if(typeof li=="string"){gi(`Unable to generate building ${S.id}: ${li}`);continue}if(li.meshes.length===0||li.modifiedPolygonRings.length===0)continue;let fi=0;for(const pt of li.meshes)fi+=pt.positions.length/3;const ni=ut?this.buildingWithFacade:this.buildingWithoutFacade,Kt=ni.segmentsBucket.prepareSegment(fi,ni.layoutVertexArray,ni.indexArray),ji=[];let ii=null,Ri=0,qi=-1;const un=ni.layoutVertexArray.length,Nn=ni.indexArray.length;let Zi=0;for(const pt of li.meshes){const Qt=ni.layoutVertexArray.length;if(pt.buildingPart==="entrance"){const mi=new Array;for(let Ln=0;Ln<pt.positions.length;Ln+=12){const yr=pt.positions[Ln+0],sr=pt.positions[Ln+1],cs=pt.positions[Ln+3],Vr=pt.positions[Ln+4],Sr=pt.positions[Ln+2],cr=pt.positions[Ln+8]-Sr,Zn=1,Qi=cs-yr,Xn=Vr-sr,Ar=Math.hypot(Qi,Xn);mi.push({pos:[yr+.5*Qi,sr+.5*Xn,Sr],normal:[Xn/Ar,-Qi/Ar,0],width:Ar,height:cr,depth:Zn,points:[yr,sr,cs,Vr]})}const Gn=ni.entranceBloom.segmentsBucket.prepareSegment(10*mi.length,ni.entranceBloom.layoutVertexArray,ni.entranceBloom.indexArray),_r=ni.entranceBloom.layoutVertexArray.length;Ri=ni.entranceBloom.indexArray.length,aA(mi,.5/this.tileToMeter,ni.entranceBloom.indexArray,ni.entranceBloom.layoutVertexArray,ni.entranceBloom.layoutAttenuationArray);const Bi=ni.entranceBloom.layoutVertexArray.length-_r;qi=ni.entranceBloom.indexArray.length-Ri;for(let Ln=0;Ln<Bi;Ln++)ni.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Gn.vertexLength+=Bi,Gn.primitiveLength+=qi,ii={part:pt.buildingPart,vertexOffset:_r,vertexLength:Bi}}for(let mi=0;mi<pt.positions.length;mi+=3)Zi=Math.max(Zi,pt.positions[mi+2]),ni.layoutVertexArray.emplaceBack(pt.positions[mi],pt.positions[mi+1],pt.positions[mi+2]);const bi=Math.floor(Vt.x),vi=Math.floor(Vt.y),Yi=Math.floor(Zi);for(let mi=0;mi<pt.positions.length;mi+=3)ni.layoutCentroidArray.emplaceBack(bi,vi,Yi),ni.layoutFloodLightDataArray.emplaceBack(pt.buildingPart==="wall"?Le:0);for(let mi=0;mi<pt.normals.length;mi+=3)ni.layoutNormalArray.emplaceBack(pt.normals[mi+0]*Ux,pt.normals[mi+1]*Ux,pt.normals[mi+2]*Ux);for(let mi=0;mi<pt.ao.length;mi++)ni.layoutAOArray.emplaceBack(pt.ao[mi]);for(let mi=0;mi<pt.colors.length;mi+=3){const Gn=1+(pt.ao[mi/3]-1)*_e;ni.layoutColorArray.emplaceBack(pt.colors[mi]*Gn<<8|pt.colors[mi+1]*Gn,pt.colors[mi+2]*Gn<<8)}if(ut){for(let mi=0;mi<pt.positions.length;mi+=3)ni.layoutFacadePaintArray.emplaceBack(65535,255);for(let mi=0;mi<pt.isFauxFacade.length;mi++)if(pt.isFauxFacade[mi]){const Gn=1|Math.min(65535,Math.floor(pt.uv[2*mi]*li.outerRingLength)),_r=Math.floor(255*gt)<<8|Math.floor(255*Et),Bi=Math.floor(65535*Math.min(1,jt/Nt)),Ln=Math.floor(65535*Math.min(1,Dt/Nt));ni.layoutFacadeDataArray.emplaceBack(Gn,_r,Bi,Ln);const yr=Math.floor(65535*Math.min(1,vt/Nt)),sr=Math.floor(65535*Math.min(1,Mt/Nt));ni.layoutFacadeVerticalRangeArray.emplaceBack(yr,sr)}else ni.layoutFacadeDataArray.emplaceBack(0,0,0,0),ni.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const zi=Kt.vertexLength;for(let mi=0;mi<pt.indices.length;mi+=3)ni.indexArray.emplaceBack(zi+pt.indices[mi],zi+pt.indices[mi+1],zi+pt.indices[mi+2]);Kt.vertexLength+=pt.positions.length/3,Kt.primitiveLength+=pt.indices.length/3,(pt.buildingPart==="roof"||pt.buildingPart==="wall"||pt.buildingPart==="facade_glazing"||pt.buildingPart==="entrance")&&ji.push({part:pt.buildingPart,vertexOffset:Qt,vertexLength:pt.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Zi),this.buildingFeatures.push({promoteId:M,feature:V,hasFauxFacade:ut,segment:Kt,parts:ji,buildingBloom:ii});const $n=ni.indexArray.length-Nn,Wn=[],es=[],ye=new St(1/0,1/0),pe=new St(-1/0,-1/0),ft=this.groundEffect.vertexArray.length;for(const pt of li.modifiedPolygonRings){const Qt=[],bi=new St(1/0,1/0),vi=new St(-1/0,-1/0);for(let Yi=0;Yi<pt.length;Yi+=2){const zi=pt.length-Yi-2;bi.x=Math.min(bi.x,pt[zi]),bi.y=Math.min(bi.y,pt[zi+1]),vi.x=Math.max(vi.x,pt[zi]),vi.y=Math.max(vi.y,pt[zi+1]);const mi=new St(pt[zi],pt[zi+1]);Qt.push(mi),Wn.push(mi.x,mi.y),es.push(mi.clone())}ye.x=Math.min(ye.x,bi.x),ye.y=Math.min(ye.y,bi.y),pe.x=Math.max(pe.x,vi.x),pe.y=Math.max(pe.y,vi.y),this.groundEffect.addData(Qt,[bi,vi],Ie)}const Wt=this.groundEffect.vertexArray.length-ft;for(let pt=0;pt<Wt;pt++)this.groundEffect.groundRadiusArray.emplaceBack(Te);(et.x<0||It.x>Nt||et.y<0||It.y>Nt)&&this.featuresOnBorder.push({featureId:S.id,footprintIndex:this.footprints.length});{const pt=am(Wn,null,2),Qt=new Q_(es,pt,8,256);let bi=S.id;S.properties&&S.properties.hasOwnProperty("building_id")&&(bi=S.properties.building_id);const vi={vertices:es,indices:pt,grid:Qt,min:ye,max:pe,buildingId:bi,hiddenFlags:0,indicesOffset:Nn,indicesLength:$n,bloomIndicesOffset:Ri,bloomIndicesLength:qi,groundEffectVertexOffset:ft,groundEffectVertexLength:Wt,hasFauxFacade:ut,segment:Kt,height:Zi};S.id!==void 0&&this.featureFootprintLookup.set(S.id,this.footprints.length),this.footprints.push(vi)}this.programConfigurations.populatePaintArrays(ni.layoutVertexArray.length,S,D,{},i.availableImages,a,i.brightness),this.groundEffect.addPaintPropertiesData(S,D,{},i.availableImages,a,i.brightness),i.featureIndex.insert(S,$,D,O,this.index,un)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,a,h,m,_,v){this.programConfigurations.updatePaintArrays(e,i,m,a,h,_,v),this.groundEffect.update(e,i,m,a,h,_,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,lA.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,yz.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,vz.members),a.layoutFloodLightDataBuffer=e.createVertexBuffer(a.layoutFloodLightDataArray,Ez.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,bz.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,wz.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,lA.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,Tz.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,a=!0){let h=!1;const m=a?i:0,_=0|(a?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const E=this.footprints[v],S=E.hiddenFlags&_|m;E.hiddenFlags!==S&&(E.hiddenFlags=S,h=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=h=>{h.indexArray.length!==0&&(h.indexArrayForConflation.resize(h.indexArray.length),h.indexArrayForConflation.uint16.set(h.indexArray.uint16),h.entranceBloom.indexArrayForConflation.resize(h.entranceBloom.indexArray.length),h.entranceBloom.indexArrayForConflation.uint16.set(h.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const h of this.footprints){const m=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=h.indicesOffset+h.indicesLength;if(h.hiddenFlags!==0){for(let E=h.indicesOffset;E<_;E++)m.indexArrayForConflation.uint16[3*E+0]=0,m.indexArrayForConflation.uint16[3*E+1]=0,m.indexArrayForConflation.uint16[3*E+2]=0;const v=h.bloomIndicesOffset+h.bloomIndicesLength;for(let E=h.bloomIndicesOffset;E<v;E++)m.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const a=h=>{h.indexArray.length!==0&&(h.indexBuffer?h.indexBuffer.updateData(h.indexArrayForConflation):h.indexBuffer=e.createIndexBuffer(h.indexArrayForConflation,!0),h.entranceBloom.indexBuffer?h.entranceBloom.indexBuffer.updateData(h.entranceBloom.indexArrayForConflation):h.entranceBloom.indexBuffer=e.createIndexBuffer(h.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,cA.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,xz.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,cA.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const a=e.paint.get("building-ambient-occlusion-intensity");for(const h of this.buildingFeatures){const m=i[h.promoteId],_=h.feature;_.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),E=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="wall";const S=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="window";const D=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),O=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical);_.properties["building-part"]="door";const N=e.paint.get("building-color").evaluate(_,m,this.canonical).toPremultipliedRenderColor(this.lut),V=e.paint.get("building-emissive-strength").evaluate(_,m,this.canonical),$=h.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const K of h.parts){let ne,ae=v;K.part==="roof"?(ae=v,ne=E):K.part==="wall"?(ae=S,ne=M):K.part==="facade_glazing"?(ae=D,ne=O):K.part==="entrance"&&(ae=N,ne=V),ne=J(ne,0,1);for(let ue=0;ue<K.vertexLength;ue++){const Te=K.vertexOffset+ue,_e=1+($.layoutAOArray.float32[Te]-1)*a;$.layoutColorArray.emplace(Te,ae.r*_e*255<<8|ae.g*_e*255,ae.b*_e*255<<8|255*ne),h.hasFauxFacade&&$.layoutFacadePaintArray.emplace(Te,255*D.r<<8|255*D.g,255*D.b<<8|255*O)}}const Z=h.buildingBloom;if(Z)for(let K=0;K<Z.vertexLength;K++)$.entranceBloom.layoutColorArray.emplace(Z.vertexOffset+K,255*N.r<<8|255*N.g,255*N.b<<8|51*V)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(Bg(this.activeReplacements,h))return;this.activeReplacements=h;for(const _ of this.footprints)_.hiddenFlags&=-2;const m=[];for(const _ of this.activeReplacements){if(_.order<=Av)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const E of this.footprints)E.min.x>_.max.x||E.max.x<_.min.x||E.min.y>_.max.y||E.max.y<_.min.y||(m.length=0,Az(E.vertices,0,E.vertices.length,_.footprintTileId.canonical,e.canonical,m),ey(_.footprint,m,E.indices,0,E.indices.length,0,-v)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,h=!0;const m=4*(e+Nt)*Nt+(i+Nt);if(this.footprintLookup.hasOwnProperty(m)){const v=this.footprintLookup[m];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new St(e,i);for(const v of this.footprints)e>v.max.x||v.min.x>e||i>v.max.y||v.min.y>i||v.height<=a||Cv(_,v)&&(a=v.height,this.footprintLookup[m]=v,h=v.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:h};this.footprintLookup[m]=void 0}}function Az(r,e,i,a,h,m){const _=Math.pow(2,a.z-h.z);for(let v=0;v<i;v++){let E=r[v+e].x,S=r[v+e].y;E=(E+h.x*Nt)*_-a.x*Nt,S=(S+h.y*Nt)*_-a.y*Nt,m.push(new St(E,S))}}let fA,pA;Lt(dA,"BuildingBucket",{omit:["layers"]}),Lt(dw,"BuildingGeometry"),Lt(hA,"BuildingBloomGeometry");const Iz=hn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Cz=hn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Rz}=Iz,Mz=hn([{name:"a_packed",components:3,type:"Float32"}]),{members:Dz}=Mz,Pz=hn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Oz}=Pz;class mA{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new cu({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=Be(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const h=[];let m=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,v=!0;h.push({left:m,right:_,isDash:v,zeroLength:e[0]===0});let E=e[0];for(let S=1;S<e.length;S++){v=!v;const M=e[S];m=E*a,E+=M,_=E*a,h.push({left:m,right:_,isDash:v,zeroLength:M===0})}return h}addRoundDash(e,i,a){const h=i/2;for(let m=-a;m<=a;m++){const _=this.width*(this.nextRow+a+m);let v=0,E=e[v];for(let S=0;S<this.width;S++){S/E.right>1&&(E=e[++v]);const M=Math.abs(S-E.left),D=Math.abs(S-E.right),O=Math.min(M,D);let N;const V=m/a*(h+1);if(E.isDash){const $=h-Math.abs(V);N=Math.sqrt(O*O+$*$)}else N=h-Math.sqrt(O*O+V*V);this.image.data[_+S]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,i){for(let E=e.length-1;E>=0;--E){const S=e[E],M=e[E+1];S.zeroLength?e.splice(E,1):M&&M.isDash===S.isDash&&(M.left=S.left,e.splice(E,1))}const a=e[0],h=e[e.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const m=this.width*this.nextRow;let _=0,v=e[_];for(let E=0;E<this.width;E++){E/v.right>1&&(v=e[++_]);const S=Math.abs(E-v.left),M=Math.abs(E-v.right),D=Math.min(S,M);this.image.data[m+E]=Math.max(0,Math.min(255,(v.isDash?D:-D)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const h=i==="round",m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return gi("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let M=0;M<e.length;M++)e[M]<0&&(gi("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),v+=e[M];if(v!==0){const M=this.width/v,D=this.getDashRanges(e,this.width,M);h?this.addRoundDash(D,M,m):this.addRegularDash(D,i==="square"?.5*M:0)}const E=this.nextRow+m;this.nextRow+=_;const S={tl:[E,m],br:[v,0]};return this.positions[a]=S,S}}Lt(mA,"LineAtlas");const Lz=At.types,zz=Math.cos(Math.PI/180*37.5),kz=Math.cos(Math.PI/180*5);class fw{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new qp,this.layoutVertexArray2=new tl,this.patternVertexArray=new tl,this.indexArray=new Cr,this.programConfigurations=new El(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Lr,this.maxLineLength=0,this.zOffsetVertexArray=new tl,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Nt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,h){}populate(e,i,a,h){this.hasPattern=K_("line",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Se(a);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const O=this.layers[0].layout.get("line-z-offset"),N=O.isConstant()&&!O.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&_==="none"&&gi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const E=[];for(const{feature:O,id:N,index:V,sourceLayerIndex:$}of e){const Z=this.layers[0]._featureFilter.needGeometry,K=Ke(O,Z);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),K,a))continue;const ne=m?m.evaluate(K,{},a):void 0,ae={id:N,properties:O.properties,type:O.type,sourceLayerIndex:$,index:V,geometry:Z?K.geometry:dt(O,a,h),patterns:{},sortKey:ne};E.push(ae)}m&&E.sort(((O,N)=>O.sortKey-N.sortKey));const{lineAtlas:S,featureIndex:M}=i,D=this.addConstantDashes(S);for(const O of E){const{geometry:N,index:V,sourceLayerIndex:$}=O;if(D&&this.addFeatureDashes(O,S),this.hasPattern){const Z=zg("line",this.layers,O,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Z)}else this.addFeature(O,N,V,a,S.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[V].feature,N,V,$,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if(h.kind!=="constant"||m.kind!=="constant")i=!0;else{const _=m.value,v=h.value;if(!v)continue;e.addDash(v,_)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(m.kind==="constant"&&_.kind==="constant")continue;let v,E;if(m.kind==="constant"){if(v=m.value,!v)continue}else v=m.evaluate({zoom:a},e);E=_.kind==="constant"?_.value:_.evaluate({zoom:a},e),i.addDash(v,E),e.patterns[h.id]=[i.getKey(v,E)]}}update(e,i,a,h,m,_,v,E){this.programConfigurations.updatePaintArrays(e,i,m,a,h,_,v,E)}addFeatures(e,i,a,h,m,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,a,h,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Dz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Oz)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Cz.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rz),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let a,h;if(i&&i>0?(a=`mapbox_clip_start_${i}`,h=`mapbox_clip_end_${i}`):(a="mapbox_clip_start",h="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(h))return{start:+e.properties[a],end:+e.properties[h]}}addFeature(e,i,a,h,m,_,v,E){const S=this.layers[0].layout,M=S.get("line-join").evaluate(e,{}),D=S.get("line-cap").evaluate(e,{}),O=S.get("line-miter-limit"),N=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const V=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=S.get("line-z-offset").value;const $=this.layers[0].paint.get("line-width").value;if($.kind!=="constant"&&$.isLineProgressConstant===!1&&(this.variableWidthValue=$),this.elevationType==="road"){const Z=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,h,E,M,D,O,N)){const[K,ne]=this.clipRuntimeLinesToTile(i,1);for(let ae=0;ae<K.length;ae++){const ue=K[ae],Te=ne[ae],_e={progress:{min:Te.progress.min,max:Te.progress.max},nextDir:this.computeSegNextDir(Te,ue),prevDir:this.computeSegPrevDir(Te,ue)};this.addLine(ue,e,h,M,D,O,N,_e,V&&Te.parentIndex>0?Te.parentIndex:null)}this.fillNonElevatedRoadSegment(Z)}}else for(let Z=0;Z<i.length;Z++)this.addLine(i[Z],e,h,M,D,O,N,void 0,V&&Z>0?Z:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,_,h,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Wh(e,-i,-i,Nt+i,Nt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[Wh(e,-i,-i,Nt+i,Nt+i,a),a]}addElevatedRoadFeature(e,i,a,h,m,_,v,E){const S=[],M=Ei.getElevationFeature(e,h);if(M){const D=this.clipLinesToTile(i,1),O=this.prepareElevatedLines(D,M,a);for(const N of O)S.push({geometry:N,elevation:M,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const D of S){const O=this.layoutVertexArray.length;this.addLine(D.geometry,e,a,m,_,v,E);const N=new pn(a,D.elevationTileID);if(D.elevation)for(let V=O;V<this.layoutVertexArray.length;V++){const $=new St(this.layoutVertexArray.int16[6*V]>>1,this.layoutVertexArray.int16[6*V+1]>>1),Z=N.pointElevation($,D.elevation,.05);this.updateHeightRange(Z),this.zOffsetVertexArray.emplaceBack(Z,0,0)}else this.fillNonElevatedRoadSegment(O)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const h=[],m=1/Se(a);for(const _ of e)Ox(_,new gr(i,m),0,h);return h}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,h,m,_,v,E,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=S?this.lineFeatureClips(i,S):this.lineClips;const M=h==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const D=E&&E.progress.min>0,O=E&&E.progress.max<1;if(this.lineClips){let Le={min:this.lineClips.start,max:this.lineClips.end},at=1;if(E){const gt=this.lineClips.end-this.lineClips.start;Le=(function(Et,jt,Dt){return{min:fn(Et.min,jt,Dt),max:fn(Et.max,jt,Dt)}})(E.progress,{min:0,max:1},Le),gt>0&&(at=(Le.max-Le.min)/gt)}const Ge=+i.properties.mapbox_clip_feature_len,ut=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ge)||Number.isNaN(ut)){for(let Et=0;Et<e.length-1;Et++)this.totalDistance+=e[Et].dist(e[Et+1]);const gt=this.totalDistance/(Le.max-Le.min);this.totalFeatureLength=Number.isFinite(gt)?gt:0,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ge,this.distance=ut*at,this.lineClips.start=Le.min,this.lineClips.end=Le.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const N=Lz[i.type]==="Polygon";let V=e.length;for(;V>=2&&e[V-1].equals(e[V-2]);)V--;let $=0;for(;$<V-1&&e[$].equals(e[$+1]);)$++;if(V<(N?3:2))return;h==="bevel"&&(_=1.05);const Z=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let K,ne,ae,ue,Te,_e,Ie,Me;E&&E.prevDir&&(_e=E.prevDir.perp()),E&&E.nextDir&&(Ie=E.nextDir.perp()),this.e1=this.e2=-1,N&&(K=e[V-2],Te=e[$].sub(K)._unit()._perp());for(let Le=$;Le<V;Le++){if(ae=Le===V-1?N?e[$+1]:void 0:e[Le+1],ae&&e[Le].equals(ae))continue;Te&&(ue=Te),K&&(ne=K),K=e[Le],Me=this.evaluateLineProgressFeatures(ne?ne.dist(K):0),Te=ae?ae.sub(K)._unit()._perp():ue,ue=ue||Te;const at=ne&&ae;let Ge=at?h:N||M?"butt":m;const ut=ue.x*Te.x+ue.y*Te.y;if(M){const et=function(It){if(It.patternJoinNone){const Vt=It.segmentPoints.length/2,bt=It.lineSoFar-It.segmentStart;for(let li=0;li<Vt;++li){const fi=It.segmentPoints[2*li+1],ni=Math.round(It.segmentPoints[2*li])+.5+.25*fi;It.patternVertexArray.emplaceBack(ni,bt,It.segmentStart),It.patternVertexArray.emplaceBack(ni,bt,It.segmentStart)}It.segmentPoints.length=0}It.e1=It.e2=-1};if(at&&ut<kz){this.updateDistance(ne,K),this.addCurrentVertex(K,ue,1,1,Z,Me),et(this),this.addCurrentVertex(K,Te,-1,-1,Z,Me);continue}if(ne){if(!ae){this.updateDistance(ne,K),this.addCurrentVertex(K,ue,1,1,Z,Me),et(this);continue}Ge="miter"}}let gt=ue.add(Te);gt.x===0&&gt.y===0||gt._unit();const Et=gt.x*Te.x+gt.y*Te.y,jt=Et!==0?1/Et:1/0,Dt=2*Math.sqrt(2-2*Et),vt=Et<zz&&ne&&ae,Mt=ue.x*Te.y-ue.y*Te.x>0,ot=this.overscaling<=16?15*Nt/(512*this.overscaling):0;if(at&&Ge==="round"){if(jt<v)Ge="miter";else if(jt<=2){const et=pw(K,-10,Nt+10);Ge=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if(Ge==="miter"&&jt>_&&(Ge="bevel"),Ge==="bevel"&&(jt>2&&(Ge="flipbevel"),jt<_&&(Ge="miter")),ne&&!(Ge==="miter"&&vt)&&this.updateDistance(ne,K),Ge==="miter")if(vt){const et=K.dist(ne);if(et>2*ot){const Vt=K.sub(K.sub(ne)._mult(ot/et)._round());this.updateDistance(ne,Vt),this.addCurrentVertex(Vt,ue,0,0,Z,Me),ne=Vt}this.updateDistance(ne,K),gt._mult(jt),this.addCurrentVertex(K,gt,0,0,Z,Me);const It=K.dist(ae);if(It>2*ot){const Vt=K.add(ae.sub(K)._mult(ot/It)._round());this.updateDistance(K,Vt),this.addCurrentVertex(Vt,Te,0,0,Z,Me),K=Vt}}else gt._mult(jt),this.addCurrentVertex(K,gt,0,0,Z,Me);else if(Ge==="flipbevel"){if(jt>100)gt=Te.mult(-1);else{const et=jt*ue.add(Te).mag()/ue.sub(Te).mag();gt._perp()._mult(et*(Mt?-1:1))}this.addCurrentVertex(K,gt,0,0,Z,Me),this.addCurrentVertex(K,gt.mult(-1),0,0,Z,Me)}else if(Ge==="bevel"||Ge==="fakeround"){Me!=null&&ne&&this.addCurrentVertex(K,Ie||ue,-1,-1,Z,Me);const et=K.dist(ne)<=2*ot&&Ge!=="bevel",It=gt.mult(Mt?1:-1);It._mult(jt);const Vt=Te.mult(Mt?-1:1),bt=ue.mult(Mt?-1:1),li=this.evaluateLineProgressFeatures(this.distance);if(Me==null&&(this.addHalfVertex(K,It.x,It.y,!1,!Mt,0,Z,li),et||this.addHalfVertex(K,It.x+2*bt.x,It.y+2*bt.y,!1,Mt,0,Z,li)),Ge==="fakeround"){const fi=Math.round(180*Dt/Math.PI/20);this.addHalfVertex(K,bt.x,bt.y,!1,Mt,0,Z,li);for(let ni=0;ni<fi;ni++){let Kt=ni/fi;if(Kt!==.5){const ii=Kt-.5;Kt+=Kt*ii*(Kt-1)*((1.0904+ut*(ut*(3.55645-1.43519*ut)-3.2452))*ii*ii+(.848013+ut*(.215638*ut-1.06021)))}const ji=Vt.sub(bt)._mult(Kt)._add(bt)._unit();this.addHalfVertex(K,ji.x,ji.y,!1,Mt,0,Z,li)}this.addHalfVertex(K,Vt.x,Vt.y,!1,Mt,0,Z,li)}et||Me!=null||this.addHalfVertex(K,It.x+2*Vt.x,It.y+2*Vt.y,!1,Mt,0,Z,li),Me!=null&&ae&&this.addCurrentVertex(K,_e||Te,1,1,Z,Me)}else if(Ge==="butt")this.addCurrentVertex(K,gt,0,0,Z,Me);else if(Ge==="square"){if(!ne){const et=D?0:-1;this.addCurrentVertex(K,gt,et,et,Z,Me)}if(this.addCurrentVertex(K,gt,0,0,Z,Me),ne){const et=O?0:1;this.addCurrentVertex(K,gt,et,et,Z,Me)}}else if(Ge==="round"){if(ne){const et=!at&&Ie?Ie:ue;this.addCurrentVertex(K,et,0,0,Z,Me),!at&&O||this.addCurrentVertex(K,et,1,1,Z,Me,!0)}if(ae){const et=!at&&_e?_e:Te;!at&&D||this.addCurrentVertex(K,et,-1,-1,Z,Me,!0),this.addCurrentVertex(K,et,0,0,Z,Me)}}}}addVerticesTo(e,i,a,h,m,_,v,E,S,M){const D=(i.w-e.w)/this.tessellationStep|0;let O=0;const N=this.scaledDistance;if(D>1){this.lineSoFar=e.w;const $=(i.x-e.x)/D,Z=(i.y-e.y)/D,K=(i.z-e.z)/D,ne=(i.w-e.w)/D;for(let ae=1;ae<D;++ae){e.x+=$,e.y+=Z,e.z+=K,this.lineSoFar+=ne,O+=ne;const ue=this.evaluateLineProgressFeatures(this.prevDistance+O);this.scaledDistance=(this.prevDistance+O)/this.totalDistance,this.addHalfVertex(e,a,h,M,!1,v,S,ue),this.addHalfVertex(e,m,_,M,!0,-E,S,ue)}}this.lineSoFar=i.w,this.scaledDistance=N;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,h,M,!1,v,S,V),this.addHalfVertex(i,m,_,M,!0,-E,S,V)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):gi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,h,m,_,v=!1){const E=i.x+i.y*a,S=i.y-i.x*a,M=i.y*h-i.x,D=-i.y-i.x*h;if(_!=null){const O=this.elevationType==="offset",N=-10,V=Nt+10,$=_.zOffset,Z=new Hg(e.x,e.y,$,this.lineSoFar),K=!!O&&pw(e,N,V),ne=this.lineSoFar,ae=this.distance;if(this.currentVertex)if(K){const ue=this.currentVertexIsOutside,Te=this.currentVertex,_e=new Hg(e.x,e.y,$,this.lineSoFar);if(Lv(Te,_e,N,V),!pw(_e,N,V)){if(ue){this.e1=this.e2=-1,this.distance-=Te.dist(Z),this.lineSoFar=Te.w;const Ie=this.evaluateLineProgressFeatures(Te.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Te,E,S,v,!1,a,m,Ie),this.addHalfVertex(Te,M,D,v,!0,-h,m,Ie),this.prevDistance=this.distance}this.distance=this.prevDistance+Te.dist(_e),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Te,_e,E,S,M,D,a,h,m,v),this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}}else{const ue=this.currentVertex;if(this.currentVertexIsOutside){Lv(ue,Z,N,V),this.e1=this.e2=-1,this.distance-=ue.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ue.w;const Te=this.evaluateLineProgressFeatures(ue.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ue,E,S,v,!1,a,m,Te),this.addHalfVertex(ue,M,D,v,!0,-h,m,Te),this.prevDistance=this.distance,this.distance=ae,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ue,Z,E,S,M,D,a,h,m,v)}else K||(this.addHalfVertex(e,E,S,v,!1,a,m,_),this.addHalfVertex(e,M,D,v,!0,-h,m,_));this.currentVertex=Z,this.currentVertexIsOutside=K,this.lineSoFar=ne}else this.addHalfVertex(e,E,S,v,!1,a,m,_),this.addHalfVertex(e,M,D,v,!0,-h,m,_)}addHalfVertex({x:e,y:i},a,h,m,_,v,E,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(_?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=Oi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),_?this.e2=M:this.e1=M,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function pw(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let gA,_A;function yA(r,e,i){return e*(Nt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Lt(fw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const vA=(r,e,i)=>(1-i)*r+i*e;function xA(r,e){return 1/yA(r,1,e.tileZoom)}function bA(r,e,i,a){return r.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const wA=r=>{const e=[];TA(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=r.layout.get("line-join").constantOr("miter")==="none",h=!!r.paint.get("line-pattern").constantOr(1);return a&&h&&e.push("LINE_JOIN_NONE"),e};function TA(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let mw;const EA=()=>mw||(mw={layout:gA||(gA=new rs({"line-cap":new ti(Ue.layout_line["line-cap"]),"line-join":new ti(Ue.layout_line["line-join"]),"line-miter-limit":new kt(Ue.layout_line["line-miter-limit"]),"line-round-limit":new kt(Ue.layout_line["line-round-limit"]),"line-sort-key":new ti(Ue.layout_line["line-sort-key"]),"line-z-offset":new ti(Ue.layout_line["line-z-offset"]),"line-elevation-reference":new kt(Ue.layout_line["line-elevation-reference"]),"line-cross-slope":new kt(Ue.layout_line["line-cross-slope"]),visibility:new kt(Ue.layout_line.visibility),"line-width-unit":new kt(Ue.layout_line["line-width-unit"])})),paint:_A||(_A=new rs({"line-opacity":new ti(Ue.paint_line["line-opacity"]),"line-color":new ti(Ue.paint_line["line-color"]),"line-translate":new kt(Ue.paint_line["line-translate"]),"line-translate-anchor":new kt(Ue.paint_line["line-translate-anchor"]),"line-width":new ti(Ue.paint_line["line-width"]),"line-gap-width":new ti(Ue.paint_line["line-gap-width"]),"line-offset":new ti(Ue.paint_line["line-offset"]),"line-blur":new ti(Ue.paint_line["line-blur"]),"line-dasharray":new ti(Ue.paint_line["line-dasharray"]),"line-pattern":new ti(Ue.paint_line["line-pattern"]),"line-pattern-cross-fade":new kt(Ue.paint_line["line-pattern-cross-fade"]),"line-gradient":new Eh(Ue.paint_line["line-gradient"]),"line-trim-offset":new kt(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new kt(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new kt(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new kt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new ti(Ue.paint_line["line-border-width"]),"line-border-color":new ti(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new kt(Ue.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},mw);class Fz extends ti{possiblyEvaluate(e,i){return i=new Yn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,h){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,h)}}let Nv;function SA(r,e){return e>0?e+2*r:r}const Bz=hn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Nz=hn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Vz=hn([{name:"a_projected_pos",components:4,type:"Float32"}],4);hn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Uz=hn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),jz=hn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Gz=hn([{name:"a_texb",components:2,type:"Uint16"}]),qz=hn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Hz=hn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const AA=hn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$z=hn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hn([{name:"triangle",components:3,type:"Uint16"}]),hn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),hn([{type:"Float32",name:"offsetX"}]),hn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Fo=24;function Wz(r,e,i){return r.sections.forEach((a=>{a.text=(function(h,m,_){const v=m.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),la.applyArabicShaping&&(h=la.applyArabicShaping(h)),h})(a.text,e,i)})),r}const Vv={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Zz(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function Xz(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const gw=4294967296,IA=1/gw,CA=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let jx=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const a=this.readVarint(),h=a>>3,m=this.pos;this.type=7&a,r(h,e,this),this.pos===m&&this.skip(a)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*gw;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*gw;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,a;return a=e[this.pos++],i=127&a,a<128?i:(a=e[this.pos++],i|=(127&a)<<7,a<128?i:(a=e[this.pos++],i|=(127&a)<<14,a<128?i:(a=e[this.pos++],i|=(127&a)<<21,a<128?i:(a=e[this.pos],i|=(15&a)<<28,(function(h,m,_){const v=_.buf;let E,S;if(S=v[_.pos++],E=(112&S)>>4,S<128||(S=v[_.pos++],E|=(127&S)<<3,S<128)||(S=v[_.pos++],E|=(127&S)<<10,S<128)||(S=v[_.pos++],E|=(127&S)<<17,S<128)||(S=v[_.pos++],E|=(127&S)<<24,S<128)||(S=v[_.pos++],E|=(1&S)<<31,S<128))return ay(h,E,m);throw new Error("Expected varint not more than 10 bytes")})(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&CA?CA.decode(this.buf.subarray(e,r)):(function(i,a,h){let m="",_=a;for(;_<h;){const v=i[_];let E,S,M,D=null,O=v>239?4:v>223?3:v>191?2:1;if(_+O>h)break;O===1?v<128&&(D=v):O===2?(E=i[_+1],(192&E)==128&&(D=(31&v)<<6|63&E,D<=127&&(D=null))):O===3?(E=i[_+1],S=i[_+2],(192&E)==128&&(192&S)==128&&(D=(15&v)<<12|(63&E)<<6|63&S,(D<=2047||D>=55296&&D<=57343)&&(D=null))):O===4&&(E=i[_+1],S=i[_+2],M=i[_+3],(192&E)==128&&(192&S)==128&&(192&M)==128&&(D=(15&v)<<18|(63&E)<<12|(63&S)<<6|63&M,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,O=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),_+=O}return m})(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*IA),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*IA),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,i){let a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(a=~(-e%4294967296),h=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(m,_,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(a,0,i),(function(m,_){const v=(7&m)<<4;_.buf[_.pos++]|=v|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))})(h,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=(function(a,h,m){for(let _,v,E=0;E<h.length;E++){if(_=h.charCodeAt(E),_>55295&&_<57344){if(!v){_>56319||E+1===h.length?(a[m++]=239,a[m++]=191,a[m++]=189):v=_;continue}if(_<56320){a[m++]=239,a[m++]=191,a[m++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(a[m++]=239,a[m++]=191,a[m++]=189,v=null);_<128?a[m++]=_:(_<2048?a[m++]=_>>6|192:(_<65536?a[m++]=_>>12|224:(a[m++]=_>>18|240,a[m++]=_>>12&63|128),a[m++]=_>>6&63|128),a[m++]=63&_|128)}return m})(this.buf,r,this.pos);const i=this.pos-e;i>=128&&RA(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const a=this.pos-i;a>=128&&RA(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,Kz,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,Yz,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,ek,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,Qz,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,Jz,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,tk,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,ik,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,nk,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,rk,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function ay(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function RA(r,e,i){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(let h=i.pos-1;h>=r;h--)i.buf[h+a]=i.buf[h]}function Kz(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function Yz(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function Qz(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function Jz(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function ek(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function tk(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function ik(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function nk(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function rk(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}const _w=3;function sk(r,e,i){e.glyphs=[],r===1&&i.readMessage(ok,e)}function ok(r,e,i){if(r===3){const{id:a,bitmap:h,width:m,height:_,left:v,top:E,advance:S}=i.readMessage(ak,{});e.glyphs.push({id:a,bitmap:new cu({width:m+2*_w,height:_+2*_w},h),metrics:{width:m,height:_,left:v,top:E,advance:S}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function ak(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const MA=_w,tc={horizontal:1,vertical:2,horizontalOnly:3};class Uv{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new Uv;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Uv;return i.image=e,i}}class ly{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const h=new ly;for(let m=0;m<e.sections.length;m++){const _=e.sections[m];_.image?h.addImageSection(_,a):h.addTextSection(_,i)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,a){let h="";for(let m=0;m<i.length;m++){const _=i.charCodeAt(m+1)||null,v=i.charCodeAt(m-1)||null;h+=!a&&(_&&Os(_)&&!Vv[i[m+1]]||v&&Os(v)&&!Vv[i[m-1]])||!Vv[i[m]]?i[m]:Vv[i[m]]}return h})(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Gx[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Gx[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new ly;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Uv.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void gi("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(Uv.forImage(a)),this.sectionIndex.push(this.sections.length-1)):gi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function yw(r,e,i,a,h,m,_,v,E,S,M,D,O,N,V,$=1){const Z=ly.fromFeature(r,h,$);D===tc.vertical&&Z.verticalizePunctuation(O);let K=[];const ne=(function(Ie,Me,Le,at,Ge,ut){if(!Ie)return[];const gt=[],Et=(function(Mt,ot,et,It,Vt,bt){let li=0;for(let fi=0;fi<Mt.length();fi++){const ni=Mt.getSection(fi);li+=DA(Mt.getCodePoint(fi),ni,It,Vt,ot,bt)}return li/Math.max(1,Math.ceil(li/et))})(Ie,Me,Le,at,Ge,ut),jt=Ie.text.indexOf("")>=0;let Dt=0;for(let Mt=0;Mt<Ie.length();Mt++){const ot=Ie.getSection(Mt),et=Ie.getCodePoint(Mt);if(Gx[et]||(Dt+=DA(et,ot,at,Ge,Me,ut)),Mt<Ie.length()-1){const It=!((vt=et)<11904||!(Ai["Bopomofo Extended"](vt)||Ai.Bopomofo(vt)||Ai["CJK Compatibility Forms"](vt)||Ai["CJK Compatibility Ideographs"](vt)||Ai["CJK Compatibility"](vt)||Ai["CJK Radicals Supplement"](vt)||Ai["CJK Strokes"](vt)||Ai["CJK Symbols and Punctuation"](vt)||Ai["CJK Unified Ideographs Extension A"](vt)||Ai["CJK Unified Ideographs"](vt)||Ai["Enclosed CJK Letters and Months"](vt)||Ai["Halfwidth and Fullwidth Forms"](vt)||Ai.Hiragana(vt)||Ai["Ideographic Description Characters"](vt)||Ai["Kangxi Radicals"](vt)||Ai["Katakana Phonetic Extensions"](vt)||Ai.Katakana(vt)||Ai["Vertical Forms"](vt)||Ai["Yi Radicals"](vt)||Ai["Yi Syllables"](vt)));(lk[et]||It||ot.image)&&gt.push(OA(Mt+1,Dt,Et,gt,ck(et,Ie.getCodePoint(Mt+1),It&&jt),!1))}}var vt;return LA(OA(Ie.length(),Dt,Et,gt,0,!0))})(Z,S,m,e,a,N),{processBidirectionalText:ae,processStyledBidirectionalText:ue}=la;if(ae&&Z.sections.length===1){const Ie=ae(Z.toString(),ne);for(const Me of Ie){const Le=new ly;Le.text=Me,Le.sections=Z.sections;for(let at=0;at<Me.length;at++)Le.sectionIndex.push(0);K.push(Le)}}else if(ue){const Ie=ue(Z.text,Z.sectionIndex,ne);for(const Me of Ie){const Le=new ly;Le.text=Me[0],Le.sectionIndex=Me[1],Le.sections=Z.sections,K.push(Le)}}else K=(function(Ie,Me){const Le=[],at=Ie.text;let Ge=0;for(const ut of Me)Le.push(Ie.substring(Ge,ut)),Ge=ut;return Ge<at.length&&Le.push(Ie.substring(Ge,at.length)),Le})(Z,ne);const Te=[],_e={positionedLines:Te,text:Z.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ie,Me,Le,at,Ge,ut,gt,Et,jt,Dt,vt,Mt){let ot=0,et=0,It=0;const Vt=Et==="right"?1:Et==="left"?0:.5;let bt=!1;for(const ii of Ge){const Ri=ii.getSections();for(const qi of Ri){if(qi.image)continue;const un=Me[qi.fontStack];if(un&&(bt=un.ascender!==void 0&&un.descender!==void 0,!bt))break}if(!bt)break}let li=0;for(const ii of Ge){ii.trim();const Ri=ii.getMaxScale(),qi=(Ri-1)*Fo,un={positionedGlyphs:[],lineOffset:0};Ie.positionedLines[li]=un;const Nn=un.positionedGlyphs;let Zi=0;if(!ii.length()){et+=ut,++li;continue}let $n=0,Wn=0;for(let ye=0;ye<ii.length();ye++){const pe=ii.getSection(ye),ft=ii.getSectionIndex(ye),Wt=ii.getCodePoint(ye);let pt=pe.scale,Qt=null,bi=null,vi=null,Yi=Fo,zi=0,mi=jt;mi===tc.vertical&&((fi=Wt)===12312||fi===12313||fi===12316||fi===12540||fi===12448)&&(mi=tc.horizontal);const Gn=!(mi===tc.horizontal||!vt&&!kp(Wt)||vt&&(Gx[Wt]||Df(Wt)));if(pe.image){const _r=at.get(pe.image.toString());if(!_r)continue;vi=pe.image,Ie.iconsInText=Ie.iconsInText||!0,bi=_r.paddedRect;const Bi=_r.displaySize;pt=pt*Fo/Mt,Qt={width:Bi[0],height:Bi[1],left:0,top:-MA,advance:Gn?Bi[1]:Bi[0],localGlyph:!1},zi=bt?-Qt.height*pt:Ri*Fo-17-Bi[1]*pt,Yi=Qt.advance;const Ln=(Gn?Bi[0]:Bi[1])*pt-Fo*Ri;Ln>0&&Ln>Zi&&(Zi=Ln)}else{const _r=Le[pe.fontStack];if(!_r)continue;_r[Wt]&&(bi=_r[Wt]);const Bi=Me[pe.fontStack];if(!Bi)continue;const Ln=Bi.glyphs[Wt];if(!Ln)continue;if(Qt=Ln.metrics,Yi=Wt!==8203?Fo:0,bt){const yr=Bi.ascender!==void 0?Math.abs(Bi.ascender):0,sr=Bi.descender!==void 0?Math.abs(Bi.descender):0,cs=(yr+sr)*pt;$n<cs&&($n=cs,Wn=(yr-sr)/2*pt),zi=-yr*pt}else zi=(Ri-pt)*Fo-17}Gn?(Ie.verticalizable=!0,Nn.push({glyph:Wt,image:vi,x:ot,y:et+zi,vertical:Gn,scale:pt,localGlyph:Qt.localGlyph,fontStack:pe.fontStack,sectionIndex:ft,metrics:Qt,rect:bi}),ot+=Yi*pt+Dt):(Nn.push({glyph:Wt,image:vi,x:ot,y:et+zi,vertical:Gn,scale:pt,localGlyph:Qt.localGlyph,fontStack:pe.fontStack,sectionIndex:ft,metrics:Qt,rect:bi}),ot+=Qt.advance*pt+Dt)}Nn.length!==0&&(It=Math.max(ot-Dt,It),bt?zA(Nn,Vt,Zi,Wn,ut*Ri/2):zA(Nn,Vt,Zi,0,ut/2)),ot=0;const es=ut*Ri+Zi;un.lineOffset=Math.max(Zi,qi),et+=es,++li}var fi;const ni=et,{horizontalAlign:Kt,verticalAlign:ji}=vw(gt);(function(ii,Ri,qi,un,Nn,Zi){const $n=(Ri-qi)*Nn,Wn=-Zi*un;for(const es of ii)for(const ye of es.positionedGlyphs)ye.x+=$n,ye.y+=Wn})(Ie.positionedLines,Vt,Kt,ji,It,ni),Ie.top+=-ji*ni,Ie.bottom=Ie.top+ni,Ie.left+=-Kt*It,Ie.right=Ie.left+It,Ie.hasBaseline=bt})(_e,e,i,a,K,_,v,E,D,S,O,V),!(function(Ie){for(const Me of Ie)if(Me.positionedGlyphs.length!==0)return!1;return!0})(Te))return _e}const Gx={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lk={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function DA(r,e,i,a,h,m){if(e.image){const _=a.get(e.image.toString());return _?_.displaySize[0]*e.scale*Fo/m+h:0}{const _=i[e.fontStack],v=_&&_.glyphs[r];return v?v.metrics.advance*e.scale+h:0}}function PA(r,e,i,a){const h=Math.pow(r-e,2);return a?r<e?h/2:2*h:h+Math.abs(i)*i}function ck(r,e,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function OA(r,e,i,a,h,m){let _=null,v=PA(e,i,h,m);for(const E of a){const S=PA(e-E.x,i,h,m)+E.badness;S<=v&&(_=E,v=S)}return{index:r,x:e,priorBreak:_,badness:v}}function LA(r){return r?LA(r.priorBreak).concat(r.index):[]}function vw(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function zA(r,e,i,a,h){if(!(e||i||a||h))return;const m=r.length-1,_=r[m],v=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=m;E++)r[E].x-=v,r[E].y+=i+a+h}function kA(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function qx(r,e,i,a){const{horizontalAlign:h,verticalAlign:m}=vw(a),_=i[0]-r.displaySize[0]*h,v=i[1]-r.displaySize[1]*m;return{imagePrimary:r,imageSecondary:e,top:v,bottom:v+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function xw(r,e,i,a,h,m){const _=r.imagePrimary;let v;if(_.content){const Z=_.content,K=_.pixelRatio||1;v=[Z[0]/K,Z[1]/K,_.displaySize[0]-Z[2]/K,_.displaySize[1]-Z[3]/K]}const E=e.left*m,S=e.right*m;let M,D,O,N;i==="width"||i==="both"?(N=h[0]+E-a[3],D=h[0]+S+a[1]):(N=h[0]+(E+S-_.displaySize[0])/2,D=N+_.displaySize[0]);const V=e.top*m,$=e.bottom*m;return i==="height"||i==="both"?(M=h[1]+V-a[0],O=h[1]+$+a[2]):(M=h[1]+(V+$-_.displaySize[1])/2,O=M+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:M,right:D,bottom:O,left:N,collisionPadding:v}}function FA(r){return!r.imagePrimary.stretchX}function BA(r){return!r.imagePrimary.stretchY}function NA(r){return{width:r.right-r.left,height:r.bottom-r.top}}const Xh=128;function cy(r,e,i){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Yn(r+1,{worldview:i}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:m}=a;let _=0;for(;_<h.length&&h[_]<=r;)_++;_=Math.max(0,_-1);let v=_;for(;v<h.length&&h[v]<r+1;)v++;v=Math.min(h.length-1,v);const E=h[_],S=h[v];return a.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:S,interpolationType:m}:{kind:"camera",minZoom:E,maxZoom:S,minSize:a.evaluate(new Yn(E,{worldview:i})),maxSize:a.evaluate(new Yn(S,{worldview:i})),interpolationType:m}}}function bw(r,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:h}){return r.kind==="source"?a/Xh:r.kind==="composite"?Oi(a/Xh,h/Xh,i):e}function uy(r,e,i=1){let a=0,h=0;if(r.kind==="constant")h=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:m,minZoom:_,maxZoom:v}=r,E=m?J(Yr.interpolationFactor(m,e,_,v),0,1):0;r.kind==="camera"?h=Oi(r.minSize,r.maxSize,E)*i:a=E*i}return{uSizeT:a,uSize:h}}class Jf extends St{constructor(e,i,a,h,m){super(e,i),this.angle=h,this.z=a,m!==void 0&&(this.segment=m)}clone(){return new Jf(this.x,this.y,this.z,this.angle,this.segment)}}function VA(r,e,i,a,h){if(e.segment===void 0)return!0;let m=e,_=e.segment+1,v=0;for(;v>-i/2;){if(_--,_<0)return!1;v-=r[_].dist(m),m=r[_]}v+=r[_].dist(r[_+1]),_++;const E=[];let S=0;for(;v<i/2;){const M=r[_],D=r[_+1];if(!D)return!1;let O=r[_-1].angleTo(M)-M.angleTo(D);for(O=Math.abs((O+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:v,angleDelta:O}),S+=O;v-E[0].distance>a;)S-=E.shift().angleDelta;if(S>h)return!1;_++,v+=M.dist(D)}return!0}function UA(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function jA(r,e,i){return r?.6*e*i:0}function GA(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function uk(r,e,i,a,h,m){const _=jA(i,h,m),v=GA(i,a)*m;let E=0;const S=UA(r)/2;for(let M=0;M<r.length-1;M++){const D=r[M],O=r[M+1],N=D.dist(O);if(E+N>S){const V=(S-E)/N,$=Oi(D.x,O.x,V),Z=Oi(D.y,O.y,V),K=new Jf($,Z,0,O.angleTo(D),M);return!_||VA(r,K,v,_,e)?K:void 0}E+=N}}function hk(r,e,i,a,h,m,_,v,E){const S=jA(a,m,_),M=GA(a,h),D=M*_,O=r[0].x===0||r[0].x===E||r[0].y===0||r[0].y===E;return e-D<e/4&&(e=D+e/4),qA(r,O?e/2*v%e:(M/2+2*m)*_*v%e,e,S,i,D,O,!1,E)}function qA(r,e,i,a,h,m,_,v,E){const S=m/2,M=UA(r);let D=0,O=e-i,N=[];for(let V=0;V<r.length-1;V++){const $=r[V],Z=r[V+1],K=$.dist(Z),ne=Z.angleTo($);for(;O+i<D+K;){O+=i;const ae=(O-D)/K,ue=Oi($.x,Z.x,ae),Te=Oi($.y,Z.y,ae);if(ue>=0&&ue<E&&Te>=0&&Te<E&&O-S>=0&&O+S<=M){const _e=new Jf(ue,Te,0,ne,V);a&&!VA(r,_e,m,a,h)||N.push(_e)}}D+=K}return v||N.length||_||(N=qA(r,D/2,i,a,h,m,_,!0,E)),N}function HA(r){let e=0,i=0;for(const _ of r)e+=_.w*_.h,i=Math.max(i,_.w);r.sort(((_,v)=>v.h-_.h));const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,m=0;for(const _ of r)for(let v=a.length-1;v>=0;v--){const E=a[v];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===E.w&&_.h===E.h){const S=a.pop();S&&v<a.length&&(a[v]=S)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(a.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}Lt(Jf,"Anchor");const Kg=1;class jv{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:a,y:a}}constructor(e,i,a,h){this.paddedRect=e;const{pixelRatio:m,version:_,stretchX:v,stretchY:E,content:S,sdf:M,usvg:D}=i;this.pixelRatio=m,this.stretchX=v,this.stretchY=E,this.content=S,this.version=_,this.padding=a,this.sdf=M,this.usvg=D,this.scale=jv.getImagePositionScale(h,D,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function ww(r,e,i){const a=Oa.parse(r),h=(function(m,_,v=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*v[0])+2*_,h:(m.data?m.data.height:m.height*v[1])+2*_}})(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:h,imagePosition:new jv(h,e,i,a),imageVariant:a}}class $A{constructor(e,i,a){const h=new Map,m=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,h,Kg,_),this.addImages(i,m,2,_);const{w:v,h:E}=HA(_),S=new yo({width:v||1,height:E||1});for(const[M,D]of e.entries()){const O=h.get(M).paddedRect;yo.copy(D.data,S,{x:0,y:0},{x:O.x+Kg,y:O.y+Kg},D.data,null,D.sdf)}for(const[M,D]of i.entries()){const O=m.get(M),N=O.paddedRect;let V=O.padding;const $=N.x+V,Z=N.y+V,K=D.data.width,ne=D.data.height;V=V>1?V-1:V,yo.copy(D.data,S,{x:0,y:0},{x:$,y:Z},D.data,a),yo.copy(D.data,S,{x:0,y:ne-V},{x:$,y:Z-V},{width:K,height:V},a),yo.copy(D.data,S,{x:0,y:0},{x:$,y:Z+ne},{width:K,height:V},a),yo.copy(D.data,S,{x:K-V,y:0},{x:$-V,y:Z},{width:V,height:ne},a),yo.copy(D.data,S,{x:0,y:0},{x:$+K,y:Z},{width:V,height:ne},a),yo.copy(D.data,S,{x:K-V,y:ne-V},{x:$-V,y:Z-V},{width:V,height:V},a),yo.copy(D.data,S,{x:0,y:ne-V},{x:$+K,y:Z-V},{width:V,height:V},a),yo.copy(D.data,S,{x:0,y:0},{x:$+K,y:Z+ne},{width:V,height:V},a),yo.copy(D.data,S,{x:K-V,y:0},{x:$-V,y:Z+ne},{width:V,height:V},a)}this.lut=a,this.image=S,this.iconPositions=h,this.patternPositions=m}addImages(e,i,a,h){for(const[m,_]of e.entries()){const{bin:v,imagePosition:E,imageVariant:S}=ww(m,_,a);i.set(m,E),h.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>e.hasImage(h,a))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const h of e.getUpdatedImages(a)){for(const m of this.iconPositions.keys()){const _=Oa.parse(m);if(Ss.isEqual(_.id,h)){const v=e.getImage(h,a);this.patchUpdatedImage(this.iconPositions.get(m),v,i,null)}}for(const m of this.patternPositions.keys()){const _=Oa.parse(m);if(Ss.isEqual(_.id,h)){const v=e.getImage(h,a);this.patchUpdatedImage(this.patternPositions.get(m),v,i,this.lut)}}}}patchUpdatedImage(e,i,a,h=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[m,_]=e.tl,v=e.sdf;if(this.lut||v){const E={width:i.data.width,height:i.data.height},S=new yo(E);yo.copy(i.data,S,{x:0,y:0},{x:0,y:0},E,h,v),a.update(S,{position:{x:m,y:_}})}else a.update(i.data,{position:{x:m,y:_}})}}Lt(jv,"ImagePosition"),Lt($A,"ImageAtlas");const Gv=1e20;function WA(r,e,i,a,h,m,_,v,E){for(let S=e;S<e+a;S++)ZA(r,i*m+S,m,h,_,v,E);for(let S=i;S<i+h;S++)ZA(r,S*m+e,1,a,_,v,E)}function ZA(r,e,i,a,h,m,_){m[0]=0,_[0]=-Gv,_[1]=Gv,h[0]=r[e];for(let v=1,E=0,S=0;v<a;v++){h[v]=r[e+v*i];const M=v*v;do{const D=m[E];S=(h[v]-h[D]+M-D*D)/(v-D)/2}while(S<=_[E]&&--E>-1);E++,m[E]=v,_[E]=S,_[E+1]=Gv}for(let v=0,E=0;v<a;v++){for(;_[E+1]<v;)E++;const S=m[E],M=v-S;r[e+v*i]=h[S]+M*M}}const Kh=2,Tw={none:0,ideographs:1,all:2};class hy{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[],h=this.url||or.GLYPHS_URL;for(const m in e)for(const _ of e[m])a.push({stack:m,id:_});Ce(a,(({stack:m,id:_},v)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=E.glyphs[_];if(S!==void 0)return void v(null,{stack:m,id:_,glyph:S});if(S=this._tinySDF(E,m,_),S)return E.glyphs[_]=S,void v(null,{stack:m,id:_,glyph:S});const M=Math.floor(_/256);if(256*M>65535)return gi("glyphs > 65535 not supported"),void v(null,{stack:m,id:_,glyph:S});if(E.ranges[M])return void v(null,{stack:m,id:_,glyph:S});let D=E.requests[M];D||(D=E.requests[M]=[],hy.loadGlyphRange(m,M,h,this.requestManager,((O,N)=>{if(N){E.ascender=N.ascender,E.descender=N.descender;for(const V in N.glyphs)this._doesCharSupportLocalGlyph(+V)||(E.glyphs[+V]=N.glyphs[+V]);E.ranges[M]=!0}for(const V of D)V(O,N);delete E.requests[M]}))),D.push(((O,N)=>{O?v(O):N&&v(null,{stack:m,id:_,glyph:N.glyphs[_]||null})}))}),((m,_)=>{if(m)i(m);else if(_){const v={};for(const{stack:E,id:S,glyph:M}of _)v[E]===void 0&&(v[E]={}),v[E].glyphs===void 0&&(v[E].glyphs={}),v[E].glyphs[S]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},v[E].ascender=this.entries[E].ascender,v[E].descender=this.entries[E].descender;i(null,v)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Tw.none&&(this.localGlyphMode===Tw.all?!!this.localFontFamily:!!this.localFontFamily&&(Ai["CJK Unified Ideographs"](e)||Ai["Hangul Syllables"](e)||Ai.Hiragana(e)||Ai.Katakana(e)||Ai["CJK Symbols and Punctuation"](e)||Ai["CJK Unified Ideographs Extension A"](e)||Ai["CJK Unified Ideographs Extension B"](e)||Ai.Osage(e)))}_tinySDF(e,i,a){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let m=e.tinySDF;if(!m){let $="400";/bold/i.test(i)?$="900":/medium/i.test(i)?$="500":/light/i.test(i)&&($="200"),m=e.tinySDF=new hy.TinySDF({fontFamily:h,fontWeight:$,fontSize:24*Kh,buffer:3*Kh,radius:8*Kh}),m.fontWeight=$}if(this.localGlyphs[m.fontWeight][a])return this.localGlyphs[m.fontWeight][a];const _=String.fromCodePoint(a),{data:v,width:E,height:S,glyphWidth:M,glyphHeight:D,glyphLeft:O,glyphTop:N,glyphAdvance:V}=m.draw(_);return this.localGlyphs[m.fontWeight][a]={id:a,bitmap:new cu({width:E,height:S},v),metrics:{width:M/Kh,height:D/Kh,left:O/Kh,top:N/Kh-27,advance:V/Kh,localGlyph:!0}}}}hy.loadGlyphRange=function(r,e,i,a,h){const m=256*e,_=m+255,v=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${m}-${_}`),Ho.Glyphs);va(v,((E,S)=>{if(E)h(E);else if(S){const M={},D=(function(O){return new jx(O).readFields(sk,{})})(S);for(const O of D.glyphs)M[O.id]=O;h(null,{glyphs:M,ascender:D.ascender,descender:D.descender})}}))},hy.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=e,this.cutoff=a,this.radius=i,this.lang=v;const E=this.size=r+4*e,S=this._createCanvas(E),M=this.ctx=S.getContext("2d",{willReadFrequently:!0});M.font=`${_} ${m} ${r}px ${h}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(r),_=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),E=Math.min(this.size-this.buffer,_+Math.ceil(a)),S=v+2*this.buffer,M=E+2*this.buffer,D=Math.max(S*M,0),O=new Uint8ClampedArray(D),N={data:O,width:S,height:M,glyphWidth:v,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(v===0||E===0)return N;const{ctx:V,buffer:$,gridInner:Z,gridOuter:K}=this;this.lang&&(V.lang=this.lang),V.clearRect($,$,v,E),V.fillText(r,$,$+_);const ne=V.getImageData($,$,v,E);K.fill(Gv,0,D),Z.fill(0,0,D);for(let ae=0;ae<E;ae++)for(let ue=0;ue<v;ue++){const Te=ne.data[4*(ae*v+ue)+3]/255;if(Te===0)continue;const _e=(ae+$)*S+ue+$;if(Te===1)K[_e]=0,Z[_e]=Gv;else{const Ie=.5-Te;K[_e]=Ie>0?Ie*Ie:0,Z[_e]=Ie<0?Ie*Ie:0}}WA(K,0,0,S,M,S,this.f,this.v,this.z),WA(Z,$,$,v,E,S,this.f,this.v,this.z);for(let ae=0;ae<D;ae++){const ue=Math.sqrt(K[ae])-Math.sqrt(Z[ae]);O[ae]=Math.round(255-255*(ue/this.radius+this.cutoff))}return N}};const $d=Kg;function XA(r,e){return r+e[1]-e[0]}function Ew(r,e,i,a,h=1){const m=[],_=r.imagePrimary,v=_.pixelRatio,E=_.paddedRect.w-2*$d,S=_.paddedRect.h-2*$d,M=(r.right-r.left)*h,D=(r.bottom-r.top)*h,O=_.stretchX||[[0,E]],N=_.stretchY||[[0,S]],V=O.reduce(XA,0),$=N.reduce(XA,0),Z=E-V,K=S-$;let ne=0,ae=V,ue=0,Te=$,_e=0,Ie=Z,Me=0,Le=K;if(_.content&&a){const Ge=_.content;ne=Hx(O,0,Ge[0]),ue=Hx(N,0,Ge[1]),ae=Hx(O,Ge[0],Ge[2]),Te=Hx(N,Ge[1],Ge[3]),_e=Ge[0]-ne,Me=Ge[1]-ue,Ie=Ge[2]-Ge[0]-ae,Le=Ge[3]-Ge[1]-Te}const at=(Ge,ut,gt,Et)=>{const jt=$x(Ge.stretch-ne,ae,M,r.left*h),Dt=Wx(Ge.fixed-_e,Ie,Ge.stretch,V),vt=$x(ut.stretch-ue,Te,D,r.top*h),Mt=Wx(ut.fixed-Me,Le,ut.stretch,$),ot=$x(gt.stretch-ne,ae,M,r.left*h),et=Wx(gt.fixed-_e,Ie,gt.stretch,V),It=$x(Et.stretch-ue,Te,D,r.top*h),Vt=Wx(Et.fixed-Me,Le,Et.stretch,$),bt=new St(jt,vt),li=new St(ot,vt),fi=new St(ot,It),ni=new St(jt,It),Kt=new St(Dt/v,Mt/v),ji=new St(et/v,Vt/v),ii=e*Math.PI/180;if(ii){const $n=Math.sin(ii),Wn=Math.cos(ii),es=[Wn,-$n,$n,Wn];bt._matMult(es),li._matMult(es),ni._matMult(es),fi._matMult(es)}const Ri=Ge.stretch+Ge.fixed,qi=gt.stretch+gt.fixed,un=ut.stretch+ut.fixed,Nn=Et.stretch+Et.fixed,Zi=r.imageSecondary;return{tl:bt,tr:li,bl:ni,br:fi,texPrimary:{x:_.paddedRect.x+$d+Ri,y:_.paddedRect.y+$d+un,w:qi-Ri,h:Nn-un},texSecondary:Zi?{x:Zi.paddedRect.x+$d+Ri,y:Zi.paddedRect.y+$d+un,w:qi-Ri,h:Nn-un}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Kt,pixelOffsetBR:ji,minFontScaleX:Ie/v/M,minFontScaleY:Le/v/D,isSDF:i}};if(a&&(_.stretchX||_.stretchY)){const Ge=KA(O,Z,V),ut=KA(N,K,$);for(let gt=0;gt<Ge.length-1;gt++){const Et=Ge[gt],jt=Ge[gt+1];for(let Dt=0;Dt<ut.length-1;Dt++)m.push(at(Et,ut[Dt],jt,ut[Dt+1]))}}else m.push(at({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:S+1}));return m}function dk(r,e){const i=r.stretchY||[[0,r.paddedRect.h-2*$d]];return e&&(r.stretchX||r.stretchY)?YA(r.stretchX||[[0,r.paddedRect.w-2*$d]])*YA(i):1}function Hx(r,e,i){let a=0;for(const h of r)a+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return a}function KA(r,e,i){const a=[{fixed:-$d,stretch:0}];for(const[h,m]of r){const _=a[a.length-1];a.push({fixed:h-_.stretch,stretch:_.stretch}),a.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return a.push({fixed:e+$d,stretch:i}),a}function YA(r){return 2*r.length+1}function $x(r,e,i,a){return r/e*i+a}function Wx(r,e,i,a){return r-e*i/a}function fk(r,e,i,a){const h=e+r.positionedLines[a].lineOffset;return a===0?i+h/2:i+(h+(e+r.positionedLines[a-1].lineOffset))/2}function pk(r,e=1,i=!1){let a=1/0,h=1/0,m=-1/0,_=-1/0;const v=r[0];for(let N=0;N<v.length;N++){const V=v[N];(!N||V.x<a)&&(a=V.x),(!N||V.y<h)&&(h=V.y),(!N||V.x>m)&&(m=V.x),(!N||V.y>_)&&(_=V.y)}const E=Math.min(m-a,_-h);let S=E/2;const M=new dh([],mk);if(E===0)return new St(a,h);for(let N=a;N<m;N+=E)for(let V=h;V<_;V+=E)M.push(new dy(N+S,V+S,S,r));let D=(function(N){let V=0,$=0,Z=0;const K=N[0];for(let ne=0,ae=K.length,ue=ae-1;ne<ae;ue=ne++){const Te=K[ne],_e=K[ue],Ie=Te.x*_e.y-_e.x*Te.y;$+=(Te.x+_e.x)*Ie,Z+=(Te.y+_e.y)*Ie,V+=3*Ie}return new dy($/V,Z/V,0,N)})(r),O=M.length;for(;M.length;){const N=M.pop();(N.d>D.d||!D.d)&&(D=N,i&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,O)),N.max-D.d<=e||(S=N.h/2,M.push(new dy(N.p.x-S,N.p.y-S,S,r)),M.push(new dy(N.p.x+S,N.p.y-S,S,r)),M.push(new dy(N.p.x-S,N.p.y+S,S,r)),M.push(new dy(N.p.x+S,N.p.y+S,S,r)),O+=4)}return i&&(console.log(`num probes: ${O}`),console.log(`best distance: ${D.d}`)),D.p}function mk(r,e){return e.max-r.max}class dy{constructor(e,i,a,h){this.p=new St(e,i),this.h=a,this.d=(function(m,_){let v=!1,E=1/0;for(let S=0;S<_.length;S++){const M=_[S];for(let D=0,O=M.length,N=O-1;D<O;N=D++){const V=M[D],$=M[N];V.y>m.y!=$.y>m.y&&m.x<($.x-V.x)*(m.y-V.y)/($.y-V.y)+V.x&&(v=!v),E=Math.min(E,Ua(m,V,$))}}return(v?1:-1)*Math.sqrt(E)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const gk=Object.keys,Sw=Number.POSITIVE_INFINITY,_k=Math.sqrt(2);function Zx(r,e,i,a){const h=r.collisionPadding||[0,0,0,0],m={top:r.top-h[1],bottom:r.bottom+h[3],left:r.left-h[0],right:r.right+h[2],scaled:!1};return a!==void 0&&(function(_,v){_.top*=v,_.bottom*=v,_.left*=v,_.right*=v,_.scaled=!0})(m,a),i&&(function(_,v){if(!v)return;const E=gn(v),S=new St(_.left,_.top),M=new St(_.right,_.top),D=new St(_.left,_.bottom),O=new St(_.right,_.bottom);S._rotateAround(E,new St(0,0)),M._rotateAround(E,new St(0,0)),D._rotateAround(E,new St(0,0)),O._rotateAround(E,new St(0,0)),_.left=Math.min(S.x,M.x,D.x,O.x),_.right=Math.max(S.x,M.x,D.x,O.x),_.top=Math.min(S.y,M.y,D.y,O.y),_.bottom=Math.max(S.y,M.y,D.y,O.y)})(m,i),e?{top:Math.min(e.top,m.top),bottom:Math.max(e.bottom,m.bottom),left:Math.min(e.left,m.left),right:Math.max(e.right,m.right),scaled:e.scaled||m.scaled}:m}function QA(r,[e,i]){let a=0,h=0;if(i===Sw){e<0&&(e=0);const m=e/_k;switch(r){case"top-right":case"top-left":h=m-7;break;case"bottom-right":case"bottom-left":h=7-m;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(r){case"top-right":case"bottom-right":a=-m;break;case"top-left":case"bottom-left":a=m;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(r){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,h]}function yk(r,e,i,a,h,m,_,v,E,S,M){const D=r.layers[0],O=D.appearances;if(O.length===0)return{iconBBox:null,iconVerticalBBox:null};let N=null,V=null;const $=a.get("icon-rotate").evaluate(h,{},m);e&&(N=Zx(e,N,$,_),i)&&(V=Zx(i,V,$+90,_));const[Z,K]=a.get("icon-size-scale-range"),ne=J(1,Z,K);for(const ae of O){const ue=ae.getUnevaluatedProperties(),Te=ue._values["icon-image"].value!==void 0,_e=ue._values["icon-size"].value!==void 0,Ie=ue._values["icon-offset"].value!==void 0,Me=ue._values["icon-rotate"].value!==void 0;if(Te||_e||Ie||Me){const Le=Ie?D.getAppearanceValueAndResolveTokens(ae,"icon-offset",h,m,[]):null,at=Le&&Array.isArray(Le)?Le:v,Ge=Me?D.getAppearanceValueAndResolveTokens(ae,"icon-rotate",h,m,[]):null,ut=typeof Ge=="number"?Ge:$,gt=_e?D.getAppearanceValueAndResolveTokens(ae,"icon-size",h,m,[]):null,Et=typeof gt=="number"?gt*E.iconScaleFactor:_;let jt=null,Dt=null,vt=null;if(Te){const Mt=D.getAppearanceValueAndResolveTokens(ae,"icon-image",h,m,[]);if(Mt){const ot=r.getResolvedImageFromTokens(Mt),et=ue._values["icon-size"],It=qv(ot,cy(r.zoom,et,r.worldview),et,m,r.zoom,h,r.pixelRatio,ne,r.worldview);vt=S.get(It.iconPrimary.toString())}}else e&&(vt=e.imagePrimary);vt&&(jt=qx(vt,null,at,M),r.allowVerticalPlacement&&(Dt=qx(vt,null,at,M))),jt&&(N=Zx(jt,N,ut,Et)),Dt&&(V=Zx(Dt,V,ut+90,Et))}}return{iconBBox:N,iconVerticalBBox:V}}function Xx(r,e,i,a,h,m,_,v,E){if(!e||!e.usvg)return;const S=NA(a),M=NA(h),D=m!=="both"&&m!=="width"||!FA(a)?1:M.width/S.width,O=m!=="both"&&m!=="height"||!BA(a)?1:M.height/S.height;i.scaleSelf(D,O);const N=i.toString();_.set(N,i),v.set(N,e);const{imagePosition:V}=ww(N,e,Kg);E.set(N,V)}function JA(r,e,i,a,h,m,_,v,E){if(!r)return;const S=(function(M,D,O,N,V,$){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const Z=D.possiblyEvaluate(new Yn(M.maxZoom,{worldview:$}),O).evaluate(V,{},O),K=D.possiblyEvaluate(new Yn(M.minZoom,{worldview:$}),O).evaluate(V,{},O);return Math.max(Z,K)}return D.possiblyEvaluate(new Yn(N,{worldview:$})).evaluate(V,{},O)})(e,i,a,h,m,E);return r.scaleSelf(S*v*_)}function qv(r,e,i,a,h,m,_,v,E){return{iconPrimary:JA(r.getPrimary(),e,i,a,h,m,_,v,E),iconSecondary:JA(r.getSecondary(),e,i,a,h,m,_,v,E)}}function vk(r,e,i){if(!e)return;const a=i.get(r.toString()),h=i.get(e.toString());a&&h&&(a.paddedRect.w===h.paddedRect.w&&a.paddedRect.h===h.paddedRect.h||gi(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),a.usvg!==h.usvg&&gi(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function eI(r,e,i,a){if(!r)return;const h=e.get(i.toString());if(r.imagePrimary=h,a){const m=e.get(a.toString());r.imageSecondary=m}}function xk(r,e){for(const i in r.horizontal)tI(r.horizontal[i],e);tI(r.vertical,e)}function tI(r,e){if(r){for(const i of r.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const h=a.image.toString();a.rect=e.get(h).paddedRect}}}function Aw(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bk(r,e,i,a,h,m,_,v,E){const S=Iw(m.horizontal)||m.vertical,M=i.get("icon-text-fit-padding").evaluate(a,{},h);let D,O=e;return e&&E!=="none"&&(r.allowVerticalPlacement&&m.vertical&&(D=xw(e,m.vertical,E,M,v,_)),S&&(O=xw(e,S,E,M,v,_))),{defaultShapedIcon:O,verticallyShapedIcon:D}}function wk(r,e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne,ae,ue,Te){let _e=_.textMaxSize.evaluate(e,{},O);_e===void 0?_e=v*_.textScaleFactor:_e*=_.textScaleFactor;const Ie=r.layers[0].layout,Me=Fo,Le=v*_.textScaleFactor/Me,at=Iw(i.horizontal)||i.vertical;if(Z!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){const bt=r.appearanceFeatureData[e.index];bt&&(bt.textShaping=at,bt.iconTextFitPadding=Ie.get("icon-text-fit-padding").evaluate(e,{},O),bt.fontScale=Le)}const Ge=N.name==="globe",ut=r.tilePixelRatio*_e/Me,gt=(ot=r.overscaling,r.zoom>18&&ot>2&&(ot>>=1),Math.max(Nt/(512*ot),1)*Ie.get("symbol-spacing")),Et=Ie.get("text-padding")*r.tilePixelRatio,jt=Ie.get("icon-padding")*r.tilePixelRatio,Dt=gn(Ie.get("text-max-angle")),vt=Ie.get("icon-rotation-alignment")==="map"&&ae!=="point",Mt=gt/2;var ot;r.hasAnyIconTextFit===!1&&Z!=="none"&&(r.hasAnyIconTextFit=!0);const et=e.properties?+e.properties[Xt]:null,It=et&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(et):65535,Vt=(bt,li,fi)=>{if(li.x<0||li.x>=Nt||li.y<0||li.y>=Nt)return;let ni=null;if(Ge){const{x:Kt,y:ji,z:ii}=N.projectTilePoint(li.x,li.y,fi);ni={anchor:new Jf(Kt,ji,ii,0,void 0),up:N.upVector(fi,li.x,li.y)}}(function(Kt,ji,ii,Ri,qi,un,Nn,Zi,$n,Wn,es,ye,pe,ft,Wt,pt,Qt,bi,vi,Yi,zi,mi,Gn,_r,Bi,Ln,yr,sr,cs,Vr,Sr){const cr=Kt.addToLineVertexArray(ji,Ri);let Zn,Qi,Xn,Ar,ki,Vn,Ur,xs=0,Cs=0,Zs=0,jr=0,Ns=-1,Il=-1;const Vs={};let ic=cc("");const ua=ii?ii.anchor:ji,du=sr!=="none";let Cl=0,nc=0;if($n._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Bo=$n.layout.get("text-offset").evaluate(zi,{},Bi);Cl=Bo[0]*Fo,nc=Bo[1]*Fo}else Cl=$n.layout.get("text-radial-offset").evaluate(zi,{},Bi)*Fo,nc=Sw;if(Kt.allowVerticalPlacement&&qi.vertical){const Bo=qi.vertical;if(Wt)Vn=Cw(Bo),Zi&&(Ur=Cw(Zi));else{const qa=$n.layout.get("text-rotate").evaluate(zi,{},Bi)+90;Xn=Kx(Wn,ua,ji,es,ye,pe,Bo,ft,qa,pt),Zi&&(Ar=Kx(Wn,ua,ji,es,ye,pe,Zi,bi,qa,null,Sr))}}if(un){const Bo=Kt.iconSizeData,qa=$n.layout.get("icon-rotate").evaluate(zi,{},Bi),Wd=Ew(un,qa,Gn,du,mi.iconScaleFactor),Am=Zi?Ew(Zi,qa,Gn,du,mi.iconScaleFactor):void 0;Qi=Kx(Wn,ua,ji,es,ye,pe,un,bi,qa,null,Vr);const vy=(function(Zd,fb,xy,z3,x2,b2,k3,F3){const w2=Zd.layers[0],T2=w2.appearances;let by=fb.length;if(xy&&(by=Math.max(by,xy.length)),T2.length===0)return by;const[B3,N3]=z3.get("icon-size-scale-range"),V3=J(1,B3,N3);for(const E2 of T2){const S2=E2.getUnevaluatedProperties();if(S2._values["icon-image"].value!==void 0){const A2=w2.getAppearanceValueAndResolveTokens(E2,"icon-image",x2,b2,[]);if(A2){const I2=Zd.getResolvedImageFromTokens(A2);if(I2){const C2=S2._values["icon-size"],U3=qv(I2,cy(Zd.zoom,C2,Zd.worldview),C2,b2,Zd.zoom,x2,Zd.pixelRatio,V3,Zd.worldview),j3=k3.get(U3.iconPrimary.toString());by=Math.max(by,dk(j3,F3))}}}}return by})(Kt,Wd,Am,$n.layout,zi,Bi,Kt.iconAtlasPositions,du);xs=4*vy;let Im=null;Bo.kind==="source"?(Im=[Xh*$n.layout.get("icon-size").evaluate(zi,{},Bi)*mi.iconScaleFactor],Im[0]>ep&&gi(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Hv}. Reduce your "icon-size".`)):Bo.kind==="composite"&&(Im=[Xh*mi.compositeIconSizes[0].evaluate(zi,{},Bi)*mi.iconScaleFactor,Xh*mi.compositeIconSizes[1].evaluate(zi,{},Bi)*mi.iconScaleFactor],(Im[0]>ep||Im[1]>ep)&&gi(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${Hv}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,Wd,Im,Yi,vi,zi,void 0,ii,ji,cr.lineStartIndex,cr.lineLength,-1,_r,Bi,Ln,yr,Kt.symbolInstances.length,vy),Ns=Kt.icon.placedSymbolArray.length-1,Am&&(Cs=4*vy,Kt.addSymbols(Kt.icon,Am,Im,Yi,vi,zi,tc.vertical,ii,ji,cr.lineStartIndex,cr.lineLength,-1,_r,Bi,Ln,yr,Kt.symbolInstances.length,vy),Il=Kt.icon.placedSymbolArray.length-1)}for(const Bo in qi.horizontal){const qa=Bo,Wd=qi.horizontal[qa];Zn||(ic=cc(Wd.text),Wt?ki=Cw(Wd):Zn=Kx(Wn,ua,ji,es,ye,pe,Wd,ft,$n.layout.get("text-rotate").evaluate(zi,{},Bi),pt));const Am=Wd.positionedLines.length===1;if(Zs+=iI(Kt,ii,ji,Wd,Nn,$n,Wt,zi,pt,cr,qi.vertical?tc.horizontal:tc.horizontalOnly,Am?gk(qi.horizontal):[qa],Vs,Ns,mi,_r,Bi,Kt.symbolInstances.length,Ln),Am)break}qi.vertical&&(jr+=iI(Kt,ii,ji,qi.vertical,Nn,$n,Wt,zi,pt,cr,tc.vertical,["vertical"],Vs,Il,mi,_r,Bi,Kt.symbolInstances.length,Ln));let ha=-1;const rc=(Bo,qa)=>Bo?Math.max(Bo,qa):qa;ha=rc(ki,ha),ha=rc(Vn,ha),ha=rc(Ur,ha);const fu=ha>-1?1:0;Kt.glyphOffsetArray.length>=65535&&gi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),zi.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,zi.sortKey),Kt.symbolInstances.emplaceBack(ji.x,ji.y,ua.x,ua.y,ua.z,Vs.right>=0?Vs.right:-1,Vs.center>=0?Vs.center:-1,Vs.left>=0?Vs.left:-1,Vs.vertical>=0?Vs.vertical:-1,Ns,Il,ic,Zn!==void 0?Zn:Kt.collisionBoxArray.length,Zn!==void 0?Zn+1:Kt.collisionBoxArray.length,Xn!==void 0?Xn:Kt.collisionBoxArray.length,Xn!==void 0?Xn+1:Kt.collisionBoxArray.length,Qi!==void 0?Qi:Kt.collisionBoxArray.length,Qi!==void 0?Qi+1:Kt.collisionBoxArray.length,Ar||Kt.collisionBoxArray.length,Ar?Ar+1:Kt.collisionBoxArray.length,es,Zs,jr,xs,Cs,fu,0,Cl,nc,ha,0,du?1:0,cs)})(r,li,ni,bt,i,a,m,h,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Et,ne,S,0,jt,vt,K,e,_,M,D,O,V,$,Z,It,ue,Te)};if(ae==="line")for(const bt of Wh(e.geometry,0,0,Nt,Nt)){const li=hk(bt,gt,Dt,i.vertical||at,a,Me,ut,r.overscaling,Nt);for(const fi of li)at&&Tk(r,at.text,Mt,fi)||Vt(bt,fi,O)}else if(ae==="line-center"){for(const bt of e.geometry)if(bt.length>1){const li=uk(bt,Dt,i.vertical||at,a,Me,ut);li&&Vt(bt,li,O)}}else if(e.type==="Polygon")for(const bt of Zf(e.geometry,0)){const li=pk(bt,16);Vt(bt[0],new Jf(li.x,li.y,0,0,void 0),O)}else if(e.type==="LineString")for(const bt of e.geometry)Vt(bt,new Jf(bt[0].x,bt[0].y,0,0,void 0),O);else if(e.type==="Point")for(const bt of e.geometry)for(const li of bt)Vt([li],new Jf(li.x,li.y,0,0,void 0),O)}const Hv=255,ep=Hv*Xh;function iI(r,e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne){const ae=(function(_e,Ie,Me,Le,at,Ge,ut,gt){const Et=[];if(Ie.positionedLines.length===0)return Et;const jt=Le.layout.get("text-rotate").evaluate(Ge,{})*Math.PI/180,Dt=(function(It){const Vt=It[0],bt=It[1],li=Vt*bt;return li>0?[Vt,-bt]:li<0?[-Vt,bt]:Vt===0?[bt,Vt]:[bt,-Vt]})(Me);let vt=Math.abs(Ie.top-Ie.bottom);for(const It of Ie.positionedLines)vt-=It.lineOffset;const Mt=Ie.positionedLines.length,ot=vt/Mt;let et=Ie.top-Me[1];for(let It=0;It<Mt;++It){const Vt=Ie.positionedLines[It];et=fk(Ie,ot,et,It);for(const bt of Vt.positionedGlyphs){if(!bt.rect)continue;const li=bt.rect||{};let fi=MA+1,ni=!0,Kt=1,ji=0;if(bt.image){const vi=ut.get(bt.image.toString());if(!vi)continue;if(vi.sdf){gi("SDF images are not supported in formatted text and will be ignored.");continue}ni=!1,Kt=vi.pixelRatio,fi=Kg/Kt}const ii=(at||gt)&&bt.vertical,Ri=bt.metrics.advance*bt.scale/2,qi=bt.metrics,un=bt.rect;if(un===null)continue;gt&&Ie.verticalizable&&(ji=bt.image?Ri-bt.metrics.width*bt.scale/2:0);const Nn=at?[bt.x+Ri,bt.y]:[0,0];let Zi=[0,0],$n=[0,0],Wn=!1;at||(ii?($n=[bt.x+Ri+Dt[0],bt.y+Dt[1]-ji],Wn=!0):Zi=[bt.x+Ri+Me[0],bt.y+Me[1]-ji]);const es=un.w*bt.scale/(Kt*(bt.localGlyph?Kh:1)),ye=un.h*bt.scale/(Kt*(bt.localGlyph?Kh:1));let pe,ft,Wt,pt;if(ii){const vi=bt.y-et,Yi=new St(-Ri,Ri-vi),zi=-Math.PI/2,mi=new St(...$n);pe=new St(-Ri+Zi[0],Zi[1]),pe._rotateAround(zi,Yi)._add(mi),pe.x+=-vi+Ri,pe.y-=(qi.left-fi)*bt.scale;const Gn=bt.image?qi.advance*bt.scale:Fo*bt.scale,_r=String.fromCodePoint(bt.glyph);Zz(_r)?pe.x+=(1-fi)*bt.scale:Xz(_r)?pe.x+=Gn-qi.height*bt.scale+(-fi-1)*bt.scale:pe.x+=bt.image||qi.width+2*fi===un.w&&qi.height+2*fi===un.h?(Gn-ye)/2:(Gn-(qi.height+2*fi)*bt.scale)/2,ft=new St(pe.x,pe.y-es),Wt=new St(pe.x+ye,pe.y),pt=new St(pe.x+ye,pe.y-es)}else{const vi=(qi.left-fi)*bt.scale-Ri+Zi[0],Yi=(-qi.top-fi)*bt.scale+Zi[1],zi=vi+es,mi=Yi+ye;pe=new St(vi,Yi),ft=new St(zi,Yi),Wt=new St(vi,mi),pt=new St(zi,mi)}if(jt){let vi;vi=at?new St(0,0):Wn?new St(Dt[0],Dt[1]):new St(Me[0],Me[1]),pe._rotateAround(jt,vi),ft._rotateAround(jt,vi),Wt._rotateAround(jt,vi),pt._rotateAround(jt,vi)}const Qt=new St(0,0),bi=new St(0,0);Et.push({tl:pe,tr:ft,bl:Wt,br:pt,texPrimary:li,texSecondary:void 0,writingMode:Ie.writingMode,glyphOffset:Nn,sectionIndex:bt.sectionIndex,isSDF:ni,pixelOffsetTL:Qt,pixelOffsetBR:bi,minFontScaleX:0,minFontScaleY:0})}}return Et})(0,a,E,m,_,v,h,r.allowVerticalPlacement),ue=r.textSizeData;let Te=null;ue.kind==="source"?(Te=[Xh*m.layout.get("text-size").evaluate(v,{},Z)*V.textScaleFactor],Te[0]>ep&&gi(`${r.layerIds[0]}: Value for "text-size" is >= ${Hv}. Reduce your "text-size".`)):ue.kind==="composite"&&(Te=[Xh*V.compositeTextSizes[0].evaluate(v,{},Z)*V.textScaleFactor,Xh*V.compositeTextSizes[1].evaluate(v,{},Z)*V.textScaleFactor],(Te[0]>ep||Te[1]>ep)&&gi(`${r.layerIds[0]}: Value for "text-size" is >= ${Hv}. Reduce your "text-size".`)),r.addSymbols(r.text,ae,Te,E,_,v,M,e,i,S.lineStartIndex,S.lineLength,N,$,Z,ne,!1,K,ae.length);for(const _e of D)O[_e]=r.text.placedSymbolArray.length-1;return 4*ae.length}function Iw(r){for(const e in r)return r[e];return null}function Kx(r,e,i,a,h,m,_,v,E,S,M){let D,O,N,V;if(D=M?M.top:_.top,O=M?M.bottom:_.bottom,N=M?M.left:_.left,V=M?M.right:_.right,kA(_)&&_.collisionPadding){const $=_.collisionPadding;N-=$[0],D-=$[1],V+=$[2],O+=$[3]}if(E){const $=new St(N,D),Z=new St(V,D),K=new St(N,O),ne=new St(V,O),ae=gn(E);let ue=new St(0,0);S&&(ue=new St(S[0],S[1])),$._rotateAround(ae,ue),Z._rotateAround(ae,ue),K._rotateAround(ae,ue),ne._rotateAround(ae,ue),N=Math.min($.x,Z.x,K.x,ne.x),V=Math.max($.x,Z.x,K.x,ne.x),D=Math.min($.y,Z.y,K.y,ne.y),O=Math.max($.y,Z.y,K.y,ne.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,N,D,V,O,v,a,h,m),r.length-1}function Cw(r){kA(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Tk(r,e,i,a){const h=r.compareText;if(e in h){const m=h[e];for(let _=m.length-1;_>=0;_--)if(a.dist(m[_])<i)return!0}else h[e]=[];return h[e].push(a),!1}function nI(r,e){const i=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,h=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),m=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let _=Math.sin(r._pitch)*m+h;const v=h*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let E=Math.max(r.zoom-17,0);r.isOrthographic&&(E/=10),_*=1+E}return Math.min(1.01*_,v)}function $v(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),a=r.x*i,h=(r.x+1)*i,m=r.y*i,_=(r.y+1)*i,v=he(a),E=he(h),S=le(m),M=le(_),D=e.project(v,S),O=e.project(E,S),N=e.project(E,M),V=e.project(v,M);let $=Math.min(D.x,O.x,N.x,V.x),Z=Math.min(D.y,O.y,N.y,V.y),K=Math.max(D.x,O.x,N.x,V.x),ne=Math.max(D.y,O.y,N.y,V.y);const ae=i/16;function ue(_e,Ie,Me,Le,at,Ge){const ut=(Me+at)/2,gt=(Le+Ge)/2,Et=e.project(he(ut),le(gt)),jt=Math.max(0,$-Et.x,Z-Et.y,Et.x-K,Et.y-ne);$=Math.min($,Et.x),K=Math.max(K,Et.x),Z=Math.min(Z,Et.y),ne=Math.max(ne,Et.y),jt>ae&&(ue(_e,Et,Me,Le,ut,gt),ue(Et,Ie,ut,gt,at,Ge))}ue(D,O,a,m,h,m),ue(O,N,h,m,h,_),ue(N,V,h,_,a,_),ue(V,D,a,_,a,m),$-=ae,Z-=ae,K+=ae,ne+=ae;const Te=1/Math.max(K-$,ne-Z);return{scale:Te,x:$*Te,y:Z*Te,x2:K*Te,y2:ne*Te,projection:e}}function rI(r,{x:e,y:i},a=0){return new St(((e-a)*r.scale-r.x)*Nt,(i*r.scale-r.y)*Nt)}const Ek=Ze(new Float32Array(16));class Em{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new U(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,h=!0){return e._coordinatePoint(e.locationCoordinate(i,a),h)}pixelsPerMeter(e,i){return re(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return nI(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,h){const m=e.horizonLineFromTop(!1),_=new St(i,Math.max(m,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,h))}pointCoordinate3D(e,i,a){const h=new St(i,a);if(e.elevation)return e.elevation.pointCoordinate(h);{const m=this.pointCoordinate(e,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return Ek}createTileMatrix(e,i,a){let h,m,_;const v=a.canonical,E=Ze(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=$v(v,this);h=1,m=S.x+a.wrap*S.scale,_=S.y,ei(E,E,[h/S.scale,h/S.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(v.z),m=(v.x+Math.pow(2,v.z)*a.wrap)*h,_=v.y*h;return Gt(E,E,[m,_,0]),ei(E,E,[h/Nt,h/Nt,1]),E}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class Sk extends Em{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(gn(i));this.n=(h+Math.sin(gn(a)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:h,r0:m}=this,_=gn(e-this.center[0]),v=gn(i),E=Math.sqrt(h-2*a*Math.sin(v))/a;return{x:E*Math.sin(_*a),y:E*Math.cos(_*a)-m,z:0}}unproject(e,i){const{n:a,c:h,r0:m}=this,_=m+i;let v=Math.atan2(e,Math.abs(_))*Math.sign(_);_*a<0&&(v-=Math.PI*Math.sign(e)*Math.sign(_));const E=gn(this.center[0])*a;v=Re(v,-Math.PI-E,Math.PI-E);const S=J(Ls(v/a)+this.center[0],-180,180),M=Math.asin(J((h-(e*e+_*_)*a*a)/(2*a),-1,1)),D=J(Ls(M),-fe,fe);return new U(S,D)}}const Wv=1.340264,Zv=-.081106,Xv=893e-6,Kv=.003796,Yx=Math.sqrt(3)/2;class Ak extends Em{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Yx*Math.sin(i)),h=a*a,m=h*h*h;return{x:.5*(e*Math.cos(a)/(Yx*(Wv+3*Zv*h+m*(7*Xv+9*Kv*h)))/Math.PI+.5),y:1-.5*(a*(Wv+Zv*h+m*(Xv+Kv*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,h=a*a,m=h*h*h;for(let M,D,O,N=0;N<12&&(D=a*(Wv+Zv*h+m*(Xv+Kv*h))-i,O=Wv+3*Zv*h+m*(7*Xv+9*Kv*h),M=D/O,a=J(a-M,-Math.PI/3,Math.PI/3),h=a*a,m=h*h*h,!(Math.abs(M)<1e-12));++N);const _=Yx*e*(Wv+3*Zv*h+m*(7*Xv+9*Kv*h))/Math.cos(a),v=Math.asin(Math.sin(a)/Yx),E=J(180*_/Math.PI,-180,180),S=J(180*v/Math.PI,-fe,fe);return new U(E,S)}}class Ik extends Em{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),h=J(360*(.5-i),-fe,fe);return new U(a,h)}}const fy=Math.PI/2;function Qx(r){return Math.tan((fy+r)/2)}class Ck extends Em{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let h=gn(i),m=gn(a);this.southernCenter=h+m<0,this.southernCenter&&(h=-h,m=-m);const _=Math.cos(h),v=Qx(h);this.n=h===m?Math.sin(h):Math.log(_/Math.cos(m))/Math.log(Qx(m)/v),this.f=_*Math.pow(Qx(h),this.n)/this.n}project(e,i){i=gn(i),this.southernCenter&&(i=-i),e=gn(e-this.center[0]);const a=1e-6,{n:h,f:m}=this;m>0?i<-fy+a&&(i=-fy+a):i>fy-a&&(i=fy-a);const _=m/Math.pow(Qx(i),h);let v=_*Math.sin(h*e),E=m-_*Math.cos(h*e);return v=.5*(v/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:v,y:this.southernCenter?E:1-E,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:h}=this,m=h-i,_=Math.sign(m),v=Math.sign(a)*Math.sqrt(e*e+m*m);let E=Math.atan2(e,Math.abs(m))*_;m*a<0&&(E-=Math.PI*Math.sign(e)*_);const S=J(Ls(E/a)+this.center[0],-180,180),M=J(Ls(2*Math.atan(Math.pow(h/v,1/a))-fy),-fe,fe);return new U(S,this.southernCenter?-M:M)}}class sI extends Em{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:te(e),y:ee(i),z:0}}unproject(e,i){const a=he(e),h=le(i);return new U(a,h)}}const oI=gn(fe);class Rk extends Em{project(e,i){const a=(i=gn(i))*i,h=a*a;return{x:.5*((e=gn(e))*(.8707-.131979*a+h*(h*(.003971*a-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+h*(.028874*a-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,h=25,m=0,_=a*a;do{_=a*a;const S=_*_;m=(a*(1.007226+_*(.015085+S*(.028874*_-.044475-.005916*S)))-i)/(1.007226+_*(.045255+S*(.259866*_-.311325-.005916*11*S))),a=J(a-m,-oI,oI)}while(Math.abs(m)>1e-6&&--h>0);_=a*a;const v=J(Ls(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=Ls(a);return new U(v,E)}}const aI=gn(fe);class Mk extends Em{project(e,i){i=gn(i),e=gn(e);const a=Math.cos(i),h=2/Math.PI,m=Math.acos(a*Math.cos(e/2)),_=Math.sin(m)/m,v=.5*(e*h+2*a*Math.sin(e/2)/_)||0,E=.5*(i+Math.sin(i)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,m=25;const _=1e-6;let v=0,E=0;do{const S=Math.cos(h),M=Math.sin(h),D=2*M*S,O=M*M,N=S*S,V=Math.cos(a/2),$=Math.sin(a/2),Z=2*V*$,K=$*$,ne=1-N*V*V,ae=ne?1/ne:0,ue=ne?Math.acos(S*V)*Math.sqrt(1/ne):0,Te=.5*(2*ue*S*$+2*a/Math.PI)-e,_e=.5*(ue*M+h)-i,Ie=.5*ae*(N*K+ue*S*V*O)+1/Math.PI,Me=ae*(Z*D/4-ue*M*$),Le=.125*ae*(D*$-ue*M*N*Z),at=.5*ae*(O*V+ue*K*S)+.5,Ge=Me*Le-at*Ie;v=(_e*Me-Te*at)/Ge,E=(Te*Le-_e*Ie)/Ge,a=J(a-v,-Math.PI,Math.PI),h=J(h-E,-aI,aI)}while((Math.abs(v)>_||Math.abs(E)>_)&&--m>0);return new U(Ls(a),Ls(h))}}class lI extends Em{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(gn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:h}=this;return{x:gn(e)*h*a+.5,y:-Math.sin(gn(i))/h*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:h}=this,m=-(i-.5)/a,_=J(Ls((e-.5)/a)/h,-180,180),v=Math.asin(J(m*h,-1,1)),E=J(Ls(v),-fe,fe);return new U(_,E)}}class Dk extends sI{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const h=Ig(e,i,a);return nr(h,h,Nh(lu(a))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i,a){const h=R(i.lat,i.lng),m=Ki([],h),_=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;_i(h,h,m,re(1,0)*Nt*_);const v=Ze(new Float64Array(16));return ct(v,e.pixelMatrix,e.globeMatrix),nr(h,h,v),new St(h[0],h[1])}pixelsPerMeter(e,i){return re(1,0)*i}pixelSpaceConversion(e,i,a){const h=re(1,e)*i,m=Oi(re(1,45)*i,h,a);return this.pixelsPerMeter(e,i)/m}createTileMatrix(e,i,a){const h=Rg(lu(a.canonical));return ct(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:a}=e,h=Nh(lu(i));return Si(h,h,gn(a.lng)),Fi(h,h,gn(a.lat)),ei(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,a,h){return av(e,i,a,!0)||new Ve(0,0)}pointCoordinate3D(e,i,a){const h=this.pointCoordinate(e,i,a,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!av(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(h,m){const _=h.cameraToCenterDistance,v=h._centerAltitude*m,E=h._camera,S=h._camera.forward(),M=wi([],ai([],S,-_),[0,0,v]),D=h.worldSize/(2*Math.PI),O=[0,0,-D],N=h.width/h.height,V=Math.tan(h.fovAboveCenter),$=ai([],E.up(),V),Z=ai([],E.right(),V*N),K=Ki([],wi([],wi([],S,$),Z)),ne=[];let ae;if(new Ni(M,K).closestPointOnSphere(O,D,ne)){const ue=wi([],ne,O),Te=Dr([],ue,M);ae=Math.cos(h.fovAboveCenter)*qn(Te)}else{const ue=Dr([],M,O),Te=Dr([],O,M);Ki(Te,Te);const _e=qn(ue)-D;ae=Math.sqrt(_e*(_e+2*D));const Ie=Math.acos(ae/(D+_e))-Math.acos(hr(S,Te));ae*=Math.cos(Ie)}return 1.01*ae})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Aa(e.zoom);if(a>0){const h=nI(e,re(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Oi(i,h+m*(1-Math.cos(_)),Math.pow(a,10))}return i}upVector(e,i,a){return Ig(i,a,e,1)}upVectorScale(e){return{metersToTile:Sg(j_(lu(e)))}}}function cI(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new sI(r);case"equirectangular":return new Ik(r);case"naturalEarth":return new Rk(r);case"equalEarth":return new Ak(r);case"winkelTripel":return new Mk(r);case"albers":return i?new lI(r):new Sk(r);case"lambertConformalConic":return i?new lI(r):new Ck(r);case"globe":return new Dk(r)}throw new Error(`Invalid projection name: ${r.name}`)}const Pk=At.types,Ok=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Yv(r,e,i,a,h,m,_,v,E,S,M,D,O){const N=v?Math.min(ep,Math.round(v[0])):0,V=v?Math.min(ep,Math.round(v[1])):0;r.emplaceBack(e,i,Math.round(32*a),Math.round(32*h),m,_,(N<<1)+(E?1:0),0+(V<<1),16*S,16*M,256*D,256*O)}function Qv(r,e,i){r.emplaceBack(e,i)}function Jv(r,e,i,a,h,m,_){r.emplaceBack(e,i,a,h,m,_)}const Jx=(r,e,i,a)=>{for(let h=0;h<e;h++)r.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function py(r,e,i,a,h){r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h)}function Lk(r){for(const e of r.sections)if(D_(e.text))return!0;return!1}class Rw{constructor(e){this.layoutVertexArray=new Dh,this.indexArray=new Cr,this.programConfigurations=e,this.segments=new Lr,this.dynamicLayoutVertexArray=new ou,this.opacityVertexArray=new Oh,this.placedSymbolArray=new Ld,this.iconTransitioningVertexArray=new il,this.globeExtVertexArray=new Ph,this.zOffsetVertexArray=new Dc,this.orientationVertexArray=new Hp,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const a=[],h=this.layoutVertexArray.uint16;for(let m=0;m<i;++m){const _=12*(e+m);a.push(...h.slice(_,_+12))}return a}updateIconVertexData(e,i,a,h,m,_,v,E,S,M,D,O,N){const V=this.layoutVertexArray.uint16,$=12*e;V[$]=i,V[$+1]=a,V[$+2]=h,V[$+3]=m,V[$+4]=_,V[$+5]=v,V[$+6]=E,V[$+7]=S,V[$+8]=M,V[$+9]=D,V[$+10]=O,V[$+11]=N}upload(e,i,a,h,m,_){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bz.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Vz.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ok,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Gz.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Nz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Uz.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,jz.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Lt(Rw,"SymbolBuffers");class Mw{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Lr,this.collisionVertexArray=new Uu,this.collisionVertexArrayExt=new ou}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,qz.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Hz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Lt(Mw,"CollisionBuffers");class eb{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ze([]),this.placementViewportMatrix=Ze([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=cy(this.zoom,i["text-size"],this.worldview),this.iconSizeData=cy(this.zoom,i["icon-size"],this.worldview);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map((_=>tc[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some((a=>a.getProperty(e)!=null))}createArrays(){this.text=new Rw(new El(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new Rw(new El(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new zd,this.lineVertexArray=new pg,this.symbolInstances=new fg}calculateGlyphDependencies(e,i,a,h,m){for(const _ of e){const v=_.codePointAt(0);if(v===void 0)break;if(i[v]=!0,h&&m&&v<=65535){const E=Vv[_];E&&(i[E.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,a,h,m,_){let v=1;const E=e.getUnevaluatedProperties()._values["icon-size"],S=cy(this.zoom,E,this.worldview),M=uy(S,i);if(S.kind!=="constant"&&S.kind!=="camera"||(v=M.uSize),S.kind==="composite"){const{minZoom:D,maxZoom:O}=S,N=E.possiblyEvaluate(new Yn(D,{worldview:this.worldview}),h),V=E.possiblyEvaluate(new Yn(O,{worldview:this.worldview}),h),$=N.evaluate(a,{},h,m);v=$+(V.evaluate(a,{},h,m)-$)*M.uSizeT}return S.kind==="source"&&(v=E.possiblyEvaluate(new Yn(this.zoom,{worldview:this.worldview}),h).evaluate(a,{},h,m)),v*_}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Bg(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?fo.build(e):e}populate(e,i,a,h){const m=this.layers[0],_=m.layout,v=this.projection.name==="globe",E=_.get("text-font"),S=_.get("text-field"),M=_.get("icon-image"),[D,O]=_.get("icon-size-scale-range"),N=J(i.scaleFactor||1,D,O),V=(S.value.kind!=="constant"||S.value.value instanceof ws&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),$=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,Z=this.hasAnyAppearanceProperty("icon-image"),K=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!V&&!$&&!Z)return;const ne=i.iconDependencies,ae=i.glyphDependencies,ue=i.availableImages,Te=new Yn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),_e=Ie=>{const Me=Ie.id.toString();ne.has(Me)?ne.get(Me).push(Ie):ne.set(Me,[Ie])};for(const Ie of e){const{feature:Me,id:Le,index:at,sourceLayerIndex:Ge}=Ie,ut=m._featureFilter.needGeometry,gt=Ke(Me,ut);if(!m._featureFilter.filter(Te,gt,a))continue;if(ut||(gt.geometry=dt(Me,a,h)),v&&Me.type!==1&&a.z<=5){const It=gt.geometry,Vt=.98078528056,bt=(li,fi)=>hr(Ig(li.x,li.y,a,1),Ig(fi.x,fi.y,a,1))<Vt;for(let li=0;li<It.length;li++)It[li]=ht(It[li],bt)}let Et,jt;if(V){const It=m.getValueAndResolveTokens("text-field",gt,a,ue),Vt=ws.factory(It);Lk(Vt)&&(this.hasRTLText=!0),(!this.hasRTLText||Th()==="unavailable"||this.hasRTLText&&la.isParsed())&&(Et=Wz(Vt,m,gt))}if($){const It=m.getValueAndResolveTokens("icon-image",gt,a,ue);jt=this.getResolvedImageFromTokens(It)}const Dt=this.layers[0];let vt=!1;if(!jt&&Z){const It=Dt.getAppearances();for(const Vt of It)if(Vt.getProperty("icon-image")){const bt=Dt.getAppearanceValueAndResolveTokens(Vt,"icon-image",gt,a,ue);if(bt){jt=this.getResolvedImageFromTokens(bt),vt=!0;break}}}if(!Et&&!jt)continue;const Mt=this.sortFeaturesByKey?K.evaluate(gt,{},a):void 0,ot={id:Le,text:Et,icon:jt,index:at,sourceLayerIndex:Ge,geometry:gt.geometry,properties:Me.properties,type:Pk[Me.type],sortKey:Mt};if(this.features.push(ot),this.appearanceFeatureData.push({id:Le,properties:Me.properties,usesAppearanceIconAsPlaceholder:vt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),jt){const It=Dt._unevaluatedLayout._values,{iconPrimary:Vt,iconSecondary:bt}=qv(jt,this.iconSizeData,It["icon-size"],a,this.zoom,ot,this.pixelRatio,N,this.worldview);_e(Vt),bt&&(this.hasAnySecondaryIcon=!0,_e(bt))}const et=Dt.getAppearances();if(et.length!==0&&et.forEach((It=>{if(!It.getProperty("icon-image"))return;const Vt=this.getCombinedIconPrimary(It,Dt,gt,a,ue,ot,N);Vt&&_e(Vt)})),Et){const It=E.evaluate(gt,{},a).join(","),Vt=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tc.vertical)>=0;for(const bt of Et.sections)if(bt.image){const li=bt.image.getPrimary().scaleSelf(this.pixelRatio),fi=li.id.toString(),ni=ne.get(fi)||[];ni.push(li),ne.set(fi,ni)}else{const li=Id(Et.toString()),fi=bt.fontStack||It,ni=ae[fi]=ae[fi]||{};this.calculateGlyphDependencies(bt.text,ni,Vt,this.allowVerticalPlacement,li)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ie){const Me={},Le={},at=[];let Ge=0;function ut(Dt){at.push(Ie[Dt]),Ge++}function gt(Dt,vt,Mt){const ot=Le[Dt];return delete Le[Dt],Le[vt]=ot,at[ot].geometry[0].pop(),at[ot].geometry[0]=at[ot].geometry[0].concat(Mt[0]),ot}function Et(Dt,vt,Mt){const ot=Me[vt];return delete Me[vt],Me[Dt]=ot,at[ot].geometry[0].shift(),at[ot].geometry[0]=Mt[0].concat(at[ot].geometry[0]),ot}function jt(Dt,vt,Mt){const ot=Mt?vt[0][vt[0].length-1]:vt[0][0];return`${Dt}:${ot.x}:${ot.y}`}for(let Dt=0;Dt<Ie.length;Dt++){const vt=Ie[Dt],Mt=vt.geometry,ot=vt.text?vt.text.toString():null;if(!ot){ut(Dt);continue}const et=jt(ot,Mt),It=jt(ot,Mt,!0);if(et in Le&&It in Me&&Le[et]!==Me[It]){const Vt=Et(et,It,Mt),bt=gt(et,It,at[Vt].geometry);delete Me[et],delete Le[It],Le[jt(ot,at[bt].geometry,!0)]=bt,at[Vt].geometry=null}else et in Le?gt(et,It,Mt):It in Me?Et(et,It,Mt):(ut(Dt),Me[et]=Ge-1,Le[It]=Ge-1)}return at.filter((Dt=>Dt.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ie of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Ie.id,this.elevationFeatures.length),this.elevationFeatures.push(Ie)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ie,Me)=>Ie.sortKey-Me.sortKey))}getCombinedIconPrimary(e,i,a,h,m,_,v){let E,S;const M=e.getUnevaluatedProperties();if(M._values["icon-image"].value!==void 0){const D=i.getAppearanceValueAndResolveTokens(e,"icon-image",a,h,m);E=this.getResolvedImageFromTokens(D)}else{const D=i.getValueAndResolveTokens("icon-image",a,h,m);E=this.getResolvedImageFromTokens(D)}if(E){const D=M._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];S=qv(E,cy(this.zoom,D,this.worldview),D,h,this.zoom,_,this.pixelRatio,v,this.worldview).iconPrimary}return S}updateAppearanceBasedIconTextures(e,i,a,h){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const m=this.layers[0];let _=!1,v=0;const E=m.layout,[S,M]=E.get("icon-size-scale-range"),D=J(1,S,M);for(let O=0;O<this.symbolInstances.length;O++){const N=this.symbolInstances.get(O),V=this.appearanceFeatureData[N.featureIndex];if(V&&N.placedIconSymbolIndex>=0){const $=V.id,Z=i&&$!==void 0?i[String($)]:void 0,K={type:"Point",id:V.id,properties:V.properties,geometry:[]},ne=this.layers[0].appearances&&this.layers[0].appearances.find((ae=>ae.isActive({globals:h,feature:K,canonical:e,featureState:Z})));if(V.activeAppearance===ne)continue;if(ne){V.activeAppearance=ne;const ae={sortKey:void 0,text:void 0,icon:null,index:N.featureIndex,sourceLayerIndex:N.featureIndex,geometry:[],properties:V.properties,type:"Point",id:V.id};if(!ne.hasCachedIconPrimary()){const Ie=this.getCombinedIconPrimary(ne,m,K,e,a,ae,D);ne.setCachedIconPrimary(Ie)}const ue=ne.getCachedIconPrimary();if(!ue)continue;const Te=ue.toString(),_e=this.iconAtlasPositions&&this.iconAtlasPositions.get(Te);if(_e){const Ie=m.getAppearanceValueAndResolveTokens(ne,"icon-offset",K,e,a),Me=Ie&&Array.isArray(Ie)?Ie:[0,0];let Le=qx(_e,void 0,Me,m.layout.get("icon-anchor").evaluate(K,{},e));const at=m.getAppearanceValueAndResolveTokens(ne,"icon-rotate",K,e,a),Ge=typeof at=="number"?at:0,ut=_e.sdf,gt=m.layout.get("icon-text-fit").constantOr("none");gt!=="none"&&V.textShaping&&V.iconTextFitPadding&&V.fontScale&&(Le=xw(Le,V.textShaping,gt,V.iconTextFitPadding,Me,V.fontScale));const Et=this.calculateEffectiveAppearanceIconSize(ne,h.zoom,K,e,a,D),jt=0,Dt=1+(Math.min(ep,Math.round(Et*Xh))<<1),vt=Ew(Le,Ge,ut,gt!=="none",D);V.isUsingAppearanceVertexData||(V.isUsingAppearanceVertexData=!0,V.layoutBasedVertexData=this.icon.getIconVertexData(v,N.numIconVertices));for(let ot=0;ot<vt.length;++ot){const et=vt[ot],It=V.layoutBasedVertexData[0]||N.tileAnchorX,Vt=V.layoutBasedVertexData[1]||N.tileAnchorY,bt=16*et.pixelOffsetTL.x,li=16*et.pixelOffsetTL.y,fi=16*et.pixelOffsetBR.x,ni=16*et.pixelOffsetBR.y,Kt=16*et.minFontScaleX,ji=16*et.minFontScaleY;this.icon.updateIconVertexData(v,It,Vt,Math.round(32*et.tl.x),Math.round(32*et.tl.y),et.texPrimary.x,et.texPrimary.y,jt,Dt,bt,li,Kt,ji),this.icon.updateIconVertexData(v+1,It,Vt,Math.round(32*et.tr.x),Math.round(32*et.tr.y),et.texPrimary.x+et.texPrimary.w,et.texPrimary.y,jt,Dt,fi,li,Kt,ji),this.icon.updateIconVertexData(v+2,It,Vt,Math.round(32*et.bl.x),Math.round(32*et.bl.y),et.texPrimary.x,et.texPrimary.y+et.texPrimary.h,jt,Dt,bt,ni,Kt,ji),this.icon.updateIconVertexData(v+3,It,Vt,Math.round(32*et.br.x),Math.round(32*et.br.y),et.texPrimary.x+et.texPrimary.w,et.texPrimary.y+et.texPrimary.h,jt,Dt,fi,ni,Kt,ji),v+=4}const Mt=N.numIconVertices-4*vt.length;for(let ot=0;ot<Mt;++ot)this.icon.updateIconVertexData(v+ot,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else v+=N.numIconVertices}else if(V.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),v+=N.numIconVertices,V.activeAppearance=null;else if(V.isUsingAppearanceVertexData){const ue=V.layoutBasedVertexData.length/12;for(let Te=0;Te<ue;++Te){const _e=Te*12;this.icon.updateIconVertexData(v+Te,V.layoutBasedVertexData[_e+0],V.layoutBasedVertexData[_e+1],V.layoutBasedVertexData[_e+2],V.layoutBasedVertexData[_e+3],V.layoutBasedVertexData[_e+4],V.layoutBasedVertexData[_e+5],V.layoutBasedVertexData[_e+6],V.layoutBasedVertexData[_e+7],V.layoutBasedVertexData[_e+8],V.layoutBasedVertexData[_e+9],V.layoutBasedVertexData[_e+10],V.layoutBasedVertexData[_e+11])}v+=ue,V.isUsingAppearanceVertexData=!1,V.activeAppearance=null,_=!0}else v+=N.numIconVertices,V.activeAppearance=null}}return _}update(e,i,a,h,m,_,v){this.text.programConfigurations.updatePaintArrays(e,i,m,a,h,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,m,a,h,_,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=Se(e),h=1/a;let m=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const E=this.symbolInstances.get(v),S=Ct(1,0,0),M=Ct(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:O,numIconVertices:N,numVerticalIconVertices:V}=E,$=D>0||O>0,Z=N>0,K=this.elevationFeatures[E.elevationFeatureIndex];if(K){const ne=new St(E.tileAnchorX,E.tileAnchorY),ae=.075+K.pointElevation(ne);E.zOffset!==ae&&(i=!0,E.zOffset=ae),ae!==0&&(this.hasAnyZOffset=!0);const ue=K.computeSlopeNormal(ne,h),Te=Yo(Ks(),Ct(0,0,1),ue);rr(S,S,Te),rr(M,M,Te),S[2]*=a,M[2]*=a,S[0]===1&&S[1]===0&&S[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(m=m||$,_=_||Z)}if($&&(Jx(this.text.orientationVertexArray,D,S,M),Jx(this.text.orientationVertexArray,O,S,M)),Z){const{placedIconSymbolIndex:ne,verticalPlacedIconSymbolIndex:ae}=E;ne>=0&&Jx(this.icon.orientationVertexArray,N,S,M),ae>=0&&Jx(this.icon.orientationVertexArray,V,S,M)}}m||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(m,_,v)=>{a+=_,a>m.length&&m.resize(a);for(let E=-_;E<0;E++)m.emplace(E+a,v)},i=(m,_,v)=>{h+=_,h>m.length&&m.resize(h);for(let E=-_;E<0;E++)m.emplace(E+h,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,h=0;for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:E,numIconVertices:S}=_,M=_.zOffset,D=S>0;if((v>0||E>0)&&(e(this.text.zOffsetVertexArray,v,M),e(this.text.zOffsetVertexArray,E,M)),D){const{placedIconSymbolIndex:O,verticalPlacedIconSymbolIndex:N}=_;O>=0&&i(this.icon.zOffsetVertexArray,S,M),N>=0&&i(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,a,h,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((_=>_.appearances&&_.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,a,h){return!!(e&&i&&a)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,a,h)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=cI(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:m}of i)this.lineVertexArray.emplaceBack(h,m);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,h,m,_,v,E,S,M,D,O,N,V,$,Z,K,ne){const ae=e.indexArray,ue=e.layoutVertexArray,Te=e.globeExtVertexArray,_e=e.segments.prepareSegment(4*ne,ue,ae,this.canOverlap?_.sortKey:void 0),Ie=this.glyphOffsetArray.length,Me=_e.vertexLength,Le=this.allowVerticalPlacement&&v===tc.vertical?Math.PI/2:0,at=_.text&&_.text.sections;for(let gt=0;gt<i.length;gt++){const{tl:Et,tr:jt,bl:Dt,br:vt,texPrimary:Mt,texSecondary:ot,pixelOffsetTL:et,pixelOffsetBR:It,minFontScaleX:Vt,minFontScaleY:bt,glyphOffset:li,isSDF:fi,sectionIndex:ni}=i[gt],Kt=_e.vertexLength,ji=li[1];if(Yv(ue,S.x,S.y,Et.x,ji+Et.y,Mt.x,Mt.y,a,fi,et.x,et.y,Vt,bt),Yv(ue,S.x,S.y,jt.x,ji+jt.y,Mt.x+Mt.w,Mt.y,a,fi,It.x,et.y,Vt,bt),Yv(ue,S.x,S.y,Dt.x,ji+Dt.y,Mt.x,Mt.y+Mt.h,a,fi,et.x,It.y,Vt,bt),Yv(ue,S.x,S.y,vt.x,ji+vt.y,Mt.x+Mt.w,Mt.y+Mt.h,a,fi,It.x,It.y,Vt,bt),E){const{x:ii,y:Ri,z:qi}=E.anchor,[un,Nn,Zi]=E.up;Jv(Te,ii,Ri,qi,un,Nn,Zi),Jv(Te,ii,Ri,qi,un,Nn,Zi),Jv(Te,ii,Ri,qi,un,Nn,Zi),Jv(Te,ii,Ri,qi,un,Nn,Zi),py(e.dynamicLayoutVertexArray,ii,Ri,qi,Le)}else py(e.dynamicLayoutVertexArray,S.x,S.y,S.z,Le);if(Z){const ii=ot||Mt;Qv(e.iconTransitioningVertexArray,ii.x,ii.y),Qv(e.iconTransitioningVertexArray,ii.x+ii.w,ii.y),Qv(e.iconTransitioningVertexArray,ii.x,ii.y+ii.h),Qv(e.iconTransitioningVertexArray,ii.x+ii.w,ii.y+ii.h)}ae.emplaceBack(Kt,Kt+1,Kt+2),ae.emplaceBack(Kt+1,Kt+2,Kt+3),_e.vertexLength+=4,_e.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(li[0]),gt!==i.length-1&&ni===i[gt+1].sectionIndex||e.programConfigurations.populatePaintArrays(ue.length,_,_.index,{},N,V,$,at&&at[ni],this.worldview)}const Ge=ne-i.length;Ge!==0&&this._addNullVertices(Ge,ue,a,E,Te,e,Z,_e,ae);const ut=E?E.anchor:S;e.placedSymbolArray.emplaceBack(ut.x,ut.y,ut.z,S.x,S.y,Ie,this.glyphOffsetArray.length-Ie,Me,M,D,S.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,0,0,O,0),e.symbolInstanceIndices.push(K)}_addNullVertices(e,i,a,h,m,_,v,E,S){for(let M=0;M<e;M++){for(let O=0;O<4;O++)Yv(i,0,0,0,0,0,0,a,!1,0,0,0,0),h&&Jv(m,0,0,0,0,0,0),py(_.dynamicLayoutVertexArray,0,0,0,0),v&&Qv(_.iconTransitioningVertexArray,0,0);const D=E.vertexLength;S.emplaceBack(D,D+1,D+2),S.emplaceBack(D+1,D+2,D+3),E.vertexLength+=4,E.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,a,h,m,_,v){e.emplaceBack(i,a,h,m,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,a,h,m,_,v){const E=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),S=E.vertexLength,M=v.tileAnchorX,D=v.tileAnchorY;for(let N=0;N<4;N++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,M,D,new St(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,M,D,new St(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,M,D,new St(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,h,m,_,M,D,new St(e.x1,e.y2)),E.vertexLength+=4;const O=a.indexArray;O.emplaceBack(S,S+1),O.emplaceBack(S+1,S+2),O.emplaceBack(S+2,S+3),O.emplaceBack(S+3,S),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,h,m,_){for(let v=h;v<m;v++){const E=a.get(v),S=this.getSymbolInstanceTextSize(e,_,i,v);this._addCollisionDebugVertices(E,S,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,a,h,m,_){for(let v=h;v<m;v++){const E=a.get(v),S=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._addCollisionDebugVertices(E,S,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mw(Vf,AA.members,il),this.iconCollisionBox=new Mw(Vf,AA.members,il);const h=uy(this.iconSizeData,e),m=uy(this.textSizeData,e,a);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(m,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(m,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(h,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,a,h){const m=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),_=bw(this.textSizeData,e,m)/Fo;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,a){const h=this.icon.placedSymbolArray.get(a),m=bw(this.iconSizeData,e,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,i,a,h){e.emplaceBack(i,-a,-a,h),e.emplaceBack(i,a,-a,h),e.emplaceBack(i,a,a,h),e.emplaceBack(i,-a,a,h)}_updateTextDebugCollisionBoxes(e,i,a,h,m,_,v){for(let E=h;E<m;E++){const S=a.get(E),M=this.getSymbolInstanceTextSize(e,_,i,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,S.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,h,m,_,v){for(let E=h;E<m;E++){const S=a.get(E),M=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,S.padding,_.zOffset)}}updateCollisionDebugBuffers(e,i,a,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=uy(this.iconSizeData,e,h),_=uy(this.textSizeData,e,a);for(let v=0;v<this.symbolInstances.length;v++){const E=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,e,i,E.textBoxStartIndex,E.textBoxEndIndex,E,a),this._updateTextDebugCollisionBoxes(_,e,i,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,a),this._updateIconDebugCollisionBoxes(m,e,i,E.iconBoxStartIndex,E.iconBoxEndIndex,E,h),this._updateIconDebugCollisionBoxes(m,e,i,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,h,m,_,v,E,S){const M={};if(i<a){const{x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue,featureIndex:Te}=e.get(i);M.textBox={x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue},M.textFeatureIndex=Te}if(h<m){const{x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue,featureIndex:Te}=e.get(h);M.verticalTextBox={x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue},M.verticalTextFeatureIndex=Te}if(_<v){const{x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue,featureIndex:Te}=e.get(_);M.iconBox={x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue},M.iconFeatureIndex=Te}if(E<S){const{x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue,featureIndex:Te}=e.get(E);M.verticalIconBox={x1:D,y1:O,x2:N,y2:V,padding:$,projectedAnchorX:Z,projectedAnchorY:K,projectedAnchorZ:ne,tileAnchorX:ae,tileAnchorY:ue},M.verticalIconFeatureIndex=Te}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),h=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),h=[],m=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const E=this.symbolInstances.get(v);h.push(0|Math.round(i*E.tileAnchorX+a*E.tileAnchorY)),m.push(E.featureIndex)}return _.sort(((v,E)=>h[v]-h[E]||m[E]-m[v])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:S}=a;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&_!==m&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let a;return this.elevationFeatures&&i<this.elevationFeatures.length&&(a=this.elevationFeatures[i]),a}}function uI(r,e){return e.replace(/{([^{}]+)}/g,((i,a)=>a in r?String(r[a]):""))}let hI,dI,Dw;Lt(eb,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),eb.addDynamicAttributes=py;class fI{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ho,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Lt(fI,"FormatSectionOverride",{omit:["defaultValue"]});const Pw=()=>Dw||(Dw={layout:hI||(hI=new rs({"symbol-placement":new kt(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new kt(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new kt(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ti(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new kt(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new kt(Ue.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new kt(Ue.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new kt(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new kt(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new kt(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new kt(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new ti(Ue.layout_symbol["icon-size"]),"icon-size-scale-range":new kt(Ue.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new ti(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ti(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new ti(Ue.layout_symbol["icon-image"]),"icon-image-use-theme":new kt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new ti(Ue.layout_symbol["icon-rotate"]),"icon-padding":new kt(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new kt(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new ti(Ue.layout_symbol["icon-offset"]),"icon-anchor":new ti(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new kt(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new kt(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new kt(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new ti(Ue.layout_symbol["text-field"]),"text-font":new ti(Ue.layout_symbol["text-font"]),"text-size":new ti(Ue.layout_symbol["text-size"]),"text-size-scale-range":new kt(Ue.layout_symbol["text-size-scale-range"]),"text-max-width":new ti(Ue.layout_symbol["text-max-width"]),"text-line-height":new ti(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new ti(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new ti(Ue.layout_symbol["text-justify"]),"text-radial-offset":new ti(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new kt(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new ti(Ue.layout_symbol["text-anchor"]),"text-max-angle":new kt(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new kt(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new ti(Ue.layout_symbol["text-rotate"]),"text-padding":new kt(Ue.layout_symbol["text-padding"]),"text-keep-upright":new kt(Ue.layout_symbol["text-keep-upright"]),"text-transform":new ti(Ue.layout_symbol["text-transform"]),"text-offset":new ti(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new kt(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new kt(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new kt(Ue.layout_symbol["text-optional"]),visibility:new kt(Ue.layout_symbol.visibility)})),paint:dI||(dI=new rs({"icon-opacity":new ti(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new ti(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new ti(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ti(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new ti(Ue.paint_symbol["icon-color"]),"icon-halo-color":new ti(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new ti(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ti(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new kt(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new kt(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ti(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new ti(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new ti(Ue.paint_symbol["text-color"],{runtimeType:z,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new ti(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new ti(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new ti(Ue.paint_symbol["text-halo-blur"]),"text-translate":new kt(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new kt(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new kt(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new kt(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new kt(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new kt(Ue.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new ti(Ue.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},Dw);class tb extends Eo{constructor(e,i,a,h){super(e,Pw(),i,a,h,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Ze([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach((h=>{h.recalculate(e,i,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const m of a)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(m,_,v,E){m=Pn(m),_=jn(_);const S=Je(),M=m/3,D=1-2*M,O=[D,M,M,0,M,D,M,0,M,M,D,0,0,0,0,1],N=.5-.5*_,V=E-v;return ct(S,[V,0,0,0,0,V,0,0,0,0,V,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,N,N,N,1]),ct(S,S,O),S})(e,i,a,h),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,h){const m=this.layout.get(e).evaluate(i,{},a,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Sd(_.value)||!m?m:uI(i.properties,m)}getAppearanceValueAndResolveTokens(e,i,a,h,m){const _=e.getProperty(i);if(!_)return;const v=_.evaluate(a,{},h,m),E=e.getUnevaluatedProperties()._values[i];return E.isDataDriven()||Sd(E.value)||!v||typeof v!="string"?v:uI(a.properties,v)}createBucket(e){return new eb(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Pw().paint.overridableProperties){if(!tb.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new fI(i),h=new Rf(a,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new Zo("source",h):new To("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new el(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&tb.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),h=Pw().paint.properties[i];let m=!1;const _=v=>{for(const E of v)if(h.overrides&&h.overrides.hasOverride(E))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof ws)_(a.value.value.sections);else if(a.value.kind==="source"){const v=S=>{m||(S instanceof dc&&qs(S.value)===Rt?_(S.value.sections):S instanceof fc?_(S.sections):S.eachChild(v))},E=a.value;E._styleExpression&&v(E._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new Jl(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let pI,mI,gI,_I;var Ow=hn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function ib(r,e,i,a,h,m,_,v){const E=[r,e,1,i,a,1,h,m,1],S=[_,v,1],M=be([],E),[D,O,N]=ps(S,S,M);return He(E,E,[D,0,0,0,O,0,0,0,N])}function yI(r,e,i,a,h,m,_,v){const E=(function(S,M,D,O,N,V,$,Z){const K=ib(0,0,1,0,1,1,0,1),ne=ib(S,M,D,O,N,V,$,Z);return He(ne,ne,be([],K))})(r,e,i,a,h,m,_,v);return[E[2]/E[8]/Nt,E[5]/E[8]/Nt]}function nb(r){return[r[0],Math.min(Math.max(r[1],-fe),fe)]}class vI extends fl{constructor(e,i,a,h){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Gs("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ul(this.map._requestManager.transformRequest(this.url,Ho.Image),((a,h)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new uc(a)):h&&(this.image=h instanceof HTMLImageElement?Qs.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Fv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Gs("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Fv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const m of e)m[1]>a&&(a=m[1]),m[1]<i&&(i=m[1]);const h=(a+i)/2;if(h>fe?this.onNorthPole=!0:h<-fe&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=e.map(Ve.fromLngLat);this.tileID=(function(_){let v=1/0,E=1/0,S=-1/0,M=-1/0;for(const $ of _)v=Math.min(v,$.x),E=Math.min(E,$.y),S=Math.max(S,$.x),M=Math.max(M,$.y);const D=Math.max(S-v,M-E),O=Math.max(0,Math.floor(-Math.log2(D))),N=Math.pow(2,O);let V=Math.floor((v+S)/2*N);return V>1&&(V-=1),new sl(O,V,Math.floor((E+M)/2*N))})(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Gs("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Fv||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const K in this.tiles){const ne=this.tiles[K];ne.state!=="loaded"&&(ne.state="loaded",ne.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=$v(new sl(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(K){const ne=K[1].x-K[0].x,ae=K[1].y-K[0].y,ue=K[2].x-K[1].x,Te=K[2].y-K[1].y,_e=K[3].x-K[2].x,Ie=K[3].y-K[2].y,Me=K[0].x-K[3].x,Le=K[0].y-K[3].y,at=ne*Te-ue*ae,Ge=ue*Ie-_e*Te,ut=_e*Le-Me*Ie,gt=Me*ae-ne*Le;return at>0&&Ge>0&&ut>0&&gt>0||at<0&&Ge<0&&ut<0&&gt<0})(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=$v(this.tileID,this.map.transform.projection),[m,_,v,E]=this.coordinates.map((K=>{const ne=h.projection.project(K[0],K[1]);return rI(h,ne)._round()}));this.perspectiveTransform=yI(m.x,m.y,_.x,_.y,v.x,v.y,E.x,E.y);const S=this._boundsArray=new Mh;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(_.x,_.y,Nt,0),S.emplaceBack(E.x,E.y,0,Nt),S.emplaceBack(v.x,v.y,Nt,Nt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,Ow.members),this.boundsSegments=Lr.simpleSegment(0,0,4,2);const M=[],D=[nb((O=this.coordinates)[0]),nb(O[1]),nb(O[2]),nb(O[3])];var O;const[N,V,$,Z]=(function(K){let ne=K[0][0],ae=ne,ue=K[0][1],Te=ue;for(let _e=1;_e<K.length;_e++)K[_e][0]<ne?ne=K[_e][0]:K[_e][0]>ae&&(ae=K[_e][0]),K[_e][1]<ue?ue=K[_e][1]:K[_e][1]>Te&&(Te=K[_e][1]);return[ne,ue,ae-ne,Te-ue]})(D);{const K=new Mh,[ne,ae,ue,Te]=(function(vt){let Mt=vt[0].x,ot=Mt,et=vt[0].y,It=et;for(let Vt=1;Vt<vt.length;Vt++)vt[Vt].x<Mt?Mt=vt[Vt].x:vt[Vt].x>ot&&(ot=vt[Vt].x),vt[Vt].y<et?et=vt[Vt].y:vt[Vt].y>It&&(It=vt[Vt].y);return[Mt,et,ot-Mt,It-et]})(a),_e=vt=>[(vt.x-ne)/ue,(vt.y-ae)/Te],[Ie,Me,Le,at]=a.map(_e),Ge=(function(vt,Mt,ot,et,It,Vt,bt,li){const fi=ib(0,0,1,0,1,1,0,1);return He(fi,fi,be([],ib(vt,Mt,ot,et,It,Vt,bt,li)))})(Ie[0],Ie[1],Me[0],Me[1],Le[0],Le[1],at[0],at[1]);this.elevatedGlobePerspectiveTransform=yI(Ie[0],Ie[1],Me[0],Me[1],Le[0],Le[1],at[0],at[1]);const ut=(vt,Mt)=>{M.push(vt.lng);const ot=Math.round((vt.lng-N)/$*Nt),et=Math.round((vt.lat-V)/Z*Nt),It=_e(Mt),Vt=ps([],[It[0],It[1],1],Ge),bt=Math.round(Vt[0]/Vt[2]*Nt),li=Math.round(Vt[1]/Vt[2]*Nt);K.emplaceBack(ot,et,bt,li)},gt=a[3].x-a[0].x,Et=a[3].y-a[0].y,jt=a[2].x-a[1].x,Dt=a[2].y-a[1].y;for(let vt=0;vt<65;vt++){const Mt=vt/64,ot=[a[0].x+Mt*gt,a[0].y+Mt*Et],et=[a[1].x+Mt*jt,a[1].y+Mt*Dt],It=et[0]-ot[0],Vt=et[1]-ot[1];for(let bt=0;bt<65;bt++){const li=bt/64,fi={x:ot[0]+It*li,y:ot[1]+Vt*li};ut(i.projection.unproject(fi.x,fi.y),fi)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(K,Ow.members)}{this.maxLongitudeTriangleSize=0;let K=[],ne=new Cr;const ae=(ue,Te,_e)=>{ne.emplaceBack(ue,Te,_e);const Ie=M[ue],Me=M[Te],Le=M[_e],at=Math.min(Math.min(Ie,Me),Le),Ge=Math.max(Math.max(Ie,Me),Le)-at;Ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ge),K.push(at+Ge/2)};for(let ue=0;ue<64;ue++)for(let Te=0;Te<64;Te++){const _e=65*ue+Te,Ie=_e+1,Me=_e+65,Le=Me+1;ae(_e,Me,Ie),ae(Ie,Me,Le)}[K,ne]=(function(ue,Te){const _e=Array.from({length:ue.length},((Le,at)=>at));_e.sort(((Le,at)=>ue[Le]-ue[at]));const Ie=[],Me=new Cr;for(let Le=0;Le<_e.length;Le++){const at=_e[Le];Ie.push(ue[at]);const Ge=3*at,ut=Ge+1;Me.emplaceBack(Te.uint16[Ge],Te.uint16[ut],Te.uint16[ut+1])}return[Ie,Me]})(K,ne),this.elevatedGlobeTrianglesCenterLongitudes=K,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ne)}this.elevatedGlobeSegments=Lr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,$/Nt,0,Z/Nt,0,0,V,N,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof Fv||(this.texture?this.texture.update(this.image):(this.texture=new sw(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let h=(m=e+180)+360*Math.round((a[0]-m)/360);var m;const _=new Lr,v=(D,O)=>{_.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:i.segments[0].vertexLength,primitiveLength:O,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-h)<=E){const D=dn(a,0,a.length,h+E);return D===a.length||v(D,Hn(a,D+1,a.length,h+360-E)-D),_}h<a[0]&&(h+=360);const S=Hn(a,0,a.length,h-E);if(S===a.length)return v(0,a.length),_;v(0,S-0);const M=dn(a,S+1,a.length,h+E);return M!==a.length&&v(M,a.length-M),_}}const zk=(Math.pow(256,2)-1)/16907520;class xI extends Eo{constructor(e,i,a,h){super(e,{layout:gI||(gI=new rs({visibility:new kt(Ue.layout_raster.visibility)})),paint:_I||(_I=new rs({"raster-opacity":new kt(Ue.paint_raster["raster-opacity"]),"raster-color":new Eh(Ue.paint_raster["raster-color"]),"raster-color-mix":new kt(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new kt(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new kt(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new kt(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new kt(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new kt(Ue.paint_raster["raster-saturation"]),"raster-contrast":new kt(Ue.paint_raster["raster-contrast"]),"raster-resampling":new kt(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new kt(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new kt(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new kt(Ue.paint_raster["raster-array-band"]),"raster-elevation":new kt(Ue.paint_raster["raster-elevation"]),"raster-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof vI&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(h)||a===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Wf({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,h])}}let bI,wI,TI,EI,SI;class AI extends Eo{constructor(e,i,a,h){super(e,{layout:bI||(bI=new rs({visibility:new kt(Ue["layout_raster-particle"].visibility)})),paint:wI||(wI=new rs({"raster-particle-array-band":new kt(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new kt(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Eh(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new kt(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new kt(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new kt(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new kt(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new kt(Ue["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},i,a,h),this._updateColorRamp(),this.lastInvalidatedAt=Qs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Wf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class kk extends Eo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Lw(r,e,i){const a=[0,0,1],h=Kn([]);return Uo(h,h,i?-gn(r)+Math.PI:gn(r)),uo(h,h,-gn(e)),rr(a,a,h),Ki(a,a)}const II={None:0,Model:1,Symbol:2,FillExtrusion:4};class rb{constructor(e,i,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function zw(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class CI{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class RI{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Xp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let h=Math.floor(a[i+2]);const m=1.05*(a[i+2]-h);return h/=100,[a[i]%1*1.05,a[i+1]%1*1.05,m,h]}tileCoordinatesForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let h=a[i+0];return h=h>Nt?h-Nt:h,new St(Math.trunc(h),Math.trunc(a[i+1]))}translationForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+4],a[i+5],a[i+6]]}rotationScaleForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+10],a[i+11],a[i+12],a[i+13],a[i+14],a[i+15]]}transformForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+4],a[i+10],a[i+11],a[i+12],a[i+5],a[i+13],a[i+14],a[i+15],a[i+6],0,0,0,1]}}class kw{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,h){}populate(e,i,a,h){this.tileToMeter=Se(a);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:v,index:E,sourceLayerIndex:S}of e){const M=v??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),D=Ke(_,m);if(!this.layers[0]._featureFilter.filter(new Yn(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),D,a))continue;const O={id:M,sourceLayerIndex:S,index:E,geometry:m?D.geometry:dt(_,a,h),properties:_.properties,type:_.type,patterns:{}},N=this.addFeature(O,O.geometry,D);N&&i.featureIndex.insert(_,O.geometry,E,S,this.index,this.instancesPerModel[N].instancedDataArray.length,Nt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let a=0;for(const h of this.modelUris){const m=e.getModel(h,i);if(!m)continue;const _=this.instancesPerModel[h];if(_){const v=.5*ln(m.aabb.max,m.aabb.min)*_.maxScale+_.maxXYTranslationDistance,E=Math.min(Nt,Math.max(v/this.tileToMeter,Nt/32));a=Math.max(E,a)}}return a}update(e,i,a,h){for(const m in this.instancesPerModel){const _=this.instancesPerModel[m];for(const v in e)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],e[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const h of a.features){const m=this.layers[0],_=h.feature,v=this.canonical,E=m.paint.get("model-rotation").evaluate(_,{},v),S=m.paint.get("model-scale").evaluate(_,{},v),M=m.paint.get("model-translation").evaluate(_,{},v);Us(h.rotation,E)&&Us(h.scale,S)&&Us(h.translation,M)||(this.evaluate(h,h.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const m=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Bg(this.activeReplacements,m))return!1;this.activeReplacements=m;let _=!1;for(const v in this.instancesPerModel){const E=this.instancesPerModel[v],S=E.instancedDataArray;for(const M of E.features){const D=M.instancedDataOffset,O=M.instancedDataCount;for(let N=0;N<O;N++){const V=16*(N+D);let $=S.float32[V+0];const Z=$>Nt;$=Z?$-Nt:$;const K=Math.floor($),ne=Math.floor(S.float32[V+1]);let ae=!1;for(const ue of this.activeReplacements)if(!Fg(ue,a,II.Model,h)&&!(ue.min.x>K||K>ue.max.x||ue.min.y>ne||ne>ue.max.y)&&(ae=Cv(ty(K,ne,e.canonical,ue.footprintTileId.canonical),ue.footprint),ae))break;S.float32[V]=ae?$+Nt:$,_=_||ae!==Z}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,cz.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const h=this.layers[0],m=h.layout.get("model-id").evaluate(a,{},this.canonical);if(!m)return gi(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),m;(zw(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new RI);const _=this.instancesPerModel[m],v=_.instancedDataArray,E=new CI(a,v.length);for(const S of i)for(const M of S){if(M.x<0||M.x>=Nt||M.y<0||M.y>=Nt)continue;if(this.lookupDim!==0){const O=(this.lookupDim-1)/Nt,N=this.lookupDim*(M.y*O|0)+M.x*O|0;if(this.lookup){if(this.lookup[N]!==0)continue;this.lookup[N]=1}}this.instanceCount++;const D=v.length;v.resize(D+1),_.instancesEvaluatedElevation.push(0),v.float32[16*D]=M.x,v.float32[16*D+1]=M.y}return E.instancedDataCount=_.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(_.idToFeaturesIndex[e.id]=_.features.length),_.features.push(E),this.evaluate(E,{},_,!1)),m}getModelUris(){return this.modelUris}evaluate(e,i,a,h){const m=this.layers[0],_=e.feature,v=this.canonical,E=e.rotation=m.paint.get("model-rotation").evaluate(_,i,v),S=e.scale=m.paint.get("model-scale").evaluate(_,i,v),M=e.translation=m.paint.get("model-translation").evaluate(_,i,v),D=Object.assign({},m.paint.get("model-color").evaluate(_,i,v));D.a=m.paint.get("model-color-mix-intensity").evaluate(_,i,v);const O=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]);const N=M[0]*M[0]+M[1]*M[1],V=N>0?Math.sqrt(N):0;a.maxScale=Math.max(Math.max(a.maxScale,S[0]),Math.max(S[1],S[2])),a.maxXYTranslationDistance=Math.max(a.maxXYTranslationDistance,V),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),rA(O,E,S);const $=Math.round(100*D.a)+D.b/1.05;for(let Z=0;Z<e.instancedDataCount;++Z){const K=e.instancedDataOffset+Z,ne=16*K,ae=a.instancedDataArray.float32;let ue=0;h&&(ue=ae[ne+6]-a.instancesEvaluatedElevation[K]);const Te=0|ae[ne+1];ae[ne]=(0|ae[ne])+D.r/1.05,ae[ne+1]=Te+D.g/1.05,ae[ne+2]=$,ae[ne+3]=1/(v.z>10?this.tileToMeter:Se(v,Te)),ae[ne+4]=M[0],ae[ne+5]=M[1],ae[ne+6]=M[2]+ue,ae[ne+7]=O[0],ae[ne+8]=O[1],ae[ne+9]=O[2],ae[ne+10]=O[4],ae[ne+11]=O[5],ae[ne+12]=O[6],ae[ne+13]=O[8],ae[ne+14]=O[9],ae[ne+15]=O[10],a.instancesEvaluatedElevation[K]=M[2]}}}let MI,DI;Lt(kw,"ModelBucket",{omit:["layers"]}),Lt(RI,"PerModelAttributes"),Lt(CI,"ModelFeature");class my{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const h=a||e.findDEMTileFor(i);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,v=1<<i.canonical.z-_.canonical.z;return new my(h,m.dim/Nt/v,[(i.canonical.x/v-_.canonical.x)*m.dim,(i.canonical.y/v-_.canonical.y)*m.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1];return new St(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,i,a,h){const m=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],v=Math.floor(m),E=Math.floor(_),S=this._dem;return h=!!h,a?Oi(Oi(S.get(v,E,h),S.get(v,E+1,h),_-E),Oi(S.get(v+1,E,h),S.get(v+1,E+1,h),_-E),m-v):S.get(v,E,h)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*re(1,e)*this._dem.stride}}const Fw=new Float32Array(262144),Yg=new Uint8Array(262144);function PI(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,PI(i));return e}function OI(r,e,i){if(r.meshes)for(const a of r.meshes){if(a.aabb.min[0]===1/0)continue;const h=nn.applyTransform(a.aabb,r.globalMatrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(r.children)for(const a of r.children)OI(a,e,i)}const LI=["","wall","door","roof","window","lamp","logo"];class zI{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:PI(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new nn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=nn.applyTransformFast(a.aabb,this.node.globalMatrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class sb{constructor(e,i,a,h,m,_,v,E){this.id=a,this.layers=e,this.layerIds=this.layers.map((S=>S.fqid)),this.stateDependentLayerIds=this.layers.filter((S=>S.isStateDependent())).map((S=>S.id)),this.modelTraits|=oy.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=oy.HasMapboxMeshFeatures),m&&(this.modelTraits|=oy.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of i)this.nodesInfo.push(new zI(S)),OI(S,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const a of this.getNodesInfo()){const h=a.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}updateAppearances(e,i,a,h){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!Fl(e,this.states))for(const h of a)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const h=a.node;this.uploaded?this.updatePbrBuffer(h):lw(h,e,!0)}for(const a of i)Vx(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const h=e.transform.projectionOptions,m=e.style.getBrightness(),_=this.brightness!==m;if(!this.uploaded||this.dirty||h.name!==this.projection.name||e0(a.paint.get("model-color").value,_)||e0(a.paint.get("model-color-mix-intensity").value,_)||e0(a.paint.get("model-roughness").value,_)||e0(a.paint.get("model-emissive-strength").value,_)||e0(a.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=h,this.brightness=m;const v=this.getNodesInfo();for(const E of v)E.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),h=this.id.canonical;for(const m of a){const _=m.feature;m.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,{},h),m.evaluatedScale=i.paint.get("model-scale").evaluate(_,{},h)}}evaluate(e,i){const a=this.getNodesInfo();for(const h of a){if(!h.node.meshes)continue;const m=h.feature,_=i&&i[m.id];if(Fl(_,h.state))continue;h.state=structuredClone(_);const v=h.node.meshes&&h.node.meshes[0].featureData,E=h.evaluatedColor[2],S=h.evaluatedRMEA[2],M=this.id.canonical;if(h.hasTranslucentParts=!1,v){for(let D=0;D<LI.length;D++){const O=LI[D];O.length&&(m.properties.part=O);const N=e.paint.get("model-color").evaluate(m,_,M).toPremultipliedRenderColor(null),V=e.paint.get("model-color-mix-intensity").evaluate(m,_,M);h.evaluatedColor[D]=[N.r,N.g,N.b,V],h.evaluatedRMEA[D][0]=e.paint.get("model-roughness").evaluate(m,_,M),h.evaluatedRMEA[D][2]=e.paint.get("model-emissive-strength").evaluate(m,_,M),h.evaluatedRMEA[D][3]=N.a,h.emissionHeightBasedParams[D]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,_,M),!h.hasTranslucentParts&&N.a<1&&(h.hasTranslucentParts=!0)}delete m.properties.part,Bk(h,E!==h.evaluatedColor[2]||S!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,_,M);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,_,M),h.evaluatedScale=e.paint.get("model-scale").evaluate(m,_,M),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,h){const m=e.findDEMTileFor(a);if(m&&(m.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const _=my.create(e,a,m);if(!_)return;this.modelTraits&oy.HasMapboxMeshFeatures&&this.updateDEM(e,_,a,h);for(const v of this.getNodesInfo()){const E=v.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const S=E.footprint.vertices;let M=_.getElevationAt(S[0].x,S[0].y,!0,!0);for(let D=1;D<S.length;D++)M=Math.min(M,_.getElevationAt(S[D].x,S[D].y,!0,!0));E.elevation=M}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,h){let m=i._dem._modifiedForSources[h];if(m===void 0&&(i._dem._modifiedForSources[h]=[],m=i._dem._modifiedForSources[h]),m.includes(a.canonical))return;const _=i._dem.dim;m.push(a.canonical);let v=!1;for(const E of this.getNodesInfo()){const S=E.node;if(!S.footprint||!S.footprint.grid)continue;const M=S.footprint.grid,D=i.tileCoordToPixel(M.min.x,M.min.y),O=i.tileCoordToPixel(M.max.x,M.max.y),N=Math.min(Math.min(_-O.y,D.x),Math.min(D.y,_-O.x));if(N<0)continue;const V=J(N,2,5);let $=Math.max(0,D.x-V),Z=Math.max(0,D.y-V),K=Math.min(O.x+V,_-1),ne=Math.min(O.y+V,_-1);for(let _e=Z;_e<=ne;++_e)for(let Ie=$;Ie<=K;++Ie)Yg[_e*_+Ie]=255;let ae=0,ue=0;for(let _e=0;_e<M.cellsY;++_e)for(let Ie=0;Ie<M.cellsX;++Ie){if(!M.cells[_e*M.cellsX+Ie])continue;const Me=i.tileCoordToPixel(M.min.x+Ie/M.xScale,M.min.y+_e/M.yScale),Le=i.tileCoordToPixel(M.min.x+(Ie+1)/M.xScale,M.min.y+(_e+1)/M.yScale);for(let at=Me.y;at<=Math.min(Le.y+1,_-1);++at)for(let Ge=Me.x;Ge<=Math.min(Le.x+1,_-1);++Ge)Yg[at*_+Ge]===255&&(Yg[at*_+Ge]=0,ae+=i.getElevationAtPixel(Ge,at),ue++)}const Te=ae/ue;$=Math.max(1,D.x-V),Z=Math.max(1,D.y-V),K=Math.min(O.x+V,_-2),ne=Math.min(O.y+V,_-2),v=!0;for(let _e=Z;_e<=ne;++_e)for(let Ie=$;Ie<=K;++Ie)Yg[_e*_+Ie]===0&&(Fw[_e*_+Ie]=i._dem.set(Ie,_e,Te));for(let _e=1;_e<V;++_e){$=Math.max(1,D.x-_e),Z=Math.max(1,D.y-_e),K=Math.min(O.x+_e,_-2),ne=Math.min(O.y+_e,_-2);for(let Ie=Z;Ie<=ne;++Ie)for(let Me=$;Me<=K;++Me){const Le=Ie*_+Me;if(Yg[Le]===255){let at=0,Ge=0,ut=-1,gt=-1;for(let Et=-1;Et<=1;++Et)for(let jt=-1;jt<=1;++jt){const Dt=(Ie+Et)*_+Me+jt;if(Yg[Dt]>=_e)continue;const vt=Fw[Dt],Mt=Math.abs(vt);Mt>Ge&&(at=vt,Ge=Mt,ut=jt,gt=Et)}if(Ge>.1){const Et=1-(_e+.5*Math.abs(ut*gt))/V;let jt=i._dem.get(Me,Ie)+at*Et;const Dt=i._dem.get(Me+ut,Ie+gt),vt=i._dem.get(Me-ut,Ie-gt,!0);(jt-Dt)*(jt-vt)>0&&(jt=(Dt+vt)/2),Fw[Le]=i._dem.set(Me,Ie,jt),Yg[Le]=_e}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Qs.now())}setFilter(e){this.filter=e?Of(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Yn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Vx(i.node),cw(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const m=h.node.footprint;h.hiddenByReplacement=!!m&&!a.find((_=>_.footprint===m))}}getHeightAtTileCoord(e,i){const a=[],h=[0,0,0],m=Ze([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],E=v.transformedAabb;if(e<E.min[0]||i<E.min[1]||e>E.max[0]||i>E.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};Pt(m,_.node.globalMatrix),h[0]=e,h[1]=i,nr(h,h,m);const S=(h[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*Zg|0,M=Math.min(63,(h[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*Zg|0)*Zg+Math.min(63,S),D=v.heightmap[M];if(!(D<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:D,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new St(e,i),new St(e,i),a),a.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function e0(r,e){return r instanceof Zo&&!r.isLightConstant&&e}function Fk(r,e,i,a,h,m,_,v){let E=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(E=Oi(E,255*i[0],i[3]),S=Oi(S,255*i[1],i[3]),M=Oi(M,255*i[2],i[3]));const D=E<<8|S,O=M<<8|Math.floor(255*a[3]),N=(function(_e){const Ie=J(_e,0,2);return Math.min(Math.round(.5*Ie*255),255)})(a[2])<<8|15*a[0]<<4|15*a[1],V=J(h[0],0,1),$=J(h[1],0,1),Z=J(h[2],0,1),K=J(h[3],0,1);let ne,ae,ue,Te;if(V!==$&&_!==m&&$!==V){const _e=_-m;ae=1/(_e*($-V)),ue=-(m+_e*V)/(_e*($-V));const Ie=J(h[4],-1,1);Te=Math.pow(10,Ie),ne=255*Z<<8|255*K}else ne=65535,ae=0,ue=1,Te=1;if(r.emplaceBack(D,O,N,ne,ae,ue,Te),v){const _e=v.length;v.clear();for(let Ie=0;Ie<_e;Ie++)v.emplaceBack(D,O,N,ne,ae,ue,Te)}}function Bk(r,e,i){const a=r.node;let h=0;const m=i&oy.HasMeshoptCompression;for(const _ of a.meshes){if(a.lights&&a.lightMeshIndex===h||!_.featureData)continue;_.featureArray=new qu,_.featureArray.reserve(_.featureData.length);let v=e;for(const E of _.featureData){const S=m?65535&E:E>>16&65535,M=m?E>>16&65535:65535&E,D=(15&M)<8?15&M:0,O=r.evaluatedRMEA[D],N=r.evaluatedColor[D],V=r.emissionHeightBasedParams[D];let $;if(v&&D===2&&a.lights&&($=new qu,$.resize(10*a.lights.length)),Fk(_.featureArray,S,N,O,V,_.aabb.min[2],_.aabb.max[2],$),$&&v){v=!1;const Z=a.meshes[a.lightMeshIndex];Z.featureArray=$,Z.featureArray._trim()}}_.featureArray._trim(),h++}}Lt(sb,"Tiled3dModelBucket",{omit:["layers"]}),Lt(zI,"Tiled3dModelFeature");const Nk=["id","tile","layer","source","sourceLayer","state"];class Qg{constructor(e,i,a,h,m){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=h,this.properties=e?e.properties:{},this.id=m}clone(){const e=new Qg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of Nk)this[i]!==void 0&&(e[i]=this[i]);return e}}class Jg extends fl{constructor(e,i,a,h){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const a=this._options.models[i],h=this._modelsInfo.get(i);if(h){const m=h.model;m.position=a.position!=null?new U(a.position[0],a.position[1]):new U(0,0),m.orientation=a.orientation!=null?a.orientation:[0,0,0],h.modelSpec=a,Jg.applyModelSpecification(m,a),m.computeBoundsAndApplyParent(),this.models.push(m)}else{const m=eA(this.map._requestManager.transformRequest(a.uri,Ho.Model).url).then((_=>{if(!_)return;const v=hw(_),E=new sA(i,a.uri,a.position,a.orientation,v);Jg.applyModelSpecification(E,a),E.computeBoundsAndApplyParent(),this.models.push(E),this._modelsInfo.set(i,{modelSpec:a,model:E})})).catch((_=>{this.fire(new uc(new Error(`Could not load model ${i} from ${a.uri}: ${_.message}`)))}));e.push(m)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new Gs("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((i=>{this._loaded=!0,this.fire(new uc(new Error(`Could not load models: ${i.message}`)))}))}static applyModelSpecification(e,i){i.nodeOverrides&&Jg.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&Jg.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every((a=>typeof a=="string"))){e.nodeOverrideNames=[];for(const a of i)e.nodeOverrideNames.push(a)}else Object.entries(i).forEach((([a,h])=>{const m={orientation:[0,0,0]};if(h.hasOwnProperty("orientation")){const _=h.orientation;_&&(m.orientation=_)}e.nodeOverrides.set(a,m)}))}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every((a=>typeof a=="string"))){e.materialOverrideNames=[];for(const a of i)e.materialOverrideNames.push(a)}else Object.entries(i).forEach((([a,h])=>{const m={color:new On(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=h["model-color"];_!==void 0&&(m.color.r=_[0],m.color.g=_[1],m.color.b=_[2]);const v=h["model-color-mix-intensity"];v!==void 0&&(m.colorMix=v);const E=h["model-emissive-strength"];E!==void 0&&(m.emissionStrength=E);const S=h["model-opacity"];S!==void 0&&(m.opacity=S),e.materialOverrides.set(a,m)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=Rh(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const a in e){const h=e[a];if(this._modelsInfo.has(a)){const m=this._modelsInfo.get(a);m&&m.modelSpec.uri===h.uri&&i.set(a,m)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function Bw(r,e,i,a){const h=1<<r.z;e.lat=le((a/Nt+r.y)/h),e.lng=he((i/Nt+r.x)/h)}function Vk(r,e,i,a){const h=r.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let m=Number.MAX_VALUE;const _=h.node,v=i.tile,E=a.calculatePosMatrix(v.tileID.toUnwrapped(),a.worldSize),S=h.evaluatedScale;let M=0;a.elevation&&_.elevation&&(M=_.elevation*a.elevation.exaggeration()),Gt(E,E,[(_.anchor?_.anchor[0]:0)*(S[0]-1),(_.anchor?_.anchor[1]:0)*(S[1]-1),M]),ei(E,E,S);const D=i.queryGeometry,O=D.isPointQuery()?D.screenBounds:D.screenGeometry,N=function($){const Z=ct([],E,$.globalMatrix);ct(Z,a.expandedFarZProjMatrix,Z);for(let K=0;K<$.meshes.length;++K){const ne=$.meshes[K];if(K===$.lightMeshIndex)continue;const ae=aw(O,a,Z,ne.aabb);ae!=null&&(m=Math.min(ae,m))}if($.children)for(const K of $.children)N(K)};if(N(_),m===Number.MAX_VALUE)return;const V=new U(0,0);return Bw(v.tileID.canonical,V,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:m,position:V,feature:h.feature}}const Uk={circle:class extends Eo{constructor(r,e,i,a){super(r,{layout:Sl||(Sl=new rs({"circle-sort-key":new ti(Ue.layout_circle["circle-sort-key"]),"circle-elevation-reference":new kt(Ue.layout_circle["circle-elevation-reference"]),visibility:new kt(Ue.layout_circle.visibility)})),paint:$u||($u=new rs({"circle-radius":new ti(Ue.paint_circle["circle-radius"]),"circle-color":new ti(Ue.paint_circle["circle-color"]),"circle-blur":new ti(Ue.paint_circle["circle-blur"]),"circle-opacity":new ti(Ue.paint_circle["circle-opacity"]),"circle-translate":new kt(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new kt(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new kt(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new kt(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ti(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ti(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ti(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new kt(Ue.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(r){return new br(r)}queryRadius(r){const e=r;return Ws("circle-radius",this,e)+Ws("circle-stroke-width",this,e)+$r(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,a,h,m,_,v){const E=Bh(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return q_(r,a,m,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const a=ux(this);return{config:new Jl(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Eo{createBucket(r){return new H_(r)}constructor(r,e,i,a){super(r,{layout:dx||(dx=new rs({visibility:new kt(Ue.layout_heatmap.visibility)})),paint:fx||(fx=new rs({"heatmap-radius":new ti(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ti(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new kt(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eh(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new kt(Ue.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return Ws("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,a,h,m,_,v){const E=this.paint.get("heatmap-radius").evaluate(e,i);return q_(r,a,m,_,v,!0,!0,new St(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new Jl(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Eo{constructor(r,e,i,a){super(r,{layout:om||(om=new rs({visibility:new kt(Ue.layout_hillshade.visibility)})),paint:px||(px=new rs({"hillshade-illumination-direction":new kt(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new kt(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new kt(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new kt(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new kt(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new kt(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new kt(Ue.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends Eo{constructor(r,e,i,a){super(r,{layout:Xf||(Xf=new rs({"fill-sort-key":new ti(Ue.layout_fill["fill-sort-key"]),visibility:new kt(Ue.layout_fill.visibility),"fill-elevation-reference":new kt(Ue.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new ti(Ue.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Sv||(Sv=new rs({"fill-antialias":new kt(Ue.paint_fill["fill-antialias"]),"fill-opacity":new ti(Ue.paint_fill["fill-opacity"]),"fill-color":new ti(Ue.paint_fill["fill-color"]),"fill-outline-color":new ti(Ue.paint_fill["fill-outline-color"]),"fill-translate":new kt(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new kt(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new ti(Ue.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new kt(Ue.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new kt(Ue.paint_fill["fill-emissive-strength"]),"fill-z-offset":new ti(Ue.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new ti(Ue.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new ti(Ue.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new Jl(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Ev(r)}queryRadius(){return $r(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,a,h,m){return!r.queryGeometry.isAboveHorizon&&qr(ja(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Eo{constructor(r,e,i,a){super(r,{layout:qg||(qg=new rs({visibility:new kt(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new kt(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Ov||(Ov=new rs({"fill-extrusion-opacity":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new ti(Ue["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new uu(r)}queryRadius(){return $r(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,a,h,m,_,v,E){const S=Bh(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),D=this.paint.get("fill-extrusion-base").evaluate(e,i),O=[0,0],N=v&&m.elevation,V=m.elevation?m.elevation.exaggeration():1,$=r.tile.getBucket(this);if(N&&$ instanceof uu){const ue=$.centroidVertexArray,Te=E+1;Te<ue.length&&(O[0]=ue.geta_centroid_pos0(Te),O[1]=ue.geta_centroid_pos1(Te))}if(O[0]===0&&O[1]===1)return!1;m.projection.name==="globe"&&(a=Dx([a],[new St(0,0),new St(Nt,Nt)],r.tileID.canonical).map((ue=>ue.polygon)).flat());const Z=N?v:null,[K,ne]=Wg(m,a,D,M,S,_,Z,O,V,m.center.lat,r.tileID.canonical),ae=r.queryGeometry;return Lx(K,ne,ae.isPointQuery()?ae.screenBounds:ae.screenGeometry)}},building:class extends Eo{constructor(r,e,i,a){super(r,{layout:fA||(fA=new rs({visibility:new kt(Ue.layout_building.visibility),"building-facade":new ti(Ue.layout_building["building-facade"]),"building-facade-floors":new ti(Ue.layout_building["building-facade-floors"]),"building-facade-unit-width":new ti(Ue.layout_building["building-facade-unit-width"]),"building-facade-window":new ti(Ue.layout_building["building-facade-window"]),"building-roof-shape":new ti(Ue.layout_building["building-roof-shape"]),"building-height":new ti(Ue.layout_building["building-height"]),"building-base":new ti(Ue.layout_building["building-base"]),"building-flood-light-wall-radius":new ti(Ue.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new ti(Ue.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new ti(Ue.layout_building["building-flip-roof-orientation"])})),paint:pA||(pA=new rs({"building-opacity":new kt(Ue.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new kt(Ue.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new kt(Ue.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new kt(Ue.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new kt(Ue.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new kt(Ue.paint_building["building-vertical-scale"]),"building-cast-shadows":new kt(Ue.paint_building["building-cast-shadows"]),"building-color":new ti(Ue.paint_building["building-color"]),"building-emissive-strength":new ti(Ue.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new kt(Ue.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new kt(Ue.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new kt(Ue.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new kt(Ue.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new kt(Ue.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new dA(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,i,a,h,m,_,v,E){let S=this.layout.get("building-height").evaluate(e,i);const M=this.layout.get("building-base").evaluate(e,i),D=r.tile.getBucket(this).getFootprint(e);if(D){if(D.hiddenFlags!==0)return!1;S=D.height}const[O,N]=Wg(m,a,M,S,new St(0,0),_,null,[0,0],1,m.center.lat,r.tileID.canonical),V=r.queryGeometry;return Lx(O,N,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends Eo{constructor(r,e,i,a){const h=EA();super(r,h,e,i,a),h.layout&&(this.layout=new Bu(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Xl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Nv)return Nv;const i=EA();return Nv=new Fz(i.paint.properties["line-width"].specification),Nv.useIntegerZoom=!0,Nv})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new fw(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const a=wA(this);return{config:new Jl(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(r){const e=r,i=SA(Ws("line-width",this,e),Ws("line-gap-width",this,e)),a=Ws("line-offset",this,e);return i/2+Math.abs(a)+$r(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,a,h,m){if(r.queryGeometry.isAboveHorizon)return!1;const _=ja(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,r.pixelToTileUnitsFactor),v=r.pixelToTileUnitsFactor/2*SA(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),E=this.paint.get("line-offset").evaluate(e,i);return E&&(a=(function(S,M){const D=[],O=new St(0,0);for(let N=0;N<S.length;N++){const V=S[N],$=[];for(let Z=0;Z<V.length;Z++){const K=V[Z],ne=V[Z+1],ae=Z===0?O:K.sub(V[Z-1])._unit()._perp(),ue=Z===V.length-1?O:ne.sub(K)._unit()._perp(),Te=ae._add(ue)._unit();Te._mult(1/(Te.x*ue.x+Te.y*ue.y)),$.push(Te._mult(M)._add(K))}D.push($)}return D})(a,E*r.pixelToTileUnitsFactor)),(function(S,M,D){for(let O=0;O<M.length;O++){const N=M[O];if(S.length>=3){for(let V=0;V<N.length;V++)if(oo(S,N[V]))return!0}if(ca(S,N,D))return!0}return!1})(_,a,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:tb,background:class extends Eo{constructor(r,e,i,a){super(r,{layout:pI||(pI=new rs({visibility:new kt(Ue.layout_background.visibility)})),paint:mI||(mI=new rs({"background-pitch-alignment":new kt(Ue.paint_background["background-pitch-alignment"]),"background-color":new kt(Ue.paint_background["background-color"]),"background-pattern":new kt(Ue.paint_background["background-pattern"]),"background-opacity":new kt(Ue.paint_background["background-opacity"]),"background-emissive-strength":new kt(Ue.paint_background["background-emissive-strength"]),"background-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:xI,"raster-particle":AI,sky:class extends Eo{constructor(r,e,i,a){super(r,{layout:TI||(TI=new rs({visibility:new kt(Ue.layout_sky.visibility)})),paint:EI||(EI=new rs({"sky-type":new kt(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new kt(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new kt(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new kt(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new kt(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new Eh(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new kt(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new kt(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new kt(Ue.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Wf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),h=!a,m=r.style.light,_=m.properties.get("position");return h&&m.properties.get("anchor")==="viewport"&&gi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Lw(_.azimuthal,90-_.polar,e):Lw(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return Lw(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Eo{constructor(r,e,i,a){super(r,{paint:SI||(SI=new rs({}))},e,null)}},model:class extends Eo{constructor(r,e,i,a){super(r,{layout:MI||(MI=new rs({visibility:new kt(Ue.layout_model.visibility),"model-id":new ti(Ue.layout_model["model-id"])})),paint:DI||(DI=new rs({"model-opacity":new ti(Ue.paint_model["model-opacity"]),"model-rotation":new ti(Ue.paint_model["model-rotation"]),"model-scale":new ti(Ue.paint_model["model-scale"]),"model-translation":new ti(Ue.paint_model["model-translation"]),"model-color":new ti(Ue.paint_model["model-color"]),"model-color-mix-intensity":new ti(Ue.paint_model["model-color-mix-intensity"]),"model-type":new kt(Ue.paint_model["model-type"]),"model-cast-shadows":new kt(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new kt(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new kt(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ti(Ue.paint_model["model-emissive-strength"]),"model-roughness":new ti(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ti(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new kt(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new kt(Ue.paint_model["model-front-cutoff"]),"model-elevation-reference":new kt(Ue.paint_model["model-elevation-reference"]),"model-color-use-theme":new ti({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new kw(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof sb?Nt-1:0}queryRenderedFeatures(r,e,i){const a=e.getSource();if(!(a&&a instanceof Jg))return{};const h=a,m={};m[this.id]=[];const _=m[this.id];let v=0;for(const E of h.models){const S=e.getFeatureState(this.sourceLayer,E.id),M={type:"Unknown",id:E.id,properties:E.featureProperties},D=this.paint.get("model-rotation").evaluate(M,S),O=this.paint.get("model-scale").evaluate(M,S),N=this.paint.get("model-translation").evaluate(M,S),V=this.paint.get("model-elevation-reference");let $=[];Nx($,E,i,E.position,D,O,N,V==="ground",V==="ground",!1),i.projection.name==="globe"&&($=Bx($,i));const Z=ct([],i.projMatrix,$),K=aw(r.isPointQuery()?r.screenBounds:r.screenGeometry,i,Z,E.aabb);if(K!=null){const ne=new Qg(void 0,0,0,0,E.id);ne.layer=this.layer,ne.properties=structuredClone(E.featureProperties),ne.properties.layer=this.id,ne.properties.uri=E.uri,ne.properties.orientation=E.orientation,ne.sourceLayer=this.sourceLayer,ne.geometry={type:"Point",coordinates:[E.position.lng,E.position.lat]},ne.state=S,ne.source=this.source,_.push({featureIndex:v,feature:ne,intersectionZ:K})}++v}return m}queryIntersectsFeature(r,e,i,a,h,m){if(!this.modelManager)return!1;const _=this.modelManager,v=r.tile.getBucket(this);if(!(v&&v instanceof kw))return!1;for(const E in v.instancesPerModel){const S=v.instancesPerModel[E],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(M)){const D=S.features[S.idToFeaturesIndex[M]],O=_.getModel(E,this.scope);if(!O)return!1;let N=[];const V=new U(0,0),$=v.canonical;let Z=Number.MAX_VALUE;for(let K=0;K<D.instancedDataCount;++K){const ne=16*(D.instancedDataOffset+K),ae=S.instancedDataArray.float32,ue=[ae[ne+4],ae[ne+5],ae[ne+6]];Bw($,V,Math.floor(ae[ne]),Math.floor(ae[ne+1])),Nx(N,O,m,V,D.rotation,D.scale,ue,!1,!1,!1),m.projection.name==="globe"&&(N=Bx(N,m));const Te=ct([],m.projMatrix,N),_e=r.queryGeometry,Ie=aw(_e.isPointQuery()?_e.screenBounds:_e.screenGeometry,m,Te,O.aabb);Ie!=null&&(Z=Math.min(Ie,Z))}return Z!==Number.MAX_VALUE&&Z}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof To}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Eo{constructor(r,e,i,a){super(r,{layout:bx||(bx=new rs({"clip-layer-types":new kt(Ue.layout_clip["clip-layer-types"]),"clip-layer-scope":new kt(Ue.layout_clip["clip-layer-scope"])})),paint:wx||(wx=new rs({}))},e,i,a)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new Tx(r)}is3D(r){return!0}}},Nw=new On(0,0,0),Vw={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Uw={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},ob={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},jk={PAINT_ORDER_FILL_AND_STROKE:1},t0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},kI={MASK_TYPE_LUMINANCE:1};function Gk(r,e,i){r===1&&e.icons.push((function(a,h){return(function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:_}=m;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=m.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&FI(_,"x"),_.stretch_y&&_.stretch_y.length&&FI(_,"y"),m})(a.readFields(qk,{name:void 0},h))})(i,i.readVarint()+i.pos))}function FI(r,e){const i=[],a=r[`stretch_${e}`];let h=null;for(let m=0;m<a.length;m++)h===null?h=i.length===0?a[0]:i[i.length-1][1]+a[m]:(i.push([h,h+a[m]]),h=null);r[`stretch_${e}_areas`]=i}function qk(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=(function(a,h){return a.readFields(Hk,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=(function(a,h){return a.readFields(Zk,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function Hk(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=BI(i,i.readVarint()+i.pos):r===4?e.variables.push((function(a,h){return a.readFields(Wk,{name:void 0},h)})(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=BI(i,i.readVarint()+i.pos))}function BI(r,e){return r.readFields($k,{},e)}function $k(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function Wk(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=cb(i.readVarint()),e.value="rgb_color")}function Zk(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(ab(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push((function(a,h){return a.readFields(t3,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push((function(a,h){return a.readFields(n3,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push((function(a,h){return a.readFields(r3,{children:[]},h)})(i,i.readVarint()+i.pos)):r===8&&e.masks.push((function(a,h){const m=a.readFields(s3,{left:0,width:20,mask_type:kI.MASK_TYPE_LUMINANCE,children:[]},h);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m})(i,i.readVarint()+i.pos))}function ab(r,e){return r.readFields(Xk,{},e)}function Xk(r,e,i){r===1?(e.group=(function(a,h){return a.readFields(Kk,{opacity:255,children:[]},h)})(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=(function(a,h){return a.readFields(Qk,{paint_order:1,commands:[],step:1,diffs:[],rule:Vw.PATH_RULE_NON_ZERO},h)})(i,i.readVarint()+i.pos),e.node="path")}function Kk(r,e,i){r===1?e.transform=lb(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(ab(i,i.readVarint()+i.pos))}function lb(r,e){return r.readFields(Yk,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function Yk(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function Qk(r,e,i){r===1?e.fill=(function(a,h){return a.readFields(Jk,{rgb_color:Nw,paint:"rgb_color",opacity:255},h)})(i,i.readVarint()+i.pos):r===2?e.stroke=(function(a,h){return a.readFields(e3,{rgb_color:Nw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function Jk(r,e,i){r===1?(e.rgb_color=cb(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function cb(r){return new On((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function e3(r,e,i){r===1?(e.rgb_color=cb(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function t3(r,e,i){r===1?e.transform=lb(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(NI(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function NI(r,e){return r.readFields(i3,{offset:0,opacity:255,rgb_color:Nw},e)}function i3(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=cb(i.readVarint()))}function n3(r,e,i){r===1?e.transform=lb(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(NI(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function r3(r,e,i){r===1?e.transform=lb(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(ab(i,i.readVarint()+i.pos))}function s3(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(ab(i,i.readVarint()+i.pos))}class o3{static calculate(e={},i=[]){const a=new Map,h=new Map;if(Object.keys(e).length===0)return a;i.forEach((m=>{h.set(m.name,m.rgb_color||new On(0,0,0))}));for(const[m,_]of Object.entries(e))h.has(m)?a.set(h.get(m).toString(),_):console.warn(`Ignoring unknown image variable "${m}"`);return a}}function gy(r,e=255,i){const a=e/255,h=r.toString(),m=i.has(h)?i.get(h).clone():r.clone();return m.a*=a,m.toString()}function i0(r,e){if(!Mo()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function a3(r,e){const i=o3.calculate(e.params,r.metadata?r.metadata.variables:[]),a=r.usvg_tree,h=a.width,m=a.height,_=e.transform?e.transform:new DOMMatrix,v=Math.max(1,Math.round(h*_.a)),E=Math.max(1,Math.round(m*_.d)),S=new DOMMatrix([v/h,0,0,E/m,0,0]),M=i0(v,E).getContext("2d");return jw(M,S,a,a,i),M.getImageData(0,0,v,E)}function jw(r,e,i,a,h){for(const m of a.children)VI(r,e,i,m,h)}function VI(r,e,i,a,h){a.group?(r.save(),(function(m,_,v,E,S){const M=E.mask_idx!=null?v.masks[E.mask_idx]:null,D=E.clip_path_idx!=null?v.clip_paths[E.clip_path_idx]:null;if(E.transform&&(_=_y(E.transform).preMultiplySelf(_)),!(function(V,$,Z){return V.opacity!==255||$||Z})(E,D!=null,M!=null))return void jw(m,_,v,E,S);const O=i0(m.canvas.width,m.canvas.height),N=O.getContext("2d");jw(N,_,v,E,S),D&&WI(N,_,v,D),M&&ZI(N,_,v,M,S),m.globalAlpha=E.opacity/255,m.drawImage(O,0,0)})(r,e,i,a.group,h),r.restore()):a.path&&(r.save(),(function(m,_,v,E,S){m.setTransform(_),E.paint_order===jk.PAINT_ORDER_FILL_AND_STROKE?(UI(m,v,E,S),GI(m,v,E,S)):(GI(m,v,E,S),UI(m,v,E,S))})(r,e,i,a.path,h),r.restore())}function UI(r,e,i,a){const h=i.fill;if(!h)return;const m=h.opacity/255;switch(r.save(),r.beginPath(),XI(i,r),h.paint){case"rgb_color":r.fillStyle=gy(h.rgb_color,h.opacity,a);break;case"linear_gradient_idx":{const _=e.linear_gradients[h.linear_gradient_idx];_.transform&&r.setTransform(_y(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=qI(r,_,m,a);break}case"radial_gradient_idx":{const _=e.radial_gradients[h.radial_gradient_idx];_.transform&&r.setTransform(_y(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=HI(r,_,m,a)}}r.fill(jI(i)),r.restore()}function jI(r){return r.rule===Vw.PATH_RULE_NON_ZERO?"nonzero":r.rule===Vw.PATH_RULE_EVEN_ODD?"evenodd":void 0}function GI(r,e,i,a){const h=i.stroke;if(!h)return;const m=KI(i);r.lineWidth=h.width,r.miterLimit=h.miterlimit,r.setLineDash(h.dasharray),r.lineDashOffset=h.dashoffset;const _=h.opacity/255;switch(h.paint){case"rgb_color":r.strokeStyle=gy(h.rgb_color,h.opacity,a);break;case"linear_gradient_idx":r.strokeStyle=qI(r,e.linear_gradients[h.linear_gradient_idx],_,a,!0);break;case"radial_gradient_idx":r.strokeStyle=HI(r,e.radial_gradients[h.radial_gradient_idx],_,a,!0)}switch(h.linejoin){case ob.LINE_JOIN_MITER_CLIP:case ob.LINE_JOIN_MITER:r.lineJoin="miter";break;case ob.LINE_JOIN_ROUND:r.lineJoin="round";break;case ob.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(h.linecap){case Uw.LINE_CAP_BUTT:r.lineCap="butt";break;case Uw.LINE_CAP_ROUND:r.lineCap="round";break;case Uw.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(m)}function qI(r,e,i,a,h=!1){if(e.stops.length===1){const O=e.stops[0];return gy(O.rgb_color,O.opacity*i,a)}const{x1:m,y1:_,x2:v,y2:E}=e;let S=new DOMPoint(m,_),M=new DOMPoint(v,E);if(h){const O=_y(e.transform);S=O.transformPoint(S),M=O.transformPoint(M)}const D=r.createLinearGradient(S.x,S.y,M.x,M.y);for(const O of e.stops)D.addColorStop(O.offset,gy(O.rgb_color,O.opacity*i,a));return D}function HI(r,e,i,a,h=!1){if(e.stops.length===1){const K=e.stops[0];return gy(K.rgb_color,K.opacity*i,a)}const m=_y(e.transform),{fx:_,fy:v,fr:E,cx:S,cy:M,r:D}=e;let O=new DOMPoint(_,v),N=new DOMPoint(S,M),V=E,$=D;if(h){O=m.transformPoint(O),N=m.transformPoint(N);const K=(m.a+m.d)/2;V=E*K,$=e.r*K}const Z=r.createRadialGradient(O.x,O.y,V,N.x,N.y,$);for(const K of e.stops)Z.addColorStop(K.offset,gy(K.rgb_color,K.opacity*i,a));return Z}function $I(r,e,i,a){const h=a.transform?_y(a.transform).preMultiplySelf(e):e,m=i0(r.canvas.width,r.canvas.height),_=m.getContext("2d");for(const E of a.children)if(E.group)$I(_,h,i,E.group);else if(E.path){const S=E.path,M=new Path2D;M.addPath(KI(S),h),_.fill(M,jI(S))}const v=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;v&&WI(_,h,i,v),r.globalCompositeOperation="source-over",r.drawImage(m,0,0)}function WI(r,e,i,a){const h=i0(r.canvas.width,r.canvas.height);$I(h.getContext("2d"),e,i,a),r.globalCompositeOperation="destination-in",r.drawImage(h,0,0)}function ZI(r,e,i,a,h){if(a.children.length===0)return;const m=a.mask_idx!=null?i.masks[a.mask_idx]:null;m&&ZI(r,e,i,m,h);const _=r.canvas.width,v=r.canvas.height,E=i0(_,v),S=E.getContext("2d"),M=a.width,D=a.height,O=a.left,N=a.top,V=new Path2D,$=new Path2D;$.rect(O,N,M,D),V.addPath($,e),S.clip(V);for(const ne of a.children)VI(S,e,i,ne,h);const Z=S.getImageData(0,0,_,v),K=Z.data;if(a.mask_type===kI.MASK_TYPE_LUMINANCE)for(let ne=0;ne<K.length;ne+=4)K[ne+3]=K[ne+3]/255*(.2126*K[ne]+.7152*K[ne+1]+.0722*K[ne+2]);S.putImageData(Z,0,0),r.globalCompositeOperation="destination-in",r.drawImage(E,0,0)}function _y(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function XI(r,e){const i=r.step;let a=r.diffs[0]*i,h=r.diffs[1]*i;e.moveTo(a,h);for(let m=0,_=2;m<r.commands.length;m++)switch(r.commands[m]){case t0.PATH_COMMAND_MOVE:a+=r.diffs[_++]*i,h+=r.diffs[_++]*i,e.moveTo(a,h);break;case t0.PATH_COMMAND_LINE:a+=r.diffs[_++]*i,h+=r.diffs[_++]*i,e.lineTo(a,h);break;case t0.PATH_COMMAND_QUAD:{const v=a+r.diffs[_++]*i,E=h+r.diffs[_++]*i;a=v+r.diffs[_++]*i,h=E+r.diffs[_++]*i,e.quadraticCurveTo(v,E,a,h);break}case t0.PATH_COMMAND_CUBIC:{const v=a+r.diffs[_++]*i,E=h+r.diffs[_++]*i,S=v+r.diffs[_++]*i,M=E+r.diffs[_++]*i;a=S+r.diffs[_++]*i,h=M+r.diffs[_++]*i,e.bezierCurveTo(v,E,S,M,a,h);break}case t0.PATH_COMMAND_CLOSE:e.closePath()}return e}function KI(r){return XI(r,new Path2D)}class ub{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Lt(ub,"LRUCache");class Gw{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new yo(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new ub(150)),this.cacheMap.get(a).get(Rh(e.toString(),i))}setInCache(e,i,a,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new ub(150));const m=this.cacheDependenciesMap.get(h),_=Rh(e.id.toString(),a);m.get(_)||m.set(_,new Set);const v=this.cacheMap.get(h),E=e.toString();m.get(_).add(E),v.put(Rh(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const h=this.cacheMap.get(a),m=this.cacheDependenciesMap.get(a);for(const _ of e){const v=Rh(_.toString(),i);if(m.has(v)){for(const E of m.get(v))h.delete(E);m.delete(v)}}}rasterize(e,i,a,h,m=a3){const _=this.getFromCache(e,a,h);if(_)return _.clone();const v=m(i.icon,e.options),E=Gw._getImage(v);return this.setInCache(e,E,a,h),E.clone()}}class YI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function QI(r,e,i,a){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(a[_])<1e-15){if(i[_]<r[_]||i[_]>e[_])return null}else{const v=1/a[_];let E=(r[_]-i[_])*v,S=(e[_]-i[_])*v;if(E>S){const M=E;E=S,S=M}if(E>h&&(h=E),S<m&&(m=S),h>m)return null}return h}function JI(r,e,i,a,h,m,_,v,E,S,M){const D=a-r,O=h-e,N=m-i,V=_-r,$=v-e,Z=E-i,K=M[1]*Z-M[2]*$,ne=M[2]*V-M[0]*Z,ae=M[0]*$-M[1]*V,ue=D*K+O*ne+N*ae;if(Math.abs(ue)<1e-15)return null;const Te=1/ue,_e=S[0]-r,Ie=S[1]-e,Me=S[2]-i,Le=(_e*K+Ie*ne+Me*ae)*Te;if(Le<0||Le>1)return null;const at=Ie*N-Me*O,Ge=Me*D-_e*N,ut=_e*O-Ie*D,gt=(M[0]*at+M[1]*Ge+M[2]*ut)*Te;return gt<0||Le+gt>1?null:(V*at+$*Ge+Z*ut)*Te}function e2(r,e,i){return(r-e)/(i-e)}function t2(r,e,i,a,h,m,_,v,E){const S=1<<i,M=m-a,D=_-h,O=(r+1)/S*M+a,N=(e+0)/S*D+h,V=(e+1)/S*D+h;v[0]=(r+0)/S*M+a,v[1]=N,E[0]=O,E[1]=V}class i2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(m){const _=Math.ceil(Math.log2(m.dim/8)),v=[];let E=Math.ceil(Math.pow(2,_));const S=1/E,M=(N,V,$,Z,K)=>{const ne=Z?1:0,ae=(N+1)*$-ne,ue=V*$,Te=(V+1)*$-ne;K[0]=N*$,K[1]=ue,K[2]=ae,K[3]=Te};let D=new YI(E);const O=[];for(let N=0;N<E*E;N++){M(N%E,Math.floor(N/E),S,!1,O);const V=Sm(O[0],O[1],m),$=Sm(O[2],O[1],m),Z=Sm(O[2],O[3],m),K=Sm(O[0],O[3],m);D.minimums.push(Math.min(V,$,Z,K)),D.maximums.push(Math.max(V,$,Z,K)),D.leaves.push(1)}for(v.push(D),E/=2;E>=1;E/=2){const N=v[v.length-1];D=new YI(E);for(let V=0;V<E*E;V++){M(V%E,Math.floor(V/E),2,!0,O);const $=N.getElevation(O[0],O[1]),Z=N.getElevation(O[2],O[1]),K=N.getElevation(O[2],O[3]),ne=N.getElevation(O[0],O[3]),ae=N.isLeaf(O[0],O[1]),ue=N.isLeaf(O[2],O[1]),Te=N.isLeaf(O[2],O[3]),_e=N.isLeaf(O[0],O[3]),Ie=Math.min($.min,Z.min,K.min,ne.min),Me=Math.max($.max,Z.max,K.max,ne.max),Le=ae&&ue&&Te&&_e;D.maximums.push(Me),D.minimums.push(Ie),D.leaves.push(Me-Ie<=5&&Le?1:0)}v.push(D)}return v})(this.dem),a=i.length-1,h=i[a];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,h,m,_,v=1){return QI([e,i,-100],[a,h,this.maximums[0]*v],m,_)}raycast(e,i,a,h,m,_,v=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,i,a,h,m,_,v);if(E==null)return null;const S=[],M=[],D=[],O=[],N=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:V,t:$,nodex:Z,nodey:K,depth:ne}=N.pop();if(this.leaves[V]){t2(Z,K,ne,e,i,a,h,D,O);const ue=1<<ne,Te=(Z+0)/ue,_e=(Z+1)/ue,Ie=(K+0)/ue,Me=(K+1)/ue,Le=Sm(Te,Ie,this.dem)*v,at=Sm(_e,Ie,this.dem)*v,Ge=Sm(_e,Me,this.dem)*v,ut=Sm(Te,Me,this.dem)*v,gt=JI(D[0],D[1],Le,O[0],D[1],at,O[0],O[1],Ge,m,_),Et=JI(O[0],O[1],Ge,D[0],O[1],ut,D[0],D[1],Le,m,_),jt=Math.min(gt!==null?gt:Number.MAX_VALUE,Et!==null?Et:Number.MAX_VALUE);if(jt!==Number.MAX_VALUE)return jt;{const Dt=_i([],m,_,$);if(n2(Le,at,ut,Ge,e2(Dt[0],D[0],O[0]),e2(Dt[1],D[1],O[1]))>=Dt[2])return $}continue}let ae=0;for(let ue=0;ue<this._siblingOffset.length;ue++){t2((Z<<1)+this._siblingOffset[ue][0],(K<<1)+this._siblingOffset[ue][1],ne+1,e,i,a,h,D,O),D[2]=-100,O[2]=this.maximums[this.childOffsets[V]+ue]*v;const Te=QI(D,O,m,_);if(Te!=null){const _e=Te;S[ue]=_e;let Ie=!1;for(let Me=0;Me<ae&&!Ie;Me++)_e>=S[M[Me]]&&(M.splice(Me,0,ue),Ie=!0);Ie||(M[ae]=ue),ae++}}for(let ue=0;ue<ae;ue++){const Te=M[ue];N.push({idx:this.childOffsets[V]+Te,t:S[Te],nodex:(Z<<1)+this._siblingOffset[Te][0],nodey:(K<<1)+this._siblingOffset[Te][1],depth:ne+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,h,m){if(e[h].isLeaf(i,a)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,v=e[_];let E=0,S=0;for(let M=0;M<this._siblingOffset.length;M++){const D=2*i+this._siblingOffset[M][0],O=2*a+this._siblingOffset[M][1],N=v.getElevation(D,O),V=v.isLeaf(D,O),$=this._addNode(N.min,N.max,V);V&&(E|=1<<M),S||(S=$)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],_,S+M)}}function n2(r,e,i,a,h,m){return Oi(Oi(r,i,m),Oi(e,a,m),h)}function Sm(r,e,i){const a=i.dim,h=J(r*a-.5,0,a-1),m=J(e*a-.5,0,a-1),_=Math.floor(h),v=Math.floor(m),E=Math.min(_+1,a-1),S=Math.min(v+1,a-1);return n2(i.get(_,v),i.get(E,v),i.get(_,S),i.get(E,S),h-_,m-v)}const l3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function c3(r,e,i){return(256*r*256+256*e+i)/10-1e4}function u3(r,e,i){return 256*r+e+i/256-32768}class hb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void gi(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let E=0;E<m;E++)_[this._idx(-1,E)]=_[this._idx(0,E)],_[this._idx(m,E)]=_[this._idx(m-1,E)],_[this._idx(E,-1)]=_[this._idx(E,0)],_[this._idx(E,m)]=_[this._idx(E,m-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(m,-1)]=_[this._idx(m-1,0)],_[this._idx(-1,m)]=_[this._idx(0,m-1)],_[this._idx(m,m)]=_[this._idx(m-1,m-1)]}const v=a==="terrarium"?u3:c3;for(let E=0;E<_.length;++E){const S=4*E;this.floatView[E]=v(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Qs.now()}_buildQuadTree(){this._tree=new i2(this)}get(e,i,a=!1){a&&(e=J(e,-1,this.dim),i=J(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,a){const h=this._idx(e,i),m=this.floatView[h];return this.floatView[h]=a,a-m}static getUnpackVector(e){return l3[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],h=hb.getUnpackVector(i);let m=Math.floor((e+h[3])/h[2]);return a[2]=m%256,m=Math.floor(m/256),a[1]=m%256,m=Math.floor(m/256),a[0]=m,a}getPixels(){return new pv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,m=i*this.dim+this.dim,_=a*this.dim,v=a*this.dim+this.dim;switch(i){case-1:h=m-1;break;case 1:m=h+1}switch(a){case-1:_=v-1;break;case 1:v=_+1}const E=-i*this.dim,S=-a*this.dim;for(let M=_;M<v;M++)for(let D=h;D<m;D++){const O=4*this._idx(D,M),N=4*this._idx(D+E,M+S);this.pixels[O+0]=e.pixels[N+0],this.pixels[O+1]=e.pixels[N+1],this.pixels[O+2]=e.pixels[N+2],this.pixels[O+3]=e.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function h3(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push((function(a,h){return a.readFields(g3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(i,i.readVarint()+i.pos))}function d3(r,e,i){r===1?(e.delta_filter=(function(a,h){return a.readFields(f3,{blockSize:0},h)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function f3(r,e,i){r===1&&(e.blockSize=i.readVarint())}function p3(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function m3(r,e,i){let a=0,h=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push((function(m,_){return m.readFields(d3,{},_)})(i,i.readVarint()+i.pos)):r===4?e.codec=(function(m,_){return m.readFields(p3,{},_)})(i,i.readVarint()+i.pos):r===5?h=i.readFloat():r===6?a=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=a)}function g3(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push((function(a,h){return a.readFields(m3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(i,i.readVarint()+i.pos))}function _3(r,e,i){if(r===2)(function(a,h,m){a.readFields(y3,m,h)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function y3(r,e,i){if(r===1){let a=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[a++]=i.readVarint()}}function v3(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const h=a===1?1:0,m=a===2?1:0;for(let _=0;_<e[0];_++){const v=e[1]*_;for(let E=h;E<e[1];E++){const S=e[2]*(E+v);for(let M=m;M<e[2];M++){const D=e[3]*(M+S);for(let O=0;O<e[3];O++){const N=D+O;r[N]+=r[N-i]}}}}i*=e[a]}return r}function x3(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function b3(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const a=r[i],h=r[i+1];r[i]=(240&a)>>4|(61440&a)>>8|(240&h)<<4|61440&h,r[i+1]=15&a|(3840&a)>>4|(15&h)<<8|(3840&h)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const a=r[i],h=r[i+1],m=r[i+2],_=r[i+3];r[i+0]=(192&a)>>6|(192&h)>>4|(192&m)>>2|192&_,r[i+1]=(48&a)>>4|(48&h)>>2|48&m|(48&_)<<2,r[i+2]=(12&a)>>2|12&h|(12&m)<<2|(12&_)<<4,r[i+3]=3&a|(3&h)<<2|(3&m)<<4|(3&_)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Lt(hb,"DEMData"),Lt(i2,"DemMinMaxQuadTree",{omit:["dem"]});var hu=Uint8Array,n0=Uint16Array,w3=Int32Array,r2=new hu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s2=new hu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),T3=new hu([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o2=function(r,e){for(var i=new n0(31),a=0;a<31;++a)i[a]=e+=1<<r[a-1];var h=new w3(i[30]);for(a=1;a<30;++a)for(var m=i[a];m<i[a+1];++m)h[m]=m-i[a]<<5|a;return{b:i,r:h}},a2=o2(r2,2),l2=a2.b,E3=a2.r;l2[28]=258,E3[258]=28;for(var S3=o2(s2,0).b,c2=new n0(32768),ao=0;ao<32768;++ao){var yy=(43690&ao)>>1|(21845&ao)<<1;c2[ao]=((65280&(yy=(61680&(yy=(52428&yy)>>2|(13107&yy)<<2))>>4|(3855&yy)<<4))>>8|(255&yy)<<8)>>1}var r0=function(r,e,i){for(var a=r.length,h=0,m=new n0(e);h<a;++h)r[h]&&++m[r[h]-1];var _,v=new n0(e);for(h=1;h<e;++h)v[h]=v[h-1]+m[h-1]<<1;_=new n0(1<<e);var E=15-e;for(h=0;h<a;++h)if(r[h])for(var S=h<<4|r[h],M=e-r[h],D=v[r[h]-1]++<<M,O=D|(1<<M)-1;D<=O;++D)_[c2[D]>>E]=S;return _},s0=new hu(288);for(ao=0;ao<144;++ao)s0[ao]=8;for(ao=144;ao<256;++ao)s0[ao]=9;for(ao=256;ao<280;++ao)s0[ao]=7;for(ao=280;ao<288;++ao)s0[ao]=8;var u2=new hu(32);for(ao=0;ao<32;++ao)u2[ao]=5;var A3=r0(s0,9),I3=r0(u2,5),qw=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},Yh=function(r,e,i){var a=e/8|0;return(r[a]|r[a+1]<<8)>>(7&e)&i},Hw=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},C3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Qh=function(r,e,i){var a=new Error(e||C3[r]);if(a.code=r,Error.captureStackTrace&&Error.captureStackTrace(a,Qh),!i)throw a;return a},R3=new hu(0),M3=typeof TextDecoder<"u"&&new TextDecoder;try{M3.decode(R3,{stream:!0})}catch{}const D3={gzip_data:"gzip"};class Xu extends Error{constructor(e){super(e),this.name="MRTError"}}const P3={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},h2={uint32:1,uint16:2,uint8:4},O3={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let $w;class db{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Xu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new Xu("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new Xu(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const h=new $w(i.subarray(0,a)).readFields(h3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Xu(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const m of h.layers)this.layers[m.name]=new d2(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let h of e.blockIndices){const m=a.dataIndex[h],_=m.firstByte-e.firstByte,v=m.lastByte-e.firstByte;if(a._blocksInProgress.has(h))continue;const E={layerName:a.name,firstByte:_,lastByte:v,pixelFormat:a.pixelFormat,blockIndex:h,blockShape:[m.bands.length].concat(a.bandShape),buffer:a.buffer,codec:m.codec.codec,filters:m.filters.map((S=>S.filter))};a._blocksInProgress.add(h),i.push(E)}return new f2(i,(()=>{i.forEach((h=>a._blocksInProgress.delete(h.blockIndex)))}),((h,m)=>{if(i.forEach((_=>a._blocksInProgress.delete(_.blockIndex))),h)throw h;m.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class d2{constructor({version:e,name:i,units:a,tileSize:h,pixelFormat:m,buffer:_,dataIndex:v},E){if(this.version=e,this.version!==1)throw new Xu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=h,this.buffer=_,this.pixelFormat=P3[m],this.dataIndex=v,this.bandShape=[h+2*_,h+2*_,h2[this.pixelFormat]],this._decodedBlocks=new ub(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return h2[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,h]of this.dataIndex.entries()){for(const[m,_]of h.bands.entries())if(_===e)return{bandIndex:i+m,blockIndex:a,blockBandIndex:m};i+=h.bands.length}break;case"number":for(const[a,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new Xu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const h=[],m=new Set;for(const _ of e){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new Xu(`Invalid band: ${JSON.stringify(_)}`);const E=this.dataIndex[v];h.includes(v)||h.push(v),m.add(v),i=Math.min(i,E.firstByte),a=Math.max(a,E.lastByte)}if(m.size>this.cacheSize)throw new Xu(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new Xu(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new Xu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[i],_=this.bandShape.reduce(((S,M)=>S*M),1),v=a*_,E=h.subarray(v,v+_);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}db.setPbf=function(r){$w=r};class f2{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}db.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map((a=>{const{layerName:h,firstByte:m,lastByte:_,pixelFormat:v,blockShape:E,blockIndex:S,filters:M,codec:D}=a,O=i.subarray(m,_+1),N=new Uint32Array(E[0]*E[1]*E[2]);let V;if(D!=="gzip_data")throw new Xu(`Unhandled codec: ${D}`);return V=(function($,Z){if(!globalThis.DecompressionStream&&Z==="gzip_data")return Promise.resolve(((ue=(function(Ie){Ie[0]==31&&Ie[1]==139&&Ie[2]==8||Qh(6,"invalid gzip data");var Me=Ie[3],Le=10;4&Me&&(Le+=2+(Ie[10]|Ie[11]<<8));for(var at=(Me>>3&1)+(Me>>4&1);at>0;at-=!Ie[Le++]);return Le+(2&Me)})(ae=$))+8>ae.length&&Qh(6,"invalid gzip data"),(function(Ie,Me,Le,at){var Ge=Ie.length;if(!Ge||Me.f&&!Me.l)return Le||new hu(0);var ut=!Le,gt=ut||Me.i!=2,Et=Me.i;ut&&(Le=new hu(3*Ge));var jt,Dt,vt=function(cs){var Vr=Le.length;if(cs>Vr){var Sr=new hu(Math.max(2*Vr,cs));Sr.set(Le),Le=Sr}},Mt=Me.f||0,ot=Me.p||0,et=Me.b||0,It=Me.l,Vt=Me.d,bt=Me.m,li=Me.n,fi=8*Ge;do{if(!It){Mt=Yh(Ie,ot,1);var ni=Yh(Ie,ot+1,3);if(ot+=3,!ni){var Kt=Ie[(ye=4+((ot+7)/8|0))-4]|Ie[ye-3]<<8,ji=ye+Kt;if(ji>Ge){Et&&Qh(0);break}gt&&vt(et+Kt),Le.set(Ie.subarray(ye,ji),et),Me.b=et+=Kt,Me.p=ot=8*ji,Me.f=Mt;continue}if(ni==1)It=A3,Vt=I3,bt=9,li=5;else if(ni==2){var ii=Yh(Ie,ot,31)+257,Ri=Yh(Ie,ot+10,15)+4,qi=ii+Yh(Ie,ot+5,31)+1;ot+=14;for(var un=new hu(qi),Nn=new hu(19),Zi=0;Zi<Ri;++Zi)Nn[T3[Zi]]=Yh(Ie,ot+3*Zi,7);ot+=3*Ri;var $n=qw(Nn),Wn=(1<<$n)-1,es=r0(Nn,$n);for(Zi=0;Zi<qi;){var ye,pe=es[Yh(Ie,ot,Wn)];if(ot+=15&pe,(ye=pe>>4)<16)un[Zi++]=ye;else{var ft=0,Wt=0;for(ye==16?(Wt=3+Yh(Ie,ot,3),ot+=2,ft=un[Zi-1]):ye==17?(Wt=3+Yh(Ie,ot,7),ot+=3):ye==18&&(Wt=11+Yh(Ie,ot,127),ot+=7);Wt--;)un[Zi++]=ft}}var pt=un.subarray(0,ii),Qt=un.subarray(ii);bt=qw(pt),li=qw(Qt),It=r0(pt,bt),Vt=r0(Qt,li)}else Qh(1);if(ot>fi){Et&&Qh(0);break}}gt&&vt(et+131072);for(var bi=(1<<bt)-1,vi=(1<<li)-1,Yi=ot;;Yi=ot){var zi=(ft=It[Hw(Ie,ot)&bi])>>4;if((ot+=15&ft)>fi){Et&&Qh(0);break}if(ft||Qh(2),zi<256)Le[et++]=zi;else{if(zi==256){Yi=ot,It=null;break}var mi=zi-254;zi>264&&(mi=Yh(Ie,ot,(1<<(Bi=r2[Zi=zi-257]))-1)+l2[Zi],ot+=Bi);var Gn=Vt[Hw(Ie,ot)&vi],_r=Gn>>4;if(Gn||Qh(3),ot+=15&Gn,Qt=S3[_r],_r>3){var Bi=s2[_r];Qt+=Hw(Ie,ot)&(1<<Bi)-1,ot+=Bi}if(ot>fi){Et&&Qh(0);break}gt&&vt(et+131072);var Ln=et+mi;if(et<Qt){var yr=0-Qt,sr=Math.min(Qt,Ln);for(yr+et<0&&Qh(3);et<sr;++et)Le[et]=(void 0)[yr+et]}for(;et<Ln;++et)Le[et]=Le[et-Qt]}}Me.l=It,Me.p=Yi,Me.b=et,Me.f=Mt,It&&(Mt=1,Me.m=bt,Me.d=Vt,Me.n=li)}while(!Mt);return et!=Le.length&&ut?(jt=Le,((Dt=et)==null||Dt>jt.length)&&(Dt=jt.length),new hu(jt.subarray(0,Dt))):Le.subarray(0,et)})(ae.subarray(ue,-8),{i:2},new hu(((K=ae)[(ne=K.length)-4]|K[ne-3]<<8|K[ne-2]<<16|K[ne-1]<<24)>>>0))));var K,ne,ae,ue;const Te=D3[Z];if(!Te)throw new Error(`Unhandled codec: ${Z}`);const _e=new globalThis.DecompressionStream(Te);return new Response(new Blob([$]).stream().pipeThrough(_e)).arrayBuffer().then((Ie=>new Uint8Array(Ie)))})(O,D).then(($=>((function(Z,K){Z.readFields(_3,K)})(new $w($),N),new O3[v](N.buffer)))),V.then(($=>{for(let Z=M.length-1;Z>=0;Z--)switch(M[Z]){case"delta_filter":v3($,E);break;case"zigzag_filter":x3($);break;case"bitshuffle_filter":b3($,v);break;default:throw new Xu(`Unhandled filter "${M[Z]}"`)}return{layerName:h,blockIndex:S,data:$}})).catch(($=>{throw $}))})))},Lt(f2,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Lt(db,"MapboxRasterTile"),Lt(d2,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class p2{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class m2{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Cc(Nt,16,0),this.featureIndexArray=new Gf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,h,m,_=0,v=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,m,_);const S=this.grid;for(let M=0;M<i.length;M++){const D=i[M],O=[1/0,1/0,-1/0,-1/0];for(let N=0;N<D.length;N++){const V=D[N];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}v!==0&&(O[0]-=v,O[1]-=v,O[2]+=v,O[3]+=v),O[0]<Nt&&O[1]<Nt&&O[2]>=0&&O[3]>=0&&S.insert(E,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new $t(new jx(this.rawTileData)).layers,this.sourceLayerCoder=new p2(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:h,tileTransform:m,pixelPosMatrix:_,availableImages:v,worldview:E}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const S=i.queryRadius?i.queryRadius:0,M=a.bufferedTilespaceBounds,D=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(($,Z,K,ne)=>wr(a.bufferedTilespaceGeometry,$-S,Z-S,K+S,ne+S)));D.sort(L3);let O=null;h.elevation&&D.length>0&&(O=my.create(h.elevation,this.tileID));const N={};let V;for(let $=0;$<D.length;$++){const Z=D[$];if(Z===V)continue;V=Z;const K=this.featureIndexArray.get(Z);let ne=null;this.is3DTile?this.loadMatchingModelFeature(N,K,e,a,h,E):this.loadMatchingFeature(N,K,e,v,E,((ae,ue,Te,_e=0)=>(ne||(ne=dt(ae,this.tileID.canonical,m)),ue.queryIntersectsFeature(a,ae,Te,ne,this.z,h,_,O,_e))))}return N}loadMatchingFeature(e,i,a,h,m,_){const{featureIndex:v,bucketIndex:E,sourceLayerIndex:S,layoutVertexArrayOffset:M}=i,D=this.bucketLayerIDs[E],O=a.layers,N=Object.keys(O);if(N.length&&!Ii(N,D))return;const V=a.sourceCache,$=this.sourceLayerCoder.decode(S),Z=this.vtLayers[$].feature(v),K=this.getId(Z,$);for(let ne=0;ne<D.length;ne++){const ae=D[ne];if(!O[ae])continue;const{styleLayer:ue,targets:Te}=O[ae];let _e={};K!==void 0&&(_e=V.getFeatureState(ue.sourceLayer,K));const Ie=!_||_(Z,ue,_e,M);if(!Ie)continue;const Me=new Qg(Z,this.z,this.x,this.y,K);Me.tile=this.tileID.canonical,Me.state=_e;let Le=this.serializedLayersCache.get(ae);Le||(Le=ue.serialize(),Le.id=ae,this.serializedLayersCache.set(ae,Le)),Me.source=Le.source,Me.sourceLayer=Le["source-layer"],Me.layer=Object.assign({},Le),Me.layer.paint=g2(Le.paint,ue.paint,Z,_e,h),Me.layer.layout=g2(Le.layout,ue.layout,Z,_e,h);let at=!1;for(const Ge of Te){this.updateFeatureProperties(Me,Ge);const{filter:ut}=Ge;if(ut){if(Z.properties=Me.properties,ut.needGeometry){const gt=Ke(Z,!0);if(!ut.filter(new Yn(this.tileID.overscaledZ,{worldview:m}),gt,this.tileID.canonical))continue}else if(!ut.filter(new Yn(this.tileID.overscaledZ,{worldview:m}),Z))continue}at=!0,Ge.targetId&&this.addFeatureVariant(Me,Ge)}at&&this.appendToResult(e,ae,v,Me,Ie)}}loadMatchingModelFeature(e,i,a,h,m,_){const{featureIndex:v,bucketIndex:E}=i,S=this.bucketLayerIDs[E],M=a.layers,D=Object.keys(M);if(!D.length||Ii(D,S))for(let O=0;O<S.length;O++){const N=S[O],{styleLayer:V,targets:$}=M[N];if(V.type!=="model")continue;const Z=h.tile,K=Z.getBucket(V);if(!(K&&K instanceof sb))continue;const ne=Vk(K,v,h,m);if(!ne)continue;const{z:ae,x:ue,y:Te}=Z.tileID.canonical,{feature:_e,intersectionZ:Ie,position:Me}=ne;let Le={};_e.id!==void 0&&(Le=a.sourceCache.getFeatureState(V.sourceLayer,_e.id));const at=new Qg({},ae,ue,Te,_e.id);at.tile=this.tileID.canonical,at.state=Le,at.properties=_e.properties,at.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let Ge=this.serializedLayersCache.get(N);Ge||(Ge=V.serialize(),Ge.id=N,this.serializedLayersCache.set(N,Ge)),at.source=Ge.source,at.sourceLayer=Ge["source-layer"],at.layer=Object.assign({},Ge);let ut=!1;for(const gt of $){this.updateFeatureProperties(at,gt);const{filter:Et}=gt;if(Et){if(_e.properties=at.properties,Et.needGeometry){if(!Et.filter(new Yn(this.tileID.overscaledZ,{worldview:_}),_e,this.tileID.canonical))continue}else if(!Et.filter(new Yn(this.tileID.overscaledZ,{worldview:_}),_e))continue}ut=!0,gt.targetId&&this.addFeatureVariant(at,gt)}ut&&this.appendToResult(e,N,v,at,Ie)}}updateFeatureProperties(e,i,a){if(i.properties){const h={};for(const m in i.properties){const _=i.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);_!=null&&(h[m]=_)}e.properties=h}}addFeatureVariant(e,i,a){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,a,h,m){let _=e[i];_===void 0&&(_=e[i]=[]),_.push({featureIndex:a,feature:h,intersectionZ:m})}lookupSymbolFeatures(e,i,a,h,m,_){const v={};this.loadVTLayers();for(const E of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:a,featureIndex:E,layoutVertexArrayOffset:0},h,m,_);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(a),m=this.vtFeatures[h];if(m[i])return m[i];const _=this.vtLayers[h].feature(i);return m[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const m=bl(h);if(m.result!=="success"){const _=m.value.map((v=>`${v.key}: ${v.message}`)).join(", ");return void gi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=m.value}a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[h];typeof a=="boolean"&&(a=Number(a))}return a}}function g2(r,e,i,a,h){return Ot(r,((m,_)=>{const v=e instanceof Bu?e.get(_):null;return v&&v.evaluate?v.evaluate(i,a,void 0,h):v}))}function L3(r,e){return e-r}Lt(m2,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const _2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ww{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=_2[15&a];if(!m)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new Ww(v,_,m,e)}constructor(e,i=64,a=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=_2.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Zw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:_,nodeSize:v}=this,E=[0,m.length-1,0],S=[];for(;E.length;){const M=E.pop()||0,D=E.pop()||0,O=E.pop()||0;if(D-O<=v){for(let Z=O;Z<=D;Z++){const K=_[2*Z],ne=_[2*Z+1];K>=e&&K<=a&&ne>=i&&ne<=h&&S.push(m[Z])}continue}const N=O+D>>1,V=_[2*N],$=_[2*N+1];V>=e&&V<=a&&$>=i&&$<=h&&S.push(m[N]),(M===0?e<=V:i<=$)&&(E.push(O),E.push(N-1),E.push(1-M)),(M===0?a>=V:h>=$)&&(E.push(N+1),E.push(D),E.push(1-M))}return S}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:_}=this,v=[0,h.length-1,0],E=[],S=a*a;for(;v.length;){const M=v.pop()||0,D=v.pop()||0,O=v.pop()||0;if(D-O<=_){for(let Z=O;Z<=D;Z++)v2(m[2*Z],m[2*Z+1],e,i)<=S&&E.push(h[Z]);continue}const N=O+D>>1,V=m[2*N],$=m[2*N+1];v2(V,$,e,i)<=S&&E.push(h[N]),(M===0?e-a<=V:i-a<=$)&&(v.push(O),v.push(N-1),v.push(1-M)),(M===0?e+a>=V:i+a>=$)&&(v.push(N+1),v.push(D),v.push(1-M))}return E}}function Zw(r,e,i,a,h,m){if(h-a<=i)return;const _=a+h>>1;y2(r,e,_,a,h,m),Zw(r,e,i,a,_-1,1-m),Zw(r,e,i,_+1,h,1-m)}function y2(r,e,i,a,h,m){for(;h>a;){if(h-a>600){const S=h-a+1,M=i-a+1,D=Math.log(S),O=.5*Math.exp(2*D/3),N=.5*Math.sqrt(D*O*(S-O)/S)*(M-S/2<0?-1:1);y2(r,e,i,Math.max(a,Math.floor(i-M*O/S+N)),Math.min(h,Math.floor(i+(S-M)*O/S+N)),m)}const _=e[2*i+m];let v=a,E=h;for(o0(r,e,a,i),e[2*h+m]>_&&o0(r,e,a,h);v<E;){for(o0(r,e,v,E),v++,E--;e[2*v+m]<_;)v++;for(;e[2*E+m]>_;)E--}e[2*a+m]===_?o0(r,e,a,E):(E++,o0(r,e,E,h)),E<=i&&(a=E+1),i<=E&&(h=E-1)}}function o0(r,e,i,a){Xw(r,i,a),Xw(e,2*i,2*a),Xw(e,2*i+1,2*a+1)}function Xw(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function v2(r,e,i,a){const h=r-i,m=e-a;return h*h+m*m}s.$=cf,s.A=Oa,s.B=Rh,s.C=2,s.D=Ae,s.E=fl,s.F=jv,s.G=HA,s.H=hd,s.I=Ss,s.J=Vp,s.K=sh,s.L=dd,s.M=Lu,s.N=Td,s.O=Sc,s.P=St,s.Q=Sd,s.R=Ho,s.S=Sh,s.T=sw,s.U=bl,s.V=rb,s.W=Ic,s.X=os,s.Y=gh,s.Z=ro,s._=$o,s.a=function(r){return or.API_CDN_URL_REGEX.test(r)},s.a$=Mh,s.a0=Li,s.a1=ld,s.a2=Nu,s.a3=class extends rb{},s.a4=Ed,s.a5=Ec,s.a6=Ue,s.a7=function(r){const e=r.value;return e?Li(e)?zw(e,!0)?[]:[new rb(r.key,e,`invalid url "${e}"`)]:[new rb(r.key,e,`string expected, "${sh(e)}" found`)]:[]},s.a8=Bp,s.a9=rs,s.aA=J,s.aB=ct,s.aC=$i,s.aD=Fr,s.aE=oo,s.aF=te,s.aG=st,s.aH=function(r,e){const i={};for(let a=0;a<e.length;a++){const h=e[a];h in r&&(i[h]=r[h])}return i},s.aI=B,s.aJ=ee,s.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,a){const h=this.entries[r]=this.entries[r]||{callbacks:[]};if(h.result){const[m,_]=h.result;return this.scheduler?this.scheduler.add((()=>{a(m,_)}),e):a(m,_),()=>{}}return h.callbacks.push(a),h.cancel||(h.cancel=i(((m,_)=>{h.result=[m,_];for(const v of h.callbacks)this.scheduler?this.scheduler.add((()=>{v(m,_)}),e):v(m,_);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{h.result||(h.callbacks=h.callbacks.filter((m=>m!==a)),h.callbacks.length||(h.cancel(),delete this.entries[r]))}}},s.aL=function(r,e,i){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},(h=>{const m=va(r.request,((_,v,E)=>{_?h(_):v&&h(null,{vectorTile:i?void 0:new $t(new jx(v)),rawData:v,responseHeaders:new Map(E.entries())})}));return()=>{m.cancel(),h()}}),e)},s.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},s.aN=function(r){Pa++,Pa>bo&&(r.getActor().send("enforceCacheSizeLimit",yu),Pa=0)},s.aO=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},s.aP=Fs,s.aQ=xI,s.aR=AI,s.aS=U,s.aT=vI,s.aU=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<r.length;a++){const h=document.createElement("source");Mn(r[a])||(i.crossOrigin="Anonymous"),h.src=r[a],i.appendChild(h)}return{cancel:()=>{}}},s.aV=Fv,s.aW=Jg,s.aX=We,s.aY=$v,s.aZ=he,s.a_=le,s.aa=kt,s.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Rn(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Oi(r.x,e.x,i),y:Oi(r.y,e.y,i),z:Oi(r.z,e.z,i),azimuthal:Oi(r.azimuthal,e.azimuthal,i),polar:Oi(r.polar,e.polar,i)}}},s.ac=Yn,s.ad=To,s.ae=Ve,s.af=nr,s.ag=qn,s.ah=de,s.ai=Bu,s.aj=Aa,s.ak=Oi,s.al=Nt,s.am=Tu,s.an=gn,s.ao=On,s.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([i,a]){const h=Rn([1,i,a]);return{x:h.x,y:h.y,z:h.z}})(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Oi(r.x,e.x,i),y:Oi(r.y,e.y,i),z:Oi(r.z,e.z,i)}}},s.aq=function(r,e,i=0,a=!0){const h=new St(i,i),m=r.sub(h),_=e.add(h),v=[m,new St(_.x,m.y),_,new St(m.x,_.y)];return a&&v.push(m.clone()),v},s.ar=function(r,e){const i=[];for(let a=0;a<r.length;a++){const h=Re(a-1,-1,r.length-1),m=Re(a+1,-1,r.length-1),_=r[a],v=r[m],E=r[h].sub(_).unit(),S=v.sub(_).unit(),M=S.angleWithSep(E.x,E.y),D=E.add(S).unit().mult(-1*e/Math.sin(M/2));i.push(_.add(D))}return i},s.as=rI,s.at=wr,s.au=function(r,e,i=0){return Ct(((e.x-i)*r.scale-r.x)*Nt,(e.y*r.scale-r.y)*Nt,we(e.z,e.y))},s.av=Dr,s.aw=Ki,s.ax=Ni,s.ay=yA,s.az=function(r){let e=1/0,i=1/0,a=-1/0,h=-1/0;for(const m of r)e=Math.min(e,m.x),i=Math.min(i,m.y),a=Math.max(a,m.x),h=Math.max(h,m.y);return{min:new St(e,i),max:new St(a,h)}},s.b=function(r){return or.API_FONTS_REGEX.test(r)},s.b$=Cv,s.b0=Cr,s.b1=Ye,s.b2=dg,s.b3=eb,s.b4=function(){la.isLoading()||la.isLoaded()||Th()!=="deferred"||Md()},s.b5=Of,s.b6=Ke,s.b7=Qg,s.b8=ds,s.b9=fw,s.bA=qe,s.bB=Je,s.bC=function(r,e){const{x:i,y:a}=r.point,h=Vh(i,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return ct(h,h,Rg(lu(e)))},s.bD=ie,s.bE=Ds,s.bF=ln,s.bG=_i,s.bH=Wr,s.bI=hr,s.bJ=uy,s.bK=tc,s.bL=bw,s.bM=function(r,e,i,a,h){const m=5*e+2;r.float32[m+0]=i,r.float32[m+1]=a,r.float32[m+2]=h},s.bN=py,s.bO=Co,s.bP=ma,s.bQ=cl,s.bR=Ma,s.bS=Re,s.bT=function(r,e,i,a){var h=new q(4);return h[0]=r,h[1]=e,h[2]=i,h[3]=a,h},s.bU=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,h=Math.floor(r.x),m=Math.floor((r.x-h)*a),_=Math.floor(r.y*a),v=this.findDEMTileFor(new Fs(i,h,i,m,_));return!(!v||!v.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const h=a.getSource().maxzoom,m=1<<h,_=Math.floor(r.x),v=r.x-_,E=new Fs(h,_,h,Math.floor(v*m),Math.floor(r.y*m)),S=this.findDEMTileFor(E);if(!S||!S.dem)return e;const M=S.dem,D=1<<S.tileID.canonical.z,O=(v*D-S.tileID.canonical.x)*M.dim,N=(r.y*D-S.tileID.canonical.y)*M.dim,V=Math.floor(O),$=Math.floor(N);return(i?this.exaggeration():1)*Oi(Oi(M.get(V,$),M.get(V,$+1),N-$),Oi(M.get(V+1,$),M.get(V+1,$+1),N-$),O-V)}static getAtTileOffset(r,e,i,a){const h=1<<r.canonical.z;return a?a.pointElevation(e):i?i.getAtPointOrZero(new Ve(r.wrap+(r.canonical.x+e.x/Nt)/h,(r.canonical.y+e.y/Nt)/h)):0}static getAtTileOffsetFunc(r,e,i,a){return(h,m,_)=>{const v=this.getAtTileOffset(r,h,m,_),E=a.upVector(r.canonical,h.x,h.y);return ai(E,E,v*a.upVectorScale(r.canonical,e,i).metersToTile),E}}getForTilePoints(r,e,i,a){if(this.isUsingMockSource())return!1;const h=my.create(this,r,a);return!!h&&(e.forEach((m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],i)})),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,h=1<<r.canonical.z-a.canonical.z;let m=r.canonical.x/h-a.canonical.x,_=r.canonical.y/h-a.canonical.y,v=0;for(let E=0;E<r.canonical.z-a.canonical.z&&!i.leaves[v];E++){m*=2,_*=2;const S=2*Math.floor(_)+Math.floor(m);v=i.childOffsets[v]+S,m%=1,_%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const h of r){const m=this.getMinMaxForTile(h.tileID);m&&(i=Math.min(i,m.min),a=Math.max(a,m.max),e=!0)}return e?{min:i,max:a}:null}},s.bV=Wh,s.bW=Er,s.bX=Fo,s.bY=Fg,s.bZ=II,s.b_=ty,s.ba=Ev,s.bb=dt,s.bc=Sa,s.bd=Uf,s.be=ov,s.bf=Lr,s.bg=am,s.bh=Ow,s.bi=function(r,e){const i=Aa(e.zoom);if(i===0)return lu(r);const a=Ag(r),h=lv(a),m=te(a.getWest())*e.worldSize,_=te(a.getEast())*e.worldSize,v=ee(a.getNorth())*e.worldSize,E=ee(a.getSouth())*e.worldSize,S=[m,v,0],M=[_,v,0],D=[m,E,0],O=[_,E,0],N=Pt([],e.globeMatrix);return nr(S,S,N),nr(M,M,N),nr(D,D,N),nr(O,O,N),h[0]=kr(h[0],D,i),h[1]=kr(h[1],O,i),h[2]=kr(h[2],M,i),h[3]=kr(h[3],S,i),nn.fromPoints(h)},s.bj=Nh,s.bk=Pt,s.bl=Ig,s.bm=kr,s.bn=ru,s.bo=rx,s.bp=Oe,s.bq=Gt,s.br=db,s.bs=jx,s.bt=va,s.bu=function(r,e){const i=[];for(const a in r)a in e||i.push(a);return i},s.bv=Ce,s.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.bx=Fl,s.by=it,s.bz=Ze,s.c=er,s.c$=function(r){return r*r*r*r*r},s.c0=vw,s.c1=QA,s.c2=Aw,s.c3=Ww,s.c4=ai,s.c5=hs,s.c6=Kn,s.c7=function(r,e,i){i*=.5;var a=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=a*E+h*v,r[1]=h*E-a*v,r[2]=m*E+_*v,r[3]=_*E-m*v,r},s.c8=uo,s.c9=Gr,s.cA=Un,s.cB=iA,s.cC=sl,s.cD=ox,s.cE=function(r,e,i,a,h,m,_,v,E){if(E.name==="globe")return ox(r,e,new sl(i,a,h),!1);const S=$v({z:i,x:a,y:h},E);return new nn([(m+S.x/S.scale)*e,e*(S.y/S.scale),_],[(m+S.x2/S.scale)*e,e*(S.y2/S.scale),v])},s.cF=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},s.cG=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},s.cH=function(r){const e=Math.round((r+45+360)%360/90)%4;return Nl[e]},s.cI=fe,s.cJ=rn,s.cK=t,s.cL=function(r){const e=Ze(new Float64Array(16));ct(e,r.pixelMatrix,r.globeMatrix);const i=[0,x,0],a=[0,T,0];return nr(i,i,e),nr(a,a,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!cv(r,new U(r.center.lat,90)),a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!cv(r,new U(r.center.lat,-90))]},s.cM=function(r,e){const{scale:i}=r.tileTransform,a=i*Nt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(h,m,_){var v=m[1],E=m[2],S=m[3],M=_[0],D=_[1];return h[0]=m[0]*M,h[1]=v*M,h[2]=E*D,h[3]=S*D,h})(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.cN=kx,s.cO=yt,s.cP=tA,s.cQ=function(r){const e=tA(r,!0);return ie([],[e[0],e[1],e[4],e[5]])},s.cR=ei,s.cS=Bn,s.cT=Fi,s.cU=function(r){const{x:e,y:i}=r.point,{lng:a,lat:h}=r._center;return Vh(e,i,r.worldSize,a,h)},s.cV=Cn,s.cW=Ls,s.cX=Ga,s.cY=Jr,s.cZ=d,s.c_=function(r,e,i){let a=0;for(let h=0;h<2;++h)r[h]>0&&(a+=(r[h]-0)*(r[h]-0)),e[h]<0&&(a+=(0-e[h])*(0-e[h]));return a},s.ca=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},s.cb=nt,s.cc=function(r,e,i,a,h){var m=1/Math.tan(e/2);if(r[0]=m/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0){var _=1/(a-h);r[10]=(h+a)*_,r[14]=2*h*a*_}else r[10]=-1,r[14]=-2*a;return r},s.cd=function(r,e,i,a,h,m,_){var v=1/(e-i),E=1/(a-h),S=1/(m-_);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*E,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*S,r[11]=0,r[12]=(e+i)*v,r[13]=(h+a)*E,r[14]=(_+m)*S,r[15]=1,r},s.ce=re,s.cf=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.cg=tm,s.ch=Hu,s.ci=ys,s.cj=ko,s.ck=fs,s.cl=cI,s.cm=function(){var r=new q(4);return q!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},s.cn=function(r,e,i){var a=e[0],h=e[1],m=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=a*E+m*v,r[1]=h*E+_*v,r[2]=a*-v+m*E,r[3]=h*-v+_*E,r},s.co=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},s.cp=Us,s.cq=function(r){var e=r[0],i=r[1],a=r[2],h=r[3];return Math.sqrt(e*e+i*i+a*a+h*h)},s.cr=Nc,s.cs=rr,s.ct=Oc,s.cu=3,s.cv=2,s.cw=7,s.cx=6,s.cy=co,s.cz=ze,s.d=function(r){return or.API_TILEJSON_REGEX.test(r)},s.d$=ux,s.d0=X,s.d1=45,s.d2=Fd,s.d3=function(r,e,i){const a=Math.sqrt(r*r+e*e+i*i),h=a>0?Math.acos(i/a)*Vc:0;let m=r!==0||e!==0?Math.atan2(-e,-r)*Vc+90:0;return m<0&&(m+=360),[a,m,h]},s.d4=Ct,s.d5=Rn,s.d6=Se,s.d7=wi,s.d8=nn,s.d9=bn,s.dA=Bd,s.dB=class extends Na{constructor(r){super(r),this.current=sv}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.dC=_u,s.dD=function(r,e,i){const a=Aa(i.zoom),h=r.style.map._antialias,m=r.terrain&&r.terrain.exaggeration()>0;return a===0&&!h&&!m},s.dE=function(r){const e=r.pixelsPerMeter,i=e/re(1,r.center.lat),a=Ze(new Float64Array(16));return Gt(a,a,[r.point.x,r.point.y,0]),ei(a,a,[i,i,e]),Float32Array.from(a)},s.dF=Ag,s.dG=function(r){const e=fe-5;r=J(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(gn(r))),3);return Math.round(i*(y.length-1))},s.dH=function(r,e,i,a){const h=e.getNorth(),m=e.getSouth(),_=e.getWest(),v=e.getEast(),E=1<<r.z,S=v-_,M=h-m,D=S/f,O=-M/y[i],N=[0,D,0,O,0,0,h,_,0];if(r.z>0){const V=180/a;He(N,N,[V/S+1,0,0,0,V/M+1,0,-.5*V/D,.5*V/O,1])}return N[2]=E,N[5]=r.x,N[8]=r.y,N},s.dI=lu,s.dJ=function(r,e,i){const a=Ze(new Float64Array(16)),h=(e/(1<<r)-.5)*Math.PI*2;return Si(a,i.globeMatrix,h),Float32Array.from(a)},s.dK=pv,s.dL=Sg,s.dM=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.dN=ce,s.dO=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=0,r[3]=-i,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},s.dP=ps,s.dQ=G_,s.dR=jn,s.dS=Pn,s.dT=256,s.dU=function(r,e){const i=[0,0,0];return nr(i,i,Nh(lu(e.canonical))),nr(i,i,r),i},s.dV=r=>({u_matrix:new fs(r),u_texsize:new ko(r),u_pixels_to_tile_units:new im(r),u_device_pixel_ratio:new ys(r),u_width_scale:new ys(r),u_floor_width_scale:new ys(r),u_image:new tm(r),u_units_to_pixels:new ko(r),u_tile_units_to_pixels:new ys(r),u_alpha_discard_threshold:new ys(r),u_trim_offset:new ko(r),u_trim_fade_range:new ko(r),u_trim_color:new Fd(r),u_emissive_strength:new ys(r),u_zbias_factor:new ys(r),u_tile_to_meter:new ys(r),u_ground_shadow_factor:new Hu(r),u_pattern_transition:new ys(r)}),s.dW=r=>({u_matrix:new fs(r),u_pixels_to_tile_units:new im(r),u_device_pixel_ratio:new ys(r),u_width_scale:new ys(r),u_floor_width_scale:new ys(r),u_units_to_pixels:new ko(r),u_dash_image:new tm(r),u_gradient_image:new tm(r),u_image_height:new ys(r),u_texsize:new ko(r),u_tile_units_to_pixels:new ys(r),u_alpha_discard_threshold:new ys(r),u_trim_offset:new ko(r),u_trim_fade_range:new ko(r),u_trim_color:new Fd(r),u_emissive_strength:new ys(r),u_zbias_factor:new ys(r),u_tile_to_meter:new ys(r),u_ground_shadow_factor:new Hu(r)}),s.dX=r=>({u_camera_to_center_distance:new ys(r),u_extrude_scale:new im(r),u_device_pixel_ratio:new ys(r),u_matrix:new fs(r),u_inv_rot_matrix:new fs(r),u_merc_center:new ko(r),u_tile_id:new Hu(r),u_zoom_transition:new ys(r),u_up_dir:new Hu(r),u_emissive_strength:new ys(r)}),s.dY=Vu,s.dZ=$z,s.d_=class{constructor(r,e,i,a){this.context=r,this.format=a,this.size=i,this.texture=r.gl.createTexture();const[h,m,_]=this.size,{gl:v}=r;v.bindTexture(v.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,h,m,_,0,nw(this.format),rw(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),r!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,r),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},s.da=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.db=eA,s.dc=hw,s.dd=sA,s.de=zw,s.df=function(r,e){return r.readFields(Gk,{icons:[]},e)},s.dg=si,s.dh=hy,s.di=Tw,s.dj=Uc,s.dk=aa,s.dl=ul,s.dm=cc,s.dn=ui,s.dp=function(r){const e=r.indexOf(Ch);return e>=0?r.slice(0,e):r},s.dq=function(r){return r.indexOf(Ch)>=0},s.dr=function(r){const e=r.lastIndexOf(Ch);return e>=0?r.slice(e+1):""},s.ds=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.dt=function(r,e,i,a){return r.type==="custom"?new kk(r,e):new Uk[r.type](r,e,i,a)},s.du=xt,s.dv=function(r){const e=r.indexOf(Ch);return e>=0?r.slice(e+1):""},s.dw=class extends Qg{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},s.dx=Rd,s.dy=Xr,s.dz=function(r){return r({pluginStatus:Lo,pluginURL:Rc}),Rd.on("pluginStateChange",r),r},s.e=or,s.e$=function([r,e,i]){const a=Math.hypot(r,e,i),h=Math.atan2(r,i),m=.5*Math.PI-Math.acos(-e/a);return new U(Ls(h),Ls(m))},s.e0=(r,e,i,a,h,m)=>{const _=r.transform,v=_.projection.name==="globe";let E;if(m.paint.get("circle-pitch-alignment")==="map")if(v){const M=G_(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;E=Float32Array.from([M,0,0,M])}else E=_.calculatePixelsToTileUnitsMatrix(i);else E=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(_.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qs.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:cx,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(v){S.u_inv_rot_matrix=a,S.u_merc_center=h,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Aa(_.zoom);const M=h[0]*Nt,D=h[1]*Nt;S.u_up_dir=_.projection.upVector(new sl(0,0,0),M,D)}return S},s.e1=wA,s.e2=fo,s.e3=(r,e,i,a,h,m,_,v,E,S)=>{const M=r.transform,D=M.pitch<15?vA(.07,.7,J((14-M.zoom)/5,0,1)):.07,O=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:bA(r,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:m,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:xA(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:Se(e.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:S}},s.e4=(r,e,i,a,h,m,_,v,E,S)=>{const M=r.transform,D=M.calculatePixelsToTileUnitsMatrix(e),O=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=M.pitch<15?vA(.07,.7,J((14-M.zoom)/5,0,1)):.07;return{u_matrix:bA(r,e,i,a),u_pixels_to_tile_units:D,u_device_pixel_ratio:m,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:TA(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:xA(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(O?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:Se(e.tileID.canonical,0),u_ground_shadow_factor:S}},s.e5=Be,s.e6=Wf,s.e7=we,s.e8=Al,s.e9=uu,s.eA=Bw,s.eB=Nx,s.eC=Bx,s.eD=[1,1,1],s.eE=my,s.eF=Di,s.eG=function(r,e,i,a){var h=e[0],m=e[1],_=e[2],v=e[3];return r[0]=h+a*(i[0]-h),r[1]=m+a*(i[1]-m),r[2]=_+a*(i[2]-_),r[3]=v+a*(i[3]-v),r},s.eH=oy,s.eI=il,s.eJ=Pc,s.eK=function(r,e,i,a,h,m,_,v,E,S,M,D,O,N,V,$){var Z=new q(16);return Z[0]=r,Z[1]=e,Z[2]=i,Z[3]=a,Z[4]=h,Z[5]=m,Z[6]=_,Z[7]=v,Z[8]=E,Z[9]=S,Z[10]=M,Z[11]=D,Z[12]=O,Z[13]=N,Z[14]=V,Z[15]=$,Z},s.eL=L,s.eM=Wp,s.eN=Gu,s.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new St(1/0,1/0),max:new St(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=Iv(new St(0,0),new St(Nt,Nt),r),a=[];if(e&&!gm(i,this._globalClipBounds))return a;for(const h of this._activeRegions){if(h.hiddenByOverlap||!gm(i,h))continue;const m=ew(h.min,h.max,r);a.push({min:m.min,max:m.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return a}setSources(r){this._setSources(r.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(a).buckets[e.layer];h&&h.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),a=r.getClipMask(),h=r.getClipScope();for(const m of e){if(!m.footprint)continue;const _=Iv(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:i,clipMask:a,clipScope:h})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||mm(e.min,i.min)||mm(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(a,h){const m=(_,v)=>_+v;return a.length-h.length||a.reduce(m,"").localeCompare(h.reduce(m,""))})(e.clipScope,i.clipScope)));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];r=i.priority!==a.priority||!J_(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!Fl(i.clipScope,a.clipScope),this._activeRegions[e].hiddenByOverlap=a.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Gh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const h=a[i].priority;for(;i<a.length&&a[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let h=i;const m=i;for(;h!==a;){const _=this._activeRegions[h];_.hiddenByOverlap=!1;for(let v=0;v<m;v++){const E=this._activeRegions[v];if(!E.hiddenByOverlap&&_.order===Gh&&gm(_,E)&&(_.hiddenByOverlap=Ax(_.footprint,_.tileId,E.footprint,E.tileId),_.hiddenByOverlap))break}++h}i=a,a=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.eP=Gh,s.eQ=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new Sa,a=new Cr,h=[],m=r+1+2,_=e[0]+1,v=e[0]+1+(1+e.length),E=(S,M,D)=>{let O=S===m-1?S-2:S===0?S:S-1;return O+=D?24575:0,[O,M]};for(let S=0;S<m;++S)i.emplaceBack(...E(S,0,!0));for(let S=0;S<_;++S)for(let M=0;M<m;++M)i.emplaceBack(...E(M,S,(M===0||M===m-1)&&!0));for(let S=0;S<e.length;++S){const M=e[S];for(let D=0;D<m;++D)i.emplaceBack(...E(D,M,!0))}for(let S=0;S<e.length;++S){const M=a.length,D=e[S]+1+2,O=new Cr;for(let $=0;$<D-1;$++){const Z=$===D-2,K=Z?m*(v-e.length+S-$):m;for(let ne=0;ne<m-1;ne++){const ae=$*m+ne;$===0||Z||ne===0||ne===m-2?(O.emplaceBack(ae+1,ae,ae+K),O.emplaceBack(ae+K,ae+K+1,ae+1)):(a.emplaceBack(ae+1,ae,ae+K),a.emplaceBack(ae+K,ae+K+1,ae+1))}}const N=Lr.simpleSegment(0,M,i.length,a.length-M);for(let $=0;$<O.uint16.length;$+=3)a.emplaceBack(O.uint16[$],O.uint16[$+1],O.uint16[$+2]);const V=Lr.simpleSegment(0,M,i.length,a.length-M);h.push({withoutSkirts:N,withSkirts:V})}return{vertices:i,indices:a,segments:h}}_createGrid(r){const e=this._fillGridMeshWithLods(f,y);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,ov.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new Cr;for(let _=0;_<=f;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new ju,a=new ju,h=new ju,m=new ju;this._poleSegments=[];for(let _=0,v=0;_<d;_++){const E=360/(1<<_);i.emplaceBack(0,-Fr,0,.5,0),a.emplaceBack(0,-Fr,0,.5,1),h.emplaceBack(0,-Fr,0,.5,.5),m.emplaceBack(0,-Fr,0,.5,.5);for(let S=0;S<=f;S++){let M=S/f,D=0;const O=Oi(0,E,M),[N,V,$]=A(ax,lx,O,Fr);i.emplaceBack(N,V,$,M,D),a.emplaceBack(N,V,$,M,1-D);const Z=gn(O);M=.5+.5*Math.sin(Z),D=.5+.5*Math.cos(Z),h.emplaceBack(N,V,$,M,D),m.emplaceBack(N,V,$,M,1-D)}this._poleSegments.push(Lr.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,$f,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,$f,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(h,$f,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(m,$f,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.eR=Av,s.eS=Ne,s.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.eU=Y,s.eV=me,s.eW=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},s.eX=ms,s.eY=R,s.eZ=Jn,s.e_=oi,s.ea=wm,s.eb=qh,s.ec=iy,s.ed=Mv,s.ee=ge,s.ef=function(r,e){if(r===e){var i=e[1],a=e[2],h=e[3],m=e[6],_=e[7],v=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=a,r[9]=m,r[11]=e[14],r[12]=h,r[13]=_,r[14]=v}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},s.eg=zk,s.eh=hn,s.ei=$s,s.ej=256,s.ek=Rg,s.el=tl,s.em=Si,s.en=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},s.eo=ju,s.ep=$p,s.eq=og,s.er=function(r,e,i,a,h){return J((r-e)/(i-e)*(h-a)+a,a,h)},s.es=Uo,s.et=function(r,e){var i=e[0],a=e[1],h=e[2],m=e[3],_=e[4],v=e[5],E=e[6],S=e[7],M=e[8],D=M*_-v*S,O=-M*m+v*E,N=S*m-_*E,V=i*D+a*O+h*N;return V?(r[0]=D*(V=1/V),r[1]=(-M*a+h*S)*V,r[2]=(v*a-h*_)*V,r[3]=O*V,r[4]=(M*i-h*E)*V,r[5]=(-v*i+h*m)*V,r[6]=N*V,r[7]=(-S*i+a*E)*V,r[8]=(_*i-a*m)*V,r):null},s.eu=2,s.ev=Mr,s.ew=Ks,s.ex=tt,s.ey=function(r,e){var i=new q(3);tt(i,e);var a=1/i[0],h=1/i[1],m=1/i[2],_=e[0]*a,v=e[1]*h,E=e[2]*m,S=e[4]*a,M=e[5]*h,D=e[6]*m,O=e[8]*a,N=e[9]*h,V=e[10]*m,$=_+M+V,Z=0;return $>0?(Z=2*Math.sqrt($+1),r[3]=.25*Z,r[0]=(D-N)/Z,r[1]=(O-E)/Z,r[2]=(v-S)/Z):_>M&&_>V?(Z=2*Math.sqrt(1+_-M-V),r[3]=(D-N)/Z,r[0]=.25*Z,r[1]=(v+S)/Z,r[2]=(O+E)/Z):M>V?(Z=2*Math.sqrt(1+M-_-V),r[3]=(O-E)/Z,r[0]=(v+S)/Z,r[1]=.25*Z,r[2]=(D+N)/Z):(Z=2*Math.sqrt(1+V-_-M),r[3]=(v-S)/Z,r[0]=(O+E)/Z,r[1]=(D+N)/Z,r[2]=.25*Z),r},s.ez=function(r,e){var i=2*Math.acos(e[3]),a=Math.sin(i/2);return a>G?(r[0]=e[0]/a,r[1]=e[1]/a,r[2]=e[2]/a):(r[0]=1,r[1]=0,r[2]=0),i},s.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},s.f0=vn,s.f1=ow,s.f2=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!(function(i){if(Zr==null){const a=i.navigator?i.navigator.userAgent:null;Zr=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Zr})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},s.f3=function(r,e){yu=r,bo=e},s.f4=cv,s.f5=sm,s.f6=function(r){const e=[0,0,0],i=Ze(new Float64Array(16));return ct(i,r.pixelMatrix,r.globeMatrix),nr(e,e,i),new St(e[0],e[1])},s.f7=function(){const r=Qe;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(j),Qe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.f8=function(){si().acquire(j)},s.f9=Th,s.fA=At,s.fB=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==XS){const i=new Uint32Array(r,0,7),[,,a,h,m,_]=i;e=i.byteLength+h+m+_+m,(a!==r.byteLength||e>=r.byteLength)&&gi("Invalid b3dm header information.")}return JS(r,e)},s.fC=function(r,e){const i=hw(r);for(const a of i){for(const h of a.meshes)gz(h);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(_z(a.lights,e)))}return i},s.fD=sb,s.fE=mr,s.fF=C,s.fG=la,s.fH=Ba,s.fI=function(r){hl(),Js?.then((e=>{e.keys().then((i=>{for(let a=0;a<i.length-r;a++)e.delete(i[a]).catch((h=>gi(h.message)))})).catch((i=>gi(i.message)))})).catch((e=>gi(e.message)))},s.fa=function(r,e,i=!1){if(Lo===Ba.deferred||Lo===Ba.loading||Lo===Ba.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Rc=Qs.resolveURL(r),Lo=Ba.deferred,Pf=e,ks(),i||Md()},s.fb=function(r){Tn=Qs.resolveURL(r),Tt||(Tt=new Ae(si(),new fl)),Tt.broadcast("setMeshoptUrl",Tn)},s.fc=ss,s.fd=function(r){Zt=Qs.resolveURL(r),Tt||(Tt=new Ae(si(),new fl)),Tt.broadcast("setDracoUrl",Zt)},s.fe=En,s.ff=F,s.fg=function(r){const e=ta();if(!e)return;const i=e.delete(Do);r&&i.then((()=>r())).catch(r)},s.fh=se,s.fi=Lt,s.fj=cu,s.fk=Kh,s.fl=p2,s.fm=m2,s.fn=mA,s.fo=Xt,s.fp="hd_road_elevation",s.fq=Ei,s.fr=Ot,s.fs=jh,s.ft=ww,s.fu=Kg,s.fv=function(r,e,i,a,h,m,_,v=1,E,S,M){r.createArrays(),r.tilePixelRatio=Nt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const D=r.layers[0].layout,O=r.layers[0]._unevaluatedLayout._values,N={};N.scaleFactor=v,N.textSizeScaleRange=D.get("text-size-scale-range"),N.iconSizeScaleRange=D.get("icon-size-scale-range");const[V,$]=N.textSizeScaleRange,[Z,K]=N.iconSizeScaleRange;N.textScaleFactor=J(N.scaleFactor,V,$),N.iconScaleFactor=J(N.scaleFactor,Z,K);const ne=O["text-size"],ae=O["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:Le,maxZoom:at}=r.textSizeData;N.compositeTextSizes=[ne.possiblyEvaluate(new Yn(Le,{worldview:M}),m),ne.possiblyEvaluate(new Yn(at,{worldview:M}),m)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Le,maxZoom:at}=r.iconSizeData;N.compositeIconSizes=[ae.possiblyEvaluate(new Yn(Le,{worldview:M}),m),ae.possiblyEvaluate(new Yn(at,{worldview:M}),m)]}N.layoutTextSize=ne.possiblyEvaluate(new Yn(_+1,{worldview:M}),m),N.layoutIconSize=ae.possiblyEvaluate(new Yn(_+1,{worldview:M}),m),N.textMaxSize=ne.possiblyEvaluate(new Yn(18,{worldview:M}),m);const ue=D.get("symbol-placement"),Te=D.get("text-rotation-alignment")==="map"&&ue!=="point",_e=D.get("text-size");let Ie=!1;const Me=[];for(const Le of r.features){const at=D.get("text-font").evaluate(Le,{},m).join(","),Ge=_e.evaluate(Le,{},m)*N.textScaleFactor,ut=N.layoutTextSize.evaluate(Le,{},m)*N.textScaleFactor,gt=N.layoutIconSize.evaluate(Le,{},m)*N.iconScaleFactor,Et={horizontal:{},vertical:void 0},jt=Le.text;let Dt,vt=[0,0];if(jt){const un=jt.toString(),Nn=D.get("text-letter-spacing").evaluate(Le,{},m)*Fo,Zi=D.get("text-line-height").evaluate(Le,{},m)*Fo,$n=Cd(un)?Nn:0,Wn=D.get("text-anchor").evaluate(Le,{},m),es=D.get("text-variable-anchor");if(!es){const pt=D.get("text-radial-offset").evaluate(Le,{},m);if(pt)vt=QA(Wn,[pt*Fo,Sw]);else{const Qt=D.get("text-offset").evaluate(Le,{},m);vt=[Qt[0]*Fo,Qt[1]*Fo]}}let ye=Te?"center":D.get("text-justify").evaluate(Le,{},m);const pe=ue==="point",ft=pe?D.get("text-max-width").evaluate(Le,{},m)*Fo:1/0,Wt=pt=>{r.allowVerticalPlacement&&Id(un)&&(Et.vertical=yw(jt,e,i,h,at,ft,Zi,Wn,pt,$n,vt,tc.vertical,!0,ut,Ge,E))};if(!Te&&es){const pt=ye==="auto"?es.map((bi=>Aw(bi))):[ye];let Qt=!1;for(let bi=0;bi<pt.length;bi++){const vi=pt[bi];if(!Et.horizontal[vi])if(Qt)Et.horizontal[vi]=Et.horizontal[0];else{const Yi=yw(jt,e,i,h,at,ft,Zi,"center",vi,$n,vt,tc.horizontal,!1,ut,Ge,E);Yi&&(Et.horizontal[vi]=Yi,Qt=Yi.positionedLines.length===1)}}Wt("left")}else{if(ye==="auto"&&(ye=Aw(Wn)),pe||D.get("text-writing-mode").indexOf("horizontal")>=0||!Id(un)){const pt=yw(jt,e,i,h,at,ft,Zi,Wn,ye,$n,vt,tc.horizontal,!1,ut,Ge,E);pt&&(Et.horizontal[ye]=pt)}Wt(pe?"left":ye)}}let Mt,ot,et,It,Vt,bt,li=!1;const fi=D.get("icon-text-fit").evaluate(Le,{},m);if(Le.icon&&Le.icon.hasPrimary()){const un=qv(Le.icon,r.iconSizeData,O["icon-size"],m,r.zoom,Le,E,N.iconScaleFactor,M);Mt=un.iconPrimary,et=un.iconSecondary;const Nn=Mt.toString();if(ot=a.get(Nn),ot&&(Vt=D.get("icon-offset").evaluate(Le,{},m),bt=D.get("icon-anchor").evaluate(Le,{},m),Dt=qx(h.get(Nn),et?h.get(et.toString()):void 0,Vt,bt),li=ot.sdf,r.sdfIcons===void 0?r.sdfIcons=ot.sdf:r.sdfIcons!==ot.sdf&&gi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ot.pixelRatio!==r.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),et){const Zi=et.toString();It=a.get(Zi)}}Ie=Ie||!(!Le.icon||!Le.icon.hasSecondary());const ni=Iw(Et.horizontal)||Et.vertical;r.iconsInText||(r.iconsInText=!!ni&&ni.iconsInText);const Kt=ut*N.textScaleFactor/Fo,{defaultShapedIcon:ji,verticallyShapedIcon:ii}=bk(r,Dt,D,Le,m,Et,Kt,Vt,fi);fi!=="none"&&Dt&&(FA(Dt)||BA(Dt))&&(Xx(0,ot,Mt,Dt,ji,fi,S,a,h),Xx(0,It,et,Dt,ji,fi,S,a,h),ii&&(Xx(0,ot,Mt,Dt,ii,fi,S,a,h),Xx(0,It,et,Dt,ii,fi,S,a,h))),Dt=ji;const{iconBBox:Ri,iconVerticalBBox:qi}=yk(r,Dt,ii,D,Le,m,gt,Vt,N,h,bt);Me.push({feature:Le,shapedTextOrientations:Et,shapedText:ni,shapedIcon:Dt,iconPrimary:Mt,iconSecondary:et,iconOffset:Vt,iconAnchor:bt,verticallyShapedIcon:ii,layoutTextSize:ut,layoutIconSize:gt,textOffset:vt,isSDFIcon:li,iconTextFit:fi,iconCollisionBounds:Ri,iconVerticalCollisionBounds:qi})}return{featureData:Me,sizes:N,hasAnySecondaryIcon:Ie,textAlongLine:Te,symbolPlacement:ue}},s.fw=$A,s.fx=function(r,e,i,a,h,m,_,v,E,S){r.iconAtlasPositions=S.iconPositions;const{featureData:M,hasAnySecondaryIcon:D,sizes:O,textAlongLine:N,symbolPlacement:V}=e;for(const $ of M){const{shapedIcon:Z,verticallyShapedIcon:K,feature:ne,shapedTextOrientations:ae,shapedText:ue,layoutTextSize:Te,textOffset:_e,isSDFIcon:Ie,iconPrimary:Me,iconSecondary:Le,iconTextFit:at,iconOffset:Ge,iconCollisionBounds:ut,iconVerticalCollisionBounds:gt}=$;eI(Z,S.iconPositions,Me,Le),eI(K,S.iconPositions,Me,Le),xk(ae,S.iconPositions),vk(Me,Le,S.iconPositions),(ue||Z)&&wk(r,ne,ae,Z,K,E,O,Te,0,_e,Ie,a,h,_,v,D,at,Ge,N,V,ut,gt)}i&&r.generateCollisionDebugBuffers(m,r.collisionBoxArray,O.textScaleFactor)},s.fy=$t,s.fz=hb,s.g=function(r,e){return Xr(Object.assign(r,{method:"GET"}),e)},s.h=function(r){return r.indexOf("mapbox:")===0},s.i=function(r){return or.API_STYLE_REGEX.test(r)&&!er(r)},s.j=bs,s.k=vu,s.l=function(r){return decodeURIComponent(atob(r).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},s.m=function(r,e){return Xr(Object.assign(r,{type:"json"}),e)},s.n=Ul,s.o=Qs,s.p=function(r,e){return Xr(Object.assign(r,{method:"POST"}),e)},s.q=yo,s.r=Mo,s.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},s.t=function(){return Ft||(Ft=new se),Ft},s.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},s.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},s.w=gi,s.x=Gw,s.y=uc,s.z=Gs})),I(["./shared"],(function(s){function G(Ne){const Y=Ne?Ne.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function q(Ne){if(typeof Ne=="number"||typeof Ne=="boolean"||typeof Ne=="string"||Ne==null)return JSON.stringify(Ne);if(Array.isArray(Ne)){let J="[";for(const de of Ne)J+=`${q(de)},`;return`${J}]`}let Y="{";for(const J of Object.keys(Ne).sort())Y+=`${J}:${q(Ne[J])},`;return`${Y}}`}function ie(Ne){let Y="";for(const J of s.bw)Y+=`/${q(Ne[J])}`;return Y}class ce{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,J){this._layerConfigs={},this._layers={},this.update(Y,[],J)}update(Y,J,de){this._options=de;for(const Ce of Y)this._layerConfigs[Ce.id]=Ce,(this._layers[Ce.id]=s.dt(Ce,this.scope,null,this._options)).compileFilter(de),this.keyCache[Ce.id]&&delete this.keyCache[Ce.id];for(const Ce of J)delete this.keyCache[Ce],delete this._layerConfigs[Ce],delete this._layers[Ce];this.familiesBySource={};const Re=(function(Ce,Fe){const Ye={};for(let We=0;We<Ce.length;We++){const Ot=Ce[We];let xt=Fe&&Fe[Ot.id];xt||(Ot.type==="symbol"?xt=Ot.id:(xt=ie(Ot),Ot.type==="line"&&Ot.paint&&(function Ii(Ci){return typeof Ci=="string"&&Ci==="line-progress"||(Array.isArray(Ci)?Ci.some(Ii):!(!Ci||typeof Ci!="object")&&Object.values(Ci).some(Ii))})(Ot.paint["line-width"])&&(xt+=`/${q(Ot.paint["line-width"])}`))),Fe&&(Fe[Ot.id]=xt);let ui=Ye[xt];ui||(ui=Ye[xt]=[]),ui.push(Ot)}const Be=[];for(const We in Ye)Be.push(Ye[We]);return Be})(Object.values(this._layerConfigs),this.keyCache);for(const Ce of Re){const Fe=Ce.map((ui=>this._layers[ui.id])),Ye=Fe[0];if(Ye.visibility==="none")continue;const Be=Ye.source||"";let We=this.familiesBySource[Be];We||(We=this.familiesBySource[Be]={});const Ot=Ye.sourceLayer||"_geojsonTileLayer";let xt=We[Ot];xt||(xt=We[Ot]=[]),xt.push(Fe)}}}const be=1*s.fk;class He{constructor(Y){const J={},de=[];for(const Ye in Y){const Be=Y[Ye],We=J[Ye]={};for(const Ot in Be.glyphs){const xt=Be.glyphs[+Ot];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const ui=xt.metrics.localGlyph?be:1,Ii={x:0,y:0,w:xt.bitmap.width+2*ui,h:xt.bitmap.height+2*ui};de.push(Ii),We[Ot]=Ii}}const{w:Re,h:Ce}=s.G(de),Fe=new s.fj({width:Re||1,height:Ce||1});for(const Ye in Y){const Be=Y[Ye];for(const We in Be.glyphs){const Ot=Be.glyphs[+We];if(!Ot||Ot.bitmap.width===0||Ot.bitmap.height===0)continue;const xt=J[Ye][We],ui=Ot.metrics.localGlyph?be:1;s.fj.copy(Ot.bitmap,Fe,{x:0,y:0},{x:xt.x+ui,y:xt.y+ui},Ot.bitmap)}}this.image=Fe,this.positions=J}}function Je(Ne,Y,J){Ne[Y]?J&&(Ne[Y].center=J):Ne[Y]={floorIds:new Set,center:J||[0,0],floors:{}}}function it(Ne,Y,J,de){for(const Re of Y)Je(Ne,Re),Ne[Re].floors[J]=de,Ne[Re].floorIds.add(J)}function Ze(Ne){return{id:Ne.properties.id.toString(),center:Ne.properties.center.toString().split(";").map(Number)}}function Pt(Ne){return{id:Ne.properties.id.toString(),isDefault:!!Ne.properties.is_default&&Ne.properties.is_default,connections:Ne.properties.connected_floor_ids?new Set(Ne.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ne.properties.conflicted_floor_ids?new Set(Ne.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ne.properties.building_ids?new Set(Ne.properties.building_ids.toString().split(";")):new Set,name:Ne.properties.name.toString(),zIndex:Ne.properties.z_index}}function ct(Ne,Y){return Y.every((J=>Ne.properties&&Ne.properties[J]!=null))}function Gt(Ne){return ct(Ne,["type","id","name"])&&Ne.properties.type==="building"}function ei(Ne){return ct(Ne,["type","id","name","z_index"])&&Ne.properties.type==="floor"}s.fi(He,"GlyphAtlas");class Fi{constructor(Y){this.tileID=new s.aP(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=s.aY(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor,this.worldview=Y.worldview,this.indoor=Y.indoor}parse(Y,J,de,Re,Ce,Fe){this.status="parsing",this.data=Y,this.collisionBoxArray=new s.b2;const Ye=new s.fl(Object.keys(Y.layers).sort()),Be=new s.fm(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const We={},Ot=new s.fn(256,256),xt={featureIndex:Be,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Ot,availableImages:de,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const gi=this.indoor.indoorState.activeFloorsVisible,en=(function(sn,Rn,mr){const ds=(function(Hn,dn){if(!Hn)return s.w("No source layers defined in indoor specification"),dn;if(Hn.size===0)return dn;const jn=Hn.difference(dn);for(const Pn of jn)s.w(`Missing source layer required in indoor specification: ${Pn}`);return dn.intersection(dn)})(Rn.sourceLayers,new Set(Object.keys(sn.layers))),Zr=Rn.indoorState,Gr=(function(Hn,dn,jn,Pn){const fn=new Set,or=new Set,bs=new Set,er=new Map,Ro={},Jo=gs=>{const Ms=er.get(gs)||new Set;for(const Ys of fn)if((er.get(Ys)||new Set).has(gs)||Ms.has(Ys))return!0;return!1};for(const gs of dn){const Ms=Hn.layers[gs];if(Ms)for(let Ys=0;Ys<Ms.length;Ys++){const Da=Ms.feature(Ys);if(Gt(Da)){const{id:Mo,center:Qs}=Ze(Da);Je(Ro,Mo,Qs),fn.add(Mo)}else if(ei(Da)){const{id:Mo,isDefault:Qs,connections:nh,conflicts:ul,buildings:Do,name:yu,zIndex:bo}=Pt(Da);it(Ro,Do,Mo,{name:yu,zIndex:bo}),er.set(Mo,ul),(Mo===Pn||nh.has(Pn))&&fn.add(Mo),or.add(Mo),Qs&&bs.add(Mo)}}else s.w(`indoor source layer not found: ${gs}`)}if(jn)for(const gs of jn)or.has(gs)&&(Jo(gs)||fn.add(gs));for(const gs of bs)fn.has(gs)||Jo(gs)||fn.add(gs);return{buildings:Ro,activeFloors:fn}})(sn,ds,Zr.lastActiveFloors,Zr.selectedFloorId);return mr.send("setIndoorData",Gr),Gr})(Y,this.indoor,Ce);xt.activeFloors=gi?en.activeFloors:void 0}const ui=[],Ii=J.familiesBySource[this.source];for(const gi in Ii){const en=Y.layers[gi];if(!en)continue;let sn=!1,Rn=!1,mr=!1;for(const Hn of Ii[gi])Hn[0].type==="symbol"?sn=!0:Rn=!0,Hn[0].is3D()&&Hn[0].type!=="model"&&(mr=!0);if(this.extraShadowCaster&&!mr||this.isSymbolTile===!0&&!sn||this.isSymbolTile===!1&&!Rn)continue;en.version===1&&s.w(`Vector tile source "${this.source}" layer "${gi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ds=Ye.encode(gi),Zr=[];let Gr=!1;for(let Hn=0,dn=0;Hn<en.length;Hn++){const jn=en.feature(Hn),Pn=Be.getId(jn,gi);if(this.localizableLayerIds&&this.localizableLayerIds.has(gi)){const fn=jn.properties?jn.properties.worldview:null;if(this.worldview&&typeof fn=="string")if(fn==="all")jn.properties.$localized=!0;else{if(!fn.split(",").includes(this.worldview))continue;jn.properties.$localized=!0,jn.properties.worldview=this.worldview}}!Gr&&jn.properties&&jn.properties.hasOwnProperty(s.fo)&&(Gr=!0),Zr.push({feature:jn,id:Pn,index:dn,sourceLayerIndex:ds}),dn++}Gr&&!xt.elevationFeatures&&Y.layers.hasOwnProperty(s.fp)&&(xt.elevationFeatures=s.fq.parseFrom(Y.layers[s.fp],this.canonical));for(const Hn of Ii[gi]){const dn=Hn[0];if(this.extraShadowCaster&&(!dn.is3D()||dn.type==="model")||this.isSymbolTile!==void 0&&dn.type==="symbol"!==this.isSymbolTile||dn.minzoom&&this.zoom<Math.floor(dn.minzoom)||dn.maxzoom&&this.zoom>=dn.maxzoom||dn.visibility==="none")continue;Si(Hn,this.zoom,xt.brightness,de,this.worldview);const jn=We[dn.id]=dn.createBucket({index:Be.bucketLayerIDs.length,layers:Hn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ds,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Re,worldview:this.worldview});Be.bucketLayerIDs.push(Hn.map((fn=>s.B(fn.id,fn.scope))));let Pn=jn.prepare?jn.prepare():null;Pn!=null?(Pn=Pn.then((()=>jn.populate(Zr,xt,this.tileID.canonical,this.tileTransform))),ui.push(Pn)):jn.populate(Zr,xt,this.tileID.canonical,this.tileTransform)}}const Ci=()=>{let gi,en,sn,Rn,mr,ds;Ot.trim();const Zr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Gr=()=>{if(gi)return this.status="done",Fe(gi);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(We).filter((dn=>!dn.isEmpty())),featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:xt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(en&&sn&&Rn){const dn=new He(en),jn=new Map;for(const[or,bs]of sn.entries()){const{imagePosition:er}=s.ft(or,bs,s.fu);jn.set(or,er)}const Pn={};for(const or in We){const bs=We[or];bs instanceof s.b3&&(Si(bs.layers,this.zoom,xt.brightness,de,this.worldview),Pn[or]=s.fv(bs,en,dn.positions,sn,jn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,mr,this.worldview))}const fn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ce,sn,mr,(()=>{fn.iconsPending=!1,Hn(Pn,dn,fn)})),this.rasterizeIfNeeded(Ce,Rn,ds,(()=>{fn.patternsPending=!1,Hn(Pn,dn,fn)}))}},Hn=(dn,jn,Pn,fn)=>{if(Pn.iconsPending||Pn.patternsPending)return;const or=new s.fw(sn,Rn,this.lut);for(const bs in We){const er=We[bs];if(bs in dn)s.fx(er,dn[bs],this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,sn,or);else if(er.hasPattern&&(er instanceof s.b9||er instanceof s.ba||er instanceof s.e9)){Si(er.layers,this.zoom,xt.brightness,de,this.worldview);const Ro=Object.fromEntries(or.patternPositions);er.addFeatures(xt,this.tileID.canonical,Ro,de,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(We).filter((bs=>!bs.isEmpty())),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:jn.image,lineAtlas:Ot,imageAtlas:or,brightness:xt.brightness})};if(!this.extraShadowCaster){const dn=s.fr(xt.glyphDependencies,(fn=>Object.keys(fn).map(Number)));Object.keys(dn).length?Ce.send("getGlyphs",{uid:this.uid,stacks:dn},((fn,or)=>{gi||(gi=fn,en=or,Gr())}),void 0,!1,Zr):en={};const jn=Array.from(xt.iconDependencies.keys()).map((fn=>s.I.parse(fn)));jn.length?Ce.send("getImages",{images:jn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((fn,or)=>{gi||(gi=fn,sn=new Map,mr=this.updateImageMapAndGetImageTaskQueue(sn,or,xt.iconDependencies),Gr())}),void 0,!1,Zr):(sn=new Map,mr=new Map);const Pn=Array.from(xt.patternDependencies.keys()).map((fn=>s.I.parse(fn)));Pn.length?Ce.send("getImages",{images:Pn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((fn,or)=>{gi||(gi=fn,Rn=new Map,ds=this.updateImageMapAndGetImageTaskQueue(Rn,or,xt.patternDependencies),Gr())}),void 0,!1,Zr):(Rn=new Map,ds=new Map)}if(xt.elevationFeatures&&xt.elevationFeatures.length>0){const dn=[];for(const Pn of Object.values(We))if(Pn instanceof s.ba){const fn=Pn.getUnevaluatedPortalGraph();fn&&dn.push(fn)}const jn=s.fs.evaluate(dn);for(const Pn of Object.values(We))if(Pn instanceof s.ba){const fn=Y.layers[Ye.decode(Pn.sourceLayerIndex)];Pn.setEvaluatedPortalGraph(jn,fn,this.tileID.canonical,xt.availableImages,xt.brightness)}}Gr()};ui.length>0?Promise.allSettled(ui).then(Ci).catch(Fe):Ci()}updateParameters(Y){this.scaleFactor=Y.scaleFactor,this.showCollisionBoxes=Y.showCollisionBoxes,this.projection=Y.projection,this.brightness=Y.brightness,this.tileTransform=s.aY(Y.tileID.canonical,Y.projection),this.extraShadowCaster=Y.extraShadowCaster,this.lut=Y.lut,this.worldview=Y.worldview,this.indoor=Y.indoor}rasterizeIfNeeded(Y,J,de,Re){Array.from(J.values()).some((Ce=>Ce.usvg))?this.rasterize(Y,J,de,Re):Re()}updateImageMapAndGetImageTaskQueue(Y,J,de){const Re=new Map;for(const Ce of J.keys()){const Fe=de.get(Ce)||[];for(const Ye of Fe){const Be=Ye.toString(),We=J.get(Ye.id.toString());We.usvg?Re.has(Be)||(Re.set(Be,Ye),Y.set(Be,Object.assign({},We))):Y.set(Be,We)}}return Re}rasterize(Y,J,de,Re){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:de},((Ce,Fe)=>{if(!Ce)for(const[Ye,Be]of Fe.entries()){const We=Object.assign(J.get(Ye),{data:Be});J.set(Ye,We)}Re()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Si(Ne,Y,J,de,Re){const Ce=new s.ac(Y,{brightness:J,worldview:Re});for(const Fe of Ne)Fe.recalculate(Ce,de)}class qe extends s.E{constructor(Y,J,de,Re,Ce,Fe,Ye){super(),this.actor=Y,this.layerIndex=J,this.availableImages=de,this.availableModels=Re,this.loadVectorData=Fe||s.aL,this.loading={},this.loaded={},this.deduped=new s.aK(Y.scheduler),this.isSpriteLoaded=Ce,this.scheduler=Y.scheduler,this.brightness=Ye}loadTile(Y,J){const de=Y.uid,Re=Y&&Y.request,Ce=Re&&Re.collectResourceTiming,Fe=this.loading[de]=new Fi(Y);Fe.abort=this.loadVectorData(Y,((Ye,Be)=>{const We=!this.loading[de];if(delete this.loading[de],Fe.cancelRasterize(),We||Ye||!Be)return Fe.status="done",We||(this.loaded[de]=Fe),J(Ye);const Ot=Be.rawData,xt={},ui=s.aM(Be.responseHeaders);ui&&ui.expires&&(xt.expires=ui.expires),ui&&ui.cacheControl&&(xt.cacheControl=ui.cacheControl),Fe.vectorTile=Be.vectorTile||new s.fy(new s.bs(Ot));const Ii=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Ci,gi)=>{if(Ci||!gi)return J(Ci);const en={};if(Ce){const sn=G(Re);sn.length>0&&(en.resourceTiming=JSON.parse(JSON.stringify(sn)))}J(null,Object.assign({rawTileData:Ot.slice(0),responseHeaders:Be.responseHeaders},gi,xt,en))}))};this.isSpriteLoaded?Ii():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(Ii,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Ii()})),this.loaded=this.loaded||{},this.loaded[de]=Fe}))}reloadTile(Y,J){const de=this.loaded,Re=Y.uid;if(de&&de[Re]){const Ce=de[Re];Ce.updateParameters(Y);const Fe=(Ye,Be)=>{const We=Ce.reloadCallback;We&&(delete Ce.reloadCallback,Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,We)),J(Ye,Be)};Ce.status==="parsing"?Ce.reloadCallback=Fe:Ce.status==="done"&&(Ce.vectorTile?Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else J(null,void 0)}abortTile(Y,J){const de=Y.uid,Re=this.loading[de];Re&&(Re.abort&&Re.abort(),delete this.loading[de]),J()}removeTile(Y,J){const de=this.loaded,Re=Y.uid;de&&de[Re]&&delete de[Re],J()}}class Oe{loadTile(Y,J){const{uid:de,encoding:Re,rawImageData:Ce,padding:Fe}=Y,Ye=ImageBitmap&&Ce instanceof ImageBitmap?this.getImageData(Ce,Fe):Ce;J(null,new s.fz(de,Ye,Re,Fe<1))}reloadTile(Y,J){J(null,null)}abortTile(Y,J){J()}removeTile(Y,J){J()}getImageData(Y,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const de=this.offscreenCanvasContext.getImageData(-J,-J,Y.width+2*J,Y.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}s.br.setPbf(s.bs);class je{constructor(Y){this._mrt=new s.br(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,J){const de=this._mrt;this.status="parsing",this._entireBuffer=Y;try{de.parseHeader(Y),this._isHeaderLoaded=!0;const Re=[];for(const Ce in de.layers){const Fe=de.getLayer(Ce),Ye=Fe.getDataRange(Fe.getBandList()),Be=de.createDecodingTask(Ye),We=Y.slice(Ye.firstByte,Ye.lastByte+1),Ot=s.br.performDecoding(We,Be).then((xt=>Be.complete(null,xt))).catch((xt=>Be.complete(xt,null)));Re.push(Ot)}Promise.allSettled(Re).then((()=>J(null,de))).catch((Ce=>J(Ce)))}catch(Re){J(Re)}}}class tt{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,J){const de=Y.uid,Re=Y.request,Ce=this.loading[de]=new je(Y),{cancel:Fe}=s.bt(Re,((Ye,Be,We)=>{const Ot=!this.loading[de];if(delete this.loading[de],Ot||Ye||!Be)return Ce.status="done",Ot||(this.loaded[de]=Ce),J(Ye);Ce.parse(Be,((xt,ui)=>{if(xt||!ui)return J(xt);J(null,ui,We)})),this.loaded[de]=Ce}));Ce.abort=Fe}reloadTile(Y,J){J(null,void 0)}abortTile(Y,J){const de=Y.uid,Re=this.loading[de];Re&&(Re.abort&&Re.abort(),delete this.loading[de]),J()}removeTile(Y,J){const de=Y.uid;this.loaded[de]&&delete this.loaded[de],J()}decodeRasterArray(Y,J){s.br.performDecoding(Y.buffer,Y.task).then((de=>J(null,de))).catch((de=>J(de)))}}const nt=s.fA.prototype.toGeoJSON;class yt{constructor(Y){this._feature=Y,this.extent=s.al,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const J of this._feature.geometry)Y.push([new s.P(J[0],J[1])]);return Y}{const Y=[];for(const J of this._feature.geometry){const de=[];for(const Re of J)de.push(new s.P(Re[0],Re[1]));Y.push(de)}return Y}}toGeoJSON(Y,J,de){return nt.call(this,Y,J,de)}}class ze{constructor(Y,J){this.name=Y,this.extent=s.al,this.length=J.length,this._jsonFeatures=J}feature(Y){return new yt(this._jsonFeatures[Y])}}class ur{constructor(Y){this.layers={},this.extent=s.al;for(const J of Object.keys(Y))this.layers[J]=new ze(J,Y[J])}}const qn=64/4096,Ct=128;class oi{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],J){for(const de of Y){const Re=de.id;if(Re==null)continue;let Ce=this.features.get(Re);Ce&&this.updateCache(Ce,J),de.geometry?(Ce=bn(de),this.updateCache(Ce,J),this.features.set(Re,Ce)):this.features.delete(Re),this.updateCache(Ce,J)}}updateCache(Y,J){for(const{canonical:de,uid:Re}of Object.values(J)){const{z:Ce,x:Fe,y:Ye}=de;wi(Y,Math.pow(2,Ce),Fe,Ye)&&delete J[Re]}}getTile(Y,J,de){const Re=Math.pow(2,Y),Ce=[];for(const Fe of this.features.values())wi(Fe,Re,J,de)&&Ce.push(ai(Fe,Re,J,de));return{features:Ce}}getFeatures(){return[...this.features.values()]}}function wi({minX:Ne,minY:Y,maxX:J,maxY:de},Re,Ce,Fe){return Ne<(Ce+1+qn)/Re&&Y<(Fe+1+qn)/Re&&J>(Ce-qn)/Re&&de>(Fe-qn)/Re}function bn(Ne){const{id:Y,geometry:J,properties:de}=Ne;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Re,coordinates:Ce}=J,Fe={id:Y,type:1,geometry:[],tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ye=Fe.geometry;if(Re==="Point")Cn(Ce,Ye,Fe);else if(Re==="MultiPoint")for(const Be of Ce)Cn(Be,Ye,Fe);else if(Re==="LineString")Fe.type=2,rt(Ce,Ye,Fe);else if(Re==="MultiLineString")Fe.type=2,Yt(Ce,Ye,Fe);else if(Re==="Polygon")Fe.type=3,Yt(Ce,Ye,Fe,!0);else{if(Re!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const Be of Ce)Yt(Be,Ye,Fe,!0)}return Fe}function Cn([Ne,Y],J,de){const Re=s.aF(Ne);let Ce=s.aJ(Y);Ce=Ce<0?0:Ce>1?1:Ce,J.push(Re,Ce),de.minX=Math.min(de.minX,Re),de.minY=Math.min(de.minY,Ce),de.maxX=Math.max(de.maxX,Re),de.maxY=Math.max(de.maxY,Ce)}function rt(Ne,Y,J,de=!1,Re=!1){const Ce=[];for(const Fe of Ne)Cn(Fe,Ce,J);Y.push(Ce),de&&(function(Fe,Ye){let Be=0;for(let We=0,Ot=Fe.length,xt=Ot-2;We<Ot;xt=We,We+=2)Be+=(Fe[We]-Fe[xt])*(Fe[We+1]+Fe[xt+1]);if(Be>0===Ye)for(let We=0,Ot=Fe.length;We<Ot/2;We+=2){const xt=Fe[We],ui=Fe[We+1];Fe[We]=Fe[Ot-2-We],Fe[We+1]=Fe[Ot-1-We],Fe[Ot-2-We]=xt,Fe[Ot-1-We]=ui}})(Ce,Re)}function Yt(Ne,Y,J,de=!1){for(let Re=0;Re<Ne.length;Re++)rt(Ne[Re],Y,J,de,Re===0)}function ai(Ne,Y,J,de){const{id:Re,type:Ce,geometry:Fe,tags:Ye}=Ne,Be=[];if(Ce===1)(function(We,Ot,xt,ui,Ii){for(let Ci=0;Ci<We.length;Ci+=2){const gi=Math.round(s.al*(We[Ci+0]*Ot-xt)),en=Math.round(s.al*(We[Ci+1]*Ot-ui));Ii.push([gi,en])}})(Fe,Y,J,de,Be);else for(const We of Fe)_i(We,Y,J,de,Be);return{id:Re,type:Ce,geometry:Be,tags:Ye}}function _i(Ne,Y,J,de,Re){const Ce=-Ct,Fe=s.al+Ct;let Ye;for(let Be=0;Be<Ne.length-2;Be+=2){let We=Math.round(s.al*(Ne[Be+0]*Y-J)),Ot=Math.round(s.al*(Ne[Be+1]*Y-de)),xt=Math.round(s.al*(Ne[Be+2]*Y-J)),ui=Math.round(s.al*(Ne[Be+3]*Y-de));const Ii=xt-We,Ci=ui-Ot;We<Ce&&xt<Ce||(We<Ce?(Ot+=Math.round(Ci*((Ce-We)/Ii)),We=Ce):xt<Ce&&(ui=Ot+Math.round(Ci*((Ce-We)/Ii)),xt=Ce),Ot<Ce&&ui<Ce||(Ot<Ce?(We+=Math.round(Ii*((Ce-Ot)/Ci)),Ot=Ce):ui<Ce&&(xt=We+Math.round(Ii*((Ce-Ot)/Ci)),ui=Ce),We>=Fe&&xt>=Fe||(We>=Fe?(Ot+=Math.round(Ci*((Fe-We)/Ii)),We=Fe):xt>=Fe&&(ui=Ot+Math.round(Ci*((Fe-We)/Ii)),xt=Fe),Ot>=Fe&&ui>=Fe||(Ot>=Fe?(We+=Math.round(Ii*((Fe-Ot)/Ci)),Ot=Fe):ui>=Fe&&(xt=We+Math.round(Ii*((Fe-Ot)/Ci)),ui=Fe),Ye&&We===Ye[Ye.length-1][0]&&Ot===Ye[Ye.length-1][1]||(Ye=[[We,Ot]],Re.push(Ye)),Ye.push([xt,ui])))))}}function ln({name:Ne,features:Y},J){J.writeStringField(1,Ne),J.writeVarintField(5,s.al);const de=new Map,Re=new Map,Ce={keys:de,values:Re,feature:null};for(const Fe of Y)Ce.feature=Fe,J.writeMessage(2,kn,Ce);for(const Fe of de.keys())J.writeStringField(3,Fe);for(const Fe of Re.keys())J.writeMessage(4,Wr,Fe)}function kn(Ne,Y){const J=Ne.feature;J.id!==void 0&&Number.isSafeInteger(+J.id)&&Y.writeVarintField(1,+J.id),J.tags&&Y.writeMessage(2,Jn,Ne),Y.writeVarintField(3,J.type),Y.writeMessage(4,hr,J)}function Jn({keys:Ne,values:Y,feature:J},de){for(const Re of Object.keys(J.tags)){let Ce=J.tags[Re];if(Ce===null)continue;let Fe=Ne.get(Re);Fe===void 0&&(Fe=Ne.size,Ne.set(Re,Fe)),de.writeVarint(Fe);const Ye=typeof Ce;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(Ce=JSON.stringify(Ce));let Be=Y.get(Ce);Be===void 0&&(Be=Y.size,Y.set(Ce,Be)),de.writeVarint(Be)}}function Mr(Ne,Y){return(Y<<3)+(7&Ne)}function Ki(Ne){return Ne<<1^Ne>>31}function hr(Ne,Y){const{geometry:J,type:de}=Ne;let Re=0,Ce=0;if(de===1){Y.writeVarint(Mr(1,J.length));for(const Fe of J){const Ye=Fe[0]-Re,Be=Fe[1]-Ce;Y.writeVarint(Ki(Ye)),Y.writeVarint(Ki(Be)),Re+=Ye,Ce+=Be}}else for(const Fe of J){Y.writeVarint(Mr(1,1));const Ye=Fe.length-(de===3?1:0);for(let Be=0;Be<Ye;Be++){Be===1&&Y.writeVarint(Mr(2,Ye-1));const We=Fe[Be][0]-Re,Ot=Fe[Be][1]-Ce;Y.writeVarint(Ki(We)),Y.writeVarint(Ki(Ot)),Re+=We,Ce+=Ot}de===3&&Y.writeVarint(Mr(7,1))}}function Wr(Ne,Y){const J=typeof Ne;J==="string"?Y.writeStringField(1,Ne):J==="boolean"?Y.writeBooleanField(7,Ne):J==="number"&&(Ne%1!=0?Y.writeDoubleField(3,Ne):Ne<0?Y.writeSVarintField(6,Ne):Y.writeVarintField(5,Ne))}const co={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},nr=Math.fround||(ps=new Float32Array(1),Ne=>(ps[0]=+Ne,ps[0]));var ps;const rr=3,Ds=5,Us=6;class Dr{constructor(Y){this.options=Object.assign(Object.create(co),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:J,minZoom:de,maxZoom:Re}=this.options;J&&console.time("total time");const Ce=`prepare ${Y.length} points`;J&&console.time(Ce),this.points=Y;const Fe=[];for(let Be=0;Be<Y.length;Be++){const We=Y[Be];if(!We.geometry)continue;const[Ot,xt]=We.geometry.coordinates,ui=nr(Di(Ot)),Ii=nr(rn(xt));Fe.push(ui,Ii,1/0,Be,-1,1),this.options.reduce&&Fe.push(0)}let Ye=this.trees[Re+1]=this._createTree(Fe);J&&console.timeEnd(Ce);for(let Be=Re;Be>=de;Be--){const We=+Date.now();Ye=this.trees[Be]=this._createTree(this._cluster(Ye,Be)),J&&console.log("z%d: %d clusters in %dms",Be,Ye.numItems,+Date.now()-We)}return J&&console.timeEnd("total time"),this}getClusters(Y,J){let de=((Y[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,Y[1]));let Ce=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)de=-180,Ce=180;else if(de>Ce){const xt=this.getClusters([de,Re,180,Fe],J),ui=this.getClusters([-180,Re,Ce,Fe],J);return xt.concat(ui)}const Ye=this.trees[this._limitZoom(J)],Be=Ye.range(Di(de),rn(Fe),Di(Ce),rn(Re)),We=Ye.data,Ot=[];for(const xt of Be){const ui=this.stride*xt;Ot.push(We[ui+Ds]>1?ms(We,ui,this.clusterProps):this.points[We[ui+rr]])}return Ot}getChildren(Y){const J=this._getOriginId(Y),de=this._getOriginZoom(Y),Re="No cluster with the specified id.",Ce=this.trees[de];if(!Ce)throw new Error(Re);const Fe=Ce.data;if(J*this.stride>=Fe.length)throw new Error(Re);const Ye=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Be=Ce.within(Fe[J*this.stride],Fe[J*this.stride+1],Ye),We=[];for(const Ot of Be){const xt=Ot*this.stride;Fe[xt+4]===Y&&We.push(Fe[xt+Ds]>1?ms(Fe,xt,this.clusterProps):this.points[Fe[xt+rr]])}if(We.length===0)throw new Error(Re);return We}getLeaves(Y,J,de){const Re=[];return this._appendLeaves(Re,Y,J=J||10,de=de||0,0),Re}getTile(Y,J,de){const Re=this.trees[this._limitZoom(Y)],Ce=Math.pow(2,Y),{extent:Fe,radius:Ye}=this.options,Be=Ye/Fe,We=(de-Be)/Ce,Ot=(de+1+Be)/Ce,xt={features:[]};return this._addTileFeatures(Re.range((J-Be)/Ce,We,(J+1+Be)/Ce,Ot),Re.data,J,de,Ce,xt),J===0&&this._addTileFeatures(Re.range(1-Be/Ce,We,1,Ot),Re.data,Ce,de,Ce,xt),J===Ce-1&&this._addTileFeatures(Re.range(0,We,Be/Ce,Ot),Re.data,-1,de,Ce,xt),xt.features.length?xt:null}getClusterExpansionZoom(Y){let J=this._getOriginZoom(Y)-1;for(;J<=this.options.maxZoom;){const de=this.getChildren(Y);if(J++,de.length!==1)break;Y=de[0].properties.cluster_id}return J}_appendLeaves(Y,J,de,Re,Ce){const Fe=this.getChildren(J);for(const Ye of Fe){const Be=Ye.properties;if(Be&&Be.cluster?Ce+Be.point_count<=Re?Ce+=Be.point_count:Ce=this._appendLeaves(Y,Be.cluster_id,de,Re,Ce):Ce<Re?Ce++:Y.push(Ye),Y.length===de)break}return Ce}_createTree(Y){const J=new s.c3(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<Y.length;de+=this.stride)J.add(Y[de],Y[de+1]);return J.finish(),J.data=Y,J}_addTileFeatures(Y,J,de,Re,Ce,Fe){for(const Ye of Y){const Be=Ye*this.stride,We=J[Be+Ds]>1;let Ot,xt,ui;if(We)Ot=hs(J,Be,this.clusterProps),xt=J[Be],ui=J[Be+1];else{const gi=this.points[J[Be+rr]];Ot=gi.properties;const[en,sn]=gi.geometry.coordinates;xt=Di(en),ui=rn(sn)}const Ii={type:1,geometry:[[Math.round(this.options.extent*(xt*Ce-de)),Math.round(this.options.extent*(ui*Ce-Re))]],tags:Ot};let Ci;Ci=We||this.options.generateId?J[Be+rr]:this.points[J[Be+rr]].id,Ci!==void 0&&(Ii.id=Ci),Fe.features.push(Ii)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,J){const{radius:de,extent:Re,reduce:Ce,minPoints:Fe}=this.options,Ye=de/(Re*Math.pow(2,J)),Be=Y.data,We=[],Ot=this.stride;for(let xt=0;xt<Be.length;xt+=Ot){if(Be[xt+2]<=J)continue;Be[xt+2]=J;const ui=Be[xt],Ii=Be[xt+1],Ci=Y.within(Be[xt],Be[xt+1],Ye),gi=Be[xt+Ds];let en=gi;for(const sn of Ci){const Rn=sn*Ot;Be[Rn+2]>J&&(en+=Be[Rn+Ds])}if(en>gi&&en>=Fe){let sn,Rn=ui*gi,mr=Ii*gi,ds=-1;const Zr=(xt/Ot<<5)+(J+1)+this.points.length;for(const Gr of Ci){const Hn=Gr*Ot;if(Be[Hn+2]<=J)continue;Be[Hn+2]=J;const dn=Be[Hn+Ds];Rn+=Be[Hn]*dn,mr+=Be[Hn+1]*dn,Be[Hn+4]=Zr,Ce&&(sn||(sn=this._map(Be,xt,!0),ds=this.clusterProps.length,this.clusterProps.push(sn)),Ce(sn,this._map(Be,Hn)))}Be[xt+4]=Zr,We.push(Rn/en,mr/en,1/0,Zr,-1,en),Ce&&We.push(ds)}else{for(let sn=0;sn<Ot;sn++)We.push(Be[xt+sn]);if(en>1)for(const sn of Ci){const Rn=sn*Ot;if(!(Be[Rn+2]<=J)){Be[Rn+2]=J;for(let mr=0;mr<Ot;mr++)We.push(Be[Rn+mr])}}}}return We}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,J,de){if(Y[J+Ds]>1){const Fe=this.clusterProps[Y[J+Us]];return de?Object.assign({},Fe):Fe}const Re=this.points[Y[J+rr]].properties,Ce=this.options.map(Re);return de&&Ce===Re?Object.assign({},Ce):Ce}}function ms(Ne,Y,J){return{type:"Feature",id:Ne[Y+rr],properties:hs(Ne,Y,J),geometry:{type:"Point",coordinates:[(de=Ne[Y],360*(de-.5)),vn(Ne[Y+1])]}};var de}function hs(Ne,Y,J){const de=Ne[Y+Ds],Re=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,Ce=Ne[Y+Us],Fe=Ce===-1?{}:Object.assign({},J[Ce]);return Object.assign(Fe,{cluster:!0,cluster_id:Ne[Y+rr],point_count:de,point_count_abbreviated:Re})}function Di(Ne){return Ne/360+.5}function rn(Ne){const Y=Math.sin(Ne*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function vn(Ne){const Y=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function $i(Ne,Y,J,de){let Re=de;const Ce=Y+(J-Y>>1);let Fe,Ye=J-Y;const Be=Ne[Y],We=Ne[Y+1],Ot=Ne[J],xt=Ne[J+1];for(let ui=Y+3;ui<J;ui+=3){const Ii=Ks(Ne[ui],Ne[ui+1],Be,We,Ot,xt);if(Ii>Re)Fe=ui,Re=Ii;else if(Ii===Re){const Ci=Math.abs(ui-Ce);Ci<Ye&&(Fe=ui,Ye=Ci)}}Re>de&&(Fe-Y>3&&$i(Ne,Y,Fe,de),Ne[Fe+2]=Re,J-Fe>3&&$i(Ne,Fe,J,de))}function Ks(Ne,Y,J,de,Re,Ce){let Fe=Re-J,Ye=Ce-de;if(Fe!==0||Ye!==0){const Be=((Ne-J)*Fe+(Y-de)*Ye)/(Fe*Fe+Ye*Ye);Be>1?(J=Re,de=Ce):Be>0&&(J+=Fe*Be,de+=Ye*Be)}return Fe=Ne-J,Ye=Y-de,Fe*Fe+Ye*Ye}function Kn(Ne,Y,J,de){const Re={id:Ne??null,type:Y,geometry:J,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")uo(Re,J);else if(Y==="Polygon")uo(Re,J[0]);else if(Y==="MultiLineString")for(const Ce of J)uo(Re,Ce);else if(Y==="MultiPolygon")for(const Ce of J)uo(Re,Ce[0]);return Re}function uo(Ne,Y){for(let J=0;J<Y.length;J+=3)Ne.minX=Math.min(Ne.minX,Y[J]),Ne.minY=Math.min(Ne.minY,Y[J+1]),Ne.maxX=Math.max(Ne.maxX,Y[J]),Ne.maxY=Math.max(Ne.maxY,Y[J+1])}function Uo(Ne,Y,J,de){if(!Y.geometry)return;const Re=Y.geometry.coordinates;if(Re&&Re.length===0)return;const Ce=Y.geometry.type,Fe=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let Ye=[],Be=Y.id;if(J.promoteId?Be=Y.properties[J.promoteId]:J.generateId&&(Be=de||0),Ce==="Point")jo(Re,Ye);else if(Ce==="MultiPoint")for(const We of Re)jo(We,Ye);else if(Ce==="LineString")ac(Re,Ye,Fe,!1);else if(Ce==="MultiLineString"){if(J.lineMetrics){for(const We of Re)Ye=[],ac(We,Ye,Fe,!1),Ne.push(Kn(Be,"LineString",Ye,Y.properties));return}$a(Re,Ye,Fe,!1)}else if(Ce==="Polygon")$a(Re,Ye,Fe,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(const We of Y.geometry.geometries)Uo(Ne,{id:Be,geometry:We,properties:Y.properties},J,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const We of Re){const Ot=[];$a(We,Ot,Fe,!0),Ye.push(Ot)}}Ne.push(Kn(Be,Ce,Ye,Y.properties))}function jo(Ne,Y){Y.push(Nc(Ne[0]),Yo(Ne[1]),0)}function ac(Ne,Y,J,de){let Re,Ce,Fe=0;for(let Be=0;Be<Ne.length;Be++){const We=Nc(Ne[Be][0]),Ot=Yo(Ne[Be][1]);Y.push(We,Ot,0),Be>0&&(Fe+=de?(Re*Ot-We*Ce)/2:Math.sqrt(Math.pow(We-Re,2)+Math.pow(Ot-Ce,2))),Re=We,Ce=Ot}const Ye=Y.length-3;Y[2]=1,$i(Y,0,Ye,J),Y[Ye+2]=1,Y.size=Math.abs(Fe),Y.start=0,Y.end=Y.size}function $a(Ne,Y,J,de){for(let Re=0;Re<Ne.length;Re++){const Ce=[];ac(Ne[Re],Ce,J,de),Y.push(Ce)}}function Nc(Ne){return Ne/360+.5}function Yo(Ne){const Y=Math.sin(Ne*Math.PI/180),J=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return J<0?0:J>1?1:J}function pr(Ne,Y,J,de,Re,Ce,Fe,Ye){if(de/=Y,Ce>=(J/=Y)&&Fe<de)return Ne;if(Fe<J||Ce>=de)return null;const Be=[];for(const We of Ne){const Ot=We.geometry;let xt=We.type;const ui=Re===0?We.minX:We.minY,Ii=Re===0?We.maxX:We.maxY;if(ui>=J&&Ii<de){Be.push(We);continue}if(Ii<J||ui>=de)continue;let Ci=[];if(xt==="Point"||xt==="MultiPoint")Co(Ot,Ci,J,de,Re);else if(xt==="LineString")Ts(Ot,Ci,J,de,Re,!1,Ye.lineMetrics);else if(xt==="MultiLineString")Qo(Ot,Ci,J,de,Re,!1);else if(xt==="Polygon")Qo(Ot,Ci,J,de,Re,!0);else if(xt==="MultiPolygon")for(const gi of Ot){const en=[];Qo(gi,en,J,de,Re,!0),en.length&&Ci.push(en)}if(Ci.length){if(Ye.lineMetrics&&xt==="LineString"){for(const gi of Ci)Be.push(Kn(We.id,xt,gi,We.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(Ci.length===1?(xt="LineString",Ci=Ci[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=Ci.length===3?"Point":"MultiPoint"),Be.push(Kn(We.id,xt,Ci,We.tags))}}return Be.length?Be:null}function Co(Ne,Y,J,de,Re){for(let Ce=0;Ce<Ne.length;Ce+=3){const Fe=Ne[Ce+Re];Fe>=J&&Fe<=de&&ma(Y,Ne[Ce],Ne[Ce+1],Ne[Ce+2])}}function Ts(Ne,Y,J,de,Re,Ce,Fe){let Ye=cl(Ne);const Be=Re===0?dr:Ps;let We,Ot,xt=Ne.start;for(let en=0;en<Ne.length-3;en+=3){const sn=Ne[en],Rn=Ne[en+1],mr=Ne[en+2],ds=Ne[en+3],Zr=Ne[en+4],Gr=Re===0?sn:Rn,Hn=Re===0?ds:Zr;let dn=!1;Fe&&(We=Math.sqrt(Math.pow(sn-ds,2)+Math.pow(Rn-Zr,2))),Gr<J?Hn>J&&(Ot=Be(Ye,sn,Rn,ds,Zr,J),Fe&&(Ye.start=xt+We*Ot)):Gr>de?Hn<de&&(Ot=Be(Ye,sn,Rn,ds,Zr,de),Fe&&(Ye.start=xt+We*Ot)):ma(Ye,sn,Rn,mr),Hn<J&&Gr>=J&&(Ot=Be(Ye,sn,Rn,ds,Zr,J),dn=!0),Hn>de&&Gr<=de&&(Ot=Be(Ye,sn,Rn,ds,Zr,de),dn=!0),!Ce&&dn&&(Fe&&(Ye.end=xt+We*Ot),Y.push(Ye),Ye=cl(Ne)),Fe&&(xt+=We)}let ui=Ne.length-3;const Ii=Ne[ui],Ci=Ne[ui+1],gi=Re===0?Ii:Ci;gi>=J&&gi<=de&&ma(Ye,Ii,Ci,Ne[ui+2]),ui=Ye.length-3,Ce&&ui>=3&&(Ye[ui]!==Ye[0]||Ye[ui+1]!==Ye[1])&&ma(Ye,Ye[0],Ye[1],Ye[2]),Ye.length&&Y.push(Ye)}function cl(Ne){const Y=[];return Y.size=Ne.size,Y.start=Ne.start,Y.end=Ne.end,Y}function Qo(Ne,Y,J,de,Re,Ce){for(const Fe of Ne)Ts(Fe,Y,J,de,Re,Ce,!1)}function ma(Ne,Y,J,de){Ne.push(Y,J,de)}function dr(Ne,Y,J,de,Re,Ce){const Fe=(Ce-Y)/(de-Y);return ma(Ne,Ce,J+(Re-J)*Fe,1),Fe}function Ps(Ne,Y,J,de,Re,Ce){const Fe=(Ce-J)/(Re-J);return ma(Ne,Y+(de-Y)*Fe,Ce,1),Fe}function Es(Ne,Y){const J=[];for(let de=0;de<Ne.length;de++){const Re=Ne[de],Ce=Re.type;let Fe;if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")Fe=Go(Re.geometry,Y);else if(Ce==="MultiLineString"||Ce==="Polygon"){Fe=[];for(const Ye of Re.geometry)Fe.push(Go(Ye,Y))}else if(Ce==="MultiPolygon"){Fe=[];for(const Ye of Re.geometry){const Be=[];for(const We of Ye)Be.push(Go(We,Y));Fe.push(Be)}}J.push(Kn(Re.id,Ce,Fe,Re.tags))}return J}function Go(Ne,Y){const J=[];J.size=Ne.size,Ne.start!==void 0&&(J.start=Ne.start,J.end=Ne.end);for(let de=0;de<Ne.length;de+=3)J.push(Ne[de]+Y,Ne[de+1],Ne[de+2]);return J}function js(Ne,Y){if(Ne.transformed)return Ne;const J=1<<Ne.z,de=Ne.x,Re=Ne.y;for(const Ce of Ne.features){const Fe=Ce.geometry,Ye=Ce.type;if(Ce.geometry=[],Ye===1)for(let Be=0;Be<Fe.length;Be+=2)Ce.geometry.push(Ma(Fe[Be],Fe[Be+1],Y,J,de,Re));else for(let Be=0;Be<Fe.length;Be++){const We=[];for(let Ot=0;Ot<Fe[Be].length;Ot+=2)We.push(Ma(Fe[Be][Ot],Fe[Be][Ot+1],Y,J,de,Re));Ce.geometry.push(We)}}return Ne.transformed=!0,Ne}function Ma(Ne,Y,J,de,Re,Ce){return[Math.round(J*(Ne*de-Re)),Math.round(J*(Y*de-Ce))]}function ih(Ne,Y,J,de,Re){const Ce=Y===Re.maxZoom?0:Re.tolerance/((1<<Y)*Re.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:J,y:de,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ye of Ne)ad(Fe,Ye,Ce,Re);return Fe}function ad(Ne,Y,J,de){const Re=Y.geometry,Ce=Y.type,Fe=[];if(Ne.minX=Math.min(Ne.minX,Y.minX),Ne.minY=Math.min(Ne.minY,Y.minY),Ne.maxX=Math.max(Ne.maxX,Y.maxX),Ne.maxY=Math.max(Ne.maxY,Y.maxY),Ce==="Point"||Ce==="MultiPoint")for(let Ye=0;Ye<Re.length;Ye+=3)Fe.push(Re[Ye],Re[Ye+1]),Ne.numPoints++,Ne.numSimplified++;else if(Ce==="LineString")ga(Fe,Re,Ne,J,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(let Ye=0;Ye<Re.length;Ye++)ga(Fe,Re[Ye],Ne,J,Ce==="Polygon",Ye===0);else if(Ce==="MultiPolygon")for(let Ye=0;Ye<Re.length;Ye++){const Be=Re[Ye];for(let We=0;We<Be.length;We++)ga(Fe,Be[We],Ne,J,!0,We===0)}if(Fe.length){let Ye=Y.tags||null;if(Ce==="LineString"&&de.lineMetrics){Ye={};for(const We in Y.tags)Ye[We]=Y.tags[We];Ye.mapbox_clip_start=Re.start/Re.size,Ye.mapbox_clip_end=Re.end/Re.size}const Be={geometry:Fe,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Ye};Y.id!==null&&(Be.id=Y.id),Ne.features.push(Be)}}function ga(Ne,Y,J,de,Re,Ce){const Fe=de*de;if(de>0&&Y.size<(Re?Fe:de))return void(J.numPoints+=Y.length/3);const Ye=[];for(let Be=0;Be<Y.length;Be+=3)(de===0||Y[Be+2]>Fe)&&(J.numSimplified++,Ye.push(Y[Be],Y[Be+1])),J.numPoints++;Re&&(function(Be,We){let Ot=0;for(let xt=0,ui=Be.length,Ii=ui-2;xt<ui;Ii=xt,xt+=2)Ot+=(Be[xt]-Be[Ii])*(Be[xt+1]+Be[Ii+1]);if(Ot>0===We)for(let xt=0,ui=Be.length;xt<ui/2;xt+=2){const Ii=Be[xt],Ci=Be[xt+1];Be[xt]=Be[ui-2-xt],Be[xt+1]=Be[ui-1-xt],Be[ui-2-xt]=Ii,Be[ui-1-xt]=Ci}})(Ye,Ce),Ne.push(Ye)}const St={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fl{constructor(Y,J){const de=(J=this.options=(function(Ce,Fe){for(const Ye in Fe)Ce[Ye]=Fe[Ye];return Ce})(Object.create(St),J)).debug;if(de&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let Re=(function(Ce,Fe){const Ye=[];if(Ce.type==="FeatureCollection")for(let Be=0;Be<Ce.features.length;Be++)Uo(Ye,Ce.features[Be],Fe,Be);else Uo(Ye,Ce.type==="Feature"?Ce:{geometry:Ce},Fe);return Ye})(Y,J);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Re=(function(Ce,Fe){const Ye=Fe.buffer/Fe.extent;let Be=Ce;const We=pr(Ce,1,-1-Ye,Ye,0,-1,2,Fe),Ot=pr(Ce,1,1-Ye,2+Ye,0,-1,2,Fe);return(We||Ot)&&(Be=pr(Ce,1,-Ye,1+Ye,0,-1,2,Fe)||[],We&&(Be=Es(We,1).concat(Be)),Ot&&(Be=Be.concat(Es(Ot,-1)))),Be})(Re,J),Re.length&&this.splitTile(Re,0,0,0),de&&(Re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,J,de,Re,Ce,Fe,Ye){const Be=[Y,J,de,Re],We=this.options,Ot=We.debug;for(;Be.length;){Re=Be.pop(),de=Be.pop(),J=Be.pop(),Y=Be.pop();const xt=1<<J,ui=Bl(J,de,Re);let Ii=this.tiles[ui];if(!Ii&&(Ot>1&&console.time("creation"),Ii=this.tiles[ui]=ih(Y,J,de,Re,We),this.tileCoords.push({z:J,x:de,y:Re}),Ot)){Ot>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,de,Re,Ii.numFeatures,Ii.numPoints,Ii.numSimplified),console.timeEnd("creation"));const dn=`z${J}`;this.stats[dn]=(this.stats[dn]||0)+1,this.total++}if(Ii.source=Y,Ce==null){if(J===We.indexMaxZoom||Ii.numPoints<=We.indexMaxPoints)continue}else{if(J===We.maxZoom||J===Ce)continue;if(Ce!=null){const dn=Ce-J;if(de!==Fe>>dn||Re!==Ye>>dn)continue}}if(Ii.source=null,Y.length===0)continue;Ot>1&&console.time("clipping");const Ci=.5*We.buffer/We.extent,gi=.5-Ci,en=.5+Ci,sn=1+Ci;let Rn=null,mr=null,ds=null,Zr=null,Gr=pr(Y,xt,de-Ci,de+en,0,Ii.minX,Ii.maxX,We),Hn=pr(Y,xt,de+gi,de+sn,0,Ii.minX,Ii.maxX,We);Y=null,Gr&&(Rn=pr(Gr,xt,Re-Ci,Re+en,1,Ii.minY,Ii.maxY,We),mr=pr(Gr,xt,Re+gi,Re+sn,1,Ii.minY,Ii.maxY,We),Gr=null),Hn&&(ds=pr(Hn,xt,Re-Ci,Re+en,1,Ii.minY,Ii.maxY,We),Zr=pr(Hn,xt,Re+gi,Re+sn,1,Ii.minY,Ii.maxY,We),Hn=null),Ot>1&&console.timeEnd("clipping"),Be.push(Rn||[],J+1,2*de,2*Re),Be.push(mr||[],J+1,2*de,2*Re+1),Be.push(ds||[],J+1,2*de+1,2*Re),Be.push(Zr||[],J+1,2*de+1,2*Re+1)}}getTile(Y,J,de){Y=+Y,J=+J,de=+de;const Re=this.options,{extent:Ce,debug:Fe}=Re;if(Y<0||Y>24)return null;const Ye=1<<Y,Be=Bl(Y,J=J+Ye&Ye-1,de);if(this.tiles[Be])return js(this.tiles[Be],Ce);Fe>1&&console.log("drilling down to z%d-%d-%d",Y,J,de);let We,Ot=Y,xt=J,ui=de;for(;!We&&Ot>0;)Ot--,xt>>=1,ui>>=1,We=this.tiles[Bl(Ot,xt,ui)];return We&&We.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",Ot,xt,ui),console.time("drilling down")),this.splitTile(We.source,Ot,xt,ui,Y,J,de),Fe>1&&console.timeEnd("drilling down"),this.tiles[Be]?js(this.tiles[Be],Ce):null):null}}function Bl(Ne,Y,J){return 32*((1<<Ne)*J+Y)+Ne}function Vc(Ne,Y){const J=Ne.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const de=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!de)return void Y(null,null);const Re=We=>We.tags&&"3d_elevation_id"in We.tags&&"source"in We.tags&&We.tags.source==="elevation",Ce=de.features.filter((We=>Re(We)));let Fe={_geojsonTileLayer:de.features};Ce.length>0&&(Fe={_geojsonTileLayer:de.features.filter((We=>!Re(We))),hd_road_elevation:Ce});const Ye=new ur(Fe),Be=(function(We){const Ot=new s.bs;for(const xt of Object.keys(We))Ot.writeMessage(3,ln,{name:xt,features:We[xt]});return Ot.finish()})(Fe).buffer;Y(null,{vectorTile:Ye,rawData:Be})}class gn extends qe{constructor(Y,J,de,Re,Ce,Fe,Ye){super(Y,J,de,Re,Ce,Vc,Ye),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new oi}loadData(Y,J){const de=Y&&Y.request,Re=de&&de.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Y,((Ce,Fe)=>{if(Ce||!Fe)return J(Ce);if(typeof Fe!="object")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Be=s.U(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map((We=>`${We.key}: ${We.message}`)).join(", "));Fe.features=Fe.features.filter((We=>Be.value.evaluate({zoom:0},We)))}Y.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),Y.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Dr((function({superclusterOptions:Be,clusterProperties:We}){if(!We||!Be)return Be;const Ot={},xt={},ui={accumulated:null,zoom:0},Ii={properties:null},Ci=Object.keys(We);for(const gi of Ci){const[en,sn]=We[gi],Rn=s.U(sn),mr=s.U(typeof en=="string"?[en,["accumulated"],["get",gi]]:en);Ot[gi]=Rn.value,xt[gi]=mr.value}return Be.map=gi=>{Ii.properties=gi;const en={};for(const sn of Ci)en[sn]=Ot[sn].evaluate(ui,Ii);return en},Be.reduce=(gi,en)=>{Ii.properties=en;for(const sn of Ci)ui.accumulated=gi[sn],gi[sn]=xt[sn].evaluate(ui,Ii)},Be})(Y)).load(Fe.features):Y.dynamic?this._dynamicIndex:(function(Be,We){return new Fl(Be,We)})(Fe,Y.geojsonVtOptions)}catch(Be){return J(Be)}const Ye={};if(Re){const Be=G(de);Be&&(Ye.resourceTiming={},Ye.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Be)))}J(null,Ye)}}))}reloadTile(Y,J){const de=this.loaded;return de&&de[Y.uid]?Y.partial?J(null,void 0):super.reloadTile(Y,J):this.loadTile(Y,J)}loadGeoJSON(Y,J){if(Y.request)s.m(Y.request,J);else{if(typeof Y.data!="string")return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return J(null,JSON.parse(Y.data))}catch{return J(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(Y,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(de){J(de)}}getClusterChildren(Y,J){try{J(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(de){J(de)}}getClusterLeaves(Y,J){try{J(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(de){J(de)}}}class Ls{constructor(Y,J,de){this.tileID=new s.aP(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=J,this.worldview=de}parse(Y,J,de,Re){this.status="parsing";const Ce=new s.aP(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),Fe=[],Ye=J.familiesBySource[de.source],Be=new s.fm(Ce,de.promoteId);Be.bucketLayerIDs=[],Be.is3DTile=!0,s.fB(Y).then((We=>{if(!We)return Re(new Error("Could not parse tile"));const Ot=We.json.extensionsUsed&&We.json.extensionsUsed.includes("MAPBOX_mesh_features")||We.json.asset.extras&&We.json.asset.extras.MAPBOX_mesh_features,xt=We.json.extensionsUsed&&We.json.extensionsUsed.includes("EXT_meshopt_compression"),ui=new s.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ii in Ye)for(const Ci of Ye[Ii]){const gi=Ci[0];Be.bucketLayerIDs.push(Ci.map((Rn=>s.B(Rn.id,Rn.scope)))),gi.recalculate(ui,[]);const en=s.fC(We,1/s.d6(de.tileID.canonical)),sn=new s.fD(Ci,en,Ce,Ot,xt,this.brightness,Be,this.worldview);Ot||(sn.needsUpload=!0),Fe.push(sn),sn.evaluate(gi)}this.status="done",Re(null,{buckets:Fe,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((We=>Re(new Error(We.message))))}}class Nl{constructor(Y,J,de,Re,Ce,Fe,Ye,Be){this.actor=Y,this.layerIndex=J,this.availableImages=de,this.availableModels=Re,this.brightness=Ye,this.loading={},this.loaded={},this.worldview=Be}loadTile(Y,J){const de=Y.uid,Re=this.loading[de]=new Ls(Y,this.brightness,this.worldview);s.bt(Y.request,((Ce,Fe)=>{const Ye=!this.loading[de];return delete this.loading[de],Ye||Ce?(Re.status="done",Ye||(this.loaded[de]=Re),J(Ce)):Fe&&Fe.byteLength!==0?void Re.parse(Fe,this.layerIndex,Y,((Be,We)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[de]=Re,Be||!We?J(Be):J(null,We)})):(Re.status="done",this.loaded[de]=Re,J())}))}reloadTile(Y,J){const de=this.loaded,Re=Y.uid;if(de&&de[Re]){const Ce=de[Re];Ce.projection=Y.projection,Ce.brightness=Y.brightness;const Fe=(Ye,Be)=>{Ce.reloadCallback&&(delete Ce.reloadCallback,this.loadTile(Y,J)),J(Ye,Be)};Ce.status==="parsing"?Ce.reloadCallback=Fe:Ce.status==="done"&&this.loadTile(Y,J)}}abortTile(Y,J){const de=Y.uid;this.loading[de]&&delete this.loading[de],J()}removeTile(Y,J){const de=this.loaded,Re=Y.uid;de&&de[Re]&&delete de[Re],J()}}class _u{constructor(Y){this.self=Y,this.actor=new s.fF(Y,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new s.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=s.cl({name:"mercator"}),this.workerSourceTypes={vector:qe,geojson:gn,"raster-dem":Oe,"raster-array":tt,"batched-model":Nl},this.workerSources={},this.self.registerWorkerSource=(J,de)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=de},this.self.registerRTLTextPlugin=J=>{if(s.fG.isParsed())throw new Error("RTL text plugin already registered.");s.fG.setState({pluginStatus:s.fH.parsed,pluginURL:s.fG.getPluginURL()}),s.fG.applyArabicShaping=J.applyArabicShaping,s.fG.processBidirectionalText=J.processBidirectionalText,s.fG.processStyledBidirectionalText=J.processStyledBidirectionalText;for(const de of this.rtlPluginParsingListeners)de(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Y,J,de){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.availableModels[Y],delete this.workerSources[Y],de()}checkIfReady(Y,J,de){de()}setReferrer(Y,J){this.referrer=J}spriteLoaded(Y,J){this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={});const{scope:de,isLoaded:Re}=J;if(this.isSpriteLoaded[Y][de]=Re,this.workerSources[Y]&&this.workerSources[Y][de])for(const Ce in this.workerSources[Y][de]){const Fe=this.workerSources[Y][de][Ce];for(const Ye in Fe){const Be=Fe[Ye];Be instanceof qe&&(Be.isSpriteLoaded=Re,Be.fire(new s.z("isSpriteLoaded")))}}}setImages(Y,J,de){this.availableImages[Y]||(this.availableImages[Y]={});const{scope:Re,images:Ce}=J;if(this.availableImages[Y][Re]=Ce,this.workerSources[Y]&&this.workerSources[Y][Re]){for(const Fe in this.workerSources[Y][Re]){const Ye=this.workerSources[Y][Re][Fe];for(const Be in Ye)Ye[Be].availableImages=Ce}de()}else de()}setModels(Y,{scope:J,models:de},Re){if(this.availableModels[Y]||(this.availableModels[Y]={}),this.availableModels[Y][J]=de,this.workerSources[Y]&&this.workerSources[Y][J]){for(const Ce in this.workerSources[Y][J]){const Fe=this.workerSources[Y][J][Ce];for(const Ye in Fe)Fe[Ye].availableModels=de}Re()}else Re()}setProjection(Y,J){this.projections[Y]=s.cl(J)}setBrightness(Y,J,de){this.brightness=J,de()}setWorldview(Y,J,de){this.worldview=J,de()}setLayers(Y,J,de){this.getLayerIndex(Y,J.scope).replace(J.layers,J.options),de()}updateLayers(Y,J,de){this.getLayerIndex(Y,J.scope).update(J.layers,J.removedIds,J.options),de()}loadTile(Y,J,de){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).loadTile(J,de)}decodeRasterArray(Y,J,de){this.getWorkerSource(Y,J.type,J.source,J.scope).decodeRasterArray(J,de)}reloadTile(Y,J,de){J.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,J.type,J.source,J.scope).reloadTile(J,de)}abortTile(Y,J,de){this.getWorkerSource(Y,J.type,J.source,J.scope).abortTile(J,de)}removeTile(Y,J,de){this.getWorkerSource(Y,J.type,J.source,J.scope).removeTile(J,de)}removeSource(Y,J,de){if(!(this.workerSources[Y]&&this.workerSources[Y][J.scope]&&this.workerSources[Y][J.scope][J.type]&&this.workerSources[Y][J.scope][J.type][J.source]))return;const Re=this.workerSources[Y][J.scope][J.type][J.source];delete this.workerSources[Y][J.scope][J.type][J.source],Re.removeSource!==void 0?Re.removeSource(J,de):de()}loadWorkerSource(Y,J,de){try{this.self.importScripts(J.url),de()}catch(Re){de(Re.toString())}}syncRTLPluginState(Y,J,de){if(s.fG.isParsed())de(null,!0);else if(s.fG.isParsing())this.rtlPluginParsingListeners.push(de);else try{s.fG.setState(J);const Re=s.fG.getPluginURL();!s.fG.isLoaded()||s.fG.isParsed()||s.fG.isParsing()||Re==null||(s.fG.setState({pluginStatus:s.fH.parsing,pluginURL:s.fG.getPluginURL()}),this.self.importScripts(Re),s.fG.isParsed()?de(null,!0):this.rtlPluginParsingListeners.push(de))}catch(Re){de(Re.toString())}}setDracoUrl(Y,J){this.dracoUrl=J}getAvailableImages(Y,J){this.availableImages[Y]||(this.availableImages[Y]={});let de=this.availableImages[Y][J];return de||(de=[]),de}getAvailableModels(Y,J){this.availableModels[Y]||(this.availableModels[Y]={});let de=this.availableModels[Y][J];return de||(de={}),de}getLayerIndex(Y,J){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let de=this.layerIndexes[Y][J];return de||(de=this.layerIndexes[Y][J]=new ce,de.scope=J),de}getWorkerSource(Y,J,de,Re){const Ce=this.workerSources;return Ce[Y]||(Ce[Y]={}),Ce[Y][Re]||(Ce[Y][Re]={}),Ce[Y][Re][J]||(Ce[Y][Re][J]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),Ce[Y][Re][J][de]||(Ce[Y][Re][J][de]=new this.workerSourceTypes[J]({send:(Fe,Ye,Be,We,Ot,xt)=>this.actor.send(Fe,Ye,Be,Y,Ot,xt),scheduler:this.actor.scheduler},this.getLayerIndex(Y,Re),this.getAvailableImages(Y,Re),this.getAvailableModels(Y,Re),this.isSpriteLoaded[Y][Re],void 0,this.brightness,this.worldview)),Ce[Y][Re][J][de]}rasterizeImagesWorker(Y,J,de){const Re=new Map;for(const[Ce,{image:Fe,imageVariant:Ye}]of J.tasks.entries()){const Be=this.imageRasterizer.rasterize(Ye,Fe,J.scope,Y);Re.set(Ce,Be)}de(void 0,Re)}removeRasterizedImages(Y,J,de){this.imageRasterizer.removeImagesFromCacheByIds(J.imageIds,J.scope,Y),de()}enforceCacheSizeLimit(Y,J){s.fI(J)}getWorkerPerformanceMetrics(Y,J,de){de(void 0,void 0)}}return s.fE(self)&&(self.worker=new _u(self)),_u})),I(["./shared"],(function(s){var G="3.16.0";const q={create:"create",load:"load",fullLoad:"fullLoad"},ie={mark(d){performance.mark(d)},measure(d,t,o){performance.measure(d,t,o)}};function ce(d){const t=d.name.split("?")[0];return s.a(t)&&t.includes("mapbox-gl.js")?"javascript":s.a(t)&&t.includes("mapbox-gl.css")?"css":s.b(t)?"fontRange":s.c(t)?"sprite":s.i(t)?"style":s.d(t)?"tilejson":"other"}var be,He={},Je=(function(){if(be)return He;function d(f){return!t(f)}function t(f){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,T,A=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(A);try{T=new Worker(R),x=!0}catch{x=!1}return T&&T.terminate(),URL.revokeObjectURL(R),x})()?(function(){var x=document.createElement("canvas");x.width=x.height=1;var T=x.getContext("2d");if(!T)return!1;var A=T.getImageData(0,0,1,1);return A&&A.width===x.width})()?(o[y=f&&f.failIfMajorPerformanceCaveat]===void 0&&(o[y]=(function(x){var T,A=(function(R){var L=document.createElement("canvas"),k=Object.create(d.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=R,L.getContext("webgl2",k)})(x);if(!A)return!1;try{T=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!T||A.isContextLost())&&(A.shaderSource(T,"void main() {}"),A.compileShader(T),A.getShaderParameter(T,A.COMPILE_STATUS)===!0)})(y)),o[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}be=1,He.supported=d,He.notSupportedReason=t;var o={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},He})();function it(d,t,o){const f=document.createElement(d);return t!=null&&(f.className=t),o&&o.appendChild(f),f}function Ze(d,t,o){const f=document.createElementNS("http://www.w3.org/2000/svg",d);for(const y of Object.keys(t))f.setAttributeNS(null,y,String(t[y]));return o&&o.appendChild(f),f}const Pt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,ct=Pt&&Pt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Gt;function ei(){Pt&&ct&&(Gt=Pt[ct],Pt[ct]="none")}function Fi(){Pt&&ct&&(Pt[ct]=Gt)}function Si(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",Si,!0)}function qe(){window.addEventListener("click",Si,!0),window.setTimeout((()=>{window.removeEventListener("click",Si,!0)}),0)}function Oe(d,t){const o=d.getBoundingClientRect();return nt(d,o,t)}function je(d,t){const o=d.getBoundingClientRect(),f=[];for(let y=0;y<t.length;y++)f.push(nt(d,o,t[y]));return f}function tt(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function nt(d,t,o){const f=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new s.P((o.clientX-t.left)*f,(o.clientY-t.top)*f)}const yt="01",ze="NO_ACCESS_TOKEN";class ur{constructor(t,o,f){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const t=(function(){let o="";for(let f=0;f<10;f++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yt,o].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!s.h(t))return t;const f=Ct(t);return f.params.push(`sdk=js-${G}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!s.h(t))return t;const f=Ct(t);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeModelURL(t,o){if(!s.h(t))return t;const f=Ct(t);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||o)}normalizeSourceURL(t,o,f,y){if(!s.h(t))return t;const x=Ct(t);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),f&&x.params.push(`language=${f}`),y&&x.params.push(`worldview=${y}`),this._makeAPIURL(x,this._customAccessToken||o)}normalizeIconsetURL(t,o){const f=Ct(t);return s.h(t)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||o)):oi(f)}normalizeSpriteURL(t,o,f,y){const x=Ct(t);return s.h(t)?(x.path=`/styles/v1${x.path}/sprite${o}${f}`,this._makeAPIURL(x,this._customAccessToken||y)):(x.path+=`${o}${f}`,oi(x))}normalizeTileURL(t,o,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!s.h(t))return t;const y=Ct(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||f&&y.authority!=="raster"&&f===512?"@2x":""}${s.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${s.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${s.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${s.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${s.e.TILE_URL_VERSION}${y.path}`);const x=this._customAccessToken||(function(T){for(const A of T){const R=A.match(/^access_token=(.*)$/);if(R)return R[1]}return null})(y.params)||s.e.ACCESS_TOKEN;return s.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,x)}canonicalizeTileURL(t,o){const f=Ct(t);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return t;let y="mapbox://";f.path.match(/^\/raster\/v1\//)?y+=`raster/${f.path.replace(`/${s.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${f.path.replace(`/${s.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${f.path.replace(`/${s.e.TILE_URL_VERSION}/`,"")}`;let x=f.params;return o&&(x=x.filter((T=>!T.match(/^access_token=/)))),x.length&&(y+=`?${x.join("&")}`),y}canonicalizeTileset(t,o){const f=!!o&&s.h(o),y=[];for(const x of t.tiles||[])s.j(x)?y.push(this.canonicalizeTileURL(x,f)):y.push(x);return y}_makeAPIURL(t,o){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=Ct(s.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const x=t.params.indexOf("secure");x>=0&&t.params.splice(x,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!s.e.REQUIRE_ACCESS_TOKEN)return oi(t);if(o=o||s.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return t.params=t.params.filter((x=>x.indexOf("access_token")===-1)),t.params.push(`access_token=${o||""}`),oi(t)}}const qn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ct(d){const t=d.match(qn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function oi(d){const t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}const wi="mapbox.eventData";function bn(d){if(!d)return null;const t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(s.l(t[1]))}catch{return null}}class Cn{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=bn(s.e.ACCESS_TOKEN);let f="";return f=o&&o.u?s.f(o.u):s.e.ACCESS_TOKEN||"",t?`${wi}.${t}:${f}`:`${wi}:${f}`}fetchEventData(){const t=s.s("localStorage"),o=this.getStorageKey(),f=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(t)try{const x=localStorage.getItem(o);x&&(this.eventData=JSON.parse(x));const T=localStorage.getItem(f);T&&(this.anonId=T);const A=localStorage.getItem(y);A&&(this.anonIdTimestamp=Number(A));const R=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<R)&&this.refreshUUID()}catch{s.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=s.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=s.s("localStorage"),o=this.getStorageKey(),f=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),x=this.anonId,T=this.anonIdTimestamp;if(t&&x)try{localStorage.setItem(f,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData)),T&&localStorage.setItem(y,T.toString())}catch{s.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,f,y){if(!s.e.EVENTS_URL)return;const x=Ct(s.e.EVENTS_URL);x.params.push(`access_token=${y||s.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(t).toISOString()},A=o?Object.assign(T,o):T,R={url:oi(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=s.p(R,(L=>{this.pendingRequest=null,f(L),this.saveEventData(),this.processRequests(y)}))}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}const rt=new class extends Cn{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){s.e.EVENTS_URL&&s.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some((o=>s.h(o)||s.j(o)))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=bn(s.e.ACCESS_TOKEN),o=t?t.u:s.e.ACCESS_TOKEN;let f=o!==this.eventData.tokenU;s.v(this.anonId)||(this.refreshUUID(),f=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),T=new Date(y),A=(y-this.eventData.lastSuccess)/864e5;f=f||A>=1||A<-1||x.getDate()!==T.getDate()}else f=!0;f?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:yt,"enabled.telemetry":!1,userId:this.anonId},(x=>{x||(this.eventData.lastSuccess=y,this.eventData.tokenU=o)}),d):this.processRequests()}},Yt=rt.postTurnstileEvent.bind(rt),ai=new class extends Cn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,o,f){this.skuToken=t,this.errorCb=f,s.e.EVENTS_URL&&(o||s.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(ze)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID(),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:yt,skuToken:this.skuToken,userId:this.anonId},(f=>{f?this.errorCb(f):t&&(this.success[t]=!0)}),d))}remove(){this.errorCb=null}},_i=ai.postMapLoadEvent.bind(ai),ln=new class extends Cn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=s.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){const t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){const{map:o,style:f,importedStyles:y}=t;if(!s.e.EVENTS_URL||!d&&!s.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(o),T={mapInstanceId:x,eventId:this.getEventId(x),style:f};y.length&&(T.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:T},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,(()=>{}),d)}},kn=ln.postStyleLoadEvent.bind(ln),Jn=new class extends Cn{constructor(d){super("metrics"),d&&(this.data=d)}postMetricsEvent(d){if(!s.e.EVENTS_URL||!d&&!s.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),s.v(this.anonId)||this.refreshUUID();const t=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,(()=>{}),d)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Mr=Jn.postMetricsEvent.bind(Jn),Ki=new class extends Cn{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){s.e.EVENTS_URL&&(d||s.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),f=(function(y){const x=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),A=(function(H){const W={};if(H){for(const X in H)if(X!=="other")for(const te of H[X]){const ee=`${X}ResolveRangeMin`,re=`${X}ResolveRangeMax`,he=`${X}RequestCount`,le=`${X}RequestCachedCount`;W[ee]=Math.min(W[ee]||1/0,te.startTime),W[re]=Math.max(W[re]||-1/0,te.responseEnd);const we=fe=>{W[fe]===void 0&&(W[fe]=0),++W[fe]};te.transferSize!==void 0&&te.transferSize===0&&we(le),we(he)}}return W})((function(H,W){const X={};if(H)for(const te of H){const ee=W(te);X[ee]===void 0&&(X[ee]=[]),X[ee].push(te)}return X})(x,ce)),R=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=L?L.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},B=(H,W,X)=>{X!=null&&H.push({name:W,value:X.toString()})};for(const H in A)B(U.counters,H,A[H]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(B(U.counters,"interactionRangeMin",y.interactionRange[0]),B(U.counters,"interactionRangeMax",y.interactionRange[1])),T)for(const H of Object.values(q)){const W=T.find((X=>X.name===H));W&&B(U.counters,H,W.startTime)}return B(U.counters,"visibilityHidden",y.visibilityHidden),B(U.attributes,"style",(function(H){if(H)for(const W of H){const X=W.name.split("?")[0];if(s.i(X)){const te=X.split("/").slice(-2);if(te.length===2)return`mapbox://styles/${te[0]}/${te[1]}`}}})(x)),B(U.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),B(U.attributes,"fogEnabled",y.fogEnabled?"true":"false"),B(U.attributes,"projection",y.projection),B(U.attributes,"zoom",y.zoom),B(U.metadata,"devicePixelRatio",R),B(U.metadata,"connectionEffectiveType",k),B(U.metadata,"navigatorUserAgent",navigator.userAgent),B(U.metadata,"screenWidth",window.screen.width),B(U.metadata,"screenHeight",window.screen.height),B(U.metadata,"windowWidth",window.innerWidth),B(U.metadata,"windowHeight",window.innerHeight),B(U.metadata,"mapWidth",y.width/R),B(U.metadata,"mapHeight",y.height/R),B(U.metadata,"webglRenderer",y.renderer),B(U.metadata,"webglVendor",y.vendor),B(U.metadata,"sdkVersion",G),B(U.metadata,"sdkIdentifier","mapbox-gl-js"),U})(o);for(const y of f.metadata);for(const y of f.counters);for(const y of f.attributes);this.postEvent(t,f,(()=>{}),d)}},hr=Ki.postPerformanceEvent.bind(Ki),Wr=new class extends Cn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,o,f){if(!s.e.API_URL||!s.e.SESSION_PATH)return;const y=Ct(s.e.API_URL+s.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${f||s.e.ACCESS_TOKEN||""}`);const x={url:oi(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=s.g(x,(T=>{this.pendingRequest=null,o(T),this.saveEventData(),this.processRequests(f)}))}getSessionAPI(d,t,o,f){this.skuToken=t,this.errorCb=f,s.e.SESSION_PATH&&s.e.API_URL&&(o||s.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},o):this.errorCb(new Error(ze)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,(f=>{f?this.errorCb(f):t&&(this.success[t]=!0)}),d)}remove(){this.errorCb=null}},co=Wr.getSessionAPI.bind(Wr),nr=new Set;function ps(d,t){t?nr.add(d):nr.delete(d)}class rr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){const o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(s.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ds(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Us extends s.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&s.r()&&(this.imageRasterizerDispatcher=new s.D(s.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new s.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const o=this.atlasTexture.get(t);o&&(o.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(t.id,t)}removeImageProvider(t,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(t)}getPendingImageProviders(){const t=[];for(const o of this.imageProviders.values())for(const f of o.values())f.hasPendingRequests()&&t.push(f);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new s.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,o){if(this.loaded.get(o)!==t&&(this.loaded.set(o,t),t)){for(const{ids:f,callback:y}of this.requestors)this._notify(f,o,y);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images.get(o).get(t.toString())}addImage(t,o,f){this._validate(t,f)&&this.images.get(o).set(t.toString(),f)}_validate(t,o){let f=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(o.content,o)||(this.fire(new s.y(new Error(`Image "${t.name}" has invalid "content" value`))),f=!1),f}_validateStretch(t,o){if(!t)return!0;let f=0;for(const y of t){if(y[0]<f||y[1]<y[0]||o<y[1])return!1;f=y[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,f){const y=this.images.get(o).get(t.toString());f.version=y.version+1,this.images.get(o).set(t.toString(),f),this.updatedImages.get(o).add(t),this.removeFromImageRasterizerCache(t,o)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(s.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){const f=this.images.get(o),y=f.get(t.toString());f.delete(t.toString()),this.patterns.get(o).delete(t.toString()),this.removeFromImageRasterizerCache(t,o),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((o=>s.I.from(o)))}getImages(t,o,f){const y=[],x=[],T=this.imageProviders.get(o);for(const k of t){if(!k.iconsetId){y.push(k);continue}const U=T.get(k.iconsetId);U&&(this.getImage(k,o)?x.push(k):U.addPendingRequest(k))}if(y.length===0)return void this._notify(x,o,f);let A=!0;const R=!!this.loaded.get(o),L=this.images.get(o);if(!R)for(const k of y)L.has(k.toString())||(A=!1);R||A?this._notify(y,o,f):this.requestors.push({ids:y,scope:o,callback:f})}rasterizeImages(t,o){const f=new Map,{tasks:y,scope:x}=t;for(const[T,A]of y.entries()){const R=this.getImage(A.id,x);R&&f.set(T,{image:R,imageVariant:A})}this._rasterizeImages(x,f,o)}_rasterizeImages(t,o,f){if(s.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:t},f);else{const y=new Map;for(const[x,{image:T,imageVariant:A}]of o.entries())y.set(x,this.imageRasterizer.rasterize(A,T,t,0));f(void 0,y)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,o,f){const y=this.images.get(o),x=new Map;for(const T of t){if(!y.get(T.toString())){if(T.iconsetId)continue;this.fire(new s.z("styleimagemissing",{id:T.name}))}const A=y.get(T.toString());if(!A){s.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:A.usvg?null:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,usvg:A.usvg,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)};A.usvg&&Object.assign(R,{width:A.icon.usvg_tree.width,height:A.icon.usvg_tree.height}),x.set(s.I.toString(T),R)}f(null,x)}getPixelSize(t){const{width:o,height:f}=this.atlasImage.get(t);return{width:o,height:f}}getPattern(t,o,f){const y=t.toString(),x=this.patterns.get(o),T=x.get(y),A=this.getImage(t,o);if(!A)return null;if(T){if(T.position.version===A.version)return T.position;T.position.version=A.version}else{if(A.usvg&&!A.data){const R=this.getPatternInFlightId(y,o);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const L=new s.A(t).scaleSelf(s.o.devicePixelRatio),k=new Map([[L.toString(),{image:A,imageVariant:L}]]);return this._rasterizeImages(o,k,((U,B)=>this.storePatternImage(L,o,A,f,B))),null}this.storePattern(t,o,A)}return this._updatePatternAtlas(o,f),x.get(y).position}getPatternInFlightId(t,o){return s.B(t,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,o,f,y,x){const T=t.toString(),A=x?x.get(T):void 0;A&&(f.data=A,this.storePattern(t.id,o,f),this._updatePatternAtlas(o,y),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),o)))}storePattern(t,o,f){const y={w:f.data.width+2*s.C,h:f.data.height+2*s.C,x:0,y:0},x=new s.F(y,f,s.C);this.patterns.get(o).set(t.toString(),{bin:y,position:x})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,o){const f=t.gl;let y=this.atlasTexture.get(o);y?this.dirty&&(y.update(this.atlasImage.get(o)),this.dirty=!1):(y=new s.T(t,this.atlasImage.get(o),f.RGBA8),this.atlasTexture.set(o,y)),y.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){const f=this.patterns.get(t),y=Array.from(f.values()).map((({bin:L})=>L)),{w:x,h:T}=s.G(y),A=this.atlasImage.get(t);A.resize({width:x||1,height:T||1});const R=this.images.get(t);for(const[L,{bin:k,position:U}]of f.entries()){let B=U.padding;const H=k.x+B,W=k.y+B,X=R.get(L).data,te=X.width,ee=X.height;B=B>1?B-1:B,s.q.copy(X,A,{x:0,y:0},{x:H,y:W},{width:te,height:ee},o),s.q.copy(X,A,{x:0,y:ee-B},{x:H,y:W-B},{width:te,height:B},o),s.q.copy(X,A,{x:0,y:0},{x:H,y:W+ee},{width:te,height:B},o),s.q.copy(X,A,{x:te-B,y:0},{x:H-B,y:W},{width:B,height:ee},o),s.q.copy(X,A,{x:0,y:0},{x:H+te,y:W},{width:B,height:ee},o),s.q.copy(X,A,{x:te-B,y:ee-B},{x:H-B,y:W-B},{width:B,height:B},o),s.q.copy(X,A,{x:0,y:ee-B},{x:H+te,y:W-B},{width:B,height:B},o),s.q.copy(X,A,{x:0,y:0},{x:H+te,y:W+ee},{width:B,height:B},o),s.q.copy(X,A,{x:te-B,y:0},{x:H-B,y:W+ee},{width:B,height:B},o)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,o){const f=this.images.get(o);for(const y of t){if(this.callbackDispatchedThisFrame.get(o).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(y.toString());const x=f.get(y.toString());Ds(x)&&this.updateImage(y,o,x)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Dr(d){const t=d.value,o=d.valueSpec,f=d.style,y=d.styleSpec,x=d.key,T=d.arrayElementValidator||dr;if(!Array.isArray(t))return[new s.V(x,t,`array expected, ${s.K(t)} found`)];if(o.length&&t.length!==o.length)return[new s.V(x,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new s.V(x,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let A={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};y.$version<7&&(A.function=o.function),s.H(o.value)&&(A=o.value);let R=[];for(let L=0;L<t.length;L++)R=R.concat(T({array:t,arrayIndex:L,value:t[L],valueSpec:A,style:f,styleSpec:y,key:`${x}[${L}]`},!0));return R}function ms(d){const t=d.key,o=d.value,f=d.valueSpec;if(!s.L(o))return[new s.V(t,o,`number expected, ${s.K(o)} found`)];if(o!=o)return[new s.V(t,o,"number expected, NaN found")];if("minimum"in f){let y=f.minimum;if(Array.isArray(f.minimum)&&(y=f.minimum[d.arrayIndex]),o<y)return[new s.V(t,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in f){let y=f.maximum;if(Array.isArray(f.maximum)&&(y=f.maximum[d.arrayIndex]),o>y)return[new s.V(t,o,`${o} is greater than the maximum value ${y}`)]}return[]}function hs(d){const t=d.key,o=d.value;if(!s.H(o))return[new s.V(t,o,`object expected, ${s.K(o)} found`)];const f=d.valueSpec,y=s.J(o.type);let x,T,A,R={};const L=y!=="categorical"&&o.property===void 0,k=!L,U=(function(X){const te=X.stops;return Array.isArray(te)&&Array.isArray(te[0])&&s.H(te[0][0])})(o),B=Ps({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(X){if(y==="identity")return[new s.V(X.key,X.value,'identity function may not have a "stops" property')];let te=[];const ee=X.value;return te=te.concat(Dr({key:X.key,value:ee,valueSpec:X.valueSpec,style:X.style,styleSpec:X.styleSpec,arrayElementValidator:H})),Array.isArray(ee)&&ee.length===0&&te.push(new s.V(X.key,ee,"array must have at least one stop")),te},default:function(X){return dr({key:X.key,value:X.value,valueSpec:f,style:X.style,styleSpec:X.styleSpec})}}});return y==="identity"&&L&&B.push(new s.V(d.key,d.value,'missing required property "property"')),y==="identity"||o.stops||B.push(new s.V(d.key,d.value,'missing required property "stops"')),y==="exponential"&&f.expression&&!s.M(f)&&B.push(new s.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(k&&!s.N(f)?B.push(new s.V(d.key,d.value,"property functions not supported")):L&&!s.O(f)&&B.push(new s.V(d.key,d.value,"zoom functions not supported"))),y!=="categorical"&&!U||o.property!==void 0||B.push(new s.V(d.key,d.value,'"property" property is required')),B;function H(X){let te=[];const ee=X.value,re=X.key;if(!Array.isArray(ee))return[new s.V(re,ee,`array expected, ${s.K(ee)} found`)];if(ee.length!==2)return[new s.V(re,ee,`array length 2 expected, length ${ee.length} found`)];if(U){if(!s.H(ee[0]))return[new s.V(re,ee,`object expected, ${s.K(ee[0])} found`)];const he=ee[0];if(he.zoom===void 0)return[new s.V(re,ee,"object stop key must have zoom")];if(he.value===void 0)return[new s.V(re,ee,"object stop key must have value")];const le=s.J(he.zoom);if(typeof le!="number")return[new s.V(re,he.zoom,"stop zoom values must be numbers")];if(A&&A>le)return[new s.V(re,he.zoom,"stop zoom values must appear in ascending order")];le!==A&&(A=le,T=void 0,R={}),te=te.concat(Ps({key:`${re}[0]`,value:ee[0],valueSpec:{zoom:{}},style:X.style,styleSpec:X.styleSpec,objectElementValidators:{zoom:ms,value:W}}))}else te=te.concat(W({key:`${re}[0]`,value:ee[0],style:X.style,styleSpec:X.styleSpec},ee));return s.Q(s.S(ee[1]))?te.concat([new s.V(`${re}[1]`,ee[1],"expressions are not allowed in function stops.")]):te.concat(dr({key:`${re}[1]`,value:ee[1],valueSpec:f,style:X.style,styleSpec:X.styleSpec}))}function W(X,te){const ee=s.K(X.value),re=s.J(X.value),he=X.value!==null?X.value:te;if(x){if(ee!==x)return[new s.V(X.key,he,`${ee} stop domain type must match previous stop domain type ${x}`)]}else x=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new s.V(X.key,he,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&y!=="categorical"){let le=`number expected, ${ee} found`;return s.N(f)&&y===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new s.V(X.key,he,le)]}return y!=="categorical"||ee!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?y!=="categorical"&&ee==="number"&&typeof re=="number"&&typeof T=="number"&&T!==void 0&&re<T?[new s.V(X.key,he,"stop domain values must appear in ascending order")]:(T=re,y==="categorical"&&re in R?[new s.V(X.key,he,"stop domain values must be unique")]:(R[re]=!0,[])):[new s.V(X.key,he,`integer expected, found ${String(re)}`)]}}function Di(d){const t=(d.expressionContext==="property"?s.W:s.U)(s.S(d.value),d.valueSpec);if(t.result==="error")return t.value.map((f=>new s.V(`${d.key}${f.key}`,d.value,f.message)));const o=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!o.outputDefined())return[new s.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!s.Z(o))return[new s.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return rn(o,d);if(d.expressionContext==="appearance")return vn(o,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!s.X(o,["zoom","feature-state"]))return[new s.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!s.Y(o))return[new s.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function rn(d,t){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)o.delete(y);if(o.size===0)return[];const f=[];return d instanceof s._&&o.has(d.name)?[new s.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild((y=>{f.push(...rn(y,t))})),f)}function vn(d,t){const o=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)o.add(y);if(o.size===0)return[];const f=[];return d instanceof s._&&!o.has(d.name)?[new s.V(t.key,t.value,`["${d.name}"] is not an allowed parameter`)]:(d.eachChild((y=>{f.push(...vn(y,t))})),f)}function $i(d){const t=d.key,o=d.value,f=d.valueSpec,y=[];return Array.isArray(f.values)?f.values.indexOf(s.J(o))===-1&&y.push(new s.V(t,o,`expected one of [${f.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(f.values).indexOf(s.J(o))===-1&&y.push(new s.V(t,o,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(o)} found`)),y}function Ks(d){return s.a2(s.S(d.value))?Di(Object.assign({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):Kn(d)}function Kn(d){const t=d.value,o=d.key;if(!Array.isArray(t))return[new s.V(o,t,`array expected, ${s.K(t)} found`)];if(t.length<1)return[new s.V(o,t,"filter array must have at least 1 element")];const f=d.styleSpec;let y=$i({key:`${o}[0]`,value:t[0],valueSpec:f.filter_operator});switch(s.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&s.J(t[1])==="$type"&&y.push(new s.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new s.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(s.a0(t[1])||y.push(new s.V(`${o}[1]`,t[1],`string expected, ${s.K(t[1])} found`)));for(let x=2;x<t.length;x++)s.J(t[1])==="$type"?y=y.concat($i({key:`${o}[${x}]`,value:t[x],valueSpec:f.geometry_type})):s.a0(t[x])||s.L(t[x])||s.$(t[x])||y.push(new s.V(`${o}[${x}]`,t[x],`string, number, or boolean expected, ${s.K(t[x])} found.`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)y=y.concat(Kn({key:`${o}[${x}]`,value:t[x],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":t.length!==2?y.push(new s.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):s.a0(t[1])||y.push(new s.V(`${o}[1]`,t[1],`string expected, ${s.K(t[1])} found`))}return y}function uo(d,t){const o=d.key,f=d.style,y=d.layer,x=d.styleSpec,T=d.value,A=d.objectKey,R=x[`${t}_${d.layerType}`];if(!R)return[];const L=A.match(/^(.*)-use-theme$/);if(L&&R[L[1]])return s.Q(s.S(T))?[].concat(dr({key:o,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:x,expressionContext:"property",propertyType:t,propertyKey:A})):dr({key:o,value:T,valueSpec:{type:"string"},style:f,styleSpec:x});const k=A.match(/^(.*)-transition$/);if(t==="paint"&&k&&R[k[1]]&&R[k[1]].transition)return dr({key:o,value:T,valueSpec:x.transition,style:f,styleSpec:x});const U=d.valueSpec||R[A];if(!U)return[new s.a3(o,T,`unknown property "${A}"`)];let B;if(s.a0(T)&&s.N(U)&&!U.tokens&&(B=/^{([^}]+)}$/.exec(T))){const W=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new s.V(o,T,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${W}.`)]}const H=[];if(d.layerType==="symbol")A!=="text-field"||!f||f.glyphs||f.imports||H.push(new s.V(o,T,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&s.a4(s.S(T))&&s.J(T.type)==="identity"&&H.push(new s.V(o,T,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&s.N(U)&&(s.a5(U)||s.O(U))){const W=s.W(s.S(T),U).value,X="expression"in W&&W.expression||"_styleExpression"in W&&W._styleExpression&&W._styleExpression.expression;X&&!s.X(X,["measure-light"])&&(A==="model-emissive-strength"&&s.Y(X)&&s.Z(X)||H.push(new s.V(o,T,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return H.concat(dr({key:d.key,value:T,valueSpec:U,style:f,styleSpec:x,expressionContext:"property",propertyType:t,propertyKey:A}))}function Uo(d){return uo(d,"paint")}function jo(d){return uo(d,"layout")}function ac(d){let t=[];const o=d.value,f=d.key,y=d.style,x=d.styleSpec;if(!s.H(o))return[new s.V(f,o,"object expected")];o.type||o.ref||t.push(new s.V(f,o,'either "type" or "ref" is required'));let T=s.J(o.type);const A=s.J(o.ref);if(o.id){const R=s.J(o.id);for(let L=0;L<d.arrayIndex;L++){const k=y.layers[L];s.J(k.id)===R&&t.push(new s.V(f,o.id,`duplicate layer id "${R}", previously used at line ${k.id.__line__}`))}}if("ref"in o){let R;["type","source","source-layer","filter","layout"].forEach((L=>{L in o&&t.push(new s.V(f,o[L],`"${L}" is prohibited for ref layers`))})),y.layers.forEach((L=>{s.J(L.id)===A&&(R=L)})),R?R.ref?t.push(new s.V(f,o.ref,"ref cannot reference another ref layer")):T=s.J(R.type):typeof A=="string"&&t.push(new s.V(f,o.ref,`ref layer "${A}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(o.source)if(s.a0(o.source)){const R=y.sources&&y.sources[o.source],L=R&&s.J(R.type);R?L==="vector"&&T==="raster"?t.push(new s.V(f,o.source,`layer "${o.id}" requires a raster source`)):L==="raster"&&T!=="raster"?t.push(new s.V(f,o.source,`layer "${o.id}" requires a vector source`)):L!=="vector"||o["source-layer"]?L==="raster-dem"&&T!=="hillshade"?t.push(new s.V(f,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&L==="geojson"&&!R.lineMetrics?t.push(new s.V(f,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&L!=="raster-array"&&t.push(new s.V(f,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new s.V(f,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new s.V(f,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new s.V(f,o.source,`source "${o.source}" not found`))}else t.push(new s.V(`${f}.source`,o.source,'"source" must be a string'));else t.push(new s.V(f,o,'missing required property "source"'));return t=t.concat(Ps({key:f,value:o,valueSpec:x.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dr({key:`${f}.type`,value:o.type,valueSpec:x.layer.type,style:d.style,styleSpec:d.styleSpec,object:o,objectKey:"type"}),filter:R=>Ks(Object.assign({layerType:T},R)),layout:R=>Ps({layer:o,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>jo(Object.assign({layerType:T},L))}}),paint:R=>Ps({layer:o,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":L=>Uo(Object.assign({layerType:T,layer:o},L))}}),appearances(R){const L=Dr({key:R.key,value:R.value,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:B=>(function(H){const{key:W,layer:X,layerType:te}=H,ee=s.J(H.value),re=s.J(ee.name),he=s.J(ee.condition),le=Ps({key:W,value:ee,valueSpec:H.styleSpec.appearance,style:H.style,styleSpec:H.styleSpec,objectElementValidators:{condition:we=>(function(fe){const Ee=[];return Ee.push(...Di({key:fe.key,value:fe.object.condition,valueSpec:s.a6.appearance.condition,expressionContext:"appearance"})),Ee})(Object.assign({layer:X,layerType:te},we)),properties:we=>(function(fe){const Ee=[],{styleSpec:ge,layer:me,layerType:Se}=fe,Ve=ge[`paint_${Se}`],ke=ge[`layout_${Se}`],st=fe.object[fe.objectKey];for(const Xe in st){const ht=Xe in Ve?"paint":Xe in ke?"layout":void 0;if(!ht){Ee.push(new s.V(fe.key,Xe,`unknown property "${Xe}" for layer type "${Se}"`));continue}const zt=Object.assign({},fe,{key:`${fe.key}.${Xe}`,object:st,objectKey:Xe,layer:me,layerType:Se,value:st[Xe],valueSpec:ht==="paint"?Ve[Xe]:ke[Xe]});Ee.push(...uo(zt,ht))}return Ee})(Object.assign({layer:X,layerType:te},we))}});return re!=="hidden"&&he===void 0&&le.push(new s.V(H.key,"name",'Appearance with name different than "hidden" must have a condition')),le})(Object.assign({layerType:T,layer:o},B))}),k=Array.isArray(R.value)?R.value:[],U=new Set;return k.forEach(((B,H)=>{const W=s.J(B.name);if(W)if(U.has(W)){const X=s.J(o.id);L.push(new s.V(R.key,W,`Duplicated appearance name "${W}" for layer "${X}"`))}else U.add(W)})),L}}})),t}function $a({key:d,value:t}){return s.a0(t)?[]:[new s.V(d,t,`string expected, ${s.K(t)} found`)]}const Nc={promoteId:function d({key:t,value:o}){if(s.a0(o))return $a({key:t,value:o});if(Array.isArray(o)){const y=[],x=s.S(o),T=s.U(x);return T.result==="error"&&T.value.forEach((A=>{y.push(new s.V(`${t}${A.key}`,null,`${A.message}`))})),s.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new s.V(`${t}`,null,"promoteId expression should be only feature dependent")),y}if(!s.H(o))return[new s.V(t,o,`string, expression or object expected, "${s.K(o)}" found`)];const f=[];for(const y in o)f.push(...d({key:`${t}.${y}`,value:o[y]}));return f}};function Yo(d){const t=d.value,o=d.key,f=d.styleSpec,y=d.style;if(!s.H(t))return[new s.V(o,t,`object expected, ${s.K(t)} found`)];if(!("type"in t))return[new s.V(o,t,'"type" is required')];const x=s.J(t.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&("url"in t||"tiles"in t||T.push(new s.a3(o,t,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(Ps({key:o,value:t,valueSpec:f[`source_${x.replace("-","_")}`],style:d.style,styleSpec:f,objectElementValidators:Nc})),T;case"geojson":if(T=Ps({key:o,value:t,valueSpec:f.source_geojson,style:y,styleSpec:f,objectElementValidators:Nc}),"cluster"in t&&"clusterProperties"in t){if(!s.H(t.clusterProperties))return[new s.V(`${o}.clusterProperties`,t,`object expected, ${s.K(t)} found`)];for(const A in t.clusterProperties){const R=t.clusterProperties[A];if(!Array.isArray(R))return[new s.V(`${o}.clusterProperties.${A}`,R,"array expected")];const[L,k]=R,U=typeof L=="string"?[L,["accumulated"],["get",A]]:L;T.push(...Di({key:`${o}.${A}.map`,value:k,expressionContext:"cluster-map"})),T.push(...Di({key:`${o}.${A}.reduce`,value:U,expressionContext:"cluster-reduce"}))}}return T;case"video":return Ps({key:o,value:t,valueSpec:f.source_video,style:y,styleSpec:f});case"image":return Ps({key:o,value:t,valueSpec:f.source_image,style:y,styleSpec:f});case"canvas":return[new s.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $i({key:`${o}.type`,value:t.type,valueSpec:{values:pr(f)}})}}function pr(d){return d.source.reduce(((t,o)=>{const f=d[o];return f.type.type==="enum"&&(t=t.concat(Object.keys(f.type.values||{}))),t}),[])}function Co(d){const t=d.value,o=d.styleSpec,f=o.light,y=d.style;if(t===void 0)return[];if(!s.H(t))return[new s.V("light",t,`object expected, ${s.K(t)} found`)];let x=[];for(const T in t){const A=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);x=x.concat(R&&f[R[1]]?dr({key:T,value:t[T],valueSpec:{type:"string"},style:y,styleSpec:o}):A&&f[A[1]]&&f[A[1]].transition?dr({key:T,value:t[T],valueSpec:o.transition,style:y,styleSpec:o}):f[T]?dr({key:T,value:t[T],valueSpec:f[T],style:y,styleSpec:o}):[new s.V(T,t[T],`unknown property "${T}"`)])}return x}function Ts(d){const t=d.value;if(!t)return[];const o=d.key;if(!s.H(t))return[new s.V(o,t,`object expected, ${s.K(t)} found`)];let f=[];const y=d.styleSpec,x=y["light-3d"],T=d.style,A=d.style.lights;for(const k of["type","id"])if(!(k in t))return f=f.concat([new s.V(o,t,`missing property "${k}"`)]),f;if(!s.a0(t.type))return f=f.concat([new s.V(`${o}.type`,t.type,"string expected")]),f;if(A)for(let k=0;k<d.arrayIndex;k++){const U=s.J(t.type),B=A[k];s.J(B.type)===U&&f.push(new s.V(o,t.id,`duplicate light type "${t.type}", previously defined at line ${B.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in y))return f=f.concat([new s.V(`${o}.type`,t,`Invalid light type ${t.type}`)]),f;const L=y[R];for(const k in t)if(k==="properties"){const U=t[k];if(!s.H(U))return f=f.concat([new s.V("properties",U,`object expected, ${s.K(U)} found`)]),f;for(const B in U){const H=B.match(/^(.*)-transition$/),W=B.match(/^(.*)-use-theme$/);f=f.concat(W&&L[W[1]]?dr({key:k,value:U[B],valueSpec:{type:"string"},style:T,styleSpec:y}):H&&L[H[1]]&&L[H[1]].transition?dr({key:k,value:t[k],valueSpec:y.transition,style:T,styleSpec:y}):L[B]?dr({key:B,value:U[B],valueSpec:L[B],style:T,styleSpec:y}):[new s.a3(d.key,U[B],`unknown property "${B}"`)])}}else f=f.concat(x[k]?dr({key:k,value:t[k],valueSpec:x[k],style:T,styleSpec:y}):[new s.a3(k,t[k],`unknown property "${k}"`)]);return f}function cl(d){const t=d.value,o=d.key,f=d.style,y=d.styleSpec,x=y.terrain;if(t==null)return[];if(!s.H(t))return[new s.V("terrain",t,`object expected, ${s.K(t)} found`)];let T=[];for(const A in t){const R=A.match(/^(.*)-transition$/),L=A.match(/^(.*)-use-theme$/);T=T.concat(L&&x[L[1]]?dr({key:A,value:t[A],valueSpec:{type:"string"},style:f,styleSpec:y}):R&&x[R[1]]&&x[R[1]].transition?dr({key:A,value:t[A],valueSpec:y.transition,style:f,styleSpec:y}):x[A]?dr({key:A,value:t[A],valueSpec:x[A],style:f,styleSpec:y}):[new s.a3(A,t[A],`unknown property "${A}"`)])}if(t.source)if(s.a0(t.source)){const A=f.sources&&f.sources[t.source],R=A&&s.J(A.type);A?R!=="raster-dem"&&T.push(new s.V(`${o}.source`,t.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):T.push(new s.V(`${o}.source`,t.source,`source "${t.source}" not found`))}else T.push(new s.V(`${o}.source`,t.source,"source must be a string"));else T.push(new s.V(o,t,'terrain is missing required property "source"'));return T}function Qo(d){const t=d.value,o=d.style,f=d.styleSpec,y=f.fog;if(t===void 0)return[];if(!s.H(t))return[new s.V("fog",t,`object expected, ${s.K(t)} found`)];let x=[];for(const T in t){const A=T.match(/^(.*)-transition$/),R=T.match(/^(.*)-use-theme$/);x=x.concat(R&&y[R[1]]?dr({key:T,value:t[T],valueSpec:{type:"string"},style:o,styleSpec:f}):A&&y[A[1]]&&y[A[1]].transition?dr({key:T,value:t[T],valueSpec:f.transition,style:o,styleSpec:f}):y[T]?dr({key:T,value:t[T],valueSpec:y[T],style:o,styleSpec:f}):[new s.a3(T,t[T],`unknown property "${T}"`)])}return x}const ma={"*":()=>[],array:Dr,boolean:function(d){const t=d.value,o=d.key;return s.$(t)?[]:[new s.V(o,t,`boolean expected, ${s.K(t)} found`)]},number:ms,color:function({key:d,value:t}){return s.a0(t)?s.a1.parseCSSColor(t)===null?[new s.V(d,t,`color expected, "${t}" found`)]:[]:[new s.V(d,t,`color expected, ${s.K(t)} found`)]},enum:$i,filter:Ks,function:hs,layer:ac,object:Ps,source:Yo,model:s.a7,light:Co,"light-3d":Ts,terrain:cl,fog:Qo,string:$a,formatted:function(d){return $a(d).length===0?[]:Di(d)},resolvedImage:function(d){return $a(d).length===0?[]:Di(d)},projection:function(d){const t=d.value,o=d.styleSpec,f=o.projection,y=d.style;if(s.H(t)){let x=[];for(const T in t)x=x.concat(dr({key:T,value:t[T],valueSpec:f[T],style:y,styleSpec:o}));return x}return s.a0(t)?[]:[new s.V("projection",t,`object or string expected, ${s.K(t)} found`)]},import:function(d){const t=d.key,{value:o,styleSpec:f}=d;if(!s.H(o))return[new s.V(t,o,"import must be an object")];const{data:y,...x}=o;Object.defineProperty(x,"__line__",{value:o.__line__,enumerable:!1});let T=Ps(Object.assign({},d,{value:x,valueSpec:f.import}));return s.J(x.id)===""&&T.push(new s.V(`${d.key}.id`,x,"import id can't be an empty string")),y&&(T=T.concat(Go(y,f,{key:`${d.key}.data`}))),T},iconset:function(d){const t=d.value,o=d.key,f=d.styleSpec,y=d.style;if(!s.H(t))return[new s.V(o,t,"object expected")];if(!t.type)return[new s.V(o,t,'"type" is required')];const x=s.J(t.type);let T=[];if(T=T.concat(Ps({key:o,value:t,valueSpec:f[`iconset_${x}`],style:y,styleSpec:f})),(function(A,R){return!(A!=="source"||!R.source)})(x,t)){const A=y.sources&&y.sources[t.source],R=A&&s.J(A.type);A?R!=="raster-array"&&T.push(new s.V(o,t.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):T.push(new s.V(o,t.source,`source "${t.source}" not found`))}return T}};function dr(d,t=!1){const o=d.value,f=d.valueSpec,y=d.styleSpec;if(f.expression){if(s.a4(s.J(o)))return hs(d);if(s.Q(s.S(o)))return Di(d)}if(f.type&&ma[f.type]){const x=ma[f.type](d);return t===!0&&x.length>0&&Array.isArray(d.value)?Di(d):x}return Ps(Object.assign({},d,{valueSpec:f.type?y[f.type]:f}))}function Ps(d){const t=d.key,o=d.value,f=d.valueSpec||{},y=d.objectElementValidators||{},x=d.style,T=d.styleSpec;if(!s.H(o))return[new s.V(t,o,`object expected, ${s.K(o)} found`)];let A=[];for(const R in o){const L=R.split(".")[0];let k;y[L]?k=y[L]:f[L]?k=dr:y["*"]?k=y["*"]:f["*"]&&(k=dr),k?A=A.concat(k({key:(t&&`${t}.`)+R,value:o[R],valueSpec:f[L]||f["*"],style:x,styleSpec:T,object:o,objectKey:R},o)):A.push(new s.a3(t,o[R],`unknown property "${R}"`))}for(const R in f){if(y[R])continue;const L=f[R];L.required&&L.default===void 0&&o[R]===void 0&&A.push(new s.V(t,o,`missing required property "${R}"`))}return A}function Es({key:d,value:t}){const o=$a({key:d,value:t});if(o.length)return o;const f=t;return f.indexOf("{fontstack}")===-1&&o.push(new s.V(d,t,'"glyphs" url must include a "{fontstack}" token')),f.indexOf("{range}")===-1&&o.push(new s.V(d,t,'"glyphs" url must include a "{range}" token')),o}function Go(d,t=s.a6,o={}){return Ps({key:o.key||"",value:d,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:d,objectElementValidators:{glyphs:Es}})}function js(d,t=s.a6){return Ne(Go(d,t))}const Ma=d=>Ne(Yo(d)),ih=d=>Ne(Co(d)),ad=d=>Ne(Ts(d)),ga=d=>Ne(cl(d)),St=d=>Ne(Qo(d)),Fl=d=>Ne((function(t){const o=t.value,f=t.style,y=t.styleSpec,x=y.snow;if(o===void 0)return[];if(!s.H(o))return[new s.V("snow",o,`object expected, ${s.K(o)} found`)];let T=[];for(const A in o){const R=A.match(/^(.*)-transition$/);T=T.concat(R&&x[R[1]]&&x[R[1]].transition?dr({key:A,value:o[A],valueSpec:y.transition,style:f,styleSpec:y}):x[A]?dr({key:A,value:o[A],valueSpec:x[A],style:f,styleSpec:y}):[new s.a3(A,o[A],`unknown property "${A}"`)])}return T})(d)),Bl=d=>Ne((function(t){const o=t.value,f=t.style,y=t.styleSpec,x=y.rain;if(o===void 0)return[];if(!s.H(o))return[new s.V("rain",o,`object expected, ${s.K(o)} found`)];let T=[];for(const A in o){const R=A.match(/^(.*)-transition$/);T=T.concat(R&&x[R[1]]&&x[R[1]].transition?dr({key:A,value:o[A],valueSpec:y.transition,style:f,styleSpec:y}):x[A]?dr({key:A,value:o[A],valueSpec:x[A],style:f,styleSpec:y}):[new s.a3(A,o[A],`unknown property "${A}"`)])}return T})(d)),Vc=d=>Ne(ac(d)),gn=d=>Ne(Ks(d)),Ls=d=>Ne(Uo(d)),Nl=d=>Ne(jo(d)),_u=d=>Ne(s.a7(d));function Ne(d){return d.slice().sort(((t,o)=>t.line&&o.line?t.line-o.line:0))}function Y(d,t){let o=!1;if(t&&t.length)for(const f of t)f instanceof s.a3?s.w(f.message):(d.fire(new s.y(new Error(f.message))),o=!0);return o}const J=s.a6.light;let de;class Re extends s.E{constructor(t,o="flat"){super(),this._transitionable=new s.a8(de||(de=new s.a9({anchor:new s.aa(J.anchor),position:new s.ab(J.position),color:new s.aa(J.color),intensity:new s.aa(J.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,f={}){this._validate(ih,t,f)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,f){return(!f||f.validate!==!1)&&Y(this,t.call(js,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}const Ce=s.a6.terrain;let Fe=class extends s.E{constructor(d,t,o,f,y){super(),this.scope=o,this._transitionable=new s.a8(new s.a9({source:new s.aa(Ce.source),exaggeration:new s.aa(Ce.exaggeration)}),o,f),this._transitionable.setTransitionOrValue(d,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=y}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new s.ac(d,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const t=d.value.expression;if(!t)return null;let o=-1,f=-1,y=1;for(const x of t.zoomStops)y=t.evaluate(new s.ac(x,{worldview:this.worldview})),y>.01?(o=x,f=-1):f=x;return y<.01&&o>0&&f>o?[o,f]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof s.ad}};const Ye=45,Be=65,We=.05;function Ot(d,t,o,f){const y=s.ah(Ye,Be,o),[x,T]=xt(d,f);let A=1-Math.min(1,Math.exp((t-x)/(T-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*d.alpha}function xt(d,t){const o=.5/Math.tan(.5*t);return[d.range[0]+o,d.range[1]+o]}function ui(d,t,o,f,y){const x=s.af([],[t,o,f],y.mercatorFogMatrix);return Ot(d,s.ag(x),y.pitch,y._fov)}function Ii(d,t,o,f,y,x,T){const A=[[o,f,0],[y,f,0],[y,x,0],[o,x,0]];let R=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const k of A){const U=s.af([],k,t),B=s.ag(U);R=Math.min(R,B),L=Math.max(L,B)}return[Ot(d,R,T.pitch,T._fov),Ot(d,L,T.pitch,T._fov)]}const Ci=s.a6.fog;class gi extends s.E{constructor(t,o,f,y){super();const x=new s.a9({range:new s.aa(Ci.range),color:new s.aa(Ci.color),"color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new s.aa(Ci["high-color"]),"high-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new s.aa(Ci["space-color"]),"space-color-use-theme":new s.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new s.aa(Ci["horizon-blend"]),"star-intensity":new s.aa(Ci["star-intensity"]),"vertical-range":new s.aa(Ci["vertical-range"])});this._transitionable=new s.a8(x,f,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new s.ai(x),this.scope=f}get state(){const t=this._transform,o=t.projection.name==="globe",f=s.aj(t.zoom),y=this.properties.get("range"),x=[.5,3];return{range:o?[s.ak(x[0],y[0],f),s.ak(x[1],y[1],f)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,f={}){if(this._validate(St,t,f))return;const y=Object.assign({},t);for(const x of Object.keys(Ci))y[x]===void 0&&(y[x]=Ci[x].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.ah(Ye,Be,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?(function(f,y,x){const T=s.ae.fromLngLat(y),A=x.elevation?x.elevation.getAtPointOrZero(T):0;return ui(f,T.x,T.y,A,x)})(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ii(this.state,o,0,0,s.al,s.al,this._transform)}getOpacityForBounds(t,o,f,y,x){return this._transform.projection.supportsFog?Ii(this.state,t,o,f,y,x,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?xt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const f of o){const y=t.points[f];let x;if(y[2]>=0)x=y;else{const T=t.points[f-4];x=s.am(T,y,T[2]/(T[2]-y[2]))}if(ui(this.state,x[0],x[1],0,this._transform)>=We)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,f){return(!f||f.validate!==!1)&&Y(this,t.call(js,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}}let en,sn,Rn,mr,ds=class extends s.E{constructor(d,t,o,f){super();const y=en||(en=new s.a9({density:new s.aa(s.a6.snow.density),intensity:new s.aa(s.a6.snow.intensity),color:new s.aa(s.a6.snow.color),opacity:new s.aa(s.a6.snow.opacity),vignette:new s.aa(s.a6.snow.vignette),"vignette-color":new s.aa(s.a6.snow["vignette-color"]),"center-thinning":new s.aa(s.a6.snow["center-thinning"]),direction:new s.aa(s.a6.snow.direction),"flake-size":new s.aa(s.a6.snow["flake-size"])}));this._transitionable=new s.a8(y,o,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=o}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),f=s.an(o[0]),y=-Math.max(s.an(o[1]),.01),x=[Math.cos(f)*Math.cos(y),Math.sin(f)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette"),A=this.properties.get("vignette-color");return A.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(d,t,o={}){if(this._validate(Fl,d,o))return;const f=Object.assign({},d),y=s.a6.snow;for(const x of Object.keys(y))f[x]===void 0&&(f[x]=y[x].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,o){return(!o||o.validate!==!1)&&Y(this,d.call(js,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}},Zr=class extends s.E{constructor(d,t,o,f){super();const y=sn||(sn=new s.a9({density:new s.aa(s.a6.rain.density),intensity:new s.aa(s.a6.rain.intensity),color:new s.aa(s.a6.rain.color),opacity:new s.aa(s.a6.rain.opacity),vignette:new s.aa(s.a6.rain.vignette),"vignette-color":new s.aa(s.a6.rain["vignette-color"]),"center-thinning":new s.aa(s.a6.rain["center-thinning"]),direction:new s.aa(s.a6.rain.direction),"droplet-size":new s.aa(s.a6.rain["droplet-size"]),"distortion-strength":new s.aa(s.a6.rain["distortion-strength"])}));this._transitionable=new s.a8(y,o,new Map(f)),this.set(d,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new s.ai(y),this.scope=o}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),f=s.an(o[0]),y=-Math.max(s.an(o[1]),.01),x=[Math.cos(f)*Math.cos(y),Math.sin(f)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new s.ao(t.r,t.g,t.b,t.a*d),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(d,t,o={}){if(this._validate(Bl,d,o))return;const f=Object.assign({},d),y=s.a6.rain;for(const x of Object.keys(y))f[x]===void 0&&(f[x]=y[x].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,o){return(!o||o.validate!==!1)&&Y(this,d.call(js,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:s.a6})))}};class Gr extends s.E{constructor(t,o,f,y){super(),this.scope=f,this._options=t,this.properties=new s.ai(o),this._transitionable=new s.a8(o,f,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Hn{constructor(t,o,f){this.screenBounds=t,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(t,o){let f,y;if(t instanceof s.P||typeof t[0]=="number"){const x=s.P.convert(t);f=[x],y=o.isPointAboveHorizon(x)}else{const x=s.P.convert(t[0]),T=s.P.convert(t[1]),A=x.add(T)._div(2);f=[x,T],y=s.aq(x,T).every((R=>o.isPointAboveHorizon(R)))&&o.isPointAboveHorizon(A)}return new Hn(f,y,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return s.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(o,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<f.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?y[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(y[3]=this.cameraPoint)),s.ar(y,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],y=s.aq(o,f,t),x=this.cameraPoint.clone();switch(3*((x.y>o.y)+(x.y>f.y))+((x.x>o.x)+(x.x>f.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(t,o,f,y=0){const x=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/o._pixelsPerMercatorPixel+1,T=f?this._bufferedCameraMercator(x,o):this._bufferedScreenMercator(x,o);let A=t.tileID.wrap+(T.unwrapped?y:0);const R=T.polygon.map((te=>s.as(t.tileTransform,te,A)));if(!s.at(R,0,0,s.al,s.al))return;A=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const L=this.screenGeometryMercator.polygon.map((te=>s.au(t.tileTransform,te,A))),k=L.map((te=>new s.P(te[0],te[1]))),U=o.getFreeCameraOptions().position||new s.ae(0,0,0),B=s.au(t.tileTransform,U,A),H=L.map((te=>{const ee=s.av(te,te,B);return s.aw(ee,ee),new s.ax(B,ee)})),W=s.ay(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:H,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(X=s.az(R),X.min.x=s.aA(X.min.x,0,s.al),X.min.y=s.aA(X.min.y,0,s.al),X.max.x=s.aA(X.max.x,0,s.al),X.max.y=s.aA(X.max.y,0,s.al),X),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:W};var X}_bufferedScreenMercator(t,o){const f=Pn(t);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let y;return y=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map((x=>o.pointCoordinate3D(x))),unwrapped:!0},this._screenRaycastCache[f]=y,y}}_bufferedCameraMercator(t,o){const f=Pn(t);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let y;return y=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map((x=>o.pointCoordinate3D(x))),unwrapped:!0},this._cameraRaycastCache[f]=y,y}}_projectAndResample(t,o){const f=(function(x,T){const A=s.aB([],T.pixelMatrix,T.globeMatrix),R=[0,-s.aD,0,1],L=[0,s.aD,0,1],k=[0,0,0,1];s.aC(R,R,A),s.aC(L,L,A),s.aC(k,k,A);const U=new s.P(R[0]/R[3],R[1]/R[3]),B=new s.P(L[0]/L[3],L[1]/L[3]),H=s.aE(x,U)&&R[3]<k[3],W=s.aE(x,B)&&L[3]<k[3];if(!H&&!W)return null;const X=(function(Ee,ge,me){for(let Se=1;Se<Ee.length;Se++){const Ve=jn(ge.pointCoordinate3D(Ee[Se-1]).x),ke=jn(ge.pointCoordinate3D(Ee[Se]).x);if(me<0){if(Ve<ke)return{idx:Se,t:-Ve/(ke-1-Ve)}}else if(ke<Ve)return{idx:Se,t:(1-Ve)/(ke+1-Ve)}}return null})(x,T,H?-1:1);if(!X)return null;const{idx:te,t:ee}=X;let re=te>1?dn(x.slice(0,te),T):[],he=te<x.length?dn(x.slice(te),T):[];re=re.map((Ee=>new s.P(jn(Ee.x),Ee.y))),he=he.map((Ee=>new s.P(jn(Ee.x),Ee.y)));const le=[...re];le.length===0&&le.push(he[he.length-1]);const we=s.ak(le[le.length-1].y,(he.length===0?re[0]:he[0]).y,ee);let fe;return fe=H?[new s.P(0,we),new s.P(0,0),new s.P(1,0),new s.P(1,we)]:[new s.P(1,we),new s.P(1,1),new s.P(0,1),new s.P(0,we)],le.push(...fe),he.length===0?le.push(re[0]):le.push(...he),{polygon:le.map((Ee=>new s.ae(Ee.x,Ee.y))),unwrapped:!1}})(t,o);if(f)return f;const y=(function(x,T){let A=!1,R=-1/0,L=0;for(let U=0;U<x.length-1;U++)x[U].x>R&&(R=x[U].x,L=U);for(let U=0;U<x.length-1;U++){const B=(L+U)%(x.length-1),H=x[B],W=x[B+1];Math.abs(H.x-W.x)>.5&&(H.x<W.x?(H.x+=1,B===0&&(x[x.length-1].x+=1)):(W.x+=1,B+1===x.length-1&&(x[0].x+=1)),A=!0)}const k=s.aF(T.center.lng);return A&&k<Math.abs(k-1)&&x.forEach((U=>{U.x-=1})),{polygon:x,unwrapped:A}})(dn(t,o).map((x=>new s.P(jn(x.x),x.y))),o);return{polygon:y.polygon.map((x=>new s.ae(x.x,x.y))),unwrapped:y.unwrapped}}}function dn(d,t){return s.aG(d,(o=>{const f=t.pointCoordinate3D(o);o.x=f.x,o.y=f.y}),1/256)}function jn(d){return d<0?1+d%1:d%1}function Pn(d){return 100*d|0}function fn(d,t,o,f,y){const x=function(A,R){if(A)return y(A);if(R){if(d.url&&R.tiles&&d.tiles&&delete d.tiles,R.variants){if(!Array.isArray(R.variants))return y(new Error("variants must be an array"));for(const k of R.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return y(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){R=Object.assign(R,k);break}}}const L=s.aH(Object.assign({},R,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=t.canonicalizeTileset(L,d.url),y(null,L)}},T=(function(A,R,L){if(!A)return null;if(!R&&!L)return A;L=L||A.worldview_default;const k=Object.values(A.language||{});if(k.length===0)return null;const U=Object.values(A.worldview||{});if(U.length===0)return null;const B=k.every((W=>W===R)),H=U.every((W=>W===L));return B&&H?A:R in(A.language_options||{})||L in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null})(d.data,o,f);return T?s.o.frame((()=>x(null,T))):d.url?s.m(t.transformRequest(t.normalizeSourceURL(d.url,null,o,f),s.R.Source),x):s.o.frame((()=>{const{data:A,...R}=d;x(null,R)}))}function or(d,t){const o=Math.pow(2,t.z),f=Math.floor(s.aF(d.getWest())*o),y=Math.floor(s.aJ(d.getNorth())*o),x=Math.ceil(s.aF(d.getEast())*o),T=Math.ceil(s.aJ(d.getSouth())*o);return t.x>=f&&t.x<x&&t.y>=y&&t.y<T}class bs{constructor(t,o,f){this.bounds=t?s.aI.convert(this.validateBounds(t)):null,this.minzoom=o||0,this.maxzoom=f||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const o of t)this.extraBounds.push(s.aI.convert(this.validateBounds(o)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!or(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const o of this.extraBounds)if(or(o,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const o=new bs(t.bounds,t.minzoom,t.maxzoom);return o.addExtraBounds(t.extra_bounds),o}}class er extends s.E{constructor(t,o,f,y){if(super(),this.id=t,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,s.aH(o,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new s.aK}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=fn(this._options,this.map._requestManager,o,f,((y,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.y(y));else if(x){if(Object.assign(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of x.vector_layers)this.vectorLayerIds.push(T.id),x.worldview&&x.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=bs.fromTileJSON(x),Yt(x.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,o){const f=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(f),x=this.map._requestManager.transformRequest(y,s.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,A=T?{image:T.image.clone()}:null,R={request:x,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:A,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&s.h(f)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",R,L.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",R,L.bind(this),void 0,!0);else{const k=s.aL.call({deduped:this._deduped},R,((U,B)=>{if(U||!B)L.call(this,U);else{const H=s.aM(B.responseHeaders);R.data={cacheControl:H.cacheControl,expires:H.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",R,L.bind(this),void 0,!0)}}),!0);t.request={cancel:k}}function L(k,U){return delete t.request,t.aborted?o(null):k&&k.status!==404?o(k):(U&&U.resourceTiming&&(t.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&t.setExpiryData(U),t.loadVectorData(U,this.map.painter),s.aN(this.dispatcher),o(null,U),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ro extends s.E{constructor(t,o,f,y){super(),this.id=t,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},o),Object.assign(this,s.aH(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const o=this.map.getWorldview();this._tileJSONRequest=fn(this._options,this.map._requestManager,null,o,((f,y)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new s.y(f)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map((x=>x.id))),this.tileBounds=bs.fromTileJSON(y),Yt(y.tiles),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(f)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const f=s.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);t.request=s.n(this.map._requestManager.transformRequest(y,s.R.Tile),((x,T,A)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(x)return t.state="errored",o(x);if(!T)return o(null);const R=s.aM(A);this.map._refreshExpiredTiles&&t.setExpiryData(R),t.setTexture(T,this.map.painter),t.state="loaded",s.aN(this.dispatcher),o(null)}))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof s.T?(t.destroy(!0),t.texture&&t.texture instanceof s.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Jo([d,t],o,f,{scaled:y=!0}={}){const{tileSize:x,buffer:T}=f,{x:A,y:R,z:L}=o;if(!isFinite(A)||!isFinite(R)||!isFinite(L))throw new Error("Invalid MRT header");const k=2**L,U=k*s.aF(d),B=k*s.aJ(t);return(function([H,W],X,{scaled:te=!0}={}){if(!X)throw new Error("bandView is undefined");const{data:ee,tileSize:re,buffer:he,offset:le,scale:we,dimension:fe}=X;if(H<-he||H>re+he||W<-he||W>re+he)throw new Error(`Point (${H}, ${W}) out of bounds for tileSize=${re}, buffer=${he}`);const Ee=(W+he)*(re+2*he)+(H+he);if(new Uint32Array(ee.buffer)[Ee]===4294967295)return null;let ge=[];ge=te?[]:new X.data.constructor(fe);for(let me=0;me<fe;me++)ge[me]=Math.round(1e12*(ee[fe*Ee+me]*we+le))/1e12;return ge})([Math.min(Math.max(-T,Math.floor((U-A)*x)),x-1+T),Math.min(Math.max(-T,Math.floor((B-R)*x)),x-1+T)],f,{scaled:y})}class gs extends Ro{constructor(t,o,f,y){super(t,o,f,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},o)}triggerRepaint(t){const o=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);o&&o.enabled&&f&&o._clearRenderCacheForTile(f.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){const f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(f,s.R.Tile),x={request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor());const T=(A,R,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(A)return A.name==="AbortError"?void 0:(t.state="errored",o(A));if(this.map._refreshExpiredTiles&&R){const k=s.aM(L);t.setExpiryData(k)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!R)return o(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=R}o(null)};t.request=this.partial?t.fetchHeader(void 0,T.bind(this)):t.actor.send("loadTile",x,T.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){const f=t.texturePerLayer;if(t.flushAllQueues(),f.size){t.destroy(!0);for(const y of f.values())this.map.painter.saveTileTexture(y)}else t.destroy()}prepareTile(t,o,f,y){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(o,f,y,((x,T)=>{if(x)return t.state="errored",this.fire(new s.y(x)),void this.triggerRepaint(t);T&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(f,T,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find((({id:x})=>x===t)),f=o&&o.fields,y=f&&f.bands&&f.bands;return y?y[0]:0}getTextureDescriptor(t,o,f){if(!t)return;const y=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let x=null;o instanceof s.aQ?x=o.paint.get("raster-array-band"):o instanceof s.aR&&(x=o.paint.get("raster-particle-array-band"));const T=x||this.getInitialBand(y);if(T==null)return;if(!t.textureDescriptorPerLayer.get(o.id))return void this.prepareTile(t,y,o.id,T);if(t.updateNeeded(o.id,T)&&!f)return;const A=t.textureDescriptorPerLayer.get(o.id);return Object.assign({},A,{texture:t.texturePerLayer.get(o.id)})}getImages(t,o){const f=new Map;for(const y of t)for(const x of o){const[T,A]=x.split("/"),R=y.getLayer(T);if(!R||!R.hasBand(A)||!R.hasDataForBand(A))continue;const{bytes:L,tileSize:k,buffer:U}=R.getBandView(A),B=k+2*U,H={data:new s.q({width:B,height:B},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(x,H)}return f}queryRasterArrayValueByBandId(t,o,f){const y=o._mrt;return new Promise((x=>{const T={},A=new Set;for(const[R,L]of Object.entries(y.layers)){if(f.layerName&&R!==f.layerName)continue;const k={};T[R]=k;for(const{bands:U}of L.dataIndex)for(const B of U)f.bands&&!f.bands.includes(B)||(A.add(s.B(R,B)),o.fetchBand(R,null,B,(H=>{s.o.frame((()=>{k[B]=H?null:Jo([t.lng,t.lat],y,L.getBandView(B)),A.delete(s.B(R,B)),A.size===0&&x(T)}))}),!1))}A.size===0&&x(T)}))}_loadTileForQuery(t,o){if(this._loadTileLoaded[t.uid])return void o(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(o);this._loadTilePending[t.uid]=[o];const f=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(f,s.R.Tile);t.actor.send("loadTile",{request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((x,T,A)=>{if(x)return this._loadTilePending[t.uid].forEach((R=>R(x,null))),void delete this._loadTilePending[t.uid];if(!T)return this._loadTilePending[t.uid].forEach((R=>R(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&T){const R=s.aM(A);t.setExpiryData(R)}t._mrt=T,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((R=>R(null,T))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,o,f){return new Promise(((y,x)=>{this._loadTileForQuery(o,((T,A)=>{T?x(T):y(A?this.queryRasterArrayValueByBandId(t,o,f):null)}))}))}queryRasterArrayValue(t,o){const f=s.aS.convert(t),y=this.findLoadedParent(f);return y&&y._mrt?o.bands||!this.partial?this.queryRasterArrayValueByBandId(f,y,o):this.queryRasterArrayValueByAllBands(f,y,o):Promise.resolve(null)}findLoadedParent(t){const o=s.ae.fromLngLat(t,this.map.transform.tileSize),f=this.maxzoom+1,y=1<<f,x=Math.floor(o.x),T=Math.floor((o.x-x)*y),A=Math.floor(o.y*y),R=this.map.style.getSourceCache(this.id),L=new s.aP(f,x,f,T,A);return R.findLoadedParent(L,this.minzoom)}}const Ms={vector:er,raster:Ro,"raster-dem":class extends Ro{constructor(d,t,o,f){super(d,t,o,f),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(y,x){y&&(d.state="errored",t(y)),x&&(d.dem=x,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=s.n(this.map._requestManager.transformRequest(o,s.R.Tile),(function(y,x,T){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(y)d.state="errored",t(y);else if(x){const A=s.aM(T);this.map._refreshExpiredTiles&&d.setExpiryData(A);const R=ImageBitmap&&x instanceof ImageBitmap&&s.r(),L=1-(x.width-s.aO(x.width))/2;L<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const k=R?x:s.o.getImageData(x,L),U={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:L};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",U,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const t=d.canonical,o=Math.pow(2,t.z),f=(t.x-1+o)%o,y=t.x===0?d.wrap-1:d.wrap,x=(t.x+1+o)%o,T=t.x+1===o?d.wrap+1:d.wrap,A={};return A[new s.aP(d.overscaledZ,y,t.z,f,t.y).key]={backfilled:!1},A[new s.aP(d.overscaledZ,T,t.z,x,t.y).key]={backfilled:!1},t.y>0&&(A[new s.aP(d.overscaledZ,y,t.z,f,t.y-1).key]={backfilled:!1},A[new s.aP(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},A[new s.aP(d.overscaledZ,T,t.z,x,t.y-1).key]={backfilled:!1}),t.y+1<o&&(A[new s.aP(d.overscaledZ,y,t.z,f,t.y+1).key]={backfilled:!1},A[new s.aP(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},A[new s.aP(d.overscaledZ,T,t.z,x,t.y+1).key]={backfilled:!1}),A}},"raster-array":gs,geojson:class extends s.E{constructor(d,t,o,f){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(f),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=s.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:s.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:s.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new s.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new s.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const o of this._data.features)t.set(o.id,o);for(const o of d.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,o,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:o},f),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:d},this.workerOptions);t.scope=this.scope;const o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(s.o.resolveURL(o),s.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((f,y)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new s.y(f));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(x.resourceTiming=y.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new s.z("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const d=s.B(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,t){const o=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,y=f?{image:f.image.clone()}:null,x=this._partialReload,T={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:s.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:d.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};d.request=this.actor.send(o,T,((A,R)=>x&&!R?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):A?t(A):(d.loadVectorData(R,this.map.painter,o==="reloadTile"),t(null)))),void 0,o==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aT{constructor(d,t,o,f){super(d,t,o,f),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,s.R.Source).url);s.aU(this.urls,((t,o)=>{this._loaded=!0,t?this.fire(new s.y(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new s.y(new s.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new s.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aT,model:s.aW,"batched-model":class extends s.E{constructor(d,t,o,f){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=s.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(d)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=fn(this._options,this.map._requestManager,t,o,((f,y)=>{this._tileJSONRequest=null,this._loaded=!0,f?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new s.y(f))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new bs(y.bounds,this.minzoom,this.maxzoom)),Yt(y.tiles,this.map._requestManager._customAccessToken),this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))),d&&d(f)}))}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){const o=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(o,s.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:s.o.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){const x=Object.values(d.buckets);for(const T of x)T.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",f,y.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",f,y.bind(this),void 0,!0);function y(x,T){return d.aborted?t(null):x&&x.status!==404?t(x):(this.map._refreshExpiredTiles&&T&&d.setExpiryData(T),d.loadModelData(T,this.map.painter),d.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends s.aT{constructor(d,t,o,f){super(d,t,o,f),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((x=>typeof x!="number"))))||this.fire(new s.y(new s.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.y(new s.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new s.y(new s.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new s.y(new s.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.y(new s.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof s.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends s.E{constructor(d,t,o,f){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new bs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,s.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new s.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:t,y:o,z:f}=d.canonical;return this._implementation.hasTile({x:t,y:o,z:f})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){const{x:o,y:f,z:y}=d.tileID.canonical,x=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:o,y:f,z:y},{signal:x.signal})).then((function(T){return delete d.request,d.aborted?(d.state="unloaded",t(null)):T===void 0?(d.state="errored",t(null)):T===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):(function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement})(T)?(this.loadTileData(d,T),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((T=>{T.name!=="AbortError"&&(d.state="errored",t(T))})),d.request.cancel=()=>x.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof s.T?(d.destroy(!0),d.texture&&d.texture instanceof s.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:o,y:f,z:y}=d.tileID.canonical;this._implementation.unloadTile({x:o,y:f,z:y})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z})))}_clearTiles(){const d=s.B(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new s.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ys=function(d,t,o,f){const y=new Ms[t.type](d,t,o,f);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return s.aX(["load","abort","unload","serialize","prepare"],y),y};function Da(d,t,o=""){return`${o}:${t.id||""}:${t.layer.id}:${(function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:y,importId:x}=f;return`featureset:${y}${x?`:import:${x}`:""}`}})(d.target)}`}function Mo(d,t,o,f=""){if(d.uniqueFeatureID){const y=Da(d,t,f);if(o.has(y))return!0;o.add(y)}return!1}function Qs(d,t,o,f,y=!1){const x=t.sourceCache.transform,T=t.sourceCache.tilesIn(d,t.has3DLayers,y);T.sort(Do);const A=[];for(const R of T){const L=R.tile.queryRenderedFeatures(t,R,o,f,x,y);Object.keys(L).length&&A.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:L})}for(const R in t.layers){const L=t.layers[R];if(L.styleLayer){const k=L.styleLayer.queryRenderedFeatures(d,t.sourceCache,f);Object.keys(k).length&&A.push({wrappedTileID:0,queryResults:k})}}return A.length===0?{}:(function(R){const L={},k={};for(const U of R){const B=U.queryResults,H=U.wrappedTileID,W=k[H]=k[H]||{};for(const X in B){const te=B[X],ee=W[X]=W[X]||{},re=L[X]=L[X]||[];for(const he of te)ee[he.featureIndex]||(ee[he.featureIndex]=!0,re.push(he))}}return L})(A)}function nh(d,t,o,f,y,x){const T={},A=f.queryRenderedSymbols(d),R=[];for(const L of Object.keys(A).map(Number))R.push(y[L]);R.sort(Do);for(const L of R){const k=L.featureIndex.lookupSymbolFeatures(A[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,t,o,x);for(const U in k){const B=T[U]=T[U]||[],H=k[U];H.sort(((W,X)=>{const te=L.featureSortOrder;if(te){const ee=te.indexOf(W.featureIndex);return te.indexOf(X.featureIndex)-ee}return X.featureIndex-W.featureIndex}));for(const W of H)B.push(W)}}return T}function ul(d,t){const o=d.getRenderableIds().map((x=>d.getTileByID(x))),f=[],y={};for(let x=0;x<o.length;x++){const T=o[x],A=T.tileID.canonical.key;y[A]||(y[A]=!0,T.querySourceFeatures(f,t))}return f}function Do(d,t){const o=d.tileID,f=t.tileID;return o.overscaledZ-f.overscaledZ||o.canonical.y-f.canonical.y||o.wrap-f.wrap||o.canonical.x-f.canonical.x}function yu(d,t){const o={};if(!t)return o;for(const f of d){const y=f.layerIds.map((x=>t.getLayer(x))).filter(Boolean);if(y.length!==0){f.layers=y,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map((x=>y.filter((T=>T.id===x))[0])));for(const x of y)o[x.fqid]=f}}return o}const bo=32,_a=33,Js=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,o=0,f=0,y=0,x=0,T=0,A=0;for(1&t?y=x=T=bo:o=f=A=bo;(t>>=1)>1;){const L=o+y>>1,k=f+x>>1;1&t?(y=o,x=f,o=T,f=A):(o=y,f=x,y=T,x=A),T=L,A=k}const R=4*d;Js[R+0]=o,Js[R+1]=f,Js[R+2]=y,Js[R+3]=x}const ea=new Uint16Array(2178),ta=new Uint8Array(1089),hl=new Uint16Array(1089);function Pa(d){return d===0?-.03125:d===32?.03125:0}const vu={type:2,extent:s.al,loadGeometry:()=>[[new s.P(0,0),new s.P(s.al+1,0),new s.P(s.al+1,s.al+1),new s.P(0,s.al+1),new s.P(0,0)]]};class eo{constructor(t,o,f,y,x,T){this.tileID=t,this.uid=s.b1(),this.uses=0,this.tileSize=o,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(t){const o=t+this.timeAdded;o<s.o.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=s.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,f){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=yu(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof s.b3){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof s.b3&&x.hasRTLText){this.hasRTLText=!0,s.b4();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y],T=o.style.getOwnLayer(y);if(!T)continue;const A=T.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,A)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new s.b2}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,f){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,yu(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,o){for(const x in this.buckets){const T=this.buckets[x];if(T.uploadPending()){let A={},R=[],L={zoom:0,pitch:0,brightness:0,worldview:""};if(o){if(o.style){R=o.style.listImages();const k=T.layers[0],U=k.sourceLayer||"_geojsonTileLayer",B=o.style.getLayerSourceCache(k);B&&(A=B._state.getState(U,void 0))}L={zoom:o.transform.zoom||0,pitch:o.transform.pitch||0,brightness:o.style.getBrightness()||0,worldview:o.worldview||""}}T.upload(t,this.tileID.canonical,A,R,L)}}const f=t.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new s.T(t,y.image,f.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new s.T(t,this.glyphAtlasImage,f.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new s.T(t,this.lineAtlas.image,f.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,f),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=o.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(o)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const o in this.buckets){const f=this.buckets[o];f.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,f.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,o,f,y,x,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const A=this.evaluateQueryRenderedFeaturePadding(),R=(function(L,k){const U=s.bp([],[.5*L.width,.5*-L.height,1]);return s.bq(U,U,[1,-1,0]),s.aB(U,U,L.calculateProjMatrix(k.toUnwrapped())),Float32Array.from(U)})(x,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:R,transform:y,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:A})}querySourceFeatures(t,o){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const y=f.loadVTLayers(),x=o?o.sourceLayer:"",T=y._geojsonTileLayer||y[x];if(!T)return;const A=s.b5(o&&o.filter),{z:R,x:L,y:k}=this.tileID.canonical,U={z:R,x:L,y:k};for(let B=0;B<T.length;B++){const H=T.feature(B);if(A.needGeometry){const te=s.b6(H,!0);if(!A.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),te,this.tileID.canonical))continue}else if(!A.filter(new s.ac(this.tileID.overscaledZ,{worldview:this.worldview}),H))continue;const W=f.getId(H,x),X=new s.b7(H,R,L,k,W);X.tile=U,t.push(X)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const f=s.b8(t.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const f=Date.now();let y=!1;if(this.expirationTime>f)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{const x=this.expirationTime-o;x?this.expirationTime=f+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const o in this.buckets)if(t.style.hasLayer(o)&&this.buckets[o].layers.some((f=>f.appearances&&f.appearances.length>0)))return!0;return!1}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;const f=this.latestFeatureIndex.loadVTLayers(),y=t.style.listImages(),x=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const A=this.buckets[T],R=A.layers[0],L=R.sourceLayer||"_geojsonTileLayer",k=f[L],U=t.style.getLayerSourceCache(R);let B={};U&&(B=U._state.getState(L,void 0));const H=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},W=Object.keys(B).length>0&&!o;if(A.hasAppearances=A.layers.some((te=>te.appearances&&te.appearances.length>0)),(W&&A.stateDependentLayers.length!==0||o)&&A.update(B,k,y,H,W?A.stateDependentLayers:A.layers,o,x),W&&A.stateDependentLayers.length!==0||o||A.hasAppearances){const te={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};A.updateAppearances(this.tileID.canonical,B,y,te)}(A instanceof s.b9||A instanceof s.ba)&&t._terrain&&t._terrain.enabled&&U&&A.uploadPending()&&t._terrain._clearRenderCacheForTile(U.id,this.tileID);const X=t&&t.style&&t.style.getOwnLayer(T);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<s.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=s.o.now()+t}setTexture(t,o){const f=o.context,y=f.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof s.T?this.texture.update(t):(this.texture=new s.T(f,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,o){const f={};for(const y of o)f[y]=!0;this.dependencies[t]=f}hasDependency(t,o){for(const f of t){const y=this.dependencies[f];if(y){for(const x of o)if(y[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const f=s.bb(vu,this.tileID.canonical,this.tileTransform)[0],y=new s.bc,x=new s.bd;for(let T=0;T<f.length;T++){const{x:A,y:R}=f[T];y.emplaceBack(A,R),x.emplaceBack(T)}x.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(x),this._tileDebugBuffer=t.createVertexBuffer(y,s.be.members),this._tileDebugSegments=s.bf.simpleSegment(0,0,y.length,x.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const f=s.bb(vu,this.tileID.canonical,this.tileTransform)[0];let y,x;if(this.isRaster){const T=(function(A,R){const L=s.aY(A,R),k=Math.pow(2,A.z);for(let te=0;te<_a;te++)for(let ee=0;ee<_a;ee++){const re=s.aZ((A.x+(ee+Pa(ee))/bo)/k),he=s.a_((A.y+(te+Pa(te))/bo)/k),le=R.project(re,he),we=te*_a+ee;ea[2*we+0]=Math.round((le.x*L.scale-L.x)*s.al),ea[2*we+1]=Math.round((le.y*L.scale-L.y)*s.al)}ta.fill(0),hl.fill(0);for(let te=2045;te>=0;te--){const ee=4*te,re=Js[ee+0],he=Js[ee+1],le=Js[ee+2],we=Js[ee+3],fe=re+le>>1,Ee=he+we>>1,ge=fe+Ee-he,me=Ee+re-fe,Se=he*_a+re,Ve=we*_a+le,ke=Ee*_a+fe,st=Math.hypot((ea[2*Se+0]+ea[2*Ve+0])/2-ea[2*ke+0],(ea[2*Se+1]+ea[2*Ve+1])/2-ea[2*ke+1])>=16;ta[ke]=ta[ke]||(st?1:0),te<1022&&(ta[ke]=ta[ke]||ta[(he+me>>1)*_a+(re+ge>>1)]||ta[(we+me>>1)*_a+(le+ge>>1)])}const U=new s.a$,B=new s.b0;let H=0;function W(te,ee){const re=ee*_a+te;return hl[re]===0&&(U.emplaceBack(ea[2*re+0],ea[2*re+1],te*s.al/bo,ee*s.al/bo),hl[re]=++H),hl[re]-1}function X(te,ee,re,he,le,we){const fe=te+re>>1,Ee=ee+he>>1;if(Math.abs(te-le)+Math.abs(ee-we)>1&&ta[Ee*_a+fe])X(le,we,te,ee,fe,Ee),X(re,he,le,we,fe,Ee);else{const ge=W(te,ee),me=W(re,he),Se=W(le,we);B.emplaceBack(ge,me,Se)}}return X(0,0,bo,bo,bo,0),X(bo,bo,0,0,0,bo),{vertices:U,indices:B}})(this.tileID.canonical,o);y=T.vertices,x=T.indices}else{y=new s.a$,x=new s.b0;for(const{x:A,y:R}of f)y.emplaceBack(A,R,0,0);const T=s.bg(y.int16.subarray(0,4*y.length),void 0,4);for(let A=0;A<T.length;A+=3)x.emplaceBack(T[A],T[A+1],T[A+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,s.bh.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(x),this._tileBoundsSegments=s.bf.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugBuffers(t,o){const f=o.projection;if(!f||f.name!=="globe"||o.freezeTileCoverage)return;const y=this.tileID.canonical,x=s.bi(y,o),T=s.bj(x),A=s.aj(o.zoom);let R;A>0&&(R=s.bk(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,o,T,R,A),this._makeGlobeTileDebugTextBuffer(t,y,o,T,R,A)}_globePoint(t,o,f,y,x,T,A){let R=s.bl(t,o,f);if(T){const L=1<<f.z,k=s.aF(y.center.lng),U=s.aJ(y.center.lat),B=(f.x+.5)/L-k;let H=0;B>.5?H=-1:B<-.5&&(H=1);let W=(t/s.al+f.x)/L+H,X=(o/s.al+f.y)/L;W=(W-k)*y._pixelsPerMercatorPixel+k,X=(X-U)*y._pixelsPerMercatorPixel+U;const te=[W*y.worldSize,X*y.worldSize,0];s.af(te,te,T),R=s.bm(R,te,A)}return s.af(R,R,x)}_makeGlobeTileDebugBorderBuffer(t,o,f,y,x,T){const A=new s.bc,R=new s.bd,L=new s.bn,k=(B,H,W,X,te)=>{const ee=(W-B)/(te-1),re=(X-H)/(te-1),he=A.length;for(let le=0;le<te;le++){const we=B+le*ee,fe=H+le*re;A.emplaceBack(we,fe);const Ee=this._globePoint(we,fe,o,f,y,x,T);L.emplaceBack(Ee[0],Ee[1],Ee[2]),R.emplaceBack(he+le)}},U=s.al;k(0,0,U,0,16),k(U,0,U,U,16),k(U,U,0,U,16),k(0,U,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(R),this._tileDebugBuffer=t.createVertexBuffer(A,s.be.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,s.bo.members),this._tileDebugSegments=s.bf.simpleSegment(0,0,A.length,R.length)}_makeGlobeTileDebugTextBuffer(t,o,f,y,x,T){const A=s.al/4,R=new s.bc,L=new s.b0,k=new s.bn,U=25;L.reserve(32),R.reserve(U),k.reserve(U);const B=(H,W)=>U*H+W;for(let H=0;H<U;H++){const W=H*A;for(let X=0;X<U;X++){const te=X*A;R.emplaceBack(te,W);const ee=this._globePoint(te,W,o,f,y,x,T);k.emplaceBack(ee[0],ee[1],ee[2])}}for(let H=0;H<4;H++)for(let W=0;W<4;W++){const X=B(H,W),te=B(H,W+1),ee=B(H+1,W),re=B(H+1,W+1);L.emplaceBack(X,te,ee),L.emplaceBack(ee,te,re)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(R,s.be.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(k,s.bo.members),this._tileDebugTextSegments=s.bf.simpleSegment(0,0,U,32)}destroy(t=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof s.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}s.br.setPbf(s.bs);class ya extends eo{constructor(t,o,f,y,x){super(t,o,f,y,x),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,o,f){const y=f.context,x=y.gl;let T=this.texturePerLayer.get(t)||f.getTileTexture(o.width);T&&T instanceof s.T?T.update(o,{premultiply:!1}):T=new s.T(y,o,x.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,T)}flushQueues(t){const o=this._workQueuePerLayer.get(t)||[],f=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const o=this._workQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const o=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}}fetchHeader(t=16384,o){const f=this._mrt=new s.br(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=s.bt(y,((x,T,A)=>{if(x)o(x);else try{const R=f.getHeaderLength(T);if(R>t)return void(this.request=this.fetchHeader(R,o));f.parseHeader(T),this._isHeaderLoaded=!0;let L=0;for(const k of Object.values(f.layers))L=Math.max(L,k.dataIndex[k.dataIndex.length-1].lastByte);T.byteLength>=L&&(this.entireBuffer=T),o(null,this.entireBuffer||T,A)}catch(R){o(R)}})),this.request}fetchBandForRender(t,o,f,y){this.fetchBand(t,o,f,(x=>{if(x)return void y(x);this.updateTextureDescriptor(t,o,f);const T=this.textureDescriptorPerLayer.get(o);y(null,T?T.img:null)}))}fetchBand(t,o,f,y,x=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void y(new Error("Tile header is not ready"));const A=this.actor;if(!A)return void y(new Error("Can't fetch tile band without an actor"));let R;const L=s.B(String(f),s.B(this.tileID.key,t));let k=this._taskQueue.get(L);k?k.add(y):(k=new Set,k.add(y),this._taskQueue.set(L,k));const U=(X,te)=>{R.complete(X,te),X?y(X):(k.values().forEach((ee=>ee(null,te))),this._taskQueue.delete(L))},B=(X,te)=>{if(X)return y(X);const ee=A.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:te,task:R},U,void 0,!0);if(o!==null){const re=this._workQueuePerLayer.get(o)||[];re.push((()=>{ee&&ee.cancel(),R.cancel()})),this._workQueuePerLayer.has(o)||this._workQueuePerLayer.set(o,re)}};let H;try{H=T.getLayer(t)}catch(X){if(this.state==="reloading")return;throw X}if(!H)return void y(new Error(`Unknown sourceLayer "${t}"`));if(H.hasDataForBand(f))return k.values().forEach((X=>X(null,null))),void this._taskQueue.delete(L);const W=H.getDataRange([f]);if(R=T.createDecodingTask(W),!R||R.tasks.length)if(o!==null&&this.flushQueues(o),this.entireBuffer)B(null,this.entireBuffer.slice(W.firstByte,W.lastByte+1));else{const X=Object.assign({},this.requestParams,{headers:{Range:`bytes=${W.firstByte}-${W.lastByte}`}}),te=s.bt(X,B);if(o!==null){const ee=this._fetchQueuePerLayer.get(o)||[];ee.push((()=>{te.cancel(),R.cancel()})),this._fetchQueuePerLayer.has(o)||this._fetchQueuePerLayer.set(o,ee)}}}updateNeeded(t,o){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==o||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,o,f){if(!this._mrt)return;const y=this._mrt.getLayer(t);if(!y||!y.hasBand(f)||!y.hasDataForBand(f))return;const{bytes:x,tileSize:T,buffer:A,offset:R,scale:L}=y.getBandView(f),k=T+2*A,U=new s.q({width:k,height:k},x),B=this.texturePerLayer.get(o);B&&B instanceof s.T&&B.update(U,{premultiply:!1}),this.textureDescriptorPerLayer.set(o,{layer:t,band:f,img:U,buffer:A,offset:R,tileSize:T,format:y.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const o of this.texturePerLayer.values())o&&o instanceof s.T&&o.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class dl{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,f){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const x={value:o,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout((()=>{this.remove(t,x)}),f)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const f=t.wrapped().key,y=o===void 0?0:this.data[f].indexOf(o),x=this.data[f][y];return this.data[f].splice(y,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const f in this.data)for(const y of this.data[f])t(y.value)||o.push(y);for(const f of o)this.remove(f.value.tileID,f)}}class xu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,f){const y=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},Object.assign(this.stateChanges[t][y],f),this.deletedStates[t]===null){this.deletedStates[t]={};for(const x in this.state[t])x!==y&&(this.deletedStates[t][x]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const x in this.state[t][y])f[x]||(this.deletedStates[t][y][x]=null)}else for(const x in f)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][x]===null&&delete this.deletedStates[t][y][x]}removeFeatureState(t,o,f){if(this.deletedStates[t]===null)return;const y=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},f&&o!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][f]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(f in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][f]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,o){const f=this.state[t]||{},y=this.stateChanges[t]||{},x=this.deletedStates[t];if(x===null)return{};if(o!==void 0){const A=String(o),R=Object.assign({},f[A],y[A]);if(x){const L=x[o];if(L===null)return{};for(const k in L)delete R[k]}return R}const T=Object.assign({},f,y);if(x)for(const A in x)delete T[A];return T}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){const f={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const T in this.stateChanges[y])this.state[y][T]||(this.state[y][T]={}),Object.assign(this.state[y][T],this.stateChanges[y][T]),x[T]=this.state[y][T];f[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(this.deletedStates[y]===null)for(const T in this.state[y])x[T]={},this.state[y][T]={};else for(const T in this.deletedStates[y]){if(this.deletedStates[y][T]===null)this.state[y][T]={};else if(this.state[y][T])for(const A of Object.keys(this.deletedStates[y][T]))delete this.state[y][T][A];x[T]=this.state[y][T]}f[y]=f[y]||{},Object.assign(f[y],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const y in t)t[y].refreshFeatureState(o)}}class qo extends s.E{constructor(t,o,f){super(),this.id=t,this._onlySymbols=f,o.on("data",(y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),o.on("error",(()=>{this._sourceErrored=!0})),this._source=o,this._tiles={},this._cache=new dl(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new xu,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const f=this._tiles[o];f.upload(t,this.map?this.map.painter:void 0),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(lc).map((t=>t.key))}getRenderableIds(t,o){const f=[];for(const y in this._tiles)this._isIdRenderable(+y,t,o)&&f.push(this._tiles[y]);return t?f.sort(((y,x)=>{const T=y.tileID,A=x.tileID,R=new s.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),L=new s.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-A.overscaledZ||L.y-R.y||L.x-R.x})).map((y=>y.tileID.key)):f.map((y=>y.tileID)).sort(lc).map((y=>y.key))}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,f){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(f||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){const f=this._tiles[t];f&&(f.state!=="loading"&&(f.state=o),this._loadTile(f,this._tileLoaded.bind(this,f,t,o)))}_tileLoaded(t,o,f,y,x){if(y){if(t.state="errored",y.status!==404)this._source.fire(new s.y(y,{tile:t}));else{if(this._source.fire(new s.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const A=this.map.painter.terrain;this.update(this.transform,A.getScaledDemTileSize(),!0),A.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=s.o.now(),f==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let T=new Map;x&&x.responseHeaders&&(T=x.responseHeaders),this._source.fire(new s.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(t){const o=this.getRenderableIds();for(let y=0;y<o.length;y++){const x=o[y];if(t.neighboringTiles&&t.neighboringTiles[x]){const T=this.getTileByID(x);f(t,T),f(T,t)}}function f(y,x){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let T=x.tileID.canonical.x-y.tileID.canonical.x;const A=x.tileID.canonical.y-y.tileID.canonical.y,R=Math.pow(2,y.tileID.canonical.z),L=x.tileID.key;T===0&&A===0||Math.abs(A)>1||(Math.abs(T)>1&&(Math.abs(T+R)===1?T+=R:Math.abs(T-R)===1&&(T-=R)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,T,A),y.neighboringTiles&&y.neighboringTiles[L]&&(y.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,f,y){for(const x in this._tiles){let T=this._tiles[x];if(y[x]||!T.hasData()||T.tileID.overscaledZ<=o||T.tileID.overscaledZ>f)continue;let A=T.tileID;for(;T&&T.tileID.overscaledZ>o+1;){const L=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[L.key],T&&T.hasData()&&(A=L)}let R=A;for(;R.overscaledZ>o;)if(R=R.scaledTo(R.overscaledZ-1),t[R.key]){y[A.key]=A;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const f=this._loadedParentTiles[t.key];return f&&f.tileID.overscaledZ>=o?f:null}for(let f=t.overscaledZ-1;f>=o;f--){const y=t.scaledTo(f),x=this._getLoadedTile(y);if(x)return x}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;const f=Math.ceil(t.width/o)+1,y=Math.ceil(t.height/o)+1,x=Math.floor(f*y*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(A)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const f={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+o),f[x.tileID.key]=x}this._tiles=f;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,o,f,y,x){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let A,R=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const B=L.attenuationRange()[0],H=Math.floor(B)-Math.log2(L.getDemUpscale());R>H&&(R=H)}if(this.used||this.usedForTerrain){if(this._source.tileID)A=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((B=>new s.aP(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y)));else if(this.tileCoverLift!==0){const B=t.clone();B.tileCoverLift=this.tileCoverLift,A=B.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&t.projection.name==="globe"&&(A.push(new s.aP(1,0,1,0,0)),A.push(new s.aP(1,0,1,1,0)),A.push(new s.aP(1,0,1,0,1)),A.push(new s.aP(1,0,1,1,1)))}else if(A=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);A=A.filter((H=>B(H)))}}else A=[];if(A.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ho(this._source.type)){const B=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),H=Math.min(B,this._source.maxzoom);if(T){const W=t.extendTileCover(A,H);for(const X of W)A.push(X)}else if(x){const W=t.extendTileCoverToNearPlane(A,this.transform.getFrustum(H),H);for(const X of W)A.push(X)}else if(this.castsShadows&&y){const W=t.extendTileCover(A,H,y);for(const X of W)this._shadowCasterTiles[X.key]=!0,A.push(X)}}const k=this._updateRetainedTiles(A);if(Ho(this._source.type)&&A.length!==0){const B={},H={},W=Object.keys(k);for(const te of W){const ee=k[te],re=this._tiles[te];if(!re||re.fadeEndTime&&re.fadeEndTime<=s.o.now())continue;const he=this.findLoadedParent(ee,Math.max(ee.overscaledZ-qo.maxOverzooming,this._source.minzoom));he&&(this._addTile(he.tileID),B[he.tileID.key]=he.tileID),H[te]=ee}const X=A[A.length-1].overscaledZ;for(const te in this._tiles){const ee=this._tiles[te];if(k[te]||!ee.hasData())continue;let re=ee.tileID;for(;re.overscaledZ>X;){re=re.scaledTo(re.overscaledZ-1);const he=this._tiles[re.key];if(he&&he.hasData()&&H[re.key]){k[te]=ee.tileID;break}}}for(const te in B)k[te]||(this._coveredTiles[te]=!0,k[te]=B[te])}for(const B in k)this._tiles[B].clearFadeHold();const U=s.bu(this._tiles,k);for(const B of U){const H=this._tiles[B];H.hasSymbolBuckets&&!H.holdingForFade()?H.setHoldDuration(this.map._fadeDuration):H.hasSymbolBuckets&&!H.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(t.length===0)return o;const f={},y=t.reduce(((L,k)=>Math.min(L,k.overscaledZ)),1/0),x=t[0].overscaledZ,T=Math.max(x-qo.maxOverzooming,this._source.minzoom),A=Math.max(x+qo.maxUnderzooming,this._source.minzoom),R={};for(const L of t){const k=this._addTile(L);o[L.key]=L,k.hasData()||y<this._source.maxzoom&&(R[L.key]=L)}this._retainLoadedChildren(R,y,A,o);for(const L of t){let k=this._tiles[L.key];if(k.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const B=L.children(this._source.maxzoom)[0],H=this.getTile(B);if(H&&H.hasData()){o[B.key]=B;continue}}else{const B=L.children(this._source.maxzoom);if(o[B[0].key]&&o[B[1].key]&&o[B[2].key]&&o[B[3].key])continue}let U=k.wasRequested();for(let B=L.overscaledZ-1;B>=T;--B){const H=L.scaledTo(B);if(f[H.key]||(f[H.key]=!0,k=this.getTile(H),!k&&U&&(k=this._addTile(H)),k&&(o[H.key]=H,U=k.wasRequested(),k.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let f,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){f=this._loadedParentTiles[y.key];break}o.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;y=x}for(const x of o)this._loadedParentTiles[x]=f}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const f=!!o;if(!f){const y=this.map?this.map.painter:null,x=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new ya(t,x,this.transform.tileZoom,y,this._isRaster):new eo(t,x,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o.uses++,this._tiles[t.key]=o,f||this._source.fire(new s.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const f=o.getExpiryTimeout();f&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),f))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,f){const y=[],x=this.transform;if(!x)return y;const T=x.projection.name==="globe",A=s.aF(x.center.lng);for(const R in this._tiles){const L=this._tiles[R];if(f&&L.clearQueryDebugViz(),L.holdingForFade())continue;let k;if(T){const U=L.tileID.canonical;if(U.z===0){const B=[Math.abs(s.aA(A,...Po(U,-1))-A),Math.abs(s.aA(A,...Po(U,1))-A)];k=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(s.aA(A,...Po(U,-1))-A),Math.abs(s.aA(A,...Po(U,0))-A),Math.abs(s.aA(A,...Po(U,1))-A)];k=[B.indexOf(Math.min(...B))-1]}}else k=[0];for(const U of k){const B=t.containsTile(L,x,o,U);B&&y.push(B)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){const f=this.getRenderableIds(t,o).map((x=>this._tiles[x].tileID)),y=this.transform.projection.name==="globe";for(const x of f)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=y?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return f}sortCoordinatesByDistance(t){const o=t.slice(),f=this.transform._camera.position,y=this.transform._camera.forward(),x={};for(const T of o){const A=1/(1<<T.canonical.z);x[T.key]=((T.canonical.x+.5)*A+T.wrap-f[0])*y[0]+((T.canonical.y+.5)*A-f[1])*y[1]-f[2]*y[2]}return o.sort(((T,A)=>x[T.key]-x[A.key])),o}hasTransition(){if(this._source.hasTransition())return!0;if(Ho(this._source.type))for(const t in this._tiles){const o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=s.o.now())return!0}return!1}setFeatureState(t,o,f){this._state.updateState(t=t||"_geojsonTileLayer",o,f)}removeFeatureState(t,o,f){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,f)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,f){const y=this._tiles[t];y&&y.setDependencies(o,f)}reloadTilesForDependencies(t,o){for(const f in this._tiles)this._tiles[f].hasDependency(t,o)&&this._reloadTile(+f,"reloading");this._cache.filter((f=>!f.hasDependency(t,o)))}_preloadTiles(t,o){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(t,o))};return void this._source.on("data",R)}const f=new Map,y=Array.isArray(t)?t:[t],x=this.map.painter.terrain,T=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const R of y){const L=R.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of L)f.set(k.key,k);this.usedForTerrain&&R.updateElevation(!1)}const A=Array.from(f.values());s.bv(A,((R,L)=>{const k=new eo(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(k,(U=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),L(U,k)}))}),o)}}function lc(d,t){const o=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||f-o||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function Ho(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Po(d,t){const o=1<<d.z;return[d.x/o+t,(d.x+1)/o+t]}qo.maxOverzooming=10,qo.maxUnderzooming=3;class Uc{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,o=!1;for(const f in this.style._mergedLayers){const y=this.style._mergedLayers[f];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:t,visibilityChanged:o});else if(y.type==="model"){const x=this.style.getLayerSource(y);x&&x.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(const o of this.layers){const f=o.layer;let y=!1;f.type==="fill-extrusion"?y=!f.isHidden(t)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?y=!f.isHidden(t)&&f.paint.get("building-opacity")>0:f.type==="model"&&(y=!f.isHidden(t)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&o.visible,o.visible=y}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(const y of this.layers){const x=y.layer,T=this.style.getLayerSourceCache(x);let A=1;x.type==="fill-extrusion"?A=y.visible?x.paint.get("fill-extrusion-vertical-scale"):0:x.type==="building"&&(A=y.visible?x.paint.get("building-vertical-scale"):0);let R=T?T.getTile(o):null;if(!R&&T)for(const L in T._tiles){const k=T._tiles[L];if(o.canonical.isChildOf(k.tileID.canonical)){R=k;break}}this.currentBuildingBuckets.push({bucket:R?R.getBucket(x):null,tileID:R?R.tileID:o,verticalScale:A})}t.hasAnyZOffset=!1;let f=!1;for(let y=0;y<t.symbolInstances.length;y++){const x=t.symbolInstances.get(y),T=x.zOffset,A=this._getHeightAtTileOffset(o,x.tileAnchorX,x.tileAnchorY);x.zOffset=A!==Number.NEGATIVE_INFINITY?A:T,f||T===x.zOffset||(f=!0),t.hasAnyZOffset||x.zOffset===0||(t.hasAnyZOffset=!0)}f&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,f,y){let x=o,T=f;if(t.canonical.z!==y.canonical.z){const A=y.canonical,R=1/(1<<t.canonical.z-A.z);x=(o+t.canonical.x*s.al)*R-A.x*s.al|0,T=(f+t.canonical.y*s.al)*R-A.y*s.al|0}return{tileX:x,tileY:T}}_getHeightAtTileOffset(t,o,f){let y,x;for(let T=0;T<this.layers.length;++T){const A=this.layers[T].layer;if(A.type!=="fill-extrusion"&&A.type!=="building")continue;const{bucket:R,tileID:L,verticalScale:k}=this.currentBuildingBuckets[T];if(!R)continue;const{tileX:U,tileY:B}=this._mapCoordToOverlappingTile(t,o,f,L),H=R.getHeightAtTileCoord(U,B);H&&H.height!==void 0&&(H.hidden?y=H.height:x=Math.max(H.height*k,x||0))}if(x!==void 0)return x;for(let T=0;T<this.layers.length;++T){const A=this.layers[T];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:R,tileID:L}=this.currentBuildingBuckets[T];if(!R)continue;const{tileX:k,tileY:U}=this._mapCoordToOverlappingTile(t,o,f,L),B=R.getHeightAtTileCoord(k,U);if(B&&!B.hidden)return B.height===void 0&&y!==void 0?Math.min(B.maxHeight,y)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Xr(d,t){const o={};for(const f in d)f!=="ref"&&(o[f]=d[f]);return s.bw.forEach((f=>{f in t&&(o[f]=t[f])})),o}function va(d){d=d.slice();const t=Object.create(null);for(let o=0;o<d.length;o++)t[d[o].id]=d[o];for(let o=0;o<d.length;o++)"ref"in d[o]&&(d[o]=Xr(d[o],t[d[o].ref]));return d}const Mn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function jc(d,t,o){o.push({command:Mn.addSource,args:[d,t[d]]})}function Gc(d,t,o){t.push({command:Mn.removeSource,args:[d]}),o[d]=!0}function Vl(d,t,o,f){Gc(d,o,f),jc(d,t,o)}function Ul(d,t,o){let f;for(f in d[o])if(d[o].hasOwnProperty(f)&&f!=="data"&&!s.bx(d[o][f],t[o][f]))return!1;for(f in t[o])if(t[o].hasOwnProperty(f)&&f!=="data"&&!s.bx(d[o][f],t[o][f]))return!1;return!0}function xa(d,t,o,f,y,x){let T;for(T in t=t||{},d=d||{})d.hasOwnProperty(T)&&(s.bx(d[T],t[T])||o.push({command:x,args:[f,T,t[T],y]}));for(T in t)t.hasOwnProperty(T)&&!d.hasOwnProperty(T)&&(s.bx(d[T],t[T])||o.push({command:x,args:[f,T,t[T],y]}))}function to(d){return d.id}function Wa(d,t){return d[t.id]=t,d}function ia(d,t,o){const f=t.createTileMatrix(d,d.worldSize,o.toUnwrapped());return s.aB(new Float32Array(16),d.projMatrix,f)}function qc(d,t,o){if(t.projection.name===o.projection.name)return d.projMatrix;const f=o.clone();return f.setProjection(t.projection),ia(f,t.getProjection(),d)}function bu(d,t,o){return t.name===o.projection.name?d.projMatrix:ia(o,t,d)}class wu{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=s.aA(t,0,1);let o=1,f=this._distances[o];const y=t*this.paddedLength+this.padding;for(;f<y&&o<this._distances.length;)f=this._distances[++o];const x=o-1,T=this._distances[x],A=f-T,R=A>0?(y-T)/A:0;return this.points[x].mult(1-R).add(this.points[o].mult(R))}}class cc{constructor(t,o,f){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(t/f),this.yCellCount=Math.ceil(o/f);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,f,y,x){this._forEachCell(o,f,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(t,o,f,y){this._forEachCell(o-y,f-y,o+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(f),this.circles.push(y)}_insertBoxCell(t,o,f,y,x,T){this.boxCells[x].push(T)}_insertCircleCell(t,o,f,y,x,T){this.circleCells[x].push(T)}_query(t,o,f,y,x,T){if(f<0||t>this.width||y<0||o>this.height)return!x&&[];const A=[];if(t<=0&&o<=0&&this.width<=f&&this.height<=y){if(x)return!0;for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const L=this.circles[3*R],k=this.circles[3*R+1],U=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:L-U,y1:k-U,x2:L+U,y2:k+U})}return T?A.filter(T):A}return this._forEachCell(t,o,f,y,this._queryCell,A,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?A.length>0:A}_queryCircle(t,o,f,y,x){const T=t-f,A=t+f,R=o-f,L=o+f;if(A<0||T>this.width||L<0||R>this.height)return!y&&[];const k=[];return this._forEachCell(T,R,A,L,this._queryCellCircle,k,{hitTest:y,circle:{x:t,y:o,radius:f},seenUids:{box:{},circle:{}}},x),y?k.length>0:k}query(t,o,f,y,x){return this._query(t,o,f,y,!1,x)}hitTest(t,o,f,y,x){return this._query(t,o,f,y,!0,x)}hitTestCircle(t,o,f,y){return this._queryCircle(t,o,f,!0,y)}_queryCell(t,o,f,y,x,T,A,R){const L=A.seenUids,k=this.boxCells[x];if(k!==null){const B=this.bboxes;for(const H of k)if(!L.box[H]){L.box[H]=!0;const W=4*H;if(t<=B[W+2]&&o<=B[W+3]&&f>=B[W+0]&&y>=B[W+1]&&(!R||R(this.boxKeys[H]))){if(A.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[H],x1:B[W],y1:B[W+1],x2:B[W+2],y2:B[W+3]})}}}const U=this.circleCells[x];if(U!==null){const B=this.circles;for(const H of U)if(!L.circle[H]){L.circle[H]=!0;const W=3*H;if(this._circleAndRectCollide(B[W],B[W+1],B[W+2],t,o,f,y)&&(!R||R(this.circleKeys[H]))){if(A.hitTest)return T.push(!0),!0;{const X=B[W],te=B[W+1],ee=B[W+2];T.push({key:this.circleKeys[H],x1:X-ee,y1:te-ee,x2:X+ee,y2:te+ee})}}}}}_queryCellCircle(t,o,f,y,x,T,A,R){const L=A.circle,k=A.seenUids,U=this.boxCells[x];if(U!==null){const H=this.bboxes;for(const W of U)if(!k.box[W]){k.box[W]=!0;const X=4*W;if(this._circleAndRectCollide(L.x,L.y,L.radius,H[X+0],H[X+1],H[X+2],H[X+3])&&(!R||R(this.boxKeys[W])))return T.push(!0),!0}}const B=this.circleCells[x];if(B!==null){const H=this.circles;for(const W of B)if(!k.circle[W]){k.circle[W]=!0;const X=3*W;if(this._circlesCollide(H[X],H[X+1],H[X+2],L.x,L.y,L.radius)&&(!R||R(this.circleKeys[W])))return T.push(!0),!0}}}_forEachCell(t,o,f,y,x,T,A,R){const L=this._convertToXCellCoord(t),k=this._convertToYCellCoord(o),U=this._convertToXCellCoord(f),B=this._convertToYCellCoord(y);for(let H=L;H<=U;H++)for(let W=k;W<=B;W++)if(x.call(this,t,o,f,y,this.xCellCount*W+H,T,A,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,f,y,x,T){const A=y-t,R=x-o,L=f+T;return L*L>A*A+R*R}_circleAndRectCollide(t,o,f,y,x,T,A){const R=(T-y)/2,L=Math.abs(t-(y+R));if(L>R+f)return!1;const k=(A-x)/2,U=Math.abs(o-(x+k));if(U>k+f)return!1;if(L<=R||U<=k)return!0;const B=L-R,H=U-k;return B*B+H*H<=f*f}}const Gs={unknown:0,flipRequired:1,flipNotRequired:2},uc=Math.tan(85*Math.PI/180);function hc(d,t,o,f,y,x,T){const A=s.bB();if(o)if(x.name==="globe"){const R=s.bC(y,t);s.aB(A,A,R)}else{const R=s.bD([],T);A[0]=R[0],A[1]=R[1],A[4]=R[2],A[5]=R[3],f||s.bA(A,A,y.angle)}else s.aB(A,y.labelPlaneMatrix,d);return A}function jl(d,t,o,f,y,x,T){const A=hc(d,t,o,f,y,x,T);return x.name==="globe"&&o||(A[2]=A[6]=A[10]=A[14]=0),A}function fl(d,t,o,f,y,x,T){if(o){if(x.name==="globe"){const A=hc(d,t,o,f,y,x,T);return s.bk(A,A),s.aB(A,d,A),A}{const A=s.by(d),R=s.bz([]);return R[0]=T[0],R[1]=T[1],R[4]=T[2],R[5]=T[3],s.aB(A,A,R),f||s.bA(A,A,-y.angle),A}}return y.glCoordMatrix}function Ss(d,t,o,f){const y=[d,t,o,1];o?s.aC(y,y,f):ba(y,y,f);const x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function Hc(d,t){return Math.min(.5+d/t*.5,1.5)}function rh(d,t){const o=d[0]/d[3],f=d[1]/d[3];return o>=-t[0]&&o<=t[0]&&f>=-t[1]&&f<=t[1]}function ld(d,t,o,f,y,x,T,A,R,L,k=1){const U=o.transform,B=f?d.textSizeData:d.iconSizeData,H=s.bJ(B,o.transform.zoom,k),W=U.projection.name==="globe",X=[256/o.width*2+1,256/o.height*2+1],te=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;te.clear();let ee=null;W&&(ee=f?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const re=d.lineVertexArray,he=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,le=o.transform.width/o.transform.height;let we,fe=!1;for(let Ee=0;Ee<he.length;Ee++){const ge=he.get(Ee),{numGlyphs:me,writingMode:Se}=ge;if(Se!==s.bK.vertical||fe||we===s.bK.horizontal||(fe=!0),we=Se,(ge.hidden||Se===s.bK.vertical)&&!fe){pl(me,te);continue}fe=!1;const Ve=new s.P(ge.tileAnchorX,ge.tileAnchorY),ke=d.elevationType==="road",st=!!U.elevation||ke;let{x:Xe,y:ht,z:zt}=U.projection.projectTilePoint(Ve.x,Ve.y,L.canonical),$e=null;if(st){const ri=ke?d.getElevationFeatureForText(Ee):null;$e={getElevation:R,elevation:U.elevation,elevationFeature:ri};const[Mi,tn,Gi]=R(Ve,U.elevation,ri);Xe+=Mi,ht+=tn,zt+=Gi}const Pe=[Xe,ht,zt,1];if(s.aC(Pe,Pe,t),!rh(Pe,X)){pl(me,te);continue}const dt=Pe[3],Ke=Hc(o.transform.getCameraToCenterDistance(U.projection),dt),At=s.bL(B,H,ge),wt=T?At/Ke:At*Ke,Ht=Ss(Xe,ht,zt,y);if(Ht[3]<=0){pl(me,te);continue}let mt={};const _t=s.an(d.layers[0].layout.get("text-max-angle")),$t=Math.cos(_t),Jt=T?null:$e,Xt=lf(ge,wt,!1,A,t,y,x,d.glyphOffsetArray,re,te,ee,Ht,Ve,mt,le,Jt,U.projection,L,T,$t);fe=Xt.useVertical,Jt&&Xt.needsFlipping&&(mt={}),(Xt.notEnoughRoom||fe||Xt.needsFlipping&&lf(ge,wt,!0,A,t,y,x,d.glyphOffsetArray,re,te,ee,Ht,Ve,mt,le,Jt,U.projection,L,T,$t).notEnoughRoom)&&pl(me,te)}f?(d.text.dynamicLayoutVertexBuffer.updateData(te),ee&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(ee)):(d.icon.dynamicLayoutVertexBuffer.updateData(te),ee&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(ee))}function On(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te){const{lineStartIndex:ee,glyphStartIndex:re,segment:he}=A,le=re+A.numGlyphs,we=ee+A.lineLength,fe=t.getoffsetX(re),Ee=t.getoffsetX(le-1),ge=Tu(d*fe,o,f,y,x,T,he,ee,we,R,L,k,U,B,!0,H,W,X,te);if(!ge)return null;const me=Tu(d*Ee,o,f,y,x,T,he,ee,we,R,L,k,U,B,!0,H,W,X,te);return me?{first:ge,last:me}:null}function cd(d,t,o,f){return d===s.bK.horizontal&&Math.abs(f)>Math.abs(o)?{useVertical:!0}:d===s.bK.vertical?f>0?{needsFlipping:!0}:null:t!==Gs.unknown&&(function(y,x){return y===0||Math.abs(x/y)>uc})(o,f)?t===Gs.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function lf(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee,re,he){const le=t/24,we=d.lineOffsetX*le,fe=d.lineOffsetY*le,{lineStartIndex:Ee,glyphStartIndex:ge,numGlyphs:me,segment:Se,writingMode:Ve,flipState:ke}=d,st=Ee+d.lineLength,Xe=ht=>{if(k){const[dt,Ke,At]=ht.up,wt=L.length;s.bM(k,wt+0,dt,Ke,At),s.bM(k,wt+1,dt,Ke,At),s.bM(k,wt+2,dt,Ke,At),s.bM(k,wt+3,dt,Ke,At)}const[zt,$e,Pe]=ht.point;s.bN(L,zt,$e,Pe,ht.angle)};if(me>1){const ht=On(le,A,we,fe,o,U,B,d,R,x,H,X,!1,te,ee,re,he);if(!ht)return{notEnoughRoom:!0};if(f&&!o){let[zt,$e,Pe]=ht.first.point,[dt,Ke,At]=ht.last.point;[zt,$e]=Ss(zt,$e,Pe,T),[dt,Ke]=Ss(dt,Ke,At,T);const wt=cd(Ve,ke,(dt-zt)*W,Ke-$e);if(d.flipState=wt&&wt.needsFlipping?Gs.flipRequired:Gs.flipNotRequired,wt)return wt}Xe(ht.first);for(let zt=ge+1;zt<ge+me-1;zt++){const $e=Tu(le*A.getoffsetX(zt),we,fe,o,U,B,Se,Ee,st,R,x,H,X,!1,!1,te,ee,re,he);if(!$e)return L.length-=4*(zt-ge),{notEnoughRoom:!0};Xe($e)}Xe(ht.last)}else{if(f&&!o){const zt=Ss(B.x,B.y,0,y),$e=Ee+Se+1,Pe=new s.P(R.getx($e),R.gety($e)),dt=Ss(Pe.x,Pe.y,0,y),Ke=dt[3]>0?dt:Oi(B,Pe,zt,1,y,void 0,te,ee.canonical),At=cd(Ve,ke,(Ke[0]-zt[0])*W,Ke[1]-zt[1]);if(d.flipState=At&&At.needsFlipping?Gs.flipRequired:Gs.flipNotRequired,At)return At}const ht=Tu(le*A.getoffsetX(ge),we,fe,o,U,B,Se,Ee,st,R,x,H,X,!1,!1,te,ee,re,he);if(!ht)return{notEnoughRoom:!0};Xe(ht)}return{}}function Gl(d,t,o,f,y){const{x,y:T,z:A}=f.projectTilePoint(d.x,d.y,t);if(!y)return Ss(x,T,A,o);const[R,L,k]=y.getElevation(d,y.elevation,y.elevationFeature);return Ss(x+R,T+L,A+k,o)}function Oi(d,t,o,f,y,x,T,A){const R=Gl(d.sub(t)._unit()._add(d),A,y,T,x);return s.av(R,o,R),s.aw(R,R),s.bG(R,o,R,f)}function Tu(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee,re){const he=f?d-t:d+t;let le=he>0?1:-1,we=0;f&&(le*=-1,we=Math.PI),le<0&&(we+=Math.PI);let fe=A+T+(le>0?0:1)|0,Ee=y,ge=y,me=0,Se=0;const Ve=Math.abs(he),ke=[],st=[];let Xe=x,ht=Xe,zt=s.bE([]);const $e=()=>Oi(ht,Xe,ge,Ve-me+1,k,B,X,te.canonical);for(;me+Se<=Ve;){if(fe+=le,fe<A||fe>=R)return null;if(ge=Ee,ht=Xe,ke.push(ge),H&&st.push(ht),Xe=new s.P(L.getx(fe),L.gety(fe)),Ee=U[fe],!Ee){const Jt=Gl(Xe,te.canonical,k,X,B);Ee=Jt[3]>0?U[fe]=Jt:$e()}me+=Se;const _t=s.av([],Ee,ge),$t=s.bF(ge,Ee);if(o&&$t>0&&Se>0&&s.bI(zt,_t)/(Se*$t)<re)return null;Se=$t,zt=_t}W&&B&&(U[fe]&&(Ee=$e(),Se=s.bF(ge,Ee),zt=s.av([],Ee,ge)),U[fe]=Ee);const Pe=(Ve-me)/Se,dt=Xe.sub(ht)._mult(Pe)._add(ht),Ke=s.bG([],ge,zt,Pe);let At=[0,0,1],wt=zt[0],Ht=zt[1];if(ee&&(At=X.upVector(te.canonical,dt.x,dt.y),At[0]!==0||At[1]!==0||At[2]!==1)){const _t=[At[2],0,-At[0]],$t=s.bH([],At,_t);s.aw(_t,_t),s.aw($t,$t),wt=s.bI(zt,_t),Ht=s.bI(zt,$t)}if(o){const _t=s.bH([],At,zt);s.aw(_t,_t),s.bG(Ke,Ke,_t,o*le)}const mt=we+Math.atan2(Ht,wt);return ke.push(Ke),H&&st.push(dt),{point:Ke,angle:mt,path:ke,tilePath:st,up:At}}function pl(d,t){const o=t.length,f=o+4*d;t.resize(f),t.float32.fill(-1/0,4*o,4*f)}function ba(d,t,o){const f=t[0],y=t[1];return d[0]=o[0]*f+o[4]*y+o[12],d[1]=o[1]*f+o[5]*y+o[13],d[3]=o[3]*f+o[7]*y+o[15],d}const wo=100;class ho{constructor(t,o,f=new cc(t.width+200,t.height+200,25),y=new cc(t.width+200,t.height+200,25)){this.transform=t,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wo,this.screenBottomBoundary=t.height+wo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,f,y,x,T,A,R,L,k,U){let B=f.projectedAnchorX,H=f.projectedAnchorY,W=f.projectedAnchorZ;const X=f.tileAnchorX,te=f.tileAnchorY,ee=f.elevation,re=f.tileID,he=t.getProjection();if(ee&&re){const[st,Xe,ht]=he.upVector(re.canonical,f.tileAnchorX,f.tileAnchorY),zt=he.upVectorScale(re.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=st*ee*zt,H+=Xe*ee*zt,W+=ht*ee*zt}const le=t.projection.name==="globe",we=t.projection.name==="globe"?s.aj(this.transform.zoom):0;if(re&&le&&we<1&&!T){const st=1<<re.canonical.z,Xe=s.bO(X,te);s.bP(Xe,Xe,1/s.al),s.bQ(Xe,Xe,s.bO(re.canonical.x,re.canonical.y)),s.bP(Xe,Xe,1/st),s.bR(Xe,Xe,s.bO(y[0],y[1])),Xe[0]=s.bS(Xe[0],-.5,.5),s.bP(Xe,Xe,s.al);const ht=s.bT(Xe[0],Xe[1],s.al/(2*Math.PI),1);s.aC(ht,ht,x),B=s.ak(B,ht[0],we),H=s.ak(H,ht[1],we),W=s.ak(W,ht[2],we)}const fe=this.projectAndGetPerspectiveRatio(k,B,H,W,f.tileID,he.name==="globe"||!!ee||this.transform.pitch>0,he),Ee=L*fe.perspectiveRatio,ge=(f.x1*o+A.x-f.padding)*Ee+fe.point.x,me=(f.y1*o+A.y-f.padding)*Ee+fe.point.y,Se=(f.x2*o+A.x+f.padding)*Ee+fe.point.x,Ve=(f.y2*o+A.y+f.padding)*Ee+fe.point.y,ke=fe.perspectiveRatio<=.55||fe.occluded;return!this.isInsideGrid(ge,me,Se,Ve)||!R&&this.grid.hitTest(ge,me,Se,Ve,U)||ke?{box:[],offscreen:!1,occluded:fe.occluded}:{box:[ge,me,Se,Ve],offscreen:this.isOffscreen(ge,me,Se,Ve),occluded:!1}}placeCollisionCircles(t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te){const ee=[],re=this.transform.elevation,he=t.getProjection(),le=t.elevationType==="road",we=!!re||le,fe=s.bU.getAtTileOffsetFunc(te,this.transform.center.lat,this.transform.worldSize,he),Ee=new s.P(f.tileAnchorX,f.tileAnchorY),ge=new s.P(f.tileAnchorX,f.tileAnchorY);let{x:me,y:Se,z:Ve}=he.projectTilePoint(ge.x,ge.y,te.canonical),ke=null;if(we){const $t=le?t.getElevationFeatureForText(y):null;ke={getElevation:fe,elevation:re,elevationFeature:$t};const[Jt,Xt,ri]=fe(Ee,re,$t);me+=Jt,Se+=Xt,Ve+=ri}const st=he.name==="globe",Xe=this.projectAndGetPerspectiveRatio(R,me,Se,Ve,te,st||!!re||this.transform.pitch>0,he),{perspectiveRatio:ht}=Xe,zt=(B?A/ht:A*ht)/s.bX,$e=Ss(me,Se,Ve,L),Pe=f.lineOffsetX*zt,dt=f.lineOffsetY*zt,Ke=s.an(t.layers[0].layout.get("text-max-angle")),At=Math.cos(Ke),wt=Xe.signedDistanceFromCamera>0?On(zt,T,Pe,dt,le&&f.flipState===1,$e,ge,f,x,L,{},we&&!B?ke:null,B&&we,he,te,B,At):null;let Ht=!1,mt=!1,_t=!0;if(wt&&!Xe.occluded){const $t=.5*W*ht+X,Jt=new s.P(-100,-100),Xt=new s.P(this.screenRightBoundary,this.screenBottomBoundary),ri=new wu,{first:Mi,last:tn}=wt,Gi=Mi.path.length;let Fn=[];for(let Ni=Gi-1;Ni>=1;Ni--)Fn.push(Mi.path[Ni]);for(let Ni=1;Ni<tn.path.length;Ni++)Fn.push(tn.path[Ni]);const Pi=2.5*$t;k&&(Fn=Fn.map((([Ni,Bn,_n],In)=>(we&&!st&&(_n=fe(In<Gi-1?Mi.tilePath[Gi-1-In]:tn.tilePath[In-Gi+2],re,ke.elevationFeature)[2]),Ss(Ni,Bn,_n,k)))),Fn.some((Ni=>Ni[3]<=0))&&(Fn=[]));let yn=[];if(Fn.length>0){let Ni=1/0,Bn=-1/0,_n=1/0,In=-1/0;for(const Dn of Fn)Ni=Math.min(Ni,Dn[0]),_n=Math.min(_n,Dn[1]),Bn=Math.max(Bn,Dn[0]),In=Math.max(In,Dn[1]);Bn>=Jt.x&&Ni<=Xt.x&&In>=Jt.y&&_n<=Xt.y&&(yn=[Fn.map((Dn=>new s.P(Dn[0],Dn[1])))],(Ni<Jt.x||Bn>Xt.x||_n<Jt.y||In>Xt.y)&&(yn=s.bV(yn,Jt.x,Jt.y,Xt.x,Xt.y)))}for(const Ni of yn){ri.reset(Ni,.25*$t);let Bn=0;Bn=ri.length<=.5*$t?1:Math.ceil(ri.paddedLength/Pi)+1;for(let _n=0;_n<Bn;_n++){const In=_n/Math.max(Bn-1,1),Dn=ri.lerp(In),Wi=Dn.x+wo,Un=Dn.y+wo;ee.push(Wi,Un,$t,0);const nn=Wi-$t,gr=Un-$t,wn=Wi+$t,Ei=Un+$t;if(_t=_t&&this.isOffscreen(nn,gr,wn,Ei),mt=mt||this.isInsideGrid(nn,gr,wn,Ei),!o&&this.grid.hitTestCircle(Wi,Un,$t,H)&&(Ht=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Ht,occluded:!1}}}}return{circles:!U&&Ht||!mt?[]:ee,offscreen:_t,collisionDetected:Ht,occluded:Xe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let f=1/0,y=1/0,x=-1/0,T=-1/0;for(const k of t){const U=new s.P(k.x+wo,k.y+wo);f=Math.min(f,U.x),y=Math.min(y,U.y),x=Math.max(x,U.x),T=Math.max(T,U.y),o.push(U)}const A=this.grid.query(f,y,x,T).concat(this.ignoredGrid.query(f,y,x,T)),R={},L={};for(const k of A){const U=k.key;if(R[U.bucketInstanceId]===void 0&&(R[U.bucketInstanceId]={}),R[U.bucketInstanceId][U.featureIndex])continue;const B=[new s.P(k.x1,k.y1),new s.P(k.x2,k.y1),new s.P(k.x2,k.y2),new s.P(k.x1,k.y2)];s.bW(o,B)&&(R[U.bucketInstanceId][U.featureIndex]=!0,L[U.bucketInstanceId]===void 0&&(L[U.bucketInstanceId]=[]),L[U.bucketInstanceId].push(U.featureIndex))}return L}insertCollisionBox(t,o,f,y,x){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:x},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,f,y,x){const T=o?this.ignoredGrid:this.grid,A={bucketInstanceId:f,featureIndex:y,collisionGroupID:x};for(let R=0;R<t.length;R+=4)T.insertCircle(A,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,o,f,y,x,T,A){const R=[o,f,y,1];let L=!1;y||this.transform.pitch>0?(s.aC(R,R,t),this.fogState&&x&&A.name!=="globe"&&(L=(function(B,H,W,X,te,ee){const re=ee.calculateFogTileMatrix(te),he=[H,W,X];return s.af(he,he,re),Ot(B,s.ag(he),ee.pitch,ee._fov)})(this.fogState,o,f,y,x.toUnwrapped(),this.transform)>.9)):ba(R,R,t);const k=R[3];return{point:new s.P((R[0]/k+1)/2*this.transform.width+wo,(-R[1]/k+1)/2*this.transform.height+wo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/k*.5,1.5),signedDistanceFromCamera:k,occluded:T&&R[2]>k||L}}isOffscreen(t,o,f,y){return f<wo||t>=this.screenRightBoundary||y<wo||o>this.screenBottomBoundary}isInsideGrid(t,o,f,y){return f>=0&&t<this.gridRightBoundary&&y>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=s.bz([]);return s.bq(t,t,[-100,-100,0]),t}}class xi{constructor(t,o,f,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):y&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class An{constructor(t,o,f,y,x,T=!1){this.text=new xi(t?t.text:null,o,f,x),this.icon=new xi(t?t.icon:null,o,y,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class xn{constructor(t,o,f,y=!1){this.text=t,this.icon=o,this.skipFade=f,this.clipped=y}}class z{constructor(){this.invProjMatrix=s.bB(),this.viewportMatrix=s.bB(),this.circles=[]}}class Q{constructor(t,o,f,y,x){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=x}}class oe{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:f=>f.collisionGroupID===o}}return this.collisionGroups[t]}}function De(d,t,o,f,y){const{horizontalAlign:x,verticalAlign:T}=s.c0(d),A=-(x-.5)*t,R=-(T-.5)*o,L=s.c1(d,f);return new s.P(A+L[0]*y,R+L[1]*y)}function Rt(d,t,o,f,y){const x=new s.P(d,t);return o&&x._rotate(f?y:-y),x}class qt{constructor(t,o,f,y,x,T){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new ho(this.transform,x),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new oe(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,f,y,x=1){const T=f.getBucket(o),A=f.latestFeatureIndex;if(!T||!A||o.fqid!==T.layerIds[0])return;const R=T.layers[0].layout,L=T.layers[0].paint,k=f.collisionBoxArray,U=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),B=f.tileSize/s.al,H=f.tileID.toUnwrapped();this.transform.setProjection(T.projection);const W=(X=f.tileID,te=T.getProjection(),ee=this.transform,te.name===this.projection?ee.calculateProjMatrix(X.toUnwrapped()):ia(ee,te,X));var X,te,ee;const re=R.get("text-pitch-alignment")==="map",he=R.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const le=o.dynamicFilter(),we=o.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(f),Ee=jl(W,f.tileID.canonical,re,he,this.transform,T.getProjection(),fe);let ge=null;const me=T.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(re){const Pe=fl(W,f.tileID.canonical,re,he,this.transform,T.getProjection(),fe);ge=s.aB([],this.transform.labelPlaneMatrix,Pe)}let Se=null;le&&f.latestFeatureIndex&&(Se={unwrappedTileID:H,dynamicFilter:le,dynamicFilterNeedsFeature:we}),this.retainedQueryData[T.bucketInstanceId]=new Q(T.bucketInstanceId,A,T.sourceLayerIndex,T.index,f.tileID);const[Ve,ke]=T.layers[0].layout.get("text-size-scale-range"),st=s.aA(x,Ve,ke),[Xe,ht]=R.get("icon-size-scale-range"),zt=s.aA(x,Xe,ht),$e={bucket:T,layout:R,paint:L,posMatrix:W,invMatrix:me,mercatorCenter:[s.aF(this.transform.center.lng),s.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ee,labelToScreenMatrix:ge,clippingData:Se,scale:U,textPixelRatio:B,holdingForFade:f.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:s.bJ(T.textSizeData,this.transform.zoom,st),partiallyEvaluatedIconSize:s.bJ(T.iconSizeData,this.transform.zoom,zt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(y)for(const Pe of T.sortKeyRanges){const{sortKey:dt,symbolInstanceStart:Ke,symbolInstanceEnd:At}=Pe;t.push({sortKey:dt,symbolInstanceStart:Ke,symbolInstanceEnd:At,parameters:$e})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:$e})}attemptAnchorPlacement(t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee,re,he,le,we){const{textOffset0:fe,textOffset1:Ee,crossTileID:ge}=X,me=[fe,Ee],Se=De(t,T,A,me,R),Ve=this.collisionIndex.placeCollisionBox(ee,R,o,f,y,x,Rt(Se.x,Se.y,L,k,this.transform.angle),W,U,B,H.predicate);if(he){const ke=ee.getSymbolInstanceIconSize(we,this.transform.zoom,X.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ee,ke,he,f,y,x,Rt(Se.x,Se.y,L,k,this.transform.angle),W,U,B,H.predicate).box.length===0)return}if(Ve.box.length>0){let ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(ke=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:me,width:T,height:A,anchor:t,textScale:R,prevAnchor:ke},this.markUsedJustification(ee,t,X,re),ee.allowVerticalPlacement&&(this.markUsedOrientation(ee,re,X),this.placedOrientations[ge]=re),{shift:Se,placedGlyphBoxes:Ve}}}placeLayerBucketPart(t,o,f,y,x=1){const{bucket:T,layout:A,paint:R,posMatrix:L,textLabelPlaneMatrix:k,labelToScreenMatrix:U,clippingData:B,textPixelRatio:H,mercatorCenter:W,invMatrix:X,holdingForFade:te,collisionBoxArray:ee,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:he,collisionGroup:le,latestFeatureIndex:we}=t.parameters,fe=A.get("text-optional"),Ee=A.get("icon-optional"),ge=A.get("text-allow-overlap"),me=A.get("icon-allow-overlap"),Se=A.get("text-rotation-alignment")==="map",Ve=A.get("icon-rotation-alignment")==="map",ke=A.get("text-pitch-alignment")==="map",st=R.get("symbol-z-offset"),Xe=A.get("symbol-elevation-reference")==="sea",ht=A.get("symbol-placement"),[zt,$e]=A.get("text-size-scale-range"),[Pe,dt]=A.get("icon-size-scale-range"),Ke=s.aA(x,zt,$e),At=s.aA(x,Pe,dt),wt=A.get("text-variable-anchor"),Ht=Se&&ht!=="point",mt=Ve&&ht!=="point",_t=wt&&T.hasTextData(),$t=T.hasIconTextFit()&&_t&&T.hasIconData();this.transform.setProjection(T.projection);const Jt=_t||Ht,Xt=mt||$t;let ri=ge&&(me||!T.hasIconData()||Ee),Mi=me&&(ge||!T.hasTextData()||fe);const tn=!st.isConstant();!T.collisionArrays&&ee&&T.deserializeCollisionBoxes(ee),f&&y&&T.updateCollisionDebugBuffers(this.transform.zoom,ee,Ke,At);const Gi=(Pi,yn,Ni)=>{const{crossTileID:Bn,numVerticalGlyphVertices:_n}=Pi;let In=null;if(B&&B.dynamicFilterNeedsFeature||tn){const wr=this.retainedQueryData[T.bucketInstanceId];In=we.loadFeature({featureIndex:Pi.featureIndex,bucketIndex:wr.bucketIndex,sourceLayerIndex:wr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},In,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new s.P(Pi.tileAnchorX,Pi.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Bn]=new xn(!1,!1,!1,!0),void o.add(Bn);const Dn=st.evaluate(In,{});if(o.has(Bn))return;if(te)return void(this.placements[Bn]=new xn(!1,!1,!1));let Wi=!1,Un=!1,nn=!0,gr=!1,wn=!1,Ei=null,pn={box:null,offscreen:null,occluded:null},br={box:null},Er=null,zr=null,qr=null,ca=0,_o=0,so=0;Ni.textFeatureIndex?ca=Ni.textFeatureIndex:Pi.useRuntimeCollisionCircles&&(ca=Pi.featureIndex),Ni.verticalTextFeatureIndex&&(_o=Ni.verticalTextFeatureIndex);const ls=T.elevationFeatures?T.elevationFeatures[Pi.elevationFeatureIndex]:void 0,Va=wr=>{wr.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Jr=this.transform.elevation;wr.elevation=Xe?Dn:Dn+s.bU.getAtTileOffset(wr.tileID,new s.P(wr.tileAnchorX,wr.tileAnchorY),Jr,ls),wr.elevation+=Pi.zOffset},Qr=Ni.textBox;if(Qr){Va(Qr);const wr=ar=>{let Hr=s.bK.horizontal;if(T.allowVerticalPlacement&&!ar&&this.prevPlacement){const Ws=this.prevPlacement.placedOrientations[Bn];Ws&&(this.placedOrientations[Bn]=Ws,Hr=Ws,this.markUsedOrientation(T,Hr,Pi))}return Hr},Jr=(ar,Hr)=>{if(T.allowVerticalPlacement&&_n>0&&Ni.verticalTextBox){for(const Ws of T.writingModes)if(Ws===s.bK.vertical?(pn=Hr(),br=pn):pn=ar(),pn&&pn.box&&pn.box.length)break}else pn=ar()};if(wt){let ar=wt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Bn]){const $r=this.prevPlacement.variableOffsets[Bn];ar.indexOf($r.anchor)>0&&(ar=ar.filter((ja=>ja!==$r.anchor)),ar.unshift($r.anchor))}const Hr=($r,ja,Bh)=>{const Sl=T.getSymbolInstanceTextSize(re,Pi,this.transform.zoom,yn),$u=($r.x2-$r.x1)*Sl+2*$r.padding,Ud=($r.y2-$r.y1)*Sl+2*$r.padding,sl=Pi.hasIconTextFit&&!me?ja:null;sl&&Va(sl);let Oc={box:[],offscreen:!1,occluded:!1};const Fs=ge?2*ar.length:ar.length;for(let Ga=0;Ga<Fs;++Ga){const Al=this.attemptAnchorPlacement(ar[Ga%ar.length],$r,W,X,Jt,$u,Ud,Sl,Se,ke,H,L,le,Ga>=ar.length,Pi,yn,T,Bh,sl,re,he);if(Al&&(Oc=Al.placedGlyphBoxes,Oc&&Oc.box&&Oc.box.length)){Wi=!0,Ei=Al.shift;break}}return Oc};Jr((()=>Hr(Qr,Ni.iconBox,s.bK.horizontal)),(()=>{const $r=Ni.verticalTextBox;return $r&&Va($r),T.allowVerticalPlacement&&!(pn&&pn.box&&pn.box.length)&&_n>0&&$r?Hr($r,Ni.verticalIconBox,s.bK.vertical):{box:null,offscreen:null,occluded:null}})),pn&&(Wi=pn.box,nn=pn.offscreen,gr=pn.occluded);const Ws=wr(!(!pn||!pn.box));if(!Wi&&this.prevPlacement){const $r=this.prevPlacement.variableOffsets[Bn];$r&&(this.variableOffsets[Bn]=$r,this.markUsedJustification(T,$r.anchor,Pi,Ws))}}else{const ar=(Hr,Ws)=>{const $r=T.getSymbolInstanceTextSize(re,Pi,this.transform.zoom,yn),ja=this.collisionIndex.placeCollisionBox(T,$r,Hr,W,X,Jt,new s.P(0,0),ge,H,L,le.predicate);return ja&&ja.box&&ja.box.length&&(this.markUsedOrientation(T,Ws,Pi),this.placedOrientations[Bn]=Ws),ja};Jr((()=>ar(Qr,s.bK.horizontal)),(()=>{const Hr=Ni.verticalTextBox;return T.allowVerticalPlacement&&_n>0&&Hr?(Va(Hr),ar(Hr,s.bK.vertical)):{box:null,offscreen:null,occluded:null}})),wr(!!(pn&&pn.box&&pn.box.length))}}if(Er=pn,Wi=Er&&Er.box&&Er.box.length>0,nn=Er&&Er.offscreen,gr=Er&&Er.occluded,Pi.useRuntimeCollisionCircles){const wr=Pi.centerJustifiedTextSymbolIndex>=0?Pi.centerJustifiedTextSymbolIndex:Pi.verticalPlacedTextSymbolIndex,Jr=T.text.placedSymbolArray.get(wr),ar=s.bL(T.textSizeData,re,Jr),Hr=A.get("text-padding");zr=this.collisionIndex.placeCollisionCircles(T,ge,Jr,wr,T.lineVertexArray,T.glyphOffsetArray,ar,L,k,U,f,ke,le.predicate,Pi.collisionCircleDiameter*ar/s.bX,Hr,this.retainedQueryData[T.bucketInstanceId].tileID),Wi=ge||zr.circles.length>0&&!zr.collisionDetected,nn=nn&&zr.offscreen,gr=zr.occluded}if(Ni.iconFeatureIndex&&(so=Ni.iconFeatureIndex),Ni.iconBox){const wr=Jr=>{Va(Jr);const ar=Pi.hasIconTextFit&&Ei?Rt(Ei.x,Ei.y,Se,ke,this.transform.angle):new s.P(0,0),Hr=T.getSymbolInstanceIconSize(he,this.transform.zoom,Pi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Hr,Jr,W,X,Xt,ar,me,H,L,le.predicate)};br&&br.box&&br.box.length&&Ni.verticalIconBox?(qr=wr(Ni.verticalIconBox),Un=qr.box.length>0):(qr=wr(Ni.iconBox),Un=qr.box.length>0),nn=nn&&qr.offscreen,wn=qr.occluded}const Ua=fe||Pi.numHorizontalGlyphVertices===0&&_n===0,rl=Ee||Pi.numIconVertices===0;if(Ua||rl?rl?Ua||(Un=Un&&Wi):Wi=Un&&Wi:Un=Wi=Un&&Wi,Wi&&Er&&Er.box&&this.collisionIndex.insertCollisionBox(Er.box,A.get("text-ignore-placement"),T.bucketInstanceId,br&&br.box&&_o?_o:ca,le.ID),Un&&qr&&this.collisionIndex.insertCollisionBox(qr.box,A.get("icon-ignore-placement"),T.bucketInstanceId,so,le.ID),zr&&(Wi&&this.collisionIndex.insertCollisionCircles(zr.circles,A.get("text-ignore-placement"),T.bucketInstanceId,ca,le.ID),f)){const wr=T.bucketInstanceId;let Jr=this.collisionCircleArrays[wr];Jr===void 0&&(Jr=this.collisionCircleArrays[wr]=new z);for(let ar=0;ar<zr.circles.length;ar+=4)Jr.circles.push(zr.circles[ar+0]),Jr.circles.push(zr.circles[ar+1]),Jr.circles.push(zr.circles[ar+2]),Jr.circles.push(zr.collisionDetected?1:0)}const oo=T.projection.name!=="globe";ri=ri&&(oo||!gr),Mi=Mi&&(oo||!wn),this.placements[Bn]=new xn(Wi||ri,Un||Mi,nn||T.justReloaded),o.add(Bn)},Fn=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,Fn),T.elevationType==="road"&&T.updateRoadElevation(Fn.canonical),T.updateZOffset(),T.sortFeaturesByY){const Pi=T.getSortedSymbolIndexes(this.transform.angle);for(let yn=Pi.length-1;yn>=0;--yn){const Ni=Pi[yn];Gi(T.symbolInstances.get(Ni),Ni,T.collisionArrays[Ni])}T.hasAnyZOffset&&s.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Pi=T.getSortedIndexesByZOffset();for(let yn=0;yn<Pi.length;++yn){const Ni=Pi[yn];Gi(T.symbolInstances.get(Ni),Ni,T.collisionArrays[Ni])}}else for(let Pi=t.symbolInstanceStart;Pi<t.symbolInstanceEnd;Pi++)Gi(T.symbolInstances.get(Pi),Pi,T.collisionArrays[Pi]);if(f&&T.bucketInstanceId in this.collisionCircleArrays){const Pi=this.collisionCircleArrays[T.bucketInstanceId];s.bk(Pi.invProjMatrix,L),Pi.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(t,o,f,y){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:R,crossTileID:L}=f,k=s.c2(o),U=y===s.bK.vertical?R:k==="left"?x:k==="center"?T:k==="right"?A:-1;x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:L),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=U>=0&&T!==U?0:L),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=U>=0&&A!==U?0:L),R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=U>=0&&R!==U?0:L)}markUsedOrientation(t,o,f){const y=o===s.bK.horizontal||o===s.bK.horizontalOnly?o:0,x=o===s.bK.vertical?o:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:L}=f,k=t.text.placedSymbolArray;T>=0&&(k.get(T).placedOrientation=y),A>=0&&(k.get(A).placedOrientation=y),R>=0&&(k.get(R).placedOrientation=y),L>=0&&(k.get(L).placedOrientation=x)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let f=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const y=o?o.symbolFadeChange(t):1,x=o?o.opacities:{},T=o?o.variableOffsets:{},A=o?o.placedOrientations:{};for(const R in this.placements){const L=this.placements[R],k=x[R];k?(this.opacities[R]=new An(k,y,L.text,L.icon,null,L.clipped),f=f||L.text!==k.text.placed||L.icon!==k.icon.placed):(this.opacities[R]=new An(null,y,L.text,L.icon,L.skipFade,L.clipped),f=f||L.text||L.icon)}for(const R in x){const L=x[R];if(!this.opacities[R]){const k=new An(L,y,!1,!1);k.isHidden()||(this.opacities[R]=k,f=f||L.text.placed||L.icon.placed)}}for(const R in T)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=T[R]);for(const R in A)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=A[R]);f?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,f,y){const x=new Set;for(const T of o){const A=T.getBucket(t);A&&T.latestFeatureIndex&&t.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,x,T,T.collisionBoxArray,f,y,T.tileID,t.scope),A.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(A,T.tileID),A.elevationType==="road"&&A.updateRoadElevation(T.tileID.canonical),A.updateZOffset())}}updateBucketOpacities(t,o,f,y,x,T,A,R){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const L=t.layers[0].layout,k=t.layers[0].paint,U=!!t.layers[0].dynamicFilter(),B=new An(null,0,!1,!1,!0),H=L.get("text-allow-overlap"),W=L.get("icon-allow-overlap"),X=L.get("text-variable-anchor"),te=L.get("text-rotation-alignment")==="map",ee=L.get("text-pitch-alignment")==="map",re=k.get("symbol-z-offset"),he=L.get("symbol-elevation-reference")==="sea",le=!re.isConstant(),we=new An(null,0,H&&(W||!t.hasIconData()||L.get("icon-optional")),W&&(H||!t.hasTextData()||L.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const fe=(ge,me,Se)=>{for(let Ve=0;Ve<me/4;Ve++)ge.opacityVertexArray.emplaceBack(Se)};let Ee=0;T&&t.updateReplacement(A,T);for(let ge=0;ge<t.symbolInstances.length;ge++){const me=t.symbolInstances.get(ge),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:Ve,crossTileID:ke,numIconVertices:st,tileAnchorX:Xe,tileAnchorY:ht}=me;let zt=null;const $e=this.retainedQueryData[t.bucketInstanceId];le&&me&&$e&&(zt=f.latestFeatureIndex.loadFeature({featureIndex:me.featureIndex,bucketIndex:$e.bucketIndex,sourceLayerIndex:$e.sourceLayerIndex,layoutVertexArrayOffset:0}));const Pe=re.evaluate(zt,{}),dt=o.has(ke);let Ke=this.opacities[ke];dt?Ke=B:Ke||(Ke=we,this.opacities[ke]=Ke),o.add(ke);const At=Se>0||Ve>0,wt=st>0,Ht=this.placedOrientations[ke],mt=Ht===s.bK.vertical,_t=Ht===s.bK.horizontal||Ht===s.bK.horizontalOnly;!At&&!wt||Ke.isHidden()||Ee++;let $t=!1;if((At||wt)&&T)for(const Jt of t.activeReplacements){if(s.bY(Jt,x,s.bZ.Symbol,R)||Jt.min.x>Xe||Xe>Jt.max.x||Jt.min.y>ht||ht>Jt.max.y)continue;const Xt=s.b_(Xe,ht,A.canonical,Jt.footprintTileId.canonical);if($t=s.b$(Xt,Jt.footprint),$t)break}if(At){const Jt=$t?ws:wa(Ke.text);fe(t.text,Se,mt?ws:Jt),fe(t.text,Ve,_t?ws:Jt);const Xt=Ke.text.isHidden(),{leftJustifiedTextSymbolIndex:ri,centerJustifiedTextSymbolIndex:Mi,rightJustifiedTextSymbolIndex:tn,verticalPlacedTextSymbolIndex:Gi}=me,Fn=t.text.placedSymbolArray,Pi=Xt||mt?1:0;ri>=0&&(Fn.get(ri).hidden=Pi),Mi>=0&&(Fn.get(Mi).hidden=Pi),tn>=0&&(Fn.get(tn).hidden=Pi),Gi>=0&&(Fn.get(Gi).hidden=Xt||_t?1:0);const yn=this.variableOffsets[ke];yn&&this.markUsedJustification(t,yn.anchor,me,Ht);const Ni=this.placedOrientations[ke];Ni&&(this.markUsedJustification(t,"left",me,Ni),this.markUsedOrientation(t,Ni,me))}if(wt){const Jt=$t?ws:wa(Ke.icon),{placedIconSymbolIndex:Xt,verticalPlacedIconSymbolIndex:ri}=me,Mi=t.icon.placedSymbolArray,tn=Ke.icon.isHidden()?1:0;Xt>=0&&(fe(t.icon,st,mt?ws:Jt),Mi.get(Xt).hidden=tn),ri>=0&&(fe(t.icon,me.numVerticalIconVertices,_t?ws:Jt),Mi.get(ri).hidden=tn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Jt=t.collisionArrays[ge];if(Jt){let Xt=new s.P(0,0),ri=!0;if(Jt.textBox||Jt.verticalTextBox){if(X){const tn=this.variableOffsets[ke];tn?(Xt=De(tn.anchor,tn.width,tn.height,tn.textOffset,tn.textScale),te&&Xt._rotate(ee?this.transform.angle:-this.transform.angle)):ri=!1}U&&(ri=!Ke.clipped),Jt.textBox&&Ti(t.textCollisionBox.collisionVertexArray,Ke.text.placed,!ri||mt,Pe,he,Xt.x,Xt.y),Jt.verticalTextBox&&Ti(t.textCollisionBox.collisionVertexArray,Ke.text.placed,!ri||_t,Pe,he,Xt.x,Xt.y)}const Mi=ri&&!!(!_t&&Jt.verticalIconBox);Jt.iconBox&&Ti(t.iconCollisionBox.collisionVertexArray,Ke.icon.placed,Mi,Pe,he,me.hasIconTextFit?Xt.x:0,me.hasIconTextFit?Xt.y:0),Jt.verticalIconBox&&Ti(t.iconCollisionBox.collisionVertexArray,Ke.icon.placed,!Mi,Pe,he,me.hasIconTextFit?Xt.x:0,me.hasIconTextFit?Xt.y:0)}}}if(t.fullyClipped=Ee===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const ge=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=ge.invProjMatrix,t.placementViewportMatrix=ge.viewportMatrix,t.collisionCircleArray=ge.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const f=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*f>t}setStale(){this.stale=!0}}function Ti(d,t,o,f,y,x,T){d.emplaceBack(t?1:0,o?1:0,x||0,T||0,f,y?1:0),d.emplaceBack(t?1:0,o?1:0,x||0,T||0,f,y?1:0),d.emplaceBack(t?1:0,o?1:0,x||0,T||0,f,y?1:0),d.emplaceBack(t?1:0,o?1:0,x||0,T||0,f,y?1:0)}const on=Math.pow(2,25),io=Math.pow(2,24),Pr=Math.pow(2,17),As=Math.pow(2,16),na=Math.pow(2,9),Za=Math.pow(2,8),Xa=Math.pow(2,1);function wa(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,o=Math.floor(127*d.opacity);return o*on+t*io+o*Pr+t*As+o*na+t*Za+o*Xa+t}const ws=0;class Oa{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,f,y,x,T){const A=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(A,y,t[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(((R,L)=>R.sortKey-L.sortKey)));this._currentPartIndex<A.length;){const R=A[this._currentPartIndex];if(o.placeLayerBucketPart(R,this._seenCrossTileIDs,f,R.symbolInstanceStart===0,T),this._currentPartIndex++,x())return!0}return!1}}class fo{constructor(t,o,f,y,x,T,A,R,L){this.placement=new qt(t,x,T,A,R,L),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,o,f,y,x){const T=s.o.now(),A=()=>{const R=s.o.now()-T;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=o[t[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=L)&&(!R.maxzoom||R.maxzoom>L)){const k=R,U=k.layout.get("symbol-z-elevate"),B=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,H=k.layout.get("symbol-z-order"),W=H==="viewport-y"||H==="auto"&&!(H!=="viewport-y"&&B),X=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),te=W&&X,ee=this._inProgressLayer=this._inProgressLayer||new Oa(k),re=s.B(R.source,R.scope);if(ee.continuePlacement(U||te?y[re]:f[re],this.placement,this._showCollisionBoxes,R,A,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const vp=512/s.al/2;class ud{constructor(t,o,f){this.tileID=t,this.bucketInstanceId=f,this.index=new s.c3(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*s.al,x=t.canonical.y*s.al;for(let T=0;T<o.length;T++){const{key:A,crossTileID:R,tileAnchorX:L,tileAnchorY:k}=o.get(T),U=Math.floor((y+L)*vp),B=Math.floor((x+k)*vp);this.index.add(U,B),this.keys.push(A),this.crossTileIDs.push(R)}this.index.finish()}findMatches(t,o,f){const y=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),x=vp/Math.pow(2,o.canonical.z-this.tileID.canonical.z),T=o.canonical.x*s.al,A=o.canonical.y*s.al;for(let R=0;R<t.length;R++){const L=t.get(R);if(L.crossTileID)continue;const{key:k,tileAnchorX:U,tileAnchorY:B}=L,H=Math.floor((T+U)*x),W=Math.floor((A+B)*x),X=this.index.range(H-y,W-y,H+y,W+y).sort(((te,ee)=>te-ee));for(const te of X){const ee=this.crossTileIDs[te];if(this.keys[te]===k&&!f.has(ee)){f.add(ee),L.crossTileID=ee;break}}}}}class qs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ql{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const f in this.indexes){const y=this.indexes[f],x={};for(const T in y){const A=y[T];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+o),x[A.tileID.key]=A}this.indexes[f]=x}this.lng=t}addBucket(t,o,f){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let x=0;x<o.symbolInstances.length;x++)o.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>t.overscaledZ)for(const A in T){const R=T[A];R.tileID.isChildOf(t)&&R.findMatches(o.symbolInstances,t,y)}else{const A=T[t.scaledTo(Number(x)).key];A&&A.findMatches(o.symbolInstances,t,y)}}for(let x=0;x<o.symbolInstances.length;x++){const T=o.symbolInstances.get(x);T.crossTileID||(T.crossTileID=f.generate(),y.add(T.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ud(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const f of o.crossTileIDs)this.usedCrossTileIDs[t].delete(f)}removeStaleBuckets(t){let o=!1;for(const f in this.indexes){const y=this.indexes[f];for(const x in y)t[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[x]),delete y[x],o=!0)}return o}}class dc{constructor(){this.layerIndexes={},this.crossTileIDs=new qs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,f,y){let x=this.layerIndexes[t.fqid];x===void 0&&(x=this.layerIndexes[t.fqid]=new ql);let T=!1;const A={};y.name!=="globe"&&x.handleWrapJump(f);for(const R of o){const L=R.getBucket(t);L&&t.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(R.tileID,L,this.crossTileIDs)&&(T=!0),A[L.bucketInstanceId]=!0)}return x.removeStaleBuckets(A)&&(T=!0),T}pruneUnusedLayers(t){const o={};t.forEach((f=>{o[f]=!0}));for(const f in this.layerIndexes)o[f]||delete this.layerIndexes[f]}}const Kr=771;class Xi{constructor(t,o,f,y){this.blendFunction=t,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=y}}Xi.Replace=[1,0,1,0],Xi.disabled=new Xi(Xi.Replace,s.ao.transparent,[!1,!1,!1,!1]),Xi.unblended=new Xi(Xi.Replace,s.ao.transparent,[!0,!0,!0,!0]),Xi.alphaBlended=new Xi([1,Kr,1,Kr],s.ao.transparent,[!0,!0,!0,!0]),Xi.alphaBlendedNonPremultiplied=new Xi([770,Kr,770,Kr],s.ao.transparent,[!0,!0,!0,!0]),Xi.multiply=new Xi([774,0,774,0],s.ao.transparent,[!0,!0,!0,!0]),Xi.additive=new Xi([1,1,1,1],s.ao.transparent,[!0,!0,!0,!0]);class pi{constructor(t,o,f){this.func=t,this.mask=o,this.range=f}}pi.ReadOnly=!1,pi.ReadWrite=!0,pi.disabled=new pi(519,pi.ReadOnly,[0,1]);const fc=7680;class Ui{constructor(t,o,f,y,x,T){this.test=t,this.ref=o,this.mask=f,this.fail=y,this.depthFail=x,this.pass=T}}Ui.disabled=new Ui({func:519,mask:0},0,0,fc,fc,fc);const sh=1029,hd=2305;class Li{constructor(t,o,f){this.enable=t,this.mode=o,this.frontFace=f}}function dd(d,t){const o=s.c9(d,3);s.cb(d,t),s.cf(d,3,o)}function cf(d,t){const o=s.c6([]);return s.c7(o,o,-t),s.c8(o,o,-d),o}function eg(d,t){const o=[d[0],d[1],0],f=[t[0],t[1],0];if(s.ag(o)>=1e-15){const T=s.aw([],o);s.c4(f,T,s.bI(f,T)),t[0]=f[0],t[1]=f[1]}const y=s.bH([],t,d);if(s.c5(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return cf(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),x)}Li.disabled=new Li(!1,sh,hd),Li.backCCW=new Li(!0,sh,hd),Li.backCW=new Li(!0,sh,2304),Li.frontCW=new Li(!0,1028,2304),Li.frontCCW=new Li(!0,1028,hd);class pc{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof s.ae?t:new s.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=s.bS(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o,f){if(this.orientation=null,!this.position)return;const y=this.position,x=f||(this._elevation?this._elevation.getAtPointOrZero(s.ae.fromLngLat(t)):0),T=s.ae.fromLngLat(t,x),A=[T.x-y.x,T.y-y.y,T.z-y.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=eg(A,o)}setPitchBearing(t,o){this.orientation=cf(s.an(t),s.an(-o))}}class xp{constructor(t,o){this._transform=s.bz([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new s.ae(t[0],t[1],t[2])}get position(){const t=s.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&s.cf(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||s.c6([]),t&&dd(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=cf(t,o),dd(this._transform,this._orientation)}forward(){const t=s.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=s.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=s.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const f=new Float64Array(16);return s.bk(f,this.getWorldToCamera(t,o)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,f){const y=this.position;s.c4(y,y,-t);const x=new Float64Array(16);return s.bp(x,[f,f,f]),s.bq(x,x,y),x[10]*=o,x}getWorldToCamera(t,o){const f=new Float64Array(16),y=new Float64Array(4),x=this.position;return s.ca(y,this._orientation),s.c4(x,x,-t),s.cb(f,y),s.bq(f,f,x),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=o,f[9]*=o,f[10]*=o,f[11]*=o,f}getCameraToClipPerspective(t,o,f,y){const x=new Float64Array(16);return s.cc(x,t,o,f,y),x}getCameraToClipOrthographic(t,o,f,y,x,T){const A=new Float64Array(16);return s.cd(A,t,o,f,y,x,T),A}getDistanceToElevation(t,o=!1){const f=t===0?0:s.ce(t,o?s.a_(this.position[1]):this.position[1]),y=this.forward();return(f-this.position[2])/y[2]}clone(){return new xp([...this.position],[...this.orientation])}}const po={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class $o{constructor(t=0,o=0,f=0,y=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=f,this.right=y}interpolate(t,o,f){return o.top!=null&&t.top!=null&&(this.top=s.ak(t.top,o.top,f)),o.bottom!=null&&t.bottom!=null&&(this.bottom=s.ak(t.bottom,o.bottom,f)),o.left!=null&&t.left!=null&&(this.left=s.ak(t.left,o.left,f)),o.right!=null&&t.right!=null&&(this.right=s.ak(t.right,o.right,f)),this}getCenter(t,o){const f=s.aA((this.left+t-this.right)/2,0,t),y=s.aA((this.top+o-this.bottom)/2,0,o);return new s.P(f,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new $o(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const oh=15;class Oo{constructor(t,o,f,y,x,T,A){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=f??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new s.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new $o,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new xp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Oo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<oh}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(t||f)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return s.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=s.cl(this.projectionOptions);const f=this.getProjection(),y=!s.bx(o,f);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.cl({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.bS(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=s.cm(),s.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=s.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=s.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let y=0,x=0;for(let T=0;T<o.length;T++){const A=new s.P(o[T][0]*this.width,f+o[T][1]*(this.height-f)),R=t.pointCoordinate(A);if(!R)continue;const L=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);y+=R[3]*L,x+=L}return x===0?NaN:y/x}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*o,y=this._mercatorZfromZoom(t),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-f,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let f;f=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const y=s.ag(s.av([],this._camera.position,f));return s.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!s.co(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const f=[t.position.x,t.position.y,t.position.z];s.cp(f,this._camera.position)||(this._setCameraPosition(f),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new pc;return o.position=new s.ae(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!s.cq(t))return!1;s.cr(t,t);const o=s.cs([],[0,0,-1],t),f=s.cs([],[0,-1,0],t);if(f[2]<0)return!1;const y=eg(o,f);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=s.aA(t[2],y/f,y/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,f){this._unmodified=!1,this._edgeInsets.interpolate(t,o,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new s.ct(0,t)];if(this.renderWorldCopies){const f=this.pointCoordinate(new s.P(0,0)),y=this.pointCoordinate(new s.P(this.width,0)),x=this.pointCoordinate(new s.P(this.width,this.height)),T=this.pointCoordinate(new s.P(0,this.height)),A=Math.floor(Math.min(f.x,y.x,x.x,T.x)),R=Math.floor(Math.max(f.x,y.x,x.x,T.x)),L=1;for(let k=A-L;k<=R+L;k++)k!==0&&o.push(new s.ct(k,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,f){let y=[];const x=f!=null,T=!x;if(T&&this.zoom<o||x&&f[0]===0&&f[1]===0)return y;const A=new Set,R=(k,U,B,H,W)=>{const X=s.cX(U,k,B,H,W);A.has(X)||(y.push(new s.aP(k,U,B,H,W)),A.add(X))};for(let k=0;k<t.length;k++){const U=t[k];if(T&&U.canonical.z!==o)continue;const B=U.canonical,H=U.overscaledZ,W=U.wrap,X=1<<B.z,te=B.x+1<X,ee=B.x>0,re=B.y+1<X,he=B.y>0,le=U.wrap-(ee?0:1),we=U.wrap+(te?0:1),fe=ee?B.x-1:X-1,Ee=te?B.x+1:0;if(x)f[0]<0?(R(H,we,B.z,Ee,B.y),f[1]<0&&re&&(R(H,W,B.z,B.x,B.y+1),R(H,we,B.z,Ee,B.y+1)),f[1]>0&&he&&(R(H,W,B.z,B.x,B.y-1),R(H,we,B.z,Ee,B.y-1))):f[0]>0?(R(H,le,B.z,fe,B.y),f[1]<0&&re&&(R(H,W,B.z,B.x,B.y+1),R(H,le,B.z,fe,B.y+1)),f[1]>0&&he&&(R(H,W,B.z,B.x,B.y-1),R(H,le,B.z,fe,B.y-1))):f[1]<0&&re?R(H,W,B.z,B.x,B.y+1):he&&R(H,W,B.z,B.x,B.y-1);else{const ge=U.visibleQuadrants;1&ge&&(R(H,le,B.z,fe,B.y),he&&(R(H,W,B.z,B.x,B.y-1),R(H,le,B.z,fe,B.y-1))),2&ge&&(R(H,we,B.z,Ee,B.y),he&&(R(H,W,B.z,B.x,B.y-1),R(H,we,B.z,Ee,B.y-1))),4&ge&&(R(H,le,B.z,fe,B.y),re&&(R(H,W,B.z,B.x,B.y+1),R(H,le,B.z,fe,B.y+1))),8&ge&&(R(H,we,B.z,Ee,B.y),re&&(R(H,W,B.z,B.x,B.y+1),R(H,we,B.z,Ee,B.y+1)))}}const L=[];for(const k of y)y.some((U=>k.isChildOf(U)))||L.push(k);if(y=L.filter((k=>!t.some((U=>!!(k.overscaledZ<o&&U.isChildOf(k))||k.equals(U)||k.isChildOf(U))))),T){const k=1<<o,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[k*U.x,k*U.y],H=4,W=H*H;y=y.filter((X=>{const te=X.canonical.x+.5-B[0],ee=X.canonical.y+.5-B[1];return te*te+ee*ee<W}))}return y}extendTileCoverToNearPlane(t,o,f){const y=[],x=new Set;for(const re of t)x.add(re.key);const T=(re,he,le,we,fe)=>{const Ee=s.cX(he,re,le,we,fe);x.has(Ee)||(y.push(new s.aP(re,he,le,we,fe)),x.add(Ee))},A=t.reduce(((re,he)=>Math.max(re,he.overscaledZ)),f),R=1<<f,L=[new s.P(0,0),new s.P(s.al,0),new s.P(s.al,s.al),new s.P(0,s.al)],k=new s.P(0,0),U=new s.P(0,0),B=(re,he)=>{const le=Math.floor(re[0]),we=Math.floor(re[1]),fe=(re[0]-le)*s.al,Ee=(re[1]-we)*s.al,ge=Math.floor(he[0]),me=Math.floor(he[1]),Se=(he[0]-ge)*s.al,Ve=(he[1]-me)*s.al;for(let ke=-1;ke<=1;ke++){const st=le+ke;if(!(st<0||st>=R)){k.x=fe-ke*s.al,U.x=Se-(st-ge)*s.al;for(let Xe=-1;Xe<=1;Xe++){const ht=we+Xe;k.y=Ee-Xe*s.al,U.y=Ve-(ht-me)*s.al,s.cY(k,U,L)&&T(A,0,f,st,ht)}}}},H=o.points,W=H[s.cu],X=H[s.cv],te=this._projectToGround(W,H[s.cw]),ee=this._projectToGround(X,H[s.cx]);return B(W,te),B(X,ee),y}_projectToGround(t,o){return s.cy(s.cz(),t,o,t[2]/(t[2]-o[2]))}coveringTiles(t){let o=this.coveringZoomLevel(t);const f=o,y=this.elevation&&this.elevation.exaggeration(),x=y&&!t.isTerrainDEM,T=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const A=this.locationCoordinate(this.center),R=this.center.lat,L=1<<o,k=[L*A.x,L*A.y,0],U=this.projection.name==="globe",B=!U,H=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,B),W=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),X=L*s.ce(1,this.center.lat),te=this._camera.position[2]/s.ce(1,this.center.lat),ee=[L*W.x,L*W.y,te*(B?1:X)],re=U||y,he=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),le=this.isLODDisabled(!0)?o:0;let we;if(this._elevation&&t.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Pe=this._elevation.getMinMaxForVisibleTiles();we=Pe?Pe.max:this._centerAltitude}else we=this._centerAltitude;const fe=t.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ee=this.projection.isReprojectedInTileSpace?s.cB(this):1,ge=Pe=>{const Ke=new s.ae(Pe.x+25e-6,Pe.y,Pe.z),At=new s.ae(Pe.x,Pe.y+25e-6,Pe.z),wt=Pe.toLngLat(),Ht=Ke.toLngLat(),mt=At.toLngLat(),_t=this.locationCoordinate(wt),$t=this.locationCoordinate(Ht),Jt=this.locationCoordinate(mt),Xt=Math.hypot($t.x-_t.x,$t.y-_t.y),ri=Math.hypot(Jt.x-_t.x,Jt.y-_t.y);return Math.sqrt(Xt*ri)*Ee/25e-6},me=Pe=>{const dt=we,Ke=fe;return{aabb:s.cE(this,L,0,0,0,Pe,Ke,dt,this.projection),zoom:0,x:0,y:0,minZ:Ke,maxZ:dt,wrap:Pe,fullyVisible:!1}},Se=[];let Ve=[];const ke=o,st=t.reparseOverscaled?f:o,Xe=(te-this._centerAltitude)*X,ht=Pe=>{if(!this._elevation||!Pe.tileID||!T)return;const dt=this._elevation.getMinMaxForTile(Pe.tileID),Ke=Pe.aabb;dt?(Ke.min[2]=dt.min,Ke.max[2]=dt.max,Ke.center[2]=(Ke.min[2]+Ke.max[2])/2):(Pe.shouldSplit=$e(Pe),Pe.shouldSplit||(Ke.min[2]=Ke.max[2]=Ke.center[2]=this._centerAltitude))},zt=(Pe,dt)=>{if(.707*dt<Pe)return 1;const Ke=dt/Pe;return Ke/(1.4144271570014144+(Math.pow(1.1,Ke-1.4144271570014144+1)-1)/(1.1-1)-1)},$e=Pe=>{if(Pe.zoom<le)return!0;if(Pe.zoom===ke)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;const dt=Pe.aabb.distanceX(ee),Ke=Pe.aabb.distanceY(ee);let At=Xe,wt=1;if(U){At=Pe.aabb.distanceZ(ee);const ri=Math.pow(2,Pe.zoom),Mi=s.a_((Pe.y+1)/ri),tn=s.a_(Pe.y/ri),Gi=Math.min(Math.max(R,Mi),tn),Fn=s.d0(Gi)/s.d0(R);if(wt=Gi===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Fn/this._mercatorScaleRatio),this.zoom<=s.cZ&&Pe.zoom===ke-1&&Fn>=.9)return!0}else if(x&&(At=Pe.aabb.distanceZ(ee)*X),this.projection.isReprojectedInTileSpace&&f<=5){const ri=Math.pow(2,Pe.zoom),Mi=ge(new s.ae((Pe.x+.5)/ri,(Pe.y+.5)/ri));wt=Mi>.85?1:Mi}if(!T&&!U){const ri=Math.sqrt(dt*dt+Ke*Ke+At*At);let Mi=(1<<ke-Pe.zoom)*he*wt;return Mi*=zt(Math.max(At,Xe),ri),ri<Mi}let Ht=Number.MAX_VALUE,mt=0;const _t=Pe.aabb.getCorners(),$t=[];for(const ri of _t){s.av($t,ri,ee),U||(x?$t[2]*=X:$t[2]=Xe);const Mi=s.bI($t,this._camera.forward());Mi<Ht&&(Ht=Mi,mt=Math.abs($t[2]))}let Jt=(1<<ke-Pe.zoom)*he*wt;if(Jt*=zt(Math.max(mt,Xe),Ht),Ht<Jt)return!0;const Xt=Pe.aabb.closestPoint(k);return Xt[0]===k[0]&&Xt[1]===k[1]};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)Se.push(me(-Pe)),Se.push(me(Pe));for(Se.push(me(0));Se.length>0;){const Pe=Se.pop(),dt=Pe.x,Ke=Pe.y;let At=Pe.fullyVisible;const wt=()=>this.projection.name==="globe"&&(Pe.y===0||Pe.y===(1<<Pe.zoom)-1);if(!At){let Ht=re?Pe.aabb.intersects(H):Pe.aabb.intersectsFlat(H);if(Ht===0&&wt()){const mt=new s.cC(Pe.zoom,dt,Ke);Ht=s.cD(this,L,mt,!0).intersects(H)}if(Ht===0)continue;At=Ht===2}if(Pe.zoom!==ke&&$e(Pe))for(let Ht=0;Ht<4;Ht++){const mt=(dt<<1)+Ht%2,_t=(Ke<<1)+(Ht>>1),$t={aabb:T?Pe.aabb.quadrant(Ht):s.cE(this,L,Pe.zoom+1,mt,_t,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:mt,y:_t,wrap:Pe.wrap,fullyVisible:At,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};x&&!U&&($t.tileID=new s.aP(Pe.zoom+1===ke?st:Pe.zoom+1,Pe.wrap,Pe.zoom+1,mt,_t),ht($t)),Se.push($t)}else{const Ht=Pe.zoom===ke?st:Pe.zoom;if(t.minzoom&&t.minzoom>Ht)continue;let mt=0;if(!At){let Xt=re?Pe.aabb.intersectsPrecise(H):Pe.aabb.intersectsPreciseFlat(H);if(Xt===0&&wt()){const ri=new s.cC(Pe.zoom,dt,Ke);Xt=s.cD(this,L,ri,!0).intersectsPrecise(H)}if(Xt===0)continue;if(t.calculateQuadrantVisibility)if(H.containsPoint(Pe.aabb.center))mt=15;else for(let ri=0;ri<4;ri++)Pe.aabb.quadrant(ri).intersects(H)!==0&&(mt|=1<<ri)}const _t=k[0]-(.5+dt+(Pe.wrap<<Pe.zoom))*(1<<o-Pe.zoom),$t=k[1]-.5-Ke,Jt=Pe.tileID?Pe.tileID:new s.aP(Ht,Pe.wrap,Pe.zoom,dt,Ke);t.calculateQuadrantVisibility&&(Jt.visibleQuadrants=mt),Ve.push({tileID:Jt,distanceSq:_t*_t+$t*$t})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,dt=this.horizonLineFromTop();Ve=Ve.filter((Ke=>{const At=[0,0,0,1],wt=[s.al,s.al,0,1],Ht=this.calculateFogTileMatrix(Ke.tileID.toUnwrapped());s.aC(At,At,Ht),s.aC(wt,wt,Ht);const mt=s.cF([],At,wt),_t=s.cG([],At,wt),$t=s.c_(mt,_t);if($t===0)return!0;let Jt=!1;const Xt=this._elevation;if(Xt&&$t>Pe&&dt!==0){const ri=this.calculateProjMatrix(Ke.tileID.toUnwrapped());let Mi;t.isTerrainDEM||(Mi=Xt.getMinMaxForTile(Ke.tileID)),Mi||(Mi={min:fe,max:we});const tn=s.cH(this.rotation),Gi=[tn[0]*s.al,tn[1]*s.al,Mi.max];s.af(Gi,Gi,ri),Jt=(1-Gi[1])*this.height*.5<dt}return $t<Pe||Jt}))}return Ve.sort(((Pe,dt)=>Pe.distanceSq-dt.distanceSq)).map((Pe=>Pe.tileID))}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const o=s.aA(t.lat,-s.cI,s.cI),f=this.projection.project(t.lng,o);return new s.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let f,y;const x=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;f=(o.x-x.x)/A,y=(o.y-x.y)/A}else{const A=this.pointCoordinate(o),R=this.pointCoordinate(x);f=A.x-R.x,y=A.y-R.y}const T=this.locationCoordinate(t);this.setLocation(new s.ae(T.x-f,T.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,o){return this.projection.locationPoint(this,t,o)}locationPoint3D(t,o){return this.projection.locationPoint(this,t,o,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,o){return this.coordinateLocation(this.pointCoordinate3D(t,o))}locationCoordinate(t,o){const f=o?s.ce(o,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new s.ae(y.x,y.y,f)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const f=o??this._centerAltitude,y=[t.x,t.y,0,1],x=[t.x,t.y,1,1];s.aC(y,y,this.pixelMatrixInverse),s.aC(x,x,this.pixelMatrixInverse);const T=x[3];s.cJ(y,y,1/y[3]),s.cJ(x,x,1/T);const A=y[2],R=x[2];return{p0:y,p1:x,t:A===R?0:(f-A)/(R-A)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],f=[t.x,t.y,1,1];return s.aC(o,o,this.pixelMatrixInverse),s.aC(f,f,this.pixelMatrixInverse),s.cJ(o,o,1/o[3]),s.cJ(f,f,1/f[3]),o[2]=s.ce(o[2],this._center.lat)*this.worldSize,f[2]=s.ce(f[2],this._center.lat)*this.worldSize,s.cJ(o,o,1/this.worldSize),s.cJ(f,f,1/this.worldSize),new s.ax([o[0],o[1],o[2]],s.aw([],s.av([],f,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:f,t:y}=t,x=s.ce(o[2],this._center.lat),T=s.ce(f[2],this._center.lat);return new s.ae(s.ak(o[0],f[0],y)/this.worldSize,s.ak(o[1],f[1],y)/this.worldSize,s.ak(x,T,y))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t,o){if(!this.elevation)return this.pointCoordinate(t,o);let f=this.projection.pointCoordinate3D(this,t.x,t.y);if(f)return new s.ae(f[0],f[1],f[2]);let y=0,x=this.horizonLineFromTop();if(t.y>x)return this.pointCoordinate(t,o);const T=.02*x,A=t.clone();for(let R=0;R<10&&x-y>T;R++){A.y=s.ak(y,x,.66);const L=this.projection.pointCoordinate3D(this,A.x,A.y);L?(x=A.y,f=L):y=A.y}return f?new s.ae(f[0],f[1],f[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=s.cK)return!this.isPointAboveHorizon(t);const o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){const f=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,f+t.toAltitude(),1];return s.aC(y,y,this.pixelMatrix),y[3]>0?new s.P(y[0]/y[3],y[1]/y[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:o}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new s.P(o,t)),T=this.pointLocation3D(new s.P(y,t)),A=this.pointLocation3D(new s.P(y,f)),R=this.pointLocation3D(new s.P(o,f));let L=Math.min(x.lng,T.lng,A.lng,R.lng),k=Math.max(x.lng,T.lng,A.lng,R.lng),U=Math.min(x.lat,T.lat,A.lat,R.lat),B=Math.max(x.lat,T.lat,A.lat,R.lat);const H=Math.pow(2,-this.zoom)/16*270,W=this.projection.name==="globe"?1:4,X=(te,ee,re,he,le)=>{const we=(te+re)/2,fe=(ee+he)/2,Ee=new s.P(we,fe),{lng:ge,lat:me}=this.pointLocation3D(Ee),Se=Math.max(0,L-ge,U-me,ge-k,me-B);L=Math.min(L,ge),k=Math.max(k,ge),U=Math.min(U,me),B=Math.max(B,me),(le<W||Se>H)&&(X(te,ee,we,fe,le+1),X(we,fe,re,he,le+1))};if(X(o,t,y,t,1),X(y,t,y,f,1),X(y,f,o,f,1),X(o,f,o,t,1),this.projection.name==="globe"){const[te,ee]=s.cL(this);te?(B=90,k=180,L=-180):ee&&(U=-90,k=180,L=-180)}return new s.aI(new s.aS(L,U),new s.aS(k,B))}_getBoundsRectangular(t,o){const{top:f,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,A=new s.P(y,f),R=new s.P(T,f),L=new s.P(T,x),k=new s.P(y,x);let U=this.pointCoordinate(A,t),B=this.pointCoordinate(R,t);const H=this.pointCoordinate(L,o),W=this.pointCoordinate(k,o),X=(te,ee)=>(ee.y-te.y)/(ee.x-te.x);return U.y>1&&B.y>=0?U=new s.ae((1-W.y)/X(W,U)+W.x,1):U.y<0&&B.y<=1&&(U=new s.ae(-W.y/X(W,U)+W.x,0)),B.y>1&&U.y>=0?B=new s.ae((1-H.y)/X(H,B)+H.x,1):B.y<0&&U.y<=1&&(B=new s.ae(-H.y/X(H,B)+H.x,0)),new s.aI().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=t.visibleDemTiles.reduce(((f,y)=>{if(y.dem){const x=y.dem.tree;f.min=Math.min(f.min,x.minimums[0]),f.max=Math.max(f.max,x.maximums[0])}return f}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-s.cI,this.maxLat=s.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.aF(this.minLng)*this.tileSize,this.worldMaxX=s.aF(this.maxLng)*this.tileSize,this.worldMinY=s.aJ(this.maxLat)*this.tileSize,this.worldMaxY=s.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,f=this._distanceTileDataCache;if(f[o])return f[o];const y=t.canonical,x=1/this.height,T=this.cameraWorldSize,A=T/this.zoomScale(y.z),R=(y.x+Math.pow(2,y.z)*t.wrap)*A,L=y.y*A,k=this.point;k.x*=T/this.worldSize,k.y*=T/this.worldSize;const U=this.angle,B=Math.sin(-U),H=-Math.cos(-U);return f[o]={bearing:[B,H],center:[(k.x-R)*x,(k.y-L)*x],scale:A/s.al*x},f[o]}calculateFogTileMatrix(t){const o=t.key,f=this._fogTileMatrixCache;if(f[o])return f[o];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return s.aB(y,this.worldToFogMatrix,y),f[o]=new Float32Array(y),f[o]}calculateProjMatrix(t,o=!1,f=!1){const y=t.key;let x;if(x=f?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,x[y])return x[y];const T=this.calculatePosMatrix(t,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,s.aB(T,A,T),x[y]=new Float32Array(T),x[y]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,f=this._pixelsToTileUnitsCache;if(f[o])return f[o];const y=s.cM(t,this);return f[o]=y,f[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,o=s.bp([],[t,t,t]);return s.aB(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const o=s.ce(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(o),y=this._camera.forward(),x=s.ce(1,this._center.lat);f[2]/=x,y[2]/=x,s.aw(y,y);const T=t.raycast(f,y,t.exaggeration());if(T){const A=s.bG([],f,y,T),R=new s.ae(A[0],A[1],s.ce(A[2],s.a_(A[1]))),L=(R.z+s.ag([R.x-f[0],R.y-f[1],R.z-f[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const o=this._elevation,f=s.ce(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(f),x=o.getAtPointOrZero(new s.ae(...y)),T=this.pixelsPerMeter/this.worldSize*x,A=this._minimumHeightOverTerrain(),R=y[2]-T;if(R<=A)if(R<0||t){const L=this.locationCoordinate(this._center,this._centerAltitude),k=[y[0],y[1],L.z-y[2]],U=s.ag(k);k[2]-=(A-R)/this._pixelsPerMercatorPixel;const B=s.ag(k);if(B===0)return;s.c4(k,k,U/B*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],L.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=s.aA(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=s.aA(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:f,y}=this.point;let x=0,T=f,A=y;const R=this.width/2,L=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(y-L<k&&(A=k+L),y+L>U&&(A=U-L),U-k<this.height&&(x=Math.max(x,this.height/(U-k)),A=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,W=this.worldSize/2-(B+H)/2;T=(f+W+this.worldSize)%this.worldSize-W,T-R<B&&(T=B+R),T+R>H&&(T=H-R),H-B<this.width&&(x=Math.max(x,this.width/(H-B)),T=(H+B)/2)}T===f&&A===y||this._allowWorldUnderZoom||(this.center=this.unproject(new s.P(T,A))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.ce(1,this.center.lat)/s.ce(1,s.d1));const y=s.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?f:1,T=this._camera.getWorldToCamera(this.worldSize,x);let A;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-t.x/this.width,R[9]=2*t.y/this.height,this.isOrthographic){let me=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=me*this.aspect,Ve=-Se,ke=-me;Se-=t.x,Ve-=t.x,me+=t.y,ke+=t.y,A=this._camera.getCameraToClipOrthographic(Ve,Se,ke,me,this._nearZ,this._farZ),((st,Xe,ht,zt)=>{for(let $e=0;$e<16;$e++)st[$e]=s.ak(Xe[$e],ht[$e],zt)})(A,A,R,s.c$(this.pitch>=oh?1:this.pitch/oh))}else A=R;const L=s.cO([],R,T);let k=s.cO([],A,T);if(this.projection.isReprojectedInTileSpace){const me=this.locationCoordinate(this.center),Se=s.bz([]);s.bq(Se,Se,[me.x*this.worldSize,me.y*this.worldSize,0]),s.aB(Se,Se,s.cP(this)),s.bq(Se,Se,[-me.x*this.worldSize,-me.y*this.worldSize,0]),s.aB(k,k,Se),s.aB(L,L,Se),this.inverseAdjustmentMatrix=s.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.cR([],k,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=k,this.invProjMatrix=s.bk(new Float64Array(16),this.projMatrix),o){const me=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);me[8]=2*-t.x/this.width,me[9]=2*t.y/this.height,this.expandedFarZProjMatrix=s.cO([],me,T)}else this.expandedFarZProjMatrix=this.projMatrix;const U=s.bk([],A);this.frustumCorners=s.cS.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const B=new Float32Array(16);s.bz(B),s.cR(B,B,[1,-1,1]),s.cT(B,B,this._pitch),s.bA(B,B,this.angle);const H=s.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.by(H);const W=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-t.x/this.width,H[9]=2*(t.y+W)/this.height,this.skyboxMatrix=s.aB(B,H,B);const X=this.point,te=X.x,ee=X.y,re=this.width%2/2,he=this.height%2/2,le=Math.cos(this.angle),we=Math.sin(this.angle),fe=te-Math.round(te)+le*re+we*he,Ee=ee-Math.round(ee)+le*he+we*re,ge=new Float64Array(k);if(s.bq(ge,ge,[fe>.5?fe-1:fe,Ee>.5?Ee-1:Ee,0]),this.alignedProjMatrix=ge,k=s.bB(),s.cR(k,k,[this.width/2,-this.height/2,1]),s.bq(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=s.bB(),s.cR(k,k,[1,-1,1]),s.bq(k,k,[-1,-1,0]),s.cR(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=s.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},k=s.bk(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.cU(this);const me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.af(me,me,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,f=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[t,t,o];s.c4(x,x,y),s.c4(f,f,-1),s.cV(f,f,x);const T=s.bB();s.bq(T,T,f),s.cR(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,y)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-f[0]*x,y.y/this.worldSize-f[1]*x,t/this.worldSize*this._centerAltitude-f[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],y=t[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((o-f)/y,1)),this._camera.position=s.bG([],this._camera.position,t,x),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:f,bearing:y}=this._camera.getPitchBearing(),x=s.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.an(this._maxPitch)),A=Math.max((t[2]-x)/Math.cos(f),T),R=this._zoomFromMercatorZ(A);s.bG(t,t,o,A),this._pitch=s.aA(f,s.an(this.minPitch),s.an(this.maxPitch)),this.angle=s.bS(y,-Math.PI,Math.PI),this._setZoom(s.aA(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,f=s.cK,y=0,x=1/0;for(;f-o>1e-6&&f>o;){const T=o+.5*(f-o),A=this.tileSize*Math.pow(2,T),R=this.getCameraToCenterDistance(this.projection,T,A),L=this.scaleZoom(R/(Math.max(0,t)*this.tileSize)),k=Math.abs(T-L);k<x&&(x=k,y=T),T<L?o=T:f=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const f=Math.min(t.x,o.x),y=Math.max(t.x,o.x),x=Math.min(t.y,o.y),T=Math.max(t.y,o.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new s.P(f,x),new s.P(y,T),new s.P(f,T),new s.P(y,x)],R=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const k of A){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const B=this.rayIntersectionCoordinate(U);if(B.x<R||B.y<0||B.x>L||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(t,o){const f=s.ag(s.av([],this._camera.position,t)),y=this._zoomFromMercatorZ(f)+o;return f-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([o,f,y],x){const T=[o,f,y,1];s.aC(T,T,x);const A=T[3]=Math.max(T[3],1e-6);return T[0]/=A,T[1]/=A,T[2]/=A,T})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,f=this.worldSize){const y=s.cN(t,o,this.width,this.height,1024),x=t.pixelSpaceConversion(this.center.lat,f,y);let T=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(T=s.ak(1,T,s.c$(this.pitch>=oh?1:this.pitch/oh))),T}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.aB(t,t,this.globeMatrix),t}getFrustum(t){return s.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Ka=(d,t)=>{if(t>0&&d.terrain&&s.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=d.transform,f=Math.max(Math.abs(o._zoom-(d.minCutoffZoom-1)),1),y=o.isLODDisabled(!1)?s.ah(60,45,o.pitch):s.ah(30,15,o.pitch),x=o._farZ-o._nearZ,T=t*o.height,A=((1-(R=y))*o.cameraToCenterDistance+R*(o._farZ+T))*f;var R;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(A-o._nearZ)/x,(A-T-o._nearZ)/x]}}},no={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class E_{constructor(t,o){this.aabb=t,this.lastCascade=o}}class S_{add(t,o){const f=this.receivers[t.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],o.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],o.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],o.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],o.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],o.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],o.max[2])):this.receivers[t.key]=new E_(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,f){const y=s.d8.fromPoints(t.points);let x=0;for(const T in this.receivers){const A=this.receivers[T];if(!A||!y.intersectsAabb(A.aabb))continue;A.aabb.min=y.closestPoint(A.aabb.min),A.aabb.max=y.closestPoint(A.aabb.max);const R=A.aabb.getCorners();for(let L=0;L<f.length;L++){let k=!0;for(const U of R){const B=[U[0]*o,U[1]*o,U[2]];if(s.af(B,B,f[L].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){k=!1;break}}if(A.lastCascade=L,x=Math.max(x,L),k)break}}return x+1}}class fd{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new S_,this._depthMode=new pi(t.context.gl.LEQUAL,pi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(no,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(no,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(no,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const y=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||y<=0||(this._shadowLayerCount=f.style.order.reduce(((W,X)=>{const te=f.style._mergedLayers[X];return W+(te.hasShadowPass()&&!te.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=f.context,T=no.shadowMapResolution,A=no.shadowMapResolution;if(this._cascades.length===0||no.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let W=0;W<no.cascadeCount;++W){const X=f._shadowMapDebug,te=x.gl,ee=x.createFramebuffer(T,A,X,"texture"),re=new s.T(x,{width:T,height:A,data:null},te.DEPTH_COMPONENT16);if(ee.depthAttachment.set(re.texture),X){const he=new s.T(x,{width:T,height:A,data:null},te.RGBA8);ee.colorAttachment.set(he.texture)}this._cascades.push({framebuffer:ee,texture:re,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.cA,scale:0})}}this.shadowDirection=A_(o);let R=0;if(t.elevation){const W=t.elevation,X=[1e4,-1e4];W.visibleDemTiles.filter((te=>te.dem)).forEach((te=>{const ee=te.dem.tree;X[0]=Math.min(X[0],ee.minimums[0]),X[1]=Math.max(X[1],ee.maximums[0])})),X[0]!==1e4&&(R=(X[1]-X[0])*W.exaggeration())}const L=1.5*t.cameraToCenterDistance,k=3*L,U=new Float64Array(16);for(let W=0;W<this._cascades.length;++W){const X=this._cascades[W];let te=t.height/50,ee=1;no.cascadeCount===1?ee=k:W===0?ee=L:(te=L,ee=k);const[re,he]=bp(t,this.shadowDirection,te,ee,no.shadowMapResolution,R);X.scale=t.scale,X.matrix=re,X.boundingSphereRadius=he,s.bk(U,X.matrix),X.frustum=s.cA.fromInvProjectionMatrix(U,1,0,!0),X.far=ee}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/no.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=no.shadowMapResolution,this._uniformValues.u_shadowmap_0=po.ShadowMap0,this._uniformValues.u_shadowmap_1=po.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const H=f.transform.elevation;for(const W of this._groundShadowTiles){let X={min:0,max:0};if(H){const te=H.getMinMaxForTile(W);te&&(X=te)}this.addShadowReceiver(W.toUnwrapped(),X.min,X.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;const f=this.painter,y=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),y.viewport.set([0,0,no.shadowMapResolution,no.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){f.currentShadowCascade=x,y.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),y.clear({color:s.ao.white,depth:1});for(const T of t.order){const A=t._mergedLayers[T];if(!A.hasShadowPass()||A.isHidden(f.transform.zoom))continue;const R=t.getLayerSourceCache(A),L=R?o[R.id]:void 0;(A.type==="model"||L&&L.length)&&f.renderLayer(f,R,A,L)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,o=t.style,f=t.context,y=f.gl,x=o.directionalLight,T=o.ambientLight;if(!x||!T)return;const A=[],R=Ka(t,t.longestCutoffRange);R.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),A.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&A.push("NORMAL_OFFSET");const L=Wo(o,x,T),k=new pi(y.LEQUAL,pi.ReadOnly,t.depthRangeFor3D),U=new Ui({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const B of this._groundShadowTiles){const H=B.toUnwrapped(),W=t.isTileAffectedByFog(B),X=t.getOrCreateProgram("groundShadow",{defines:A,overrideFog:W});this.setupShadows(H,X),t.uploadCommonUniforms(f,X,H,null,R);const te={u_matrix:t.transform.calculateProjMatrix(H),u_ground_shadow_factor:L};X.draw(t,y.TRIANGLES,k,U,Xi.multiply,Li.disabled,te,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Xi.unblended:Xi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const o=this.painter.transform,f=o.calculatePosMatrix(t,o.worldSize);return s.aB(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(t){const o=s.by(t);return s.aB(o,this._cascades[this.painter.currentShadowCascade].matrix,t),o}setupShadows(t,o,f){if(!this.enabled)return;const y=this.painter.transform,x=this.painter.context,T=x.gl,A=this._uniformValues,R=new Float64Array(16),L=y.calculatePosMatrix(t,y.worldSize);for(let k=0;k<this._cascades.length;k++)s.aB(R,this._cascades[k].matrix,L),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),x.activeTexture.set(T.TEXTURE0+po.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){const k=s.d6(t.canonical),U=2/y.tileSize*s.al/no.shadowMapResolution,B=U*this._cascades[0].boundingSphereRadius,H=U*this._cascades[this._cascades.length-1].boundingSphereRadius,W=(f==="vector-tile"?1:3)*(function(X,te,ee,re,he){const le=s.aA((X-22)/-22,0,1);return .125*(1-le)+4*le})(y.zoom);A.u_shadow_normal_offset=[k,B*W,H*W],A.u_shadow_bias=[1e-4,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(x,A)}setupShadowsFromMatrix(t,o,f=!1){if(!this.enabled)return;const y=this.painter.context,x=y.gl,T=this._uniformValues,A=new Float64Array(16);for(let R=0;R<no.cascadeCount;R++)s.aB(A,this._cascades[R].matrix,t),T[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),y.activeTexture.set(x.TEXTURE0+po.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=f,f){const R=no.normalOffset;T.u_shadow_normal_offset=[1,R,R],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(y,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,f,y){if(y[2]>=0)return{};const x=(function(R,L,k){const U=k/(1<<R.canonical.z);return new s.d8([R.canonical.x*U+R.wrap*k,R.canonical.y*U+R.wrap*k,0],[(R.canonical.x+1)*U+R.wrap*k,(R.canonical.y+1)*U+R.wrap*k,L])})(t,o,f).getCorners(),T=o/-y[2];y[0]<0?(s.d7(x[0],x[0],[y[0]*T,0,0]),s.d7(x[3],x[3],[y[0]*T,0,0])):y[0]>0&&(s.d7(x[1],x[1],[y[0]*T,0,0]),s.d7(x[2],x[2],[y[0]*T,0,0])),y[1]<0?(s.d7(x[0],x[0],[0,y[1]*T,0]),s.d7(x[1],x[1],[0,y[1]*T,0])):y[1]>0&&(s.d7(x[2],x[2],[0,y[1]*T,0]),s.d7(x[3],x[3],[0,y[1]*T,0]));const A={};return A.vertices=x,A.planes=[mc(x[1],x[0],x[4]),mc(x[2],x[1],x[5]),mc(x[3],x[2],x[6]),mc(x[0],x[3],x[7])],A}addShadowReceiver(t,o,f){this._receivers.add(t,s.d8.fromTileIdAndHeight(t,o,f))}getMaxCascadeForTile(t){const o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function mc(d,t,o){const f=s.av([],o,t),y=s.av([],d,t),x=s.bH([],f,y),T=s.ag(x);return T===0?[0,0,1,0]:(s.c4(x,x,1/T),[x[0],x[1],x[2],-s.bI(x,t)])}function A_(d){const t=d.properties.get("direction"),o=s.d3(t.x,t.y,t.z);o[2]=s.aA(o[2],0,75);const f=s.d5([o[0],o[1],o[2]]);return s.d4(f.x,f.y,f.z)}function Wo(d,t,o){const f=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),x=t.properties.get("intensity"),T=t.properties.get("direction"),A=[T.x,T.y,T.z],R=o.properties.get("color-use-theme")==="none",L=o.properties.get("color"),k=o.properties.get("intensity"),U=Math.max(s.bI([0,0,1],A),0),B=[0,0,0];s.c4(B,L.toPremultipliedRenderColor(R?null:d.getLut(t.scope)).toArray01Linear().slice(0,3),k);const H=[0,0,0];return s.c4(H,y.toPremultipliedRenderColor(f?null:d.getLut(o.scope)).toArray01Linear().slice(0,3),U*x),s.da([B[0]>0?B[0]/(B[0]+H[0]):0,B[1]>0?B[1]/(B[1]+H[1]):0,B[2]>0?B[2]/(B[2]+H[2]):0])}function bp(d,t,o,f,y,x){const T=d.zoom,A=d.scale,R=d.worldSize,L=1/R,k=d.aspect,U=Math.sqrt(1+k*k)*Math.tan(.5*d.fovX),B=U*U,H=f-o,W=f+o;let X,te;B>H/W?(X=f,te=f*U):(X=.5*W*(1+B),te=.5*Math.sqrt(H*H+2*(f*f+o*o)*B+W*W*B*B));const ee=d.projection.pixelsPerMeter(d.center.lat,R),re=d._camera.getCameraToWorldMercator(),he=[0,0,-X*L];s.af(he,he,re);let le=te*L;const we=d._edgeInsets;if(!(we.left===0&&we.top===0&&we.right===0&&we.bottom===0||we.left===we.right&&we.top===we.bottom)){const At=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?ee:1),wt=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,o,f);wt[8]=2*-d.centerOffset.x/d.width,wt[9]=2*d.centerOffset.y/d.height;const Ht=new Float64Array(16);s.cO(Ht,wt,At);const mt=new Float64Array(16);s.bk(mt,Ht);const _t=s.cA.fromInvProjectionMatrix(mt,R,T,!0);for(const $t of _t.points){const Jt=((fe=$t)[0]/=A,fe[1]/=A,fe[2]=s.ce(fe[2],d._center.lat),fe);le=Math.max(le,s.c5(s.d9([],he,Jt)))}}var fe;le*=y/(y-1);const Ee=Math.acos(t[2]),ge=Math.atan2(-t[0],-t[1]),me=new xp;me.position=he,me.setPitchBearing(Ee,ge);const Se=me.getWorldToCamera(R,ee),Ve=le*R,ke=Math.min(d._mercatorZfromZoom(17)*R*-2,-2*Ve),st=me.getCameraToClipOrthographic(-Ve,Ve,-Ve,Ve,ke,(Ve+x*ee)/t[2]),Xe=new Float64Array(16);s.aB(Xe,st,Se);const ht=s.d4(Math.floor(1e6*he[0])/1e6*R,Math.floor(1e6*he[1])/1e6*R,0),zt=.5*y,$e=[0,0,0];s.af($e,ht,Xe),s.c4($e,$e,zt);const Pe=[Math.floor($e[0]),Math.floor($e[1]),Math.floor($e[2])],dt=[0,0,0];s.av(dt,$e,Pe),s.c4(dt,dt,-1/zt);const Ke=new Float64Array(16);return s.bz(Ke),s.bq(Ke,Ke,dt),s.aB(Xe,Ke,Xe),[Xe,Ve]}class Eu extends s.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,o){return s.db(this.requestManager.transformRequest(o,s.R.Model).url).then((f=>{if(!f)return;const y=s.dc(f),x=new s.dd(t,o,void 0,void 0,y);return x.computeBoundsAndApplyParent(),x})).catch((f=>{if(f&&f.status===404)return null;this.fire(new s.y(new Error(`Could not load model ${t} from ${o}: ${f.message}`)))}))}load(t,o,f={forceReload:!1}){this.models[o]||(this.models[o]={});const y=Object.keys(t),x=[],T=[];for(const A of y){const R=t[A];this.hasURLBeenRequested(R)&&!f.forceReload||(this.modelByURL[R]={modelId:A,scope:o},x.push(this.loadModel(A,R)),T.push(A)),this.models[o][A]||(this.models[o][A]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+T.length,Promise.allSettled(x).then((A=>{for(let R=0;R<A.length;R++){const{status:L}=A[R];if(L==="rejected")continue;const{value:k}=A[R];this.models[o][T[R]]||(this.models[o][T[R]]={model:null,numReferences:1}),this.models[o][T[R]].model=k}this.numModelsLoading[o]-=T.length,this.fire(new s.z("data",{dataType:"style"}))})).catch((A=>{this.fire(new s.y(new Error(`Could not load models: ${A.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(t,o):this.getModelByURL(this.modelUris[o][t]))}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}getModelByURL(t){if(!t)return null;const o=this.modelByURL[t];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(t,o){return this.models[o]&&this.models[o][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,o,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const y=this.requestManager.normalizeModelURL(o);if((this.hasModel(t,f,{exactIdMatch:!0})||this.hasModelBeenAdded(t,f))&&this.modelUris[f][t]===y)this.models[f][t].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:x,modelId:T}=this.modelByURL[y];this.models[x][T].numReferences++}else this.modelUris[f][t]=y,this.load({[t]:this.modelUris[f][t]},f)}addModelURLs(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const f=this.modelUris[o];for(const y in t)f[y]=this.requestManager.normalizeModelURL(t[y])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const f={};for(const y of t)this.hasModel(y,o,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[o][y].numReferences++:this.modelUris[o][y]&&!this.hasURLBeenRequested(y)?f[y]=this.modelUris[o][y]:!this.hasURLBeenRequested(y)&&s.de(y,!1)&&(this.modelUris[o][y]=this.requestManager.normalizeModelURL(y),f[y]=this.modelUris[o][y]);this.load(f,o)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,o,f=!1,y=!1){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0||y)){const x=this.modelUris[o][t];f||delete this.modelUris[o][t],delete this.modelByURL[x];const T=this.models[o][t].model;if(!T)return;delete this.models[o][t],T.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const o of Object.keys(this.models[t])){const f=this.models[t][o].model;delete this.models[t][o],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(const f in this.models[o])this.models[o][f].model&&this.models[o][f].model.upload(t.context)}}const ah=s.a6.colorTheme,$c=new s.a9({data:new s.aa(ah.data)});function lh(d){if(!d.metadata||!d.metadata.content_area)return;const t=s.o.devicePixelRatio,{left:o,top:f,width:y,height:x}=d.metadata.content_area,T=o*t,A=f*t;return[T,A,T+y*t,A+x*t]}function ch(d){if(d)return d.map((([t,o])=>[t*s.o.devicePixelRatio,o*s.o.devicePixelRatio]))}class tg{constructor(t,o,f){this.id=t,this.scope=o,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return t;const f=this.sourceCache.getSource();if(!(f instanceof gs))return t;const y=o.map((T=>this.sourceCache.getTile(T))),x=f.getImages(y,Array.from(this.pendingRequests));for(const[T,A]of x)t.set(s.I.from({name:T,iconsetId:this.id}),A),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),t}}const Wc=(d,t)=>Y(d,t&&t.filter((o=>o.identifier!=="source.canvas"))),uh=s.aH(Mn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),wp=s.aH(Mn,["setCenter","setZoom","setBearing","setPitch"]),uf=new Set(["background","sky","slot","custom"]),Tp={version:8,layers:[],sources:{}},ig={duration:300,delay:0};class ml extends s.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=Object.assign({},ig),this._buildingIndex=new Uc(this),this.crossTileSymbolIndex=new dc,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=o.styleChanges||new rr,this.dispatcher=o.dispatcher?o.dispatcher:new s.D(s.dg(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new Us(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new s.dh(t._requestManager,o.localFontFamily?s.di.all:o.localIdeographFontFamily?s.di.ideographs:s.di.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new Eu(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._indoorDependentLayers=o.indoorDependentLayers?o.indoorDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",s.dj());const f=this;this._rtlTextPluginCallback=ml.registerForPluginStateChange((y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},((x,T)=>{if(s.dk(x),T&&T.every((A=>A)))for(const A in f._sourceCaches){const R=f._sourceCaches[A],L=R.getSource().type;L!=="vector"&&L!=="geojson"||R.reload()}}))})),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.getOwnSource(y.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const A=this._layers[T];A.source===x.id&&this._validateLayer(A)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(s.h(t))return t;const o=s.dl(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${s.dm(JSON.stringify(t))}`}_diffStyle(t,o,f){this.globalId=this._getGlobalId(t);const y=(x,T)=>{try{T(null,this.setState(x,f))}catch(A){T(A,!1)}};if(typeof t=="string"){const x=this.map._requestManager.normalizeStyleURL(t),T=this.map._requestManager.transformRequest(x,s.R.Style);s.m(T,((A,R)=>{A?this.fire(new s.y(A)):R&&y(R,o)}))}else typeof t=="object"&&y(t,o)}loadURL(t,o={}){this.fire(new s.z("dataloading",{dataType:"style"}));const f=typeof o.validate=="boolean"?o.validate:!s.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,f);const x=this.map._requestManager.transformRequest(t,s.R.Style);this._request=s.m(x,((T,A)=>{if(this._request=null,T)this.fire(new s.y(T));else if(A)return this.importsCache.set(t,A),this._load(A,f)}))}loadJSON(t,o={}){this.fire(new s.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=s.o.frame((()=>{this._request=null,this._load(t,o.validate!==!1)}))}loadEmpty(){this.fire(new s.z("dataloading",{dataType:"style"})),this._load(Tp,!1)}_loadImports(t,o,f){if(this.importDepth>=4)return s.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const x of t){const T=this._createFragmentStyle(x),A=new Promise((k=>{T.once("style.import.load",k),T.once("error",k)})).then((()=>this.mergeAll()));if(y.push(A),this.resolvedImports.has(x.url)){T.loadEmpty();continue}const R=x.data||this.importsCache.get(x.url);R?(T.loadJSON(R,{validate:o}),this._isInternalStyle(R)&&(T.globalId=null)):x.url?T.loadURL(x.url,{validate:o}):T.loadEmpty();const L={style:T,id:x.id,config:x.config};if(f){const k=this.fragments.findIndex((({id:U})=>U===f));this.fragments=this.fragments.slice(0,k).concat(L).concat(this.fragments.slice(k))}else this.fragments.push(L)}return Promise.allSettled(y)}getImportGlobalIds(t=this,o=new Set){for(const f of t.fragments)f.style.globalId&&o.add(f.style.globalId),this.getImportGlobalIds(f.style,o);return[...o.values()]}_createFragmentStyle(t){const o=this.scope?s.B(t.id,this.scope):t.id;let f;const y=this._initialConfig&&this._initialConfig[o];(t.config||y)&&(f=Object.assign({},t.config,y));const x=new ml(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){if(this._isInternalStyle(t)){const x=Object.assign({},Tp,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(x,o)}if(this.updateConfig(this._config,t.schema),o&&Wc(this,js(t)))return;this._loaded=!0,this.stylesheet=s.dn(t);const f=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const R in t.iconsets)this.addIconset(R,t.iconsets[R]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const x=va(this.stylesheet.layers);if(this._order=x.map((R=>R.id)),this.stylesheet.light&&s.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new Re(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Re(this.stylesheet.light)),this._layers={};for(const R of x){const L=s.dt(R,this.scope,this._styleColorTheme.lut,this.options);L.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(L.fqid),this._hasAppearances=this._hasAppearances||L.getAppearances().length!==0,L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const k=this.getOwnLayerSourceCache(L),U=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&L.canCastShadows()&&U&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.z("data",{dataType:"style"}));const A=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then((()=>{this._reloadImports(),this.fire(new s.z(A?"style.load":"style.import.load"))})).catch((R=>{this.fire(new s.y(new Error("Failed to load imports",R))),this.fire(new s.z(A?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new s.z(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const x=this._evaluateColorThemeData(y);this._loadColorTheme(x).then((()=>{f()})).catch((T=>{s.w(`Couldn't load color theme from the stylesheet: ${T}`),f()}))}else this._styleColorTheme.lut=null,f()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let t,o,f,y,x,T,A,R,L,k;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const H of B.stylesheet.lights)H.type==="ambient"&&B.ambientLight!=null&&(o=B.ambientLight),H.type==="directional"&&B.directionalLight!=null&&(f=B.directionalLight);y=this._prioritizeTerrain(y,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(x=B.fog),B.stylesheet.snow&&B.snow!=null&&(T=B.snow),B.stylesheet.rain&&B.rain!=null&&(A=B.rain),B.stylesheet.camera!=null&&(k=B.stylesheet.camera),B.stylesheet.projection!=null&&(R=B.stylesheet.projection),B.stylesheet.transition!=null&&(L=B.stylesheet.transition),U[B.scope]=B._styleColorTheme}})),this.light=t,this.ambientLight=o,this.directionalLight=f,this.fog=x,this.snow=T,this.rain=A,this._styleColorThemeForScope=U,y===null?delete this.terrain:this.terrain=y,this.camera=k||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=Object.assign({},ig,L),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const o=f=>{for(const y of f.fragments)o(y.style);t(f)};o(this)}_prioritizeTerrain(t,o,f){const y=t&&t.drapeRenderMode===0;return f===null?o&&o.drapeRenderMode===0?o:y?t:null:o!=null&&(!t||y||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},o={},f={};this.forEachFragmentStyle((y=>{for(const x in y._sourceCaches){const T=s.B(x,y.scope);t[T]=y._sourceCaches[x]}for(const x in y._otherSourceCaches){const T=s.B(x,y.scope);o[T]=y._otherSourceCaches[x]}for(const x in y._symbolSourceCaches){const T=s.B(x,y.scope);f[T]=y._symbolSourceCaches[x]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=f}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const o of Object.values(t.stylesheet.indoor)){const f=o,y=s.B(f.sourceId,t.scope);this._mergedIndoor[y]=new Set(f.sourceLayers||[])}}))}mergeLayers(){const t={},o=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((T=>{for(const A of T._order){const R=T._layers[A];if(R.type==="slot"){const L=s.dp(A);if(t[L])continue;t[L]=[]}R.slot&&t[R.slot]?t[R.slot].push(R):o.push(R)}})),this._mergedOrder=[];let y=-1;const x=(T=[])=>{for(const A of T)if(A.type==="slot"){const R=s.dp(A.id);t[R]&&x(t[R]),this._mergedSlots.push(R)}else{const R=s.B(A.id,A.scope);this._mergedOrder.push(R),f[R]=A,A.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&(this._clipLayerPresent=!0)}};if(x(o),this._has3DLayers){const T={};for(let A=0;A<this._mergedOrder.length;++A){const R=this._mergedOrder[A];T[R]=A===y?1:A<y?f[R].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((A,R)=>T[A]-T[R]))}this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(o,f,y,x){const T=Object.assign({},f);for(const R of Object.keys(ah))T[R]===void 0&&(T[R]=ah[R].default);const A=new s.a8($c,o,new Map(y));return A.setTransitionOrValue(T,y),A.untransitioned().possiblyEvaluate(new s.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((f,y)=>{const x="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let T=t;T.startsWith(x)||(T=x+T);const A=s.I.from("mapbox-reserved-lut"),R=new Image;R.src=T,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void f();this._styleColorTheme.lutLoading=!1;const{width:L,height:k,data:U}=s.o.getImageData(R);if(k>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==k*k)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new s.q({width:L,height:k},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(A,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},f()):y(new Error("Missing LUT image."))}}))}getLut(t){const o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(o,f,y){let x,T,A;const R=s.o.devicePixelRatio>1?"@2x":"";let L=s.m(f.transformRequest(f.normalizeSpriteURL(o,R,".json"),s.R.SpriteJSON),((B,H)=>{L=null,A||(A=B,x=H,U())})),k=s.n(f.transformRequest(f.normalizeSpriteURL(o,R,".png"),s.R.SpriteImage),((B,H)=>{k=null,A||(A=B,T=H,U())}));function U(){if(A)y(A);else if(x&&T){const B=s.o.getImageData(T),H={};for(const W in x){const{width:X,height:te,x:ee,y:re,sdf:he,pixelRatio:le,stretchX:we,stretchY:fe,content:Ee}=x[W],ge=new s.q({width:X,height:te});s.q.copy(B,ge,{x:ee,y:re},{x:0,y:0},{width:X,height:te},null),H[W]={data:ge,pixelRatio:le!==void 0?le:1,sdf:he!==void 0&&he,stretchX:we,stretchY:fe,content:Ee,usvg:!1,version:0}}y(null,H)}}return{cancel(){L&&(L.cancel(),L=null),k&&(k.cancel(),k=null)}}})(t,this.map._requestManager,((o,f)=>{if(this._spriteRequest=null,o)this.fire(new s.y(o));else if(f){const y=new Map;for(const x in f)y.set(s.I.from(x),f[x]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))}))}addIconset(t,o){if(o.type==="sprite")return void this._loadSprite(o.url);const f=this.getOwnSourceCache(o.source);if(!f)return void this.fire(new s.y(new Error(`Source "${o.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const y=f.getSource();if(y.type!=="raster-array")return void this.fire(new s.y(new Error(`Source "${o.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const x=new tg(t,this.scope,f);this.imageManager.addImageProvider(x,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!s.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const o=this.map._spriteFormat==="auto";var f,y;this._spriteRequest=(y=(x,T)=>{if(this._spriteRequest=null,x)o?this._loadSprite(t):this.fire(new s.y(x));else if(T){const A=new Map;for(const R in T)A.set(s.I.from(R),T[R]);this.addImages(A)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.z("data",{dataType:"style"}))},s.bt((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(t),s.R.Iconset),((x,T)=>{if(x)return void y(x);const A={},R=s.df(new s.bs(T));for(const L of R.icons){const k={version:1,pixelRatio:s.o.devicePixelRatio,content:lh(L),stretchX:L.metadata?ch(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?ch(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};A[L.name]=k}y(null,A)})))}_validateLayer(t){const o=this.getOwnSource(t.source);if(!o)return;const f=t.sourceLayer;f&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(f)===-1)&&this.fire(new s.y(new Error(`Source layer "${f}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,o)=>{const f=this.fragments[o];return f&&f.style&&(t.data=f.style.serialize()),t}))}_serializeSources(){const t={};for(const o in this._sourceCaches){const f=this._sourceCaches[o].getSource();t[f.id]||(t[f.id]=f.serialize())}return t}_serializeLayers(t){const o=[];for(const f of t){const y=this._layers[f];y&&y.type!=="custom"&&o.push(y.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const o=this.getOwnLayer(t);if(o)return o;this.fire(new s.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const o=this.getOwnSource(t);if(o)return o;this.fire(new s.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){const f=this.map.painter;if(f)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const x=t.getProgramIds();if(x)for(const T of x){const A=t.getDefaultProgramParams(T,o.zoom,this._styleColorTheme.lut);A&&(f.style=this,this.fog&&(f._fogVisible=!0,A.overrideFog=!0,f.getOrCreateProgram(T,A)),f._fogVisible=!1,A.overrideFog=!1,f.getOrCreateProgram(T,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,f.getOrCreateProgram(T,A)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const f=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const A=this._changes.getLayerUpdatesByScope();for(const R in A){const{updatedIds:L,removedIds:k}=A[R];(L||k)&&(this._updateWorkerLayers(R,L,k),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const x={};for(const A in this._mergedSourceCaches){const R=this._mergedSourceCaches[A];x[A]=R.used,R.used=!1,R.tileCoverLift=0}for(const A of this._mergedOrder){const R=this._mergedLayers[A];if(R.recalculate(t,this._availableImages),!R.isHidden(t.zoom)){const L=this.getLayerSourceCache(R);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(R,t)})):this.precompilePrograms(R,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const A of T)A.sourceCache.used=!0;for(const A in x){const R=this._mergedSourceCaches[A];x[A]!==R.used&&R.getSource().fire(new s.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new s.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const o of t){const f=o.resolvePendingRequests(),y=this.getFragmentStyle(o.scope);y&&y.addImages(f)}}_updateTilesForChangedImages(){const t={};for(const o in this._mergedSourceCaches){const f=this._mergedSourceCaches[o].getSource().scope;t[f]=t[f]||this._changes.getUpdatedImages(f),t[f].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t[f])}for(const o in t)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(t,o,f){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:o?y._serializeLayers(o):[],scope:t,removedIds:f||[],options:y.options})}setState(t,o){if(this._checkLoaded(),Wc(this,js(t)))return!1;(t=s.dn(t)).layers=va(t.layers);const f=(function(T,A){if(!T)return[{command:Mn.setStyle,args:[A]}];let R=[];try{if(!s.bx(T.version,A.version))return[{command:Mn.setStyle,args:[A]}];if(s.bx(T.center,A.center)||R.push({command:Mn.setCenter,args:[A.center]}),s.bx(T.zoom,A.zoom)||R.push({command:Mn.setZoom,args:[A.zoom]}),s.bx(T.bearing,A.bearing)||R.push({command:Mn.setBearing,args:[A.bearing]}),s.bx(T.pitch,A.pitch)||R.push({command:Mn.setPitch,args:[A.pitch]}),s.bx(T.sprite,A.sprite)||R.push({command:Mn.setSprite,args:[A.sprite]}),s.bx(T.glyphs,A.glyphs)||R.push({command:Mn.setGlyphs,args:[A.glyphs]}),s.bx(T.imports,A.imports)||(function(H=[],W=[],X){W=W||[];const te=(H=H||[]).map(to),ee=W.map(to),re=H.reduce(Wa,{}),he=W.reduce(Wa,{}),le=te.slice();let we,fe,Ee,ge;for(we=0,fe=0;we<te.length;we++)Ee=te[we],he.hasOwnProperty(Ee)?fe++:(X.push({command:Mn.removeImport,args:[Ee]}),le.splice(le.indexOf(Ee,fe),1));for(we=0,fe=0;we<ee.length;we++)Ee=ee[ee.length-1-we],le[le.length-1-we]!==Ee&&(re.hasOwnProperty(Ee)?(X.push({command:Mn.removeImport,args:[Ee]}),le.splice(le.lastIndexOf(Ee,le.length-fe),1)):fe++,ge=le[le.length-we],X.push({command:Mn.addImport,args:[he[Ee],ge]}),le.splice(le.length-we,0,Ee));for(const me of W){const Se=re[me.id];Se&&(delete Se.data,s.bx(Se,me)||X.push({command:Mn.updateImport,args:[me.id,me]}))}})(T.imports,A.imports,R),s.bx(T.transition,A.transition)||R.push({command:Mn.setTransition,args:[A.transition]}),s.bx(T.light,A.light)||R.push({command:Mn.setLight,args:[A.light]}),s.bx(T.fog,A.fog)||R.push({command:Mn.setFog,args:[A.fog]}),s.bx(T.snow,A.snow)||R.push({command:Mn.setSnow,args:[A.snow]}),s.bx(T.rain,A.rain)||R.push({command:Mn.setRain,args:[A.rain]}),s.bx(T.projection,A.projection)||R.push({command:Mn.setProjection,args:[A.projection]}),s.bx(T.lights,A.lights)||R.push({command:Mn.setLights,args:[A.lights]}),s.bx(T.camera,A.camera)||R.push({command:Mn.setCamera,args:[A.camera]}),s.bx(T.iconsets,A.iconsets)||(function(H,W,X){let te;for(te in W=W||{},H=H||{})H.hasOwnProperty(te)&&(W.hasOwnProperty(te)||X.push({command:Mn.removeIconset,args:[te]}));for(te in W){if(!W.hasOwnProperty(te))continue;const ee=W[te];H.hasOwnProperty(te)?s.bx(H[te],ee)||(X.push({command:Mn.removeIconset,args:[te]}),X.push({command:Mn.addIconset,args:[te,ee]})):X.push({command:Mn.addIconset,args:[te,ee]})}})(T.iconsets,A.iconsets,R),!s.bx(T["color-theme"],A["color-theme"]))return[{command:Mn.setStyle,args:[A]}];const L={},k=[];(function(H,W,X,te){let ee;for(ee in W=W||{},H=H||{})H.hasOwnProperty(ee)&&(W.hasOwnProperty(ee)||Gc(ee,X,te));for(ee in W){if(!W.hasOwnProperty(ee))continue;const re=W[ee];H.hasOwnProperty(ee)?s.bx(H[ee],re)||(H[ee].type==="geojson"&&re.type==="geojson"&&Ul(H,W,ee)?X.push({command:Mn.setGeoJSONSourceData,args:[ee,re.data]}):Vl(ee,W,X,te)):jc(ee,W,X)}})(T.sources,A.sources,k,L);const U=[];T.layers&&T.layers.forEach((H=>{H.source&&L[H.source]?R.push({command:Mn.removeLayer,args:[H.id]}):U.push(H)}));let B=T.terrain;B&&L[B.source]&&(R.push({command:Mn.setTerrain,args:[void 0]}),B=void 0),R=R.concat(k),s.bx(B,A.terrain)||R.push({command:Mn.setTerrain,args:[A.terrain]}),(function(H,W,X){W=W||[];const te=(H=H||[]).map(to),ee=W.map(to),re=H.reduce(Wa,{}),he=W.reduce(Wa,{}),le=te.slice(),we=Object.create(null);let fe,Ee,ge,me,Se,Ve,ke;for(fe=0,Ee=0;fe<te.length;fe++)ge=te[fe],he.hasOwnProperty(ge)?Ee++:(X.push({command:Mn.removeLayer,args:[ge]}),le.splice(le.indexOf(ge,Ee),1));for(fe=0,Ee=0;fe<ee.length;fe++)ge=ee[ee.length-1-fe],le[le.length-1-fe]!==ge&&(re.hasOwnProperty(ge)?(X.push({command:Mn.removeLayer,args:[ge]}),le.splice(le.lastIndexOf(ge,le.length-Ee),1)):Ee++,Ve=le[le.length-fe],X.push({command:Mn.addLayer,args:[he[ge],Ve]}),le.splice(le.length-fe,0,ge),we[ge]=!0);for(fe=0;fe<ee.length;fe++)if(ge=ee[fe],me=re[ge],Se=he[ge],!we[ge]&&!s.bx(me,Se))if(s.bx(me.source,Se.source)&&s.bx(me["source-layer"],Se["source-layer"])&&s.bx(me.type,Se.type)){for(ke in xa(me.layout,Se.layout,X,ge,null,Mn.setLayoutProperty),xa(me.paint,Se.paint,X,ge,null,Mn.setPaintProperty),s.bx(me.slot,Se.slot)||X.push({command:Mn.setSlot,args:[ge,Se.slot]}),s.bx(me.filter,Se.filter)||X.push({command:Mn.setFilter,args:[ge,Se.filter]}),s.bx(me.minzoom,Se.minzoom)&&s.bx(me.maxzoom,Se.maxzoom)||X.push({command:Mn.setLayerZoomRange,args:[ge,Se.minzoom,Se.maxzoom]}),me)me.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?xa(me[ke],Se[ke],X,ge,ke.slice(6),Mn.setPaintProperty):s.bx(me[ke],Se[ke])||X.push({command:Mn.setLayerProperty,args:[ge,ke,Se[ke]]}));for(ke in Se)Se.hasOwnProperty(ke)&&!me.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&ke!=="slot"&&(ke.indexOf("paint.")===0?xa(me[ke],Se[ke],X,ge,ke.slice(6),Mn.setPaintProperty):s.bx(me[ke],Se[ke])||X.push({command:Mn.setLayerProperty,args:[ge,ke,Se[ke]]}))}else X.push({command:Mn.removeLayer,args:[ge]}),Ve=le[le.lastIndexOf(ge)+1],X.push({command:Mn.addLayer,args:[Se,Ve]})})(U,A.layers,R)}catch(L){console.warn("Unable to compute style diff:",L),R=[{command:Mn.setStyle,args:[A]}]}return R})(this.serialize(),t).filter((T=>!(T.command in wp)));if(f.length===0)return!1;const y=f.filter((T=>!(T.command in uh)));if(y.length>0)throw new Error(`Unimplemented: ${y.map((T=>T.command)).join(", ")}.`);const x=[];return f.forEach((T=>{x.push(this[T.command](...T.args))})),o&&Promise.all(x).then(o).catch(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[o,f]of t.entries()){if(this.getImage(o))return this.fire(new s.y(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,f),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this}addImage(t,o){return this.getImage(t)?this.fire(new s.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,o),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this)}updateImage(t,o,f=!1){this.imageManager.updateImage(t,this.scope,o),f&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new s.z("data",{dataType:"style"})),this}addModel(t,o,f={}){return this._checkLoaded(),this._validate(_u,`models.${t}`,o,null,f)||(this.modelManager.addModel(t,o,this.scope),this.fire(new s.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new s.z("data",{dataType:"style"})),this):this.fire(new s.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,f={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Ma,`sources.${t}`,o,null,f))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const y=Ys(t,o,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id})));const x=T=>{const A=(T?"symbol:":"other:")+y.id,R=s.B(A,this.scope),L=this._sourceCaches[A]=new qo(R,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=L,L.onAdd(this.map)};x(!1),o.type!=="vector"&&o.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find((([x,T])=>T.type==="source"&&T.source===t));if(y)return this.fire(new s.y(new Error(`Source "${t}" cannot be removed while iconset "${y[0]}" is using it.`)))}const f=this.getOwnSourceCaches(t);for(const y of f){const x=s.dp(y.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(y.id),y.fire(new s.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){const o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){const t=[];for(const o in this._otherSourceCaches){const f=this.getOwnSourceCache(o);f&&t.push(f.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const o in t){const f=t[o]._tiles;for(const y in f){const x=f[y];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const x of t){if(this._validate(ad,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(x),T.updateTransitions(o)}else this.ambientLight=new Gr(x,Rn||(Rn=new s.a9({color:new s.aa(s.a6.properties_light_ambient.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(x),T.updateTransitions(o)}else this.directionalLight=new Gr(x,mr||(mr=new s.a9({direction:new s.ap(s.a6.properties_light_directional.direction),color:new s.aa(s.a6.properties_light_directional.color),"color-use-theme":new s.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new s.aa(s.a6.properties_light_directional.intensity),"cast-shadows":new s.aa(s.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new s.aa(s.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new s.aa(s.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=Object.assign(o,{worldview:this.map.getWorldview()}),y=new s.ac(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;const f=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),y=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),x=t.properties.get("intensity"),T=t.properties.get("direction"),A=1-s.d3(T.x,T.y,T.z)[2]/90,R=f(y)*x*A,L=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),k=o.properties.get("intensity"),U=f(L)*k;return Number(((R+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(s.dq(t)){const o=s.dr(t),f=this.fragments.find((({id:x})=>x===o));if(!f)return;const y=s.dp(t);return f.style.getFragmentStyle(y)}{const o=this.fragments.find((({id:f})=>f===t));return o?o.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const o={},f=(y,x="")=>`${y}::${x}`;this._featuresetSelectors={};for(const y in t){const x=this._featuresetSelectors[y]=[];for(const T of t[y].selectors){if(T.featureNamespace){const R=this.getOwnLayer(T.layer);if(!R){s.w(`Layer is undefined for selector: ${T.layer}`);continue}const L=f(R.source,R.sourceLayer);if(L in o&&o[L]!==T.featureNamespace){s.w(`"featureNamespace ${T.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}o[L]=T.featureNamespace}let A;if(T.properties)for(const R in T.properties){const L=s.U(T.properties[R]);L.result==="success"&&(A=A||{},A[R]=L.value)}x.push({layerId:T.layer,namespace:T.featureNamespace,properties:A,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];const f=[];for(const y in o.stylesheet.featuresets)f.push({featuresetId:y,importId:o.scope?o.scope:void 0});return f}getFeaturesetLayers(t,o){const f=this.getFragmentStyle(o),y=f.stylesheet.featuresets;if(!y||!y[t])return this.fire(new s.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const T of y[t].selectors){const A=f.getOwnLayer(T.layer);A&&x.push(A)}return x}getConfigProperty(t,o){const f=this.getFragmentStyle(t);if(!f)return null;const y=s.B(o,f.scope),x=f.options.get(y),T=x?x.value||x.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,o){const f=s.B(t,o);return this._mergedIndoor[f]}setIndoorData(t,o){this.map.indoor.setIndoorData(o)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,o,f){const y=this.getFragmentStyle(t);if(!y)return;const x=y.stylesheet.schema;if(!x||!x[o])return;const T=s.U(f);if(T.result!=="success")return void Wc(this,T.value);const A=T.value.expression,R=s.B(o,y.scope),L=y.options.get(R);if(!L)return;let k;const{minValue:U,maxValue:B,stepValue:H,type:W,values:X}=x[o],te=s.U(x[o].default);te.result==="success"&&(k=te.value.expression),k?(this.options.set(R,Object.assign({},L,{value:A,default:k,minValue:U,maxValue:B,stepValue:H,type:W,values:X})),this.updateConfigDependencies(o)):this.fire(new s.y(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){const o=this.getFragmentStyle(t);if(!o)return null;const f=o.stylesheet.schema;if(!f)return null;const y={};for(const x in f){const T=s.B(x,o.scope),A=o.options.get(T),R=A?A.value||A.default:null;y[x]=R?R.serialize():null}return y}setConfig(t,o){const f=this.getFragmentStyle(t);f&&(f.updateConfig(o,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){const f=this.getFragmentStyle(t);f&&(f.stylesheet.schema=o,f.updateConfig(f._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(const f in o){let y,x;const T=s.U(o[f].default);if(T.result==="success"&&(y=T.value.expression),t&&t[f]!==void 0){const B=s.U(t[f]);B.result==="success"&&(x=B.value.expression)}const{minValue:A,maxValue:R,stepValue:L,type:k,values:U}=o[f];if(y){const B=s.B(f,this.scope);this.options.set(B,{default:y,value:x,minValue:A,maxValue:R,stepValue:L,type:k,values:U})}else this.fire(new s.y(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new s.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,o=(()=>!0)){for(const f of t){const y=this.getLayer(f);y&&o(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(o=>!t||o.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((o=>{const f=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(f){const y=o._evaluateColorThemeData(f);(!o._styleColorTheme.lut&&y!==""||o._styleColorTheme.lut&&y!==o._styleColorTheme.lut.data)&&o.setColorTheme(f)}})),this._changes.setDirty()}addLayer(t,o,f={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new s.y(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(t.type==="custom"){if(Wc(this,s.ds(t)))return;x=s.dt(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=s.dn(t),t=Object.assign(t,{source:y})),this._validate(Vc,`layers.${y}`,t,{arrayIndex:-1},f))return;x=s.dt(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}})}const T=s.B(x.source,x.scope);x.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),x.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let A=this._order.length;if(o){const U=this._order.indexOf(o);if(U===-1)return void this.fire(new s.y(new Error(`Layer with id "${o}" does not exist on this map.`)));x.slot===this._layers[o].slot?A=U:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const R=this.getOwnLayerSourceCache(x),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&x.canCastShadows()&&L&&(R.castsShadows=!0);const k=this._changes.getRemovedLayer(x);if(k&&x.source&&R&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const U=s.B(x.source,x.scope);k.type!==x.type?this._changes.updateSourceCache(U,"clear"):(this._changes.updateSourceCache(U,"reload"),R.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();const f=this._checkLayer(t);if(!f||t===o)return;const y=this._order.indexOf(t);this._order.splice(y,1);let x=this._order.length;if(o){const T=this._order.indexOf(o);if(T===-1)return void this.fire(new s.y(new Error(`Layer with id "${o}" does not exist on this map.`)));f.slot===this._layers[o].slot?x=T:s.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);const f=this._order.indexOf(t);this._order.splice(f,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._indoorDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const y=this.getOwnLayerSourceCache(o);if(y&&y.castsShadows){let x=!1;for(const T in this._layers)if(this._layers[T].source===o.source&&this._layers[T].canCastShadows()){x=!0;break}y.castsShadows=x}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,f){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===o&&y.maxzoom===f||(o!=null&&(y.minzoom=o),f!=null&&(y.maxzoom=f),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();const f=this._checkLayer(t);f&&f.slot!==o&&(f.slot=o,this._updateLayer(f))}setFilter(t,o,f={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!s.bx(y.filter,o))return o==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(gn,`layers.${y.id}.filter`,o,{layerType:y.type},f)||(y.filter=s.dn(o),this._updateLayer(y)))}getFilter(t){const o=this._checkLayer(t);if(o)return s.dn(o.filter)}setLayoutProperty(t,o,f,y={}){this._checkLoaded();const x=this._checkLayer(t);if(x&&!s.bx(x.getLayoutProperty(o),f)){if(f!=null&&(!y||y.validate!==!1)&&Wc(x,Nl.call(js,{key:`layers.${t}.layout.${o}`,layerType:x.type,objectKey:o,value:f,styleSpec:s.a6,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(o,f),x.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),x.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x.fqid),this._updateLayer(x)}}setLayerProperty(t,o,f,y={}){this._checkLoaded();const x=this._checkLayer(t);x&&(o==="appearances"?(x.setAppearances(f),this._changes.setDirty()):x.isPaintProperty(o)?this.setPaintProperty(t,o,f,y):this.setLayoutProperty(t,o,f,y))}getLayoutProperty(t,o){const f=this._checkLayer(t);if(f)return f.getLayoutProperty(o)}setPaintProperty(t,o,f,y={}){this._checkLoaded();const x=this._checkLayer(t);if(!x||s.bx(x.getPaintProperty(o),f)||f!=null&&(!y||y.validate!==!1)&&Wc(x,Ls.call(js,{key:`layers.${t}.paint.${o}`,layerType:x.type,objectKey:o,value:f,styleSpec:s.a6})))return;const T=x.setPaintProperty(o,f);x.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),x.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x.fqid),T&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(t,o){const f=this._checkLayer(t);if(f)return f.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:L}=t.target,k=this.getFragmentStyle(L),U=k.getFeaturesetLayers(R);for(const{source:B,sourceLayer:H}of U)k.setFeatureState({id:t.id,source:B,sourceLayer:H},o)}else if("layerId"in t.target){const{layerId:R}=t.target,L=this.getLayer(R);this.setFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},o)}return}const f=t.source,y=t.sourceLayer,x=this._checkSource(f);if(!x)return;const T=x.type;if(T==="geojson"&&y)return void this.fire(new s.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(f);for(const R of A)R.setFeatureState(y,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:L}=t.target,k=this.getFragmentStyle(L),U=k.getFeaturesetLayers(R);for(const{source:B,sourceLayer:H}of U)k.removeFeatureState({id:t.id,source:B,sourceLayer:H},o)}else if("layerId"in t.target){const{layerId:R}=t.target,L=this.getLayer(R);this.removeFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},o)}return}const f=t.source,y=this._checkSource(f);if(!y)return;const x=y.type,T=x==="vector"?t.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new s.y(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(f);for(const R of A)R.removeFeatureState(T,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let x;if("featuresetId"in t.target){const{featuresetId:T,importId:A}=t.target,R=this.getFragmentStyle(A),L=R.getFeaturesetLayers(T);for(const{source:k,sourceLayer:U}of L){const B=R.getFeatureState({id:t.id,source:k,sourceLayer:U});if(B&&!x)x=B;else if(!s.bx(x,B))return void this.fire(new s.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:T}=t.target,A=this.getLayer(T);x=this.getFeatureState({id:t.id,source:A.source,sourceLayer:A.sourceLayer})}return x}const o=t.source,f=t.sourceLayer,y=this._checkSource(o);if(y){if(y.type!=="vector"||f)return t.id===void 0&&this.fire(new s.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(f,t.id);this.fire(new s.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return s.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(f=>f!==void 0))}_updateFilteredLayers(t){for(const o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);const o=this.getLayerSourceCache(t),f=s.B(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[f]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=A=>this._mergedLayers[A].is3D(!!this.terrain),f=this.order,y={},x=[];for(let A=f.length-1;A>=0;A--){const R=f[A];if(o(R)){y[R]=A;for(const L of t){const k=L[R];if(k)for(const U of k)x.push(U)}}}x.sort(((A,R)=>R.intersectionZ-A.intersectionZ));const T=[];for(let A=f.length-1;A>=0;A--){const R=f[A];if(o(R))for(let L=x.length-1;L>=0;L--){const k=x[L].feature;if(k.layer&&y[k.layer.id]<A)break;T.push(k),x.pop()}else for(const L of t){const k=L[R];if(k)for(const U of k)T.push(U.feature)}}return T}queryRasterValue(t,o,f){const y=this.getOwnSource(t);return y?y.type!=="raster-array"?(this.fire(new s.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(o,f):(this.fire(new s.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,o,f){let y;o&&!Array.isArray(o)&&o.filter&&(this._validate(gn,"queryRenderedFeatures.filter",o.filter,null,o),y=s.b5(o.filter));const x={},T=k=>{if(uf.has(k.type))return;const U=this.getOwnLayerSourceCache(k),B=x[U.id]=x[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[k.fqid]=B.layers[k.fqid]||{styleLayer:k,targets:[]},B.layers[k.fqid].targets.push({filter:y})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new s.y(new Error("parameters.layers must be an Array."))),[];for(const k of o.layers){const U=this._layers[k];if(!U)return this.fire(new s.y(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];T(U)}}else for(const k in this._layers)T(this._layers[k]);const A=this._queryRenderedFeatures(t,x,f),R=this._flattenAndSortRenderedFeatures(A),L=[];for(const k of R)s.dv(k.layer.id)===this.scope&&L.push(k);return L}queryRenderedFeatureset(t,o,f){let y;o&&!Array.isArray(o)&&o.filter&&(this._validate(gn,"queryRenderedFeatures.filter",o.filter,null,o),y=s.b5(o.filter));const x="mock",T=[];if(o&&o.target)T.push(Object.assign({},o,{targetId:x,filter:y}));else{const k=this.getFeaturesetDescriptors();for(const U of k)T.push({targetId:x,filter:y,target:U});for(const{style:U}of this.fragments){const B=U.getFeaturesetDescriptors();for(const H of B)T.push({targetId:x,filter:y,target:H})}}const A=this.queryRenderedTargets(t,T,f),R=[],L=new Set;for(const k of A)for(const U of k.variants[x])Mo(U,k,L)||R.push(new s.dw(k,U));return R}queryRenderedTargets(t,o,f){const y={},x=(A,R,L,k)=>{const U=y[R.id]=y[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(U.layers[A.fqid]=U.layers[A.fqid]||{styleLayer:A,targets:[]},A.is3D(!!this.terrain)&&(U.has3DLayers=!0),!k)return L.uniqueFeatureID=!1,void U.layers[A.fqid].targets.push(L);U.layers[A.fqid].targets.push(Object.assign({},L,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const A of o)if("featuresetId"in A.target){const{featuresetId:R,importId:L}=A.target,k=this.getFragmentStyle(L);if(!k||!k._featuresetSelectors)continue;const U=k._featuresetSelectors[R];if(!U){this.fire(new s.y(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of U){const H=k.getOwnLayer(B.layerId);H&&!uf.has(H.type)&&x(H,k.getOwnLayerSourceCache(H),A,B)}}else if("layerId"in A.target){const{layerId:R}=A.target,L=this.getLayer(R);if(!L||uf.has(L.type))continue;x(L,this.getLayerSourceCache(L),A)}const T=this._queryRenderedFeatures(t,y,f);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(t,o,f){const y=[],x=!!this.map._showQueryGeometry,T=Hn.createFromScreenPoints(t,f);for(const A in o){const R=Qs(T,o[A],this._availableImages,f,x);Object.keys(R).length&&y.push(R)}if(this.placement)for(const A in o){if(!o[A].sourceCache._onlySymbols)continue;const R=nh(T.screenGeometry,o[A],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&y.push(R)}return y}querySourceFeatures(t,o){const f=o&&o.filter;f&&this._validate(gn,"querySourceFeatures.filter",f,null,o);let y=[];const x=this.getOwnSourceCaches(t);for(const T of x)y=y.concat(ul(T,o));return y}addSourceType(t,o,f){return ml.getSourceType(t)?f(new Error(`A source type called "${t}" already exists.`)):(ml.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,f={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const A in t)if(!s.bx(t[A],y[A])){x=!0;break}if(!x)return;const T=this._getTransitionParameters();this.light.setLight(t,o,f),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&s.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=t;const y=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const A="terrain-dem-src";this.addSource(A,f.source),f=s.dn(f),f=Object.assign(f,{source:A})}const x=Object.assign({},f),T={};if(this.terrain&&y){x.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(T.style=A.serialize())}if(this._validate(ga,"terrain",x,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&o!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,o),this.fire(new s.z("data",{dataType:"style"}))}else{const x=this.terrain,T=x.get();for(const A of Object.keys(s.a6.terrain))!f.hasOwnProperty(A)&&s.a6.terrain[A].default&&(f[A]=s.a6.terrain[A].default);for(const A in t)if(!s.bx(t[A],T[A])){x.set(t,this.options),this.stylesheet.terrain=t;const R=this._getTransitionParameters({duration:0});x.updateTransitions(R),this.fire(new s.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new gi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}_createSnow(t){const o=this.snow=new ds(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}_createRain(t){const o=this.rain=new Zr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!s.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!s.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!s.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();const f=this._getTransitionParameters({duration:0});o.updateTransitions(f)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();const f=this._evaluateColorThemeData(o);this._loadColorTheme(f).then((()=>{this.fire(new s.z("colorthemeset")),t()})).catch((y=>{s.w(`Couldn't set color theme: ${y}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&s.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){const f=this.getFragmentStyle(t);f&&(f._styleColorTheme.colorThemeOverride=o,f._reloadColorTheme())}_getTransitionParameters(t){return{now:s.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],o=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?t.push(f):o.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const f=this.terrain=new Fe(t,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,f,y,x={}){if(x&&x.validate===!1)return!1;const T=Object.assign({},this.serialize());return Wc(this,t.call(js,Object.assign({key:o,style:T,value:f,styleSpec:s.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const o=this.getSourceCaches(t);for(const f of o)f.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const o=this._mergedLayers[t];o._clear&&o._clear()}}reloadSource(t){const o=this.getSourceCaches(t);for(const f of o)f.resume(),f.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let o;this.directionalLight&&(o=A_(this.directionalLight));const f=new Set;for(const y in this._mergedLayers){const x=this._mergedLayers[y];x.hasElevation()&&!f.has(x.source)&&f.add(x.source)}for(const y in this._mergedSourceCaches){const x=this._mergedSourceCaches[y],T=f.has(x._source.id);x.update(t,void 0,void 0,o,T)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,f,y,x,T,A=!1){let R=!1,L=!1;const k={},U={};for(const B of this._mergedOrder){const H=this._mergedLayers[B];if(H.type!=="symbol")continue;const W=s.B(H.source,H.scope);let X=k[W];if(!X){const ee=this.getLayerSourceCache(H);if(!ee)continue;const re=ee.getRenderableIds(!0).map((he=>ee.getTileByID(he)));U[W]=re.slice(),X=k[W]=re.sort(((he,le)=>le.tileID.overscaledZ-he.tileID.overscaledZ||(he.tileID.isLessThan(le.tileID)?-1:1)))}const te=this.crossTileSymbolIndex.addLayer(H,X,o.center.lng,o.projection);R=R||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new s.z("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.o.now(),o.zoom))&&(this.pauseablePlacement=new fo(o,this._mergedOrder,A,f,y,x,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.o.now()),L=!0),R&&this.pauseablePlacement.placement.setStale()),L||R){this._buildingIndex.onNewFrame(o.zoom);for(let B=0;B<this._mergedOrder.length;B++){const H=this._mergedLayers[this._mergedOrder[B]];if(H.type!=="symbol")continue;const W=this.isLayerClipped(H);this.placement.updateLayerOpacities(H,k[s.B(H.source,H.scope)],B,W?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex((({id:x})=>x===t.id))!==-1)return void this.fire(new s.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return f.push(t),this._loadImports([t],!0);const y=f.findIndex((({id:x})=>x===o));return y===-1&&this.fire(new s.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,y).concat(t).concat(f.slice(y)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==f[y].url&&this.setImportUrl(t,o.url),s.bx(o.config,f[y].config)||this.setImportConfig(t,o.config,o.data.schema),s.bx(o.data,f[y].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let f=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const x=this.getImportIndex(o);if(x===-1)return this;const T=f[y],A=this.fragments[y];return f=f.filter((({id:R})=>R!==t)),this.fragments=this.fragments.filter((({id:R})=>R!==t)),this.stylesheet.imports=f.slice(0,x).concat(T).concat(f.slice(x)),this.fragments=this.fragments.slice(0,x).concat(A).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;f[y].url=o;const x=this.fragments[y];return x.style=this._createFragmentStyle(f[y]),x.style.on("style.import.load",(()=>this.mergeAll())),x.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();const f=this.getImportIndex(t),y=this.stylesheet.imports||[];return f===-1?this:o?(this.fragments[f].style.setState(o),this._reloadImports(),this):(delete y[f].data,this.setImportUrl(t,y[f].url))}setImportConfig(t,o,f){this._checkLoaded();const y=this.getImportIndex(t),x=this.stylesheet.imports||[];if(y===-1)return this;o?x[y].config=o:delete x[y].config;const T=this.fragments[y];f&&T.style.stylesheet&&(T.style.stylesheet.schema=f);const A=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=o,T.style.updateConfig(o,A),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const o=this.stylesheet.imports||[],f=this.getImportIndex(t);f!==-1&&(o.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(t){const o=(this.stylesheet.imports||[]).findIndex((f=>f.id===t));return o===-1&&this.fire(new s.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const o in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[o];f&&t.push(f.getSource())}return t}getSource(t,o){const f=this.getSourceCache(t,o);return f&&f.getSource()}getLayerSource(t){const o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){const f=s.B(t,o);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(t){const o=s.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const o in t){const f=t[o];f==="reload"?this.reloadSource(o):f==="clear"&&this.clearSource(o)}}updateLayers(t){const o=this._changes.getUpdatedPaintProperties();for(const f of o){const y=this.getLayer(f);y&&y.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,o,f){this.imageManager.getImages(o.images,o.scope,f),this._updateTilesForChangedImages();const y=T=>{if(T){const A=o.images.map((R=>s.I.toString(R)));T.setDependencies(o.tileID.key,o.type,A)}},x=s.B(o.source,o.scope);y(this._mergedOtherSourceCaches[x]),y(this._mergedSymbolSourceCaches[x]),o.images.some((T=>T.iconsetId))&&this.fire(new s.z("data",{dataType:"style"}))}rasterizeImages(t,o,f){this.imageManager.rasterizeImages(o,f)}getGlyphs(t,o,f){this.glyphManager.getGlyphs(o.stacks,f)}getResource(t,o,f){return s.dy(o,f)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new s.y(new Error(`There is no source with ID '${t}'`))),!1):o.every((f=>f.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const f=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),y=t.type==="building";if(t.is3D(!!this.terrain)){if(f||y||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ml.getSourceType=function(d){return Ms[d]},ml.setSourceType=function(d,t){Ms[d]=t},ml.registerForPluginStateChange=s.dz;class hh extends s.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},s.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[o,f]of Object.entries(t.buildings))if(this._buildings[o])for(const y of f.floorIds)this._buildings[o].floors[y]||(this._buildings[o].floors[y]=f.floors[y]);else this._buildings[o]=f;for(const o of t.activeFloors)this._activeFloors.add(o);this._updateIndoorSelector()}getIndoorTileOptions(t,o){const f=this._style.getIndoorSourceLayers(t,o);return f&&this._indoorState?{sourceLayers:f,indoorState:this._indoorState}:null}_updateUI(t,o,f){const y=(function(x,T,A,R){let L=null,k=Number.MAX_SAFE_INTEGER;if(R<16)return null;for(const[U,B]of Object.entries(x)){const H=B.center;if(H){const W=T.distanceTo(s.aS.convert(H));W<k&&A.contains(H)&&(k=W,L=U)}}return L})(this._buildings,o,f,t);y!==this._closestBuildingId&&(this._closestBuildingId=y,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,o=this._closestBuildingId,f=o&&t?t[o]:void 0;if(!f)return void this.fire(new s.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let y=null;for(const T of f.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){y=T;break}const x=Array.from(f.floorIds).map((T=>({id:T,name:f.floors[T].name,zIndex:f.floors[T].zIndex}))).sort(((T,A)=>A.zIndex-T.zIndex));this.fire(new s.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:x}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var pd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Ep=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,hf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,ra="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Zc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,La=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Xc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ta=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,dh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Nt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,df=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const gl=[];za(pd,gl),za(hf,gl),za(Ep,gl);const fh={"_prelude_fog.vertex.glsl":La,"_prelude_terrain.vertex.glsl":Zc,"_prelude_shadow.vertex.glsl":Nt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Xc,"_prelude_shadow.fragment.glsl":df,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ta,"_prelude_raster_particle.glsl":dh},Su={};an("",Zc),an(Xc,La),an(df,Nt),an(Ta,""),an(dh,"");const gc=an(Ep,hf),_c=pd;var sa={background:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:an(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:an("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:an(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:an(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:an("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:an("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:an("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:an(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:an(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:an(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:an(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:an(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:an("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:an("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:an(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:an(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:an("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:an(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ra),skyboxGradient:an(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ra),skyboxCapture:an(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:an(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:an(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:an("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:an("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:an("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:an("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function za(d,t){const o=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of o)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=f.split(" ");for(const x of y)t.includes(x)||t.push(x)}}function an(d,t){const o=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,y={},x=[],T=[];if(d=d.replace(o,((R,L)=>(T.push(L),""))),(t=t.replace(o,((R,L)=>(x.push(L),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...gl];za(d,A),za(t,A);for(const R of[...x,...T])fh[R]||console.error(`Undefined include: ${R}`),Su[R]||(Su[R]=[],za(fh[R],Su[R])),A=[...A,...Su[R]];return{fragmentSource:d=d.replace(f,((R,L,k,U,B)=>(y[B]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${k} ${U} ${B};
#else
uniform ${k} ${U} u_${B};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${k} ${U} ${B} = u_${B};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${k} ${U} ${B};
#endif
`:L==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(f,((R,L,k,U,B)=>{const H=`MATERIAL_ATTRIBUTE_OFFSET_${B}`,W=U==="float"?"vec2":U,X=`GET_ATTRIBUTE_${W}(a_${B}, materialInfo, ${H})`,te=B.match(/color/)?"color":W;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${k} ${U} a_${B};
#endif
`:y[B]?L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${H})
        in ${k} ${W} a_${B};
    #endif
out ${k} ${U} ${B};
#else
uniform ${k} ${U} u_${B};
#endif
`:L==="initialize"?te==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${k} ${U} ${B} = u_${B};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${B}) 
    #ifdef ${H}
        ${B} = unpack_mix_${te}(${X}, u_${B}_t);
    #else
        ${B} = unpack_mix_${te}(a_${B}, u_${B}_t);
    #endif
#else
    ${k} ${U} ${B} = u_${B};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${k} ${U} a_${B};
    out ${k} ${U} ${B};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${H})
        in ${k} ${W} a_${B};
    #endif  
#else
uniform ${k} ${U} u_${B};
#endif
`:L==="define-instanced"?te==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${k} ${U} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${W} a_${B};
#else
uniform ${k} ${U} u_${B};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${k} ${U} ${B} = a_${B};
#endif
`:te==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${H}
        ${k} ${U} ${B} = ${X};
    #else
        ${k} ${U} ${B} = a_${B};
    #endif
#else
    ${k} ${U} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${H}
        ${k} ${U} ${B} = unpack_mix_${te}(${X}, u_${B}_t);
    #else
        ${k} ${U} ${B} = unpack_mix_${te}(a_${B}, u_${B}_t);
    #endif
#else
    ${k} ${U} ${B} = u_${B};
#endif
`})),usedDefines:A,vertexIncludes:x,fragmentIncludes:T}}class ph{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,f,y,x,T,A,R){this.context=t;let L=this.boundPaintVertexBuffers.length!==y.length;for(let U=0;!L&&U<y.length;U++)this.boundPaintVertexBuffers[U]!==y[U]&&(L=!0);let k=this.boundDynamicVertexBuffers.length!==A.length;for(let U=0;!k&&U<A.length;U++)this.boundDynamicVertexBuffers[U]!==A[U]&&(k=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==f||L||k||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(o,f,y,x,T,A,R);else{t.bindVertexArrayOES.set(this.vao);for(const U of A)U&&(U.bind(),R&&U.instanceCount&&U.setVertexAttribDivisor(t.gl,o,R));x&&x.dynamicDraw&&x.bind()}}freshBind(t,o,f,y,x,T,A){const R=this.context,L=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T,o.enableAttributes(L,t),o.bind(),o.setVertexAttribPointers(L,t,x);for(const k of f)k.enableAttributes(L,t),k.bind(),k.setVertexAttribPointers(L,t,x);for(const k of T)k&&(k.enableAttributes(L,t),k.bind(),k.setVertexAttribPointers(L,t,x),A&&k.instanceCount&&k.setVertexAttribDivisor(L,t,A));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Sp(d,t){const o=Math.pow(2,t.canonical.z),f=t.canonical.y;return[new s.ae(0,f/o).toLngLat().lat,new s.ae(0,(f+1)/o).toLngLat().lat]}function mh(d,t,o,f,y,x,T){const A=d.context,R=A.gl,L=o.hillshadeFBO;if(!L)return;d.prepareDrawTile();const k=d.isTileAffectedByFog(t),U=d.getOrCreateProgram("hillshade",{overrideFog:k});A.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,L.colorAttachment.get());const B=((te,ee,re,he)=>{const le=re.paint.get("hillshade-shadow-color"),we=re.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=re.paint.get("hillshade-highlight-color"),Ee=re.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ge=re.paint.get("hillshade-accent-color"),me=re.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Se=re.paint.get("hillshade-emissive-strength");let Ve=s.an(re.paint.get("hillshade-illumination-direction"));if(re.paint.get("hillshade-illumination-anchor")==="viewport")Ve-=te.transform.angle;else if(te.style&&te.style.enable3dLights()&&te.style.directionalLight){const st=te.style.directionalLight.properties.get("direction"),Xe=s.d3(st.x,st.y,st.z);Ve=s.an(Xe[1])}const ke=!te.options.moving;return{u_matrix:he||te.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),ke),u_image:0,u_latrange:Sp(0,ee.tileID),u_light:[re.paint.get("hillshade-exaggeration"),Ve],u_shadow:le.toPremultipliedRenderColor(we?null:re.lut),u_highlight:fe.toPremultipliedRenderColor(Ee?null:re.lut),u_emissive_strength:Se,u_accent:ge.toPremultipliedRenderColor(me?null:re.lut)}})(d,o,f,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(A,U,t.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:W,tileBoundsSegments:X}=d.getTileBoundsBuffers(o);U.draw(d,R.TRIANGLES,y,x,T,Li.disabled,B,f.id,H,W,X)}function md(d,t,o){if(!t.needsDEMTextureUpload)return;const f=d.context,y=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(o.stride);const x=o.getPixels();t.demTexture?t.demTexture.update(x,{premultiply:!1}):t.demTexture=new s.T(f,x,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function I_(d,t,o){const f=d.context,y=f.gl;if(!t.dem)return;const x=t.dem;if(f.activeTexture.set(y.TEXTURE1),md(d,t,x),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=x.dim;f.activeTexture.set(y.TEXTURE0);let A=t.hillshadeFBO;if(!A){const B=new s.T(f,{width:T,height:T,data:null},y.RGBA8);B.bind(y.LINEAR,y.CLAMP_TO_EDGE),A=t.hillshadeFBO=f.createFramebuffer(T,T,!0,"renderbuffer"),A.colorAttachment.set(B.texture)}f.bindFramebuffer.set(A.framebuffer),f.viewport.set([0,0,T,T]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:L,tileBoundsSegments:k}=d.getMercatorTileBoundsBuffers(),U=[];d.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(d,y.TRIANGLES,pi.disabled,Ui.disabled,Xi.unblended,Li.disabled,((B,H)=>{const W=H.stride,X=s.bB();return s.cd(X,0,s.al,-s.al,0,0,1),s.bq(X,X,[0,-s.al,0]),{u_matrix:X,u_image:1,u_dimension:[W,W],u_zoom:B.overscaledZ}})(t.tileID,x),o.id,R,L,k),t.needsHillshadePrepare=!1}class Or{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ng extends Or{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ka extends Or{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class gd extends Or{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class _d extends Or{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ap extends Or{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ff extends Or{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ya extends Or{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class _l extends Or{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Hl extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class yc extends Or{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class $l extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class Wl extends Or{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class pf extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class mf extends Or{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Kc extends Or{getDefault(){return s.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class gh extends Or{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class ro extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class os extends Or{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ir extends Or{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let vc=class extends Or{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Qa extends Or{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Au extends Or{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Zl extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class gf extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ip extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Yc extends Or{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Xl extends Or{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Cp extends Or{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class yd extends Or{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Rp extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class yl extends Or{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class vl extends Or{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class Iu extends vl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class xc extends vl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class rg extends vl{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _f extends xc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Cu=(d,t,o)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),_h=(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:o,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:A,u_frustum_br:R,u_frustum_bl:L,u_globe_pos:k,u_globe_radius:U,u_viewport:B,u_grid_matrix:X?Float32Array.from(X):new Float32Array(9),u_skirt_height:H,u_far_z_cutoff:W});function bc(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}const zs=new class{constructor(){this.operations={}}newMorphing(d,t,o,f,y){if(d in this.operations){const x=this.operations[d];x.to.tileID.key!==o.tileID.key&&(x.queued=o)}else this.operations[d]={startTime:f,phase:0,duration:y,from:t,to:o,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const o=this.operations[t];for(o.phase=(d-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},vd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sg(d,t,o){if(t===0)return 0;const f=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*f}function yf(d,t){const o=1<<d.z;return!t&&(d.x===0||d.x===o-1)||d.y===0||d.y===o-1}const yh=d=>({u_matrix:d});function Mp(d,t,o,f,y){if(y>0){const x=s.o.now(),T=(x-d.timeAdded)/y,A=t?(x-t.timeAdded)/y:-1,R=o.getSource(),L=f.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),k=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(d.tileID.overscaledZ-L),U=k&&d.refreshedUponExpiration?1:s.aA(k?T:1-A,0,1);return t?{opacity:1,mix:1-U,isFading:T<1}:{opacity:U,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Yr extends qo{constructor(t){const o=Ys("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class vf extends qo{constructor(t){const o=Ys("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,f){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const A=new eo(T,this._source.tileSize*T.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);A.state="loaded",this._tiles[T.key]=A}return x}),{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const f=Object.values(o);this.renderCachePool.push(...f),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Qc extends s.aP{constructor(t,o,f){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=f}}class Jc extends s.bU{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,y,x]=(function(R){const L=new s.bc,k=new s.b0,U=131;L.reserve(17161),k.reserve(33800);const B=s.al/128,H=s.al+B/2,W=H+B;for(let te=-B;te<W;te+=B)for(let ee=-B;ee<W;ee+=B){const re=ee<0||ee>H||te<0||te>H?24575:0,he=s.aA(Math.round(ee),0,s.al),le=s.aA(Math.round(te),0,s.al);L.emplaceBack(he+re,le)}const X=(te,ee)=>{const re=ee*U+te;k.emplaceBack(re+1,re,re+U),k.emplaceBack(re+U,re+U+1,re+1)};for(let te=1;te<129;te++)for(let ee=1;ee<129;ee++)X(ee,te);return[0,129].forEach((te=>{for(let ee=0;ee<130;ee++)X(ee,te),X(te,ee)})),[L,k,32768]})(),T=t.context;this.gridBuffer=T.createVertexBuffer(f,s.be.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=s.bf.simpleSegment(0,0,f.length,y.length),this.gridNoSkirtSegments=s.bf.simpleSegment(0,0,f.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vf(o.map),this.orthoMatrix=s.bB(),s.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.al,0,s.al,0,1);const A=T.gl;this._overlapStencilMode=new Ui({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Yr(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,o,f){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,x=t.terrain.drapeRenderMode===0,T=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.o.now();const A=t.terrain&&t.terrain.scope,R=y.get("source"),L=x?this._mockSourceCache:t.getSourceCache(R,A);if(!L)return void s.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=L,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(o):y.get("exaggeration"),!o.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&s.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(o,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),o.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const o=this._previousCameraAltitude,f=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=f;const y=o!=null?f-o:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const x=t.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(x);let A=x-this._previousZoom;const R=this._previousUpdateTimestamp;let L=x;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(x-L)>.5&&(A=.5*(x-L+A)),A*y<0&&(L+=A)),this._evaluationZoom=L;const k=T.getExaggeration(L),U=k===T.getExaggeration(Math.max(0,L-.1));if(U&&Math.abs(k-this._exaggeration)<.01)return k;let B=Math.min(.1,.00375*(this._updateTimestamp-R));return(U||k<.1||Math.abs(A)<1e-4)&&(B=Math.min(.2,4*B)),s.ak(this._exaggeration,k,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(s.ae.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=o.getIds().map((R=>{const L=o.getTileByID(R).tileID;return L.projMatrix=f.calculateProjMatrix(L.toUnwrapped()),L}));(function(R,L){const k=L.transform.pointCoordinate(L.transform.getCameraPoint()),U=new s.P(k.x,k.y);R.sort(((B,H)=>{if(H.overscaledZ-B.overscaledZ)return H.overscaledZ-B.overscaledZ;const W=new s.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),X=new s.P(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),te=U.mult(1<<B.canonical.z);return te.x-=.5,te.y-=.5,te.distSqr(W)-te.distSqr(X)}))})(y,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},y.forEach((R=>{this.proxyToSource[R.key]={}})),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const R in T){const L=T[R];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,t[R],x),L.usedForTerrain))continue;const k=t[R];L.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[o.id]=y.map((R=>new Qc(R,R.key,this.orthoMatrix))),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const L=this.terrainTileForTile[R.key];if(!L)continue;const k=L.tileID.key;k in A||(this._visibleDemTiles.push(L),A[k]=k)}}_assignTerrainTiles(t){this._initializing||t.forEach((o=>{if(this.terrainTileForTile[o.key])return;const f=this._findTileCoveringTileID(o,this.sourceCache);f&&(this.terrainTileForTile[o.key]=f)}))}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const f in this.terrainTileForTile){const y=this.terrainTileForTile[f],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),md(this.painter,y,x))}}_prepareDemTileUniforms(t,o,f,y){if(!o||o.demTexture==null)return!1;const x=t.tileID.canonical,T=Math.pow(2,o.tileID.canonical.z-x.z),A=y||"";return f[`u_dem_tl${A}`]=[x.x*T%1,x.y*T%1],f[`u_dem_scale${A}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const o=this._visibleDemTiles.reduce(((f,y)=>{if(!y.dem)return f;const x=y.dem.tree.minimums[0];return x>0&&t++,f+x}),0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const f=this._getLoadedAreaMinimum(),y=new s.dK({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new s.T(t,y,o.R32F,{premultiply:!1}),x}setupElevationDraw(t,o,f){const y=this.painter.context,x=y.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let A=null,R=null,L=1;if(f&&f.morphing&&this._useVertexMorphing){const H=f.morphing.srcDemTile,W=f.morphing.dstDemTile;L=f.morphing.phase,H&&W&&(this._prepareDemTileUniforms(t,H,T,"_prev")&&(R=H),this._prepareDemTileUniforms(t,W,T)&&(A=W))}const k=H=>H&&H.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let U=null;var B;if(this.enabled?R&&A?(U=A.demTexture,y.activeTexture.set(x.TEXTURE4),R.demTexture.bind(k(R),x.CLAMP_TO_EDGE),T.u_dem_lerp=L):(A=this.terrainTileForTile[t.tileID.key],U=this._prepareDemTileUniforms(t,A,T)?A.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,y.activeTexture.set(x.TEXTURE2),U&&(T.u_dem_size=(B=U).size[0]===1?1:B.size[0]-2,U.bind(k(A),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,o,T),f&&f.useMeterToDem&&A){const H=(1<<A.tileID.canonical.z)*s.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=H}if(f&&f.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),o.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,t.tileID.canonical,f&&f.useDenormalizedUpVectorScale);o.setGlobeUniformValues(y,H)}}globeUniformValues(t,o,f){const y=t.projection;return{u_tile_tl_up:y.upVector(o,0,0),u_tile_tr_up:y.upVector(o,s.al,0),u_tile_br_up:y.upVector(o,s.al,s.al),u_tile_bl_up:y.upVector(o,0,s.al),u_tile_up_scale:f?s.dL(1):y.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,f=this.painter.context;t.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,x,T,A,R){if(y.transform.projection.name==="globe")(function(L,k,U,B,H){const W=L.context,X=W.gl;let te,ee;const re=L.transform,he=s.dD(L,W,re),le=(st,Xe)=>{if(ee===Xe)return;const ht=[vd[Xe],"PROJECTION_GLOBE_VIEW"];he&&ht.push("CUSTOM_ANTIALIASING");const zt=L.isTileAffectedByFog(st);te=L.getOrCreateProgram("globeRaster",{defines:ht,overrideFog:zt}),ee=Xe},we=L.colorModeForRenderPass(),fe=new pi(X.LEQUAL,pi.ReadWrite,L.depthRangeFor3D);zs.update(H);const Ee=s.dE(re),ge=[s.aF(re.center.lng),s.aJ(re.center.lat)],me=L.globeSharedBuffers,Se=[re.width*s.o.devicePixelRatio,re.height*s.o.devicePixelRatio],Ve=Float32Array.from(re.globeMatrix),ke={useDenormalizedUpVectorScale:!0};{const st=L.transform,Xe=sg(st.zoom,k.exaggeration(),k.sourceCache._source.tileSize);ee=-1;const ht=X.TRIANGLES;for(const zt of B){const $e=U.getTile(zt),Pe=Ui.disabled,dt=k.prevTerrainTileForTile[zt.key],Ke=k.terrainTileForTile[zt.key];bc(dt,Ke)&&zs.newMorphing(zt.key,dt,Ke,H,250),W.activeTexture.set(X.TEXTURE0),$e.texture&&$e.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const At=zs.getMorphValuesForProxy(zt.key),wt=At?1:0;At&&Object.assign(ke,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:s.dC(At.phase)}});const Ht=s.dF(zt.canonical),mt=s.dG(Ht.getCenter().lat),_t=s.dH(zt.canonical,Ht,mt,st.worldSize/st._pixelsPerMercatorPixel),$t=s.bj(s.dI(zt.canonical)),Jt=_h(st.expandedFarZProjMatrix,Ve,Ee,$t,s.aj(st.zoom),ge,st.frustumCorners.TL,st.frustumCorners.TR,st.frustumCorners.BR,st.frustumCorners.BL,st.globeCenterInViewSpace,st.globeRadius,Se,Xe,st._farZ,_t);if(le(zt,wt),te&&(k.setupElevationDraw($e,te,ke),L.uploadCommonUniforms(W,te,zt.toUnwrapped()),me)){const[Xt,ri,Mi]=me.getGridBuffers(mt,Xe!==0);te.draw(L,ht,fe,Pe,we,Li.backCCW,Jt,"globe_raster",Xt,ri,Mi)}}}if(me&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const st=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];he&&st.push("CUSTOM_ANTIALIASING"),te=L.getOrCreateProgram("globeRaster",{defines:st});for(const Xe of B){const{x:ht,y:zt,z:$e}=Xe.canonical,Pe=zt===0,dt=zt===(1<<$e)-1,[Ke,At,wt,Ht]=me.getPoleBuffers($e,!1);if(Ht&&(Pe||dt)){const mt=U.getTile(Xe);W.activeTexture.set(X.TEXTURE0),mt.texture&&mt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let _t=s.dJ($e,ht,re);const $t=s.bj(s.dI(Xe.canonical)),Jt=(Xt,ri)=>Xt.draw(L,X.TRIANGLES,fe,Ui.disabled,we,Li.disabled,_h(re.expandedFarZProjMatrix,_t,_t,$t,0,ge,re.frustumCorners.TL,re.frustumCorners.TR,re.frustumCorners.BR,re.frustumCorners.BL,re.globeCenterInViewSpace,re.globeRadius,Se,0,re._farZ),"globe_pole_raster",ri,wt,Ht);k.setupElevationDraw(mt,te,ke),L.uploadCommonUniforms(W,te,Xe.toUnwrapped()),Pe&&L.renderDefaultNorthPole&&Jt(te,Ke),dt&&L.renderDefaultSouthPole&&(_t=s.cR(s.bB(),_t,[1,-1,1]),Jt(te,At))}}}})(y,x,T,A,R);else{const L=y.context,k=L.gl;let U,B;const H=y.shadowRenderer,W=Ka(y,y.longestCutoffRange),X=we=>{if(B===we)return;const fe=[];fe.push(vd[we]),W.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),H&&(fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&fe.push("NORMAL_OFFSET")),U=y.getOrCreateProgram("terrainRaster",{defines:fe}),B=we},te=y.colorModeForRenderPass(),ee=new pi(k.LEQUAL,pi.ReadWrite,y.depthRangeFor3D);zs.update(R);const re=y.transform,he=sg(re.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let le=[0,0,0];if(H){const we=y.style.directionalLight,fe=y.style.ambientLight;we&&fe&&(le=Wo(y.style,we,fe))}{B=-1;const we=k.TRIANGLES,[fe,Ee]=[x.gridIndexBuffer,x.gridSegments];for(const ge of A){const me=T.getTile(ge),Se=Ui.disabled,Ve=x.prevTerrainTileForTile[ge.key],ke=x.terrainTileForTile[ge.key];bc(Ve,ke)&&zs.newMorphing(ge.key,Ve,ke,R,250),L.activeTexture.set(k.TEXTURE0),me.texture&&me.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const st=zs.getMorphValuesForProxy(ge.key),Xe=st?1:0;let ht;st&&(ht={morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:s.dC(st.phase)}});const zt=Cu(ge.projMatrix,yf(ge.canonical,re.renderWorldCopies)?he/10:he,le);if(X(Xe),!U)continue;x.setupElevationDraw(me,U,ht);const $e=ge.toUnwrapped();H&&H.setupShadows($e,U),y.uploadCommonUniforms(L,U,$e,null,W),U.draw(y,we,ee,Se,te,Li.backCCW,zt,"terrain_raster",x.gridBuffer,fe,Ee)}}}})(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,f=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),A=o.style.order,R=[];let L=0;for(const k of x){const U=y.getTileByID(k.proxyTileKey),B=y.proxyCachedFBO[k.key]?y.proxyCachedFBO[k.key][t]:void 0,H=B!==void 0?y.renderCache[B]:this.pool[L++],W=B!==void 0;if(U.texture=H.tex,W&&!H.dirty){R.push(U.tileID);continue}let X;f.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(f.clear({color:s.ao.transparent,stencil:0}),H.dirty=!1);for(let te=T.start;te<=T.end;++te){const ee=o.style._mergedLayers[A[te]];if(ee.isHidden(o.transform.zoom))continue;const re=o.style.getLayerSourceCache(ee),he=re?this.proxyToSource[k.key][re.id]:[k];if(!he)continue;const le=he;f.viewport.set([0,0,H.fb.width,H.fb.height]),X!==(re?re.id:null)&&(this._setupStencil(H,he,ee,re),X=re?re.id:null),o.renderLayer(o,re,ee,le)}if(this._drapedRenderBatches.length===0)for(const te of this._pendingGroundEffectLayers){const ee=o.style._mergedLayers[A[te]];if(ee.isHidden(o.transform.zoom))continue;const re=o.style.getLayerSourceCache(ee),he=re?this.proxyToSource[k.key][re.id]:[k];if(!he)continue;const le=he;f.viewport.set([0,0,H.fb.width,H.fb.height]),X!==(re?re.id:null)&&(this._setupStencil(H,he,ee,re),X=re?re.id:null),o.renderLayer(o,re,ee,le)}this.renderedToTile?(H.dirty=!0,R.push(U.tileID)):W||--L,L===5&&(L=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,o.width,o.height]),T.end+1}postRender(){}isLayerOrderingCorrect(t){const o=t.order.length;let f=-1,y=o;for(let x=0;x<o;++x)this._style.isLayerDraped(t._mergedLayers[t.order[x]])?f=Math.max(f,x):y=Math.min(y,x);return y>f}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((o=>o.dem)).forEach((o=>{t=Math.min(t,o.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,o,f){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter((x=>x.dem)).map((x=>{const T=x.tileID,A=1<<T.overscaledZ,{x:R,y:L}=T.canonical,k=R/A,U=(R+1)/A,B=L/A,H=(L+1)/A;return{minx:k,miny:B,maxx:U,maxy:H,t:x.dem.tree.raycastRoot(k,B,U,H,t,o,f),tile:x}}));y.sort(((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE)));for(const x of y){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,t,o,f);if(T!=null)return T}return null}_createFBO(){const t=this.painter.context,o=t.gl,f=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const y=new s.T(t,{width:f[0],height:f[1],data:null},o.RGBA8);y.bind(o.LINEAR,o.CLAMP_TO_EDGE);const x=t.createFramebuffer(f[0],f[1],!0,null);return x.colorAttachment.set(y.texture),x.depthAttachment=new _f(t,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const o=this._style._mergedLayers[t],f=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!f&&o.shouldRedrape():!f&&o.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const f of this._style.getSources())if(f instanceof er){t=!0;break}if(!t)return;const o={};for(let f=0;f<this._style.order.length;++f){const y=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(y);if(x&&!o[x.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof s.ad){o[x.id]=!0;for(const T of this.proxyCoords){const A=this.proxyToSource[T.key][x.id];if(A)for(const R of A)this._clearRenderCacheForTile(x.id,R)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof Ro){t=!0;break}if(!t)return;const o={};for(let f=0;f<this._style.order.length;++f){const y=this._style._mergedLayers[this._style.order[f]],x=this._style.getLayerSourceCache(y);if(!x||o[x.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const R=this.proxyToSource[A.key][x.id];if(R)for(const L of R){const k=Mp(x.getTile(L),x.findLoadedParent(L,0),x,this.painter.transform,T);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(x.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,o=t.length;if(o===0)return;const f=[];this._pendingGroundEffectLayers=[];let y,x=0,T=this._style._mergedLayers[t[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<o;)T=this._style._mergedLayers[t[x]];for(;x<o;++x){const A=this._style._mergedLayers[t[x]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?y===void 0&&(y=x):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),y!==void 0&&(f.push({start:y,end:x-1}),y=void 0)))}if(y!==void 0&&f.push({start:y,end:x-1}),f.length!==0){const A=f[f.length-1];this._pendingGroundEffectLayers.every((R=>R>A.end))||s.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const T=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let A=0;A<T.length;++A){const R=Object.values(T[A]);o.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,y=this._tilesDirty;for(let T=f.length-1;T>=0;T--){const A=f[T];if(o.getTileByID(A.key),o.proxyCachedFBO[A.key]!==void 0){const R=t[A.key],L=this.proxyToSource[A.key];let k=0;for(const U in L){const B=L[U],H=R[U];if(!H||H.length!==B.length||B.some(((W,X)=>W!==H[X]||y[U]&&y[U].hasOwnProperty(W.key)))){k=-1;break}++k}for(const U in o.proxyCachedFBO[A.key])o.renderCache[o.proxyCachedFBO[A.key][U]].dirty=k<0||k!==Object.values(R).length}}const x=[...this._drapedRenderBatches];x.sort(((T,A)=>A.end-A.start-(T.end-T.start)));for(const T of x)for(const A of f){if(o.proxyCachedFBO[A.key])continue;let R=o.renderCachePool.pop();R===void 0&&o.renderCache.length<50&&(R=o.renderCache.length,o.renderCache.push(this._createFBO())),R!==void 0&&(o.proxyCachedFBO[A.key]={},o.proxyCachedFBO[A.key][T.start]=R,o.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,f,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let A;if(f.isTileClipped())A=o.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ui.disabled}_renderTileClippingMasks(t,o){const f=this.painter,y=this.painter.context,x=y.gl;f._tileClippingMaskIDs={},y.setColorMode(Xi.disabled),y.setDepthMode(pi.disabled);const T=f.getOrCreateProgram("clippingMask");for(const A of t){const R=f._tileClippingMaskIDs[A.key]=--o;T.draw(f,x.TRIANGLES,pi.disabled,new Ui({func:x.ALWAYS,mask:0},R,255,x.KEEP,x.KEEP,x.REPLACE),Xi.disabled,Li.disabled,yh(A.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const f=[t.x,t.y,1,1];s.aC(f,f,o.pixelMatrixInverse),s.cJ(f,f,1/f[3]),f[0]/=o.worldSize,f[1]/=o.worldSize;const y=o._camera.position,x=s.ce(1,o.center.lat),T=[y[0],y[1],y[2]/x,0],A=s.d9([],f.slice(0,3),T);s.aw(A,A);const R=this.raycast(T,A,this._exaggeration);return R!==null&&R?(s.bG(T,T,A,R),T[3]=T[2],T[2]*=x,T):null}_setupProxiedCoordsForOrtho(t,o,f){if(t.getSource()instanceof s.aT)return this._setupProxiedCoordsForImageSource(t,o,f);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],x=this.proxyCoords;for(let R=0;R<x.length;R++){const L=x[R],k=this._findTileCoveringTileID(L,t);if(k){const U=this._createProxiedId(L,k,f[L.key]&&f[L.key][t.id]);y.push(U),this.proxyToSource[L.key][t.id]=[U]}}let T=!1;const A=new Set;for(let R=0;R<o.length;R++){const L=t.getTile(o[R]);if(!L||!L.hasData())continue;const k=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==L.tileID.canonical.z){const U=this.proxyToSource[k.tileID.key][t.id],B=this._createProxiedId(k.tileID,L,f[k.tileID.key]&&f[k.tileID.key][t.id]);U?U.splice(U.length-1,0,B):this.proxyToSource[k.tileID.key][t.id]=[B];const H=this.proxyToSource[k.tileID.key][t.id];A.has(H)||A.add(H),y.push(B),T=!0}}if(this._sourceTilesOverlap[t.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const R of A)R.sort(((L,k)=>k.overscaledZ-L.overscaledZ))}_setupProxiedCoordsForImageSource(t,o,f){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],x=this.proxyCoords,T=t.getSource(),A=T.tileID;if(!A)return;const R=new s.P(A.x,A.y)._div(1<<A.z),L=T.coordinates.map(s.ae.fromLngLat).reduce(((U,B)=>(U.min.x=Math.min(U.min.x,B.x-R.x),U.min.y=Math.min(U.min.y,B.y-R.y),U.max.x=Math.max(U.max.x,B.x-R.x),U.max.y=Math.max(U.max.y,B.y-R.y),U)),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(U,B)=>{const H=U.wrap+U.canonical.x/(1<<U.canonical.z),W=U.canonical.y/(1<<U.canonical.z),X=s.al/(1<<U.canonical.z),te=B.wrap+B.canonical.x/(1<<B.canonical.z),ee=B.canonical.y/(1<<B.canonical.z);return H+X<te+L.min.x||H>te+L.max.x||W+X<ee+L.min.y||W>ee+L.max.y};for(let U=0;U<x.length;U++){const B=x[U];for(let H=0;H<o.length;H++){const W=t.getTile(o[H]);if(!W||!W.hasData()||k(B,W.tileID))continue;const X=this._createProxiedId(B,W,f[B.key]&&f[B.key][t.id]),te=this.proxyToSource[B.key][t.id];te?te.push(X):this.proxyToSource[B.key][t.id]=[X],y.push(X)}}}_createProxiedId(t,o,f){let y=this.orthoMatrix;if(f){const x=f.find((T=>T.key===o.tileID.key));if(x)return x}if(o.tileID.key!==t.key){const x=t.canonical.z-o.tileID.canonical.z;let T,A,R;y=s.bB();const L=o.tileID.wrap-t.wrap<<t.overscaledZ;x>0?(T=s.al>>x,A=T*((o.tileID.canonical.x<<x)-t.canonical.x+L),R=T*((o.tileID.canonical.y<<x)-t.canonical.y)):(T=s.al<<-x,A=s.al*(o.tileID.canonical.x-(t.canonical.x+L<<-x)),R=s.al*(o.tileID.canonical.y-(t.canonical.y<<-x))),s.cd(y,0,T,0,T,0,1),s.bq(y,y,[A,R,0])}return new Qc(o.tileID,t.key,y)}_findTileCoveringTileID(t,o){let f=o.getTile(t);if(f&&f.hasData())return f;const y=this._findCoveringTileCache[o.id],x=y[t.key];if(f=x?o.getTileByID(x):null,f&&f.hasData()||x===null)return f;let T=f?f.tileID:t,A=T.overscaledZ;const R=o.getSource().minzoom,L=[];if(!x){const U=o.getSource().maxzoom;if(t.canonical.z>=U){const B=t.canonical.z-U;o.getSource().reparseOverscaled?(A=Math.max(t.canonical.z+2,o.transform.tileZoom),T=new s.aP(A,t.wrap,U,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(A=U,T=new s.aP(A,t.wrap,U,t.canonical.x>>B,t.canonical.y>>B))}T.key!==t.key&&(L.push(T.key),f=o.getTile(T))}const k=U=>{L.forEach((B=>{y[B]=U})),L.length=0};for(A-=1;A>=R&&(!f||!f.hasData());A--){f&&k(f.tileID.key);const U=T.calculateScaledKey(A);if(f=o.getTileByID(U),f&&f.hasData())break;const B=y[U];if(B===null)break;B===void 0?L.push(U):f=o.getTileByID(B)}return k(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let f=this._tilesDirty[t];f||(f=this._tilesDirty[t]={}),f[o.key]=!0}}function xf(d,t,o){const f=(function(A,R,L){const k=s.bI(R,A),U=s.bI(L,[.2126,.7152,.0722]),B=(W,X,te)=>(1-te)*W+te*X,H=B(1-.3*Math.min(U,1),1,Math.min(k+1,1));return B(.92,1,Math.asin(s.aA(R[2],-1,1))/Math.PI+.5)*H})(d,[0,0,1],t),y=[0,0,0];s.c4(y,o.slice(0,3),f);const x=[0,0,0];s.c4(x,t.slice(0,3),d[2]);const T=[0,0,0];return s.d7(T,y,x),s.da(T)}const Ru=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Mu=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class bf{static cacheKey(t,o,f,y){let x=`${o}${y?y.cacheKey:""}`;for(const T of f)t.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(t,o,f,y,x,T){const A=t.gl;this.program=A.createProgram(),this.configuration=y,this.name=o,this.fixedDefines=[...T];let R=y?y.defines():[];R=R.concat(T.map((W=>`#define ${W}`)));const L=`#version 300 es
`;let k=L+R.concat("precision mediump float;",_c,gc.fragmentSource).join(`
`);for(const W of f.fragmentIncludes)k+=`
${fh[W]}`;k+=`
${f.fragmentSource}`;let U=L+R.concat("precision highp float;",_c,gc.vertexSource).join(`
`);for(const W of f.vertexIncludes)U+=`
${fh[W]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(U+=`
uniform int u_instanceID;
`),U+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(U=U.replaceAll("gl_InstanceID","u_instanceID"));const B=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(B,k),A.compileShader(B),A.attachShader(this.program,B);const H=A.createShader(A.VERTEX_SHADER);A.isContextLost()?this.failedToCreate=!0:(A.shaderSource(H,U),A.compileShader(H),A.attachShader(this.program,H),this.attributes={},A.linkProgram(this.program),A.deleteShader(H),A.deleteShader(B),this.fixedUniforms=x(t),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(W=>({u_instanceID:new s.cg(W)}))(t)),(T.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(W=>({u_dem:new s.cg(W),u_dem_prev:new s.cg(W),u_dem_tl:new s.cj(W),u_dem_scale:new s.ci(W),u_dem_tl_prev:new s.cj(W),u_dem_scale_prev:new s.ci(W),u_dem_size:new s.ci(W),u_dem_lerp:new s.ci(W),u_exaggeration:new s.ci(W),u_depth:new s.cg(W),u_depth_size_inv:new s.cj(W),u_depth_range_unpack:new s.cj(W),u_occluder_half_size:new s.ci(W),u_occlusion_depth_offset:new s.ci(W),u_meter_to_dem:new s.ci(W),u_label_plane_matrix_inv:new s.ck(W)}))(t)),T.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new s.ch(W),u_tile_tr_up:new s.ch(W),u_tile_br_up:new s.ch(W),u_tile_bl_up:new s.ch(W),u_tile_up_scale:new s.ci(W)}))(t)),T.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new s.ck(W),u_fog_range:new s.cj(W),u_fog_color:new s.d2(W),u_fog_horizon_blend:new s.ci(W),u_fog_vertical_limit:new s.cj(W),u_fog_temporal_offset:new s.ci(W),u_frustum_tl:new s.ch(W),u_frustum_tr:new s.ch(W),u_frustum_br:new s.ch(W),u_frustum_bl:new s.ch(W),u_globe_pos:new s.ch(W),u_globe_radius:new s.ci(W),u_globe_transition:new s.ci(W),u_is_globe:new s.cg(W),u_viewport:new s.cj(W)}))(t)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(W=>({u_cutoff_params:new s.d2(W)}))(t)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(W=>({u_lighting_ambient_color:new s.ch(W),u_lighting_directional_dir:new s.ch(W),u_lighting_directional_color:new s.ch(W),u_ground_radiance:new s.ch(W)}))(t)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(W=>({u_light_matrix_0:new s.ck(W),u_light_matrix_1:new s.ck(W),u_fade_range:new s.cj(W),u_shadow_normal_offset:new s.ch(W),u_shadow_intensity:new s.ci(W),u_shadow_texel_size:new s.ci(W),u_shadow_map_resolution:new s.ci(W),u_shadow_direction:new s.ch(W),u_shadow_bias:new s.ch(W),u_shadowmap_0:new s.cg(W),u_shadowmap_1:new s.cg(W)}))(t)))}getAttributeLocation(t,o){let f=this.attributes[o];return f===void 0&&(f=this.attributes[o]=t.getAttribLocation(this.program,o)),f}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)f[y]&&f[y].set(this.program,y,o[y])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)f[y]&&f[y].set(this.program,y,o[y])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)f[y].set(this.program,y,o[y])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)f[y].set(this.program,y,o[y])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)f[y].set(this.program,y,o[y])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;t.program.set(this.program);for(const y in o)f[y].set(this.program,y,o[y])}_drawDebugWireframe(t,o,f,y,x,T,A,R,L,k){const U=t.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const B=t.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ru.includes(this.name))||!(!U.layers3D||!Mu.includes(this.name))))return;const H=B.gl,W=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,x,B);if(!W)return;const X=[...this.fixedDefines];X.push("DEBUG_WIREFRAME");const te=t.getOrCreateProgram(this.name,{config:this.configuration,defines:X});B.program.set(te.program);const ee=(le,we,fe)=>{if(we[le]&&fe[le])for(const Ee in we[le])fe[le][Ee]&&fe[le][Ee].set(fe.program,Ee,we[le][Ee].current)};L&&L.setUniforms(te.program,B,te.binderUniforms,A,{zoom:R}),ee("fixedUniforms",this,te),ee("terrainUniforms",this,te),ee("globeUniforms",this,te),ee("fogUniforms",this,te),ee("lightsUniforms",this,te),ee("shadowUniforms",this,te),W.bind(),B.setColorMode(new Xi([H.ONE,H.ONE_MINUS_SRC_ALPHA,H.ZERO,H.ONE],s.ao.transparent,[!0,!0,!0,!1])),B.setDepthMode(new pi(o.func===H.LESS?H.LEQUAL:o.func,pi.ReadOnly,o.range)),B.setStencilMode(Ui.disabled);const re=3*T.primitiveLength*2,he=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const le=k||1;for(let we=0;we<le;++we)te.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,he)}else k&&k>1?H.drawElementsInstanced(H.LINES,re,H.UNSIGNED_SHORT,he,k):H.drawElements(H.LINES,re,H.UNSIGNED_SHORT,he);x.bind(),B.program.set(this.program),B.setDepthMode(o),B.setStencilMode(f),B.setColorMode(y)}checkUniforms(t,o,f){if(this.fixedDefines.includes(o)){for(const y of Object.keys(f))if(!f[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${o} being defined`)}}draw(t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te){const ee=t.context,re=ee.gl;if(this.failedToCreate)return;ee.program.set(this.program),ee.setDepthMode(f),ee.setStencilMode(y),ee.setColorMode(x),ee.setCullFace(T);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,A[we]);W&&W.setUniforms(this.program,ee,this.binderUniforms,B,{zoom:H});const he={[re.POINTS]:1,[re.LINES]:2,[re.TRIANGLES]:3,[re.LINE_STRIP]:1}[o];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const le=te&&te>0?1:void 0;for(const we of U.get()){const fe=we.vaos||(we.vaos={});if((fe[R]||(fe[R]=new ph)).bind(ee,this,L,W?W.getPaintVertexBuffers():[],k,we.vertexOffset,X||[],le),this.forceManualRenderingForInstanceIDShaders){const Ee=te||1;for(let ge=0;ge<Ee;++ge)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),k?re.drawElements(o,we.primitiveLength*he,re.UNSIGNED_SHORT,we.primitiveOffset*he*2):re.drawArrays(o,we.vertexOffset,we.vertexLength)}else te&&te>1?re.drawElementsInstanced(o,we.primitiveLength*he,re.UNSIGNED_SHORT,we.primitiveOffset*he*2,te):k?re.drawElements(o,we.primitiveLength*he,re.UNSIGNED_SHORT,we.primitiveOffset*he*2):re.drawArrays(o,we.vertexOffset,we.vertexLength);o===re.TRIANGLES&&k&&this._drawDebugWireframe(t,f,y,x,k,we,B,H,W,te)}}}function wf(d,t,o=0){const f=Math.pow(2,t.tileID.overscaledZ),y=t.tileSize*Math.pow(2,d.transform.tileZoom)/f,x=y*(t.tileID.canonical.x+t.tileID.wrap*f),T=y*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(t,1,d.transform.tileZoom),u_pixel_coord_upper:[x>>16,T>>16],u_pixel_coord_lower:[65535&x,65535&T],u_pattern_transition:o}}const xd={terrain:0,flat:1},Tf=s.bB(),wc=(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee)=>{const re=t.style.light,he=re.properties.get("position"),le=[he.x,he.y,he.z],we=s.dN();re.properties.get("anchor")==="viewport"&&(s.dO(we,-t.transform.angle),s.dP(le,le,we));const fe=re.properties.get("color").toPremultipliedRenderColor(null),Ee=t.transform,ge={u_matrix:d,u_lightpos:le,u_lightintensity:re.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+o,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Tf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:xd[L],u_base_type:xd[k],u_ao:y,u_edge_radius:x,u_width_scale:T,u_flood_light_color:W,u_vertical_scale:X,u_flood_light_intensity:te,u_ground_shadow_factor:ee};return Ee.projection.name==="globe"&&(ge.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],ge.u_zoom_transition=U,ge.u_inv_rot_matrix=H,ge.u_merc_center=B,ge.u_up_dir=Ee.projection.upVector(new s.cC(0,0,0),B[0]*s.al,B[1]*s.al),ge.u_height_lift=R),ge},Dp=(d,t,o,f,y,x)=>({u_matrix:d,u_edge_radius:t,u_width_scale:o,u_vertical_scale:f,u_height_type:xd[y],u_base_type:xd[x]}),Ef=(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee)=>{const re=wc(d,t,o,f,y,x,T,A,L,k,U,B,H,W,X,te,1,[0,0,0]),he={u_height_factor:-Math.pow(2,A.overscaledZ)/R.tileSize/8};return Object.assign(re,wf(t,R,ee),he)},vh=(d,t,o,f,y,x,T,A,R,L,k)=>({u_matrix:t,u_opacity:o,u_ao_pass:f?1:0,u_meter_to_tile:y,u_ao:x,u_flood_light_intensity:T,u_flood_light_color:A,u_attenuation:R,u_edge_radius:L,u_fb:0,u_fb_size:k,u_dynamic_offset:1}),xh=(d,t,o)=>({u_matrix:d,u_emissive_strength:t,u_ground_shadow_factor:o}),Pp=(d,t,o,f,y,x=0)=>Object.assign(xh(d,t,y),wf(o,f,x)),Op=(d,t,o,f)=>({u_matrix:d,u_world:o,u_emissive_strength:t,u_ground_shadow_factor:f}),Lp=(d,t,o,f,y,x,T=0)=>Object.assign(Pp(d,t,o,f,x,T),{u_world:y}),C_=(d,t)=>({u_matrix:d,u_ground_shadow_factor:t}),Sf=(d,t,o,f,y)=>({u_matrix:d,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:o,u_height_scale:f,u_reset_depth:y}),eu=(d,t,o,f,y,x,T,A,R)=>({u_matrix:d,u_normal_matrix:t,u_opacity:o,u_faux_facade_ao_intensity:f,u_camera_pos:y,u_tile_to_meter:x,u_facade_emissive_chance:T,u_flood_light_color:A,u_flood_light_intensity:R}),tu=d=>({u_matrix:d}),og=d=>({u_matrix:d}),bh=(d,t,o,f,y,x,T,A)=>{const R=s.al/x.tileSize;return{u_matrix:d,u_inv_rot_matrix:t,u_camera_to_center_distance:o.getCameraToCenterDistance(A),u_extrude_scale:[o.pixelsToGLUnits[0]/R,o.pixelsToGLUnits[1]/R],u_zoom_transition:f,u_tile_id:T,u_merc_center:y}},Du=(d,t,o=1)=>({u_matrix:d,u_color:t,u_overlay:0,u_overlay_scale:o}),bd=s.bB(),Af=(d,t,o,f,y,x,T)=>{const A=d.transform,R=A.projection.name==="globe",L=R?s.dQ(A.zoom,t.canonical)*A._pixelsPerMercatorPixel:s.ay(o,1,x),k={u_matrix:t.projMatrix,u_extrude_scale:L,u_intensity:T,u_inv_rot_matrix:bd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){k.u_inv_rot_matrix=f,k.u_merc_center=y,k.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],k.u_zoom_transition=s.aj(A.zoom);const U=y[0]*s.al,B=y[1]*s.al;k.u_up_dir=A.projection.upVector(new s.cC(0,0,0),U,B)}return k};function Pu(d,[t,o,f,y],[x,T]){if(x===T)return[0,0,0,0];const A=255*(d-1)/(d*(T-x));return[t*A,o*A,f*A,y*A]}function xl(d,t,[o,f]){return o===f?0:.5/d+(t-o)*(d-1)/(d*(f-o))}const wd=(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee,re,he,le)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:L,u_fade_t:k.mix,u_opacity:k.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:s.dS(U.paint.get("raster-saturation")),u_contrast_factor:s.dR(U.paint.get("raster-contrast")),u_spin_weights:Tc(U.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:H,u_zoom_transition:T,u_merc_center:A,u_cutoff_params:R,u_colorization_mix:Pu(s.dT,X,ee),u_colorization_offset:xl(s.dT,te,ee),u_color_ramp:W,u_texture_offset:[he/(re+2*he),re/(re+2*he)],u_texture_res:[re+2*he,re+2*he],u_emissive_strength:le});function Tc(d){d*=Math.PI/180;const t=Math.sin(d),o=Math.cos(d);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Ou=.05,Ea=(d,t,o,f,y,x,T,A,R,L,k,U)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:f,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:L,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:T,u_merc_center:A,u_cutoff_params:R}),If=(d,t,o,f,y,x,T,A,R,L)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:f,u_color_ramp:x,u_velocity_res:y,u_max_speed:T,u_uv_offset:A,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ou,Ou]}),Td=(d,t,o,f,y,x,T,A,R,L)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:f,u_max_speed:y,u_speed_factor:x,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*R[0],255*R[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ou,Ou]}),Ec=s.bB(),Sc=(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee,re,he,le,we,fe,Ee)=>{const ge=y.transform,me={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:ge.getCameraToCenterDistance(re),u_rotate_symbol:+o,u_aspect_ratio:ge.width/ge.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:A,u_is_text:+L,u_elevation_from_sea:R?1:0,u_pitch_with_map:+f,u_texsize:k,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ec,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Ec,u_up_vector:[0,-1,0],u_color_adj_mat:we,u_icon_transition:fe||0,u_gamma_scale:f?y.transform.getCameraToCenterDistance(re)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:s.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ee||1,u_ground_shadow_factor:he,u_inv_matrix:s.bk(s.bB(),T),u_normal_scale:le,u_lutTexture:po.LUT};return re.name==="globe"&&(me.u_tile_id=[H.canonical.x,H.canonical.y,1<<H.canonical.z],me.u_zoom_transition=W,me.u_inv_rot_matrix=te,me.u_merc_center=X,me.u_camera_forward=ge._camera.forward(),me.u_ecef_origin=s.dU(ge.globeMatrix,H.toUnwrapped()),me.u_tile_matrix=Float32Array.from(ge.globeMatrix),me.u_up_vector=ee),me},Lu=(d,t,o,f)=>({u_matrix:d,u_emissive_strength:t,u_opacity:o,u_color:f}),Ed=(d,t,o,f,y,x,T,A,R)=>Object.assign((function(L,k,U,B,H,W){const{width:X,height:te}=B.imageManager.getPixelSize(k),ee=Math.pow(2,W.tileID.overscaledZ),re=W.tileSize*Math.pow(2,B.transform.tileZoom)/ee,he=re*(W.tileID.canonical.x+W.tileID.wrap*ee),le=re*W.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[X,te],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:H?[B.transform.width,-1*B.transform.height]:[1/s.ay(W,1,B.transform.tileZoom),1/s.ay(W,1,B.transform.tileZoom)],u_pixel_coord_upper:[he>>16,le>>16],u_pixel_coord_lower:[65535&he,65535&le]}})(0,x,T,f,A,R),{u_matrix:d,u_emissive_strength:t,u_opacity:o}),Cf=new Float32Array(s.bz([])),zu=(d,t,o,f,y,x,T,A,R,L,k,U,B,H=[0,0,0],W,X,te)=>{const ee=y.style.light,re=ee.properties.get("position"),he=[-re.x,-re.y,re.z],le=s.dN();ee.properties.get("anchor")==="viewport"&&(s.dO(le,-y.transform.angle),s.dP(he,he,le));const we=k.alphaMode==="MASK",fe=ee.properties.get("color").toNonPremultipliedRenderColor(null),Ee=B.paint.get("model-ambient-occlusion-intensity"),ge=B.paint.get("model-color").constantOr(s.ao.white).toNonPremultipliedRenderColor(null);return ge.a=B.paint.get("model-color-mix-intensity").constantOr(0),te&&(ge.r=te[0],ge.g=te[1],ge.b=te[2],ge.a=te[3]),X&&(ge.r=X.color.r,ge.g=X.color.g,ge.b=X.color.b,ge.a=X.colorMix,U=X.emissionStrength,x=X.opacity),{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:f||Cf,u_lightpos:he,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:H,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+we,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:A.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:L,u_baseColorTexture:po.BaseColor,u_metallicRoughnessTexture:po.MetallicRoughness,u_normalTexture:po.Normal,u_occlusionTexture:po.Occlusion,u_emissionTexture:po.Emission,u_lutTexture:po.LUT,u_color_mix:ge.toArray01(),u_aoIntensity:Ee,u_emissive_strength:U,u_occlusionTextureTransform:W||[0,0,0,0]}},Ac=(d,t=Cf,o=Cf)=>({u_matrix:d,u_instance:t,u_node_matrix:o}),R_={fillExtrusion:d=>({u_matrix:new s.ck(d),u_lightpos:new s.ch(d),u_lightintensity:new s.ci(d),u_lightcolor:new s.ch(d),u_vertical_gradient:new s.ci(d),u_opacity:new s.ci(d),u_edge_radius:new s.ci(d),u_width_scale:new s.ci(d),u_ao:new s.cj(d),u_height_type:new s.cg(d),u_base_type:new s.cg(d),u_tile_id:new s.ch(d),u_zoom_transition:new s.ci(d),u_inv_rot_matrix:new s.ck(d),u_merc_center:new s.cj(d),u_up_dir:new s.ch(d),u_height_lift:new s.ci(d),u_flood_light_color:new s.ch(d),u_vertical_scale:new s.ci(d),u_flood_light_intensity:new s.ci(d),u_ground_shadow_factor:new s.ch(d)}),fillExtrusionDepth:d=>({u_matrix:new s.ck(d),u_edge_radius:new s.ci(d),u_width_scale:new s.ci(d),u_vertical_scale:new s.ci(d),u_height_type:new s.cg(d),u_base_type:new s.cg(d)}),fillExtrusionPattern:d=>({u_matrix:new s.ck(d),u_lightpos:new s.ch(d),u_lightintensity:new s.ci(d),u_lightcolor:new s.ch(d),u_vertical_gradient:new s.ci(d),u_height_factor:new s.ci(d),u_edge_radius:new s.ci(d),u_width_scale:new s.ci(d),u_ao:new s.cj(d),u_height_type:new s.cg(d),u_base_type:new s.cg(d),u_tile_id:new s.ch(d),u_zoom_transition:new s.ci(d),u_inv_rot_matrix:new s.ck(d),u_merc_center:new s.cj(d),u_up_dir:new s.ch(d),u_height_lift:new s.ci(d),u_image:new s.cg(d),u_texsize:new s.cj(d),u_pixel_coord_upper:new s.cj(d),u_pixel_coord_lower:new s.cj(d),u_tile_units_to_pixels:new s.ci(d),u_opacity:new s.ci(d),u_pattern_transition:new s.ci(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new s.ck(d),u_opacity:new s.ci(d),u_ao_pass:new s.ci(d),u_meter_to_tile:new s.ci(d),u_ao:new s.cj(d),u_flood_light_intensity:new s.ci(d),u_flood_light_color:new s.ch(d),u_attenuation:new s.ci(d),u_edge_radius:new s.ci(d),u_fb:new s.cg(d),u_fb_size:new s.ci(d),u_dynamic_offset:new s.ci(d)}),fill:d=>({u_matrix:new s.ck(d),u_emissive_strength:new s.ci(d),u_ground_shadow_factor:new s.ch(d)}),fillPattern:d=>({u_matrix:new s.ck(d),u_emissive_strength:new s.ci(d),u_image:new s.cg(d),u_texsize:new s.cj(d),u_pixel_coord_upper:new s.cj(d),u_pixel_coord_lower:new s.cj(d),u_tile_units_to_pixels:new s.ci(d),u_ground_shadow_factor:new s.ch(d),u_pattern_transition:new s.ci(d)}),fillOutline:d=>({u_matrix:new s.ck(d),u_emissive_strength:new s.ci(d),u_world:new s.cj(d),u_ground_shadow_factor:new s.ch(d)}),fillOutlinePattern:d=>({u_matrix:new s.ck(d),u_emissive_strength:new s.ci(d),u_world:new s.cj(d),u_image:new s.cg(d),u_texsize:new s.cj(d),u_pixel_coord_upper:new s.cj(d),u_pixel_coord_lower:new s.cj(d),u_tile_units_to_pixels:new s.ci(d),u_ground_shadow_factor:new s.ch(d),u_pattern_transition:new s.ci(d)}),building:d=>({u_matrix:new s.ck(d),u_normal_matrix:new s.ck(d),u_opacity:new s.ci(d),u_faux_facade_ao_intensity:new s.ci(d),u_camera_pos:new s.ch(d),u_tile_to_meter:new s.ci(d),u_facade_emissive_chance:new s.ci(d),u_flood_light_color:new s.ch(d),u_flood_light_intensity:new s.ci(d)}),buildingBloom:d=>({u_matrix:new s.ck(d)}),buildingDepth:d=>({u_matrix:new s.ck(d)}),elevatedStructuresDepth:d=>({u_matrix:new s.ck(d),u_depth_bias:new s.ci(d)}),elevatedStructures:d=>({u_matrix:new s.ck(d),u_ground_shadow_factor:new s.ch(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new s.ck(d),u_camera_pos:new s.ch(d),u_depth_bias:new s.ci(d),u_height_scale:new s.ci(d),u_reset_depth:new s.ci(d)}),circle:s.dX,collisionBox:d=>({u_matrix:new s.ck(d),u_inv_rot_matrix:new s.ck(d),u_camera_to_center_distance:new s.ci(d),u_extrude_scale:new s.cj(d),u_zoom_transition:new s.ci(d),u_merc_center:new s.cj(d),u_tile_id:new s.ch(d)}),collisionCircle:d=>({u_matrix:new s.ck(d),u_inv_matrix:new s.ck(d),u_camera_to_center_distance:new s.ci(d),u_viewport_size:new s.cj(d)}),debug:d=>({u_color:new s.dA(d),u_matrix:new s.ck(d),u_overlay:new s.cg(d),u_overlay_scale:new s.ci(d)}),clippingMask:d=>({u_matrix:new s.ck(d)}),heatmap:d=>({u_extrude_scale:new s.ci(d),u_intensity:new s.ci(d),u_matrix:new s.ck(d),u_inv_rot_matrix:new s.ck(d),u_merc_center:new s.cj(d),u_tile_id:new s.ch(d),u_zoom_transition:new s.ci(d),u_up_dir:new s.ch(d)}),heatmapTexture:d=>({u_image:new s.cg(d),u_color_ramp:new s.cg(d),u_opacity:new s.ci(d)}),hillshade:d=>({u_matrix:new s.ck(d),u_image:new s.cg(d),u_latrange:new s.cj(d),u_light:new s.cj(d),u_shadow:new s.dA(d),u_highlight:new s.dA(d),u_emissive_strength:new s.ci(d),u_accent:new s.dA(d)}),hillshadePrepare:d=>({u_matrix:new s.ck(d),u_image:new s.cg(d),u_dimension:new s.cj(d),u_zoom:new s.ci(d)}),line:s.dW,linePattern:s.dV,raster:d=>({u_matrix:new s.ck(d),u_normalize_matrix:new s.ck(d),u_globe_matrix:new s.ck(d),u_merc_matrix:new s.ck(d),u_grid_matrix:new s.dB(d),u_tl_parent:new s.cj(d),u_scale_parent:new s.ci(d),u_fade_t:new s.ci(d),u_opacity:new s.ci(d),u_image0:new s.cg(d),u_image1:new s.cg(d),u_brightness_low:new s.ci(d),u_brightness_high:new s.ci(d),u_saturation_factor:new s.ci(d),u_contrast_factor:new s.ci(d),u_spin_weights:new s.ch(d),u_perspective_transform:new s.cj(d),u_raster_elevation:new s.ci(d),u_zoom_transition:new s.ci(d),u_merc_center:new s.cj(d),u_cutoff_params:new s.d2(d),u_colorization_mix:new s.d2(d),u_colorization_offset:new s.ci(d),u_color_ramp:new s.cg(d),u_texture_offset:new s.cj(d),u_texture_res:new s.cj(d),u_emissive_strength:new s.ci(d)}),rasterParticle:d=>({u_matrix:new s.ck(d),u_normalize_matrix:new s.ck(d),u_globe_matrix:new s.ck(d),u_merc_matrix:new s.ck(d),u_grid_matrix:new s.dB(d),u_tl_parent:new s.cj(d),u_scale_parent:new s.ci(d),u_fade_t:new s.ci(d),u_opacity:new s.ci(d),u_image0:new s.cg(d),u_image1:new s.cg(d),u_raster_elevation:new s.ci(d),u_zoom_transition:new s.ci(d),u_merc_center:new s.cj(d),u_cutoff_params:new s.d2(d)}),rasterParticleTexture:d=>({u_texture:new s.cg(d),u_opacity:new s.ci(d)}),rasterParticleDraw:d=>({u_particle_texture:new s.cg(d),u_particle_texture_side_len:new s.ci(d),u_tile_offset:new s.cj(d),u_velocity:new s.cg(d),u_color_ramp:new s.cg(d),u_velocity_res:new s.cj(d),u_max_speed:new s.ci(d),u_uv_offset:new s.cj(d),u_data_scale:new s.cj(d),u_data_offset:new s.ci(d),u_particle_pos_scale:new s.ci(d),u_particle_pos_offset:new s.cj(d)}),rasterParticleUpdate:d=>({u_particle_texture:new s.cg(d),u_particle_texture_side_len:new s.ci(d),u_velocity:new s.cg(d),u_velocity_res:new s.cj(d),u_max_speed:new s.ci(d),u_speed_factor:new s.ci(d),u_reset_rate:new s.ci(d),u_rand_seed:new s.ci(d),u_uv_offset:new s.cj(d),u_data_scale:new s.cj(d),u_data_offset:new s.ci(d),u_particle_pos_scale:new s.ci(d),u_particle_pos_offset:new s.cj(d)}),symbol:d=>({u_is_size_zoom_constant:new s.cg(d),u_is_size_feature_constant:new s.cg(d),u_size_t:new s.ci(d),u_size:new s.ci(d),u_camera_to_center_distance:new s.ci(d),u_rotate_symbol:new s.cg(d),u_aspect_ratio:new s.ci(d),u_fade_change:new s.ci(d),u_matrix:new s.ck(d),u_label_plane_matrix:new s.ck(d),u_coord_matrix:new s.ck(d),u_is_text:new s.cg(d),u_elevation_from_sea:new s.cg(d),u_pitch_with_map:new s.cg(d),u_texsize:new s.cj(d),u_texsize_icon:new s.cj(d),u_texture:new s.cg(d),u_texture_icon:new s.cg(d),u_gamma_scale:new s.ci(d),u_device_pixel_ratio:new s.ci(d),u_tile_id:new s.ch(d),u_zoom_transition:new s.ci(d),u_inv_rot_matrix:new s.ck(d),u_merc_center:new s.cj(d),u_camera_forward:new s.ch(d),u_tile_matrix:new s.ck(d),u_up_vector:new s.ch(d),u_ecef_origin:new s.ch(d),u_is_halo:new s.cg(d),u_icon_transition:new s.ci(d),u_color_adj_mat:new s.ck(d),u_scale_factor:new s.ci(d),u_ground_shadow_factor:new s.ch(d),u_inv_matrix:new s.ck(d),u_normal_scale:new s.ci(d),u_lutTexture:new s.cg(d)}),background:d=>({u_matrix:new s.ck(d),u_emissive_strength:new s.ci(d),u_opacity:new s.ci(d),u_color:new s.dA(d)}),backgroundPattern:d=>({u_matrix:new s.ck(d),u_emissive_strength:new s.ci(d),u_opacity:new s.ci(d),u_image:new s.cg(d),u_pattern_tl:new s.cj(d),u_pattern_br:new s.cj(d),u_texsize:new s.cj(d),u_pattern_size:new s.cj(d),u_pixel_coord_upper:new s.cj(d),u_pixel_coord_lower:new s.cj(d),u_pattern_units_to_pixels:new s.cj(d)}),terrainRaster:d=>({u_matrix:new s.ck(d),u_image0:new s.cg(d),u_skirt_height:new s.ci(d),u_ground_shadow_factor:new s.ch(d)}),skybox:d=>({u_matrix:new s.ck(d),u_sun_direction:new s.ch(d),u_cubemap:new s.cg(d),u_opacity:new s.ci(d),u_temporal_offset:new s.ci(d)}),skyboxGradient:d=>({u_matrix:new s.ck(d),u_color_ramp:new s.cg(d),u_center_direction:new s.ch(d),u_radius:new s.ci(d),u_opacity:new s.ci(d),u_temporal_offset:new s.ci(d)}),skyboxCapture:d=>({u_matrix_3f:new s.dB(d),u_sun_direction:new s.ch(d),u_sun_intensity:new s.ci(d),u_color_tint_r:new s.d2(d),u_color_tint_m:new s.d2(d),u_luminance:new s.ci(d)}),globeRaster:d=>({u_proj_matrix:new s.ck(d),u_globe_matrix:new s.ck(d),u_normalize_matrix:new s.ck(d),u_merc_matrix:new s.ck(d),u_zoom_transition:new s.ci(d),u_merc_center:new s.cj(d),u_image0:new s.cg(d),u_grid_matrix:new s.dB(d),u_skirt_height:new s.ci(d),u_far_z_cutoff:new s.ci(d),u_frustum_tl:new s.ch(d),u_frustum_tr:new s.ch(d),u_frustum_br:new s.ch(d),u_frustum_bl:new s.ch(d),u_globe_pos:new s.ch(d),u_globe_radius:new s.ci(d),u_viewport:new s.cj(d)}),globeAtmosphere:d=>({u_frustum_tl:new s.ch(d),u_frustum_tr:new s.ch(d),u_frustum_br:new s.ch(d),u_frustum_bl:new s.ch(d),u_horizon:new s.ci(d),u_transition:new s.ci(d),u_fadeout_range:new s.ci(d),u_atmosphere_fog_color:new s.d2(d),u_high_color:new s.d2(d),u_space_color:new s.d2(d),u_temporal_offset:new s.ci(d),u_horizon_angle:new s.ci(d)}),model:d=>({u_matrix:new s.ck(d),u_lighting_matrix:new s.ck(d),u_normal_matrix:new s.ck(d),u_node_matrix:new s.ck(d),u_lightpos:new s.ch(d),u_lightintensity:new s.ci(d),u_lightcolor:new s.ch(d),u_camera_pos:new s.ch(d),u_opacity:new s.ci(d),u_baseColorFactor:new s.d2(d),u_emissiveFactor:new s.d2(d),u_metallicFactor:new s.ci(d),u_roughnessFactor:new s.ci(d),u_baseTextureIsAlpha:new s.cg(d),u_alphaMask:new s.cg(d),u_alphaCutoff:new s.ci(d),u_baseColorTexture:new s.cg(d),u_metallicRoughnessTexture:new s.cg(d),u_normalTexture:new s.cg(d),u_occlusionTexture:new s.cg(d),u_emissionTexture:new s.cg(d),u_lutTexture:new s.cg(d),u_color_mix:new s.d2(d),u_aoIntensity:new s.ci(d),u_emissive_strength:new s.ci(d),u_occlusionTextureTransform:new s.d2(d)}),modelDepth:d=>({u_matrix:new s.ck(d),u_instance:new s.ck(d),u_node_matrix:new s.ck(d)}),groundShadow:d=>({u_matrix:new s.ck(d),u_ground_shadow_factor:new s.ch(d)}),stars:d=>({u_matrix:new s.ck(d),u_up:new s.ch(d),u_right:new s.ch(d),u_intensity_multiplier:new s.ci(d)}),snowParticle:d=>({u_modelview:new s.ck(d),u_projection:new s.ck(d),u_time:new s.ci(d),u_cam_pos:new s.ch(d),u_velocityConeAperture:new s.ci(d),u_velocity:new s.ci(d),u_horizontalOscillationRadius:new s.ci(d),u_horizontalOscillationRate:new s.ci(d),u_boxSize:new s.ci(d),u_billboardSize:new s.ci(d),u_simpleShapeParameters:new s.cj(d),u_screenSize:new s.cj(d),u_thinningCenterPos:new s.cj(d),u_thinningShape:new s.ch(d),u_thinningAffectedRatio:new s.ci(d),u_thinningParticleOffset:new s.ci(d),u_particleColor:new s.d2(d),u_direction:new s.ch(d)}),rainParticle:d=>({u_modelview:new s.ck(d),u_projection:new s.ck(d),u_time:new s.ci(d),u_cam_pos:new s.ch(d),u_texScreen:new s.cg(d),u_velocityConeAperture:new s.ci(d),u_velocity:new s.ci(d),u_boxSize:new s.ci(d),u_rainDropletSize:new s.cj(d),u_distortionStrength:new s.ci(d),u_rainDirection:new s.ch(d),u_color:new s.d2(d),u_screenSize:new s.cj(d),u_thinningCenterPos:new s.cj(d),u_thinningShape:new s.ch(d),u_thinningAffectedRatio:new s.ci(d),u_thinningParticleOffset:new s.ci(d),u_shapeDirectionalPower:new s.ci(d),u_shapeNormalPower:new s.ci(d),u_mode:new s.ci(d)}),vignette:d=>({u_vignetteShape:new s.ch(d),u_vignetteColor:new s.d2(d)}),occlusion:d=>({u_matrix:new s.ck(d),u_anchorPos:new s.ch(d),u_screenSizePx:new s.cj(d),u_occluderSizePx:new s.cj(d),u_color:new s.d2(d)})};class iu{constructor(t,o,f,y){this.id=iu.uniqueIdxCounter,iu.uniqueIdxCounter++,this.context=t;const x=t.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=iu.uniqueIdxCounter,iu.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}iu.uniqueIdxCounter=0;const wh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zp{constructor(t,o,f,y,x,T){this.length=o.length,this.attributes=f,this.itemSize=o.bytesPerElement,this.dynamicDraw=y,this.instanceCount=T,this.context=t;const A=t.gl;this.buffer=A.createBuffer(),t.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||x||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let f=0;f<this.attributes.length;f++){const y=o.getAttributeLocation(t,this.attributes[f].name);y!==-1&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,o,f){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],T=o.getAttributeLocation(t,x.name);T!==-1&&t.vertexAttribPointer(T,x.components,t[wh[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(t,o,f){for(let y=0;y<this.attributes.length;y++){const x=o.getAttributeLocation(t,this.attributes[y].name);x!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(x,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Rf{constructor(t,o,f,y,x){this.context=t,this.width=o,this.height=f;const T=this.framebuffer=t.gl.createFramebuffer();y&&(this.colorAttachment=new Iu(t,T)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new xc(t,T):new rg(t,T))}destroy(){const t=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class Sd{constructor(t,o){this.gl=t,this.clearColor=new ng(this),this.clearDepth=new ka(this),this.clearStencil=new gd(this),this.colorMask=new _d(this),this.depthMask=new Ap(this),this.stencilMask=new ff(this),this.stencilFunc=new Ya(this),this.stencilOp=new _l(this),this.stencilTest=new Hl(this),this.depthRange=new yc(this),this.depthTest=new $l(this),this.depthFunc=new Wl(this),this.blend=new pf(this),this.blendFunc=new mf(this),this.blendColor=new Kc(this),this.blendEquation=new gh(this),this.cullFace=new ro(this),this.cullFaceSide=new os(this),this.frontFace=new Ir(this),this.program=new vc(this),this.activeTexture=new Qa(this),this.viewport=new Au(this),this.bindFramebuffer=new Zl(this),this.bindRenderbuffer=new gf(this),this.bindTexture=new Ip(this),this.bindVertexBuffer=new Yc(this),this.bindElementBuffer=new Xl(this),this.bindVertexArrayOES=new Cp(this),this.pixelStoreUnpack=new yd(this),this.pixelStoreUnpackPremultiplyAlpha=new Rp(this),this.pixelStoreUnpackFlipY=new yl(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,f){return new iu(this,t,o,f)}createVertexBuffer(t,o,f,y,x){return new zp(this,t,o,f,y,x)}createRenderbuffer(t,o,f){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,t,o,f),this.bindRenderbuffer.set(null),x}createFramebuffer(t,o,f,y){return new Rf(this,t,o,f,y)}clear({color:t,depth:o,stencil:f,colorMask:y}){const x=this.gl;let T=0;t&&(T|=x.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),o!==void 0&&(T|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),f!==void 0&&(T|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),x.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){s.bx(t.blendFunction,Xi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let bl;function Zo(d,t,o,f,y,x,T){const A=d.context,R=A.gl,L=d.transform,k=[s.aF(L.center.lng),s.aJ(L.center.lat)],U=o.layout.get("symbol-placement"),B=o.layout.get("text-variable-anchor"),H=o.layout.get("icon-rotation-alignment")==="map",W=o.layout.get("text-rotation-alignment")==="map",X=U!=="point",te=[];let ee=0,re=0;for(let me=0;me<f.length;me++){const Se=f[me],Ve=t.getTile(Se),ke=Ve.getBucket(o);if(!ke)continue;const st=ke.getProjection().createInversionMatrix(L,Se.canonical),Xe=[],ht=qc(Se,ke,L),zt=!T&&H&&X,$e=T&&W&&X,Pe=B&&ke.hasTextData(),dt=ke.hasIconTextFit()&&Pe&&ke.hasIconData(),Ke=zt||$e||T&&Pe||dt,At=ke.projection.name==="globe",wt=At?s.aj(L.zoom):0;At&&(Xe.push("PROJECTION_GLOBE_VIEW"),Ke&&Xe.push("PROJECTED_POS_ON_VIEWPORT"));const Ht=d.getOrCreateProgram("collisionBox",{defines:Xe});let mt=ht;y[0]===0&&y[1]===0||(mt=d.translatePosMatrix(ht,Ve,y,x));const _t=T?ke.textCollisionBox:ke.iconCollisionBox,$t=ke.collisionCircleArray;if($t.length>0){const Xt=s.bB(),ri=mt;s.cO(Xt,ke.placementInvProjMatrix,L.glCoordMatrix),s.cO(Xt,Xt,ke.placementViewportMatrix),te.push({circleArray:$t,circleOffset:re,transform:ri,invTransform:Xt,projection:ke.getProjection()}),ee+=$t.length/4,re=ee}if(!_t)continue;d.terrain&&d.terrain.setupElevationDraw(Ve,Ht);const Jt=At?[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z]:[0,0,0];Ht.draw(d,R.LINES,pi.disabled,Ui.disabled,d.colorModeForRenderPass(),Li.disabled,bh(mt,st,L,wt,k,Ve,Jt,ke.getProjection()),o.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,L.zoom,null,[_t.collisionVertexBuffer,_t.collisionVertexBufferExt])}if(!T||!te.length)return;const he=d.getOrCreateProgram("collisionCircle"),le=new s.dY;le.resize(4*ee),le._trim();let we=0;for(const me of te)for(let Se=0;Se<me.circleArray.length/4;Se++){const Ve=4*Se,ke=me.circleArray[Ve+0],st=me.circleArray[Ve+1],Xe=me.circleArray[Ve+2],ht=me.circleArray[Ve+3];le.emplace(we++,ke,st,Xe,ht,0),le.emplace(we++,ke,st,Xe,ht,1),le.emplace(we++,ke,st,Xe,ht,2),le.emplace(we++,ke,st,Xe,ht,3)}(!bl||bl.length<2*ee)&&(bl=(function(me){const Se=2*me,Ve=new s.b0;Ve.resize(Se),Ve._trim();for(let ke=0;ke<Se;ke++){const st=6*ke;Ve.uint16[st+0]=4*ke+0,Ve.uint16[st+1]=4*ke+1,Ve.uint16[st+2]=4*ke+2,Ve.uint16[st+3]=4*ke+2,Ve.uint16[st+4]=4*ke+3,Ve.uint16[st+5]=4*ke+0}return Ve})(ee));const fe=A.createIndexBuffer(bl,!0),Ee=A.createVertexBuffer(le,s.dZ.members,!0);for(const me of te){const Se={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:(ge=L).getCameraToCenterDistance(me.projection),u_viewport_size:[ge.width,ge.height]};he.draw(d,R.TRIANGLES,pi.disabled,Ui.disabled,d.colorModeForRenderPass(),Li.disabled,Se,o.id,Ee,fe,s.bf.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,L.zoom)}var ge;Ee.destroy(),fe.destroy()}const To=s.bB();function Ic(d){const t=d._camera.getWorldToCamera(d.worldSize,1),o=s.aB([],t,d.globeMatrix);s.bk(o,o);const f=[0,0,0],y=[0,1,0,0];return s.aC(y,y,o),f[0]=y[0],f[1]=y[1],f[2]=y[2],s.aw(f,f),f}function Ad({width:d,height:t,anchor:o,textOffset:f,textScale:y},x){const{horizontalAlign:T,verticalAlign:A}=s.c0(o),R=-(T-.5)*d,L=-(A-.5)*t,k=s.c1(o,f);return new s.P((R/y+k[0])*x,(L/y+k[1])*x)}function Mf(d,t,o,f,y,x,T,A,R,L){const k=d.text.placedSymbolArray,U=d.text.dynamicLayoutVertexArray,B=d.icon.dynamicLayoutVertexArray,H={},W=d.getProjection(),X=bu(T,W,y),te=y.elevation,ee=W.upVectorScale(T.canonical,y.center.lat,y.worldSize).metersToTile;U.clear();for(let re=0;re<k.length;re++){const he=k.get(re),{tileAnchorX:le,tileAnchorY:we,numGlyphs:fe}=he,Ee=he.hidden||!he.crossTileID||d.allowVerticalPlacement&&!he.placedOrientation?null:f[he.crossTileID];if(Ee){let ge=0,me=0,Se=0;const Ve=d.elevationType==="road";if(te||Ve){const Ke=Ve?d.getElevationFeatureForText(re):null,At=s.bU.getAtTileOffset(T,new s.P(le,we),te,Ke),[wt,Ht,mt]=W.upVector(T.canonical,le,we);ge=At*wt*ee,me=At*Ht*ee,Se=At*mt*ee}let[ke,st,Xe,ht]=Ss(he.projectedAnchorX+ge,he.projectedAnchorY+me,he.projectedAnchorZ+Se,o?X:x);const zt=Hc(y.getCameraToCenterDistance(W),ht);let $e=s.bL(d.textSizeData,R,he)*zt/s.bX;o&&($e*=d.tilePixelRatio/A);const Pe=Ad(Ee,$e);o?({x:ke,y:st,z:Xe}=W.projectTilePoint(le+Pe.x,we+Pe.y,T.canonical),[ke,st,Xe]=Ss(ke+ge,st+me,Xe+Se,x)):(t&&Pe._rotate(-y.angle),ke+=Pe.x,st+=Pe.y,Xe=0);const dt=d.allowVerticalPlacement&&he.placedOrientation===s.bK.vertical?Math.PI/2:0;for(let Ke=0;Ke<fe;Ke++)s.bN(U,ke,st,Xe,dt);L&&he.associatedIconIndex>=0&&(H[he.associatedIconIndex]={x:ke,y:st,z:Xe,angle:dt})}else pl(fe,U)}if(L){B.clear();const re=d.icon.placedSymbolArray;for(let he=0;he<re.length;he++){const le=re.get(he),{numGlyphs:we}=le,fe=H[he];if(le.hidden||!fe)pl(we,B);else{const{x:Ee,y:ge,z:me,angle:Se}=fe;for(let Ve=0;Ve<we;Ve++)s.bN(B,Ee,ge,me,Se)}}d.icon.dynamicLayoutVertexBuffer.updateData(B)}d.text.dynamicLayoutVertexBuffer.updateData(U)}function wl(d,t,o,f,y,x,T={}){const A=o.paint.get("icon-translate"),R=o.paint.get("text-translate"),L=o.paint.get("icon-translate-anchor"),k=o.paint.get("text-translate-anchor"),U=o.layout.get("icon-rotation-alignment"),B=o.layout.get("text-rotation-alignment"),H=o.layout.get("icon-pitch-alignment"),W=o.layout.get("text-pitch-alignment"),X=o.layout.get("icon-keep-upright"),te=o.layout.get("text-keep-upright"),ee=o.paint.get("icon-color-saturation"),re=o.paint.get("icon-color-contrast"),he=o.paint.get("icon-color-brightness-min"),le=o.paint.get("icon-color-brightness-max"),we=o.layout.get("symbol-elevation-reference")==="sea",fe=o.layout.get("icon-image-use-theme")==="none",Ee=d.context,ge=Ee.gl,me=d.transform,Se=U==="map",Ve=B==="map",ke=H==="map",st=W==="map",Xe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ht=!1;const zt=d.depthModeForSublayer(0,pi.ReadOnly),$e=new pi(d.context.gl.LEQUAL,pi.ReadOnly,d.depthRangeFor3D),Pe=[s.aF(me.center.lng),s.aJ(me.center.lat)],dt=o.layout.get("text-variable-anchor"),Ke=me.projection.name==="globe",At=[],wt=[0,-1,0];for(const Ht of f){const mt=t.getTile(Ht),_t=mt.getBucket(o);if(!_t||_t.projection.name==="mercator"&&Ke||_t.fullyClipped)continue;const $t=_t.projection.name==="globe",Jt=$t?s.aj(me.zoom):0,Xt=bu(Ht,_t.getProjection(),me),ri=me.calculatePixelsToTileUnitsMatrix(mt),Mi=dt&&_t.hasTextData(),tn=_t.hasIconTextFit()&&Mi&&_t.hasIconData(),Gi=_t.getProjection().createInversionMatrix(me,Ht.canonical),Fn=(1<<mt.tileID.canonical.z)*s.al/d.transform.worldSize,Pi=wn=>{let Ei=[0,0,0];if(wn){const pn=d.style.directionalLight,br=d.style.ambientLight;pn&&br&&(Ei=Wo(d.style,pn,br))}return Ei},yn=wn=>{me.depthOcclusionForSymbolsAndCircles&&(o.hasOcclusionOpacityProperties||d.terrain)&&(wn.push("DEPTH_D24"),wn.push("DEPTH_OCCLUSION"))},Ni=wn=>{o.lut&&!fe&&(o.lut.texture||(o.lut.texture=new s.d_(d.context,o.lut.image,[o.lut.image.height,o.lut.image.height,o.lut.image.height],Ee.gl.RGBA8)),Ee.activeTexture.set(Ee.gl.TEXTURE0+po.LUT),o.lut.texture&&o.lut.texture.bind(Ee.gl.LINEAR,Ee.gl.CLAMP_TO_EDGE),wn.push("APPLY_LUT_ON_GPU"))},Bn=()=>{const wn=Se&&o.layout.get("symbol-placement")!=="point",Ei=[];yn(Ei),Ni(Ei);const pn=wn||tn,br=_t.elevationType==="road",Er=d.shadowRenderer,zr=br&&ke&&!!Er&&Er.enabled,qr=Pi(zr),ca=br&&ke&&!d.terrain?$e:zt,_o=o.paint.get("icon-image-cross-fade");d.terrainRenderModeElevated()&&ke&&Ei.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Ei.push("PROJECTION_GLOBE_VIEW"),pn&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),_o>0&&_t.hasAnySecondaryIcon&&Ei.push("ICON_TRANSITION"),!_t.icon.zOffsetVertexBuffer||br&&d.terrain||Ei.push("Z_OFFSET"),ee===0&&re===0&&he===0&&le===1||Ei.push("COLOR_ADJUSTMENT"),_t.sdfIcons&&Ei.push("RENDER_SDF"),zr&&Ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),br&&ke&&!d.terrain&&_t.icon.orientationVertexBuffer&&Ei.push("ELEVATED_ROADS");const so=_t.icon.programConfigurations.get(o.id),ls=d.getOrCreateProgram("symbol",{config:so,defines:Ei}),Va=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],Qr=_t.iconSizeData,Ua=s.bJ(Qr,me.zoom),rl=ke||!me.isOrthographic,oo=hc(Xt,mt.tileID.canonical,ke,Se,me,_t.getProjection(),ri),wr=fl(Xt,mt.tileID.canonical,ke,Se,me,_t.getProjection(),ri),Jr=d.translatePosMatrix(wr,mt,A,L,!0),ar=d.translatePosMatrix(Xt,mt,A,L),Hr=pn?To:oo,Ws=Se&&!ke&&!wn;let $r=wt;!Ke&&!me.mercatorFromTransition||Se||($r=Ic(me));const ja=$t?$r:wt,Bh=o.getColorAdjustmentMatrix(ee,re,he,le),Sl=Sc(Qr.kind,Ua,Ws,ke,d,ar,Hr,Jr,we,!1,Va,[0,0],0,Ht,Jt,Pe,Gi,ja,_t.getProjection(),qr,Fn,Bh,_o,null),$u=mt.imageAtlasTexture?mt.imageAtlasTexture:null,Ud=o.layout.get("icon-size").constantOr(0)!==1||_t.iconsNeedLinear,sl=_t.sdfIcons||d.options.rotating||d.options.zooming||Ud||rl?ge.LINEAR:ge.NEAREST,Oc=_t.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Fs=d.terrain&&ke&&wn?s.bk(s.bB(),oo):To;if(wn&&_t.icon){const Ga=s.bU.getAtTileOffsetFunc(Ht,me.center.lat,me.worldSize,_t.getProjection()),Al=jl(Xt,mt.tileID.canonical,ke,Se,me,_t.getProjection(),ri),Hf=o.layout.get("icon-size-scale-range"),$f=s.aA(d.scaleFactor,Hf[0],Hf[1]);ld(_t,Xt,d,!1,Al,wr,ke,X,Ga,Ht,$f)}return{program:ls,buffers:_t.icon,uniformValues:Sl,atlasTexture:$u,atlasTextureIcon:null,atlasInterpolation:sl,atlasInterpolationIcon:null,isSDF:_t.sdfIcons,hasHalo:Oc,depthMode:ca,tile:mt,renderWithShadows:zr,labelPlaneMatrixInv:Fs}},_n=()=>{const wn=Ve&&o.layout.get("symbol-placement")!=="point",Ei=[],pn=wn||dt||tn,br=_t.elevationType==="road",Er=d.shadowRenderer,zr=br&&st&&!!Er&&Er.enabled,qr=Pi(zr),ca=br&&st&&!d.terrain?$e:zt;d.terrainRenderModeElevated()&&st&&Ei.push("PITCH_WITH_MAP_TERRAIN"),$t&&(Ei.push("PROJECTION_GLOBE_VIEW"),pn&&Ei.push("PROJECTED_POS_ON_VIEWPORT")),!_t.text.zOffsetVertexBuffer||br&&d.terrain||Ei.push("Z_OFFSET"),_t.iconsInText&&Ei.push("RENDER_TEXT_AND_SYMBOL"),Ei.push("RENDER_SDF"),zr&&Ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),br&&st&&!d.terrain&&_t.text.orientationVertexBuffer&&Ei.push("ELEVATED_ROADS"),yn(Ei);const _o=_t.text.programConfigurations.get(o.id),so=d.getOrCreateProgram("symbol",{config:_o,defines:Ei});let ls,Va=[0,0],Qr=null;const Ua=_t.textSizeData;_t.iconsInText&&(Va=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],Qr=mt.imageAtlasTexture?mt.imageAtlasTexture:null,ls=st||!me.isOrthographic||d.options.rotating||d.options.zooming||Ua.kind==="composite"||Ua.kind==="camera"?ge.LINEAR:ge.NEAREST);const rl=mt.glyphAtlasTexture?mt.glyphAtlasTexture.size:[0,0],oo=o.layout.get("text-size-scale-range"),wr=s.aA(d.scaleFactor,oo[0],oo[1]),Jr=s.bJ(Ua,me.zoom,wr),ar=hc(Xt,mt.tileID.canonical,st,Ve,me,_t.getProjection(),ri),Hr=fl(Xt,mt.tileID.canonical,st,Ve,me,_t.getProjection(),ri),Ws=d.translatePosMatrix(Hr,mt,R,k,!0),$r=d.translatePosMatrix(Xt,mt,R,k),ja=pn?To:ar,Bh=Ve&&!st&&!wn;let Sl=wt;!Ke&&!me.mercatorFromTransition||Ve||(Sl=Ic(me));const $u=Sc(Ua.kind,Jr,Bh,st,d,$r,ja,Ws,we,!0,rl,Va,0,Ht,Jt,Pe,Gi,$t?Sl:wt,_t.getProjection(),qr,Fn,null,null,wr),Ud=mt.glyphAtlasTexture?mt.glyphAtlasTexture:null,sl=ge.LINEAR,Oc=o.paint.get("text-halo-width").constantOr(1)!==0,Fs=d.terrain&&st&&wn?s.bk(s.bB(),ar):To;if(wn&&_t.text){const Ga=s.bU.getAtTileOffsetFunc(Ht,me.center.lat,me.worldSize,_t.getProjection()),Al=jl(Xt,mt.tileID.canonical,st,Ve,me,_t.getProjection(),ri);ld(_t,Xt,d,!0,Al,Hr,st,te,Ga,Ht,wr)}return{program:so,buffers:_t.text,uniformValues:$u,atlasTexture:Ud,atlasTextureIcon:Qr,atlasInterpolation:sl,atlasInterpolationIcon:ls,isSDF:!0,hasHalo:Oc,depthMode:ca,tile:mt,renderWithShadows:zr,labelPlaneMatrixInv:Fs}},In=_t.icon.segments.get().length,Dn=_t.text.segments.get().length,Wi=In&&!T.onlyText?Bn():null,Un=Dn&&!T.onlyIcons?_n():null,nn=o.paint.get("icon-opacity").constantOr(1),gr=o.paint.get("text-opacity").constantOr(1);if(Xe&&_t.canOverlap){ht=!0;const wn=nn&&!T.onlyText?_t.icon.segments.get():[],Ei=gr&&!T.onlyIcons?_t.text.segments.get():[];for(const pn of wn)At.push({segments:new s.bf([pn]),sortKey:pn.sortKey,state:Wi});for(const pn of Ei)At.push({segments:new s.bf([pn]),sortKey:pn.sortKey,state:Un})}else T.onlyText||At.push({segments:nn?_t.icon.segments:new s.bf([]),sortKey:0,state:Wi}),T.onlyIcons||At.push({segments:gr?_t.text.segments:new s.bf([]),sortKey:0,state:Un})}ht&&At.sort(((Ht,mt)=>Ht.sortKey-mt.sortKey));for(const Ht of At){const mt=Ht.state;if(mt)if(d.terrain?d.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}):d.setupDepthForOcclusion(me.depthOcclusionForSymbolsAndCircles,mt.program),Ee.activeTexture.set(ge.TEXTURE0),mt.atlasTexture&&mt.atlasTexture.bind(mt.atlasInterpolation,ge.CLAMP_TO_EDGE,!0),mt.atlasTextureIcon&&(Ee.activeTexture.set(ge.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,ge.CLAMP_TO_EDGE,!0)),mt.renderWithShadows&&d.shadowRenderer.setupShadows(mt.tile.tileID.toUnwrapped(),mt.program,"vector-tile"),d.uploadCommonLightUniforms(d.context,mt.program),mt.hasHalo){const _t=mt.uniformValues;_t.u_is_halo=1,oa(mt.buffers,Ht.segments,o,d,mt.program,mt.depthMode,y,x,_t,2),_t.u_is_halo=0}else{if(mt.isSDF){const _t=mt.uniformValues;mt.hasHalo&&(_t.u_is_halo=1,oa(mt.buffers,Ht.segments,o,d,mt.program,mt.depthMode,y,x,_t,1)),_t.u_is_halo=0}oa(mt.buffers,Ht.segments,o,d,mt.program,mt.depthMode,y,x,mt.uniformValues,1)}}}function oa(d,t,o,f,y,x,T,A,R,L){const k=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer,d.orientationVertexBuffer];y.draw(f,f.context.gl.TRIANGLES,x,T,A,Li.disabled,R,o.id,d.layoutVertexBuffer,d.indexBuffer,t,o.paint,f.transform.zoom,d.programConfigurations.get(o.id),k,L)}function Hs(d,t){const o=1<<d.canonical.z,f=(t.x*o-d.canonical.x-d.wrap*o)*s.al,y=(t.y*o-d.canonical.y)*s.al,x=s.e7(t.z,t.y);return s.d4(f,y,x)}function Cc(d,t,o,f,y){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const x=d.context.gl,T=new pi(d.context.gl.LEQUAL,pi.ReadWrite,d.depthRangeFor3D),A=new pi(d.context.gl.GREATER,pi.ReadWrite,d.depthRangeFor3D),R=(function(H){let W=.01;return H.isOrthographic&&(W=s.ak(1e-4,W,s.c$(H.pitch>=oh?1:H.pitch/oh))),2*W})(d.transform),L=d.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",U=d.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),B=d.getOrCreateProgram(k);for(const H of f){const W=t.getTile(H),X=W.getBucket(o);if(!X)continue;const te=X.elevatedStructures;if(!te)continue;const ee=X.elevationBufferData.heightRange,re=Hs(H.toUnwrapped(),L),he=d.translatePosMatrix(H.projMatrix,W,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let le,we,fe,Ee;if(y==="initialize"){if(!ee||ee.min>=1||te.depthSegments.segments[0].primitiveLength===0)continue;le=Sf(he,re,R,1,0),we=T,fe=te.depthSegments,Ee=U}else if(y==="reset"){if(!ee||ee.min>=0||te.maskSegments.segments[0].primitiveLength===0)continue;le=Sf(he,re,0,0,1),we=A,fe=te.maskSegments,Ee=U}else if(y==="geometry"){if(te.depthSegments.segments[0].primitiveLength===0)continue;le=Sf(he,re,R,1,0),we=T,fe=te.depthSegments,Ee=B}Ee.draw(d,x.TRIANGLES,we,Ui.disabled,Xi.disabled,Li.disabled,le,o.id,te.vertexBuffer,te.indexBuffer,fe,o.paint,d.transform.zoom)}}function Fa(d,t,o){const{painter:f,sourceCache:y,layer:x,coords:T,colorMode:A,elevationType:R,terrainEnabled:L,pass:k}=d,U=f.context.gl,B=x.paint.get("fill-pattern"),H=x.paint.get("fill-pattern-cross-fade"),W=B.constantOr(null);let X=R;R!=="road"||t&&!L||(X="none");const te=X==="road",ee=d.painter.shadowRenderer,re=te&&!!ee&&ee.enabled,he=new pi(f.context.gl.LEQUAL,pi.ReadOnly,f.depthRangeFor3D);let le=[0,0,0];if(re){const Ee=f.style.directionalLight,ge=f.style.ambientLight;Ee&&ge&&(le=Wo(f.style,Ee,ge))}const we=B&&B.constantOr(1),fe=(Ee,ge)=>{let me,Se,Ve,ke,st;ge?(me=we&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ve=U.LINES):(me=we?"fillPattern":"fill",Ve=U.TRIANGLES);for(const Xe of T){const ht=y.getTile(Xe);if(we&&!ht.patternsLoaded())continue;const zt=ht.getBucket(x);if(!zt)continue;const $e=t?zt.elevationBufferData:zt.bufferData;if($e.isEmpty())continue;f.prepareDrawTile();const Pe=$e.programConfigurations.get(x.id),dt=f.isTileAffectedByFog(Xe),Ke=[],At=[];te&&(Ke.push("ELEVATED_ROADS"),At.push($e.elevatedLayoutVertexBuffer)),re&&Ke.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),we&&(f.context.activeTexture.set(U.TEXTURE0),ht.imageAtlasTexture&&ht.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Pe.updatePaintBuffers());let wt=!1;if(W&&ht.imageAtlas){const Jt=ht.imageAtlas,Xt=s.e2.from(W),ri=Xt.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),Mi=Xt.getSecondary(),tn=Jt.patternPositions.get(ri),Gi=Mi?Jt.patternPositions.get(Mi.scaleSelf(s.o.devicePixelRatio).toString()):null;wt=!!tn&&!!Gi,tn&&Pe.setConstantPatternPositions(tn,Gi)}H>0&&(wt||Pe.getPatternTransitionVertexBuffer("fill-pattern"))&&Ke.push("FILL_PATTERN_TRANSITION");const Ht=f.getOrCreateProgram(me,{config:Pe,overrideFog:dt,defines:Ke}),mt=f.translatePosMatrix(Xe.projMatrix,ht,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));re&&ee.setupShadows(ht.tileID.toUnwrapped(),Ht,"vector-tile");const _t=x.paint.get("fill-emissive-strength");if(ge){ke=$e.lineIndexBuffer,st=$e.lineSegments;const Jt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];Se=me==="fillOutlinePattern"&&we?Lp(mt,_t,f,ht,Jt,le,H):Op(mt,_t,Jt,le)}else ke=$e.indexBuffer,st=$e.triangleSegments,Se=we?Pp(mt,_t,f,ht,le,H):xh(mt,_t,le);f.uploadCommonUniforms(f.context,Ht,Xe.toUnwrapped());let $t=Ee;(R==="road"&&!L||R==="offset")&&($t=he),Ht.draw(f,Ve,$t,o||f.stencilModeForClipping(Xe),A,Li.disabled,Se,x.id,$e.layoutVertexBuffer,ke,st,x.paint,f.transform.zoom,Pe,At)}};f.renderPass===k&&fe(f.depthModeForSublayer(1,f.renderPass==="opaque"?pi.ReadWrite:pi.ReadOnly),!1),X==="none"&&f.renderPass==="translucent"&&x.paint.get("fill-antialias")&&fe(f.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,pi.ReadOnly),!0)}function Lt(d,t,o,f,y,x,T,A){o.resetLayerRenderingStats(d);const R=d.context,L=R.gl,k=d.transform,U=o.paint.get("fill-extrusion-pattern"),B=o.paint.get("fill-extrusion-pattern-cross-fade"),H=U.constantOr(null),W=U.constantOr(1),X=o.paint.get("fill-extrusion-opacity"),te=d.style.enable3dLights(),ee=o.paint.get(te&&!W?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),re=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee],he=o.layout.get("fill-extrusion-edge-radius"),le=he>0&&!o.paint.get("fill-extrusion-rounded-roof"),we=le?0:he,fe=k.projection.name==="globe"?s.ea():0,Ee=k.projection.name==="globe",ge=Ee?s.aj(k.zoom):0,me=[s.aF(k.center.lng),s.aJ(k.center.lat)],Se=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ve=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:o.lut).toArray01().slice(0,3),ke=o.paint.get("fill-extrusion-flood-light-intensity"),st=o.paint.get("fill-extrusion-vertical-scale"),Xe=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,ht=o.paint.get("fill-extrusion-height-alignment"),zt=o.paint.get("fill-extrusion-base-alignment"),$e=Ka(d,o.paint.get("fill-extrusion-cutoff-fade-range")),Pe=[];let dt;Ee&&Pe.push("PROJECTION_GLOBE_VIEW"),re[0]>0&&Pe.push("FAUX_AO"),le&&Pe.push("ZERO_ROOF_RADIUS"),A&&Pe.push("HAS_CENTROID"),ke>0&&Pe.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF"),Xe&&Pe.push("RENDER_WALL_MODE");const Ke=d.renderPass==="shadow",At=d.shadowRenderer,wt=Ke&&!!At,Ht=Ke?Li.disabled:Li.backCCW;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let mt=[0,0,0];if(At){const Jt=d.style.directionalLight,Xt=d.style.ambientLight;Jt&&Xt&&(mt=Wo(d.style,Jt,Xt)),Ke||(Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),At.useNormalOffset&&Pe.push("NORMAL_OFFSET")),dt=Pe.concat(["SHADOWS_SINGLE_CASCADE"])}const _t=wt?"fillExtrusionDepth":W?"fillExtrusionPattern":"fillExtrusion",$t=o.getLayerRenderingStats();for(const Jt of f){const Xt=t.getTile(Jt),ri=Xt.getBucket(o);if(!ri||ri.projection.name!==k.projection.name)continue;let Mi=!1;At&&(Mi=At.getMaxCascadeForTile(Jt.toUnwrapped())===0);const tn=d.isTileAffectedByFog(Jt),Gi=ri.programConfigurations.get(o.id);let Fn=!1;if(H&&Xt.imageAtlas){const Dn=Xt.imageAtlas,Wi=s.e2.from(H),Un=Wi.getPrimary().scaleSelf(s.o.devicePixelRatio).toString(),nn=Wi.getSecondary(),gr=Dn.patternPositions.get(Un),wn=nn?Dn.patternPositions.get(nn.scaleSelf(s.o.devicePixelRatio).toString()):null;Fn=!!gr&&!!wn,gr&&Gi.setConstantPatternPositions(gr,wn)}B>0&&(Fn||Gi.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Pe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Pi=d.getOrCreateProgram(_t,{config:Gi,defines:Mi?dt:Pe,overrideFog:tn});if(d.terrain&&d.terrain.setupElevationDraw(Xt,Pi,{useMeterToDem:!0}),!ri.centroidVertexBuffer){const Dn=Pi.getAttributeLocation(L,"a_centroid_pos");Dn!==-1&&L.vertexAttrib2f(Dn,0,0)}!Ke&&At&&At.setupShadows(Xt.tileID.toUnwrapped(),Pi,"vector-tile"),W&&(d.context.activeTexture.set(L.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Gi.updatePaintBuffers());const yn=o.paint.get("fill-extrusion-vertical-gradient"),Ni=1/ri.tileToMeter;let Bn;if(Ke&&At){if(Cd(Xt.tileID,ri.maxHeight,d))continue;const Dn=At.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());Bn=Dp(Dn,we,Ni,st,ht,zt)}else{const Dn=d.translatePosMatrix(Jt.expandedProjMatrix,Xt,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Wi=k.projection.createInversionMatrix(k,Jt.canonical);Bn=W?Ef(Dn,d,yn,X,re,we,Ni,Jt,Xt,fe,ht,zt,ge,me,Wi,Ve,st,B):wc(Dn,d,yn,X,re,we,Ni,Jt,fe,ht,zt,ge,me,Wi,Ve,st,ke,mt)}d.uploadCommonUniforms(R,Pi,Jt.toUnwrapped(),null,$e);let _n=ri.segments;if(k.projection.name==="mercator"&&!Ke&&(_n=ri.getVisibleSegments(Xt.tileID,d.terrain,d.transform.getFrustum(0)),!_n.get().length))continue;if($t)if(Ke)for(const Dn of _n.get())$t.numRenderedVerticesInShadowPass+=Dn.primitiveLength;else for(const Dn of _n.get())$t.numRenderedVerticesInTransparentPass+=Dn.primitiveLength;const In=[];(d.terrain||A)&&In.push(ri.centroidVertexBuffer),Ee&&In.push(ri.layoutVertexExtBuffer),Xe&&In.push(ri.wallVertexBuffer),Pi.draw(d,R.gl.TRIANGLES,y,x,T,Ht,Bn,o.id,ri.layoutVertexBuffer,ri.indexBuffer,_n,o.paint,d.transform.zoom,Gi,In)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}class as{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function _s(d,t,o,f,y,x,T,A,R,L,k,U,B,H,W,X,te,ee,re,he){const le=t.context,we=le.gl,fe=t.transform,Ee=t.transform.zoom,ge=[],me=d.translate,Se=d.translateAnchor,Ve=d.edgeRadius,ke=Ka(t,d.cutoffFadeRange);k==="clear"?(ge.push("CLEAR_SUBPASS"),he&&(ge.push("CLEAR_FROM_TEXTURE"),le.activeTexture.set(we.TEXTURE0),he.bind(we.LINEAR,we.CLAMP_TO_EDGE))):k==="sdf"&&ge.push("SDF_SUBPASS"),ee&&ge.push("HAS_CENTROID"),ke.shouldRenderCutoff&&ge.push("RENDER_CUTOFF");const st=(Xe,ht,zt,$e,Pe)=>{let dt=ge;ht.groundRadiusBuffer!=null&&(dt=ge.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Ke=ht.programConfigurations.get(f.id),At=t.isTileAffectedByFog(Xe),wt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ke,defines:dt,overrideFog:At}),Ht=vh(t,$e,U,L,Pe,[B,H*Pe],W,X,te,Ee>=17?0:Ve*Pe,he?he.size[0]:0),mt=[];ee&&mt.push(ht.hiddenByLandmarkVertexBuffer),ht.groundRadiusBuffer!=null&&mt.push(ht.groundRadiusBuffer),t.uploadCommonUniforms(le,wt,Xe.toUnwrapped(),null,ke),wt.draw(t,le.gl.TRIANGLES,x,T,A,R,Ht,f.id,ht.vertexBuffer,ht.indexBuffer,zt,f.paint,Ee,Ke,mt)};for(const Xe of y){const ht=o.getTile(Xe),zt=ht.getBucket(f);if(!zt||zt.projection.name!==fe.projection.name||!zt.groundEffect||zt.groundEffect&&!zt.groundEffect.hasData())continue;const $e=zt.groundEffect,Pe=1/zt.tileToMeter;{const dt=t.translatePosMatrix(Xe.projMatrix,ht,me,Se),Ke=$e.getDefaultSegment();st(Xe,$e,Ke,dt,Pe)}if(re)for(let dt=0;dt<4;dt++){const Ke=s.e8[dt](Xe),At=o.getTile(Ke);if(!At)continue;const wt=At.getBucket(f);if(!wt||wt.projection.name!==fe.projection.name||!wt.groundEffect||wt.groundEffect&&!wt.groundEffect.hasData())continue;const Ht=wt.groundEffect;let mt,_t;dt===0?(mt=[-s.al,0,0],_t=1):dt===1?(mt=[s.al,0,0],_t=0):dt===2?(mt=[0,-s.al,0],_t=3):(mt=[0,s.al,0],_t=2);const $t=Ht.regionSegments[_t];if(!$t)continue;const Jt=new Float32Array(16);s.bq(Jt,Xe.projMatrix,mt),st(Xe,Ht,$t,t.translatePosMatrix(Jt,ht,me,Se),Pe)}}}function Kl(d,t,o,f,y,x,T){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const A=x?x.findDEMTileFor(o):null;if(!(A&&A.dem||T))return;x&&A&&A.dem&&f.selfDEMTileTimestamp!==A.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=A.dem._timestamp);const R=ee=>new s.P(Math.ceil((ee+s.ec)*s.ed),0),L=ee=>{const re=t.getSource().minzoom,he=we=>{const fe=t.getTileByID(we);if(fe&&fe.hasData())return fe.getBucket(y)},le=[0,-1,1];for(const we of le){if(ee.overscaledZ+we<re)continue;const fe=he(ee.calculateScaledKey(ee.overscaledZ+we));if(fe)return fe}},k=[0,0,0],U=(ee,re)=>(k[0]=Math.min(ee.min.y,re.min.y),k[1]=Math.max(ee.max.y,re.max.y),k[2]=s.al-re.min.x>ee.max.x?re.min.x-s.al:ee.max.x,k),B=(ee,re)=>(k[0]=Math.min(ee.min.x,re.min.x),k[1]=Math.max(ee.max.x,re.max.x),k[2]=s.al-re.min.y>ee.max.y?re.min.y-s.al:ee.max.y,k),H=[(ee,re)=>U(ee,re),(ee,re)=>U(re,ee),(ee,re)=>B(ee,re),(ee,re)=>B(re,ee)],W=(ee,re,he,le,we,fe,Ee)=>{if(!x)return 0;const ge=[[fe?he:ee,fe?ee:he,0],[fe?he:re,fe?re:he,0]],me=Ee<0?s.al+Ee:Ee,Se=[fe?me:(ee+re)/2,fe?(ee+re)/2:me,0];return he===0&&Ee<0||he!==0&&Ee>0?x.getForTilePoints(we,[Se],!0,le):ge.push(Se),x.getForTilePoints(o,ge,!0,A),Math.max(ge[0][2],ge[1][2],Se[2])/x.exaggeration()};for(let ee=0;ee<4;ee++){const re=f.borderFeatureIndices[ee];if(re.length===0)continue;const he=s.e8[ee](o),le=L(he);if(!(le&&le instanceof s.e9))continue;const we=x?x.findDEMTileFor(he):null;if(!(we&&we.dem||T)||(x&&we&&we.dem&&f.borderDEMTileTimestamp[ee]!==we.dem._timestamp&&(f.borderDoneWithNeighborZ[ee]=-1,f.borderDEMTileTimestamp[ee]=we.dem._timestamp),f.borderDoneWithNeighborZ[ee]===le.canonical.z))continue;le.centroidVertexArray.length===0&&le.createCentroidsBuffer();const fe=(ee<2?1:5)-ee,Ee=le.borderDoneWithNeighborZ[fe]!==f.canonical.z,ge=le.borderFeatureIndices[fe];let me=0;if(f.canonical.z!==le.canonical.z){for(const Se of re)f.showCentroid(f.featuresOnBorder[Se]);if(Ee)for(const Se of ge)le.showCentroid(le.featuresOnBorder[Se]);f.borderDoneWithNeighborZ[ee]=le.canonical.z,le.borderDoneWithNeighborZ[fe]=f.canonical.z}for(const Se of re){const Ve=f.featuresOnBorder[Se],ke=f.centroidData[Ve.centroidDataIndex],st=Ve.borders[ee];let Xe;for(;me<ge.length;){Xe=le.featuresOnBorder[ge[me]];const ht=Xe.borders[fe];if(ht[1]>st[0]+3||ht[0]>st[0]-3)break;le.showCentroid(Xe),me++}if(Xe&&me<ge.length){const ht=me;let zt=0;for(;!(Xe.borders[fe][0]>st[1]-3)&&(zt++,++me!==ge.length);)Xe=le.featuresOnBorder[ge[me]];Xe=le.featuresOnBorder[ge[ht]];let $e=!1;if(zt>=1){const Ke=Xe.borders[fe];Math.abs(st[0]-Ke[0])<3&&Math.abs(st[1]-Ke[1])<3&&(zt=1,$e=!0,me=ht+1)}else if(zt===0){f.showCentroid(Ve);continue}const Pe=le.centroidData[Xe.centroidDataIndex];T&&$e&&(((X=ke).flags|(te=Pe).flags)&s.eb?(X.flags|=s.eb,te.flags|=s.eb):(X.flags&=~s.eb,te.flags&=~s.eb));const dt=Ve.intersectsCount()>1||Xe.intersectsCount()>1;if(zt>1)me=ht,ke.centroidXY=Pe.centroidXY=new s.P(0,0);else if(we&&we.dem&&!dt){const Ke=H[ee](ke,Pe),At=ee%2?s.al-1:0,wt=W(Ke[0],Math.min(s.al-1,Ke[1]),At,we,he,ee<2,Ke[2]);ke.centroidXY=Pe.centroidXY=R(wt)}else dt?ke.centroidXY=Pe.centroidXY=new s.P(0,0):(ke.centroidXY=f.encodeBorderCentroid(Ve),Pe.centroidXY=le.encodeBorderCentroid(Xe));f.writeCentroidToBuffer(ke),le.writeCentroidToBuffer(Pe)}else f.showCentroid(Ve)}f.borderDoneWithNeighborZ[ee]=le.canonical.z,le.borderDoneWithNeighborZ[fe]=f.canonical.z}var X,te;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(d)}const Ja=[1,0,0],Ai=[0,1,0],Id=[0,0,1];function Cd(d,t,o){const f=o.transform,y=o.shadowRenderer;if(!y)return!0;const x=d.toUnwrapped(),T=f.tileSize*y._cascades[o.currentShadowCascade].scale;let A=t;if(f.elevation){const X=f.elevation.getMinMaxForTile(d);X&&(A+=X.max)}const R=[...y.shadowDirection];R[2]=-R[2];const L=y.computeSimplifiedTileShadowVolume(x,A,T,R);if(!L)return!1;const k=[Ja,Ai,Id,R,[R[0],0,R[2]],[0,R[1],R[2]]],U=f.projection.name==="globe",B=f.scaleZoom(T),H=s.cA.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,B,!U),W=y.getCurrentCascadeFrustum();return H.intersectsPrecise(L.vertices,L.planes,k)===0||W.intersectsPrecise(L.vertices,L.planes,k)===0}function nu(d){const{painter:t,source:o,layer:f,coords:y}=d;let x=d.defines;const T=t.context,A=t.renderPass==="shadow",R=t.renderPass==="light-beam",L=t.shadowRenderer,k=s.ee(t.transform.center.lat,t.transform.zoom),U=Ka(t,f.paint.get("building-cutoff-fade-range"));U.shouldRenderCutoff&&(x=x.concat("RENDER_CUTOFF")),d.floodLightIntensity>0&&(x=x.concat("FLOOD_LIGHT"));for(const B of y){const H=o.getTile(B),W=H.getBucket(f);if(!W)continue;L&&L.getMaxCascadeForTile(B.toUnwrapped())===0&&(x=x.concat("SHADOWS_SINGLE_CASCADE"));const X=W.programConfigurations.get(f.id);let te,ee,re,he=t.translatePosMatrix(B.expandedProjMatrix,H,[0,0],"map");if(he=s.cR(s.bB(),he,[1,1,d.verticalScale]),A&&L){if(Cd(H.tileID,W.maxHeight*k,t))continue;let we=L.calculateShadowPassMatrixFromTile(H.tileID.toUnwrapped());we=s.cR(s.bB(),we,[1,1,d.verticalScale]),re=og(we),te=ee=t.getOrCreateProgram("buildingDepth",{config:X,defines:x,overrideFog:!1})}else if(R)te=ee=t.getOrCreateProgram("buildingBloom",{config:X,defines:x,overrideFog:!1}),re=tu(he);else{const we=t.transform.calculatePosMatrix(B.toUnwrapped(),t.transform.worldSize);s.cR(we,we,[1,1,d.verticalScale]);const fe=s.bB();s.cR(fe,we,[1,-1,1/k]),s.bk(fe,fe),s.ef(fe,fe);const Ee=t.transform.getFreeCameraOptions().position,ge=1<<B.canonical.z;if(re=eu(he,fe,d.opacity,d.facadeAOIntensity,[((Ee.x-B.wrap)*ge-B.canonical.x)*s.al,(Ee.y*ge-B.canonical.y)*s.al,Ee.z*ge*s.al],W.tileToMeter,d.facadeEmissiveChance,d.floodLightColor,d.floodLightIntensity),ee=t.getOrCreateProgram("building",{config:X,defines:x,overrideFog:!1}),d.depthOnly===!0)te=ee;else{const me=x.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);te=t.getOrCreateProgram("building",{config:X,defines:me,overrideFog:!1})}L&&(L.setupShadowsFromMatrix(we,ee,!0),te!==ee&&L.setupShadowsFromMatrix(we,te,!0))}const le=(we,fe)=>{if(R){const Ee=we.entranceBloom;fe.draw(t,T.gl.TRIANGLES,d.depthMode,Ui.disabled,d.blendMode,Li.disabled,re,f.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segmentsBucket,f.paint,t.transform.zoom,X,[Ee.layoutAttenuationBuffer,Ee.layoutColorBuffer])}else{const Ee=we.segmentsBucket;let ge=[we.layoutNormalBuffer,we.layoutCentroidBuffer,we.layoutColorBuffer,we.layoutFloodLightDataBuffer];we.layoutFacadePaintBuffer&&(ge=ge.concat([we.layoutFacadeDataBuffer,we.layoutFacadeVerticalRangeBuffer,we.layoutFacadePaintBuffer])),fe.draw(t,T.gl.TRIANGLES,d.depthMode,Ui.disabled,d.blendMode,A?Li.disabled:Li.backCW,re,f.id,we.layoutVertexBuffer,we.indexBuffer,Ee,f.paint,t.transform.zoom,X,ge)}};t.uploadCommonUniforms(T,ee,B.toUnwrapped(),null,U),W.buildingWithoutFacade&&le(W.buildingWithoutFacade,ee),W.buildingWithFacade&&(te!==ee&&t.uploadCommonUniforms(T,te,B.toUnwrapped(),null,U),le(W.buildingWithFacade,te))}}function kp(d,t,o,f,y,x,T,A,R,L,k,U,B){const H=d.context.gl,W=d.depthModeForSublayer(1,pi.ReadOnly,H.LEQUAL,!0),X=.1*(1-(te=k))+3*te;var te;const ee=d._showOverdrawInspector,re=U,he=new as;ee||_s(he,d,t,o,f,W,new Ui({func:H.ALWAYS,mask:255},255,255,H.KEEP,H.KEEP,H.REPLACE),new Xi([H.ONE,H.ONE,H.ONE,H.ONE],s.ao.transparent,[!1,!1,!1,!0],H.MIN),Li.disabled,y,"sdf",x,T,A,R,L,X,re,!1);{const le=ee?Ui.disabled:new Ui({func:H.EQUAL,mask:255},255,255,H.KEEP,H.DECR,H.DECR),we=ee?d.colorModeForRenderPass():new Xi([H.ONE_MINUS_DST_ALPHA,H.DST_ALPHA,H.ONE,H.ONE],s.ao.transparent,[!0,!0,!0,!0]);_s(he,d,t,o,f,W,le,we,Li.disabled,y,"color",x,T,A,R,L,X,re,!1)}}function Os(d){return[d[0]*s.eg,d[1]*s.eg,d[2]*s.eg,0]}function Df(d,t,o,f,y,x,T,A,R){const L=f.getSource(),k=o.globeSharedBuffers;if(!k)return;let U,B,H;if(t&&(U=f.getTile(t)),L instanceof s.aT?(B=L.texture,H=s.dJ(0,0,o.transform)):U&&t&&(B=U.texture,H=s.dJ(t.canonical.z,t.canonical.x,o.transform)),!B||!H)return;d||(H=s.cR(s.bB(),H,[1,-1,1]));const W=o.context,X=W.gl,te=y.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR,ee=o.colorModeForDrapableLayerRenderPass(x),re=T.defines;re.push("GLOBE_POLES");const he=new pi(X.LEQUAL,pi.ReadWrite,o.depthRangeFor3D),le=Float32Array.from(o.transform.expandedFarZProjMatrix),we=Float32Array.from(s.bj(s.dI(new s.cC(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),W.activeTexture.set(X.TEXTURE0),B.bind(te,X.CLAMP_TO_EDGE),W.activeTexture.set(X.TEXTURE1),B.bind(te,X.CLAMP_TO_EDGE),"useMipmap"in B&&W.extTextureFilterAnisotropic&&o.transform.pitch>20&&X.texParameterf(X.TEXTURE_2D,W.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,W.extTextureFilterAnisotropicMax);const[fe,Ee,ge,me]=t?k.getPoleBuffers(t.canonical.z,!1):k.getPoleBuffers(0,!0),Se=y.paint.get("raster-elevation");let Ve;d?(Ve=fe,o.renderDefaultNorthPole=Se!==0):(Ve=Ee,o.renderDefaultSouthPole=Se!==0);const ke=Os(T.mix),st=((ht,zt,$e,Pe,dt,Ke,At,wt,Ht,mt,_t,$t,Jt)=>wd(ht,zt,$e,new Float32Array(16),new Float32Array(9),[0,0],Pe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ke,[0,0],wt,2,mt,_t,$t,1,0,Jt))(le,we,H,s.aj(o.transform.zoom),0,y,0,Se,0,ke,T.offset,T.range,x),Xe=o.getOrCreateProgram("raster",{defines:re});o.uploadCommonUniforms(W,Xe,null),Xe.draw(o,X.TRIANGLES,he,R,ee,A,st,y.id,Ve,ge,me)}function Fp(d){const t=d._nearZ,o=d.projection.farthestPixelDistance(d),f=o-t,y=.2*d.height,x=t+y;return[t,o,(x-y-t)/f,(x-t)/f]}function M_(d,t,o,f){if(d)return t instanceof gs&&d instanceof ya?t.getTextureDescriptor(d,o,!0):{texture:d.texture,mix:Os(f.mix),offset:f.offset,buffer:0,tileSize:1}}var D_=s.eh([{name:"a_index",type:"Int16",components:1}]);class Ba{constructor(t,o,f,y){const x={width:f[0],height:f[1],data:null},T=t.gl;this.targetColorTexture=new s.T(t,x,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new s.T(t,x,T.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,y),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,y=o.width*o.height;this.particleTexture0=new s.T(this.context,o,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new s.T(this.context,o,f.RGBA8,{premultiply:!1,useMipmap:!1});const x=new s.ei;x.reserve(y);for(let T=0;T<y;T++)x.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(x,D_.members,!0),this.particleSegment=s.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=s.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Pf(d,t,o){if(!d)return null;const f=t.getTextureDescriptor(d,o,!0);if(!f)return null;let{texture:y,mix:x,offset:T,tileSize:A,buffer:R,format:L}=f;if(!y||!L)return null;let k=!1;return L==="uint32"&&(k=!0,x[3]=0,x=Pu(s.ej,x,[0,o.paint.get("raster-particle-max-speed")]),T=xl(s.ej,T,[0,o.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[R/(A+2*R),A/(A+2*R)],tileSize:A,scalarData:k,scale:x,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Lo(d){const t=d._nearZ,o=d.projection.farthestPixelDistance(d),f=o-t,y=.2*d.height,x=t+y;return[t,o,(x-y-t)/f,(x-t)/f]}const Rc=new s.ao(1,0,0,1),aa=new s.ao(0,1,0,1),ks=new s.ao(0,0,1,1),Rd=new s.ao(1,0,1,1),Th=new s.ao(0,1,1,1);function Md(d,t,o,f,y,x){for(let T=0;T<o.length;T++)if(y){const L=new s.ao(f.r*.8,f.g*.8,f.b*.8,1);la(d,t,o[T],f,-1,-1,x),la(d,t,o[T],f,-1,1,x),la(d,t,o[T],f,1,1,x),la(d,t,o[T],f,1,-1,x),la(d,t,o[T],L,0,0,x)}else la(d,t,o[T],f,0,0,x)}function la(d,t,o,f,y,x,T){const A=d.context,R=d.transform,L=A.gl,k=R.projection.name==="globe",U=k?["PROJECTION_GLOBE_VIEW"]:[];let B=s.by(o.projMatrix);if(k&&s.aj(R.zoom)>0){const ke=s.bi(o.canonical,R),st=s.ek(ke);B=s.aB(new Float32Array(16),R.globeMatrix,st),s.aB(B,R.projMatrix,B)}const H=s.bB();H[12]+=2*y/(s.o.devicePixelRatio*R.width),H[13]+=2*x/(s.o.devicePixelRatio*R.height),s.aB(B,H,B);const W=d.getOrCreateProgram("debug",{defines:U}),X=t.getTileByID(o.key);d.terrain&&d.terrain.setupElevationDraw(X,W);const te=pi.disabled,ee=Ui.disabled,re=d.colorModeForRenderPass(),he="$debug";A.activeTexture.set(L.TEXTURE0),d.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),k?X._makeGlobeTileDebugBuffers(d.context,R):X._makeDebugTileBoundsBuffers(d.context,R.projection);const le=X._tileDebugBuffer||d.debugBuffer,we=X._tileDebugIndexBuffer||d.debugIndexBuffer,fe=X._tileDebugSegments||d.debugSegments;if(W.draw(d,L.LINE_STRIP,te,ee,re,Li.disabled,Du(B,f.toPremultipliedRenderColor(null)),he,le,we,fe,null,null,null,[X._globeTileDebugBorderBuffer]),T){const ke=X.latestRawTileData,st=Math.floor((ke&&ke.byteLength||0)/1024);let Xe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Xe+=` => ${o.overscaledZ}`),Xe+=` ${X.state}`,Xe+=` ${st}kb`,(function(ht,zt){ht.initDebugOverlayCanvas();const $e=ht.debugOverlayCanvas,Pe=ht.context.gl,dt=ht.debugOverlayCanvas.getContext("2d");dt.clearRect(0,0,$e.width,$e.height),dt.shadowColor="white",dt.shadowBlur=2,dt.lineWidth=1.5,dt.strokeStyle="white",dt.textBaseline="top",dt.font="bold 36px Open Sans, sans-serif",dt.fillText(zt,5,5),dt.strokeText(zt,5,5),ht.debugOverlayTexture.update($e),ht.debugOverlayTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)})(d,Xe)}const Ee=t.getTile(o).tileSize,ge=512/Math.min(Ee,512)*(o.overscaledZ/R.zoom)*.5,me=X._tileDebugTextBuffer||d.debugBuffer,Se=X._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,Ve=X._tileDebugTextSegments||d.debugSegments;W.draw(d,L.TRIANGLES,te,ee,Xi.alphaBlended,Li.disabled,Du(B,s.ao.transparent.toPremultipliedRenderColor(null),ge),he,me,Se,Ve,null,null,null,[X._globeTileDebugTextBuffer])}function Yn(d,t,o,f){Fu(d,0,t+o/2,d.transform.width,o,f)}function ku(d,t,o,f){Fu(d,t-o/2,0,o,d.transform.height,f)}function Fu(d,t,o,f,y,x){const T=d.context,A=T.gl;A.enable(A.SCISSOR_TEST),A.scissor(t*s.o.devicePixelRatio,o*s.o.devicePixelRatio,f*s.o.devicePixelRatio,y*s.o.devicePixelRatio),T.clear({color:x}),A.disable(A.SCISSOR_TEST)}const Bp=s.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ag}=Bp;function Mc(d,t,o,f){d.emplaceBack(t,o,f)}class Np{constructor(t){this.vertexArray=new s.el,this.indices=new s.b0,Mc(this.vertexArray,-1,-1,1),Mc(this.vertexArray,1,-1,1),Mc(this.vertexArray,-1,1,1),Mc(this.vertexArray,1,1,1),Mc(this.vertexArray,-1,-1,-1),Mc(this.vertexArray,1,-1,-1),Mc(this.vertexArray,-1,1,-1),Mc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,ag),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=s.bf.simpleSegment(0,0,36,12)}}function el(d,t,o,f,y,x){const T=d.context.gl,A=t.paint.get("sky-atmosphere-color"),R=t.paint.get("sky-atmosphere-halo-color"),L=t.paint.get("sky-atmosphere-sun-intensity"),k=((U,B,H,W,X)=>({u_matrix_3f:U,u_sun_direction:B,u_sun_intensity:H,u_color_tint_r:[W.r,W.g,W.b,W.a],u_color_tint_m:[X.r,X.g,X.b,X.a],u_luminance:5e-5}))(s.en(s.dN(),f),y,L,A.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,t.skyboxTexture,0),o.draw(d,T.TRIANGLES,pi.disabled,Ui.disabled,Xi.unblended,Li.frontCW,k,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Bu=s.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class kt{constructor(t){const o=new s.eo;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const f=new s.b0;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,Bu.members),this.indexBuffer=t.createIndexBuffer(f),this.segments=s.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ti=s.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Eh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class rs{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Xi([1,Kr,1,Kr],s.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Xi([1,0,1,0],s.ao.transparent,[!1,!1,!1,!0]),this.params=new Eh,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new kt(o);const f=this.params.sizeRange,y=this.params.intensityRange,x=(function(k){const U=s.eq(30),B=[];for(let H=0;H<k;++H){const W=2*Math.PI*U(),X=Math.acos(1-2*U())-.5*Math.PI;B.push(s.d4(Math.cos(X)*Math.cos(W),Math.cos(X)*Math.sin(W),Math.sin(X)))}return B})(this.params.starsCount),T=s.eq(300),A=new s.ep,R=new s.b0;let L=0;for(let k=0;k<x.length;++k){const U=s.c4([],x[k],200),B=Math.max(0,1+.01*f*(1*T()-.5)),H=Math.max(0,1+.01*y*(1*T()-.5));A.emplaceBack(U[0],U[1],U[2],-1,-1,B,H),A.emplaceBack(U[0],U[1],U[2],1,-1,B,H),A.emplaceBack(U[0],U[1],U[2],1,1,B,H),A.emplaceBack(U[0],U[1],U[2],-1,1,B,H),R.emplaceBack(L+0,L+1,L+2),R.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=o.createVertexBuffer(A,ti.members),this.starsIdx=o.createIndexBuffer(R),this.starsSegments=s.bf.simpleSegment(0,0,A.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){const f=t.context,y=f.gl,x=t.transform,T=new pi(y.LEQUAL,pi.ReadOnly,[0,1]),A=s.aj(x.zoom),R=t.style.getLut(o.scope),L=o.properties.get("color-use-theme")==="none",k=o.properties.get("color").toNonPremultipliedRenderColor(L?null:R),U=o.properties.get("high-color-use-theme")==="none",B=o.properties.get("high-color").toNonPremultipliedRenderColor(U?null:R),H=o.properties.get("space-color-use-theme")==="none",W=o.properties.get("space-color").toNonPremultipliedRenderColor(H?null:R),X=5e-4,te=s.er(o.properties.get("horizon-blend"),0,1,X,.25),ee=s.dD(t,f,x)&&te===X?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,re=t.frameCounter/1e3%1,he=s.ag(x.globeCenterInViewSpace),le=Math.sqrt(Math.pow(he,2)-Math.pow(ee,2)),we=Math.acos(le/he),fe=Ee=>{const ge=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ee&&ge.push("ALPHA_PASS");const me=t.getOrCreateProgram("globeAtmosphere",{defines:ge}),Se=((ke,st,Xe,ht,zt,$e,Pe,dt,Ke,At,wt,Ht)=>({u_frustum_tl:ke,u_frustum_tr:st,u_frustum_br:Xe,u_frustum_bl:ht,u_horizon:zt,u_transition:$e,u_fadeout_range:Pe,u_atmosphere_fog_color:dt.toArray01(),u_high_color:Ke.toArray01(),u_space_color:At.toArray01(),u_temporal_offset:wt,u_horizon_angle:Ht}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,A,te,k,B,W,re,we);t.uploadCommonUniforms(f,me);const Ve=this.atmosphereBuffer;Ve&&me.draw(t,y.TRIANGLES,T,Ui.disabled,Ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Li.backCW,Se,Ee?"atmosphere_glow_alpha":"atmosphere_glow",Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)};fe(!1),fe(!0)}drawStars(t,o){const f=s.aA(o.properties.get("star-intensity"),0,1);if(f===0)return;const y=t.context,x=y.gl,T=t.transform,A=t.getOrCreateProgram("stars"),R=s.c6([]);s.c8(R,R,-T._pitch),s.c7(R,R,-T.angle),s.c8(R,R,s.an(T._center.lat)),s.es(R,R,-s.an(T._center.lng));const L=s.cb(new Float32Array(16),R),k=s.aB([],T.starsProjMatrix,L),U=s.en([],L),B=s.et([],U),H=[0,1,0];s.dP(H,H,B),s.c4(H,H,this.params.sizeMultiplier);const W=[1,0,0];s.dP(W,W,B),s.c4(W,W,this.params.sizeMultiplier);const X=(te=H,ee=W,re=f,{u_matrix:Float32Array.from(k),u_up:te,u_right:ee,u_intensity_multiplier:re});var te,ee,re;t.uploadCommonUniforms(y,A),this.starsVx&&this.starsIdx&&A.draw(t,x.TRIANGLES,pi.disabled,Ui.disabled,this.colorModeAlphaBlendedWriteRGB,Li.disabled,X,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ue{constructor(){this.visibleTiles=[]}updateBorders(t,o){const f=[],y=[],x=t._getRenderableCoordinates(!1,!0);for(const R of x){const L=t.getTile(R);if(!L.hasData())continue;const k=L.getBucket(o);k&&(k.isEmpty()||(f.push(R.key),y.push({bucket:k,tileID:R.canonical})))}let T=f.length!==this.visibleTiles.length;if(!T){f.sort();for(let R=0;R<f.length;R++)if(f[R]!==this.visibleTiles[R]){T=!0;break}}if(!T)return;const A=new Set;this.visibleTiles=f,y.sort(((R,L)=>R.tileID.z-L.tileID.z||R.tileID.x-L.tileID.x||R.tileID.y-L.tileID.y));for(const R of y){const L=new Array,k=new Array,U=R.bucket;for(const B of U.featuresOnBorder)A.has(B.featureId)?k.push(B.footprintIndex):(A.add(B.featureId),L.push(B.footprintIndex));U.updateFootprintHiddenFlags(L,s.eu,!1),U.updateFootprintHiddenFlags(k,s.eu,!0)}}}function Vp(d,t){const o=[...d],f=t.cameraWorldSizeForFog/t.worldSize,y=s.bz([]);return s.cR(y,y,[f,f,1]),s.aB(o,y,o),s.aB(o,t.worldToFogMatrix,o),o}function Sh(d,t,o,f,y){const x=o.material,T=f.context,{baseColorTexture:A,metallicRoughnessTexture:R}=x.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:k,emissionTexture:U}=x;function B(W,X,te){if(W&&(d.push(X),T.activeTexture.set(T.gl.TEXTURE0+te),W.gfxTexture)){const{minFilter:ee,magFilter:re,wrapS:he,wrapT:le}=W.sampler;W.gfxTexture.bindExtraParam(ee,re,he,le)}}B(A,"HAS_TEXTURE_u_baseColorTexture",po.BaseColor),B(R,"HAS_TEXTURE_u_metallicRoughnessTexture",po.MetallicRoughness),B(L,"HAS_TEXTURE_u_normalTexture",po.Normal),B(k,"HAS_TEXTURE_u_occlusionTexture",po.Occlusion),B(U,"HAS_TEXTURE_u_emissionTexture",po.Emission),y&&(y.texture||(y.texture=new s.d_(f.context,y.image,[y.image.height,y.image.height,y.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+po.LUT),y.texture&&y.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(d.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||d.push("DIFFUSE_SHADED");const H=f.shadowRenderer;H&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),H.useNormalOffset&&d.push("NORMAL_OFFSET"))}function Nu(d,t,o,f,y,x){const T=o.paint.get("model-opacity").constantOr(1),A=t.context,R=new pi(t.context.gl.LEQUAL,d.isLightMesh?pi.ReadOnly:pi.ReadWrite,t.depthRangeFor3D),L=t.transform,k=d.mesh,U=k.material,B=U.pbrMetallicRoughness,H=t.style.fog;let W;W=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:s.aB([],f.zScaleMatrix,d.nodeModelMatrix),s.aB(W,f.negCameraPosMatrix,W);const X=s.bk([],W);s.ef(X,X);const te=o.paint.get("model-color-use-theme").constantOr("default")==="none",ee=o.paint.get("model-emissive-strength").constantOr(0),re=zu(new Float32Array(d.worldViewProjection),new Float32Array(W),new Float32Array(X),null,t,T,B.baseColorFactor,U.emissiveFactor,B.metallicFactor,B.roughnessFactor,U,ee,o,void 0,void 0,d.materialOverride,d.modelColor),he={defines:[]},le=[],we=t.shadowRenderer;we&&(we.useNormalOffset=!1),Sh(he.defines,le,k,t,te?null:o.lut);let fe=null;if(H){const me=Vp(d.nodeModelMatrix,t.transform);if(fe=new Float32Array(me),L.projection.name!=="globe"){const Se=k.aabb.min,Ve=k.aabb.max,[ke,st]=H.getOpacityForBounds(me,Se[0],Se[1],Ve[0],Ve[1]);he.overrideFog=ke>=We||st>=We}}const Ee=Ka(t,o.paint.get("model-cutoff-fade-range"));Ee.shouldRenderCutoff&&he.defines.push("RENDER_CUTOFF");const ge=t.getOrCreateProgram("model",he);t.uploadCommonUniforms(A,ge,null,fe,Ee),t.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(d.nodeModelMatrix,ge),ge.draw(t,A.gl.TRIANGLES,R,y,x,k.material.doubleSided?Li.disabled:Li.backCCW,re,o.id,k.vertexBuffer,k.indexBuffer,k.segments,o.paint,t.transform.zoom,void 0,le)}function Of(d,t,o){return d.type==="vector"?t.scope:o?"basemap":""}function Lf(d,t,o,f,y,x,T,A,R){const L=d.transform,k=!!t.isGeometryBloom&&t.isGeometryBloom;if(k&&d.renderPass==="shadow")return;const U=L.projection.name==="globe"?s.eC(o,L):[...o];s.aB(U,U,t.globalMatrix);const B=s.aB([],f,U);if(t.meshes)for(const H of t.meshes){const W=A.get(H.material.name);if(W&&W.opacity<=0)continue;if(H.material.alphaMode!=="BLEND"){T.push({mesh:H,depth:0,modelIndex:y,worldViewProjection:B,nodeModelMatrix:U,isLightMesh:k,materialOverride:W,modelColor:R});continue}const X=s.af([],H.centroid,B);!L.isOrthographic&&X[2]<=0||x.push({mesh:H,depth:X[2],modelIndex:y,worldViewProjection:B,nodeModelMatrix:U,isLightMesh:k,materialOverride:W,modelColor:R})}if(t.children)for(const H of t.children)Lf(d,H,o,f,y,x,T,A,R)}function Ah(d,t,o,f){const y=o.shadowRenderer;if(!y)return;const x=y.getShadowPassDepthMode(),T=y.getShadowPassColorMode(),A=y.calculateShadowPassMatrixFromMatrix(t),R=Ac(A);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,x,Ui.disabled,T,Li.disabled,R,f.id,d.vertexBuffer,d.indexBuffer,d.segments,f.paint,o.transform.zoom,void 0,void 0)}function Ih(d,t,o,f,y,x){for(const T of y){const A=Object.assign({},f);A.part=T;const R={type:"Unknown",id:t,properties:A},L={orientation:d.paint.get("model-rotation").evaluate(R,o)};x.set(T,L)}}function P_(d,t,o,f,y,x){for(const T of y){const A=Object.assign({},f);A.part=T;const R={type:"Unknown",id:t,properties:A},L={color:d.paint.get("model-color").evaluate(R,o),colorMix:d.paint.get("model-color-mix-intensity").evaluate(R,o),opacity:d.paint.get("model-opacity").evaluate(R,o),emissionStrength:d.paint.get("model-emissive-strength").evaluate(R,o)};x.set(T,L)}}function O_(d,t,o,f,y,x){if(o===1)for(const A of y)Nu(A,d,t,x[A.modelIndex],Ui.disabled,d.colorModeForRenderPass());else{for(const A of y)Nu(A,d,t,x[A.modelIndex],Ui.disabled,Xi.disabled);for(const A of y)Nu(A,d,t,x[A.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}const T=Xi.additive;for(const A of f)Nu(A,d,t,x[A.modelIndex],Ui.disabled,A.isLightMesh?T:d.colorModeForRenderPass())}function lg(d,t,o){const f=t.updateZoomBasedPaintProperties(),y=(function(x,T,A){let R,L,k,U=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&U>0){const B=x.terrain,H=B.findDEMTileFor(A);H&&H.dem?R=s.eE.create(B,A,H):U=0}if(U===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),U===T.validForExaggeration&&(U===0||R&&R._demTile&&R._demTile.tileID===T.validForDEMTile.id&&R._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const B in T.instancesPerModel){const H=T.instancesPerModel[B];for(let W=0;W<H.instancedDataArray.length;++W){const X=(R?U*R.getElevationAt(0|H.instancedDataArray.float32[16*W],0|H.instancedDataArray.float32[16*W+1],!0,!0):0)+H.instancesEvaluatedElevation[W];H.instancedDataArray.float32[16*W+6]=X,L=L?Math.min(T.terrainElevationMin,X):X,k=k?Math.max(T.terrainElevationMax,X):X}}return T.terrainElevationMin=L||0,T.terrainElevationMax=k||0,T.validForExaggeration=U,T.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0})(d,t,o);(f||y)&&(t.uploaded=!1,t.upload(d.context))}const zo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.d8([0,0,0],[s.al,s.al,0])};function Up(d,t){const o=1<<d.canonical.z,f=t.getFreeCameraOptions().position,y=t.elevation,x=d.canonical.x/o,T=(d.canonical.x+1)/o,A=d.canonical.y/o,R=(d.canonical.y+1)/o;let L=t._centerAltitude;if(y){const H=y.getMinMaxForTile(d);H&&H.max>L&&(L=H.max)}const k=s.aA(f.x,x,T)-f.x,U=s.aA(f.y,A,R)-f.y,B=s.ce(L,t.center.lat)-f.z;return t._zoomFromMercatorZ(Math.sqrt(k*k+U*U+B*B))}function Dd(d,t,o,f,y,x,T){const A=d.context,R=d.renderPass==="shadow",L=d.shadowRenderer,k=R&&L?L.getShadowPassDepthMode():new pi(A.gl.LEQUAL,pi.ReadWrite,d.depthRangeFor3D),U=d.isTileAffectedByFog(x),B=d.transform.projection.name==="globe";if(o.meshes)for(const H of o.meshes){const W=B?[]:["MODEL_POSITION_ON_GPU"],X=[];let te,ee,re;const he=!B&&f.instancedDataArray.length>20;he&&W.push("INSTANCED_ARRAYS");const le=Ka(d,t.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),R&&L)te=d.getOrCreateProgram("modelDepth",{defines:W}),ee=Ac(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(o.globalMatrix)),re=L.getShadowPassColorMode();else{Sh(W,X,H,d,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),te=d.getOrCreateProgram("model",{defines:W,overrideFog:U});const fe=H.material,Ee=fe.pbrMetallicRoughness,ge=t.paint.get("model-opacity").constantOr(1),me=t.paint.get("model-emissive-strength").constantOr(0);ee=zu(x.expandedProjMatrix,Float32Array.from(o.globalMatrix),new Float32Array(16),null,d,ge,Ee.baseColorFactor,fe.emissiveFactor,Ee.metallicFactor,Ee.roughnessFactor,fe,me,t,y),L&&(T.shadowUniformsInitialized?te.setShadowUniformValues(A,L.getShadowUniformValues()):(L.setupShadows(x.toUnwrapped(),te,"model-tile"),T.shadowUniformsInitialized=!0)),re=le.shouldRenderCutoff||ge<1||fe.alphaMode!=="OPAQUE"?Xi.alphaBlended:Xi.unblended}d.uploadCommonUniforms(A,te,x.toUnwrapped(),null,le);const we=H.material.doubleSided?Li.disabled:Li.backCCW;if(he)X.push(f.instancedDataBuffer),te.draw(d,A.gl.TRIANGLES,k,Ui.disabled,re,we,ee,t.id,H.vertexBuffer,H.indexBuffer,H.segments,t.paint,d.transform.zoom,void 0,X,f.instancedDataArray.length);else{const fe=R?"u_instance":"u_normal_matrix";for(let Ee=0;Ee<f.instancedDataArray.length;++Ee)ee[fe]=new Float32Array(f.instancedDataArray.arrayBuffer,64*Ee,16),te.draw(d,A.gl.TRIANGLES,k,Ui.disabled,re,we,ee,t.id,H.vertexBuffer,H.indexBuffer,H.segments,t.paint,d.transform.zoom,void 0,X)}}if(o.children)for(const H of o.children)Dd(d,t,H,f,y,x,T)}const zf=[1,-1,1];function kf(d,t,o,f){if(!o.modelManager)return!0;const y=o.modelManager;if(!o.shadowRenderer)return!0;const x=o.shadowRenderer,T=t.aabb;let A=!0,R=d.maxHeight;if(R===0){let k=0;for(const U in d.instancesPerModel){const B=y.getModel(U,f);B?k=Math.max(k,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):A=!1}R=d.maxScale*k*1.41+d.maxVerticalOffset,A&&(d.maxHeight=R)}T.max[2]=R,T.min[2]+=d.terrainElevationMin,T.max[2]+=d.terrainElevationMax,s.af(T.min,T.min,t.tileMatrix),s.af(T.max,T.max,t.tileMatrix);const L=T.intersects(x.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=L===2),L===0}function Ch(d,t){const o=d.uniformValues.u_cutoff_params[0],f=d.uniformValues.u_cutoff_params[1],y=d.uniformValues.u_cutoff_params[2],x=d.uniformValues.u_cutoff_params[3];return f===o||x===y?1:s.aA(((t-o)/(f-o)-y)/(x-y),0,1)}function Rh(d,t,o,f){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();s.aB(y,y,d);const x=s.bT(o.min[0],o.min[1],o.min[2],1);let T=s.aC(s.eF(),x,y),A=T,R=T;x[1]=o.max[1],T=s.aC(s.eF(),x,y),A=T[1]<A[1]?T:A,R=T[1]>R[1]?T:R,x[0]=o.max[0],T=s.aC(s.eF(),x,y),A=T[1]<A[1]?T:A,R=T[1]>R[1]?T:R,x[1]=o.min[1],T=s.aC(s.eF(),x,y),A=T[1]<A[1]?T:A,R=T[1]>R[1]?T:R;const L=s.aA(f[0],0,1),k=100*t.pixelsPerMeter*s.aA(f[1],0,1),U=s.aA(f[2],0,1),B=s.eG(s.eF(),A,R,L),H=Math.tan(.5*t.fovX),W=-B[2]*H;if(k===0)return B[1]<-Math.abs(W)?U:1;const X=(-Math.abs(W)-B[1])/k,te=(re,he,le)=>(1-le)*re+le*he,ee=s.aA(te(1,U,X),U,1);return te(1,ee,s.aA((t.pitch-20)/20,0,1))}class cg{}class ug{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,f){{const U=this._storage.get(o.id);if(U)return U.lastUsedFrameIdx=t,U.buf}const y=f.gl,x=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),T=new ArrayBuffer(x),A=new Int16Array(T);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const R=new s.eI;for(let U=0;U<x/2;U+=3){const B=A[U],H=A[U+1],W=A[U+2];R.emplaceBack(B,H),R.emplaceBack(H,W),R.emplaceBack(W,B)}const L=f.bindVertexArrayOES.current,k=new cg;return k.buf=new iu(f,R),k.lastUsedFrameIdx=t,this._storage.set(o.id,k),f.bindVertexArrayOES.set(L),k.buf}update(t){for(const[o,f]of this._storage)t-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(o))}destroy(){for(const[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class L_{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const hg=s.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class z_{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Eo{constructor(t,o){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const k_=s.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Pd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){const f=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new s.eJ,A=new s.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),A.emplaceBack(0,1,2),A.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(T,k_.members),this.vignetteIdx=t.context.createIndexBuffer(A)}const y=s.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,f);const T={u_vignetteShape:(x={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};f.draw(t,t.context.gl.TRIANGLES,pi.disabled,Ui.disabled,Xi.alphaBlended,Li.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,y)}var x}}class Tr{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){const f=t.getFreeCameraOptions().position,y=f.toAltitude(),x=f.toLngLat(),T=s.an(x.lng),A=s.an(x.lat),R=t.pixelsPerMeter/o,L=T*s.eL,k=s.eL*Math.log(Math.tan(Math.PI/4+A/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+k,B=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*R,this._accumulatedOffsetY+=U*R,this._accumulatedElevation+=B*R,this._offsetXPrev=L,this._offsetYPrev=k,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function hn(d,t){return[-(d[0]-Math.floor(d[0]/t)*t),-(d[1]-Math.floor(d[1]/t)*t),-(d[2]-Math.floor(d[2]/t)*t)]}function jp(d){const t=s.eq(1323123451230),o=[];for(let f=0;f<d;++f){const y=2*t()-1,x=2*t()-1,T=2*t()-1;o.push(s.d4(y,x,T))}return o}function Sa(d,t,o,f,y){const x=s.aA((y-o)/(f-o),0,1);return(1-x)*d+x*t}class ru{constructor(t){this._movement=new Tr,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Pd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){const f=t.transform;this._movement.update(f,this._ppmScaleFactor);const y=f.starsProjMatrix,x=s.c6([]);s.c8(x,x,s.an(90)-f._pitch),s.c7(x,x,-f.angle);const T=s.cb(new Float32Array(16),x),A=s.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=s.ef([],A),L=s.aB([],R,T),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*o,this._prevTime=k,{projectionMatrix:y,modelviewMatrix:L}}}class Mh extends ru{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Eo(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const f=jp(this.particlesCount),y=new s.eM,x=new s.b0;let T=0;const A=s.eq(1323123451230);for(let R=0;R<f.length;++R){const L=f[R],k=[2*A()-1,A(),A(),A()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...k),y.emplaceBack(L[0],L[1],L[2],1,-1,...k),y.emplaceBack(L[0],L[1],L[2],1,1,...k),y.emplaceBack(L[0],L[1],L[2],-1,1,...k),x.emplaceBack(T+0,T+1,T+2),x.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=o.createVertexBuffer(y,hg.members),this.particlesIdx=o.createIndexBuffer(x)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=t.transform.zoom;if(o.revealStart>f)return;const y=Sa(0,1,o.revealStart,o.revealStart+o.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let T=[-x.direction.x,x.direction.y,-100];s.aw(T,T);const A=structuredClone(this._vignetteParams);A.strength*=y,x.overrideStyleParameters||(x.intensity=t.style.rain.state.density,x.timeFactor=t.style.rain.state.intensity,x.color=structuredClone(t.style.rain.state.color),T=structuredClone(t.style.rain.state.direction),x.screenThinning.intensity=t.style.rain.state.centerThinning,x.dropletSizeX=t.style.rain.state.dropletSize[0],x.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],x.distortionStrength=100*t.style.rain.state.distortionStrength,A.strength=1,A.color=structuredClone(t.style.rain.state.vignetteColor));const R=this.updateOnRender(t,x.timeFactor),L=t.context,k=L.gl,U=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new s.T(L,{width:t.width,height:t.height,data:null},k.RGBA8)),x.distortionStrength>0&&(L.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(L,B),L.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const H=[x.color.r,x.color.g,x.color.b,x.color.a],W=(X,te)=>{const ee=hn(this._movement.getPosition(),X),re=x.dropletSizeX,he=x.dropletSizeX*x.dropletSizeYScale,le=t.width/2,we=t.height/2,fe=Sa(0,x.screenThinning.start,0,1,x.screenThinning.intensity),Ee=Sa(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),ge=Sa(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),me=(Se={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ee,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:X,rainDropletSize:[re,he],distortionStrength:x.distortionStrength,rainDirection:T,color:H,screenSize:[U.width,U.height],thinningCenterPos:[le,we],thinningShape:[fe,Ee,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:ge,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:te?0:1},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_texScreen:0,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_boxSize:Se.boxSize,u_rainDropletSize:Se.rainDropletSize,u_distortionStrength:Se.distortionStrength,u_rainDirection:Se.rainDirection,u_color:Se.color,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_shapeDirectionalPower:Se.shapeDirectionalPower,u_shapeNormalPower:Se.shapeNormalPower,u_mode:Se.mode});var Se;const Ve=Math.round(x.intensity*this.particlesCount),ke=s.bf.simpleSegment(0,0,4*Ve,2*Ve);B.draw(t,k.TRIANGLES,pi.disabled,Ui.disabled,Xi.alphaBlended,Li.disabled,me,"rain_particles",this.particlesVx,this.particlesIdx,ke)};x.distortionStrength>0&&W(x.boxSize,!0),W(x.boxSize,!1),this._vignette.draw(t,A)}}const Dc=s.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ff extends ru{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Eo(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const f=jp(this.particlesCount),y=new s.eN,x=new s.b0;let T=0;const A=s.eq(1323123451230);for(let R=0;R<f.length;++R){const L=f[R],k=A(),U=A(),B=A(),H=[R/f.length,k,U,B],W=[A(),A()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...H,...W),y.emplaceBack(L[0],L[1],L[2],1,-1,...H,...W),y.emplaceBack(L[0],L[1],L[2],1,1,...H,...W),y.emplaceBack(L[0],L[1],L[2],-1,1,...H,...W),x.emplaceBack(T+0,T+1,T+2),x.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=o.createVertexBuffer(y,Dc.members),this.particlesIdx=o.createIndexBuffer(x)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const o=structuredClone(this._params);let f=[-o.direction.x,o.direction.y,-100];s.aw(f,f);const y=structuredClone(this._vignetteParams),x=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=t.transform.zoom;if(x.revealStart>T)return;const A=Sa(0,1,x.revealStart,x.revealStart+x.revealRange,T);y.strength*=A,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),f=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const R=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=t.context,k=L.gl,U=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(L,B),((H,W,X)=>{const te=hn(this._movement.getPosition(),H),ee=U.width/2,re=U.height/2,he=Sa(0,X.screenThinning.start,0,1,X.screenThinning.intensity),le=Sa(.001,X.screenThinning.range,0,1,X.screenThinning.intensity),we=Sa(0,X.screenThinning.particleOffset,0,1,X.screenThinning.intensity),fe=(Ee={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:X.velocityConeAperture,velocity:X.velocity,horizontalOscillationRadius:X.horizontalOscillationRadius,horizontalOscillationRate:X.horizontalOscillationRate,boxSize:H,billboardSize:1*X.billboardSize,simpleShapeParameters:[X.shapeFadeStart,X.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[ee,re],thinningShape:[he,le,Math.pow(10,X.screenThinning.fadePower)],thinningAffectedRatio:X.screenThinning.affectedRatio,thinningParticleOffset:we,color:[X.color.r,X.color.g,X.color.b,X.color.a],direction:f},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_horizontalOscillationRadius:Ee.horizontalOscillationRadius,u_horizontalOscillationRate:Ee.horizontalOscillationRate,u_boxSize:Ee.boxSize,u_billboardSize:Ee.billboardSize,u_simpleShapeParameters:Ee.simpleShapeParameters,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_particleColor:Ee.color,u_direction:Ee.direction});var Ee;const ge=Math.round(X.intensity*this.particlesCount),me=s.bf.simpleSegment(0,0,4*ge,2*ge);this.particlesVx&&this.particlesIdx&&B.draw(t,k.TRIANGLES,pi.disabled,Ui.disabled,Xi.alphaBlended,Li.disabled,fe,"snow_particles",this.particlesVx,this.particlesIdx,me)})(o.boxSize,0,o),this._vignette.draw(t,y)}}const Gp={symbol:function(d,t,o,f,y){if(d.renderPass!=="translucent")return;const x=Ui.disabled,T=d.colorModeForRenderPass(),A=o.layout.get("text-variable-anchor"),R=o.layout.get("text-size-scale-range"),L=s.aA(d.scaleFactor,R[0],R[1]);A&&(function(B,H,W,X,te,ee,re,he){const le=H.transform,we=te==="map",fe=ee==="map";for(const Ee of B){const ge=X.getTile(Ee),me=ge.getBucket(W);if(!me||!me.text||!me.text.segments.get().length)continue;const Se=s.bJ(me.textSizeData,le.zoom,he),Ve=bu(Ee,me.getProjection(),le),ke=le.calculatePixelsToTileUnitsMatrix(ge),st=hc(Ve,ge.tileID.canonical,fe,we,le,me.getProjection(),ke),Xe=me.hasIconTextFit()&&me.hasIconData();Se&&Mf(me,we,fe,re,le,st,Ee,Math.pow(2,le.zoom-ge.tileID.overscaledZ),Se,Xe)}})(f,d,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),y,L);const k=o.paint.get("icon-opacity").constantOr(1)!==0,U=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||U)?wl(d,t,o,f,x,T):(k&&wl(d,t,o,f,x,T,{onlyIcons:!0}),U&&wl(d,t,o,f,x,T,{onlyText:!0})),t.map.showCollisionBoxes&&(Zo(d,t,o,f,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Zo(d,t,o,f,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,o,f){if(d.renderPass!=="translucent")return;const y=o.paint.get("circle-opacity"),x=o.paint.get("circle-stroke-width"),T=o.paint.get("circle-stroke-opacity"),A=o.layout.get("circle-sort-key").constantOr(1)!==void 0,R=o.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const L=d.context,k=L.gl,U=d.transform,B=!(!d.terrain||!d.terrain.enabled),H=o.layout.get("circle-elevation-reference"),W=d.depthModeForSublayer(0,pi.ReadOnly),X=new pi(d.context.gl.LEQUAL,pi.ReadOnly,d.depthRangeFor3D),te=H==="none"||B?W:X,ee=Ui.disabled,re=d.colorModeForDrapableLayerRenderPass(R),he=U.projection.name==="globe",le=[s.aF(U.center.lng),s.aJ(U.center.lat)],we=[];for(let Ee=0;Ee<f.length;Ee++){const ge=f[Ee],me=t.getTile(ge),Se=me.getBucket(o);if(!Se||Se.projection.name!==U.projection.name)continue;const Ve=Se.programConfigurations.get(o.id),ke=Se.layoutVertexBuffer,st=Se.globeExtVertexBuffer,Xe=Se.indexBuffer,ht=s.d$(o),zt=[st],$e=d.isTileAffectedByFog(ge);he&&ht.push("PROJECTION_GLOBE_VIEW"),ht.push("DEPTH_D24"),d.terrain&&U.depthOcclusionForSymbolsAndCircles&&ht.push("DEPTH_OCCLUSION"),Se.hasElevation&&!d.terrain&&(ht.push("ELEVATED_ROADS"),zt.push(Se.elevatedLayoutVertexBuffer));const Pe=d.getOrCreateProgram("circle",{config:Ve,defines:ht,overrideFog:$e}),dt=U.projection.createInversionMatrix(U,ge.canonical),Ke={programConfiguration:Ve,program:Pe,layoutVertexBuffer:ke,dynamicBuffers:zt,indexBuffer:Xe,uniformValues:s.e0(d,ge,me,dt,le,o),tile:me};if(A){const At=Se.segments.get();for(const wt of At)we.push({segments:new s.bf([wt]),sortKey:wt.sortKey,state:Ke})}else we.push({segments:Se.segments,sortKey:0,state:Ke})}A&&we.sort(((Ee,ge)=>Ee.sortKey-ge.sortKey));const fe={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const Ee of we){const{programConfiguration:ge,program:me,layoutVertexBuffer:Se,dynamicBuffers:Ve,indexBuffer:ke,uniformValues:st,tile:Xe}=Ee.state,ht=Ee.segments;d.terrain&&d.terrain.setupElevationDraw(Xe,me,fe),d.uploadCommonUniforms(L,me,Xe.tileID.toUnwrapped()),me.draw(d,k.TRIANGLES,te,ee,re,Li.disabled,st,o.id,Se,ke,ht,o.paint,U.zoom,ge,Ve)}},heatmap:function(d,t,o,f){if(o.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const y=d.context,x=y.gl,T=Ui.disabled,A=new Xi([x.ONE,x.ONE,x.ONE,x.ONE],s.ao.transparent,[!0,!0,!0,!0]);(function(H,W,X,te){const ee=H.gl,re=W.width*te,he=W.height*te;H.activeTexture.set(ee.TEXTURE1),H.viewport.set([0,0,re,he]);let le=X.heatmapFbo;if(!le||le&&(le.width!==re||le.height!==he)){le&&le.destroy();const we=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,we),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),le=X.heatmapFbo=H.createFramebuffer(re,he,!0,null),(function(fe,Ee,ge,me,Se,Ve){const ke=fe.gl;ke.texImage2D(ke.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?ke.RGBA16F:ke.RGBA,Se,Ve,0,ke.RGBA,fe.extRenderToTextureHalfFloat?ke.HALF_FLOAT:ke.UNSIGNED_BYTE,null),me.colorAttachment.set(ge)})(H,0,we,le,re,he)}else ee.bindTexture(ee.TEXTURE_2D,le.colorAttachment.get()),H.bindFramebuffer.set(le.framebuffer)})(y,d,o,d.transform.projection.name==="globe"?.5:.25),y.clear({color:s.ao.transparent});const R=d.transform,L=R.projection.name==="globe",k=L?["PROJECTION_GLOBE_VIEW"]:[],U=L?Li.frontCCW:Li.disabled,B=[s.aF(R.center.lng),s.aJ(R.center.lat)];for(let H=0;H<f.length;H++){const W=f[H];if(t.hasRenderableParent(W))continue;const X=t.getTile(W),te=X.getBucket(o);if(!te||te.projection.name!==R.projection.name)continue;const ee=d.isTileAffectedByFog(W),re=te.programConfigurations.get(o.id),he=d.getOrCreateProgram("heatmap",{config:re,defines:k,overrideFog:ee}),{zoom:le}=d.transform;d.terrain&&d.terrain.setupElevationDraw(X,he),d.uploadCommonUniforms(y,he,W.toUnwrapped());const we=R.projection.createInversionMatrix(R,W.canonical);he.draw(d,x.TRIANGLES,pi.disabled,T,A,U,Af(d,W,X,we,B,le,o.paint.get("heatmap-intensity")),o.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,o.paint,d.transform.zoom,re,L?[te.globeExtVertexBuffer]:null)}y.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),(function(y,x){const T=y.context,A=T.gl,R=x.heatmapFbo;if(!R)return;T.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),T.activeTexture.set(A.TEXTURE1);let L=x.colorRampTexture;L||(L=x.colorRampTexture=new s.T(T,x.colorRamp,A.RGBA8)),L.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,A.TRIANGLES,pi.disabled,Ui.disabled,y.colorModeForRenderPass(),Li.disabled,((k,U,B,H)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)})(d,o))},line:function(d,t,o,f){if(d.renderPass!=="translucent")return;const y=o.paint.get("line-opacity"),x=o.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;const T=o.paint.get("line-emissive-strength"),A=o.paint.get("line-occlusion-opacity"),R=o.layout.get("line-elevation-reference"),L=o.layout.get("line-width-unit")==="meters",k=R==="sea",U=!(!d.terrain||!d.terrain.enabled),B=d.context,H=B.gl;if(o.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const W=o.layout.get("line-cross-slope"),X=W!==void 0,te=W<1,ee=d.colorModeForDrapableLayerRenderPass(T),re=d.terrain&&d.terrain.renderingToTexture,he=re?1:s.o.devicePixelRatio,le=o.paint.get("line-dasharray"),we=le.constantOr(1),fe=o.layout.get("line-cap"),Ee=le.constantOr(null),ge=fe.constantOr(null),me=o.paint.get("line-pattern"),Se=me.constantOr(1),Ve=o.paint.get("line-pattern-cross-fade"),ke=me.constantOr(null),st=o.paint.get("line-opacity").constantOr(1);let Xe=!Se&&st!==1||d.depthOcclusion&&A>0&&A<1;const ht=o.paint.get("line-gradient"),zt=Se?"linePattern":"line",$e=s.e1(o);let Pe;if(re&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),A!==0&&d.depthOcclusion){const wt=o.paint._values["line-opacity"];wt&&wt.value&&wt.value.kind==="constant"?Pe=wt.value:s.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&$e.push("VARIABLE_LINE_WIDTH");const dt=(wt,Ht,mt,_t,$t,Jt)=>{for(const Xt of wt){const ri=t.getTile(Xt);if(Se&&!ri.patternsLoaded())continue;const Mi=ri.getBucket(o);if(!Mi||Mi.elevationType!=="none"&&!$t||Mi.elevationType==="none"&&$t)continue;d.prepareDrawTile();const tn=[...Ht],Gi=d.shadowRenderer,Fn=Mi.elevationType==="road"&&!!Gi&&Gi.enabled;let Pi=[0,0,0];if(Fn){const Ei=d.style.directionalLight,pn=d.style.ambientLight;Ei&&pn&&(Pi=Wo(d.style,Ei,pn)),tn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const yn=Mi.programConfigurations.get(o.id);let Ni=!1;if(ke&&ri.imageAtlas){const Ei=s.e2.from(ke),pn=Ei.getPrimary().scaleSelf(he).toString(),br=ri.imageAtlas.patternPositions.get(pn),Er=Ei.getSecondary(),zr=Er?ri.imageAtlas.patternPositions.get(Er.scaleSelf(he).toString()):null;Ni=!!br&&!!zr,br&&yn.setConstantPatternPositions(br,zr)}Ve>0&&(Ni||yn.getPatternTransitionVertexBuffer("line-pattern"))&&tn.push("LINE_PATTERN_TRANSITION");const Bn=d.isTileAffectedByFog(Xt),_n=d.getOrCreateProgram(zt,{config:yn,defines:tn,overrideFog:Bn});if(!Se&&Ee&&ge&&ri.lineAtlas){const Ei=ri.lineAtlas.getDash(Ee,ge);Ei&&yn.setConstantPatternPositions(Ei)}Fn&&Gi.setupShadows(ri.tileID.toUnwrapped(),_n,"vector-tile");let[In,Dn]=o.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&In!==Dn&&(In===0&&(In-=1),Dn===1&&(Dn+=1));const Wi=re?Xt.projMatrix:null,Un=L?1/Mi.tileToMeter/s.ay(ri,1,d.transform.zoom):1,nn=L?1/Mi.tileToMeter/s.ay(ri,1,Math.floor(d.transform.zoom)):1,gr=Se?s.e3(d,ri,o,Wi,he,Un,nn,[In,Dn],Pi,Ve):s.e4(d,ri,o,Wi,Mi.lineClipsArray.length,he,Un,nn,[In,Dn],Pi);if(ht){const Ei=Mi.gradients[o.id];let pn=Ei.texture;if(o.gradientVersion!==Ei.version){let br=256;if(o.stepInterpolant){const Er=t.getSource().maxzoom,zr=Xt.canonical.z===Er?Math.ceil(1<<d.transform.maxZoom-Xt.canonical.z):1;br=s.aA(s.e5(Mi.maxLineLength/s.al*1024*zr),256,B.maxTextureSize)}Ei.gradient=s.e6({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:br,image:Ei.gradient||void 0,clips:Mi.lineClipsArray}),Ei.texture?Ei.texture.update(Ei.gradient):Ei.texture=new s.T(B,Ei.gradient,H.RGBA8),Ei.version=o.gradientVersion,pn=Ei.texture}B.activeTexture.set(H.TEXTURE1),pn.bind(o.stepInterpolant?H.NEAREST:H.LINEAR,H.CLAMP_TO_EDGE)}we&&(B.activeTexture.set(H.TEXTURE0),ri.lineAtlasTexture&&ri.lineAtlasTexture.bind(H.LINEAR,H.REPEAT),yn.updatePaintBuffers()),Se&&(B.activeTexture.set(H.TEXTURE0),ri.imageAtlasTexture&&ri.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),yn.updatePaintBuffers()),$t&&!k&&d.terrain.setupElevationDraw(ri,_n),d.uploadCommonUniforms(B,_n,Xt.toUnwrapped());const wn=Ei=>{Pe!=null&&(Pe.value=st*A),_n.draw(d,H.TRIANGLES,mt,Ei,ee,Li.disabled,gr,o.id,Mi.layoutVertexBuffer,Mi.indexBuffer,Mi.segments,o.paint,d.transform.zoom,yn,[Mi.layoutVertexBuffer2,Mi.patternVertexBuffer,Mi.zOffsetVertexBuffer]),Pe!=null&&(Pe.value=st)};if(Xe&&!$t){const Ei=d.stencilModeForClipping(Xt).ref;Ei===0&&re&&B.clear({stencil:0});const pn={func:H.EQUAL,mask:255};gr.u_alpha_discard_threshold=.8,wn(new Ui(pn,Ei,255,H.KEEP,H.KEEP,H.INVERT)),gr.u_alpha_discard_threshold=0,wn(new Ui(pn,Ei,255,H.KEEP,H.KEEP,H.KEEP))}else gr.u_alpha_discard_threshold=Xe&&$t&&Jt?.8:0,wn($t?_t:d.stencilModeForClipping(Xt))}};let Ke=d.depthModeForSublayer(0,pi.ReadOnly);const At=new pi(d.depthOcclusion?H.GREATER:H.LEQUAL,pi.ReadOnly,d.depthRangeFor3D);if(o.hasNonElevatedBuckets){const wt=!re&&d.terrain;A!==0&&wt?s.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):wt?s.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):dt(f,$e,Ke,Ui.disabled,!1,!0)}if(o.hasElevatedBuckets){R==="hd-road-markup"?U||(Ke=At,$e.push("ELEVATED_ROADS")):($e.push("ELEVATED"),Ke=At,X&&$e.push(te?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&$e.push("ELEVATION_REFERENCE_SEA"));const wt=Xe?d.stencilModeFor3D():Ui.disabled;d.forceTerrainMode=!0,dt(f,$e,Ke,wt,!0,!0),Xe&&dt(f,$e,Ke,wt,!0,!1),d.forceTerrainMode=!1}Xe&&(d.resetStencilClippingMasks(),re&&B.clear({stencil:0})),A===0||d.depthOcclusion||re||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,t,o,f){const y=o.paint.get("fill-color"),x=o.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=o.paint.get("fill-emissive-strength"),A=d.colorModeForDrapableLayerRenderPass(T),R=o.paint.get("fill-pattern"),L=d.opaquePassEnabledForLayer()&&!R.constantOr(1)&&y.constantOr(s.ao.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let k="none";o.layout.get("fill-elevation-reference")!=="none"?k="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const U=!(!d.terrain||!d.terrain.enabled),B={painter:d,sourceCache:t,layer:o,coords:f,colorMode:A,elevationType:k,terrainEnabled:U,pass:L};if(d.renderPass!=="shadow")if(k!=="offset"){if(Fa(B,!1),k==="road"){const H=!U&&d.renderPass==="translucent";H&&Cc(d,t,o,f,"geometry"),Fa(B,!0,Ui.disabled),H&&(function(W){const{painter:X,sourceCache:te,layer:ee,coords:re,colorMode:he}=W,le=X.context.gl,we=W.painter.shadowRenderer,fe=!!we&&we.enabled,Ee=new pi(X.context.gl.LEQUAL,pi.ReadOnly,X.depthRangeFor3D);let ge=[0,0,0];if(fe){const Se=X.style.directionalLight,Ve=X.style.ambientLight;Se&&Ve&&(ge=Wo(X.style,Se,Ve))}const me=Se=>{for(const Ve of re){const ke=te.getTile(Ve),st=ke.getBucket(ee);if(!st)continue;const Xe=st.elevatedStructures;if(!Xe)continue;let ht,zt;if(Se?(ht=Xe.renderableBridgeSegments,zt=Xe.bridgeProgramConfigurations.get(ee.id)):(ht=Xe.renderableTunnelSegments,zt=Xe.tunnelProgramConfigurations.get(ee.id)),!ht||ht.segments[0].primitiveLength===0)continue;zt.updatePaintBuffers(),X.prepareDrawTile();const $e=X.isTileAffectedByFog(Ve),Pe=[];fe&&Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const dt=X.getOrCreateProgram("elevatedStructures",{config:zt,overrideFog:$e,defines:Pe}),Ke=X.translatePosMatrix(Ve.projMatrix,ke,ee.paint.get("fill-translate"),ee.paint.get("fill-translate-anchor"));fe&&we.setupShadows(ke.tileID.toUnwrapped(),dt,"vector-tile");const At=C_(Ke,ge);X.uploadCommonUniforms(X.context,dt,Ve.toUnwrapped()),dt.draw(X,le.TRIANGLES,Ee,Ui.disabled,he,Li.backCCW,At,ee.id,Xe.vertexBuffer,Xe.indexBuffer,ht,ee.paint,X.transform.zoom,zt,[Xe.vertexBufferNormal])}};me(!0),me(!1)})(B)}}else Fa(B,!1,d.stencilModeFor3D());else d.shadowRenderer&&k==="road"&&!U&&(function(H){const{painter:W,sourceCache:X,layer:te,coords:ee}=H,re=W.context.gl,he=H.painter.shadowRenderer;for(const le of ee){const we=X.getTile(le),fe=we.getBucket(te);if(!fe)continue;const Ee=fe.elevatedStructures;if(!Ee||!Ee.shadowCasterSegments||Ee.shadowCasterSegments.segments[0].primitiveLength===0)continue;W.prepareDrawTile();const ge=fe.bufferData.programConfigurations.get(te.id),me=W.isTileAffectedByFog(le),Se=W.getOrCreateProgram("elevatedStructuresDepth",{config:ge,overrideFog:me}),Ve=he.calculateShadowPassMatrixFromTile(we.tileID.toUnwrapped());W.uploadCommonUniforms(W.context,Se,le.toUnwrapped());const ke={u_matrix:Ve,u_depth_bias:0};Se.draw(W,re.TRIANGLES,he.getShadowPassDepthMode(),Ui.disabled,he.getShadowPassColorMode(),Li.disabled,ke,te.id,Ee.vertexBuffer,Ee.indexBuffer,Ee.shadowCasterSegments,te.paint,W.transform.zoom,ge)}})(B)},"fill-extrusion":function(d,t,o,f){const y=o.paint.get("fill-extrusion-opacity"),x=d.context,T=x.gl,A=d.terrain,R=A&&A.renderingToTexture;if(y===0)return;const L=d.conflationActive&&d.style.isLayerClipped(o,t.getSource()),k=d.style.order.indexOf(o.fqid);if(L&&(function(U,B,H,W,X){for(const te of W){const ee=B.getTile(te).getBucket(H);ee&&(ee.updateReplacement(te,U.replacementSource,X),ee.uploadCentroid(U.context))}})(d,t,o,f,k),A||L)for(const U of f){const B=t.getTile(U).getBucket(o);B&&Kl(d.context,t,U,B,o,A,L)}if(d.renderPass==="shadow"&&d.shadowRenderer){const U=d.shadowRenderer;if(A&&y<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.ad)return;const B=U.getShadowPassDepthMode(),H=U.getShadowPassColorMode();Lt(d,t,o,f,B,Ui.disabled,H,L)}else if(d.renderPass==="translucent"){const U=!o.paint.get("fill-extrusion-pattern").constantOr(1),B=o.paint.get("fill-extrusion-color").constantOr(s.ao.white);if(!R&&B.a!==0){const H=new pi(d.context.gl.LEQUAL,pi.ReadWrite,d.depthRangeFor3D);y===1&&U?Lt(d,t,o,f,H,Ui.disabled,Xi.unblended,L):(Lt(d,t,o,f,H,Ui.disabled,Xi.disabled,L),Lt(d,t,o,f,H,d.stencilModeFor3D(),d.colorModeForRenderPass(),L),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&U&&(!A&&d.transform.projection.name!=="globe"||R)){const H=o.paint.get("fill-extrusion-opacity"),W=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),X=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),te=o.paint.get("fill-extrusion-flood-light-intensity"),ee=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",re=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ee?null:o.lut).toArray01().slice(0,3),he=W>0&&X>0,le=te>0,we=(ge,me,Se)=>(1-Se)*ge+Se*me,fe=new as;fe.translate=o.paint.get("fill-extrusion-translate"),fe.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),fe.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),fe.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");const Ee=ge=>{const me=d.depthModeForSublayer(1,pi.ReadOnly,T.LEQUAL,!0),Se=o.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ve=we(.1,3,Se),ke=d._showOverdrawInspector;if(!ke){const st=new Ui({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Xe=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);_s(fe,d,t,o,f,me,st,Xe,Li.disabled,ge,"sdf",H,W,X,te,re,Ve,L,!1)}{const st=ke?Ui.disabled:new Ui({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Xe=ke?d.colorModeForRenderPass():new Xi([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],s.ao.transparent,[!0,!0,!0,!0]);_s(fe,d,t,o,f,me,st,Xe,Li.disabled,ge,"color",H,W,X,te,re,Ve,L,!1)}};if(R){const ge=(me,Se,Ve)=>{const ke=d.depthModeForSublayer(1,pi.ReadOnly,T.LEQUAL,!1),st=o.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Xe=we(.1,3,st);{const ht=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0]);_s(fe,d,t,o,f,ke,Ui.disabled,ht,Li.disabled,me,"clear",H,W,X,te,re,Xe,L,Se)}{const ht=new Ui({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),zt=new Xi([T.ONE,T.ONE,T.ONE,T.ONE],s.ao.transparent,[!1,!1,!1,!0],T.MIN);_s(fe,d,t,o,f,ke,ht,zt,Li.disabled,me,"sdf",H,W,X,te,re,Xe,L,Se)}{const ht=me?T.ZERO:T.ONE_MINUS_DST_ALPHA,zt=new Ui({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),$e=new Xi([ht,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],s.ao.transparent,[!0,!0,!0,!0]);_s(fe,d,t,o,f,ke,zt,$e,Li.disabled,me,"color",H,W,X,te,re,Xe,L,Se)}{const ht=new Xi([T.ONE,T.ONE,T.ONE,me?T.ZERO:T.ONE],s.ao.transparent,[!1,!1,!1,!0],me?T.FUNC_ADD:T.MAX);_s(fe,d,t,o,f,ke,Ui.disabled,ht,Li.disabled,me,"clear",H,W,X,te,re,Xe,L,Se,Ve)}};if(he||le){let me;if(d.prepareDrawTile(),A){const Se=A.drapeBufferSize[0],Ve=A.drapeBufferSize[1];me=A.framebufferCopyTexture,me&&(!me||me.size[0]===Se&&me.size[1]===Ve)||(me&&me.destroy(),me=A.framebufferCopyTexture=new s.T(x,new s.q({width:Se,height:Ve}),T.RGBA8)),me.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,Se,Ve)}he&&ge(!0,!1,me),le&&ge(!1,!0,me)}}else he&&Ee(!0),le&&Ee(!1),(he||le)&&d.resetStencilClippingMasks()}}},building:function(d,t,o,f){d.currentLayer<d.firstLightBeamLayer&&(d.firstLightBeamLayer=d.currentLayer);const y=o.paint.get("building-ambient-occlusion-ground-intensity"),x=o.paint.get("building-ambient-occlusion-ground-radius"),T=o.paint.get("building-ambient-occlusion-ground-attenuation"),A=o.paint.get("building-opacity");if(A<=0)return;let R=y>0&&x>0,L=!0;const k=o.paint.get("building-vertical-scale");if(k<=0)return;(!d.shadowRenderer||k<1)&&(L=!1);const U=d.conflationActive&&d.style.isLayerClipped(o,t.getSource()),B=d.style.order.indexOf(o.fqid);if((function(H,W,X,te,ee,re){for(const he of re){const le=W.getTile(he).getBucket(X);le&&(ee&&le.updateReplacement(he,H.replacementSource,te),le.uploadUpdatedIndexBuffer(H.context))}})(d,t,o,B,U,f),(function(H,W,X,te){for(const ee of te){const re=W.getTile(ee).getBucket(X);re&&re.needsEvaluation()&&re.uploadUpdatedColorBuffer(H.context)}})(d,t,o,f),o.resetLayerRenderingStats(d),d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0),d.renderPass==="shadow"&&d.shadowRenderer){const H=d.shadowRenderer,W=[],X=H.getShadowPassDepthMode();nu({painter:d,source:t,layer:o,coords:f,defines:W,blendMode:H.getShadowPassColorMode(),depthMode:X,opacity:A,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(d.renderPass==="translucent"){let H=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&(H=H.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),d.shadowRenderer&&d.shadowRenderer.useNormalOffset&&(H=H.concat("NORMAL_OFFSET"));const W=o.paint.get("building-facade-emissive-chance"),X=o.paint.get("building-ambient-occlusion-intensity"),te=o.paint.get("building-flood-light-intensity"),ee=o.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",re=o.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ee?null:o.lut).toArray01().slice(0,3),he=o.paint.get("building-flood-light-ground-attenuation"),le=te>0,we=new pi(d.context.gl.LEQUAL,pi.ReadWrite,d.depthRangeFor3D);A<1&&nu({painter:d,source:t,layer:o,coords:f,defines:H,blendMode:Xi.disabled,depthMode:we,opacity:A,verticalScale:k,facadeEmissiveChance:W,facadeAOIntensity:X,floodLightIntensity:te,floodLightColor:re,depthOnly:!0});const fe=d.colorModeForRenderPass();nu({painter:d,source:t,layer:o,coords:f,defines:H,blendMode:fe,depthMode:we,opacity:A,verticalScale:k,facadeEmissiveChance:W,facadeAOIntensity:X,floodLightIntensity:te,floodLightColor:re}),R&&kp(d,t,o,f,!0,A,y,x,te,re,T,U),le&&kp(d,t,o,f,!1,A,y,x,te,re,he,U)}else if(d.renderPass==="light-beam"){const H=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],W=new pi(d.context.gl.LEQUAL,pi.ReadOnly,d.depthRangeFor3D);nu({painter:d,source:t,layer:o,coords:f,defines:H,blendMode:Xi.alphaBlended,depthMode:W,opacity:A,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1),d.resetStencilClippingMasks()},hillshade:function(d,t,o,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const y=d.context,x=d.terrain&&d.terrain.renderingToTexture,[T,A]=d.renderPass!=="translucent"||x?[{},f]:d.stencilConfigForOverlap(f);for(const R of A){const L=t.getTile(R);if(L.needsHillshadePrepare&&d.renderPass==="offscreen")I_(d,L,o);else if(d.renderPass==="translucent"){const k=d.depthModeForSublayer(0,pi.ReadOnly),U=o.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(U),H=x&&d.terrain?d.terrain.stencilModeForRTTOverlap(R):T[R.overscaledZ];mh(d,R,L,o,k,H,B)}}y.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,o,f,y,x){if(d.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const T=d.transform.projection.name==="globe",A=o.paint.get("raster-elevation")!==0,R=A&&T;if(d.renderElevatedRasterBackface&&!R)return;const L=d.context,k=L.gl,U=t.getSource(),B=(function(fe,Ee,ge,me){const Se=Ee.paint.get("raster-color"),Ve=fe.type==="raster-array",ke=[],st=Ee.paint.get("raster-resampling"),Xe=Ee.paint.get("raster-color-mix");let ht=Ee.paint.get("raster-color-range");const zt=[Xe[0],Xe[1],Xe[2],0],$e=Xe[3];let Pe=st==="nearest"?me.NEAREST:me.LINEAR;if(Ve&&(ke.push("RASTER_ARRAY"),Se||ke.push("RASTER_COLOR"),st==="linear"&&ke.push("RASTER_ARRAY_LINEAR"),Pe=me.NEAREST,!ht&&fe.rasterLayers)){const dt=fe.rasterLayers.find((({id:Ke})=>Ke===Ee.sourceLayer));dt&&dt.fields&&dt.fields.range&&(ht=dt.fields.range)}if(ht=ht||[0,1],Se){ke.push("RASTER_COLOR"),ge.activeTexture.set(me.TEXTURE2),Ee.updateColorRamp(ht);let dt=Ee.colorRampTexture;dt||(dt=Ee.colorRampTexture=new s.T(ge,Ee.colorRamp,me.RGBA8)),dt.bind(me.LINEAR,me.CLAMP_TO_EDGE)}return{mix:zt,range:ht,offset:$e,defines:ke,resampling:Pe}})(U,o,L,k);if(U instanceof s.aT&&!f.length&&!T)return;const H=o.paint.get("raster-emissive-strength"),W=d.colorModeForDrapableLayerRenderPass(H),X=d.terrain&&d.terrain.renderingToTexture,te=!d.options.moving,ee=o.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(U instanceof s.aT&&!f.length&&(U.onNorthPole||U.onSouthPole)){const fe=A?d.stencilModeFor3D():Ui.disabled;return void Df(!!U.onNorthPole,null,d,t,o,H,B,Li.disabled,fe)}if(!f.length)return;const[re,he]=U instanceof s.aT||X?[{},f]:d.stencilConfigForOverlap(f),le=he[he.length-1].overscaledZ;R&&B.defines.push("PROJECTION_GLOBE_VIEW"),A&&B.defines.push("RENDER_CUTOFF");const we=(fe,Ee,ge)=>{for(const me of fe){const Se=me.toUnwrapped(),Ve=t.getTile(me);if(X&&(!Ve||!Ve.hasData()))continue;L.activeTexture.set(k.TEXTURE0);const ke=M_(Ve,U,o,B);if(!ke||!ke.texture)continue;const{texture:st,mix:Xe,offset:ht,tileSize:zt,buffer:$e}=ke;let Pe,dt;X?(Pe=pi.disabled,dt=me.projMatrix):A?(Pe=new pi(k.LEQUAL,pi.ReadWrite,d.depthRangeFor3D),dt=T?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Se,te)):(Pe=d.depthModeForSublayer(me.overscaledZ-le,o.paint.get("raster-opacity")===1?pi.ReadWrite:pi.ReadOnly,k.LESS),dt=d.transform.calculateProjMatrix(Se,te));const Ke=d.terrain&&X?d.terrain.stencilModeForRTTOverlap(me):re[me.overscaledZ],At=x?0:o.paint.get("raster-fade-duration");Ve.registerFadeDuration(At);const wt=t.findLoadedParent(me,0),Ht=Mp(Ve,wt,t,d.transform,At);let mt,_t;!Ht.isFading&&Ve.refreshedUponExpiration&&(Ve.refreshedUponExpiration=!1),d.terrain&&d.terrain.prepareDrawTile(),L.activeTexture.set(k.TEXTURE0),st.bind(ee,k.CLAMP_TO_EDGE),L.activeTexture.set(k.TEXTURE1),wt?(wt.texture&&wt.texture.bind(ee,k.CLAMP_TO_EDGE),mt=Math.pow(2,wt.tileID.overscaledZ-Ve.tileID.overscaledZ),_t=[Ve.tileID.canonical.x*mt%1,Ve.tileID.canonical.y*mt%1]):st.bind(ee,k.CLAMP_TO_EDGE),"useMipmap"in st&&L.extTextureFilterAnisotropic&&d.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const $t=d.transform;let Jt;const Xt=A?Fp($t):[0,0,0,0];let ri,Mi,tn,Gi,Fn,Pi=0;if(R&&U instanceof s.aT&&U.coordinates.length>3)ri=Float32Array.from(s.bj(s.dI(new s.cC(0,0,0)))),Mi=Float32Array.from($t.globeMatrix),tn=Float32Array.from(s.dE($t)),Gi=[s.aF($t.center.lng),s.aJ($t.center.lat)],Jt=U.elevatedGlobePerspectiveTransform,Fn=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const _n=s.dF(me.canonical);Pi=s.dG(_n.getCenter().lat),ri=Float32Array.from(s.bj(s.dI(me.canonical))),Mi=Float32Array.from($t.globeMatrix),tn=Float32Array.from(s.dE($t)),Gi=[s.aF($t.center.lng),s.aJ($t.center.lat)],Jt=[0,0],Fn=Float32Array.from(s.dH(me.canonical,_n,Pi,$t.worldSize/$t._pixelsPerMercatorPixel))}else Jt=U instanceof s.aT?U.perspectiveTransform:[0,0],ri=new Float32Array(16),Mi=new Float32Array(9),tn=new Float32Array(16),Gi=[0,0],Fn=new Float32Array(9);const yn=wd(dt,ri,Mi,tn,Fn,_t||[0,0],s.aj(d.transform.zoom),Gi,Xt,mt||1,Ht,o,Jt,A?o.paint.get("raster-elevation"):0,2,Xe,ht,B.range,zt,$e,H),Ni=d.isTileAffectedByFog(me),Bn=d.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Ni});if(d.uploadCommonUniforms(L,Bn,Se),U instanceof s.aT){const _n=U.elevatedGlobeVertexBuffer,In=U.elevatedGlobeIndexBuffer;if(X||!T)U.boundsBuffer&&U.boundsSegments&&Bn.draw(d,k.TRIANGLES,Pe,Ui.disabled,W,Li.disabled,yn,o.id,U.boundsBuffer,d.quadTriangleIndexBuffer,U.boundsSegments);else if(_n&&In){const Dn=$t.zoom<=s.cZ?U.elevatedGlobeSegments:U.getSegmentsForLongitude($t.center.lng);Dn&&Bn.draw(d,k.TRIANGLES,Pe,Ui.disabled,W,Ee,yn,o.id,_n,In,Dn)}}else if(R){Pe=new pi(k.LEQUAL,pi.ReadOnly,d.depthRangeFor3D);const _n=d.globeSharedBuffers;if(_n){const[In,Dn,Wi]=_n.getGridBuffers(Pi,!1);Bn.draw(d,k.TRIANGLES,Pe,ge||Ke,d.colorModeForRenderPass(),Ee,yn,o.id,In,Dn,Wi)}}else{const{tileBoundsBuffer:_n,tileBoundsIndexBuffer:In,tileBoundsSegments:Dn}=d.getTileBoundsBuffers(Ve);Bn.draw(d,k.TRIANGLES,Pe,Ke,W,Li.disabled,yn,o.id,_n,In,Dn)}}if(!(U instanceof s.aT)&&R)for(const me of fe){const Se=me.canonical.y===(1<<me.canonical.z)-1;me.canonical.y===0&&Df(!0,me,d,t,o,H,B,Ee,ge||Ui.disabled),Se&&Df(!1,me,d,t,o,H,B,Ee===Li.frontCW?Li.backCW:Li.frontCW,ge||Ui.disabled)}};R?we(he,d.renderElevatedRasterBackface?Li.backCW:Li.frontCW,d.stencilModeFor3D()):we(he,Li.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,o,f,y,x){d.renderPass==="offscreen"&&(function(T,A,R,L){if(!L.length)return;const k=T.context,U=k.gl,B=A.getSource();if(!(B instanceof gs))return;const H=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let W=R.particlePositionRGBAImage;if(!W||W.width!==H){const he=(function(le){const we=le*le,fe=new Uint8Array(4*we),Ee=function(me){return me|=0,me=Math.imul(2747636419^me,2654435769),me=Math.imul(me^me>>>16,2654435769),((me=Math.imul(me^me>>>16,2654435769))>>>0)/4294967296},ge=1/1.1;for(let me=0;me<we;me++){const Se=ge*(Ee(2*me+0)+Ou),Ve=ge*(Ee(2*me+1)+Ou),ke=255*Se%1,st=255*Ve%1,Xe=ke,ht=Ve-st/255,zt=st;fe[4*me+0]=255*(Se-ke/255),fe[4*me+1]=255*Xe,fe[4*me+2]=255*ht,fe[4*me+3]=255*zt}return fe})(H);W=R.particlePositionRGBAImage=new s.q({width:H,height:H},he)}let X=R.particleFramebuffer;X?X.width!==H&&(X.destroy(),X=R.particleFramebuffer=k.createFramebuffer(H,H,!0,null)):X=R.particleFramebuffer=k.createFramebuffer(H,H,!0,null);const te=[];for(const he of L){const le=A.getTile(he);if(!(le instanceof ya))continue;const we=Pf(le,B,R);if(!we)continue;const fe=[le.tileSize,le.tileSize];let Ee=R.tileFramebuffer;Ee||(Ee=R.tileFramebuffer=k.createFramebuffer(fe[0],fe[1],!0,null));let ge=le.rasterParticleState;ge||(ge=le.rasterParticleState=new Ba(k,he,fe,W));const me=ge.update(R.lastInvalidatedAt);ge.particleTextureDimension!==H&&ge.updateParticleTexture(he,W);const Se=ge.targetColorTexture;ge.targetColorTexture=ge.backgroundColorTexture,ge.backgroundColorTexture=Se;const Ve=ge.particleTexture0;ge.particleTexture0=ge.particleTexture1,ge.particleTexture1=Ve,te.push([he,we,ge,me])}if(te.length===0)return;const ee=s.o.now(),re=R.previousDrawTimestamp?.001*(ee-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=ee,R.hasColorMap()){k.activeTexture.set(U.TEXTURE0+2);let he=R.colorRampTexture;he||(he=R.colorRampTexture=new s.T(k,R.colorRamp,U.RGBA8)),he.bind(U.LINEAR,U.CLAMP_TO_EDGE)}k.bindFramebuffer.set(R.tileFramebuffer.framebuffer),(function(he,le,we){const fe=he.context,Ee=fe.gl,ge=le.tileFramebuffer;fe.activeTexture.set(Ee.TEXTURE0);const me={u_texture:0,u_opacity:1.05*(Ve=le.paint.get("raster-particle-fade-opacity-factor"))/(Ve+.05)},Se=he.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ve;for(const ke of we){const[,,st,Xe]=ke;ge.colorAttachment.set(st.targetColorTexture.texture),fe.viewport.set([0,0,ge.width,ge.height]),fe.clear({color:s.ao.transparent}),Xe&&(st.backgroundColorTexture.bind(Ee.NEAREST,Ee.CLAMP_TO_EDGE),Se.draw(he,Ee.TRIANGLES,pi.disabled,Ui.disabled,Xi.alphaBlended,Li.disabled,me,le.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments))}})(T,R,te),(function(he,le,we,fe){const Ee=he.context,ge=Ee.gl,me=we.tileFramebuffer,Se=he.transform.projection.name==="globe",Ve=we.paint.get("raster-particle-max-speed");for(const ke of fe){const[st,Xe,ht]=ke;Ee.activeTexture.set(ge.TEXTURE0+0),Xe.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),me.colorAttachment.set(ht.targetColorTexture.texture);const zt=he.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});Ee.activeTexture.set(ge.TEXTURE0+1);const $e=Xe.scalarData?[]:[0,1,2,3].map((Ke=>s.e8[Ke](st)));$e.push(st);const Pe=st.canonical.x,dt=st.canonical.y;for(const Ke of $e){const At=le.getTile(Se?Ke.wrapped():Ke);if(!At)continue;const wt=At.rasterParticleState;if(!wt)continue;const Ht=Ke.canonical.x+(1<<Ke.canonical.z)*(Ke.wrap-st.wrap),mt=Ke.canonical.y;wt.particleTexture0.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const _t=If(1,wt.particleTexture0.size[0],[Ht-Pe,mt-dt],0,Xe.texture.size,2,Ve,Xe.textureOffset,Xe.scale,Xe.offset);zt.draw(he,ge.POINTS,pi.disabled,Ui.disabled,Xi.alphaBlended,Li.disabled,_t,we.id,wt.particleIndexBuffer,void 0,wt.particleSegment)}}})(T,A,R,te),k.bindFramebuffer.set(R.particleFramebuffer.framebuffer),(function(he,le,we,fe){const Ee=he.context,ge=Ee.gl,me=le.paint.get("raster-particle-max-speed"),Se=fe*le.paint.get("raster-particle-speed-factor")*.15,Ve=(function(st){return Math.pow(st,6)})(.01+1*le.paint.get("raster-particle-reset-rate-factor")),ke=le.particleFramebuffer;Ee.viewport.set([0,0,ke.width,ke.height]);for(const st of we){const[,Xe,ht]=st;Ee.activeTexture.set(ge.TEXTURE0+0),Xe.texture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Ee.activeTexture.set(ge.TEXTURE0+1);const zt=ht.particleTexture0;zt.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);const $e=Td(1,zt.size[0],0,Xe.texture.size,me,Se,Ve,Xe.textureOffset,Xe.scale,Xe.offset);ke.colorAttachment.set(ht.particleTexture1.texture),Ee.clear({color:s.ao.transparent}),he.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(he,ge.TRIANGLES,pi.disabled,Ui.disabled,Xi.unblended,Li.disabled,$e,le.id,he.viewportBuffer,he.quadTriangleIndexBuffer,he.viewportSegments)}})(T,R,te,re)})(d,t,o,f),d.renderPass==="translucent"&&((function(T,A,R,L,k){const U=T.context,B=U.gl,H=A.getSource().tileSize,W=5*(1-s.ah(s.cK,s.cK+1,T.transform.zoom))*H+R.paint.get("raster-particle-elevation"),X=!T.options.moving,te=T.transform.projection.name==="globe";if(!L.length)return;const[ee,re]=T.stencilConfigForOverlap(L),he=[];te&&he.push("PROJECTION_GLOBE_VIEW");const le=T.stencilModeFor3D();for(const we of re){const fe=we.toUnwrapped(),Ee=A.getTile(we);if(!Ee.rasterParticleState)continue;const ge=Ee.rasterParticleState,me=100;Ee.registerFadeDuration(me);const Se=A.findLoadedParent(we,0),Ve=Mp(Ee,Se,A,T.transform,me);let ke,st;T.terrain&&T.terrain.prepareDrawTile(),U.activeTexture.set(B.TEXTURE0),ge.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),U.activeTexture.set(B.TEXTURE1),Se&&Se.rasterParticleState?(Se.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ke=Math.pow(2,Se.tileID.overscaledZ-Ee.tileID.overscaledZ),st=[Ee.tileID.canonical.x*ke%1,Ee.tileID.canonical.y*ke%1]):ge.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Xe=te?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(fe,X),ht=T.transform,zt=Lo(ht),$e=s.dF(we.canonical),Pe=s.dG($e.getCenter().lat);let dt,Ke,At,wt,Ht;te?(dt=Float32Array.from(s.bj(s.dI(we.canonical))),Ke=Float32Array.from(ht.globeMatrix),At=Float32Array.from(s.dE(ht)),wt=[s.aF(ht.center.lng),s.aJ(ht.center.lat)],Ht=Float32Array.from(s.dH(we.canonical,$e,Pe,ht.worldSize/ht._pixelsPerMercatorPixel))):(dt=new Float32Array(16),Ke=new Float32Array(9),At=new Float32Array(16),wt=[0,0],Ht=new Float32Array(9));const mt=Ea(Xe,dt,Ke,At,Ht,st||[0,0],s.aj(T.transform.zoom),wt,zt,ke||1,Ve,W),_t=T.isTileAffectedByFog(we),$t=T.getOrCreateProgram("rasterParticle",{defines:he,overrideFog:_t});if(T.uploadCommonUniforms(U,$t,fe),te){const Jt=new pi(B.LEQUAL,pi.ReadOnly,T.depthRangeFor3D),Xt=0,ri=T.globeSharedBuffers;if(ri){const[Mi,tn,Gi]=ri.getGridBuffers(Pe,Xt!==0);$t.draw(T,B.TRIANGLES,Jt,le,Xi.alphaBlended,T.renderElevatedRasterBackface?Li.frontCCW:Li.backCCW,mt,R.id,Mi,tn,Gi)}}else{const Jt=T.depthModeForSublayer(0,pi.ReadOnly),Xt=ee[we.overscaledZ],{tileBoundsBuffer:ri,tileBoundsIndexBuffer:Mi,tileBoundsSegments:tn}=T.getTileBoundsBuffers(Ee);$t.draw(T,B.TRIANGLES,Jt,Xt,Xi.alphaBlended,Li.disabled,mt,R.id,ri,Mi,tn)}}T.resetStencilClippingMasks()})(d,t,o,f),d.style.map.triggerRepaint())},background:function(d,t,o,f){const y=o.paint.get("background-color"),x=o.paint.get("background-color-use-theme").constantOr("default")==="none",T=o.paint.get("background-opacity"),A=o.paint.get("background-emissive-strength"),R=o.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const L=d.context,k=L.gl,U=d.transform,B=U.tileSize,H=o.paint.get("background-pattern");let W;if(H!==void 0&&(H===null||(W=d.imageManager.getPattern(s.I.from(H.toString()),o.scope,d.style.getLut(o.scope)),!W)))return;const X=!H&&y.a===1&&T===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==X)return;const te=Ui.disabled,ee=d.depthModeForSublayer(0,X==="opaque"?pi.ReadWrite:pi.ReadOnly),re=d.colorModeForDrapableLayerRenderPass(A),he=H?"backgroundPattern":"background";let le,we=f;if(we||(le=d.getBackgroundTiles(),we=Object.values(le).map((fe=>fe.tileID))),H&&(L.activeTexture.set(k.TEXTURE0),d.imageManager.bind(d.context,o.scope)),R){const fe=d.getOrCreateProgram(he,{overrideFog:!1,overrideRtt:!0}),Ee=new Float32Array(s.bz([])),ge=new s.aP(0,0,0,0,0),me=H?Ed(Ee,A,T,d,0,o.scope,W,R,{tileID:ge,tileSize:B}):Lu(Ee,A,T,y.toPremultipliedRenderColor(x?null:o.lut));fe.draw(d,k.TRIANGLES,ee,te,re,Li.disabled,me,o.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const fe of we){const Ee=d.isTileAffectedByFog(fe),ge=d.getOrCreateProgram(he,{overrideFog:Ee}),me=fe.toUnwrapped(),Se=f?fe.projMatrix:d.transform.calculateProjMatrix(me);d.prepareDrawTile();const Ve=t?t.getTile(fe):le?le[fe.key]:new eo(fe,B,U.zoom,d),ke=H?Ed(Se,A,T,d,0,o.scope,W,R,{tileID:fe,tileSize:B}):Lu(Se,A,T,y.toPremultipliedRenderColor(x?null:o.lut));d.uploadCommonUniforms(L,ge,me);const{tileBoundsBuffer:st,tileBoundsIndexBuffer:Xe,tileBoundsSegments:ht}=d.getTileBoundsBuffers(Ve);ge.draw(d,k.TRIANGLES,ee,te,re,Li.disabled,ke,o.id,st,Xe,ht)}},sky:function(d,t,o){const f=d._atmosphere?s.aj(d.transform.zoom):1,y=o.paint.get("sky-opacity")*f;if(y===0)return;const x=d.context,T=o.paint.get("sky-type"),A=new pi(x.gl.LEQUAL,pi.ReadOnly,[0,1]),R=d.frameCounter/1e3%1;T==="atmosphere"?d.renderPass==="offscreen"?o.needsSkyboxCapture(d)&&((function(L,k,U,B){const H=L.context,W=H.gl;let X=k.skyboxFbo;if(!X){X=k.skyboxFbo=H.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new Np(H),k.skyboxTexture=H.gl.createTexture(),W.bindTexture(W.TEXTURE_CUBE_MAP,k.skyboxTexture),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,W.LINEAR);for(let he=0;he<6;++he)W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+he,0,W.RGBA,32,32,0,W.RGBA,W.UNSIGNED_BYTE,null)}H.bindFramebuffer.set(X.framebuffer),H.viewport.set([0,0,32,32]);const te=k.getCenter(L,!0),ee=L.getOrCreateProgram("skyboxCapture"),re=new Float64Array(16);s.bz(re),s.em(re,re,.5*-Math.PI),el(L,k,ee,re,te,0),s.bz(re),s.em(re,re,.5*Math.PI),el(L,k,ee,re,te,1),s.bz(re),s.cT(re,re,.5*-Math.PI),el(L,k,ee,re,te,2),s.bz(re),s.cT(re,re,.5*Math.PI),el(L,k,ee,re,te,3),s.bz(re),el(L,k,ee,re,te,4),s.bz(re),s.em(re,re,Math.PI),el(L,k,ee,re,te,5),H.viewport.set([0,0,L.width,L.height])})(d,o),o.markSkyboxValid(d)):d.renderPass==="sky"&&(function(L,k,U,B,H){const W=L.context,X=W.gl,te=L.transform,ee=L.getOrCreateProgram("skybox");W.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_CUBE_MAP,k.skyboxTexture);const re=((he,le,we,fe,Ee)=>({u_matrix:he,u_sun_direction:le,u_cubemap:0,u_opacity:fe,u_temporal_offset:Ee}))(te.skyboxMatrix,k.getCenter(L,!1),0,B,H);L.uploadCommonUniforms(W,ee),ee.draw(L,X.TRIANGLES,U,Ui.disabled,L.colorModeForRenderPass(),Li.backCW,re,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)})(d,o,A,y,R):T==="gradient"&&d.renderPass==="sky"&&(function(L,k,U,B,H){const W=L.context,X=W.gl,te=L.transform,ee=L.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new Np(W)),W.activeTexture.set(X.TEXTURE0);let re=k.colorRampTexture;re||(re=k.colorRampTexture=new s.T(W,k.colorRamp,X.RGBA8)),re.bind(X.LINEAR,X.CLAMP_TO_EDGE);const he=((le,we,fe,Ee,ge)=>({u_matrix:le,u_color_ramp:0,u_center_direction:we,u_radius:s.an(fe),u_opacity:Ee,u_temporal_offset:ge}))(te.skyboxMatrix,k.getCenter(L,!1),k.paint.get("sky-gradient-radius"),B,H);L.uploadCommonUniforms(W,ee),ee.draw(L,X.TRIANGLES,U,Ui.disabled,L.colorModeForRenderPass(),Li.backCW,he,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)})(d,o,A,y,R)},custom:function(d,t,o,f){const y=d.context,x=o.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&o.isDraped(t)){if(d.renderPass==="offscreen"){const T=x.prerender;if(T){if(d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const A=d.transform.pointMerc;T.call(x,y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.aj(d.transform.zoom),[A.x,A.y],d.transform.pixelsPerMeterRatio)}else T.call(x,y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const A=x.renderToTile;if(A){const R=f[0].canonical,L={x:R.x+f[0].wrap*(x.wrapTileId?0:1<<R.z),y:R.y,z:R.z};y.setDepthMode(pi.disabled),y.setStencilMode(Ui.disabled),y.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),A.call(x,y.gl,L),y.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),y.setStencilMode(Ui.disabled);const T=x.renderingMode==="3d"?new pi(d.context.gl.LEQUAL,pi.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,pi.ReadOnly);if(y.setDepthMode(T),d.transform.projection.name==="globe"){const A=d.transform.pointMerc;x.render(y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),s.aj(d.transform.zoom),[A.x,A.y],d.transform.pixelsPerMeterRatio)}else x.render(y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState(),y.bindFramebuffer.set(null)}}else s.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,o,f){if(d.renderPass==="opaque")return;const y=o.paint.get("model-opacity").constantOr(1),x=o.paint.get("model-elevation-reference"),T=x==="ground",A=x==="ground";if(y===0)return;const R=o.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!R||d.terrain&&y<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof s.ad))return;const L=d.shadowRenderer,k=o.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,k||(L.enabled=!1));const U=()=>{L&&(L.useNormalOffset=!0,k||(L.enabled=!0))},B=t.getSource();if(d.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return(function(le,we,fe,Ee,ge){const me=le.transform,Se=me.projection.name==="globe",Ve=me.getFreeCameraOptions().position;if(!le.modelManager)return;const ke=le.modelManager;fe.modelManager=ke;const st=le.shadowRenderer;if(!fe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Xe=fe._unevaluatedLayout._values["model-id"],ht=Object.assign({},fe.layout.get("model-id").parameters),zt=le.style.order.indexOf(fe.fqid);for(const $e of Ee){const Pe=we.getTile($e).getBucket(fe);if(!Pe||Pe.projection.name!==me.projection.name)continue;const dt=Pe.getModelUris();if(dt&&!Pe.modelsRequested&&(ke.addModelsFromBucket(dt,ge),Pe.modelsRequested=!0),Se)ht.zoom=$e.overscaledZ;else{const Jt=Up($e,me);ht.zoom=Jt}const Ke=Xe.possiblyEvaluate(ht);if(lg(le,Pe,$e),zo.shadowUniformsInitialized=!1,zo.useSingleShadowCascade=!!st&&st.getMaxCascadeForTile($e.toUnwrapped())===0,le.renderPass==="shadow"&&st){if(le.currentShadowCascade===1&&Pe.isInsideFirstShadowMapFrustum)continue;const Jt=me.calculatePosMatrix($e.toUnwrapped(),me.worldSize);if(zo.tileMatrix.set(Jt),zo.shadowTileMatrix=Float32Array.from(st.calculateShadowPassMatrixFromMatrix(Jt)),zo.aabb.min=[0,0,0],zo.aabb.max[0]=zo.aabb.max[1]=s.al,zo.aabb.max[2]=0,kf(Pe,zo,le,fe.scope))continue}const At=1<<$e.canonical.z,wt=[((Ve.x-$e.wrap)*At-$e.canonical.x)*s.al,(Ve.y*At-$e.canonical.y)*s.al,Ve.z*At*s.al];le.conflationActive&&Object.keys(Pe.instancesPerModel).length>0&&le.style.isLayerClipped(fe,we.getSource())&&Pe.updateReplacement($e,le.replacementSource,zt,ge)&&(Pe.uploaded=!1,Pe.upload(le.context));let Ht=0;const mt=new Array,_t=new Array,$t=new Array;for(let Jt in Pe.instancesPerModel){const Xt=Pe.instancesPerModel[Jt];Xt.features.length>0&&!Se&&(Jt=Ke.evaluate(Xt.features[0].feature,{}));const ri=ke.getModel(Jt,ge);if(ri||ke.hasURLBeenRequested(Jt)||Pe.modelUris.includes(Jt)||(Pe.modelUris.push(Jt),Pe.modelsRequested=!1),ri&&ri.uploaded)if(Se){const Mi=s.c4([],[Ve.x,Ve.y,Ve.z],le.transform.worldSize);s.ev(Mi,Mi);for(let tn=0;tn<Xt.instancedDataArray.length;++tn){const Gi=[0,0,0],Fn=[1,1,1],Pi=s.ew(),yn=Xt.tileCoordinatesForInstance(tn),Ni=Xt.transformForInstance(tn);s.ex(Fn,Ni),s.ey(Pi,Ni),s.ez(Gi,Pi);const Bn=Xt.translationForInstance(tn),_n=new s.aS(0,0);s.eA(Pe.canonical,_n,yn.x,yn.y);const In=s.bB();s.eB(In,ri,le.transform,_n,Gi,Fn,Bn,!0,!1,!1);const Dn=Xt.colorForInstance(tn),Wi=s.bz([]),Un=s.ee(_n.lat,le.transform.zoom),nn=s.bp([],[1,1,1/Un]);s.bq(Wi,Wi,Mi),$t.push({zScaleMatrix:nn,negCameraPosMatrix:Wi});for(const gr of ri.nodes)Lf(le,gr,In,le.transform.expandedFarZProjMatrix,Ht,mt,_t,ri.materialOverrides,Dn);++Ht}}else for(const Mi of ri.nodes)Dd(le,fe,Mi,Xt,wt,$e,zo)}if(Se)if(le.renderPass==="shadow"){for(const Jt of _t)Ah(Jt.mesh,Jt.nodeModelMatrix,le,fe);for(const Jt of mt)Ah(Jt.mesh,Jt.nodeModelMatrix,le,fe)}else O_(le,fe,1,mt,_t,$t)}})(d,t,o,f,Of(B,o,d.style._importedAsBasemap)),void U();if(!B.loaded())return;if(B.type==="batched-model")return(function(le,we,fe,Ee){fe.resetLayerRenderingStats(le);const ge=le.context,me=le.transform,Se=le.style.fog,Ve=le.shadowRenderer;if(me.projection.name!=="mercator")return void s.w(`Drawing 3D landmark models for ${me.projection.name} projection is not yet implemented`);const ke=le.transform.getFreeCameraOptions().position,st=s.c4([],[ke.x,ke.y,ke.z],le.transform.worldSize),Xe=s.ev([],st),ht=s.bz([]),zt=s.ee(me.center.lat,me.zoom),$e=s.bp([],[1,1,1/zt]);s.bq(ht,ht,Xe);const Pe=fe.paint.get("model-opacity").constantOr(1),dt=new pi(ge.gl.LEQUAL,pi.ReadWrite,le.depthRangeFor3D),Ke=new pi(ge.gl.LEQUAL,pi.ReadOnly,le.depthRangeFor3D),At=new s.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),wt=le.renderPass==="shadow",Ht=wt&&Ve?Ve.getCurrentCascadeFrustum():me.getFrustum(me.scaleZoom(me.worldSize)),mt=fe.paint.get("model-front-cutoff"),_t=mt[2]<1,$t=Ka(le,fe.paint.get("model-cutoff-fade-range")),Jt=fe.getLayerRenderingStats();(function(Xt,ri,Mi,tn){const Gi=Xt.terrain?Xt.terrain.exaggeration():0,Fn=Xt.transform.zoom;for(const Pi of tn){const yn=ri.getTile(Pi).getBucket(Mi);yn&&(yn.setFilter(Mi.filter),Xt.conflationActive&&yn.updateReplacement(Pi,Xt.replacementSource),yn.evaluateTransform(Xt,Mi),Xt.terrain&&Gi>0&&yn.elevationUpdate(Xt.terrain,Gi,Pi,Mi.source),yn.needsReEvaluation(Xt,Fn,Mi)&&yn.evaluate(Mi))}})(le,we,fe,Ee),(function(){let Xt,ri,Mi;_t?(Xt=Ee.length-1,ri=-1,Mi=-1):(Xt=0,ri=Ee.length,Mi=1);const tn=new Float64Array(16),Gi=s.cz(),Fn=new s.P(0,0);for(let Pi=Xt;Pi!==ri;Pi+=Mi){const yn=Ee[Pi],Ni=we.getTile(yn).getBucket(fe);if(!Ni||!Ni.uploaded)continue;let Bn=!1;Ve&&(Bn=Ve.getMaxCascadeForTile(yn.toUnwrapped())===0);const _n=me.calculatePosMatrix(yn.toUnwrapped(),me.worldSize),In=Ni.modelTraits;!wt&&_t&&(s.bk(tn,_n),s.af(Gi,st,tn),Fn.x=Gi[0],Fn.y=Gi[1]);const Dn=[];Ni.setFilter(fe.filter);for(const Wi of Ni.getNodesInfo()){if(Wi.hiddenByReplacement||!Wi.node.meshes)continue;const Un=Wi.node;let nn=0;le.terrain&&Un.elevation&&(nn=Un.elevation*le.terrain.exaggeration());const gr=(()=>{const ls=Wi.aabb;return At.min=[...ls.min],At.max=[...ls.max],At.min[2]+=nn,At.max[2]+=nn,s.af(At.min,At.min,_n),s.af(At.max,At.max,_n),At})(),wn=Wi.evaluatedScale;if(wn[0]<=1&&wn[1]<=1&&wn[2]<=1&&gr.intersects(Ht)===0)continue;if(!wt&&_t){const ls=.16666666666666666;Wi.cameraCollisionOpacity=st[0]>gr.min[0]&&st[0]<gr.max[0]&&st[1]>gr.min[1]&&st[1]<gr.max[1]&&st[2]*zt<gr.max[2]&&Un.footprint&&s.b$(Fn,Un.footprint)?Math.max(Wi.cameraCollisionOpacity-ls,0):Math.min(1,Wi.cameraCollisionOpacity+ls)}const Ei=[..._n],pn=1/s.d6(yn.canonical),br=Un.anchor?Un.anchor[0]:0,Er=Un.anchor?Un.anchor[1]:0;s.bq(Ei,Ei,[br*(wn[0]-1)+Wi.evaluatedTranslation[0]*pn,Er*(wn[1]-1)+Wi.evaluatedTranslation[1]*pn,nn+Wi.evaluatedTranslation[2]]),s.cp(wn,s.eD)||s.cR(Ei,Ei,wn);const zr=s.aB([],Ei,Un.globalMatrix),qr=s.aB([],me.expandedFarZProjMatrix,zr),ca=s.aB([],me.expandedFarZProjMatrix,Ei),_o=s.aC([],[br,Er,nn,1],qr)[2];Un.hidden=!1;let so=Pe;wt||(_t&&(so*=Wi.cameraCollisionOpacity,so*=Rh(Ei,me,Wi.aabb,mt)),so*=Ch($t,_o)),so!==0?Dn.push({nodeInfo:Wi,depth:_o,opacity:so,wvpForNode:qr,wvpForTile:ca,nodeModelMatrix:zr,tileModelMatrix:Ei}):Un.hidden=!0}wt||Dn.sort(((Wi,Un)=>!_t||Wi.opacity===1&&Un.opacity===1?Wi.depth<Un.depth?-1:1:Wi.opacity===1?-1:Un.opacity===1?1:Wi.depth>Un.depth?-1:1));for(const Wi of Dn){const Un=Wi.nodeInfo,nn=Un.node;let gr=s.aB([],$e,Wi.tileModelMatrix);s.aB(gr,ht,gr);const wn=s.bk([],gr);s.ef(wn,wn),s.cR(wn,wn,zf),gr=s.aB(gr,gr,nn.globalMatrix);const Ei=le.renderPass==="light-beam",pn=fe.paint.get("model-color-use-theme").constantOr("default")==="none",br=In&s.eH.HasMapboxMeshFeatures,Er=br?0:Un.evaluatedRMEA[0][2];for(let zr=0;zr<nn.meshes.length;++zr){const qr=nn.meshes[zr],ca=zr===nn.lightMeshIndex;let _o=Wi.wvpForNode;if(ca){if(!Ei&&!le.terrain&&le.shadowRenderer){le.currentLayer<le.firstLightBeamLayer&&(le.firstLightBeamLayer=le.currentLayer);continue}_o=Wi.wvpForTile}else if(Ei)continue;const so={defines:[]},ls=[];if(!wt&&Ve&&(Ve.useNormalOffset=!!qr.normalBuffer),Sh(so.defines,ls,qr,le,pn?null:fe.lut),br||so.defines.push("DIFFUSE_SHADED"),Bn&&so.defines.push("SHADOWS_SINGLE_CASCADE"),Jt&&(wt?Jt.numRenderedVerticesInShadowPass+=qr.vertexArray.length:Jt.numRenderedVerticesInTransparentPass+=qr.vertexArray.length),wt){Ah(qr,Wi.nodeModelMatrix,le,fe);continue}let Va=null;if(Se){const Jr=Vp(Wi.nodeModelMatrix,le.transform);if(Va=new Float32Array(Jr),me.projection.name!=="globe"){const ar=qr.aabb.min,Hr=qr.aabb.max,[Ws,$r]=Se.getOpacityForBounds(Jr,ar[0],ar[1],Hr[0],Hr[1]);so.overrideFog=Ws>=We||$r>=We}}const Qr=qr.material;let Ua;Qr.occlusionTexture&&Qr.occlusionTexture.offsetScale&&(Ua=Qr.occlusionTexture.offsetScale,so.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const rl=le.getOrCreateProgram("model",so);!wt&&Ve&&Ve.setupShadowsFromMatrix(Wi.tileModelMatrix,rl,Ve.useNormalOffset),le.uploadCommonUniforms(ge,rl,null,Va);const oo=Qr.pbrMetallicRoughness;oo.metallicFactor=.9,oo.roughnessFactor=.5;const wr=zu(new Float32Array(_o),new Float32Array(gr),new Float32Array(wn),new Float32Array(nn.globalMatrix),le,Wi.opacity,oo.baseColorFactor,Qr.emissiveFactor,oo.metallicFactor,oo.roughnessFactor,Qr,Er,fe,[0,0,0],Ua);!ca&&(Un.hasTranslucentParts||Wi.opacity<1)&&rl.draw(le,ge.gl.TRIANGLES,dt,Ui.disabled,Xi.disabled,Li.backCCW,wr,fe.id,qr.vertexBuffer,qr.indexBuffer,qr.segments,fe.paint,le.transform.zoom,void 0,ls),rl.draw(le,ge.gl.TRIANGLES,ca?Ke:dt,Ui.disabled,ca||Wi.opacity<1||Un.hasTranslucentParts?Xi.alphaBlended:Xi.unblended,Li.backCCW,wr,fe.id,qr.vertexBuffer,qr.indexBuffer,qr.segments,fe.paint,le.transform.zoom,void 0,ls)}}}})()})(d,t,o,f),void U();if(B.type!=="model")return;const H=B.getModels(),W=[],X=d.transform.getFreeCameraOptions().position,te=s.c4([],[X.x,X.y,X.z],d.transform.worldSize);s.ev(te,te);const ee=[],re=[];let he=0;for(const le of H){const we=t.getFeatureState("",le.id),fe={type:"Unknown",id:le.id,properties:le.featureProperties},Ee=o.paint.get("model-rotation").evaluate(fe,we),ge=o.paint.get("model-scale").evaluate(fe,we),me=o.paint.get("model-translation").evaluate(fe,we);Ih(o,le.id,we,le.featureProperties,le.nodeOverrideNames,le.nodeOverrides),P_(o,le.id,we,le.featureProperties,le.materialOverrideNames,le.materialOverrides),le.nodeOverrides.size>0&&le.computeBoundsAndApplyParent(),le.computeModelMatrix(d,Ee,ge,me,A,T,!1);const Se=s.bz([]),Ve=s.ee(le.position.lat,d.transform.zoom),ke=s.bp([],[1,1,1/Ve]);s.bq(Se,Se,te),W.push({zScaleMatrix:ke,negCameraPosMatrix:Se});for(const st of le.nodes)Lf(d,st,le.matrix,d.transform.expandedFarZProjMatrix,he,ee,re,le.materialOverrides);he++}if(ee.sort(((le,we)=>we.depth-le.depth)),d.renderPass!=="shadow")O_(d,o,y,ee,re,W),U();else{for(const le of re)Ah(le.mesh,le.nodeModelMatrix,d,o);for(const le of ee)Ah(le.mesh,le.nodeModelMatrix,d,o);U()}}},Bf={line:function(d,t,o){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const f=t.getVisibleCoordinates();for(const y of f){const x=t.getTile(y).getBucket(d);if(x&&(x.elevationType!=="none"?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,t,o){const f=t.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson"){const x=Of(f,d,o.style._importedAsBasemap);return void(o.modelManager&&o.modelManager.upload(o,x))}if(f.type==="batched-model"||f.type!=="model")return;const y=f.getModels();for(const x of y)x.upload(o.context)},raster:function(d,t,o){const f=t.getSource();if(!(f instanceof gs&&f.loaded()))return;const y=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!y)return;const x=d.paint.get("raster-array-band")||f.getInitialBand(y);if(x==null)return;const T=t.getIds().map((A=>t.getTileByID(A)));for(const A of T)A.updateNeeded(d.id,x)&&f.prepareTile(A,y,d.id,x)},"raster-particle":function(d,t,o){const f=t.getSource();if(!(f instanceof gs&&f.loaded()))return;const y=d.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!y)return;const x=d.paint.get("raster-particle-array-band")||f.getInitialBand(y);if(x==null)return;const T=t.getIds().map((A=>t.getTileByID(A)));for(const A of T)A.updateNeeded(d.id,x)&&f.prepareTile(A,y,d.id,x)}},qp={fill:Cc},tl={fill:function(d,t,o,f){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const y=d.context.gl,x=new pi(y.LEQUAL,pi.ReadOnly,d.depthRangeFor3D),T=new Ui({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),A=d.transform.getFreeCameraOptions().position,R=d.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of f){const k=t.getTile(L),U=k.getBucket(o);if(!U)continue;const B=U.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const H=Hs(L.toUnwrapped(),A),W=d.translatePosMatrix(L.projMatrix,k,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),X=Sf(W,H,0,1,0);R.draw(d,y.TRIANGLES,x,T,Xi.disabled,Li.disabled,X,o.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,o.paint,d.transform.zoom)}}};class su{constructor(t,o,f,y,x,T){this.context=new Sd(t,o),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=s.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const A=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const L of A)this._debugParams.enabledLayers[L]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of A)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new L_(x),this.setup(),this.numSublayers=qo.maxUnderzooming+qo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new fd(this),this._wireframeDebugCache=new ug,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const R=new s.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new s.T(this.context,R,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=T}updateTerrain(t,o){const f=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Jc(this,t));const y=this._terrain;this.transform.elevation=f?y:null,y.update(t,this.transform,o),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,y]=o.getFovAdjustedRange(this.transform._fov);if(f>y)return void(this.transform.fogCullDistSq=null);const x=f+.78*(y-f);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Jc(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*s.o.devicePixelRatio,this.height=o*s.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const t=this.context,o=new s.bc;o.emplaceBack(0,0),o.emplaceBack(s.al,0),o.emplaceBack(0,s.al),o.emplaceBack(s.al,s.al),this.tileExtentBuffer=t.createVertexBuffer(o,s.be.members),this.tileExtentSegments=s.bf.simpleSegment(0,0,4,2);const f=new s.bc;f.emplaceBack(0,0),f.emplaceBack(s.al,0),f.emplaceBack(0,s.al),f.emplaceBack(s.al,s.al),this.debugBuffer=t.createVertexBuffer(f,s.be.members),this.debugSegments=s.bf.simpleSegment(0,0,4,5);const y=new s.bc;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,s.be.members),this.viewportSegments=s.bf.simpleSegment(0,0,4,2);const x=new s.a$;x.emplaceBack(0,0,0,0),x.emplaceBack(s.al,0,s.al,0),x.emplaceBack(0,s.al,0,s.al),x.emplaceBack(s.al,s.al,s.al,s.al),this.mercatorBoundsBuffer=t.createVertexBuffer(x,s.bh.members),this.mercatorBoundsSegments=s.bf.simpleSegment(0,0,4,2);const T=new s.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const A=new s.bd;for(const L of[0,1,3,2,0])A.emplaceBack(L);this.debugIndexBuffer=t.createIndexBuffer(A),this.emptyTexture=new s.T(t,new s.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=s.bB();const R=this.context.gl;this.stencilClearMode=new Ui({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,pi.disabled,this.stencilClearMode,Xi.disabled,Li.disabled,yh(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,f){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const R of f)if(this._tileClippingMaskIDs[R.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=o.id;const y=this.context,x=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(Xi.disabled),y.setDepthMode(pi.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of f){const R=o.getTile(A),L=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:B}=this.getTileBoundsBuffers(R);T.draw(this,x.TRIANGLES,pi.disabled,new Ui({func:x.ALWAYS,mask:0},L,255,x.KEEP,x.KEEP,x.REPLACE),Xi.disabled,Li.disabled,yh(A.projMatrix),"$clipping",k,U,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new Ui({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new Ui({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,f=t.sort(((T,A)=>A.overscaledZ-T.overscaledZ)),y=f[f.length-1].overscaledZ,x=f[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let A=0;A<x;A++)T[A+y]=new Ui({func:o.GEQUAL,mask:255},A+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=x,[T,f]}return[{[y]:Ui.disabled},f]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Xi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new s.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xi.unblended:Xi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Xi([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new s.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,f,y=!1){if(this.depthOcclusion)return new pi(this.context.gl.GREATER,pi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return pi.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new pi(f||this.context.gl.LEQUAL,o,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,o=Math.ceil(this.width),f=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),x=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&f!==0&&(this.depthFBO=new Rf(this.context,o,f,!1,"texture"),this.depthTexture=new s.T(this.context,{width:o,height:f,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,x),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,f,0,0,o,f,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,o)=>t+o/this._fpsHistory.length),0))}render(t,o){const f=s.o.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;const y=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(x).filter(($e=>{const Pe=y[$e];return!(Pe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Pe.type]}));let A=T(),R=!1,L=!1,k=null;for(const $e of A){const Pe=y[$e];Pe.type==="circle"?R=!0:Pe.type==="building"?k=Pe:Pe.type==="symbol"&&(Pe.hasOcclusionOpacityProperties?L=!0:R=!0)}let U=A.map(($e=>y[$e]));const B=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(s.o.now()),this.imageManager.beginFrame();let H=0,W=!1;for(const $e in B){const Pe=B[$e];Pe.used&&(Pe.prepare(this.context),Pe.getSource().usedInConflation&&++H)}let X=!1;for(const $e of U)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(X=!0),this.prepareLayer($e));const te={},ee={},re={},he={},le={};for(const $e in B){const Pe=B[$e];te[$e]=Pe.getVisibleCoordinates(),ee[$e]=te[$e].slice().reverse(),re[$e]=Pe.getVisibleCoordinates(!0).reverse(),he[$e]=Pe.getShadowCasterCoordinates(),le[$e]=Pe.sortCoordinatesByDistance(te[$e])}const we=$e=>{const Pe=this.style.getLayerSourceCache($e);return Pe&&Pe.used?Pe.getSource():null};if(H||X||this._clippingActiveLastFrame){const $e=[],Pe=[];let dt=0;for(const Ke of U)this.isSourceForClippingOrConflation(Ke,we(Ke))&&($e.push(Ke),Pe.push(dt)),dt++;if($e&&(X||$e.length>1)||this._clippingActiveLastFrame){X=!1;const Ke=[];for(let At=0;At<$e.length;At++){const wt=$e[At],Ht=Pe[At],mt=this.style.getLayerSourceCache(wt);if(!mt||!mt.used||!mt.getSource().usedInConflation&&wt.type!=="clip"&&wt.type!=="building")continue;let _t=s.eP,$t=s.bZ.None;const Jt=[];let Xt=!0;if(wt.type==="building")_t=s.eR;else if(wt.type==="clip"){_t=Ht;for(const ri of wt.layout.get("clip-layer-types"))$t|=ri==="model"?s.bZ.Model:ri==="symbol"?s.bZ.Symbol:s.bZ.FillExtrusion;for(const ri of wt.layout.get("clip-layer-scope"))Jt.push(ri);wt.isHidden(this.transform.zoom)?Xt=!1:X=!0}Xt&&Ke.push({layer:wt.fqid,cache:mt,order:_t,clipMask:$t,clipScope:Jt})}this.replacementSource.setSources(Ke),W=!0}}this._clippingActiveLastFrame=X,W||this.replacementSource.clear(),this.conflationActive=W,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<U.length;$e++){const Pe=U[$e],dt=Pe.cutoffRange();if(this.longestCutoffRange=Math.max(dt,this.longestCutoffRange),dt>0){const Ke=we(Pe);Ke&&(this.minCutoffZoom=Math.max(Ke.minzoom,this.minCutoffZoom)),Pe.minzoom&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom))}Pe.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const fe=this.style&&this.style.fog;fe?(this._fogVisible=fe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=fe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(re),this.opaquePassCutoff=0,A=T(),U=A.map(($e=>y[$e])));const Ee=this._shadowRenderer;if(Ee){Ee.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in B)for(const Pe of te[$e]){let dt={min:0,max:0};this.terrain&&(dt=this.terrain.getMinMaxForTile(Pe)||dt),Ee.addShadowReceiver(Pe.toUnwrapped(),dt.min,dt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new rs(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ge&&!this._snow&&(this._snow=new Ff(this)),!ge&&this._snow&&(this._snow.destroy(),delete this._snow),me&&!this._rain&&(this._rain=new Mh(this)),!me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),k){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ue);const $e=this.style.getLayerSourceCache(k);this.buildingTileBorderManager.updateBorders($e,k)}if(!nr.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of U){const Pe=t.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const dt=Pe?ee[Pe.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||dt&&dt.length)&&this.renderLayer(this,Pe,$e,dt)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,he)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ve=(()=>{if(o.showOverdrawInspector)return s.ao.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const Pe=this.style.getLut($e.scope);if(!Se){const dt=$e.properties.get("color-use-theme")==="none",Ke=$e.properties.get("color").toNonPremultipliedRenderColor(dt?null:Pe).toArray01();return new s.ao(...Ke)}if(Se){const dt=$e.properties.get("space-color-use-theme")==="none",Ke=$e.properties.get("space-color").toNonPremultipliedRenderColor(dt?null:Pe).toArray01();return new s.ao(...Ke)}}return s.ao.transparent})();if(this.context.clear({color:Ve,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const $e=U[this.currentLayer],Pe=t.getLayerSourceCache($e);if($e.isSky())continue;const dt=Pe?($e.is3D(x)?le:ee)[Pe.id]:void 0;this._renderTileClippingMasks($e,Pe,dt),this.renderLayer(this,Pe,$e,dt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const $e=U[this.currentLayer],Pe=t.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,Pe,$e,Pe?ee[Pe.id]:void 0)}function ke($e,Pe){let dt;return Pe&&(dt=($e.type==="symbol"?re:$e.is3D(x)?le:ee)[Pe.id]),dt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<A.length;){const $e=U[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const Pe=t.getLayerSourceCache($e);this.renderLayer(this,Pe,$e,ke($e,Pe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let st=0;Ee&&(st=Ee.getShadowCastingLayerCount());let Xe=!1,ht=-1;for(let $e=0;$e<A.length;++$e){const Pe=U[$e];Pe.isHidden(this.transform.zoom)||Pe.is3D(x)&&(ht=$e)}L&&ht===-1&&(R=!0);let zt=!1;for(;this.currentLayer<A.length;){const $e=U[this.currentLayer],Pe=t.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!zt&&$e.is3D(x)&&!x){const dt=this.currentLayer,Ke=At=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const wt=U[this.currentLayer];if(qp[wt.type]){const Ht=this.style.getLayerSourceCache(wt);qp[wt.type](this,Ht,wt,ke(wt,Ht),At)}}};Ke("initialize"),Ke("reset"),this.currentLayer=dt,zt=!0}if(R&&!Xe&&this.terrain&&!this.transform.isOrthographic&&(Xe=!0,this.blitDepth()),L&&ht!==-1&&this.currentLayer===ht+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks($e,Pe,Pe?te[Pe.id]:void 0),this.renderLayer(this,Pe,$e,ke($e,Pe)),!this.terrain&&Ee&&st>0&&$e.hasShadowPass()&&--st==0){{this.clearStencil(),this.resetStencilClippingMasks();const dt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const Ke=U[this.currentLayer];if(tl[Ke.type]){const At=this.style.getLayerSourceCache(Ke);tl[Ke.type](this,At,Ke,ke(Ke,At))}}this.currentLayer=dt}if(Ee.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const dt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=dt;this.currentLayer++){const Ke=U[this.currentLayer];if(!Ke.hasLightBeamPass())continue;const At=t.getLayerSourceCache(Ke);this.renderLayer(this,At,Ke,At?ee[At.id]:void 0)}this.currentLayer=dt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const dt=this.currentLayer;this.depthOcclusion=!0;for(const Ke of this.layersWithOcclusionOpacity){this.currentLayer=Ke;const At=U[this.currentLayer],wt=t.getLayerSourceCache(At),Ht=wt?ee[wt.id]:void 0;this.terrain||this._renderTileClippingMasks(At,wt,wt?te[wt.id]:void 0),this.renderLayer(this,wt,At,Ht)}this.depthOcclusion=!1,this.currentLayer=dt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;U.forEach((Pe=>{const dt=t.getLayerSourceCache(Pe);dt&&!Pe.isHidden(this.transform.zoom)&&dt.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<dt.getSource().maxzoom)&&($e=dt)})),$e&&this.options.showTileBoundaries&&Md(this,$e,$e.getVisibleCoordinates(),s.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Md(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function($e){const Pe=$e.transform.padding;Yn($e,$e.transform.height-(Pe.top||0),3,Rc),Yn($e,Pe.bottom||0,3,aa),ku($e,Pe.left||0,3,ks),ku($e,$e.transform.width-(Pe.right||0),3,Rd);const dt=$e.transform.centerPoint;(function(Ke,At,wt,Ht){Fu(Ke,At-1,wt-10,2,20,Ht),Fu(Ke,At-10,wt-1,20,2,Ht)})($e,dt.x,$e.transform.height-dt.y,Th)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),W||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:o}=this.transform.projection,f=!o||!o.includes(t.type);if(Bf[t.type]&&(f||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);Bf[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,o,f,y){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||y&&y.length)&&(this.id=f.id,this.gpuTimingStart(f),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(f.type)&&(!t.terrain||f.type!=="custom")||f.type==="clip"||Gp[f.type](t,o,f,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,f=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:f.createQuery()}),y.calls++,f.beginQuery(o.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=this.context.gl,f=o.createQuery();this.deferredRenderGpuTimeQueries.push(f),o.beginQuery(t.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const f in t){const y=t[f],x=this.context.extTimerQuery,T=x.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(y.query),o[f]=T}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let f=0;for(const y of t)f+=o.getQueryParameter(y,o.QUERY_RESULT)/1e6,o.deleteQuery(y);return f}translatePosMatrix(t,o,f,y,x){if(!f[0]&&!f[1])return t;const T=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const L=Math.sin(T),k=Math.cos(T);f=[f[0]*k-f[1]*L,f[0]*L+f[1]*k]}const A=[x?f[0]:s.ay(o,f[0],this.transform.zoom),x?f[1]:s.ay(o,f[1],this.transform.zoom),0],R=new Float32Array(16);return s.bq(R,t,A),R}saveTileTexture(t){if(t.context!==this.context)return;const o=t.size[0],f=this._tileTextures[o];f?f.push(t):this._tileTextures[o]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,f){const y=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,x=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||y||o!==void 0&&!o||x.push("FOG","FOG_DITHERING"),y&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(t,o){this.cache=this.cache||{};const f=o&&o.defines||[],y=o&&o.config,x=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(f),T=bf.cacheKey(sa[t],t,x,y);return this.cache[T]||(this.cache[T]=new bf(this.context,t,sa[t],y,R_[t],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){const f=this.style.directionalLight,y=this.style.ambientLight;if(f&&y){const x=((T,A,R)=>{const L=T.properties.get("direction"),k=T.properties.get("color-use-theme")==="none",U=T.properties.get("color").toNonPremultipliedRenderColor(k?null:R.getLut(T.scope)).toArray01(),B=T.properties.get("intensity"),H=A.properties.get("color-use-theme")==="none",W=A.properties.get("color").toNonPremultipliedRenderColor(H?null:R.getLut(A.scope)).toArray01(),X=A.properties.get("intensity"),te=[L.x,L.y,L.z],ee=s.dM(W,X),re=s.dM(U,B);return{u_lighting_ambient_color:ee,u_lighting_directional_dir:te,u_lighting_directional_color:re,u_ground_radiance:xf(te,re,ee)}})(f,y,this.style);o.setLightsUniformValues(t,x)}}}uploadCommonUniforms(t,o,f,y,x){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const A=T.getOpacity(this.transform.pitch),R=((L,k,U,B,H,W,X,te,ee,re,he,le)=>{const we=L.transform,fe=k.properties.get("color-use-theme")==="none",Ee=k.properties.get("color").toNonPremultipliedRenderColor(fe?null:L.style.getLut(k.scope)).toArray01();Ee[3]=B;const ge=L.frameCounter/1e3%1,[me,Se]=k.properties.get("vertical-range");return{u_fog_matrix:U?we.calculateFogTileMatrix(U):le||L.identityMat,u_fog_range:k.getFovAdjustedRange(we._fov),u_fog_color:Ee,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(me,Se),Se],u_fog_temporal_offset:ge,u_frustum_tl:H,u_frustum_tr:W,u_frustum_br:X,u_frustum_bl:te,u_globe_pos:ee,u_globe_radius:re,u_viewport:he,u_globe_transition:s.aj(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,T,f,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.o.devicePixelRatio,this.transform.height*s.o.devicePixelRatio],y);o.setFogUniformValues(t,R)}x&&o.setCutoffUniformValues(t,x.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const y of f)o[y.key]=t[y.key]||new eo(y,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=We||o[1]>=We}setupDepthForOcclusion(t,o,f){const y=this.context,x=y.gl,T=!!f;var A;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(x.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE0),T||o.setTerrainUniformValues(y,f)}}function Yl(d,t){let o=!1,f=null;const y=()=>{f=null,o&&(d(),f=setTimeout(y,t),o=!1)};return()=>(o=!0,f||y(),f)}class Od{constructor(t){this._hashName=t&&encodeURIComponent(t),s.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yl(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=Dh(t);if(this._hashName){const f=this._hashName;let y=!1;const x=location.hash.slice(1).split("&").map((T=>{const A=T.split("=")[0];return A===f?(y=!0,`${A}=${o}`):T})).filter((T=>T));return y||x.push(`${f}=${o}`),`#${x.join("&")}`}return`#${o}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map((f=>f.split("="))).forEach((f=>{f[0]===this._hashName&&(o=f)})),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some((f=>isNaN(Number(f))))){const f=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:f,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Dh(d,t){const o=d.getCenter(),f=Math.round(100*d.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),T=Math.round(o.lng*x)/x,A=Math.round(o.lat*x)/x,R=d.getBearing(),L=d.getPitch();let k=t?`/${T}/${A}/${f}`:`${f}/${A}/${T}`;return(R||L)&&(k+="/"+Math.round(10*R)/10),L&&(k+=`/${Math.round(L)}`),k}const Ph={linearity:.3,easing:s.eS(0,0,.3,1)},ou=Object.assign({deceleration:2500,maxSpeed:1400},Ph),Oh=Object.assign({deceleration:20,maxSpeed:1400},Ph),il=Object.assign({deceleration:1e3,maxSpeed:360},Ph),Nf=Object.assign({deceleration:1e3,maxSpeed:90},Ph);class Vf{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=s.o.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)o.zoom+=x.zoomDelta||0,o.bearing+=x.bearingDelta||0,o.pitch+=x.pitchDelta||0,x.panDelta&&o.pan._add(x.panDelta),x.around&&(o.around=x.around),x.pinchAround&&(o.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(o.pan.mag()){const x=Uu(o.pan.mag(),f,Object.assign({},ou,t||{}));y.offset=o.pan.mult(x.amount/o.pan.mag()),y.center=this._map.transform.center,Vu(y,x)}if(o.zoom){const x=Uu(o.zoom,f,Oh);y.zoom=this._map.transform.zoom+x.amount,Vu(y,x)}if(o.bearing){const x=Uu(o.bearing,f,il);y.bearing=this._map.transform.bearing+s.aA(x.amount,-179,179),Vu(y,x)}if(o.pitch){const x=Uu(o.pitch,f,Nf);y.pitch=this._map.transform.pitch+x.amount,Vu(y,x)}if(y.zoom||y.bearing){const x=o.pinchAround===void 0?o.around:o.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Vu(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Uu(d,t,o){const{maxSpeed:f,linearity:y,deceleration:x}=o,T=s.aA(d*y/(t/1e3),-f,f),A=Math.abs(T)/(x*y);return{easing:o.easing,duration:1e3*A,amount:T*(A/2)}}class Cr extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,f,y={}){const x=Oe(o.getCanvasContainer(),f),T=o.unproject(x);super(t,Object.assign({point:x,lngLat:T,originalEvent:f},y)),this._defaultPrevented=!1,this.target=o}}class Lh extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,f){const y=t==="touchend"?f.changedTouches:f.touches,x=je(o.getCanvasContainer(),y),T=x.map((R=>o.unproject(R))),A=x.reduce(((R,L,k,U)=>R.add(L.div(U.length))),new s.P(0,0));super(t,{points:x,point:A,lngLats:T,lngLat:o.unproject(A),originalEvent:f}),this._defaultPrevented=!1}}class au extends s.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class Hp{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new au(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new Cr(t.type,this._map,t))}mouseup(t){this._map.fire(new Cr(t.type,this._map,t))}preclick(t){const o=new MouseEvent("preclick",t);this._map.fire(new Cr(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Cr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Cr(t.type,this._map,t))}mouseover(t){this._map.fire(new Cr(t.type,this._map,t))}mouseout(t){this._map.fire(new Cr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Lh(t.type,this._map,t))}touchmove(t){this._map.fire(new Lh(t.type,this._map,t))}touchend(t){this._map.fire(new Lh(t.type,this._map,t))}touchcancel(t){this._map.fire(new Lh(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ju{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Cr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Cr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $p{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(ei(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const f=o,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(f)||!this._box&&f.dist(y)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=it("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(y.x,f.x),A=Math.max(y.x,f.x),R=Math.min(y.y,f.y),L=Math.max(y.y,f.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${T}px,${R}px)`,this._box.style.width=A-T+"px",this._box.style.height=L-R+"px")}))}mouseupWindow(t,o){if(!this._active)return;const f=this._startPos,y=o;if(f&&t.button===0){if(this.reset(),qe(),f.x!==y.x||f.y!==y.y)return this._map.fire(new s.z("boxzoomend",{originalEvent:t})),{cameraAnimation:x=>x.fitScreenCoordinates(f,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Fi(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new s.z(t,{originalEvent:o}))}}function Gu(d,t){const o={};for(let f=0;f<d.length;f++)o[d[f].identifier]=t[f];return o}class Wp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),f.length===this.numTouches&&(this.centroid=(function(y){const x=new s.P(0,0);for(const T of y)x._add(T);return x.div(y.length)})(o),this.touches=Gu(f,o)))}touchmove(t,o,f){if(this.aborted||!this.centroid)return;const y=Gu(f,o);for(const x in this.touches){const T=y[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(t,o,f){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Pc{constructor(t){this.singleTap=new Wp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,f){this.singleTap.touchstart(t,o,f)}touchmove(t,o,f){this.singleTap.touchmove(t,o,f)}touchend(t,o,f){const y=this.singleTap.touchend(t,o,f);if(y){const x=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(x&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Zp{constructor(){this._zoomIn=new Pc({numTouches:1,numTaps:2}),this._zoomOut=new Pc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,f){this._zoomIn.touchstart(t,o,f),this._zoomOut.touchstart(t,o,f)}touchmove(t,o,f){this._zoomIn.touchmove(t,o,f),this._zoomOut.touchmove(t,o,f)}touchend(t,o,f){const y=this._zoomIn.touchend(t,o,f),x=this._zoomOut.touchend(t,o,f);return y?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:t})}):x?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Uf={0:1,2:2},Xp={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class qu{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const f=tt(t);this._correctButton(t,f)&&(this._lastPoint=o,this._eventButton=f)}mousemoveWindow(t,o){const f=this._lastPoint;if(f){if(t.preventDefault(),this._eventButton!=null&&(function(y,x){const T=Uf[x];return y.buttons===void 0||(y.buttons&T)!==T})(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(f,o)}}mouseupWindow(t){this._lastPoint&&tt(t)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $s extends qu{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class mo extends qu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Xp[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const f=.8*(o.x-t.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Kp extends qu{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Xp[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const f=-.5*(o.y-t.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class dg{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),s.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(t,o,f){return this._calculateTransform(t,o,f)}touchmove(t,o,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!s.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,f)}}touchend(t,o,f){this._calculateTransform(t,o,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,f){f.length>0&&(this._active=!0);const y=Gu(f,o),x=new s.P(0,0),T=new s.P(0,0);let A=0;for(const L in y){const k=y[L],U=this._touches[L];U&&(x._add(k),T._add(k.sub(U)),A++,y[L]=k)}if(this._touches=y,A<this._minTouches||!T.mag())return;const R=T.div(A);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(A),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class jf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,f){return{}}touchstart(t,o,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,f){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[x,T]=y,A=Ld(f,o,x),R=Ld(f,o,T);if(!A||!R)return;const L=this._aroundCenter?null:A.add(R).div(2);return this._move([A,R],L,t)}touchend(t,o,f){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,T=Ld(f,o,y),A=Ld(f,o,x);T&&A||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ld(d,t,o){for(let f=0;f<d.length;f++)if(d[f].identifier===o)return t[f]}function zh(d,t){return Math.log2(d/t)}class fg extends jf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const f=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(zh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:zh(this._distance,f),pinchAround:o}}}function zd(d,t){return 180*d.angleWith(t)/Math.PI}class pg extends jf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const f=this._vector;if(this._vector=t[0].sub(t[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:zd(this._vector,f),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const y=zd(t,f);return Math.abs(y)<o}}function Yp(d){return Math.abs(d.y)>Math.abs(d.x)}class Gf extends jf{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Yp(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,f){const y=this._lastPoints;if(!y)return;const x=t[0].sub(y[0]),T=t[1].sub(y[1]);return this._map._cooperativeGestures&&!s.eT()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,f.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(t,o,f){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,x=o.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const T=t.y>0==o.y>0;return Yp(t)&&Yp(o)&&T}}const Qp={panStep:100,bearingStep:15,pitchStep:10};class mg{constructor(){const t=Qp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,f=0,y=0,x=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?f=-1:(t.preventDefault(),x=-1);break;case 39:t.shiftKey?f=1:(t.preventDefault(),x=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:A=>{const R=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:gg,zoom:o?Math.round(R)+o*(t.shiftKey?2:1):R,bearing:A.getBearing()+f*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:A.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gg(d){return d*(2-d)}const _g=4.000244140625,yg=1/450;class vg{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=yg,s.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||s.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const f=s.o.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,o!==0&&o%_g==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Oe(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>_g?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&k!==0&&(k=1/k);const U=o(),B=Math.pow(2,U),H=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(H*k))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:o(),y=this._startZoom,x=this._easing;let T,A=!1;if(this._type==="wheel"&&y&&x){const L=Math.min((s.o.now()-this._lastWheelEventTime)/200,1),k=x(L);T=s.ak(y,f,k),L<1?this._frameId||(this._frameId=!0):A=!0}else T=f,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let R=T-o();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=s.eU;if(this._prevEase){const f=this._prevEase,y=(s.o.now()-f.start)/f.duration,x=f.easing(y+.01)-f.easing(y),T=.27/Math.sqrt(x*x+1e-4)*.01,A=Math.sqrt(.0729-T*T);o=s.eS(T,A,.25,1)}return this._prevEase={start:s.o.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=it("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Lr{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(t.shiftKey?-1:1),around:f.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bg{constructor(){this._tap=new Pc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,f){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=o[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(t,o,f))}touchmove(t,o,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=o[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(t,o,f)}touchend(t,o,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(t,o,f)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jp{constructor(t,o,f){this._el=t,this._mousePan=o,this._touchPan=f}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class wg{constructor(t,o,f){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class kd{constructor(t,o,f,y){this._el=t,this._touchZoom=o,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const kh=d=>d.zoom||d.drag||d.pitch||d.rotate;class em extends s.z{}class Tl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const f=s.av([],o,t);this.radius=s.ag(f[2]<0?s.eW([],f,this.constants):[f[0],f[1],0])}projectRay(t){s.eW(t,t,this.constants),s.aw(t,t),s.eX(t,t,this.constants);const o=s.c4([],t,this.radius);if(o[2]>0){const f=s.c4([],[0,0,1],s.bI(o,[0,0,1])),y=s.c4([],s.aw([],[o[0],o[1],0]),this.radius),x=s.d7([],o,s.c4([],s.av([],s.d7([],y,f),o),2));o[0]=x[0],o[1]=x[1]}return o}}function Na(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class tm{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vf(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Tl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),s.aX(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,T]of this._listeners){const A=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(x,A,T)}}destroy(){for(const[t,o,f]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,y,f)}}_addDefaultHandlers(t){const o=this._map,f=o.getCanvasContainer();this._add("mapEvent",new Hp(o,t));const y=o.boxZoom=new $p(o,t);this._add("boxZoom",y);const x=new Zp,T=new xg;o.doubleClickZoom=new Lr(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const A=new bg;this._add("tapDragZoom",A);const R=o.touchPitch=new Gf(o);this._add("touchPitch",R);const L=new mo(t),k=new Kp(t);o.dragRotate=new wg(t,L,k),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new $s(t),B=new dg(o,t);o.dragPan=new Jp(f,U,B),this._add("mousePan",U),this._add("touchPan",B,["touchZoom","touchRotate"]);const H=new pg,W=new fg;o.touchZoomRotate=new kd(f,W,H,A),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",W,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ju(o));const X=o.scrollZoom=new vg(o,this);this._add("scrollZoom",X,["mousePan"]);const te=o.keyboard=new mg;this._add("keyboard",te);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ee]&&o[ee].enable(t[ee])}_add(t,o,f){this._handlers.push({handlerName:t,handler:o,allowed:f}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!kh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,f){for(const y in t)if(y!==f&&(!o||o.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const f of t)this._el.contains(f.target)&&o.push(f);return o}handleEvent(t,o){this._updatingCamera=!0;const f=t.type==="renderFrame",y=f?void 0:t,x={needsRenderFrame:!1},T={},A={},R=t.touches?this._getMapTouches(t.touches):void 0,L=R?je(this._el,R):f?void 0:Oe(this._el,t);for(const{handlerName:B,handler:H,allowed:W}of this._handlers){if(!H.isEnabled())continue;let X;this._blockedByActive(A,W,B)?H.reset():H[o||t.type]&&(X=H[o||t.type](t,L,R),this.mergeHandlerResult(x,T,X,B,y),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||H.isActive())&&(A[B]=H)}const k={};for(const B in this._previousActiveHandlers)A[B]||(k[B]=y);this._previousActiveHandlers=A,(Object.keys(k).length||Na(x))&&(this._changes.push([x,T,k]),this._triggerRenderFrame()),(Object.keys(A).length||Na(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=x;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(t,o,f,y,x){if(!f)return;Object.assign(t,f);const T={handlerName:y,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(o.zoom=T),f.panDelta!==void 0&&(o.drag=T),f.pitchDelta!==void 0&&(o.pitch=T),f.bearingDelta!==void 0&&(o.rotate=T)}_applyChanges(){const t={},o={},f={};for(const[y,x,T]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new s.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),Object.assign(o,x),Object.assign(f,T);this._updateMapTransform(t,o,f),this._changes=[]}_updateMapTransform(t,o,f){const y=this._map,x=y.transform,T=re=>[re.x,re.y,re.z];if((re=>{const he=this._eventsInProgress.drag;return he&&!this._handlersById[he.handlerName].isActive()})()&&!Na(t)){const re=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),re!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!Na(t))return void this._fireEvents(o,f,!0);let{panDelta:A,zoomDelta:R,bearingDelta:L,pitchDelta:k,around:U,aroundCoord:B,pinchAround:H}=t;x._isCameraConstrained&&(R>0&&(R=0),x._isCameraConstrained=!1),H!==void 0&&(U=H),(R||(re=>o[re]&&!this._eventsInProgress[re])("drag"))&&U&&(this._dragOrigin=T(x.pointCoordinate3D(U)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),U=U||y.transform.centerPoint,L&&(x.bearing+=L),k&&(x.pitch+=k),x._updateCameraState();const W=[0,0,0];if(A)if(x.projection.name==="mercator"){const re=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U).dir),he=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(U.sub(A)).dir);W[0]=he[0]-re[0],W[1]=he[1]-re[1]}else{const re=x.pointCoordinate(U);if(x.projection.name==="globe"){A=A.rotate(-x.angle);const he=x._pixelsPerMercatorPixel/x.worldSize;W[0]=-A.x*s.eV(s.a_(re.y))*he,W[1]=-A.y*s.eV(x.center.lat)*he}else{const he=x.pointCoordinate(U.sub(A));re&&he&&(W[0]=he.x-re.x,W[1]=he.y-re.y)}}const X=x.zoom,te=[0,0,0];if(R){const re=T(B||x.pointCoordinate3D(U)),he={dir:s.aw([],s.av([],re,x._camera.position))};if(he.dir[2]<0){const le=x.zoomDeltaToMovement(re,R);s.c4(te,he.dir,le)}}const ee=s.d7(W,W,te);x._translateCameraConstrained(ee),R&&Math.abs(x.zoom-X)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,f,!0)}_fireEvents(t,o,f){const y=kh(this._eventsInProgress),x=kh(t),T={};for(const k in t){const{originalEvent:U}=t[k];this._eventsInProgress[k]||(T[`${k}start`]=U),this._eventsInProgress[k]=t[k]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const k in T)this._fireEvent(k,T[k]);x&&this._fireEvent("move",x.originalEvent);for(const k in t){const{originalEvent:U}=t[k];this._fireEvent(k,U)}const A={};let R;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:B}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],R=o[U]||B,A[`${k}end`]=R)}for(const k in A)this._fireEvent(k,A[k]);const L=kh(this._eventsInProgress);if(f&&(y||x)&&!L){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:R})):(this._map.fire(new s.z("moveend",{originalEvent:R})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new s.z(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new em("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ys="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ko extends s.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,s.aX(["_renderFrameCallback"],this)}getCenter(){return new s.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,f){return t=s.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},o),f)}panTo(t,o,f){return this.easeTo(Object.assign({center:t},o),f)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,f){return this.easeTo(Object.assign({zoom:t},o),f)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,f){return this.easeTo(Object.assign({bearing:t},o),f)}resetNorth(t,o){return this.rotateTo(0,Object.assign({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=s.aI.convert(t);const f=o&&o.bearing||0,y=o&&o.pitch||0,x=t.getNorthWest(),T=t.getSouthEast();return this._cameraForBounds(this.transform,x,T,f,y,o)}_extendPadding(t){const o={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},o,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){const f=o.max[0]-o.min[0],y=o.max[1]-o.min[1];return f/y>t.aspect?f/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,f,y,x,T){const A=t.clone(),R=this._extendCameraOptions(T);A.bearing=y,A.pitch=x;const L=s.aS.convert(o),k=s.aS.convert(f),U=.5*(L.lat+k.lat),B=.5*(L.lng+k.lng),H=s.eY(U,B),W=s.aw([],H),X=s.aw([],s.bH([],W,[0,1,0])),te=s.bH([],X,W),ee=[X[0],X[1],X[2],0,te[0],te[1],te[2],0,W[0],W[1],W[2],0,0,0,0,1],re=[H,s.eY(L.lat,L.lng),s.eY(k.lat,L.lng),s.eY(k.lat,k.lng),s.eY(L.lat,k.lng),s.eY(U,L.lng),s.eY(U,k.lng),s.eY(L.lat,B),s.eY(k.lat,B)];let he=s.d8.fromPoints(re.map((Ke=>[s.bI(X,Ke),s.bI(te,Ke),s.bI(W,Ke)])));const le=s.af([],he.center,ee);s.eZ(le)===0&&s.e_(le,0,0,1),s.aw(le,le),s.c4(le,le,s.aD),A.center=s.e$(le);const we=A.getWorldToCameraMatrix(),fe=s.bk(new Float64Array(16),we);he=s.d8.applyTransform(he,s.aB([],we,ee));const Ee=this._extendAABB(he,A,R,y);if(!Ee)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");he=Ee,s.af(le,le,we);const ge=.5*(he.max[2]-he.min[2]),me=this._minimumAABBFrustumDistance(A,he),Se=s.c4([],[0,0,1],ge),Ve=s.d7(Se,le,Se),ke=me+(A.pitch===0?0:s.bF(le,Ve)),st=A.globeCenterInViewSpace,Xe=s.av([],le,[st[0],st[1],st[2]]);s.aw(Xe,Xe),s.c4(Xe,Xe,ke);const ht=s.d7([],le,Xe);s.af(ht,ht,fe);const zt=s.eL/s.aD,$e=s.ag(ht),Pe=s.ce(Math.max($e*zt-s.eL,Number.EPSILON),0),dt=Math.min(A.zoomFromMercatorZAdjusted(Pe),R.maxZoom);return dt>.5*(s.cZ+s.cK)?(A.setProjection({name:"mercator"}),A.zoom=dt,this._cameraForBounds(A,o,f,y,x,T)):{center:A.center,zoom:dt,bearing:y,pitch:x}}_extendAABB(t,o,f,y){const x=.5*((f.padding.left||0)+(f.padding.right||0)),T=.5*((f.padding.top||0)+(f.padding.bottom||0)),A=T,R=x,L=x,k=T,U=o.width-(R+L),B=o.height-(A+k),H=s.av([],t.max,t.min),W=Math.min(U/H[0],B/H[1]),X=Math.min(o.scaleZoom(o.scale*W),f.maxZoom);if(isNaN(X))return null;const te=o.scale/o.zoomScale(X),ee=new s.d8([t.min[0]-R*te,t.min[1]-k*te,t.min[2]],[t.max[0]+L*te,t.max[1]+A*te,t.max[2]]),re=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new s.P(f.offset.x,f.offset.y):s.P.convert(f.offset)).rotate(-s.an(y));return ee.center[0]-=re.x*te,ee.center[1]+=re.y*te,ee}queryTerrainElevation(t,o){const f=this.transform.elevation;return f?(o=Object.assign({},{exaggerated:!0},o),f.getAtPoint(s.ae.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,f,y,x,T){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,f,y,x,T);const A=t.clone(),R=this._extendCameraOptions(T);A.bearing=y,A.pitch=x;const L=s.aS.convert(o),k=s.aS.convert(f),U=new s.aS(L.lng,k.lat),B=new s.aS(k.lng,L.lat),H=A.project(L),W=A.project(k),X=this.queryTerrainElevation(L),te=this.queryTerrainElevation(k),ee=this.queryTerrainElevation(U),re=this.queryTerrainElevation(B),he=[[H.x,H.y,Math.min(X||0,te||0,ee||0,re||0)],[W.x,W.y,Math.max(X||0,te||0,ee||0,re||0)]];let le=s.d8.fromPoints(he);const we=A.getWorldToCameraMatrix(),fe=s.bk(new Float64Array(16),we);le=s.d8.applyTransform(le,we);const Ee=this._extendAABB(le,A,R,y);if(!Ee)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");le=Ee;const ge=.5*s.av([],le.max,le.min)[2],me=this._minimumAABBFrustumDistance(A,le),Se=[0,0,1,0];s.aC(Se,Se,we),s.f0(Se,Se);const Ve=s.c4([],Se,me+ge),ke=s.d7([],le.center,Ve);s.af(le.center,le.center,fe),s.af(ke,ke,fe);const st=A.unproject(new s.P(le.center[0],le.center[1])),Xe=s.f1(A.projection,st),ht=Math.pow(2,Xe),zt=Math.min(A._zoomFromMercatorZ(ke[2]*A.pixelsPerMeter*ht/A.worldSize),R.maxZoom);return A.mercatorFromTransition&&zt<.5*(s.cZ+s.cK)?(A.setProjection({name:"globe"}),A.zoom=zt,this._cameraForBounds(A,o,f,y,x,T)):{center:st,zoom:zt,bearing:y,pitch:x}}fitBounds(t,o,f){const y=this.cameraForBounds(t,o);return this._fitInternal(y,o,f)}fitScreenCoordinates(t,o,f,y,x){const T=s.P.convert(t),A=s.P.convert(o),R=new s.P(Math.min(T.x,A.x),Math.min(T.y,A.y)),L=new s.P(Math.max(T.x,A.x),Math.max(T.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,A))return this;const k=this.transform.pointLocation3D(R),U=this.transform.pointLocation3D(L),B=this.transform.pointLocation3D(new s.P(R.x,L.y)),H=this.transform.pointLocation3D(new s.P(L.x,R.y)),W=[Math.min(k.lng,U.lng,B.lng,H.lng),Math.min(k.lat,U.lat,B.lat,H.lat)],X=[Math.max(k.lng,U.lng,B.lng,H.lng),Math.max(k.lat,U.lat,B.lat,H.lat)],te=y&&y.pitch?y.pitch:this.getPitch(),ee=this._cameraForBounds(this.transform,W,X,f,te,y);return this._fitInternal(ee,y,x)}_fitInternal(t,o,f){return t?(o=Object.assign(t,o)).linear?this.easeTo(o,f):this.flyTo(o,f):this}jumpTo(t,o){this.stop();const f=t.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,T=!1;"zoom"in t&&f.zoom!==+t.zoom&&(y=!0,f.zoom=+t.zoom),t.center!==void 0&&(f.center=s.aS.convert(t.center)),"bearing"in t&&f.bearing!==+t.bearing&&(x=!0,f.bearing=+t.bearing),"pitch"in t&&f.pitch!==+t.pitch&&(T=!0,f.pitch=+t.pitch);const A=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!f.isPaddingEqual(A))if(t.retainPadding===!1){const R=f.clone();R.padding=A,f.setLocationAtPoint(f.center,R.centerPoint)}else f.padding=A;return t.preloadOnly?(this._preloadTiles(f),this):(this.fire(new s.z("movestart",o)).fire(new s.z("move",o)),y&&this.fire(new s.z("zoomstart",o)).fire(new s.z("zoom",o)).fire(new s.z("zoomend",o)),x&&this.fire(new s.z("rotatestart",o)).fire(new s.z("rotate",o)).fire(new s.z("rotateend",o)),T&&this.fire(new s.z("pitchstart",o)).fire(new s.z("pitch",o)).fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.w(ys),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const f=this.transform;if(!f.projection.supportsFreeCamera)return s.w(ys),this;this.stop();const y=f.zoom,x=f.pitch,T=f.bearing;f.setFreeCameraOptions(t);const A=y!==f.zoom,R=x!==f.pitch,L=T!==f.bearing;return this.fire(new s.z("movestart",o)).fire(new s.z("move",o)),A&&this.fire(new s.z("zoomstart",o)).fire(new s.z("zoom",o)).fire(new s.z("zoomend",o)),L&&this.fire(new s.z("rotatestart",o)).fire(new s.z("rotate",o)).fire(new s.z("rotateend",o)),R&&this.fire(new s.z("pitchstart",o)).fire(new s.z("pitch",o)).fire(new s.z("pitchend",o)),this.fire(new s.z("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:s.eU},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const f=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),A=this.getPadding(),R="zoom"in t?+t.zoom:y,L="bearing"in t?this._normalizeBearing(t.bearing,x):x,k="pitch"in t?+t.pitch:T,U=this._extendPadding(t.padding),B=s.P.convert(t.offset);let H,W,X;if(f.projection.name==="globe"){const Se=s.ae.fromLngLat(f.center),Ve=B.rotate(-f.angle);Se.x+=Ve.x/f.worldSize,Se.y+=Ve.y/f.worldSize;const ke=Se.toLngLat(),st=s.aS.convert(t.center||ke);this._normalizeCenter(st),H=f.centerPoint.add(Ve),W=new s.P(Se.x,Se.y).mult(f.worldSize),X=new s.P(s.aF(st.lng),s.aJ(st.lat)).mult(f.worldSize).sub(W)}else{H=f.centerPoint.add(B);const Se=f.pointLocation(H),Ve=s.aS.convert(t.center||Se);this._normalizeCenter(Ve),W=f.project(Se),X=f.project(Ve).sub(W)}const te=f.zoomScale(R-y);let ee,re;t.around&&(ee=s.aS.convert(t.around),re=f.locationPoint(ee));const he=this._zooming||R!==y,le=this._rotating||x!==L,we=this._pitching||k!==T,fe=!f.isPaddingEqual(U),Ee=t.retainPadding===!1?f.clone():f,ge=Se=>Ve=>{if(he&&(Se.zoom=s.ak(y,R,Ve)),le&&(Se.bearing=s.ak(x,L,Ve)),we&&(Se.pitch=s.ak(T,k,Ve)),fe&&(Ee.interpolatePadding(A,U,Ve),H=Ee.centerPoint.add(B)),ee)Se.setLocationAtPoint(ee,re);else{const ke=Se.zoomScale(Se.zoom-y),st=R>y?Math.min(2,te):Math.max(.5,te),Xe=Math.pow(st,1-Ve),ht=Se.unproject(W.add(X.mult(Ve*Xe)).mult(ke));Se.setLocationAtPoint(Se.renderWorldCopies?ht.wrap():ht,H)}return t.preloadOnly||this._fireMoveEvents(o),Se};if(t.preloadOnly){const Se=this._emulate(ge,t.duration,f);return this._preloadTiles(Se),this}const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=he,this._rotating=le,this._pitching=we,this._padding=fe,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,me),this._ease(ge(f),(Se=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(o,Se)}),t),this}_prepareEase(t,o,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||f.moving||this.fire(new s.z("movestart",t)),this._zooming&&!f.zooming&&this.fire(new s.z("zoomstart",t)),this._rotating&&!f.rotating&&this.fire(new s.z("rotatestart",t)),this._pitching&&!f.pitching&&this.fire(new s.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new s.z("move",t)),this._zooming&&this.fire(new s.z("zoom",t)),this._rotating&&this.fire(new s.z("rotate",t)),this._pitching&&this.fire(new s.z("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new s.z("zoomend",t)),y&&this.fire(new s.z("rotateend",t)),x&&this.fire(new s.z("pitchend",t)),this.fire(new s.z("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){const Ke=s.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ke,o)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:s.eU},t);const f=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),A=this.getPadding(),R="zoom"in t?s.aA(+t.zoom,f.minZoom,f.maxZoom):y,L="bearing"in t?this._normalizeBearing(t.bearing,x):x,k="pitch"in t?+t.pitch:T,U=this._extendPadding(t.padding),B=f.zoomScale(R-y),H=s.P.convert(t.offset);let W=f.centerPoint.add(H);const X=f.pointLocation(W),te=s.aS.convert(t.center||X);this._normalizeCenter(te);const ee=f.project(X),re=f.project(te).sub(ee);let he=t.curve;const le=Math.max(f.width,f.height),we=le/B,fe=re.mag();if("minZoom"in t){const Ke=s.aA(Math.min(t.minZoom,y,R),f.minZoom,f.maxZoom),At=le/f.zoomScale(Ke-y);he=Math.sqrt(At/fe*2)}const Ee=he*he;function ge(Ke){const At=(we*we-le*le+(Ke?-1:1)*Ee*Ee*fe*fe)/(2*(Ke?we:le)*Ee*fe);return Math.log(Math.sqrt(At*At+1)-At)}function me(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function Se(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const Ve=ge(0);let ke=function(Ke){return Se(Ve)/Se(Ve+he*Ke)},st=function(Ke){return le*((Se(Ve)*(me(At=Ve+he*Ke)/Se(At))-me(Ve))/Ee)/fe;var At},Xe=(ge(1)-Ve)/he;if(Math.abs(fe)<1e-6||!isFinite(Xe)){if(Math.abs(le-we)<1e-6)return this.easeTo(t,o);const Ke=we<le?-1:1;Xe=Math.abs(Math.log(we/le))/he,st=function(){return 0},ke=function(At){return Math.exp(Ke*he*At)}}t.duration="duration"in t?+t.duration:1e3*Xe/("screenSpeed"in t?+t.screenSpeed/he:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const ht=x!==L,zt=k!==T,$e=!f.isPaddingEqual(U),Pe=t.retainPadding===!1?f.clone():f,dt=Ke=>At=>{const wt=At*Xe,Ht=1/ke(wt);Ke.zoom=At===1?R:y+Ke.scaleZoom(Ht),ht&&(Ke.bearing=s.ak(x,L,At)),zt&&(Ke.pitch=s.ak(T,k,At)),$e&&(Pe.interpolatePadding(A,U,At),W=Pe.centerPoint.add(H));const mt=At===1?te:Ke.unproject(ee.add(re.mult(st(wt))).mult(Ht));return Ke.setLocationAtPoint(Ke.renderWorldCopies?mt.wrap():mt,W),Ke._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Ke};if(t.preloadOnly){const Ke=this._emulate(dt,t.duration,f);return this._preloadTiles(Ke),this}return this._zooming=!0,this._rotating=ht,this._pitching=zt,this._padding=$e,this._prepareEase(o,!1),this._ease(dt(f),(()=>this._afterEase(o)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,o)}if(!t){const f=this.handlers;f&&f.stop(!1)}return this}_ease(t,o,f){f.animate===!1||f.duration===0?(t(1),o()):(this._easeStart=s.o.now(),this._easeOptions=f,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((s.o.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=s.bS(t,-180,180);const f=Math.abs(t-o);return Math.abs(t-360-o)<f&&(t-=360),Math.abs(t+360-o)<f&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const f=t.lng-o.center.lng;t.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&s.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,f){const y=Math.ceil(15*o/1e3),x=[],T=t(f.clone());for(let A=0;A<=y;A++){const R=T(A/y);x.push(R.clone())}return x}_preloadTiles(t,o){}}class Hu{constructor(t={}){this.options=t,s.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact,f=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=it("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const y=it("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",f),this._innerContainer=it("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.e.ACCESS_TOKEN}];if(t){const f=o.reduce(((y,x,T)=>(x.value&&(y+=`${x.key}=${x.value}${T<o.length-1?"&":""}`),y)),"?");t.href=`${s.e.FEEDBACK_URL}/${f}#${Dh(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const o=this._map.style._mergedSourceCaches;for(const y in o){const x=o[y];if(x.used){const T=x.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t.sort(((y,x)=>y.length-x.length)),t=t.filter(((y,x)=>{for(let T=x+1;T<t.length;T++)if(t[T].indexOf(y)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const f=t.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,t.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fd{constructor(){s.aX(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=it("div","mapboxgl-ctrl");const o=it("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const f=t[o].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Bd{constructor(){s.aX(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(o=>this._onIndoorUpdate(o))),this._container}_createButton(t,o){const f=it("button",t,this._container);return f.type="button",f.addEventListener("click",o),f}_createSeparator(){return it("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,o){this._map&&(t.setAttribute("aria-label",o),t.textContent=o)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const o=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",o&&Array.from(this._container.children).forEach((f=>f.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const o=this._map;this._model&&o&&o._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));it("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,o){for(let f=0;f<t.length;f++){const y=t[f],x=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(y.id)}));this._setButtonTitle(x,y.zIndex.toString()),this._model&&y.id===this._model.selectedFloorId&&o&&x.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(x),f<t.length-1&&this._createSeparator()}}}class Nd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,f=o?this._queue.concat(o):this._queue;for(const y of f)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const f of o)if(!f.cancelled&&(f.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class fs{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=s.dC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,f){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+f}}const sv={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class F_ extends s.z{constructor(t,o,f,y){const{point:x,lngLat:T,originalEvent:A,target:R}=t;super(t.type,{point:x,lngLat:T,originalEvent:A,target:R}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=f,this.feature=y}}class im{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const f=o.filter;let y=o.type;f&&this.filters.set(t,s.b5(f)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const x=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,o)):x.size===0&&this.map.on(y,this.handleType),x.size===0&&this.interactionsByType.set(y,x),x.set(t,o),this.typeById.set(t,y)}get(t){const o=this.typeById.get(t);if(!o)return;const f=this.interactionsByType.get(o);return f?f.get(t):void 0}remove(t){const o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);const f=this.interactionsByType.get(o);f&&(f.delete(t),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(o,this.handleType))}queryTargets(t,o){const f=[];for(const[y,x]of o)x.target&&f.push({targetId:y,target:x.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,f,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());o.length&&(t.type="mouseenter",this.handleType(t,o));const f=new Map;for(const[y,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||f.set(x.id,x);f.size&&(t.type="mouseleave",this.handleType(t,Array.from(f.values())))}handleOut(t){const o=Array.from(this.hoveredFeatures.values()).map((({feature:f})=>f));o.length&&(t.type="mouseleave",this.handleType(t,o)),this.hoveredFeatures.clear()}handleType(t,o){const f=t.type==="mouseenter";if(f&&!this.interactionsByType.has(t.type))return void s.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(t.type)).reverse(),x=!!o;o=o||this.queryTargets(t.point,y);let T=!1;const A=new Set;for(const R of o){for(const[L,k]of y){if(!k.target)continue;const U=R.variants?R.variants[L]:null;if(U){for(const B of U){if(Mo(B,R,A,L))continue;const H=new s.dw(R,B),W=Da(B,R,L);x&&H.id!==void 0&&(H.state=this.map.getFeatureState(H));const X=f?this.prevHoveredFeatures.get(W):null,te=new F_(t,L,k,H),ee=X?X.stop:k.handler(te);if(f&&this.hoveredFeatures.set(W,{feature:R,stop:ee}),ee!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[R,L]of y){const{handler:k,target:U}=L;if(!U&&k(new F_(t,R,L,null))!==!1)break}}}function Fh(d,t){if(Array.isArray(d)&&Array.isArray(t)){const o=new Set(d),f=new Set(t);return o.size===f.size&&d.every((y=>f.has(y)))}return s.bx(d,t)}const Ql={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},qf={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vd{constructor(t,o,f=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new mo({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,f&&(this.mousePitch=new Kp({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),s.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),ei()}move(t,o){const f=this.map,y=this.mouseRotate.mousemoveWindow(t,o),x=y&&y.bearingDelta;if(x&&f.setBearing(f.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(t,o),A=T&&T.pitchDelta;A&&f.setPitch(f.getPitch()+A)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Fi(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Oe(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Oe(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=je(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=je(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function nl(d,t,o){if(d=new s.aS(d.lng,d.lat),t){const f=new s.aS(d.lng-360,d.lat),y=new s.aS(d.lng+360,d.lat),x=360*Math.ceil(Math.abs(d.lng-o.center.lng)/360),T=o.locationPoint3D(d).distSqr(t),A=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint3D(f).distSqr(t)<T&&(A||Math.abs(f.lng-o.center.lng)<x)?d=f:o.locationPoint3D(y).distSqr(t)<T&&(A||Math.abs(y.lng-o.center.lng)<x)&&(d=y)}for(;Math.abs(d.lng-o.center.lng)>180;){const f=o.locationPoint3D(d);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;d.lng>o.center.lng?d.lng-=360:d.lng+=360}return d}const go={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},So={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Jl extends s.E{constructor(t,o){super(),(t instanceof HTMLElement||o)&&(t=Object.assign({element:t},o)),s.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:f="center",color:y="#3FB1CE",scale:x=1,draggable:T=!1,clickTolerance:A=0,rotation:R=So.rotation,rotationAlignment:L=So.rotationAlignment,pitchAlignment:k=So.pitchAlignment,occludedOpacity:U=So.occludedOpacity,altitude:B=So.altitude}=t||{};this._anchor=f,this._color=y,this._scale=x,this._draggable=T,this._clickTolerance=A,this._rotation=R,this._rotationAlignment=L,this._pitchAlignment=k,this._occludedOpacity=U,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=s.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=s.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(X=>{X.preventDefault()})),this._element.addEventListener("mousedown",(X=>{X.preventDefault()}));const H=this._element.classList;for(const X in go)H.remove(`mapboxgl-marker-anchor-${X}`);H.add(`mapboxgl-marker-anchor-${this._anchor}`);const W=t&&t.className?t.className.trim().split(/\s+/):[];H.add(...W),this._popup=null}_createDefaultMarker(){const t=it("div"),o=Ze("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const f=Ze("radialGradient",{id:"shadowGradient"},Ze("defs",{},o));Ze("stop",{offset:"10%","stop-opacity":.4},f),Ze("stop",{offset:"100%","stop-opacity":.05},f),Ze("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return Ze("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),Ze("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),Ze("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=s.aS.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||So.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,f=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,f=this._element;this._popup&&(o===f||f.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const f=t.unproject(o,this._altitude),y=t.getFreeCameraOptions();if(!y.position)return!1;const x=y.position.toLngLat();return x.distanceTo(f)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const f=t.unproject(o,this._altitude);let y;t._showingGlobe()&&s.f4(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(f),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${go[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const t=this._pos,o=this._map,f=this.getPitchAlignment();if(!o||!t||f!=="map")return"";if(!o._showingGlobe()){const R=o.getPitch();return R?`rotateX(${R}deg)`:""}const y=s.cW(s.f5(o.transform,this._lngLat)),x=t.sub(s.f6(o.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const A=y/T;return`rotateX(${-x.y*A}deg) rotateY(${x.x*A}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let f=0;const y=this.getRotationAlignment();if(y==="map")if(o._showingGlobe()){const x=o.project(new s.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=o.project(new s.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);f=s.cW(Math.atan2(T.y,T.x))-90}else f=-o.getBearing();else if(y==="horizon"){const x=s.ah(4,6,o.getZoom()),T=s.f6(o.transform);T.y+=x*o.transform.height;const A=t.sub(T),R=s.cW(Math.atan2(A.y,A.x));f=(R>90?R-270:R+90)*(1-x)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=nl(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),o._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=s.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const o=this._map;if(!o)return;const f=this._pointerdownPos,y=this._positionDelta;if(f&&y){if(!this._isDragging){const x=this._clickTolerance||o._clickTolerance;if(t.point.dist(f)<x)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.z("dragstart"))),this.fire(new s.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.z("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,f=this._pos;o&&f&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(f),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||So.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||So.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||So.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||So.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const El={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Tg={maxWidth:100,unit:"metric"},Eg={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},nm={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},B_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ec(d=new s.P(0,0),t="bottom"){if(typeof d=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new s.P(0,d);case"top-left":return new s.P(o,o);case"top-right":return new s.P(-o,o);case"bottom":return new s.P(0,-d);case"bottom-left":return new s.P(o,-o);case"bottom-right":return new s.P(-o,-o);case"left":return new s.P(d,0);case"right":return new s.P(-d,0)}return new s.P(0,0)}return d instanceof s.P||Array.isArray(d)?s.P.convert(d):s.P.convert(d[t]||[0,0])}return{version:G,supported:Je.supported,setRTLTextPlugin:s.fa,getRTLTextPluginStatus:s.f9,Map:class extends ko{constructor(d){ie.mark(q.create);const t=d;if((d=Object.assign({},Ql,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&s.f2(window)&&(d.antialias=!1,s.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Oo(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Nd,this._domRenderTaskQueue=new Nd,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.b1(),this._locale=Object.assign({},sv,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fs(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new ur(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const o=document.getElementById(d.container);if(!o)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=o}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&s.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,s.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new z_),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new tm(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||s.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),d.hash&&(this._hash=new Od(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const o=d.bounds;o&&(this.resize(),this.fitBounds(o,Object.assign({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new Hu({customAttribution:d.customAttribution})),this._logoControl=new Fd,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(o=>{this._update(o.dataType==="style"),this.fire(new s.z(`${o.dataType}data`,o))})),this.on("dataloading",(o=>{this.fire(new s.z(`${o.dataType}dataloading`,o))})),this._interactions=new im(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new s.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[t];return t.indexOf("bottom")!==-1?f.insertBefore(o,f.firstChild):f.appendChild(o),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new s.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new s.z("movestart",d)).fire(new s.z("move",d)),this.fire(new s.z("resize",d)),t&&this.fire(new s.z("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(s.aI.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new s.z("zoomstart")).fire(new s.z("zoom")).fire(new s.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new s.z("pitchstart")).fire(new s.z("pitch")).fire(new s.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map((t=>t==="auto"?navigator.language:t)):d}setLanguage(d){const t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,t=d.projection.name;let o;t==="globe"&&d.zoom>=s.cK?(d.setMercatorFromTransition(),o=!0):t==="mercator"&&d.zoom<s.cK&&(d.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;const o=this.transform.mercatorFromTransition;t=d.name==="globe"&&this.transform.zoom>=s.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate();const f=this.transform.getProjection().name==="mercator"&&o!==this.transform.mercatorFromTransition;return(t||f)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,t){return this.transform.locationPoint3D(s.aS.convert(d),t)}unproject(d,t){return this.transform.pointLocation3D(s.P.convert(d),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,o){const f=y=>{let x=[];if(Array.isArray(t)){const T=t.filter((A=>this.getLayer(A)));x=T.length?this.queryRenderedFeatures(y,{layers:T}):[]}else x=this.queryRenderedFeatures(y,{target:t});return x};if(d==="mouseenter"||d==="mouseover"){let y=!1;return{listener:o,targets:t,delegates:{mousemove:T=>{const A=f(T.point);A.length?y||(y=!0,o.call(this,new Cr(d,this,T.originalEvent,{features:A}))):y=!1},mouseout:()=>{y=!1}}}}if(d==="mouseleave"||d==="mouseout"){let y=!1;return{listener:o,targets:t,delegates:{mousemove:A=>{f(A.point).length?y=!0:y&&(y=!1,o.call(this,new Cr(d,this,A.originalEvent)))},mouseout:A=>{y&&(y=!1,o.call(this,new Cr(d,this,A.originalEvent)))}}}}{const y=x=>{const T=f(x.point);T.length&&(x.features=T,o.call(this,x),delete x.features)};return{listener:o,targets:t,delegates:{[d]:y}}}}on(d,t,o){if(typeof t=="function"||o===void 0)return super.on(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const f=this._createDelegatedListener(d,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(d,t,o){if(typeof t=="function"||o===void 0)return super.once(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const f=this._createDelegatedListener(d,t,o);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(d,t,o){if(typeof t=="function"||o===void 0)return super.off(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const f=this._delegatedListeners?this._delegatedListeners[d]:void 0;return f&&(y=>{for(let x=0;x<y.length;x++){const T=y[x];if(T.listener===o&&Fh(T.targets,t)){for(const A in T.delegates)this.off(A,T.delegates[A]);return y.splice(x,1),this}}})(f),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(d===void 0||d instanceof s.P||Array.isArray(d)||t!==void 0||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!t){const x=this.style.queryRenderedFeatures(d,void 0,this.transform),T=this.style.queryRenderedFeatureset(d,void 0,this.transform);return x.concat(T)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(d,t,this.transform);let f=!0;if(t.layers&&Array.isArray(t.layers)){for(const x of t.layers)if(!this._isValidId(x)){f=!1;break}if(f&&!t.target)return this.style.queryRenderedFeatures(d,t,this.transform)}let y=[];return f&&(y=y.concat(this.style.queryRenderedFeatures(d,t,this.transform))),o&&(y=y.concat(this.style.queryRenderedFeatureset(d,t,this.transform))),y}querySourceFeatures(d,t){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,t)}queryRasterValue(d,t,o){return this._isValidId(d)?this.style.queryRasterValue(d,t,o):Promise.resolve(null)}isPointOnSurface(d){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&s.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,((o,f)=>{if(o){const y=typeof o=="string"?o:o instanceof Error?o.message:o.error;s.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(d,t)}else f&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const o=Object.assign({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new ml(this,o).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ml(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new s.y(new Error("IDs can't be empty."))),!1):!s.dq(d)||(this.fire(new s.y(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const t of d)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(d)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,o)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:o=1,sdf:f=!1,stretchX:y,stretchY:x,content:T}={}){this._lazyInitEmptyStyle();const A=s.I.from(d);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:R,height:L,data:k}=s.o.getImageData(t);this.style.addImage(A,{data:new s.q({width:R,height:L},k),pixelRatio:o,stretchX:y,stretchY:x,content:T,sdf:f,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new s.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:L}=t,k=t;this.style.addImage(A,{data:new s.q({width:R,height:L},new Uint8Array(k.data)),pixelRatio:o,stretchX:y,stretchY:x,content:T,sdf:f,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();const o=s.I.from(d),f=this.style.getImage(o);if(!f)return void this.fire(new s.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?s.o.getImageData(t):t,{width:x,height:T,data:A}=y;if(x===void 0||T===void 0)return void this.fire(new s.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||T!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new s.y(new Error(`The width and height of the updated image (${x}, ${T})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const R=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let L=!1;f.usvg?(f.data=new s.q({width:x,height:T},new Uint8Array(A)),f.usvg=!1,f.icon=void 0,L=!0):f.data.replace(A,R),this.style.updateImage(o,f,L)}hasImage(d){return d?!!this.style&&!!this.style.getImage(s.I.from(d)):(this.fire(new s.y(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(s.I.from(d))}loadImage(d,t){s.n(this._requestManager.transformRequest(d,s.R.Image),((o,f)=>{t(o,f instanceof HTMLImageElement?s.o.getImageData(f):f)}))}listImages(){return this.style.listImages().map((d=>d.name))}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new s.y(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){const t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t).catch((o=>this.fire(new s.y(new Error("Failed to add import",o))))),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,o){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,o),this._update(!0)):this}setFilter(d,t,o={}){return this._isValidId(d)?(this.style.setFilter(d,t,o),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,o,f={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,o,f),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,o,f={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,o,f),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}setLayerProperty(d,t,o,f={}){return this._isValidId(d)?(this.style.setLayerProperty(d,t,o,f),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,o){return this.style.setConfigProperty(d,t,o),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,t),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.aS.convert(d),this.transform):0}setFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,t),this._update())}removeFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,t),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_selectIndoorFloor(d){this.indoor.selectFloor(d)}_setIndoorActiveFloorsVisibility(d){this.indoor.setActiveFloorsVisibility(d)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Bd),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,f,y,x=this._container;for(;x&&(!f||!y);){const T=window.getComputedStyle(x).transform;T&&T!=="none"&&(o=T.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(f=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(y=o[3])),x=x.parentElement}this._containerWidth=f?Math.abs(d/f):d,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new hh(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=it("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=it("div","mapboxgl-canvas-container",d);this._canvas=it("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=it("div","mapboxgl-control-container",d),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((y=>{f[y]=it("div",`mapboxgl-ctrl-${y}`,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const o=s.o.devicePixelRatio||1;this._canvas.width=o*Math.ceil(d),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const d=Object.assign({},Je.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?(ps(t,!0),this.painter=new su(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),s.k.testSupport(t)):this.fire(new s.y(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.z("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new s.z("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new s.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,f=s.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,k=this.transform.pitch,U=s.o.now(),B=new s.ac(L,{now:U,fadeDuration:x,pitch:k,transition:this.style.transition,worldview:this._worldview});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(f);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,ie.mark(q.load),this.fire(new s.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const L=s.o.now()-f;y.endQuery(o.TIME_ELAPSED_EXT),setTimeout((()=>{const k=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new s.z("gpu-timing-frame",{cpuTime:L,gpuTime:k}))}),50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout((()=>{const k=this.painter.queryGpuTimers(L);this.fire(new s.z("gpu-timing-layer",{layerTimes:k}))}),50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const k=this.painter.queryGpuTimeDeferredRender(L);this.fire(new s.z("gpu-timing-deferred-render",{gpuTime:k}))}),50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(R||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(T=this._updateAverageElevation(f,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new s.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new s.z("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,ie.mark(q.fullLoad),this._performanceMetricsCollection&&hr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){const o=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const y=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=d;const T=Math.abs(y-x);if(T>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(x),o(x);this._averageElevation.easeTo(x,d,300)}else if(T>1e-4)return this._averageElevation.jumpTo(x),o(x)}return!!this._averageElevation.isEasing(d)&&o(this._averageElevation.getValue(d))}_authenticate(){co(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(d=>{if(d&&(d.message===ze||d.status===401)){const t=this.painter.context.gl;ps(t,!1),this._logoControl instanceof Fd&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),_i(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&kn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Mr(this._requestManager._customAccessToken)}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,f=o.createFramebuffer();function y(x){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,x,0);const T=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,T),T}return o.bindFramebuffer(o.FRAMEBUFFER,f),this._canvasPixelComparison(y(d),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(d,t,o){let f=o[1]-o[0];const y=d.length/4;for(let x=0;x<t.length;x++){const T=t[x];let A=0;for(let R=0;R<T.length;R+=4)T[R]===d[R]&&T[R+1]===d[R+1]&&T[R+2]===d[R+2]&&T[R+3]===d[R+3]&&(A+=1);f+=(o[x+2]-o[x+1])*(1-A/y)}return f}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),nr.delete(this.painter.context.gl),Wr.remove(),ai.remove(),this._removed=!0,this.fire(new s.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=s.o.frame((t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)})))}_preloadTiles(d){const t=this.style?this.style.getSourceCaches():[];return s.bv(t,((o,f)=>o._preloadTiles(d,f)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){s.f3(d,t)}get version(){return G}},NavigationControl:class{constructor(d={}){this.options=Object.assign({},qf,d),this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(s.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),it("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),it("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))})),this._compassIcon=it("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const t=d.getZoom(),o=t===d.getMaxZoom(),f=t===d.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vd(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){const o=it("button",d,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(d,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",o),d.firstElementChild&&d.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends s.E{constructor(d={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},El,d),s.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,d(o)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((o=>t(o.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),o=d.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new s.z("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("geolocate",Object.assign({coords:d.coords,timestamp:d.timestamp},d.toJSON?{toJSON:d.toJSON.bind(d)}:{}))),this._finish()}}_updateCamera(d){const t=new s.aS(d.coords.longitude,d.coords.latitude),o=d.coords.accuracy,f=this._map.getBearing(),y=Object.assign({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),y,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new s.aS(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,t=s.ce(1,d._center.lat)*d.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.z("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=it("button","mapboxgl-ctrl-geolocate",this._container),it("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=it("div","mapboxgl-user-location"),this._dotElement.appendChild(it("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(it("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=it("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.z("trackuserlocationend")))}))}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&d()})).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hu,ScaleControl:class{constructor(d={}){this.options=Object.assign({},Tg,d),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),s.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,f=t._containerWidth/2-d/2,y=t.unproject([f,o]),x=t.unproject([f+d,o]),T=y.distanceTo(x);if(this.options.unit==="imperial"){const A=3.2808*T;A>5280?this._setScale(d,A/5280,"mile"):this._setScale(d,A,"foot")}else this.options.unit==="nautical"?this._setScale(d,T/1852,"nautical-mile"):T>=1e3?this._setScale(d,T/1e3,"kilometer"):this._setScale(d,T,"meter")}_setScale(d,t,o){this._map._requestDomTask((()=>{const f=(function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let A=x/T;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:(function(R){const L=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*L)/L})(A),T*A})(t),y=f/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(f):`${f}&nbsp;${Eg[o]}`,this._container.style.width=d*y+"px"}))}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=it("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:s.w("Full screen control 'container' must be a DOM element.")),s.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=it("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=it("button","mapboxgl-ctrl-fullscreen",this._controlContainer);it("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Bd,Popup:class extends s.E{constructor(d){super(),this.options=Object.assign(Object.create(nm),d),this._altitude=this.options.altitude,s.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new s.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new s.z("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=s.aS.convert(d),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),o=document.createElement("body");let f;for(o.innerHTML=d;f=o.firstChild,f;)t.appendChild(f);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=it("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){const o=this._closeButton=it("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,f=this._pos;if(!t||!o||!f)return"bottom";const y=o.offsetWidth,x=o.offsetHeight,T=f.x<y/2,A=f.x>t.transform.width-y/2;if(f.y+d<x)return T?"top-left":A?"top-right":"top";if(f.y>t.transform.height-x){if(T)return"bottom-left";if(A)return"bottom-right"}return T?"left":A?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let f=this._container;if(f||(f=this._container=it("div","mapboxgl-popup",t.getContainer()),this._tip=it("div","mapboxgl-popup-tip",f),f.appendChild(o)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nl(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){const y=this._pos=this._trackPointer&&d instanceof s.P?d:t.project(this._lngLat,this._altitude),x=ec(this.options.offset),T=this._anchor=this._getAnchor(x.y),A=ec(this.options.offset,T),R=y.add(A).round();t._requestDomTask((()=>{this._container&&T&&(this._container.style.transform=`${go[T]} translate(${R.x}px,${R.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const y=s.f4(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(B_);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:Jl,Style:ml,LngLat:s.aS,LngLatBounds:s.aI,Point:s.P,MercatorCoordinate:s.ae,FreeCameraOptions:pc,Evented:s.E,config:s.e,prewarm:s.f8,clearPrewarmedResources:s.f7,get accessToken(){return s.e.ACCESS_TOKEN},set accessToken(d){s.e.ACCESS_TOKEN=d},get baseApiUrl(){return s.e.API_URL},set baseApiUrl(d){s.e.API_URL=d},get workerCount(){return s.fh.workerCount},set workerCount(d){s.fh.workerCount=d},get maxParallelImageRequests(){return s.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){s.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){s.fg(d)},get workerUrl(){return s.ff.workerUrl},set workerUrl(d){s.ff.workerUrl=d},get workerClass(){return s.ff.workerClass},set workerClass(d){s.ff.workerClass=d},get workerParams(){return s.ff.workerParams},set workerParams(d){s.ff.workerParams=d},get dracoUrl(){return s.fe()},set dracoUrl(d){s.fd(d)},get meshoptUrl(){return s.fc()},set meshoptUrl(d){s.fb(d)},setNow:s.o.setNow,restoreNow:s.o.restoreNow}}));var P=b;return P}))})(Bb)),Bb.exports}var CH=IH();const Fy=N0(CH);async function RH(c){(await $S(B0(Ll,"pins"))).forEach(l=>{const p=l.data(),b=["#ff8fa3","#ffb3c6","#ffc8dd","#a3c4f3","#90dbf4","#8eecf5","#b9fbc0"],I=b[Math.floor(Math.random()*b.length)];console.log("Loading pin:",p);const P=`
      <div style="padding: 10px; width: 220px; font-family: 'Pacifico', cursive; background-color: #fff;">
        <h4 style="margin: 0 0 8px 0; font-size: 18px; font-weight: bold; color: #333;">
          ${p.name}
        </h4>
        <p style="margin: 0 0 10px 0; font-size: 13px; color: #666;">
           ${p.date}
        </p>
        ${p.image?`
          <img
            src="${p.image}"
            alt="${p.name}"
            style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px; display: block; margin-bottom: 10px;"
          />
        `:""}
        <button 
          onclick="window.location.hash = '/destination/${l.id}'"
          style="
            width: 100%;
            padding: 8px;
            background-color: #ff8fa3;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            font-family: 'Pacifico', cursive;
          "
        >
          View Details 
        </button>
      </div>
    `;new Fy.Marker({color:I}).setLngLat([p.lng,p.lat]).setPopup(new Fy.Popup({offset:25,maxWidth:"260px",className:"custom-popup"}).setHTML(P)).addTo(c)})}Fy.accessToken="pk.eyJ1IjoiZW1tYTY2NjY2NjYiLCJhIjoiY21pNmZmbXYxMGFlbTJscHpnbDl2cHcxaiJ9.2U4UX-jcL3WTRjJUN8jBqA";function MH(){const c=ve.useRef(null),n=ve.useRef(null),[l,p]=ve.useState(null),[b,I]=ve.useState(!1),[P,s]=ve.useState({lng:0,lat:0}),[G,q]=ve.useState(""),[ie,ce]=ve.useState(""),[be,He]=ve.useState(null),[Je,it]=ve.useState(!1);ve.useEffect(()=>{const ct=K0(td,Gt=>{p(Gt)});return()=>ct()},[]),ve.useEffect(()=>{if(!n.current)return n.current=new Fy.Map({container:c.current,style:"mapbox://styles/mapbox/streets-v12",center:[-98.5,39.8],zoom:2.3}),n.current.on("load",()=>{RH(n.current)}),n.current.on("click",ct=>{if(ct.originalEvent.target.classList.contains("mapboxgl-marker")||ct.originalEvent.target.closest(".mapboxgl-marker")||ct.originalEvent.target.closest(".mapboxgl-popup"))return;if(td.currentUser){const{lng:ei,lat:Fi}=ct.lngLat;s({lng:ei,lat:Fi}),I(!0)}else alert("Please login to add pins! ")}),()=>{n.current&&n.current.remove()}},[]);async function Ze(ct){const Gt=Date.now(),ei=pO(QL,`pins/${l.uid}_${Gt}`);return await dO(ei,ct),await fO(ei)}async function Pt(){if(!G){alert("Please enter a pin name!");return}it(!0);try{let ct="";be&&(ct=await Ze(be)),await YL(B0(Ll,"pins"),{name:G,date:ie||new Date().toISOString().split("T")[0],lng:P.lng,lat:P.lat,image:ct,userId:l.uid,userEmail:l.email,createdAt:new Date().toISOString()});const Gt=["#ff8fa3","#ffb3c6","#ffc8dd","#a3c4f3","#90dbf4","#8eecf5","#b9fbc0"],ei=Gt[Math.floor(Math.random()*Gt.length)],Fi=`
        <div style="padding: 10px; width: 220px; font-family: 'Pacifico', cursive;">
          <h4 style="margin: 0 0 8px 0; font-size: 18px;">${G}</h4>
          <p style="margin: 0 0 10px 0; font-size: 13px; color: #666;"> ${ie}</p>
          ${ct?`<img src="${ct}" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px;" />`:""}
        </div>
      `;new Fy.Marker({color:ei}).setLngLat([P.lng,P.lat]).setPopup(new Fy.Popup({offset:25}).setHTML(Fi)).addTo(n.current),I(!1),q(""),ce(""),He(null),alert("Pin added successfully! ")}catch(ct){console.error("Error saving pin:",ct),alert(`Failed to save pin: ${ct.message}`)}finally{it(!1)}}return xe.jsxs("div",{style:{width:"100%",minHeight:"100vh",paddingTop:"80px",display:"flex",justifyContent:"center",background:"linear-gradient(to bottom, #ffffffff, #fcd9d9ff)"},children:[xe.jsxs(jm,{style:{width:"100%",maxWidth:"100%",padding:"20px"},children:[xe.jsx("h1",{style:{fontFamily:"'Dancing Script', cursive",color:"black",textAlign:"center"},children:"Welcome to Journeyly!"}),xe.jsx("p",{style:{fontWeight:20,fontFamily:"'Courgette', cursive",textAlign:"center"},children:"Every pin is a tiny piece of your story. Start adding them and watch your Journeyly map fill with color, adventure, and all the places that shaped you."}),!l&&xe.jsx("p",{style:{fontFamily:"'Dancing Script', cursive",textAlign:"center",color:"#ff8fa3",fontSize:"18px",marginTop:"10px"},children:" Login to add your own pins to the map!"}),xe.jsx("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px"},children:xe.jsx("div",{ref:c,style:{width:"80%",height:"600px",borderRadius:"50%",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"}})})]}),xe.jsxs(h0,{show:b,onHide:()=>I(!1),centered:!0,children:[xe.jsx(h0.Header,{closeButton:!0,children:xe.jsx(h0.Title,{style:{fontFamily:"'Pacifico', cursive"},children:" Add New Pin"})}),xe.jsx(h0.Body,{children:xe.jsxs(Vi,{children:[xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Location Name *"}),xe.jsx(Vi.Control,{type:"text",value:G,onChange:ct=>q(ct.target.value),placeholder:"e.g., Central Park, My Favorite Cafe",required:!0})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Date (optional)"}),xe.jsx(Vi.Control,{type:"date",value:ie,onChange:ct=>ce(ct.target.value)})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Photo (optional)"}),xe.jsx(Vi.Control,{type:"file",accept:"image/*",onChange:ct=>He(ct.target.files[0])})]}),xe.jsx("div",{style:{padding:"10px",background:"#f8f9fa",borderRadius:"8px",marginTop:"10px"},children:xe.jsxs("p",{style:{margin:0,fontSize:"14px",fontFamily:"'Dancing Script', cursive"},children:[" Lng: ",P.lng.toFixed(4),", Lat: ",P.lat.toFixed(4)]})})]})}),xe.jsxs(h0.Footer,{children:[xe.jsx(vo,{variant:"secondary",onClick:()=>I(!1),disabled:Je,children:"Cancel"}),xe.jsx(vo,{onClick:Pt,disabled:Je,style:{background:"#ff8fa3",border:"none",fontFamily:"'Pacifico', cursive"},children:Je?"Saving...":"Save Pin "})]})]})]})}function DH(){const[c,n]=ve.useState(()=>Number(localStorage.getItem("aboutLikes"))||0),[l,p]=ve.useState(()=>localStorage.getItem("aboutLiked")==="true");function b(){let I=c,P=l;l?(I=c-1,P=!1):(I=c+1,P=!0),n(I),p(P),localStorage.setItem("aboutLikes",I),localStorage.setItem("aboutLiked",P)}return xe.jsx("div",{style:{width:"100%",minHeight:"100vh",paddingTop:"80px",display:"flex",justifyContent:"center",background:"linear-gradient(to bottom, #ffffffff, #fcd9d9ff)"},children:xe.jsxs(jm,{style:{width:"100%",maxWidth:"100%",padding:"20px"},children:[xe.jsx("h1",{style:{fontFamily:"'Dancing Script', cursive",color:"black",textAlign:"center"},children:"About Me"}),xe.jsxs("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:"40px",marginTop:"40px",padding:"0 40px",flexWrap:"wrap"},children:[xe.jsx("img",{src:"https://i.ibb.co/7xytZVLR/IMG-7075.jpg",alt:"Emma",style:{width:"280px",height:"280px",objectFit:"cover",borderRadius:"20px",boxShadow:"0 4px 10px rgba(0,0,0,0.15)"}}),xe.jsxs("p",{style:{fontFamily:"'Courgette', cursive",fontSize:"20px",lineHeight:"1.6",maxWidth:"500px",textAlign:"left"},children:["Hi! I'm Emma  an international student living in the United States. I created Journeyly as a personal space to record my trips, daily life, and the little moments that shape my journey. This website is my way of preserving beautiful memories and sharing them with anyone who enjoys exploring new places and finding joy in simple things.",xe.jsx("br",{}),xe.jsx("br",{}),"From road trips and city walks to everyday experiences on campus, Journeyly is a collection of the places Ive been, the people Ive met, and the memories I never want to forget. Thank you for visiting  I hope my stories bring a little warmth, inspiration, or curiosity to your day."]})]}),xe.jsxs("div",{style:{marginTop:"40px",display:"flex",flexDirection:"column",alignItems:"center",gap:"10px"},children:[xe.jsx("button",{onClick:b,style:{fontSize:"40px",background:"none",border:"none",cursor:"pointer",color:l?"red":"#444",transition:"0.2s"},children:l?"":""}),xe.jsxs("span",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"20px",color:"#333"},children:[c," likes"]})]})]})})}function PH(){const c=h1(),[n,l]=ve.useState(""),[p,b]=ve.useState(""),[I,P]=ve.useState(""),[s,G]=ve.useState(""),[q,ie]=ve.useState(""),[ce,be]=ve.useState(""),[He,Je]=ve.useState(""),[it,Ze]=ve.useState(!1),[Pt,ct]=ve.useState(!1),[Gt,ei]=ve.useState({type:"",text:""});async function Fi(Oe){Oe.preventDefault(),ct(!0),ei({type:"",text:""});try{const tt=(await k6(td,n,p)).user,nt=await Xm(Yu(Ll,"users",tt.uid));if(nt.exists()){const yt=nt.data();ei({type:"success",text:` Welcome back, ${yt.name}!`})}else ei({type:"success",text:" Login successful!"});setTimeout(()=>c("/"),1500)}catch(je){console.error("Login error:",je);let tt="Login failed. ";switch(je.code){case"auth/user-not-found":tt+="No account found with this email.";break;case"auth/wrong-password":tt+="Incorrect password.";break;case"auth/invalid-email":tt+="Invalid email address.";break;case"auth/too-many-requests":tt+="Too many failed attempts. Try again later.";break;default:tt+=je.message}ei({type:"danger",text:` ${tt}`})}finally{ct(!1)}}async function Si(Oe){if(Oe.preventDefault(),ct(!0),ei({type:"",text:""}),s!==ce){ei({type:"danger",text:" Passwords don't match!"}),ct(!1);return}if(s.length<6){ei({type:"danger",text:" Password must be at least 6 characters!"}),ct(!1);return}try{const tt=(await z6(td,I,s)).user;await WS(Yu(Ll,"users",tt.uid),{uid:tt.uid,email:I,name:q,role:"friend",createdAt:new Date().toISOString(),pinsCount:0}),ei({type:"success",text:` Account created successfully! Welcome, ${q}!`}),setTimeout(()=>c("/"),1500)}catch(je){console.error("Signup error:",je);let tt="Signup failed. ";switch(je.code){case"auth/email-already-in-use":tt+="This email is already registered.";break;case"auth/invalid-email":tt+="Invalid email address.";break;case"auth/weak-password":tt+="Password is too weak.";break;default:tt+=je.message}ei({type:"danger",text:` ${tt}`})}finally{ct(!1)}}async function qe(Oe){Oe.preventDefault(),ct(!0),ei({type:"",text:""});try{await L6(td,He),ei({type:"success",text:" Password reset email sent! Check your inbox."}),Ze(!1),Je("")}catch(je){console.error("Reset password error:",je),ei({type:"danger",text:` Failed to send reset email: ${je.message}`})}finally{ct(!1)}}return xe.jsx("div",{style:{paddingTop:"80px",minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(to bottom, #ffffff, #fcd9d9)"},children:xe.jsxs(jm,{style:{maxWidth:"500px"},children:[xe.jsx("h1",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"30px",color:"#333"},children:"Welcome to Journeyly! "}),Gt.text&&xe.jsx(TE,{variant:Gt.type,onClose:()=>ei({type:"",text:""}),dismissible:!0,children:Gt.text}),it?xe.jsxs(Kd,{style:{padding:"30px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",borderRadius:"15px"},children:[xe.jsx("h4",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"20px"},children:"Reset Password"}),xe.jsxs(Vi,{onSubmit:qe,children:[xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Email"}),xe.jsx(Vi.Control,{type:"email",value:He,onChange:Oe=>Je(Oe.target.value),placeholder:"your@email.com",required:!0}),xe.jsx(Vi.Text,{className:"text-muted",children:"We'll send you a password reset link"})]}),xe.jsx(vo,{type:"submit",disabled:Pt,style:{width:"100%",padding:"12px",fontFamily:"'Pacifico', cursive",background:"#ff8fa3",border:"none",fontSize:"16px",marginBottom:"10px"},children:Pt?"Sending...":"Send Reset Email"}),xe.jsx(vo,{variant:"link",onClick:()=>Ze(!1),style:{width:"100%",fontFamily:"'Dancing Script', cursive",color:"#666"},children:"Back to Login"})]})]}):xe.jsx(Kd,{style:{padding:"30px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",borderRadius:"15px"},children:xe.jsxs(MD,{defaultActiveKey:"login",className:"mb-3",children:[xe.jsx(uC,{eventKey:"login",title:"Login",children:xe.jsxs(Vi,{onSubmit:Fi,children:[xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Email"}),xe.jsx(Vi.Control,{type:"email",value:n,onChange:Oe=>l(Oe.target.value),placeholder:"your@email.com",required:!0})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Password"}),xe.jsx(Vi.Control,{type:"password",value:p,onChange:Oe=>b(Oe.target.value),placeholder:"",required:!0})]}),xe.jsx(vo,{type:"submit",disabled:Pt,style:{width:"100%",padding:"12px",fontFamily:"'Pacifico', cursive",background:"#ff8fa3",border:"none",fontSize:"16px"},children:Pt?"Logging in...":"Login"}),xe.jsx("div",{style:{textAlign:"center",marginTop:"15px"},children:xe.jsx(vo,{variant:"link",onClick:()=>Ze(!0),style:{fontFamily:"'Dancing Script', cursive",color:"#ff8fa3",textDecoration:"none"},children:"Forgot password?"})})]})}),xe.jsx(uC,{eventKey:"signup",title:"Sign Up",children:xe.jsxs(Vi,{onSubmit:Si,children:[xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Name"}),xe.jsx(Vi.Control,{type:"text",value:q,onChange:Oe=>ie(Oe.target.value),placeholder:"Your name",required:!0})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Email"}),xe.jsx(Vi.Control,{type:"email",value:I,onChange:Oe=>P(Oe.target.value),placeholder:"your@email.com",required:!0})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Password"}),xe.jsx(Vi.Control,{type:"password",value:s,onChange:Oe=>G(Oe.target.value),placeholder:"At least 6 characters",required:!0})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Confirm Password"}),xe.jsx(Vi.Control,{type:"password",value:ce,onChange:Oe=>be(Oe.target.value),placeholder:"Re-enter password",required:!0})]}),xe.jsx(vo,{type:"submit",disabled:Pt,style:{width:"100%",padding:"12px",fontFamily:"'Pacifico', cursive",background:"#ff8fa3",border:"none",fontSize:"16px"},children:Pt?"Creating account...":"Sign Up"}),xe.jsx("p",{style:{textAlign:"center",marginTop:"15px",fontFamily:"'Dancing Script', cursive",fontSize:"14px",color:"#666"},children:"By signing up, you can add pins to Emma's map! "})]})})]})})]})})}function OH(){const c=h1(),[n,l]=ve.useState(null),[p,b]=ve.useState(null),[I,P]=ve.useState(!1),[s,G]=ve.useState(!0),[q,ie]=ve.useState(!1),[ce,be]=ve.useState([]),[He,Je]=ve.useState(!1),[it,Ze]=ve.useState(""),[Pt,ct]=ve.useState(""),[Gt,ei]=ve.useState(""),[Fi,Si]=ve.useState(""),[qe,Oe]=ve.useState(""),[je,tt]=ve.useState(""),[nt,yt]=ve.useState(""),[ze,ur]=ve.useState([]),[qn,Ct]=ve.useState([]),[oi,wi]=ve.useState([{emoji:"",title:"",description:""}]),[bn,Cn]=ve.useState([""]),[rt,Yt]=ve.useState(!1),[ai,_i]=ve.useState({type:"",text:""});ve.useEffect(()=>{const Di=K0(td,async rn=>{if(rn){l(rn);const vn=await Xm(Yu(Ll,"users",rn.uid));if(vn.exists()){const $i=vn.data();b($i),$i.role==="admin"?(P(!0),ln()):(P(!1),_i({type:"warning",text:" You don't have admin access."}))}}else c("/auth");G(!1)});return()=>Di()},[c]);async function ln(){try{const Di=await $S(B0(Ll,"destinations")),rn=[];Di.forEach(vn=>{rn.push({id:vn.id,...vn.data()})}),be(rn)}catch(Di){console.error("Error loading destinations:",Di)}}async function kn(Di){try{const rn=Yu(Ll,"destinations",Di),vn=await Xm(rn);if(vn.exists()){const $i=vn.data();Ze($i.id||Di),ct($i.title||""),ei($i.emoji||""),Si($i.description||""),Oe($i.story?.emoji||""),tt($i.story?.title||""),yt($i.story?.content||""),ur($i.photos||[]),Ct(new Array($i.photos?.length||0).fill(null)),wi($i.highlights||[{emoji:"",title:"",description:""}]),Cn($i.tips||[""]),ie(!0),Je(!1),_i({type:"info",text:` Editing: ${$i.title}`})}}catch(rn){console.error("Error loading destination:",rn),_i({type:"danger",text:` Error: ${rn.message}`})}}async function Jn(Di){if(window.confirm(`Are you sure you want to delete "${Di}"? This cannot be undone!`))try{await bH(Yu(Ll,"destinations",Di)),_i({type:"success",text:` "${Di}" deleted successfully!`}),ln()}catch(rn){console.error("Error deleting:",rn),_i({type:"danger",text:` Delete failed: ${rn.message}`})}}function Mr(){Ze(""),ct(""),ei(""),Si(""),Oe(""),tt(""),yt(""),ur([]),Ct([]),wi([{emoji:"",title:"",description:""}]),Cn([""]),ie(!1)}function Ki(){ur([...ze,{url:"",caption:"",date:""}]),Ct([...qn,null])}function hr(Di,rn,vn){const $i=[...ze];$i[Di][rn]=vn,ur($i)}function Wr(Di,rn){const vn=[...qn];vn[Di]=rn,Ct(vn)}function co(Di){ur(ze.filter((rn,vn)=>vn!==Di)),Ct(qn.filter((rn,vn)=>vn!==Di))}function nr(){wi([...oi,{emoji:"",title:"",description:""}])}function ps(Di,rn,vn){const $i=[...oi];$i[Di][rn]=vn,wi($i)}function rr(Di){wi(oi.filter((rn,vn)=>vn!==Di))}function Ds(){Cn([...bn,""])}function Us(Di,rn){const vn=[...bn];vn[Di]=rn,Cn(vn)}function Dr(Di){Cn(bn.filter((rn,vn)=>vn!==Di))}async function ms(Di,rn,vn){const $i=Date.now(),Ks=pO(QL,`destinations/${rn}/photo_${vn}_${$i}`);return await dO(Ks,Di),await fO(Ks)}async function hs(Di){Di.preventDefault(),Yt(!0),_i({type:"",text:""});try{const rn=[];for(let $i=0;$i<ze.length;$i++)if(qn[$i]){const Ks=await ms(qn[$i],it,$i);rn.push({url:Ks,caption:ze[$i].caption,date:ze[$i].date})}else ze[$i].url&&rn.push(ze[$i]);const vn={id:it,title:Pt,emoji:Gt,description:Fi,story:{emoji:qe,title:je,content:nt},photos:rn,highlights:oi.filter($i=>$i.title),tips:bn.filter($i=>$i)};await WS(Yu(Ll,"destinations",it),vn),_i({type:"success",text:q?` ${Pt} updated successfully!`:` ${Pt} created successfully!`}),ln(),setTimeout(()=>{Mr(),_i({type:"",text:""})},2e3)}catch(rn){console.error("Error:",rn),_i({type:"danger",text:` Save failed: ${rn.message}`})}finally{Yt(!1)}}return s?xe.jsx("div",{style:{paddingTop:"80px",minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(to bottom, #ffffff, #fcd9d9)"},children:xe.jsx("p",{style:{fontFamily:"'Pacifico', cursive",fontSize:"24px",color:"#333"},children:"Loading... "})}):I?xe.jsx("div",{style:{paddingTop:"80px",minHeight:"100vh",background:"linear-gradient(to bottom, #ffffff, #fcd9d9)"},children:xe.jsxs(jm,{style:{padding:"20px",maxWidth:"900px"},children:[xe.jsx("h1",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"20px",color:"#333"},children:" Manage Destinations"}),xe.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",justifyContent:"center"},children:[xe.jsx(vo,{onClick:()=>{Mr(),Je(!1)},style:{fontFamily:"'Pacifico', cursive",background:"#4CAF50",border:"none"},children:" Create New"}),xe.jsxs(vo,{onClick:()=>Je(!He),style:{fontFamily:"'Pacifico', cursive",background:"#2196F3",border:"none"},children:[" ",He?"Hide":"Show"," All Destinations"]})]}),ai.text&&xe.jsx(TE,{variant:ai.type,onClose:()=>_i({type:"",text:""}),dismissible:!0,children:ai.text}),He&&xe.jsxs(Kd,{style:{marginBottom:"30px",padding:"20px"},children:[xe.jsxs("h4",{style:{fontFamily:"'Pacifico', cursive",marginBottom:"15px"},children:["Existing Destinations (",ce.length,")"]}),xe.jsx(rC,{children:ce.map(Di=>xe.jsxs(rC.Item,{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[xe.jsxs("span",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"18px"},children:[Di.emoji," ",Di.title," ",xe.jsxs("code",{style:{marginLeft:"10px"},children:["(",Di.id,")"]})]}),xe.jsxs("div",{children:[xe.jsx(vo,{size:"sm",variant:"primary",onClick:()=>kn(Di.id),style:{marginRight:"10px",fontFamily:"'Pacifico', cursive"},children:" Edit"}),xe.jsx(vo,{size:"sm",variant:"danger",onClick:()=>Jn(Di.id),style:{fontFamily:"'Pacifico', cursive"},children:" Delete"})]})]},Di.id))})]}),xe.jsxs(Vi,{onSubmit:hs,children:[xe.jsxs(Kd,{style:{marginBottom:"20px",padding:"20px"},children:[xe.jsx("h4",{style:{fontFamily:"'Pacifico', cursive",marginBottom:"15px"},children:" Basic Info"}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Destination ID"}),xe.jsx(Vi.Control,{type:"text",value:it,onChange:Di=>Ze(Di.target.value),placeholder:"nyc",required:!0,disabled:q}),q&&xe.jsx(Vi.Text,{className:"text-muted",children:"Cannot change ID in edit mode"})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Title"}),xe.jsx(Vi.Control,{type:"text",value:Pt,onChange:Di=>ct(Di.target.value),placeholder:"New York City",required:!0})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Emoji"}),xe.jsx(Vi.Control,{type:"text",value:Gt,onChange:Di=>ei(Di.target.value),placeholder:""})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Description"}),xe.jsx(Vi.Control,{as:"textarea",rows:3,value:Fi,onChange:Di=>Si(Di.target.value),placeholder:"Welcome to my NYC page...",required:!0})]})]}),xe.jsxs(Kd,{style:{marginBottom:"20px",padding:"20px"},children:[xe.jsx("h4",{style:{fontFamily:"'Pacifico', cursive",marginBottom:"15px"},children:" Story Section"}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Story Emoji"}),xe.jsx(Vi.Control,{type:"text",value:qe,onChange:Di=>Oe(Di.target.value),placeholder:""})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Story Title"}),xe.jsx(Vi.Control,{type:"text",value:je,onChange:Di=>tt(Di.target.value),placeholder:"My NYC Story"})]}),xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{children:"Story Content"}),xe.jsx(Vi.Control,{as:"textarea",rows:5,value:nt,onChange:Di=>yt(Di.target.value),placeholder:"My first time in New York was..."})]})]}),xe.jsxs(Kd,{style:{marginBottom:"20px",padding:"20px"},children:[xe.jsx("h4",{style:{fontFamily:"'Pacifico', cursive",marginBottom:"15px"},children:" Photos"}),ze.map((Di,rn)=>xe.jsxs("div",{style:{padding:"15px",marginBottom:"15px",background:"#f8f9fa",borderRadius:"10px",position:"relative"},children:[xe.jsx(vo,{size:"sm",variant:"danger",onClick:()=>co(rn),style:{position:"absolute",top:"10px",right:"10px"},children:""}),xe.jsxs(Vi.Group,{className:"mb-2",children:[xe.jsxs(Vi.Label,{children:["Photo ",rn+1]}),Di.url&&xe.jsxs("div",{style:{marginBottom:"10px"},children:[xe.jsx("img",{src:Di.url,alt:"preview",style:{width:"100px",height:"100px",objectFit:"cover",borderRadius:"8px"}}),xe.jsx(Vi.Text,{className:"text-muted d-block",children:"Current photo (will be kept if no new file selected)"})]}),xe.jsx(Vi.Control,{type:"file",accept:"image/*",onChange:vn=>Wr(rn,vn.target.files[0])})]}),xe.jsxs(Vi.Group,{className:"mb-2",children:[xe.jsx(Vi.Label,{children:"Caption"}),xe.jsx(Vi.Control,{type:"text",value:Di.caption,onChange:vn=>hr(rn,"caption",vn.target.value),placeholder:"Times Square at night "})]}),xe.jsxs(Vi.Group,{className:"mb-2",children:[xe.jsx(Vi.Label,{children:"Date"}),xe.jsx(Vi.Control,{type:"text",value:Di.date,onChange:vn=>hr(rn,"date",vn.target.value),placeholder:"2024-12-01"})]})]},rn)),xe.jsx(vo,{variant:"outline-primary",onClick:Ki,style:{width:"100%"},children:"+ Add Another Photo"})]}),xe.jsxs(Kd,{style:{marginBottom:"20px",padding:"20px"},children:[xe.jsx("h4",{style:{fontFamily:"'Pacifico', cursive",marginBottom:"15px"},children:" Highlights"}),oi.map((Di,rn)=>xe.jsxs("div",{style:{padding:"15px",marginBottom:"15px",background:"#f8f9fa",borderRadius:"10px",position:"relative"},children:[xe.jsx(vo,{size:"sm",variant:"danger",onClick:()=>rr(rn),style:{position:"absolute",top:"10px",right:"10px"},children:""}),xe.jsxs(Vi.Group,{className:"mb-2",children:[xe.jsx(Vi.Label,{children:"Emoji"}),xe.jsx(Vi.Control,{type:"text",value:Di.emoji,onChange:vn=>ps(rn,"emoji",vn.target.value),placeholder:""})]}),xe.jsxs(Vi.Group,{className:"mb-2",children:[xe.jsx(Vi.Label,{children:"Title"}),xe.jsx(Vi.Control,{type:"text",value:Di.title,onChange:vn=>ps(rn,"title",vn.target.value),placeholder:"Statue of Liberty"})]}),xe.jsxs(Vi.Group,{className:"mb-2",children:[xe.jsx(Vi.Label,{children:"Description"}),xe.jsx(Vi.Control,{type:"text",value:Di.description,onChange:vn=>ps(rn,"description",vn.target.value),placeholder:"Iconic symbol of freedom"})]})]},rn)),xe.jsx(vo,{variant:"outline-primary",onClick:nr,style:{width:"100%"},children:"+ Add Another Highlight"})]}),xe.jsxs(Kd,{style:{marginBottom:"20px",padding:"20px"},children:[xe.jsx("h4",{style:{fontFamily:"'Pacifico', cursive",marginBottom:"15px"},children:" Travel Tips"}),bn.map((Di,rn)=>xe.jsxs("div",{style:{position:"relative",marginBottom:"15px"},children:[xe.jsx(vo,{size:"sm",variant:"danger",onClick:()=>Dr(rn),style:{position:"absolute",top:"5px",right:"5px",zIndex:10},children:""}),xe.jsxs(Vi.Group,{children:[xe.jsxs(Vi.Label,{children:["Tip ",rn+1]}),xe.jsx(Vi.Control,{type:"text",value:Di,onChange:vn=>Us(rn,vn.target.value),placeholder:" Get a MetroCard for unlimited subway rides"})]})]},rn)),xe.jsx(vo,{variant:"outline-primary",onClick:Ds,style:{width:"100%"},children:"+ Add Another Tip"})]}),xe.jsx(vo,{type:"submit",variant:"primary",disabled:rt,style:{width:"100%",padding:"15px",fontSize:"18px",fontFamily:"'Pacifico', cursive",background:"#ff8fa3",border:"none"},children:rt?"Saving... ":q?" Update Destination":" Create Destination"})]})]})}):xe.jsx("div",{style:{paddingTop:"80px",minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(to bottom, #ffffff, #fcd9d9)"},children:xe.jsxs(jm,{style:{maxWidth:"600px",textAlign:"center"},children:[xe.jsx("h1",{style:{fontFamily:"'Pacifico', cursive",marginBottom:"20px",color:"#333"},children:"Access Denied "}),xe.jsx("p",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"20px",color:"#666",marginBottom:"30px"},children:"Only Emma (admin) can access this page."}),xe.jsx(vo,{onClick:()=>c("/"),style:{fontFamily:"'Pacifico', cursive",background:"#ff8fa3",border:"none",padding:"12px 30px",fontSize:"18px"},children:"Go to Home"})]})})}function LH({photos:c}){return xe.jsxs("div",{style:{marginTop:"40px",marginBottom:"40px"},children:[xe.jsx("h2",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"25px",color:"#333"},children:" Photo Gallery"}),xe.jsx("div",{style:{display:"flex",overflowX:"auto",gap:"20px",padding:"10px 0",scrollSnapType:"x mandatory"},children:c.map((n,l)=>xe.jsxs("div",{style:{width:"400px",flexShrink:0,borderRadius:"12px",overflow:"hidden",background:"white",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",scrollSnapAlign:"start"},children:[xe.jsx("img",{src:n.url,alt:n.caption,style:{width:"100%",height:"auto",display:"block"}}),xe.jsxs("div",{style:{padding:"12px"},children:[xe.jsx("p",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"16px",margin:"0 0 8px",color:"#555"},children:n.caption}),n.date&&xe.jsxs("p",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"14px",margin:0,color:"#888"},children:[" ",n.date]})]})]},l))})]})}function zH({title:c,content:n,emoji:l}){return xe.jsxs("div",{style:{marginTop:"40px",marginBottom:"40px",padding:"30px",background:"rgba(255, 255, 255, 0.7)",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.08)"},children:[xe.jsxs("h2",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"20px",color:"#333"},children:[l," ",c]}),xe.jsx("p",{style:{fontFamily:"'Courgette', cursive",fontSize:"18px",lineHeight:"1.8",color:"#555",textAlign:"justify",maxWidth:"800px",margin:"0 auto"},children:n})]})}function kH({highlights:c}){return xe.jsxs("div",{style:{marginTop:"40px",marginBottom:"40px"},children:[xe.jsx("h2",{style:{fontFamily:"'Caveat', cursive",textAlign:"center",marginBottom:"30px",color:"#333"},children:" Highlights"}),xe.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"20px",maxWidth:"900px",margin:"0 auto"},children:c.map((n,l)=>xe.jsxs("div",{style:{padding:"20px",background:"white",borderRadius:"15px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",textAlign:"center",transition:"transform 0.3s ease"},onMouseEnter:p=>p.currentTarget.style.transform="translateY(-5px)",onMouseLeave:p=>p.currentTarget.style.transform="translateY(0)",children:[xe.jsx("div",{style:{fontSize:"40px",marginBottom:"10px"},children:n.emoji}),xe.jsx("h3",{style:{fontFamily:"'Caveat', cursive",fontSize:"20px",marginBottom:"10px",color:"#333"},children:n.title}),xe.jsx("p",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"16px",color:"#666",margin:0},children:n.description})]},l))})]})}function FH({tips:c}){return xe.jsxs("div",{style:{marginTop:"40px",marginBottom:"40px",padding:"30px",background:"linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)",borderRadius:"20px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[xe.jsx("h2",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"25px",color:"#333"},children:" Travel Tips"}),xe.jsx("div",{style:{maxWidth:"700px",margin:"0 auto"},children:c.map((n,l)=>xe.jsx("div",{style:{padding:"15px",marginBottom:"15px",background:"rgba(255, 255, 255, 0.8)",borderRadius:"12px",borderLeft:"4px solid #ff8fa3"},children:xe.jsx("p",{style:{fontFamily:"'Courgette', cursive",fontSize:"17px",color:"#333",margin:0},children:n})},l))})]})}function BH({destinationId:c}){const[n,l]=ve.useState([]),[p,b]=ve.useState(!1),[I,P]=ve.useState(!1),[s,G]=ve.useState(null);ve.useEffect(()=>{const ce=K0(td,be=>{G(be),b(be?n.includes(be.uid):!1)});return()=>ce()},[n]),ve.useEffect(()=>{q()},[c]);async function q(){try{const ce=Yu(Ll,"destination_likes",c),be=await Xm(ce);if(be.exists()){const He=be.data().likes||[];l(He);const Je=td.currentUser;Je&&b(He.includes(Je.uid))}else l([]),b(!1)}catch(ce){console.error("Error loading likes:",ce)}}async function ie(){if(!s){alert("Please login to like this destination! ");return}P(!0);try{const ce=Yu(Ll,"destination_likes",c);p?(await tM(ce,{likes:EH(s.uid)}),l(n.filter(be=>be!==s.uid)),b(!1)):((await Xm(ce)).exists()?await tM(ce,{likes:TH(s.uid)}):await WS(ce,{destinationId:c,likes:[s.uid]}),l([...n,s.uid]),b(!0))}catch(ce){console.error("Error toggling like:",ce),alert("Failed to update like. Please try again.")}finally{P(!1)}}return xe.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"10px",marginTop:"40px",marginBottom:"20px"},children:[xe.jsx(vo,{onClick:ie,disabled:I,style:{fontSize:"40px",background:"none",border:"none",cursor:"pointer",color:p?"red":"#444",transition:"0.2s",padding:"0"},onMouseEnter:ce=>ce.currentTarget.style.transform="scale(1.2)",onMouseLeave:ce=>ce.currentTarget.style.transform="scale(1)",children:p?"":""}),xe.jsxs("span",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"20px",color:"#333"},children:[n.length," ",n.length===1?"like":"likes"]})]})}function NH({destinationId:c}){const[n,l]=ve.useState([]),[p,b]=ve.useState(""),[I,P]=ve.useState(!1),[s,G]=ve.useState(!1),[q,ie]=ve.useState(null);ve.useEffect(()=>{const Je=K0(td,it=>{ie(it)});return()=>Je()},[]),ve.useEffect(()=>{ce()},[c]);async function ce(){P(!0);try{const Je=gH(B0(Ll,"destination_comments"),_H("destinationId","==",c),yH("createdAt","desc")),it=await $S(Je),Ze=[];for(const Pt of it.docs){const ct=Pt.data();let Gt=ct.userEmail;try{const ei=await Xm(Yu(Ll,"users",ct.userId));ei.exists()&&(Gt=ei.data().name||ct.userEmail)}catch(ei){console.error("Error fetching user:",ei)}Ze.push({id:Pt.id,...ct,userName:Gt})}l(Ze)}catch(Je){console.error("Error loading comments:",Je),Je.message.includes("index")&&(alert("Please create Firebase index. Check console for the link."),console.error("Create index at:",Je.message))}finally{P(!1)}}async function be(Je){if(Je.preventDefault(),!q){alert("Please login to comment! ");return}if(p.trim()){G(!0);try{await YL(B0(Ll,"destination_comments"),{destinationId:c,userId:q.uid,userEmail:q.email,content:p.trim(),createdAt:new Date().toISOString()}),b(""),await ce()}catch(it){console.error("Error posting comment:",it),alert("Failed to post comment. Please try again.")}finally{G(!1)}}}function He(Je){const it=new Date(Je),Pt=new Date-it,ct=Math.floor(Pt/6e4),Gt=Math.floor(Pt/36e5),ei=Math.floor(Pt/864e5);return ct<1?"Just now":ct<60?`${ct} minute${ct>1?"s":""} ago`:Gt<24?`${Gt} hour${Gt>1?"s":""} ago`:ei<7?`${ei} day${ei>1?"s":""} ago`:it.toLocaleDateString()}return xe.jsxs("div",{style:{marginTop:"40px",marginBottom:"40px",maxWidth:"800px",margin:"40px auto"},children:[xe.jsxs("h2",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"30px",color:"#333"},children:[" Comments (",n.length,")"]}),xe.jsx(Kd,{style:{marginBottom:"30px",padding:"20px",background:"rgba(255, 255, 255, 0.9)",borderRadius:"15px",boxShadow:"0 2px 8px rgba(0,0,0,0.08)"},children:q?xe.jsxs(Vi,{onSubmit:be,children:[xe.jsxs(Vi.Group,{className:"mb-3",children:[xe.jsx(Vi.Label,{style:{fontFamily:"'Dancing Script', cursive",fontSize:"18px",color:"#333"},children:"Share your thoughts..."}),xe.jsx(Vi.Control,{as:"textarea",rows:3,value:p,onChange:Je=>b(Je.target.value),placeholder:"What did you love about this place?",style:{fontFamily:"'Dancing Script', cursive",fontSize:"16px"}})]}),xe.jsx(vo,{type:"submit",disabled:s||!p.trim(),style:{fontFamily:"'Pacifico', cursive",background:"#ff8fa3",border:"none",padding:"10px 25px"},children:s?"Posting...":" Post Comment"})]}):xe.jsx(TE,{variant:"info",style:{fontFamily:"'Dancing Script', cursive",fontSize:"16px",textAlign:"center",margin:0},children:"Please login to leave a comment "})}),I?xe.jsx("p",{style:{textAlign:"center",fontFamily:"'Dancing Script', cursive",fontSize:"18px",color:"#666"},children:"Loading comments..."}):n.length===0?xe.jsx("p",{style:{textAlign:"center",fontFamily:"'Dancing Script', cursive",fontSize:"18px",color:"#666"},children:"No comments yet. Be the first to share your thoughts! "}):n.map(Je=>xe.jsxs(Kd,{style:{marginBottom:"15px",padding:"20px",background:"white",borderRadius:"12px",boxShadow:"0 2px 6px rgba(0,0,0,0.06)",border:"1px solid #f0f0f0"},children:[xe.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[xe.jsx("span",{style:{fontFamily:"'Pacifico', cursive",fontSize:"16px",color:"#ff8fa3",fontWeight:"600"},children:Je.userName}),xe.jsx("span",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"14px",color:"#888"},children:He(Je.createdAt)})]}),xe.jsx("p",{style:{fontFamily:"'Courgette', cursive",fontSize:"16px",color:"#333",margin:0,lineHeight:"1.6"},children:Je.content})]},Je.id))]})}function VH(){const{id:c}=IF(),[n,l]=ve.useState(null),[p,b]=ve.useState(!0),I={ny:"nyc",ca:"la",sd:"sd",chi:"chi",sf:"san-francisco",anc:"anc",wisc:"wisc",apt:"apt"};return ve.useEffect(()=>{async function P(){try{const s=I[c]||c,G=Yu(Ll,"destinations",s),q=await Xm(G);q.exists()?l(q.data()):console.log("No such destination!")}catch(s){console.error("Error fetching destination:",s)}finally{b(!1)}}P()},[c]),p?xe.jsx("div",{style:{paddingTop:"80px",minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(to bottom, #ffffff, #fcd9d9)"},children:xe.jsx("p",{style:{fontFamily:"'Pacifico', cursive",fontSize:"24px",color:"#333"},children:"Loading... "})}):n?xe.jsx("div",{style:{paddingTop:"80px",minHeight:"100vh",background:"linear-gradient(to bottom, #ffffff, #fcd9d9)"},children:xe.jsxs(jm,{style:{padding:"20px"},children:[xe.jsxs("h1",{style:{fontFamily:"'Pacifico', cursive",textAlign:"center",marginBottom:"20px",fontSize:"48px",color:"#333"},children:[n.title," ",n.emoji]}),xe.jsx("p",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"20px",lineHeight:"1.6",maxWidth:"700px",margin:"0 auto 40px",textAlign:"center",color:"#555"},children:n.description}),n.photos&&n.photos.length>0&&xe.jsx(LH,{photos:n.photos}),n.story&&xe.jsx(zH,{emoji:n.story.emoji,title:n.story.title,content:n.story.content}),n.highlights&&n.highlights.length>0&&xe.jsx(kH,{highlights:n.highlights}),n.tips&&n.tips.length>0&&xe.jsx(FH,{tips:n.tips}),xe.jsx(BH,{destinationId:I[c]||c}),xe.jsx(NH,{destinationId:I[c]||c})]})}):xe.jsx("div",{style:{paddingTop:"80px",minHeight:"100vh",display:"flex",justifyContent:"center",alignItems:"center",background:"linear-gradient(to bottom, #ffffff, #fcd9d9)"},children:xe.jsxs("div",{style:{textAlign:"center"},children:[xe.jsx("h1",{style:{fontFamily:"'Pacifico', cursive",fontSize:"48px",color:"#333",marginBottom:"20px"},children:"Destination is coming!"}),xe.jsx("p",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"20px",color:"#666"},children:"I'm still working on it!."})]})})}function UH(){return xe.jsx(VH,{})}function jH(){const c=h1(),[n,l]=ve.useState(null),[p,b]=ve.useState(null);ve.useEffect(()=>{const P=K0(td,async s=>{if(l(s),s){const G=await Xm(Yu(Ll,"users",s.uid));G.exists()&&b(G.data())}else b(null)});return()=>P()},[]);async function I(){try{await N6(td),c("/")}catch(P){console.error("Logout error:",P)}}return xe.jsx(_b,{style:{background:"linear-gradient(90deg, #ff9a9e, #fad0c4)"},variant:"dark",expand:"lg",fixed:"top",children:xe.jsxs(jm,{fluid:!0,children:[xe.jsx(_b.Brand,{as:i_,to:"/",style:{fontFamily:"'Dancing Script', cursive",color:"black",fontSize:36},className:"fw-bold",children:"Journeyly"}),xe.jsx(_b.Toggle,{"aria-controls":"basic-navbar-nav"}),xe.jsx(_b.Collapse,{id:"basic-navbar-nav",children:xe.jsxs(p0,{className:"ms-auto",style:{alignItems:"center"},children:[xe.jsx(p0.Link,{as:i_,to:"/",className:"fs-5",style:{fontFamily:"'Dancing Script', cursive",color:"black",marginRight:"15px"},children:"Home"}),xe.jsx(p0.Link,{as:i_,to:"/about",className:"fs-5",style:{fontFamily:"'Dancing Script', cursive",color:"black",marginRight:"15px"},children:"About"}),p&&p.role==="admin"&&xe.jsx(p0.Link,{as:i_,to:"/admin",className:"fs-5",style:{fontFamily:"'Dancing Script', cursive",color:"black",marginRight:"15px"},children:"Admin"}),n?xe.jsxs(xe.Fragment,{children:[xe.jsxs("span",{style:{fontFamily:"'Dancing Script', cursive",fontSize:"16px",color:"black",marginRight:"15px"},children:["Hi, ",p?.name||n.email," "]}),xe.jsx(vo,{onClick:I,style:{fontFamily:"'Dancing Script', cursive",fontSize:"16px",background:"#ff8fa3",border:"none",padding:"8px 20px",borderRadius:"20px"},children:"Logout"})]}):xe.jsx(vo,{as:i_,to:"/auth",style:{fontFamily:"'Dancing Script', cursive",fontSize:"16px",background:"#ff8fa3",border:"none",padding:"8px 20px",borderRadius:"20px"},children:"Login"})]})})]})})}function GH(){return xe.jsxs(hB,{children:[xe.jsx(jH,{}),xe.jsxs(jF,{children:[xe.jsx(Ey,{path:"/",element:xe.jsx(MH,{})}),xe.jsx(Ey,{path:"/about",element:xe.jsx(DH,{})}),xe.jsx(Ey,{path:"/auth",element:xe.jsx(PH,{})}),xe.jsx(Ey,{path:"/admin",element:xe.jsx(OH,{})}),xe.jsx(Ey,{path:"/destination/:id",element:xe.jsx(UH,{})})]})]})}Y3.createRoot(document.getElementById("root")).render(xe.jsx(GH,{}));
